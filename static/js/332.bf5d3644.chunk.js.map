{"version":3,"file":"static/js/332.bf5d3644.chunk.js","mappings":";mHAAA,SAASA,EAAUC,EAAGC,EAAGC,GACvBD,IAAMA,EAAI,IACV,IAAIE,EAAIF,EAAEG,SACV,OAAOC,OAAOC,eAAe,CAAC,EAAG,IAAK,CACpCC,IAAK,SAAaC,GAChBP,EAAEE,GAAKK,EAAGR,EAAES,MAAMP,EAAGD,EACvB,GAEJ,C,2CCRA,SAASS,EAA2BT,EAAGD,GACrC,GAAIA,EAAEW,IAAIV,GAAI,MAAM,IAAIW,UAAU,iEACpC,CCDA,SAASC,EAA4BZ,EAAGa,GACtC,EAA0Bb,EAAGa,GAAIA,EAAEC,IAAId,EACzC,CCFA,SAASe,EAA2Bf,EAAGD,EAAGc,GACxC,EAA0Bb,EAAGD,GAAIA,EAAEO,IAAIN,EAAGa,EAC5C,CCHA,SAASG,EAAkBhB,EAAGD,EAAGE,GAC/B,GAAI,mBAAqBD,EAAIA,IAAMD,EAAIC,EAAEU,IAAIX,GAAI,OAAOkB,UAAUd,OAAS,EAAIJ,EAAIE,EACnF,MAAM,IAAIU,UAAU,gDACtB,CCFA,SAASO,EAAoBC,EAAGjB,EAAGW,GACjC,OAAOA,EAAE,EAAiBM,EAAGjB,GAC/B,CCFA,SAAS,EAAuBiB,EAAGN,GACjC,OAAOM,EAAEC,IAAI,EAAiBD,EAAGN,GACnC,CCFA,SAASQ,EAAuBF,EAAGN,EAAGX,GACpC,OAAOiB,EAAEb,IAAI,EAAiBa,EAAGN,GAAIX,GAAIA,CAC3C,C,kDCSA,SAASoB,EAAsBpB,GAC7B,SAASqB,EAAkCrB,GACzC,GAAIE,OAAOF,KAAOA,EAAG,OAAOsB,QAAQC,OAAO,IAAId,UAAUT,EAAI,uBAC7D,IAAID,EAAIC,EAAEwB,KACV,OAAOF,QAAQG,QAAQzB,EAAE0B,OAAOC,KAAK,SAAU3B,GAC7C,MAAO,CACL0B,MAAO1B,EACPwB,KAAMzB,EAEV,EACF,CACA,OAAOqB,EAAwB,SAA+BpB,GAC5D4B,KAAKX,EAAIjB,EAAG4B,KAAK7B,EAAIC,EAAE6B,IACzB,EAAGT,EAAsBU,UAAY,CACnCb,EAAG,KACHlB,EAAG,KACH8B,KAAM,WACJ,OAAOR,EAAkCO,KAAK7B,EAAEO,MAAMsB,KAAKX,EAAGF,WAChE,EACA,OAAU,SAAiBf,GACzB,IAAID,EAAI6B,KAAKX,EAAU,OACvB,YAAO,IAAWlB,EAAIuB,QAAQG,QAAQ,CACpCC,MAAO1B,EACPwB,MAAM,IACHH,EAAkCtB,EAAEO,MAAMsB,KAAKX,EAAGF,WACzD,EACA,MAAS,SAAgBf,GACvB,IAAID,EAAI6B,KAAKX,EAAU,OACvB,YAAO,IAAWlB,EAAIuB,QAAQC,OAAOvB,GAAKqB,EAAkCtB,EAAEO,MAAMsB,KAAKX,EAAGF,WAC9F,GACC,IAAIK,EAAsBpB,EAC/B,C,KCvBA,MAAM+B,EAEe,kBAAZC,SACPA,QAAU,KAAO,qBAChBA,QAAQC,SAASC,MAChBF,QAAQC,SAASE,UAAYH,QAAQI,MAAyB,YAAjBJ,QAAQI,MAEnDC,EAAuB,CAAC,KAAO,EAAG,EAAG,KAAO,EAAG,GAI/CC,EAAc,KAkBdC,EACC,EADDA,EAEK,EAFLA,EAGG,EAHHA,EAKe,GALfA,EAMiB,GANjBA,EAOiB,GAPjBA,EAQQ,IARRA,EASI,IAGJC,EAAiB,CACrBC,QAAS,EACTC,OAAQ,EACRC,aAAc,EACdC,eAAgB,GAGZC,EAAyB,yBAEzBC,EAAuB,CAC3BL,SAAU,EACVM,KAAM,EACNC,SAAU,EACVC,UAAW,EACXC,MAAO,GACPC,IAAK,GACLC,MAAO,GACPC,UAAW,IACXC,QAAS,KAGLC,EAA6B,CACjCC,OAAQ,EACRC,OAAQ,EACRC,cAAe,GACfC,eAAgB,GAChBC,iBAAkB,GAClBC,UAAW,GACXC,cAAe,GACfC,YAAa,GACbC,gBAAiB,GACjBC,oBAAqB,GACrBC,eAAgB,GAChBC,mBAAoB,GACpBC,UAAW,IAePC,EACO,EADPA,EAEK,EAILC,EACE,EADFA,EAEI,EAFJA,EAGS,EAHTA,EAIO,EAJPA,EASc,EATdA,GAUc,EAGdC,GAAY,CAChBC,eAAgB,EAChBC,UAAW,EACXC,WAAY,GAGRC,GAAiB,CACrBC,KAAM,EACNC,KAAM,EACN7B,SAAU,EACV8B,KAAM,EACNC,OAAQ,EACRC,OAAQ,EACRC,QAAS,EACTC,SAAU,EACVjC,UAAW,EACXkC,UAAW,GACXC,SAAU,GACVC,UAAW,GACXnC,MAAO,GACPoC,MAAO,GACPnC,IAAK,GACLC,MAAO,GACPmC,eAAgB,GAChBC,MAAO,GACPC,MAAO,GACPC,OAAQ,GACRC,OAAQ,GACRC,YAAa,GACbC,QAAS,GACTC,UAAW,GACXC,OAAQ,GACRC,OAAQ,IA2CJC,GACG,EADHA,GAEI,EAFJA,GAGK,EAHLA,GAIG,EAJHA,GAKO,EAiCPC,GAAiB,CACrBC,OAAQ,EACRC,SAAU,EACVC,MAAO,GAIHC,GAAM,CAKVC,WAAY,EACZC,aAAc,EACdC,WAAY,EACZC,YAAa,EACbC,cAAe,EACfC,QAAS,EACTC,mBAAoB,EACpBC,YAAa,EACbC,UAAW,EACXC,KAAM,GACNC,QAAS,GACTC,UAAW,GACXC,OAAQ,GACRC,OAAQ,GACRC,QAAS,GACTC,SAAU,GACVC,SAAU,GACVC,UAAW,GACXC,UAAW,GACXC,OAAQ,GACRC,YAAa,GACbC,KAAM,GACNC,OAAQ,GACRC,WAAY,GACZC,aAAc,GACdC,gBAAiB,GACjBC,kBAAmB,GACnBC,QAAS,GACTC,KAAM,GACNC,OAAQ,GACRC,UAAW,GACXC,QAAS,GACTC,eAAgB,GAChBC,eAAgB,GAChBC,UAAW,GACXC,WAAY,GACZC,QAAS,GACTC,qBAAsB,GACtBC,YAAa,GACbC,SAAU,GACVC,mBAAoB,GACpBC,cAAe,GACfC,SAAU,GACVC,SAAU,GACVC,eAAgB,GAChBC,iBAAkB,GAClBC,2BAA4B,GAC5BC,aAAc,GACdC,sBAAuB,GACvBC,oBAAqB,GACrBC,kBAAmB,GACnBC,eAAgB,GAChBC,gBAAiB,GACjBC,aAAc,GACdC,cAAe,GACfC,cAAe,GACfC,YAAa,GACbC,kBAAmB,GACnBC,gBAAiB,GACjBC,mBAAoB,GACpBC,iBAAkB,GAClBC,YAAa,GACbC,iBAAkB,GAClBC,eAAgB,GAChBC,eAAgB,GAChBC,aAAc,GACdC,UAAW,GACXC,eAAgB,GAChBC,mBAAoB,GACpBC,wBAAyB,GACzBC,iBAAkB,GAClBC,YAAa,GACbC,UAAW,GACXC,sBAAuB,GACvBC,oBAAqB,GACrBC,WAAY,GACZC,SAAU,GAGVC,gBAAiB,GACjBC,cAAe,GAEfC,sBAAuB,GACvBC,2BAA4B,GAC5BC,kBAAmB,GACnBC,wBAAyB,GACzBC,6BAA8B,GAC9BC,wBAAyB,GACzBC,4BAA6B,GAC7BC,yBAA0B,GAC1BC,cAAe,GACfC,qBAAsB,GACtBC,mBAAoB,GACpBC,YAAa,IAKTC,GACI,EADJA,GAEI,EAFJA,GAGK,EAHLA,GAIc,EAJdA,GAKO,EAQb,IAAIC,GAAYjG,GAAeE,SAE/B,SAASgG,GAAkBC,GACrBC,OAAOC,UAAUF,KACnBF,GAAYE,EAEhB,CAEA,SAASG,KACP,OAAOL,EACT,CAKA,SAASM,GAAKC,GACRP,IAAajG,GAAeG,OAE9BsG,QAAQF,KAAK,SAADG,OAAUF,GAE1B,CAGA,SAASG,GAAKH,GACRP,IAAajG,GAAeE,UAE9BuG,QAAQE,KAAK,YAADD,OAAaF,GAE7B,CAEA,SAASI,GAAYJ,GACnB,MAAM,IAAIK,MAAML,EAClB,CAEA,SAASM,GAAOC,EAAMP,GACfO,GACHH,GAAYJ,EAEhB,CAwBA,SAASQ,GAAuBC,GAAqC,IAAhCC,EAAOrM,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAAMuM,EAAOvM,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC7D,IAAKoM,EACH,OAAO,KAET,GAAIG,GAA0B,kBAARH,EAAkB,CAEtC,GAAIG,EAAQC,oBAAsBJ,EAAIK,WAAW,QAAS,CACxD,MAAMC,EAAON,EAAIO,MAAM,QAGf,OAAJD,QAAI,IAAJA,OAAI,EAAJA,EAAMxN,SAAU,IAClBkN,EAAM,UAAHP,OAAaO,GAEpB,CAIA,GAAIG,EAAQK,mBACV,IACER,EA6pBCS,mBAAmBC,OA7pBKV,GAC3B,CAAE,MAAAW,GAAO,CAEb,CAEA,MAAMC,EAAcX,EAAUY,IAAIC,MAAMd,EAAKC,GAAWY,IAAIC,MAAMd,GAClE,OA9CF,SAA0BA,GACxB,OAAW,OAAHA,QAAG,IAAHA,OAAG,EAAHA,EAAKe,UACX,IAAK,QACL,IAAK,SACL,IAAK,OACL,IAAK,UACL,IAAK,OACH,OAAO,EACT,QACE,OAAO,EAEb,CAmCSC,CAAiBJ,GAAeA,EAAc,IACvD,CAUA,SAASK,GAAcjB,EAAKkB,GAAwB,IAAlBC,EAAQvN,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACxC,MAAMwN,EAAMP,IAAIC,MAAMd,GACtB,OAAIoB,GACFA,EAAIF,KAAOA,EACJE,EAAIC,MAITF,GAAYpB,GAAuBC,EAAK,sBACnCA,EAAIsB,MAAM,IAAK,GAAG,GAAK,GAAH7B,OAAMyB,EAAO,IAAHzB,OAAOyB,GAAS,IAEhD,EACT,CAEA,SAASK,GAAOC,EAAKC,EAAMlN,GAAgC,IAAzBmN,EAAe9N,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAa/C,OANAb,OAAOC,eAAewO,EAAKC,EAAM,CAC/BlN,QACAoN,YAAaD,EACbE,cAAc,EACdC,UAAU,IAELtN,CACT,CAKA,MAAMuN,GAAiB,WAErB,SAASA,EAAcC,EAASC,GAO9BvN,KAAKsN,QAAUA,EACftN,KAAKuN,KAAOA,CACd,CAIA,OAHAF,EAAcnN,UAAY,IAAIiL,MAC9BkC,EAAcG,YAAcH,EAErBA,CACT,CAhBuB,GAkBvB,MAAMI,WAA0BJ,GAC9BG,WAAAA,CAAY1C,EAAK4C,GACfC,MAAM7C,EAAK,qBACX9K,KAAK0N,KAAOA,CACd,EAGF,MAAME,WAA8BP,GAClCG,WAAAA,CAAY1C,EAAK+C,GACfF,MAAM7C,EAAK,yBACX9K,KAAK6N,QAAUA,CACjB,EAGF,MAAMC,WAA4BT,GAChCG,WAAAA,CAAY1C,GACV6C,MAAM7C,EAAK,sBACb,EAGF,MAAMiD,WAA0BV,GAC9BG,WAAAA,CAAY1C,EAAKkD,EAAQC,GACvBN,MAAM7C,EAAK,qBACX9K,KAAKgO,OAASA,EACdhO,KAAKiO,QAAUA,CACjB,EAMF,MAAMC,WAAoBb,GACxBG,WAAAA,CAAY1C,GACV6C,MAAM7C,EAAK,cACb,EAMF,MAAMqD,WAAuBd,GAC3BG,WAAAA,CAAY1C,GACV6C,MAAM7C,EAAK,iBACb,EAGF,SAASsD,GAAcC,GACA,kBAAVA,QAAwC5C,KAAb,OAAL4C,QAAK,IAALA,OAAK,EAALA,EAAOhQ,SACtC6M,GAAY,sCAEd,MAAM7M,EAASgQ,EAAMhQ,OACfiQ,EAAqB,KAC3B,GAAIjQ,EAASiQ,EACX,OAAOC,OAAOC,aAAa9P,MAAM,KAAM2P,GAEzC,MAAMI,EAAS,GACf,IAAK,IAAIC,EAAI,EAAGA,EAAIrQ,EAAQqQ,GAAKJ,EAAoB,CACnD,MAAMK,EAAWC,KAAKC,IAAIH,EAAIJ,EAAoBjQ,GAC5CyQ,EAAQT,EAAMU,SAASL,EAAGC,GAChCF,EAAOO,KAAKT,OAAOC,aAAa9P,MAAM,KAAMoQ,GAC9C,CACA,OAAOL,EAAOQ,KAAK,GACrB,CAEA,SAASC,GAAcC,GACF,kBAARA,GACTjE,GAAY,sCAEd,MAAM7M,EAAS8Q,EAAI9Q,OACbgQ,EAAQ,IAAIe,WAAW/Q,GAC7B,IAAK,IAAIqQ,EAAI,EAAGA,EAAIrQ,IAAUqQ,EAC5BL,EAAMK,GAAyB,IAApBS,EAAIE,WAAWX,GAE5B,OAAOL,CACT,CAuCA,MAAMiB,GACJ,yBAAWC,GACT,OAAOzC,GAAO9M,KAAM,iBAnBxB,WACE,MAAMwP,EAAU,IAAIJ,WAAW,GAG/B,OAFAI,EAAQ,GAAK,EAEQ,IADN,IAAIC,YAAYD,EAAQE,OAAQ,EAAG,GACpC,EAChB,CAc0CH,GACxC,CAEA,0BAAWI,GACT,OAAO7C,GAAO9M,KAAM,kBAfxB,WACE,IAEE,OADA,IAAI4P,SAAS,KACN,CACT,CAAE,MAAAC,GACA,OAAO,CACT,CACF,CAQ2CF,GACzC,CAEA,qCAAWG,GACT,OAAOhD,GACL9M,KACA,6BAC2B,qBAApB+P,gBAEX,CAEA,kCAAWC,GACT,OAAOlD,GACL9M,KACA,0BACwB,qBAAjBiQ,aAEX,CAEA,kCAAWC,GACT,OAAOpD,GACL9M,KACA,0BACwB,qBAAjBmQ,aAEX,CAEA,+BAAWC,GACT,OAAOtD,GACL9M,KACA,uBAEqB,qBAAdqQ,UAEX,CAEA,mBAAWC,GACT,MAAM,SAAEA,EAAQ,UAAEC,GAAcC,UAEhC,OAAO1D,GAAO9M,KAAM,WAAY,CAC9ByQ,UAAWF,EAAUG,SAAS,WAC9BC,QAASL,EAASI,SAAS,SAC3BE,MAAON,EAASI,SAAS,OACzBG,UAAWP,EAASI,SAAS,OAC7BI,UAEEP,EAAUG,SAAS,YAEzB,CAEA,8BAAWK,GAAsB,IAAAC,EAAAC,EAC/B,OAAOnE,GACL9M,KACA,sBACc,QADOgR,EACrBE,WAAWC,WAAG,IAAAH,GAAU,QAAVC,EAAdD,EAAgBI,gBAAQ,IAAAH,OAAA,EAAxBA,EAAAI,KAAAL,EAA2B,4BAE/B,EAGF,MAAMM,GAAaC,MAAMC,KAAKD,MAAM,KAAKE,OAAQtT,GAC/CA,EAAEuT,SAAS,IAAIC,SAAS,EAAG,MAG7B,MAAMC,GACJ,mBAAOC,CAAazT,EAAG0T,EAAGC,GACxB,MAAO,IAAP/G,OAAWsG,GAAWlT,IAAE4M,OAAGsG,GAAWQ,IAAE9G,OAAGsG,GAAWS,GACxD,CAEA,2BAAOC,CAAqBC,GAC1B,MAAO,CAACA,EAAGlT,EAAGkT,EAAGF,EAAGE,EAAGC,EAAGD,EAAGE,EAAGF,EAAG/T,EAAG+T,EAAGG,EAC3C,CAKA,kBAAOC,CAAY/M,EAAWgN,GAC5B,IAAIC,EACAjN,EAAU,IACRA,EAAU,GAAK,IACjBiN,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,GAEdD,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,GAEnBA,EAAU,GAAK,IACjBiN,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,GAEdD,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,KAEvBiN,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,EACZA,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,EAERjN,EAAU,GAAK,IACjBiN,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,GAEdD,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,GAEnBA,EAAU,GAAK,IACjBiN,EAAOD,EAAO,GACdA,EAAO,GAAKA,EAAO,GACnBA,EAAO,GAAKC,GAEdD,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,IAEzBgN,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,GACvBgN,EAAO,IAAMhN,EAAU,EACzB,CAGA,gBAAOA,CAAUkN,EAAIC,GACnB,MAAO,CACLD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAC3BD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GACnCA,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAAKC,EAAG,GAAKD,EAAG,GAEvC,CAGA,0BAAOE,CAAoBC,EAAGC,GAC5B,MAAO,CACLD,EAAE,GAAKC,EAAG7T,EAAI4T,EAAE,GAAKC,EAAGb,EACxBY,EAAE,GAAKC,EAAG7T,EAAI4T,EAAE,GAAKC,EAAGb,EACxBY,EAAE,GAAKC,EAAGV,EAAIS,EAAE,GAAKC,EAAGT,EACxBQ,EAAE,GAAKC,EAAGV,EAAIS,EAAE,GAAKC,EAAGT,EACxBQ,EAAE,GAAKC,EAAG1U,EAAIyU,EAAE,GAAKC,EAAGR,EAAIO,EAAE,GAC9BA,EAAE,GAAKC,EAAG1U,EAAIyU,EAAE,GAAKC,EAAGR,EAAIO,EAAE,GAElC,CAGA,qBAAOE,CAAeC,EAAGH,GAAY,IAATI,EAAG5T,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAChC,MAAM6T,EAAKF,EAAEC,GACPE,EAAKH,EAAEC,EAAM,GACnBD,EAAEC,GAAOC,EAAKL,EAAE,GAAKM,EAAKN,EAAE,GAAKA,EAAE,GACnCG,EAAEC,EAAM,GAAKC,EAAKL,EAAE,GAAKM,EAAKN,EAAE,GAAKA,EAAE,EACzC,CAEA,6BAAOO,CAAuBJ,EAAGxN,GAAoB,IAATyN,EAAG5T,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAChD,MAAMgU,EAAK7N,EAAU,GACfkN,EAAKlN,EAAU,GACfmN,EAAKnN,EAAU,GACf8N,EAAK9N,EAAU,GACf+N,EAAK/N,EAAU,GACfgO,EAAKhO,EAAU,GACrB,IAAK,IAAIoJ,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC7B,MAAM6E,EAAKT,EAAEC,EAAMrE,GACb8E,EAAMV,EAAEC,EAAMrE,EAAI,GACxBoE,EAAEC,EAAMrE,GAAK6E,EAAKJ,EAAKK,EAAMf,EAAKY,EAClCP,EAAEC,EAAMrE,EAAI,GAAK6E,EAAKf,EAAKgB,EAAMJ,EAAKE,CACxC,CACF,CAEA,4BAAOG,CAAsBX,EAAGH,GAC9B,MAAMK,EAAKF,EAAE,GACPG,EAAKH,EAAE,GACPX,EAAIQ,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GACjCG,EAAE,IAAME,EAAKL,EAAE,GAAKM,EAAKN,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMR,EAC7DW,EAAE,KAAOE,EAAKL,EAAE,GAAKM,EAAKN,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMR,CAChE,CAIA,8BAAOuB,CAAwBC,EAAMrO,EAAWsO,GAC9C,MAAMT,EAAK7N,EAAU,GACfkN,EAAKlN,EAAU,GACfmN,EAAKnN,EAAU,GACf8N,EAAK9N,EAAU,GACf+N,EAAK/N,EAAU,GACfgO,EAAKhO,EAAU,GACfuO,EAAKF,EAAK,GACVG,EAAKH,EAAK,GACVI,EAAKJ,EAAK,GACVK,EAAKL,EAAK,GAEhB,IAAIM,EAAKd,EAAKU,EAAKR,EACfa,EAAKD,EACLE,EAAKhB,EAAKY,EAAKV,EACfe,EAAKD,EACLE,EAAKjB,EAAKU,EAAKR,EACfgB,EAAKD,EACLE,EAAKnB,EAAKY,EAAKV,EACfkB,EAAKD,EAET,GAAW,IAAP/B,GAAmB,IAAPC,EAAU,CAExB,MAAMgC,EAAOjC,EAAKqB,EACZa,EAAOlC,EAAKuB,EACZY,EAAOlC,EAAKqB,EACZc,EAAOnC,EAAKuB,EAClBC,GAAMU,EACNP,GAAMO,EACNR,GAAMS,EACNV,GAAMU,EACNP,GAAMI,EACND,GAAMC,EACNF,GAAMG,EACNJ,GAAMI,CACR,CAEAd,EAAO,GAAKhF,KAAKC,IAAI+E,EAAO,GAAIK,EAAIE,EAAID,EAAIE,GAC5CR,EAAO,GAAKhF,KAAKC,IAAI+E,EAAO,GAAIS,EAAIE,EAAID,EAAIE,GAC5CZ,EAAO,GAAKhF,KAAKiG,IAAIjB,EAAO,GAAIK,EAAIE,EAAID,EAAIE,GAC5CR,EAAO,GAAKhF,KAAKiG,IAAIjB,EAAO,GAAIS,EAAIE,EAAID,EAAIE,EAC9C,CAEA,uBAAOM,CAAiBnC,GACtB,MAAMR,EAAIQ,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GACjC,MAAO,CACLA,EAAE,GAAKR,GACNQ,EAAE,GAAKR,GACPQ,EAAE,GAAKR,EACRQ,EAAE,GAAKR,GACNQ,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMR,GAC7BQ,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMR,EAElC,CAKA,oCAAO4C,CAA8BC,EAAQpB,GAC3C,MAAMT,EAAK6B,EAAO,GACZxC,EAAKwC,EAAO,GACZvC,EAAKuC,EAAO,GACZ5B,EAAK4B,EAAO,GAEZjW,EAAIoU,GAAM,EAAIX,GAAM,EACpBT,EAAIoB,EAAKV,EAAKD,EAAKY,EACnBlB,EAAIO,GAAM,EAAIW,GAAM,EAGpB6B,GAASlW,EAAImT,GAAK,EAClBgD,EAAStG,KAAKuG,KAAKF,GAAS,GAAKlW,EAAImT,EAAIH,GAAK,IACpD6B,EAAO,GAAKhF,KAAKuG,KAAKF,EAAQC,GAAU,GACxCtB,EAAO,GAAKhF,KAAKuG,KAAKF,EAAQC,GAAU,EAC1C,CAMA,oBAAOE,CAAczB,GACnB,MAAMvV,EAAIuV,EAAK0B,MAAM,GASrB,OARI1B,EAAK,GAAKA,EAAK,KACjBvV,EAAE,GAAKuV,EAAK,GACZvV,EAAE,GAAKuV,EAAK,IAEVA,EAAK,GAAKA,EAAK,KACjBvV,EAAE,GAAKuV,EAAK,GACZvV,EAAE,GAAKuV,EAAK,IAEPvV,CACT,CAKA,gBAAOkX,CAAUC,EAAOC,GACtB,MAAMC,EAAO7G,KAAKiG,IAChBjG,KAAKC,IAAI0G,EAAM,GAAIA,EAAM,IACzB3G,KAAKC,IAAI2G,EAAM,GAAIA,EAAM,KAErBE,EAAQ9G,KAAKC,IACjBD,KAAKiG,IAAIU,EAAM,GAAIA,EAAM,IACzB3G,KAAKiG,IAAIW,EAAM,GAAIA,EAAM,KAE3B,GAAIC,EAAOC,EACT,OAAO,KAET,MAAMC,EAAO/G,KAAKiG,IAChBjG,KAAKC,IAAI0G,EAAM,GAAIA,EAAM,IACzB3G,KAAKC,IAAI2G,EAAM,GAAIA,EAAM,KAErBI,EAAQhH,KAAKC,IACjBD,KAAKiG,IAAIU,EAAM,GAAIA,EAAM,IACzB3G,KAAKiG,IAAIW,EAAM,GAAIA,EAAM,KAE3B,OAAIG,EAAOC,EACF,KAGF,CAACH,EAAME,EAAMD,EAAOE,EAC7B,CAEA,uBAAOC,CAAiBC,EAAGC,EAAGzD,GAC5BA,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAIwD,GAChCxD,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAIyD,GAChCzD,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAIwD,GAChCxD,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAIyD,EAClC,CAEA,sBAAOC,CAAgBC,EAAIC,EAAIC,EAAIC,EAAI9D,GACrCA,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAI2D,EAAIE,GACpC7D,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAI4D,EAAIE,GACpC9D,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAI2D,EAAIE,GACpC7D,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAI4D,EAAIE,EACtC,CAqEA,wBAAOC,CAAkBJ,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,EAAIC,EAAIC,EAAInE,GACvDA,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAI2D,EAAIO,GACpClE,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAI4D,EAAIO,GACpCnE,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAI2D,EAAIO,GACpClE,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAI4D,EAAIO,GAEpCvX,EAtUE0S,GAsUF5R,KAAK0W,IAAYrF,KAAjBrR,KACEiW,EACAE,EACAG,EACAE,EACAN,EACAE,EACAG,EACAE,EACA,GAAW,GAAKN,EAAKG,GAAfL,EAAqBO,GAC3B,GAAKP,EAAK,EAAIE,EAAKG,GACnB,GAAKH,EAAKF,GACV3D,GAEFpT,EApVE0S,GAoVF5R,KAAK0W,IAAYrF,KAAjBrR,KACEiW,EACAE,EACAG,EACAE,EACAN,EACAE,EACAG,EACAE,EACA,GAAW,GAAKL,EAAKG,GAAfL,EAAqBO,GAC3B,GAAKP,EAAK,EAAIE,EAAKG,GACnB,GAAKH,EAAKF,GACV5D,EAEJ,EAlWQ,SAAAqE,GA6PmBV,EAAIE,EAAIG,EAAIE,EAAIN,EAAIE,EAAIG,EAAIE,EAAIxY,EAAGqU,GAC5D,GAAIrU,GAAK,GAAKA,GAAK,EACjB,OAEF,MAAM2Y,EAAK,EAAI3Y,EACT4Y,EAAK5Y,EAAIA,EACT6Y,EAAMD,EAAK5Y,EACX6X,EAAIc,GAAMA,GAAMA,EAAKX,EAAK,EAAIhY,EAAIkY,GAAM,EAAIU,EAAKP,GAAMQ,EAAMN,EAC7DT,EAAIa,GAAMA,GAAMA,EAAKV,EAAK,EAAIjY,EAAImY,GAAM,EAAIS,EAAKN,GAAMO,EAAML,EACnEnE,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAIwD,GAChCxD,EAAO,GAAK1D,KAAKC,IAAIyD,EAAO,GAAIyD,GAChCzD,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAIwD,GAChCxD,EAAO,GAAK1D,KAAKiG,IAAIvC,EAAO,GAAIyD,EAClC,UAAAW,GAEoBT,EAAIE,EAAIG,EAAIE,EAAIN,EAAIE,EAAIG,EAAIE,EAAI1X,EAAGgT,EAAGG,EAAGI,GAC3D,GAAI1D,KAAKmI,IAAIhY,GAAK,MAehB,YAdI6P,KAAKmI,IAAIhF,IAAM,OACjB7S,EA/QF0S,EA+QE5R,KAAK2W,IAAmBtF,KAAxBrR,KACEiW,EACAE,EACAG,EACAE,EACAN,EACAE,EACAG,EACAE,GACCvE,EAAIH,EACLO,IAMN,MAAM0E,EAAQjF,GAAK,EAAI,EAAIG,EAAInT,EAC/B,GAAIiY,EAAQ,EACV,OAEF,MAAMC,EAAYrI,KAAKuG,KAAK6B,GACtB9C,EAAK,EAAInV,EACfG,EArSE0S,EAqSF5R,KAAK2W,IAAmBtF,KAAxBrR,KACEiW,EACAE,EACAG,EACAE,EACAN,EACAE,EACAG,EACAE,IACE1E,EAAIkF,GAAa/C,EACnB5B,GAEFpT,EAjTE0S,EAiTF5R,KAAK2W,IAAmBtF,KAAxBrR,KACEiW,EACAE,EACAG,EACAE,EACAN,EACAE,EACAG,EACAE,IACE1E,EAAIkF,GAAa/C,EACnB5B,EAEJ,CAsCF4E,EAnWMtF,GAscN,IAAIuF,GAAiB,KACjBC,GAAmB,KAkBvB,SAASC,KACP,GAE+B,oBAAtBC,OAAOC,WAEd,OAAOD,OAAOC,aAEhB,MAAMC,EAAM,IAAIpI,WAAW,IAE3B,OADAkI,OAAOG,gBAAgBD,GAChBpJ,GAAcoJ,EACvB,CAEA,MAAME,GAAmB,qBAoDzB,SAASC,GAAUC,EAAG/I,EAAKgG,GACzB,OAAOjG,KAAKC,IAAID,KAAKiG,IAAI+C,EAAG/I,GAAMgG,EACpC,CAYA,SAASgD,GAAaC,GACpB,OAAI1I,WAAWlP,UAAU6X,SAChBD,EAAIC,WAENC,KAAK5J,GAAc0J,GAC5B,CAcyB,oBAAhBpY,QAAQuY,MAEfvY,QAAQuY,IAAM,SAAUC,GAAa,QAAAC,EAAAhZ,UAAAd,OAAN+Z,EAAI,IAAA7G,MAAA4G,EAAA,EAAAA,EAAA,KAAAE,EAAA,EAAAA,EAAAF,EAAAE,IAAJD,EAAIC,EAAA,GAAAlZ,UAAAkZ,GACjC,OAAO,IAAI3Y,QAAQG,IACjBA,EAAQqY,KAAME,KAElB,GAK6B,oBAApBxJ,KAAK0J,aAGd1J,KAAK0J,WAAa,SAAUC,GAC1B,OAAOA,EAAQC,OAAO,CAACzZ,EAAGgT,IAAMhT,EAAIgT,EAAG,EACzC,GCjvCF,MAAM0G,GAUJ,kBAAOC,CAAYC,GACjB,MAAMC,EAAQ,GACRhF,EAAS,CACbgF,QACAC,OAAQva,OAAOwa,OAAO,OA8BxB,OA5BA,SAASC,EAAKC,GAAM,IAAAC,EAClB,IAAKD,EACH,OAEF,IAAI7J,EAAM,KACV,MAAM5B,EAAOyL,EAAKzL,KAClB,GAAa,UAATA,EACF4B,EAAM6J,EAAKlZ,UACN,KAAK2Y,GAAQS,gBAAgB3L,GAClC,OACa,OAAJyL,QAAI,IAAJA,GAAgB,QAAZC,EAAJD,EAAMG,kBAAU,IAAAF,GAAhBA,EAAkBP,YAC3BvJ,EAAM6J,EAAKG,WAAWT,YACbM,EAAKlZ,QACdqP,EAAM6J,EAAKlZ,MACb,CAMA,GALY,OAARqP,GACFyJ,EAAM5J,KAAK,CACTG,QAGC6J,EAAKI,SAGV,IAAK,MAAMC,KAASL,EAAKI,SACvBL,EAAKM,EAET,CACAN,CAAKJ,GACE/E,CACT,CAQA,sBAAOsF,CAAgB3L,GACrB,QACW,aAATA,GACS,UAATA,GACS,WAATA,GACS,WAATA,EAEJ,EC7CF,MAAM+L,GACJ,mBAAOC,CAAaC,EAAMC,EAAIC,EAASC,EAASC,GAC9C,MAAMC,EAAaF,EAAQG,SAASL,EAAI,CAAE3Z,MAAO,OACjD,OAAQ4Z,EAAQnM,MACd,IAAK,WAIH,GAHyB,OAArBsM,EAAW/Z,QACb0Z,EAAKd,YAAcmB,EAAW/Z,OAEjB,UAAX8Z,EACF,MAEFJ,EAAKO,iBAAiB,QAASC,IAC7BL,EAAQM,SAASR,EAAI,CAAE3Z,MAAOka,EAAME,OAAOpa,UAE7C,MACF,IAAK,QACH,GAC8B,UAA5B4Z,EAAQP,WAAW3Y,MACS,aAA5BkZ,EAAQP,WAAW3Y,KACnB,CAQA,GAPIqZ,EAAW/Z,QAAU4Z,EAAQP,WAAWgB,MAC1CX,EAAKY,aAAa,WAAW,GACpBP,EAAW/Z,QAAU4Z,EAAQP,WAAWkB,QAGjDb,EAAKc,gBAAgB,WAER,UAAXV,EACF,MAEFJ,EAAKO,iBAAiB,SAAUC,IAC9BL,EAAQM,SAASR,EAAI,CACnB3Z,MAAOka,EAAME,OAAOK,QAChBP,EAAME,OAAOM,aAAa,SAC1BR,EAAME,OAAOM,aAAa,aAGpC,KAAO,CAIL,GAHyB,OAArBX,EAAW/Z,OACb0Z,EAAKY,aAAa,QAASP,EAAW/Z,OAEzB,UAAX8Z,EACF,MAEFJ,EAAKO,iBAAiB,QAASC,IAC7BL,EAAQM,SAASR,EAAI,CAAE3Z,MAAOka,EAAME,OAAOpa,SAE/C,CACA,MACF,IAAK,SACH,GAAyB,OAArB+Z,EAAW/Z,MAAgB,CAC7B0Z,EAAKY,aAAa,QAASP,EAAW/Z,OACtC,IAAK,MAAM2a,KAAUf,EAAQN,SACvBqB,EAAOtB,WAAWrZ,QAAU+Z,EAAW/Z,MACzC2a,EAAOtB,WAAWuB,UAAW,EACpBD,EAAOtB,WAAWwB,eAAe,oBACnCF,EAAOtB,WAAWuB,QAG/B,CACAlB,EAAKO,iBAAiB,QAASC,IAC7B,MAAMtO,EAAUsO,EAAME,OAAOxO,QACvB5L,GACuB,IAA3B4L,EAAQkP,cACJ,GACAlP,EAAQA,EAAQkP,eAAe9a,MACrC6Z,EAAQM,SAASR,EAAI,CAAE3Z,YAI/B,CAEA,oBAAO+a,CAAaC,GAAyD,IAAxD,KAAEtB,EAAI,QAAEE,EAAO,QAAEC,EAAU,KAAI,OAAEC,EAAM,YAAEmB,GAAaD,EACzE,MAAM,WAAE3B,GAAeO,EACjBsB,EAAsBxB,aAAgByB,kBAEpB,UAApB9B,EAAW3Y,OAGb2Y,EAAW5L,KAAO,GAAHvC,OAAMmO,EAAW5L,KAAI,KAAAvC,OAAI4O,IAE1C,IAAK,MAAOsB,EAAKpb,KAAUxB,OAAO6c,QAAQhC,GACxC,GAAc,OAAVrZ,QAA4B2L,IAAV3L,EAItB,OAAQob,GACN,IAAK,QACCpb,EAAMzB,QACRmb,EAAKY,aAAac,EAAKpb,EAAMmP,KAAK,MAEpC,MACF,IAAK,SAIH,MACF,IAAK,KACHuK,EAAKY,aAAa,kBAAmBta,GACrC,MACF,IAAK,QACHxB,OAAO8c,OAAO5B,EAAK6B,MAAOvb,GAC1B,MACF,IAAK,cACH0Z,EAAKd,YAAc5Y,EACnB,MACF,UACOkb,GAAgC,SAARE,GAA0B,cAARA,IAC7C1B,EAAKY,aAAac,EAAKpb,GAK3Bkb,GACFD,EAAYO,kBACV9B,EACAL,EAAWvM,KACXuM,EAAWoC,WAKX5B,GAAWR,EAAWqC,QACxBxb,KAAKuZ,aAAaC,EAAML,EAAWqC,OAAQ9B,EAASC,EAExD,CAOA,aAAO8B,CAAOC,GACZ,MAAM/B,EAAU+B,EAAWC,kBACrBZ,EAAcW,EAAWX,YACzBa,EAAOF,EAAWG,QAClBjC,EAAS8B,EAAW9B,QAAU,UAC9BkC,EAAWC,SAASC,cAAcJ,EAAKrO,MACzCqO,EAAKzC,YACPnZ,KAAK6a,cAAc,CACjBrB,KAAMsC,EACNpC,QAASkC,EACThC,SACAmB,gBAIJ,MAAMkB,EAA8B,aAAXrC,EACnBsC,EAAUR,EAAWS,IAG3B,GAFAD,EAAQE,OAAON,GAEXJ,EAAWW,SAAU,CACvB,MAAM/W,EAAY,UAAH0F,OAAa0Q,EAAWW,SAAS/W,UAAU2J,KAAK,KAAI,KACnEiN,EAAQb,MAAM/V,UAAYA,CAC5B,CAGI2W,GACFC,EAAQ9B,aAAa,QAAS,oBAIhC,MAAMkC,EAAW,GAIjB,GAA6B,IAAzBV,EAAKxC,SAAS/a,OAAc,CAC9B,GAAIud,EAAK9b,MAAO,CACd,MAAMkZ,EAAO+C,SAASQ,eAAeX,EAAK9b,OAC1Cgc,EAASM,OAAOpD,GACZiD,GAAoBxD,GAAQS,gBAAgB0C,EAAKrO,OACnD+O,EAAStN,KAAKgK,EAElB,CACA,MAAO,CAAEsD,WACX,CAEA,MAAME,EAAQ,CAAC,CAACZ,GAAO,EAAGE,IAE1B,KAAOU,EAAMne,OAAS,GAAG,KAAAoe,EAAAC,EACvB,MAAOC,EAAQjO,EAAG8K,GAAQgD,EAAMI,IAAI,GACpC,GAAIlO,EAAI,IAAMiO,EAAOvD,SAAS/a,OAAQ,CACpCme,EAAMK,MACN,QACF,CAEA,MAAMxD,EAAQsD,EAAOvD,WAAWoD,EAAMI,IAAI,GAAG,IAC7C,GAAc,OAAVvD,EACF,SAGF,MAAM,KAAE9L,GAAS8L,EACjB,GAAa,UAAT9L,EAAkB,CACpB,MAAMyL,EAAO+C,SAASQ,eAAelD,EAAMvZ,OAC3Cwc,EAAStN,KAAKgK,GACdQ,EAAK4C,OAAOpD,GACZ,QACF,CAEA,MAAM8D,EAAiB,OAALzD,QAAK,IAALA,GAAiB,QAAZoD,EAALpD,EAAOF,kBAAU,IAAAsD,GAAjBA,EAAmBM,MACjChB,SAASiB,gBAAgB3D,EAAMF,WAAW4D,MAAOxP,GACjDwO,SAASC,cAAczO,GAa3B,GAXAiM,EAAK4C,OAAOU,GACRzD,EAAMF,YACRnZ,KAAK6a,cAAc,CACjBrB,KAAMsD,EACNpD,QAASL,EACTM,UACAC,SACAmB,iBAIc,QAAd2B,EAAArD,EAAMD,gBAAQ,IAAAsD,OAAA,EAAdA,EAAgBre,QAAS,EAC3Bme,EAAMxN,KAAK,CAACqK,GAAQ,EAAGyD,SAClB,GAAIzD,EAAMvZ,MAAO,CACtB,MAAMkZ,EAAO+C,SAASQ,eAAelD,EAAMvZ,OACvCmc,GAAoBxD,GAAQS,gBAAgB3L,IAC9C+O,EAAStN,KAAKgK,GAEhB8D,EAAUV,OAAOpD,EACnB,CACF,CAkBA,IAAK,MAAMiE,KAAMf,EAAQgB,iBACvB,yDAEAD,EAAG7C,aAAa,YAAY,GAG9B,MAAO,CACLkC,WAEJ,CAOA,aAAOa,CAAOzB,GACZ,MAAMpW,EAAY,UAAH0F,OAAa0Q,EAAWW,SAAS/W,UAAU2J,KAAK,KAAI,KACnEyM,EAAWS,IAAId,MAAM/V,UAAYA,EACjCoW,EAAWS,IAAIiB,QAAS,CAC1B,EC5QF,MAAMC,GAAS,6BAEf,MAAMC,IAQNC,eAAeC,GAAUjS,GAAoB,IAAf/K,EAAIrB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,OACnC,GAEEse,GAAgBlS,EAAKwQ,SAAS2B,SAC9B,CACA,MAAMC,QAAiBC,MAAMrS,GAC7B,IAAKoS,EAASE,GACZ,MAAM,IAAI1S,MAAMwS,EAASG,YAE3B,OAAQtd,GACN,IAAK,cACH,OAAOmd,EAASI,cAClB,IAAK,OACH,OAAOJ,EAASK,OAClB,IAAK,OACH,OAAOL,EAASM,OAEpB,OAAON,EAASO,MAClB,CAGA,OAAO,IAAIxe,QAAQ,CAACG,EAASF,KAC3B,MAAMwe,EAAU,IAAIC,eACpBD,EAAQE,KAAK,MAAO9S,GAAmB,GACvC4S,EAAQG,aAAe9d,EAEvB2d,EAAQI,mBAAqB,KAC3B,GAAIJ,EAAQK,aAAeJ,eAAeK,KAG1C,GAAuB,MAAnBN,EAAQnQ,QAAqC,IAAnBmQ,EAAQnQ,OAWtCrO,EAAO,IAAIwL,MAAMgT,EAAQL,iBAXzB,CACE,OAAQtd,GACN,IAAK,cACL,IAAK,OACL,IAAK,OAEH,YADAX,EAAQse,EAAQR,UAGpB9d,EAAQse,EAAQO,aAElB,GAIFP,EAAQQ,KAAK,OAEjB,CAhDAC,EANMtB,IAAauB,EAAAA,EAAAA,GAAbvB,GAAa,MACJ,KAAIuB,EAAAA,EAAAA,GADbvB,GAAa,MAGJ,KAAIuB,EAAAA,EAAAA,GAHbvB,GAAa,mBAKSsB,EAAKzN,IAAMyN,EAAKE,KAmF5C,MAAMC,GAIJvR,WAAAA,CAAWwR,GAQR,IARS,QACVC,EAAO,SACPC,EAAQ,MACRC,EAAK,SACLC,EAAQ,QACRC,EAAU,EAAC,QACXC,EAAU,EAAC,SACXC,GAAW,GACZP,EACChf,KAAKif,QAAUA,EACfjf,KAAKkf,SAAWA,EAChBlf,KAAKmf,MAAQA,EACbnf,KAAKof,SAAWA,EAChBpf,KAAKqf,QAAUA,EACfrf,KAAKsf,QAAUA,EAEfH,GAASD,EAIT,MAAMM,GAAWP,EAAQ,GAAKA,EAAQ,IAAM,EACtCQ,GAAWR,EAAQ,GAAKA,EAAQ,IAAM,EAC5C,IAAIS,EAASC,EAASC,EAASC,EA0C3BC,EAAeC,EACfC,EAAOC,EArCX,OAJAb,GAAY,IACRA,EAAW,IACbA,GAAY,KAENA,GACN,KAAK,IACHM,GAAW,EACXC,EAAU,EACVC,EAAU,EACVC,EAAU,EACV,MACF,KAAK,GACHH,EAAU,EACVC,EAAU,EACVC,EAAU,EACVC,EAAU,EACV,MACF,KAAK,IACHH,EAAU,EACVC,GAAW,EACXC,GAAW,EACXC,EAAU,EACV,MACF,KAAK,EACHH,EAAU,EACVC,EAAU,EACVC,EAAU,EACVC,GAAW,EACX,MACF,QACE,MAAM,IAAI1U,MACR,qEAIFoU,IACFK,GAAWA,EACXC,GAAWA,GAKG,IAAZH,GACFI,EAAgBlR,KAAKmI,IAAI0I,EAAUR,EAAQ,IAAME,EAAQE,EACzDU,EAAgBnR,KAAKmI,IAAIyI,EAAUP,EAAQ,IAAME,EAAQG,EACzDU,GAASf,EAAQ,GAAKA,EAAQ,IAAME,EACpCc,GAAUhB,EAAQ,GAAKA,EAAQ,IAAME,IAErCW,EAAgBlR,KAAKmI,IAAIyI,EAAUP,EAAQ,IAAME,EAAQE,EACzDU,EAAgBnR,KAAKmI,IAAI0I,EAAUR,EAAQ,IAAME,EAAQG,EACzDU,GAASf,EAAQ,GAAKA,EAAQ,IAAME,EACpCc,GAAUhB,EAAQ,GAAKA,EAAQ,IAAME,GAKvCnf,KAAKsF,UAAY,CACfoa,EAAUP,EACVQ,EAAUR,EACVS,EAAUT,EACVU,EAAUV,EACVW,EAAgBJ,EAAUP,EAAQK,EAAUI,EAAUT,EAAQM,EAC9DM,EAAgBJ,EAAUR,EAAQK,EAAUK,EAAUV,EAAQM,GAGhEzf,KAAKggB,MAAQA,EACbhgB,KAAKigB,OAASA,CAChB,CAMA,WAAIC,GACF,MAAMC,EAAOngB,KAAKif,QAElB,OAAOnS,GAAO9M,KAAM,UAAW,CAC7BogB,UAAWD,EAAK,GAAKA,EAAK,GAC1BE,WAAYF,EAAK,GAAKA,EAAK,GAC3BG,MAAOH,EAAK,GACZI,MAAOJ,EAAK,IAEhB,CAOAK,KAAAA,GAMQ,IANF,MACJrB,EAAQnf,KAAKmf,MAAK,SAClBC,EAAWpf,KAAKof,SAAQ,QACxBC,EAAUrf,KAAKqf,QAAO,QACtBC,EAAUtf,KAAKsf,QAAO,SACtBC,GAAW,GACZpgB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACH,OAAO,IAAI4f,GAAa,CACtBE,QAASjf,KAAKif,QAAQ5J,QACtB6J,SAAUlf,KAAKkf,SACfC,QACAC,WACAC,UACAC,UACAC,YAEJ,CAYAkB,sBAAAA,CAAuB3K,EAAGC,GACxB,MAAMjD,EAAI,CAACgD,EAAGC,GAEd,OADAnE,GAAKiB,eAAeC,EAAG9S,KAAKsF,WACrBwN,CACT,CASA4N,0BAAAA,CAA2B/M,GACzB,MAAMgN,EAAU,CAAChN,EAAK,GAAIA,EAAK,IAC/B/B,GAAKiB,eAAe8N,EAAS3gB,KAAKsF,WAClC,MAAMsb,EAAc,CAACjN,EAAK,GAAIA,EAAK,IAEnC,OADA/B,GAAKiB,eAAe+N,EAAa5gB,KAAKsF,WAC/B,CAACqb,EAAQ,GAAIA,EAAQ,GAAIC,EAAY,GAAIA,EAAY,GAC9D,CAWAC,iBAAAA,CAAkB/K,EAAGC,GACnB,MAAMjD,EAAI,CAACgD,EAAGC,GAEd,OADAnE,GAAK6B,sBAAsBX,EAAG9S,KAAKsF,WAC5BwN,CACT,EAGF,MAAMgO,WAAoCzT,GACxCG,WAAAA,CAAY1C,GAAqB,IAAhBiW,EAAU5hB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAC5BwO,MAAM7C,EAAK,+BACX9K,KAAK+gB,WAAaA,CACpB,EAGF,SAASC,GAAazV,GACpB,MAAM0V,EAAK1V,EAAIlN,OACf,IAAIqQ,EAAI,EACR,KAAOA,EAAIuS,GAAwB,KAAlB1V,EAAImD,GAAGwS,QACtBxS,IAEF,MAAiD,UAA1CnD,EAAI4V,UAAUzS,EAAGA,EAAI,GAAG0S,aACjC,CAEA,SAASC,GAAUC,GACjB,MAA2B,kBAAbA,GAAyB,UAAUC,KAAKD,EACxD,CAyGA,MAAME,GAAUhU,WAAAA,IAAAqR,EAAAA,EAAAA,GAAA,eACJvgB,OAAOwa,OAAO,QAAK+F,EAAAA,EAAAA,GAAA,aAErB,GAAE,CAEV4C,IAAAA,CAAKlU,GACCA,KAAQvN,KAAK0hB,SACfzW,GAAK,gCAADD,OAAiCuC,IAEvCvN,KAAK0hB,QAAQnU,GAAQoU,KAAKC,KAC5B,CAEAC,OAAAA,CAAQtU,GACAA,KAAQvN,KAAK0hB,SACjBzW,GAAK,kCAADD,OAAmCuC,IAEzCvN,KAAK8hB,MAAM9S,KAAK,CACdzB,OACAwU,MAAO/hB,KAAK0hB,QAAQnU,GACpByU,IAAKL,KAAKC,eAGL5hB,KAAK0hB,QAAQnU,EACtB,CAEAmE,QAAAA,GAEE,MAAMuQ,EAAS,GACf,IAAIC,EAAU,EACd,IAAK,MAAM,KAAE3U,KAAUvN,KAAK8hB,MAC1BI,EAAUtT,KAAKiG,IAAItH,EAAKlP,OAAQ6jB,GAElC,IAAK,MAAM,KAAE3U,EAAI,MAAEwU,EAAK,IAAEC,KAAShiB,KAAK8hB,MACtCG,EAAOjT,KAAK,GAADhE,OAAIuC,EAAK4U,OAAOD,GAAQ,KAAAlX,OAAIgX,EAAMD,EAAK,SAEpD,OAAOE,EAAOhT,KAAK,GACrB,EAGF,SAASwO,GAAgBlS,EAAKC,GAI5B,MAAMmB,EAAMnB,EAAUY,IAAIC,MAAMd,EAAKC,GAAWY,IAAIC,MAAMd,GAE1D,MAAyB,WAAf,OAAHoB,QAAG,IAAHA,OAAG,EAAHA,EAAKL,WAA0C,YAAf,OAAHK,QAAG,IAAHA,OAAG,EAAHA,EAAKL,SAC3C,CAKA,SAAS8V,GAAclkB,GACrBA,EAAEmkB,gBACJ,CAEA,SAASC,GAAUpkB,GACjBA,EAAEmkB,iBACFnkB,EAAEqkB,iBACJ,CAQA,MAAMC,GAmBJ,mBAAOC,CAAaC,GAClB,GAAIA,aAAiBf,KACnB,OAAOe,EAET,IAAKA,GAA0B,kBAAVA,EACnB,OAAO,KAITxjB,EA5BEsjB,GA4BFxiB,KAAK2iB,IAAMC,IAAND,GAAMC,EAAA1jB,EA5BTsjB,GA4BFxiB,KAAgB,IAAI6iB,OAClB,8FAiBF,MAAMC,EAAU5jB,EA9CdsjB,GA8CcxiB,KAAK2iB,IAAMC,EAACG,KAAKL,GACjC,IAAKI,EACH,OAAO,KAKT,MAAME,EAAOC,SAASH,EAAQ,GAAI,IAClC,IAAII,EAAQD,SAASH,EAAQ,GAAI,IACjCI,EAAQA,GAAS,GAAKA,GAAS,GAAKA,EAAQ,EAAI,EAChD,IAAIC,EAAMF,SAASH,EAAQ,GAAI,IAC/BK,EAAMA,GAAO,GAAKA,GAAO,GAAKA,EAAM,EACpC,IAAIC,EAAOH,SAASH,EAAQ,GAAI,IAChCM,EAAOA,GAAQ,GAAKA,GAAQ,GAAKA,EAAO,EACxC,IAAIC,EAASJ,SAASH,EAAQ,GAAI,IAClCO,EAASA,GAAU,GAAKA,GAAU,GAAKA,EAAS,EAChD,IAAInO,EAAS+N,SAASH,EAAQ,GAAI,IAClC5N,EAASA,GAAU,GAAKA,GAAU,GAAKA,EAAS,EAChD,MAAMoO,EAAwBR,EAAQ,IAAM,IAC5C,IAAIS,EAAaN,SAASH,EAAQ,GAAI,IACtCS,EAAaA,GAAc,GAAKA,GAAc,GAAKA,EAAa,EAChE,IAAIC,EAAeP,SAASH,EAAQ,GAAI,KAAO,EAe/C,OAdAU,EAAeA,GAAgB,GAAKA,GAAgB,GAAKA,EAAe,EAM1C,MAA1BF,GACFF,GAAQG,EACRF,GAAUG,GACyB,MAA1BF,IACTF,GAAQG,EACRF,GAAUG,GAGL,IAAI7B,KAAKA,KAAK8B,IAAIT,EAAME,EAAOC,EAAKC,EAAMC,EAAQnO,GAC3D,EACF,IAAAyN,GAAA,CAAAC,OAAA,GAiBA,SAASc,GAAOC,GACd,GAAIA,EAAM/X,WAAW,KAAM,CACzB,MAAMgY,EAAWX,SAASU,EAAMtO,MAAM,GAAI,IAC1C,MAAO,EACO,SAAXuO,IAAwB,IACb,MAAXA,IAAwB,EACd,IAAXA,EAEJ,CAEA,OAAID,EAAM/X,WAAW,QAEZ+X,EACJtO,MAA0B,GAAI,GAC9BxI,MAAM,KACNgX,IAAI/N,GAAKmN,SAASnN,IAGnB6N,EAAM/X,WAAW,SACZ+X,EACJtO,MAA2B,GAAI,GAC/BxI,MAAM,KACNgX,IAAI/N,GAAKmN,SAASnN,IAClBT,MAAM,EAAG,IAGdpK,GAAK,8BAADD,OAA+B2Y,EAAK,MACjC,CAAC,EAAG,EAAG,GAChB,CAgBA,SAASG,GAAoBC,GAC3B,MAAM,EAAEhlB,EAAC,EAAEgT,EAAC,EAAEG,EAAC,EAAEC,EAAC,EAAEjU,EAAC,EAAEkU,GAAM2R,EAAIC,eACjC,MAAO,CAACjlB,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,EACzB,CAEA,SAAS6R,GAA2BF,GAClC,MAAM,EAAEhlB,EAAC,EAAEgT,EAAC,EAAEG,EAAC,EAAEC,EAAC,EAAEjU,EAAC,EAAEkU,GAAM2R,EAAIC,eAAeE,aAChD,MAAO,CAACnlB,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,EACzB,CAQA,SAAS+R,GACPhI,EACAE,GAGA,IAFA+H,EAAQjlB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACRklB,IAAUllB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAEV,GAAIkd,aAAoB0C,GAAc,CACpC,MAAM,UAAEqB,EAAS,WAAEC,GAAehE,EAAS6D,SACrC,MAAE7E,GAAUc,EACZmI,EAAWhV,GAAYyB,oBAEvBwT,EAAI,+BAAHvZ,OAAkCoV,EAAS,MAChDoE,EAAI,+BAAHxZ,OAAkCqV,EAAU,MACzCoE,EAAWH,EAAQ,eAAAtZ,OACJuZ,EAAC,mCAAAvZ,OACRuZ,EAAC,KACbG,EAAYJ,EAAQ,eAAAtZ,OACDwZ,EAAC,mCAAAxZ,OACRwZ,EAAC,KAEVJ,GAAY/H,EAAS+C,SAAW,MAAQ,GAI3C/D,EAAM2E,MAAQ0E,EACdrJ,EAAM4E,OAASwE,IAJfpJ,EAAM2E,MAAQyE,EACdpJ,EAAM4E,OAASyE,EAKnB,CAEIL,GACFlI,EAAI/B,aAAa,qBAAsBiC,EAAS+C,SAEpD,CAKA,MAAMuF,GACJnX,WAAAA,GACE,MAAM,WAAEoX,GAAeD,GAKvB3kB,KAAK6kB,GAAKD,EAKV5kB,KAAK8kB,GAAKF,CACZ,CAKA,UAAIG,GACF,OAAmB,IAAZ/kB,KAAK6kB,IAAwB,IAAZ7kB,KAAK8kB,EAC/B,CAMA,aAAIE,GACF,OAAOhlB,KAAK6kB,KAAO7kB,KAAK8kB,EAC1B,CAMAG,WAAAA,CAAYjF,EAAOC,EAAQiF,EAAWC,GAA4B,IAApBC,EAAajmB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,IAAI,EACzDkmB,EAAeC,IACjBC,EAAgBD,IAChBE,EAAiBF,KAEnBJ,EAAYP,GAAYc,UAAUP,EAAWE,IAC7B,IACdC,EAAezW,KAAKuG,KAAK+P,GAAalF,EAAQC,MAEhC,IAAZkF,IACFI,EAAgBJ,EAASnF,EACzBwF,EAAiBL,EAASlF,GAE5B,MAAMyF,EAAW9W,KAAKC,IAAIwW,EAAcE,EAAeC,GAEvD,OAAIxlB,KAAK6kB,GAAKa,GAAY1lB,KAAK8kB,GAAKY,KAClC1lB,KAAK6kB,GAAKa,EACV1lB,KAAK8kB,GAAKY,GACH,EAGX,CAEA,qBAAWd,GACT,OAAO1T,WAAWyU,kBAAoB,CACxC,CAEA,gBAAOF,CAAUP,EAAWE,GAC1B,GAAIA,GAAiB,EAAG,CACtB,MAAMQ,EAAYhX,KAAKiX,KAGjBC,OAAOC,OAAOC,WAAaF,OAAOC,OAAOE,YAC3CjmB,KAAK4kB,YAAc,GAClB,EAAIQ,EAAgB,MAEzB,OAAOF,EAAY,EAAItW,KAAKC,IAAIqW,EAAWU,GAAaA,CAC1D,CACA,OAAOV,CACT,EAKF,MAAMgB,GAA0B,CAC9B,aACA,aACA,YACA,YACA,aACA,YACA,gBACA,aACA,gBAGF,MAAMC,GACJ,qBAAWC,GAAa,IAAAC,EAAAC,EACtB,OAAOxZ,GACL9M,KACA,eACQ,QAAPqmB,EAACP,cAAM,IAAAO,GAAY,QAAZC,EAAND,EAAQE,kBAAU,IAAAD,IAAlBA,EAAAjV,KAAAgV,EAAqB,gCAAgCvD,SAE3D,EA2BF,SAAS0D,GAASC,EAAK7S,GACrB,MAAMxV,EAAIqoB,EAAI,GAAK,IACb3U,EAAI2U,EAAI,GAAK,IACb1U,EAAI0U,EAAI,GAAK,IAEb5R,EAAMjG,KAAKiG,IAAIzW,EAAG0T,EAAGC,GACrBlD,EAAMD,KAAKC,IAAIzQ,EAAG0T,EAAGC,GACrB2U,GAAK7R,EAAMhG,GAAO,EAExB,GAAIgG,IAAQhG,EAEV+E,EAAO,GAAKA,EAAO,GAAK,MACnB,CACL,MAAMzB,EAAI0C,EAAMhG,EAGhB,OAFA+E,EAAO,GAAK8S,EAAI,GAAMvU,GAAK0C,EAAMhG,GAAOsD,GAAK,EAAI0C,EAAMhG,GAE/CgG,GACN,KAAKzW,EACHwV,EAAO,GAAuC,KAAhC9B,EAAIC,GAAKI,GAAKL,EAAIC,EAAI,EAAI,IACxC,MACF,KAAKD,EACH8B,EAAO,GAAyB,KAAlB7B,EAAI3T,GAAK+T,EAAI,GAC3B,MACF,KAAKJ,EACH6B,EAAO,GAAyB,KAAlBxV,EAAI0T,GAAKK,EAAI,GAGjC,CACAyB,EAAO,GAAK8S,CACd,CAEA,SAASC,GAASC,EAAKhT,GACrB,MAAM4Q,EAAIoC,EAAI,GACRvnB,EAAIunB,EAAI,GACRF,EAAIE,EAAI,GACR1U,GAAK,EAAItD,KAAKmI,IAAI,EAAI2P,EAAI,IAAMrnB,EAChCyW,EAAI5D,GAAK,EAAItD,KAAKmI,IAAMyN,EAAI,GAAM,EAAK,IACvC7R,EAAI+T,EAAIxU,EAAI,EAElB,OAAQtD,KAAKiY,MAAMrC,EAAI,KACrB,KAAK,EACH5Q,EAAO,GAAK1B,EAAIS,EAChBiB,EAAO,GAAKkC,EAAInD,EAChBiB,EAAO,GAAKjB,EACZ,MACF,KAAK,EACHiB,EAAO,GAAKkC,EAAInD,EAChBiB,EAAO,GAAK1B,EAAIS,EAChBiB,EAAO,GAAKjB,EACZ,MACF,KAAK,EACHiB,EAAO,GAAKjB,EACZiB,EAAO,GAAK1B,EAAIS,EAChBiB,EAAO,GAAKkC,EAAInD,EAChB,MACF,KAAK,EACHiB,EAAO,GAAKjB,EACZiB,EAAO,GAAKkC,EAAInD,EAChBiB,EAAO,GAAK1B,EAAIS,EAChB,MACF,KAAK,EACHiB,EAAO,GAAKkC,EAAInD,EAChBiB,EAAO,GAAKjB,EACZiB,EAAO,GAAK1B,EAAIS,EAChB,MACF,KAAK,EACL,KAAK,EACHiB,EAAO,GAAK1B,EAAIS,EAChBiB,EAAO,GAAKjB,EACZiB,EAAO,GAAKkC,EAAInD,EAGtB,CAEA,SAASmU,GAAiBhR,GACxB,OAAOA,GAAK,OAAUA,EAAI,QAAUA,EAAI,MAAS,QAAU,GAC7D,CAEA,SAASiR,GAAcC,EAAMC,EAAMrT,GACjC+S,GAASK,EAAMpT,GACfA,EAAOiQ,IAAIiD,IACX,MAAMI,EAAO,MAAStT,EAAO,GAAK,MAASA,EAAO,GAAK,MAASA,EAAO,GACvE+S,GAASM,EAAMrT,GACfA,EAAOiQ,IAAIiD,IACX,MAAMK,EAAO,MAASvT,EAAO,GAAK,MAASA,EAAO,GAAK,MAASA,EAAO,GACvE,OAAOsT,EAAOC,GACTD,EAAO,MAASC,EAAO,MACvBA,EAAO,MAASD,EAAO,IAC9B,CAGA,MAAME,GAAgB,IAAIC,IA0E1B,SAASC,GAAcC,EAA2BC,GAAW,IAArC,KAAEhO,EAAI,IAAEiO,EAAG,UAAEC,GAAWH,EAC9C,MAAMI,EAAW5L,SAAS6L,yBAC1B,GAAoB,kBAATpO,EAAmB,CAC5B,MAAM1G,EAAIiJ,SAASC,cAAc,KACjClJ,EAAE2U,IAAMA,GAAO,OACf,MAAMI,EAAQrO,EAAK3M,MAAM,gBACzB,IAAK,IAAI6B,EAAI,EAAGuS,EAAK4G,EAAMxpB,OAAQqQ,EAAIuS,IAAMvS,EAAG,CAC9C,MAAMoZ,EAAOD,EAAMnZ,GACnBoE,EAAEsJ,OAAOL,SAASQ,eAAeuL,IAC7BpZ,EAAIuS,EAAK,GACXnO,EAAEsJ,OAAOL,SAASC,cAAc,MAEpC,CACA2L,EAASvL,OAAOtJ,EAClB,MACEwG,GAASmC,OAAO,CACdI,QAASrC,EACT2C,IAAKwL,EACL/N,OAAQ,aAGZ+N,EAASI,kBAAkBC,UAAUhpB,IAAI,WAAY0oB,GACrDF,EAAUpL,OAAOuL,EACnB,CAEA,SAASM,GAAoBC,GAE3B,MAAMC,EAAO,IAAIC,OACjB,IAAKF,EACH,OAAOC,EAET,IAAK,IAAIzZ,EAAI,EAAGuS,EAAKiH,EAAK7pB,OAAQqQ,EAAIuS,GACpC,OAAQiH,EAAKxZ,MACX,KAAKpE,GACH6d,EAAK5iB,OAAO2iB,EAAKxZ,KAAMwZ,EAAKxZ,MAC5B,MACF,KAAKpE,GACH6d,EAAK3iB,OAAO0iB,EAAKxZ,KAAMwZ,EAAKxZ,MAC5B,MACF,KAAKpE,GACH6d,EAAKE,cACHH,EAAKxZ,KACLwZ,EAAKxZ,KACLwZ,EAAKxZ,KACLwZ,EAAKxZ,KACLwZ,EAAKxZ,KACLwZ,EAAKxZ,MAEP,MACF,KAAKpE,GACH6d,EAAKG,iBAAiBJ,EAAKxZ,KAAMwZ,EAAKxZ,KAAMwZ,EAAKxZ,KAAMwZ,EAAKxZ,MAC5D,MACF,KAAKpE,GACH6d,EAAKviB,YACL,MACF,QACEqF,GAAK,uCAADD,OAAwCkd,EAAKxZ,EAAI,KAI3D,OAAOyZ,CACT,C,2ICz/BA,MAAMI,GAmBJ/a,WAAAA,CAAYgb,GAAQ1pB,EAAA,KAAA2pB,IAlBpBxpB,EAAA,KAAAypB,GAAW,MAEXzpB,EAAA,KAAA0pB,GAAe,MAEf1pB,EAAA,KAAA2pB,QAAO,GAEP3pB,EAAA,KAAA4pB,GAAW,MAEX5pB,EAAA,KAAA6pB,GAAW,MAEX7pB,EAAA,KAAA8pB,GAAW,MAEX9pB,EAAA,KAAA+pB,GAAwB,MAExB/pB,EAAA,KAAAgqB,GAA8B,MAK5BC,EAAKN,GAAL5oB,KAAewoB,GAEDW,GAAWvG,IAAXuG,GAAWvG,EAAKtkB,OAAO8qB,OAAO,CAC1CC,SAAU,sCACVC,UAAW,uCACXC,IAAK,iCACLC,MAAO,mCACPC,UAAW,yCAEf,CAEAhO,MAAAA,GACE,MAAMiO,EAAeR,EAAKR,GAAL1oB,KAAgB+b,SAASC,cAAc,QAC5D0N,EAAY1B,UAAUhpB,IAAI,cAAe,UACzC0qB,EAAYtP,aAAa,OAAQ,WAEjC,MAAMuP,EAASC,EAAKhB,GAAL5oB,MAAa6pB,WAAWC,QACnCH,aAAkBI,cAAgBJ,EAAOK,UAC3CN,EAAY3P,iBAAiB,cAAeqI,GAAe,CAAEuH,WAC7DD,EAAY3P,iBAAiB,cAAekQ,GAA4B,CACtEN,YAIJ,MAAMO,EAAWhB,EAAKL,GAAL7oB,KAAgB+b,SAASC,cAAc,QACxDkO,EAAQxC,UAAY,UACpBgC,EAAYtN,OAAO8N,GAEnB,MAAMC,EAAWP,EAAKhB,GAAL5oB,MAAaoqB,gBAC9B,GAAID,EAAU,CACZ,MAAM,MAAE9O,GAAUqO,EACZ5T,EACkC,QAAtC8T,EAAKhB,GAAL5oB,MAAa6pB,WAAWQ,UACpB,EAAIF,EAAS,GACbA,EAAS,GACf9O,EAAMiP,eAAiB,GAAHtf,OAAM,IAAM8K,EAAC,KACjCuF,EAAMkP,IAAM,QAAHvf,OACP,IAAMmf,EAAS,GAAE,yCAErB,CAEA,OAAOT,CACT,CAEA,OAAIvN,GACF,OAAOyN,EAAKlB,GAAL1oB,KACT,CAoCAwqB,IAAAA,GAAO,IAAAC,EACLb,EAAKlB,GAAL1oB,MAAcgoB,UAAUhpB,IAAI,UACX,QAAjByrB,EAAAb,EAAKjB,GAAL3oB,aAAiB,IAAAyqB,GAAjBA,EAAmBC,cACrB,CAEAC,IAAAA,GAAO,IAAAC,EAAAC,EACLjB,EAAKlB,GAAL1oB,MAAcgoB,UAAU8C,OAAO,UAClB,QAAbF,EAAAhB,EAAKd,GAAL9oB,aAAa,IAAA4qB,GAAbA,EAAeG,QACF,QAAbF,EAAAjB,EAAKb,GAAL/oB,aAAa,IAAA6qB,GAAbA,EAAeE,OACjB,CAEAC,eAAAA,GACE,MAAM,WAAEC,EAAU,WAAEpB,GAAeD,EAAKhB,GAAL5oB,MAE7BkrB,EAASnP,SAASC,cAAc,UACtCkP,EAAOlD,UAAUhpB,IAAI,QAAS,gBAC9BksB,EAAOC,SAAW,EAClBD,EAAO9Q,aAAa,eAA8B+O,GAAWvG,EAACqI,IAC1D/rB,EAAAupB,GAAAzoB,KAAKorB,IAAsB/Z,KAA3BrR,KAA4BkrB,IAC9BA,EAAOnR,iBACL,QACA7b,IACE2rB,EAAWwB,UAEb,CAAE1B,OAAQE,EAAWC,UAGzBF,EAAKf,GAAL7oB,MAAcoc,OAAO8O,EACvB,CAQA,gBAAMI,CAAWC,GACf,MAAML,QAAeK,EAAQ9P,SAC7Bvc,EAAAupB,GAAAzoB,KAAKorB,IAAsB/Z,KAA3BrR,KAA4BkrB,GAC5BtB,EAAKf,GAAL7oB,MAAcoc,OAAO8O,EAAQ9rB,EAAAqpB,GAAAzoB,KAAKwrB,KAClCtC,EAAKJ,GAAL9oB,KAAgBurB,EAClB,CAEAE,UAAAA,CAAWC,GAA+B,IAAtBC,EAAaxsB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAClC,GAAIyqB,EAAKb,GAAL/oB,MACF,OAEF,MAAMkrB,EAASQ,EAAQE,mBACvB,IAAKV,EACH,OAEFhsB,EAAAupB,GAAAzoB,KAAKorB,IAAsB/Z,KAA3BrR,KAA4BkrB,GAC5B,MAAMW,EAAW3C,EAAKF,GAALhpB,KAA6BZ,EAAAqpB,GAAAzoB,KAAKwrB,KAC9CG,GAGH/B,EAAKf,GAAL7oB,MAAc8rB,aAAaZ,EAAQS,GACnC/B,EAAKf,GAAL7oB,MAAc8rB,aAAaD,EAASF,IAHpC/B,EAAKf,GAAL7oB,MAAcoc,OAAO8O,EAAQW,GAK/B3C,EAAKH,GAAL/oB,KAAgB0rB,GAChBA,EAAQK,QAAU/rB,IACpB,CAEAgsB,cAAAA,CAAeC,GACb,GAAIrC,EAAKjB,GAAL3oB,MACF,OAEFkpB,EAAKP,GAAL3oB,KAAoBisB,GACpB,MAAMf,EAASe,EAAYC,eAC3BhtB,EAAAupB,GAAAzoB,KAAKorB,IAAsB/Z,KAA3BrR,KAA4BkrB,GAC5BtB,EAAKf,GAAL7oB,MAAcoc,OAAO8O,EAAQ9rB,EAAAqpB,GAAAzoB,KAAKwrB,IACpC,CAEA,4BAAMW,CAAuBC,GAC3B,MAAMlB,EAAUhC,EAAKD,GAALjpB,WACRosB,EAAiBC,iBAAiBzC,EAAKhB,GAAL5oB,QAC1Cd,EAAAupB,GAAAzoB,KAAKorB,IAAsB/Z,KAA3BrR,KAA4BkrB,GAC5BtB,EAAKf,GAAL7oB,MAAcoc,OAAO8O,EAAQ9rB,EAAAqpB,GAAAzoB,KAAKwrB,IACpC,CAEAc,YAAAA,CAAa/e,GAAM,IAAAgf,EAAAC,EACjB,GACO,YADCjf,EAES,QAAbgf,EAAA3C,EAAKb,GAAL/oB,aAAa,IAAAusB,GAAbA,EAAeE,6BACfvD,EAAKH,GAAL/oB,KAAgB,MACU,QAA1BwsB,EAAA5C,EAAKZ,GAALhpB,aAA0B,IAAAwsB,GAA1BA,EAA4B1B,SAC5B5B,EAAKF,GAALhpB,KAA6B,KAGnC,CAEA,eAAM0sB,CAAUnf,EAAMof,GACpB,OAAQpf,GACN,IAAK,cACCof,GACF3sB,KAAKgsB,eAAeW,GAEtB,MACF,IAAK,UACCA,SACI3sB,KAAKsrB,WAAWqB,GAExB,MACF,IAAK,gBACCA,SACI3sB,KAAKmsB,uBAAuBQ,GAEpC,MACF,IAAK,SACH3sB,KAAKgrB,kBACL,MACF,IAAK,UACC2B,GACF3sB,KAAKyrB,WAAWkB,GAIxB,CAEA,qBAAMC,CAAgBrf,EAAMof,EAAME,GAChC,IAAKF,GAAiB,YAATpf,EACX,OAEF,MAAMoe,EAAgB/B,EAAKf,GAAL7oB,MAAc8sB,cAAcD,GAC7ClB,GAGQ,YAATpe,GACFvN,KAAKyrB,WAAWkB,EAAMhB,EAE1B,CAEAoB,yBAAAA,CAA0BC,GACpBpD,EAAKX,GAALjpB,QACF4pB,EAAKX,GAALjpB,MAAiCitB,MAAQD,EAE7C,CAEAlC,MAAAA,GAAS,IAAAoC,EACPtD,EAAKlB,GAAL1oB,MAAc8qB,SACG,QAAjBoC,EAAAtD,EAAKjB,GAAL3oB,aAAiB,IAAAktB,GAAjBA,EAAmBC,UACnBjE,EAAKP,GAAL3oB,KAAoB,KACtB,EACF,SAAAiqB,GAjLsB/rB,GAClBA,EAAEqkB,iBACJ,UAAA6K,GAESlvB,GACP0rB,EAAKhB,GAAL5oB,MAAaqtB,qBAAsB,EACnC/K,GAAUpkB,EACZ,UAAAovB,GAEUpvB,GACR0rB,EAAKhB,GAAL5oB,MAAaqtB,qBAAsB,EACnC/K,GAAUpkB,EACZ,UAAAktB,GAEuB1R,GAIrB,MAAMiQ,EAASC,EAAKhB,GAAL5oB,MAAa6pB,WAAWC,QACvC,OAAMH,aAAkBI,cAAgBJ,EAAOK,UAG/CtQ,EAAQK,iBAAiB,UAAW7a,EAAAupB,GAAAzoB,KAAKotB,IAASG,KAAKvtB,MAAO,CAC5DwtB,SAAS,EACT7D,WAEFjQ,EAAQK,iBAAiB,WAAY7a,EAAAupB,GAAAzoB,KAAKstB,IAAUC,KAAKvtB,MAAO,CAC9DwtB,SAAS,EACT7D,WAEFjQ,EAAQK,iBAAiB,cAAeqI,GAAe,CAAEuH,YAClD,EACT,UAAA6B,GAAAiC,GAiCE,MAAM5B,EAAU9P,SAASC,cAAc,OAEvC,OADA6P,EAAQnE,UAAY,UACbmE,CACT,KAAA1C,GAAA,CAAAvG,EAvHqB,MAAI8K,GAAA,IAAAC,QAAAC,GAAA,IAAAD,QAAAE,GAAA,IAAAF,QAAAG,GAAA,IAAAC,QAsO3B,MAAMC,GAOJxgB,WAAAA,CAAYygB,GAAWnvB,EAAA,KAAAgvB,IANvB7uB,EAAA,KAAAyuB,GAAW,MAEXzuB,EAAA,KAAA2uB,GAAW,MAEX3uB,EAAA,KAAA4uB,QAAU,GAGR3E,EAAK2E,GAAL7tB,KAAkBiuB,EACpB,CAkEAtD,IAAAA,CAAKhO,EAAQuR,EAAOC,GAClB,MAAOrY,EAAGC,GAAK7W,EAAA4uB,GAAA9tB,KAAKouB,IAAa/c,KAAlBrR,KAAmBkuB,EAAOC,IACnC,MAAE9S,GAAWuO,EAAKgE,GAAL5tB,OAAAkpB,EAAK0E,GAAL5tB,KAAkBd,EAAA4uB,GAAA9tB,KAAKquB,IAAOhd,KAAZrR,OACrC2c,EAAOP,OAAOwN,EAAKgE,GAAL5tB,OACdqb,EAAMiP,eAAiB,GAAHtf,OAAM,IAAM8K,EAAC,KACjCuF,EAAMkP,IAAM,QAAHvf,OAAW,IAAM+K,EAAC,yCAC7B,CAEAyU,IAAAA,GACEZ,EAAKgE,GAAL5tB,MAAc8qB,QAChB,EAkBF,SAAAuD,KA3FI,MAAM3E,EAAeR,EAAK0E,GAAL5tB,KAAgB+b,SAASC,cAAc,QAC5D0N,EAAYhC,UAAY,cACxBgC,EAAYtP,aAAa,OAAQ,WAEjC,MAAMuP,EAASC,EAAKiE,GAAL7tB,MAAgB8pB,QAC3BH,aAAkBI,cAAgBJ,EAAOK,SAC3CN,EAAY3P,iBAAiB,cAAeqI,GAAe,CACzDuH,WAIJ,MAAMO,EAAWhB,EAAKwE,GAAL1tB,KAAgB+b,SAASC,cAAc,QAwBxD,OAvBAkO,EAAQxC,UAAY,UACpBgC,EAAYtN,OAAO8N,GAEfN,EAAKiE,GAAL7tB,MAAgBsuB,qBAClBpvB,EAAA4uB,GAAA9tB,KAAKuuB,IAAWld,KAAhBrR,KACE,gBAAe,gCAEf,sCACA,KACE4pB,EAAKiE,GAAL7tB,MAAgBwuB,iBAAiB,qBAKvCtvB,EAAA4uB,GAAA9tB,KAAKuuB,IAAWld,KAAhBrR,KACE,kBAAiB,mCAEjB,wCACA,KACE4pB,EAAKiE,GAAL7tB,MAAgByuB,mBAAmB,qBAIhC/E,CACT,UAAA0E,GAEcF,EAAOC,GACnB,IAAIO,EAAQ,EACRC,EAAQ,EACZ,IAAK,MAAMC,KAAOV,EAAO,CACvB,MAAMnY,EAAI6Y,EAAI7Y,EAAI6Y,EAAI3O,OACtB,GAAIlK,EAAI2Y,EACN,SAEF,MAAM5Y,EAAI8Y,EAAI9Y,GAAKqY,EAAQS,EAAI5O,MAAQ,GACnCjK,EAAI2Y,GACNC,EAAQ7Y,EACR4Y,EAAQ3Y,GAGNoY,EACErY,EAAI6Y,IACNA,EAAQ7Y,GAEDA,EAAI6Y,IACbA,EAAQ7Y,EAEZ,CACA,MAAO,CAACqY,EAAQ,EAAIQ,EAAQA,EAAOD,EACrC,UAAAH,GAcYM,EAAaC,EAAQC,EAAaC,GAC5C,MAAM9D,EAASnP,SAASC,cAAc,UACtCkP,EAAOlD,UAAUhpB,IAAI,QAAS6vB,GAC9B3D,EAAOC,SAAW,EAClBD,EAAO9Q,aAAa,eAAgB0U,GACpC,MAAMG,EAAOlT,SAASC,cAAc,QACpCkP,EAAO9O,OAAO6S,GACdA,EAAKvH,UAAY,iBACjBuH,EAAK7U,aAAa,eAAgB2U,GAClC,MAAMpF,EAASC,EAAKiE,GAAL7tB,MAAgB8pB,QAC3BH,aAAkBI,cAAgBJ,EAAOK,UAC3CkB,EAAOnR,iBAAiB,cAAeqI,GAAe,CAAEuH,WACxDuB,EAAOnR,iBAAiB,QAASiV,EAAc,CAAErF,YAEnDC,EAAK8D,GAAL1tB,MAAcoc,OAAO8O,EACvB,CCxUF,SAASgE,GAAWniB,EAAK2M,EAASyV,GAChC,IAAK,MAAM5hB,KAAQ4hB,EACjBzV,EAAQK,iBAAiBxM,EAAMR,EAAIQ,GAAMggB,KAAKxgB,GAElD,CAMA,MAAMqiB,GAeJ,gCAAOC,CAA0BC,IAEdC,GAAW3M,IAAX2M,GAAW3M,EAAK,IAAI4M,MAAOxwB,IAAIswB,EAClD,CAEA,iBAAOG,CAAWC,EAAaJ,GAAW,IAAAK,EACxBC,GAAUhN,IAAVgN,GAAUhN,EAAK0M,GACH,QAA5BK,EAAgBE,GAAYjN,SAAA,IAAA+M,IAAZE,GAAYjN,EAAK8M,EACnC,CAEA,mBAAOI,CAAaC,GACFC,GAAcpN,EAAGmN,CACnC,CAEA,sBAAOE,CAAgBX,GACrB,OAAuBM,GAAUhN,IAAK0M,CACxC,CAGA,8BAAOY,CAAwBZ,GAAW,IAAAa,EACxC,OAAoBP,GAAUhN,IAAK0M,IAIR,QAA3Ba,EAAgBZ,GAAW3M,SAAA,IAAAuN,GAA3BA,EAA6B9E,OAAOiE,IAC7B,EACT,CAEA,wBAAOc,CAAkBV,GACvB,OAAuBG,GAAYjN,IAAK8M,CAC1C,CAEA,2CAAOW,CAAqCX,GAC1C,OACmC,OAAjBG,GAAYjN,IAC3BwM,GAAgBgB,kBAAkBV,EAEvC,CAEA,sBAAOY,CAAgBP,GACrB,OAAuBC,GAAcpN,IAAKmN,CAC5C,CAEA,8BAAOQ,GAA0B,IAAAC,EAE/B,OAAkC,QAA3BA,EAAgBjB,GAAW3M,SAAA,IAAA4N,OAAA,EAA3BA,EAA6BC,OAAQ,CAC9C,CAEA,uBAAOC,GACWb,GAAYjN,EAAG,IACjC,CAEA,sBAAO+N,GACWf,GAAUhN,EAAGgO,IACbrB,GAAW3M,EAAG,IAChC,CAEA,qBAAOiO,GACWb,GAAcpN,EAAGgO,GACnC,EACF,IAAAhB,GAAA,CAAAhN,EAtEsBgO,KAAGrB,GAAA,CAAA3M,EAEF,MAAIoN,GAAA,CAAApN,EAGDgO,KAAGf,GAAA,CAAAjN,EAGL,MAAIkO,GAAA,IAAAnD,QAmE5B,MAAMoD,GAAUvjB,WAAAA,GACdvO,EAAA,KAAA6xB,GAAM,EAAC,CAiBP,MAAIrX,GAAK,IAAAuX,EAAAC,EACP,MAAO,GAAPjmB,OAAU/J,GAAsB+J,QAAGke,EAAK4H,GAAL9wB,MAAIgxB,EAAJpH,EAAKkH,GAAL9wB,MAAQixB,EAAAD,IAAAA,IAAAC,GAC7C,EACF,IAAAC,GAAA,IAAAvD,QAAAwD,GAAA,IAAAxD,QAAAyD,GAAA,IAAAzD,QAAA0D,GAAA,IAAAtD,QAUA,MAAMuD,GAAa9jB,WAAAA,GAAA1O,EAAA,KAAAuyB,IACjBpyB,EAAA,KAAAiyB,GAAU7Z,MAEVpY,EAAA,KAAAkyB,GAAM,GAENlyB,EAAA,KAAAmyB,GAAS,KAAI,CAEb,8BAAWG,GAMT,MAEMxN,EADS,IAAIhU,gBAAgB,EAAG,GACnByhB,WAAW,KAAM,CAAEC,oBAAoB,IACpDC,EAAQ,IAAIC,MAClBD,EAAME,IAJM,uKAUZ,OAAO9kB,GAAO9M,KAAM,sBALJ0xB,EAAMG,SAAS9xB,KAAK,KAClCgkB,EAAI+N,UAAUJ,EAAO,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC8B,IAAjE,IAAIjiB,YAAYsU,EAAIgO,aAAa,EAAG,EAAG,EAAG,GAAG7J,KAAKxY,QAAQ,KAIrE,CAqEA,iBAAMsiB,CAAYC,GAChB,MAAM,aAAEC,EAAY,KAAE3kB,EAAI,KAAEkjB,EAAI,KAAEjwB,GAASyxB,EAC3C,OAAO/yB,EAAAmyB,GAAArxB,KAAKmyB,IAAI9gB,KAATrR,KAAI,GAAAgL,OAASknB,EAAY,KAAAlnB,OAAIuC,EAAI,KAAAvC,OAAIylB,EAAI,KAAAzlB,OAAIxK,GAAQyxB,EAC9D,CAEA,gBAAMG,CAAW7mB,GACf,OAAOrM,EAAAmyB,GAAArxB,KAAKmyB,IAAI9gB,KAATrR,KAAUuL,EAAKA,EACxB,CAEA,iBAAM8mB,CAAY5Y,EAAI6Y,GACpB,MAAMtU,QAAasU,EACnB,OAAOpzB,EAAAmyB,GAAArxB,KAAKmyB,IAAI9gB,KAATrR,KAAUyZ,EAAIuE,EACvB,CAEA,eAAMuU,CAAU9Y,GACdmQ,EAAKwH,GAALpxB,OAAAkpB,EAAKkI,GAALpxB,KAAgB,IAAIqnB,KACpB,MAAMa,EAAO0B,EAAKwH,GAALpxB,MAAYV,IAAIma,GAC7B,IAAKyO,EACH,OAAO,KAET,GAAIA,EAAKsK,OAEP,OADAtK,EAAKuK,YAAc,EACZvK,EAGT,GAAIA,EAAK+J,KACP,OAAOjyB,KAAKgyB,YAAY9J,EAAK+J,MAE/B,GAAI/J,EAAKoK,YAAa,CACpB,MAAM,YAAEA,GAAgBpK,EAExB,cADOA,EAAKoK,YACLtyB,KAAKqyB,YAAYnK,EAAKzO,GAAI6Y,EACnC,CACA,OAAOtyB,KAAKoyB,WAAWlK,EAAK3c,IAC9B,CAEAmnB,aAAAA,CAAcjZ,EAAIkZ,GAAQ,IAAAC,EAAAC,EAAAC,EACxBlJ,EAAKwH,GAALpxB,OAAAkpB,EAAKkI,GAALpxB,KAAgB,IAAIqnB,KACpB,IAAIa,EAAO0B,EAAKwH,GAALpxB,MAAYV,IAAIma,GAC3B,GAAQ,QAARqZ,EAAI5K,SAAI,IAAA4K,GAAJA,EAAMN,OAER,OADAtK,EAAKuK,YAAc,EACZvK,EAET,MAAM6K,EAAY,IAAIhjB,gBAAgB4iB,EAAO3S,MAAO2S,EAAO1S,QAW3D,OAVY8S,EAAUvB,WAAW,MAC7BM,UAAUa,EAAQ,EAAG,GACzBzK,EAAO,CACLsK,OAAQO,EAAUC,wBAClBvZ,GAAI,SAAFzO,OAAW4e,EAAKsH,GAALlxB,MAAY,KAAAgL,QAAIke,EAAKiI,GAALnxB,MAAI4yB,EAAJhJ,EAAKuH,GAALnxB,MAAQ6yB,EAAAD,IAAAA,IAAAC,IACrCJ,WAAY,EACZQ,OAAO,GAETrJ,EAAKwH,GAALpxB,MAAYxB,IAAIib,EAAIyO,GACpB0B,EAAKwH,GAALpxB,MAAYxB,IAAI0pB,EAAKzO,GAAIyO,GAClBA,CACT,CAEAgL,SAAAA,CAAUzZ,GACR,MAAMyO,EAAO0B,EAAKwH,GAALpxB,MAAYV,IAAIma,GAC7B,OAAS,OAAJyO,QAAI,IAAJA,GAAAA,EAAM+K,MAGJ/K,EAAKiL,OAFH,IAGX,CAEAC,QAAAA,CAAS3Z,GAAI,IAAA4Z,EACXzJ,EAAKwH,GAALpxB,OAAAkpB,EAAKkI,GAALpxB,KAAgB,IAAIqnB,KACpB,MAAMa,EAAO0B,EAAKwH,GAALpxB,MAAYV,IAAIma,GAC7B,IAAKyO,EACH,OAGF,GADAA,EAAKuK,YAAc,EACK,IAApBvK,EAAKuK,WACP,OAEF,MAAM,OAAED,GAAWtK,EACnB,IAAKA,EAAK3c,MAAQ2c,EAAK+J,KAAM,CAE3B,MAAMU,EAAS,IAAI5iB,gBAAgByiB,EAAOxS,MAAOwS,EAAOvS,QAC5C0S,EAAOnB,WAAW,kBAC1B8B,wBAAwBd,GAC5BtK,EAAKoK,YAAcK,EAAOY,eAC5B,CAEY,QAAZF,EAAAb,EAAOgB,aAAK,IAAAH,GAAZA,EAAAhiB,KAAAmhB,GACAtK,EAAKsK,OAAS,IAChB,CAMAiB,SAAAA,CAAUha,GACR,OAAOA,EAAG7N,WAAW,SAADZ,OAAU4e,EAAKsH,GAALlxB,MAAY,KAC5C,EA3LgB,eAAAmyB,GA0BLjX,EAAKwY,GAAS,IAAAC,EACvB/J,EAAKwH,GAALpxB,OAAAkpB,EAAKkI,GAALpxB,KAAgB,IAAIqnB,KACpB,IAAIa,EAAO0B,EAAKwH,GAALpxB,MAAYV,IAAI4b,GAC3B,GAAa,OAATgN,EAEF,OAAO,KAET,GAAQ,QAARyL,EAAIzL,SAAI,IAAAyL,GAAJA,EAAMnB,OAER,OADAtK,EAAKuK,YAAc,EACZvK,EAET,IAAI,IAAA0L,EAAAC,EAOF,IAAInC,EAUJ,GAhBAxJ,IAAAA,EAAS,CACPsK,OAAQ,KACR/Y,GAAI,SAAFzO,OAAW4e,EAAKsH,GAALlxB,MAAY,KAAAgL,QAAIke,EAAKiI,GAALnxB,MAAI4zB,EAAJhK,EAAKuH,GAALnxB,MAAQ6zB,EAAAD,IAAAA,IAAAC,IACrCpB,WAAY,EACZQ,OAAO,IAGc,kBAAZS,GACTxL,EAAK3c,IAAMmoB,EACXhC,QAAclU,GAAUkW,EAAS,SACxBA,aAAmBI,KAC5BpC,EAAQxJ,EAAK+J,KAAOyB,EACXA,aAAmBK,OAC5BrC,EAAQgC,GAGS,kBAAfhC,EAAMlxB,KAA0B,CAGlC,MAAMwzB,EAA+B1C,EAAaC,oBAC5C0C,EAAa,IAAIC,WACjBC,EAAe,IAAIxC,MACnByC,EAAe,IAAI10B,QAAQ,CAACG,EAASF,KACzCw0B,EAAaE,OAAS,KACpBnM,EAAKsK,OAAS2B,EACdjM,EAAK+K,OAAQ,EACbpzB,KAEFo0B,EAAWI,OAAS9W,UAClB,MAAMhS,EAAO2c,EAAKiL,OAASc,EAAWK,OAGtCH,EAAavC,UAAaoC,EAA4B,GAAAhpB,OAC/CO,EAAG,uCACNA,GAEN4oB,EAAaI,QAAUN,EAAWM,QAAU50B,IAE9Cs0B,EAAWO,cAAc9C,SACnB0C,CACR,MACElM,EAAKsK,aAAeiC,kBAAkB/C,GAExCxJ,EAAKuK,WAAa,CACpB,CAAE,MAAOv0B,GACP+M,GAAK/M,GACLgqB,EAAO,IACT,CAKA,OAJA0B,EAAKwH,GAALpxB,MAAYxB,IAAI0c,EAAKgN,GACjBA,GACF0B,EAAKwH,GAALpxB,MAAYxB,IAAI0pB,EAAKzO,GAAIyO,GAEpBA,CACT,CAiGFwM,EA5LMpD,GA2FJ,IAAAqD,GAAA,IAAAhH,QAAAiH,GAAA,IAAAjH,QAAAkH,GAAA,IAAAlH,QAAAmH,GAAA,IAAAnH,QAyGF,MAAMoH,GASJvnB,WAAAA,GAA2B,IAAfwnB,EAAO71B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,IARtBF,EAAA,KAAA01B,GAAY,IAEZ11B,EAAA,KAAA21B,IAAU,GAEV31B,EAAA,KAAA41B,QAAQ,GAER51B,EAAA,KAAA61B,IAAa,GAGX5L,EAAK2L,GAAL70B,KAAgBg1B,EAClB,CAiBAh2B,GAAAA,CAAGi2B,GAQA,IARC,IACFC,EAAG,KACHC,EAAI,KACJC,EAAI,SACJC,EAAQ,KACR70B,EAAOowB,IAAG,oBACV0E,GAAsB,EAAK,SAC3BC,GAAW,GACZN,EAKC,GAJII,GACFH,IAGEtL,EAAKgL,GAAL50B,MACF,OAGF,MAAMoF,EAAO,CAAE8vB,MAAKC,OAAMC,OAAM50B,QAChC,IAAwB,IAApBopB,EAAKkL,GAAL90B,MAQF,OAPI4pB,EAAK+K,GAAL30B,MAAe3B,OAAS,IAG1BurB,EAAK+K,GAAL30B,MAAe3B,OAAS,GAE1B6qB,EAAK4L,GAAL90B,KAAiB,QACjB4pB,EAAK+K,GAAL30B,MAAegP,KAAK5J,GAItB,GAAIkwB,GAAuB1L,EAAK+K,GAAL30B,MAAe4pB,EAAKkL,GAAL90B,OAAgBQ,OAASA,EAQjE,OAJI+0B,IACFnwB,EAAK+vB,KAAOvL,EAAK+K,GAAL30B,MAAe4pB,EAAKkL,GAAL90B,OAAgBm1B,WAE7CvL,EAAK+K,GAAL30B,MAAe4pB,EAAKkL,GAAL90B,OAAkBoF,GAInC,MAAMnF,EAAO2pB,EAAKkL,GAAL90B,MAAiB,EAC1BC,IAAS2pB,EAAKiL,GAAL70B,MACX4pB,EAAK+K,GAAL30B,MAAew1B,OAAO,EAAG,IAEzBtM,EAAK4L,GAAL90B,KAAiBC,GACbA,EAAO2pB,EAAK+K,GAAL30B,MAAe3B,QACxBurB,EAAK+K,GAAL30B,MAAew1B,OAAOv1B,IAI1B2pB,EAAK+K,GAAL30B,MAAegP,KAAK5J,EACtB,CAKA+vB,IAAAA,GACE,IAAwB,IAApBvL,EAAKkL,GAAL90B,MAEF,OAIFkpB,EAAK0L,GAAL50B,MAAe,GACf,MAAM,KAAEm1B,EAAI,KAAEC,GAASxL,EAAK+K,GAAL30B,MAAe4pB,EAAKkL,GAAL90B,OACtCm1B,IACI,OAAJC,QAAI,IAAJA,GAAAA,IACAlM,EAAK0L,GAAL50B,MAAe,GAEfkpB,EAAK4L,GAAL90B,KAAA4pB,EAAKkL,GAAL90B,MAAkB,EACpB,CAKAy1B,IAAAA,GACE,GAAI7L,EAAKkL,GAAL90B,MAAiB4pB,EAAK+K,GAAL30B,MAAe3B,OAAS,EAAG,CAC9C6qB,EAAK4L,GAAL90B,KAAA4pB,EAAKkL,GAAL90B,MAAkB,GAGlBkpB,EAAK0L,GAAL50B,MAAe,GACf,MAAM,IAAEk1B,EAAG,KAAEE,GAASxL,EAAK+K,GAAL30B,MAAe4pB,EAAKkL,GAAL90B,OACrCk1B,IACI,OAAJE,QAAI,IAAJA,GAAAA,IACAlM,EAAK0L,GAAL50B,MAAe,EACjB,CACF,CAMA01B,kBAAAA,GACE,OAA2B,IAApB9L,EAAKkL,GAAL90B,KACT,CAMA21B,kBAAAA,GACE,OAAO/L,EAAKkL,GAAL90B,MAAiB4pB,EAAK+K,GAAL30B,MAAe3B,OAAS,CAClD,CAEAu3B,SAAAA,CAAUp1B,GACR,IAAwB,IAApBopB,EAAKkL,GAAL90B,MAAJ,CAGA,IAAK,IAAI0O,EAAIkb,EAAKkL,GAAL90B,MAAgB0O,GAAK,EAAGA,IACnC,GAAIkb,EAAK+K,GAAL30B,MAAe0O,GAAGlO,OAASA,EAG7B,OAFAopB,EAAK+K,GAAL30B,MAAew1B,OAAO9mB,EAAI,EAAGkb,EAAKkL,GAAL90B,MAAiB0O,QAC9Cwa,EAAK4L,GAAL90B,KAAiB0O,GAIrBkb,EAAK+K,GAAL30B,MAAe3B,OAAS,EACxB6qB,EAAK4L,GAAL90B,MAAkB,EATlB,CAUF,CAEAmtB,OAAAA,GACEjE,EAAKyL,GAAL30B,KAAiB,KACnB,EACF,IAAA61B,GAAA,IAAA9H,QAMA,MAAM+H,GAOJtoB,WAAAA,CAAYuoB,GAAWj3B,EAAA,KAAA+2B,IACrB71B,KAAK0P,OAAS,GACd1P,KAAK+1B,UAAY,IAAI1O,IACrBrnB,KAAKg2B,QAAU,IAAIxG,IAEnB,MAAM,MAAE5e,GAAUtB,GAAYgB,SAC9B,IAAK,MAAOmB,EAAMwkB,EAAUvqB,EAAU,CAAC,KAAMqqB,EAC3C,IAAK,MAAM7a,KAAOzJ,EAAM,CACtB,MAAMykB,EAAWhb,EAAItP,WAAW,QAC5BgF,GAASslB,GACXl2B,KAAK+1B,UAAUv3B,IAAI0c,EAAI7F,MAAM,GAAI,CAAE4gB,WAAUvqB,YAC7C1L,KAAKg2B,QAAQh3B,IAAIkc,EAAIrO,MAAM,KAAK+P,IAAI,KAC1BhM,GAAUslB,IACpBl2B,KAAK+1B,UAAUv3B,IAAI0c,EAAK,CAAE+a,WAAUvqB,YACpC1L,KAAKg2B,QAAQh3B,IAAIkc,EAAIrO,MAAM,KAAK+P,IAAI,IAExC,CAEJ,CAmCAmG,IAAAA,CAAKoT,EAAMnc,GACT,IAAKha,KAAKg2B,QAAQp3B,IAAIob,EAAMkB,KAC1B,OAEF,MAAMrQ,EAAO7K,KAAK+1B,UAAUz2B,IAAIJ,EAAA22B,GAAA71B,KAAKo2B,IAAU/kB,KAAfrR,KAAgBga,IAChD,IAAKnP,EACH,OAEF,MAAM,SACJorB,EACAvqB,SAAS,QAAE2qB,GAAU,EAAK,KAAEje,EAAO,GAAE,QAAEke,EAAU,OAC/CzrB,EAEAyrB,IAAYA,EAAQH,EAAMnc,KAG9Bic,EAAS1I,KAAK4I,KAAS/d,EAAM4B,EAA7Bic,GAIKI,GACH/T,GAAUtI,GAEd,EACF,SAAAoc,GAnDapc,GACLA,EAAMuc,QACRv2B,KAAK0P,OAAOV,KAAK,OAEfgL,EAAMwc,SACRx2B,KAAK0P,OAAOV,KAAK,QAEfgL,EAAMyc,SACRz2B,KAAK0P,OAAOV,KAAK,QAEfgL,EAAM0c,UACR12B,KAAK0P,OAAOV,KAAK,SAEnBhP,KAAK0P,OAAOV,KAAKgL,EAAMkB,KACvB,MAAM/L,EAAMnP,KAAK0P,OAAOT,KAAK,KAG7B,OAFAjP,KAAK0P,OAAOrR,OAAS,EAEd8Q,CACT,CAmCF,MAAMwnB,GAMJ,WAAIC,GASF,MAAMC,EAAS,IAAIxP,IAAI,CACrB,CAAC,aAAc,MACf,CAAC,SAAU,QAGb,OFAJ,SAAwBwP,GACtB,MAAM5H,EAAOlT,SAASC,cAAc,QACpCiT,EAAK5T,MAAMyb,WAAa,SAExB7H,EAAK5T,MAAM0b,YAAc,aACzBhb,SAASib,KAAK5a,OAAO6S,GACrB,IAAK,MAAM1hB,KAAQspB,EAAOplB,OAAQ,CAChCwd,EAAK5T,MAAMsI,MAAQpW,EACnB,MAAM0pB,EAAgBnR,OAAOoR,iBAAiBjI,GAAMtL,MACpDkT,EAAOr4B,IAAI+O,EAAMmW,GAAOuT,GAC1B,CACAhI,EAAKnE,QACP,CEbIqM,CAAeN,GACR/pB,GAAO9M,KAAM,UAAW62B,EACjC,CAUAO,OAAAA,CAAQzT,GACN,MAAM8C,EAAM/C,GAAOC,GACnB,IAAKmC,OAAOS,WAAW,2BAA2BzD,QAChD,OAAO2D,EAGT,IAAK,MAAOlZ,EAAM8pB,KAAQr3B,KAAK42B,QAC7B,GAAIS,EAAIC,MAAM,CAACxhB,EAAGpH,IAAMoH,IAAM2Q,EAAI/X,IAChC,OAAOioB,GAAaY,eAAej4B,IAAIiO,GAG3C,OAAOkZ,CACT,CASA+Q,UAAAA,CAAWjqB,GACT,MAAMkZ,EAAMzmB,KAAK42B,QAAQt3B,IAAIiO,GAC7B,OAAKkZ,EAGE7U,GAAKC,gBAAgB4U,GAFnBlZ,CAGX,GACFsR,EAAAA,EAAAA,GA3DM8X,GAAY,iBACQ,IAAItP,IAAI,CAC9B,CAAC,aAAc,CAAC,EAAG,EAAG,IACtB,CAAC,SAAU,CAAC,IAAK,IAAK,SACtB,IAAAoQ,GAAA,IAAA9J,QAAA+J,GAAA,IAAA/J,QAAAgK,GAAA,IAAAhK,QAAAiK,GAAA,IAAAjK,QAAAkK,GAAA,IAAAlK,QAAAmK,GAAA,IAAAnK,QAAAoK,GAAA,IAAApK,QAAAqK,GAAA,IAAArK,QAAAsK,GAAA,IAAAtK,QAAAuK,GAAA,IAAAvK,QAAAwK,GAAA,IAAAxK,QAAAyK,GAAA,IAAAzK,QAAA0K,GAAA,IAAA1K,QAAA2K,GAAA,IAAA3K,QAAA4K,GAAA,IAAA5K,QAAA6K,GAAA,IAAA7K,QAAA8K,GAAA,IAAA9K,QAAA+K,GAAA,IAAA/K,QAAAgL,GAAA,IAAAhL,QAAAiL,GAAA,IAAAjL,QAAAkL,GAAA,IAAAlL,QAAAmL,GAAA,IAAAnL,QAAAoL,GAAA,IAAApL,QAAAqL,GAAA,IAAArL,QAAAsL,GAAA,IAAAtL,QAAAuL,GAAA,IAAAvL,QAAAwL,GAAA,IAAAxL,QAAAyL,GAAA,IAAAzL,QAAA0L,GAAA,IAAA1L,QAAA2L,GAAA,IAAA3L,QAAA4L,GAAA,IAAA5L,QAAA6L,GAAA,IAAA7L,QAAA8L,GAAA,IAAA9L,QAAA+L,GAAA,IAAA/L,QAAAgM,GAAA,IAAAhM,QAAAiM,GAAA,IAAAjM,QAAAkM,GAAA,IAAAlM,QAAAmM,GAAA,IAAAnM,QAAAoM,GAAA,IAAApM,QAAAqM,GAAA,IAAArM,QAAAsM,GAAA,IAAAtM,QAAAuM,GAAA,IAAAvM,QAAAwM,GAAA,IAAAxM,QAAAyM,GAAA,IAAAzM,QAAA0M,GAAA,IAAA1M,QAAA2M,GAAA,IAAA3M,QAAA4M,GAAA,IAAA5M,QAAA6M,GAAA,IAAA7M,QAAA8M,GAAA,IAAA9M,QAAA+M,GAAA,IAAA3M,QAiEJ,MAAM4M,GAgHJ,2BAAWC,GACT,MAAMC,EAAQF,GAA0Bz6B,UAMlC46B,EAAe3E,GACnBvM,EAAK0Q,GAALnE,GAAgB4E,SAAShf,SAASif,gBACC,WAAnCjf,SAASif,cAAcC,SACvB9E,EAAK+E,wBAEDC,EAAmBA,CAACC,EAAKC,KAAqB,IAAjBnhB,OAAQ+C,GAAIoe,EAC7C,GAAIpe,aAAcqe,iBAAkB,CAClC,MAAM,KAAE96B,GAASyc,EACjB,MAAgB,SAATzc,GAA4B,WAATA,CAC5B,CACA,OAAO,GAGH+6B,EAAQv7B,KAAKw7B,gBACbC,EAAMz7B,KAAK07B,cAEjB,OAAO5uB,GACL9M,KACA,mBACA,IAAI81B,GAAgB,CAClB,CACE,CAAC,SAAU,cACX+E,EAAMc,UACN,CAAErF,QAAS6E,IAEb,CAAC,CAAC,SAAU,cAAeN,EAAM1F,KAAM,CAAEmB,QAAS6E,IAClD,CAGE,CACE,SACA,eACA,mBACA,eACA,oBAEFN,EAAMpF,KACN,CAAEa,QAAS6E,IAEb,CACE,CACE,YACA,gBACA,iBACA,kBACA,gBACA,oBACA,qBACA,SACA,cACA,eACA,cAEFN,EAAMxP,OACN,CAAEiL,QAAS6E,IAEb,CACE,CAAC,QAAS,aACVN,EAAMe,yBACN,CAIEtF,QAASA,CAACH,EAAI0F,KAAA,IAAI3hB,OAAQ+C,GAAI4e,EAAA,QAC1B5e,aAAc6e,oBAChBlS,EAAK0Q,GAALnE,GAAgB4E,SAAS9d,KACxBkZ,EAAK4F,kBAGZ,CACE,CAAC,IAAK,SACNlB,EAAMe,yBACN,CAIEtF,QAASA,CAACH,EAAI6F,KAAA,IAAI9hB,OAAQ+C,GAAI+e,EAAA,QAC1B/e,aAAc6e,oBAChBlS,EAAK0Q,GAALnE,GAAgB4E,SAAShf,SAASif,kBAGxC,CAAC,CAAC,SAAU,cAAeH,EAAMoB,aACjC,CACE,CAAC,YAAa,iBACdpB,EAAMqB,yBACN,CAAE9jB,KAAM,EAAEmjB,EAAO,GAAIjF,QAASwE,IAEhC,CACE,CAAC,iBAAkB,uBACnBD,EAAMqB,yBACN,CAAE9jB,KAAM,EAAEqjB,EAAK,GAAInF,QAASwE,IAE9B,CACE,CAAC,aAAc,kBACfD,EAAMqB,yBACN,CAAE9jB,KAAM,CAACmjB,EAAO,GAAIjF,QAASwE,IAE/B,CACE,CAAC,kBAAmB,wBACpBD,EAAMqB,yBACN,CAAE9jB,KAAM,CAACqjB,EAAK,GAAInF,QAASwE,IAE7B,CACE,CAAC,UAAW,eACZD,EAAMqB,yBACN,CAAE9jB,KAAM,CAAC,GAAImjB,GAAQjF,QAASwE,IAEhC,CACE,CAAC,eAAgB,qBACjBD,EAAMqB,yBACN,CAAE9jB,KAAM,CAAC,GAAIqjB,GAAMnF,QAASwE,IAE9B,CACE,CAAC,YAAa,iBACdD,EAAMqB,yBACN,CAAE9jB,KAAM,CAAC,EAAGmjB,GAAQjF,QAASwE,IAE/B,CACE,CAAC,iBAAkB,uBACnBD,EAAMqB,yBACN,CAAE9jB,KAAM,CAAC,EAAGqjB,GAAMnF,QAASwE,MAInC,CAEAttB,WAAAA,CACEga,EACA2U,EACAC,EACAC,EACAC,EACAlQ,EACAmQ,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GACAl+B,EAAA,KAAA47B,IArQFz7B,EAAA,KAAAw4B,GAAmB,IAAIwF,iBAEvBh+B,EAAA,KAAAy4B,GAAgB,MAEhBz4B,EAAA,KAAA04B,GAA0B,MAE1B14B,EAAA,KAAA24B,GAAc,IAAIvQ,KAElBpoB,EAAA,KAAA44B,GAAa,IAAIxQ,KAEjBpoB,EAAA,KAAA64B,GAAkB,MAElB74B,EAAA,KAAA84B,GAAqB,MAErB94B,EAAA,KAAA+4B,GAA8B,MAE9B/4B,EAAA,KAAAg5B,GAAkB,IAAIlD,IAEtB91B,EAAA,KAAAi5B,GAAkB,MAElBj5B,EAAA,KAAAk5B,GAAe,MAEfl5B,EAAA,KAAAm5B,GAAyB,MAEzBn5B,EAAA,KAAAo5B,GAAoB,GAEpBp5B,EAAA,KAAAq5B,GAAgC,IAAI9I,KAEpCvwB,EAAA,KAAAs5B,GAAmB,MAEnBt5B,EAAA,KAAAu5B,GAAe,MAEfv5B,EAAA,KAAAw5B,GAAoB,IAAIjJ,MAAK3Q,EAAAA,EAAAA,GAAA,sBAEZ,MAEjB5f,EAAA,KAAAy5B,IAAiC,GAEjCz5B,EAAA,KAAA05B,IAAyB,GAEzB15B,EAAA,KAAA25B,IAAmC,GAEnC35B,EAAA,KAAA45B,GAAiB,MAEjB55B,EAAA,KAAA65B,GAA+B,MAE/B75B,EAAA,KAAA85B,GAAkB,MAElB95B,EAAA,KAAA+5B,GAAmB,MAEnB/5B,EAAA,KAAAg6B,IAAwB,GAExBh6B,EAAA,KAAAi6B,GAAmB,MAEnBj6B,EAAA,KAAAk6B,GAAa,IAAIpI,IAEjB9xB,EAAA,KAAAm6B,IAAa,GAEbn6B,EAAA,KAAAo6B,IAAiB,GAEjBp6B,EAAA,KAAAq6B,IAAa,GAEbr6B,EAAA,KAAAs6B,GAAqB,MAErBt6B,EAAA,KAAAu6B,GAAqB,MAErBv6B,EAAA,KAAAw6B,GAA4B,MAE5Bx6B,EAAA,KAAAy6B,GAAmB,MAEnBz6B,EAAA,KAAA06B,GAAa,MAEb16B,EAAA,KAAA26B,GAAQ14B,EAAqBC,MAE7BlC,EAAA,KAAA46B,GAAmB,IAAIrK,KAEvBvwB,EAAA,KAAA66B,GAAoB,MAEpB76B,EAAA,KAAA86B,GAAoB,MAEpB96B,EAAA,KAAA+6B,GAAc,MAEd/6B,EAAA,KAAAg7B,GAAiB,MAEjBh7B,EAAA,KAAAi7B,GAAe,MAEfj7B,EAAA,KAAAk7B,GAAkB,CAChB+C,WAAW,EACXC,SAAS,EACTzH,oBAAoB,EACpBC,oBAAoB,EACpByH,mBAAmB,EACnBC,iBAAiB,IAGnBp+B,EAAA,KAAAm7B,GAAe,CAAC,EAAG,IAEnBn7B,EAAA,KAAAo7B,GAAwB,MAExBp7B,EAAA,KAAAq7B,GAAa,MAEbr7B,EAAA,KAAAs7B,GAAU,MAEVt7B,EAAA,KAAAu7B,GAAe,MAEfv7B,EAAA,KAAAw7B,GAAwB,MA6JtB,MAAM9Q,EAAU3pB,KAAK8pB,QAAUF,EAAK6N,GAALz3B,MAAsB2pB,OACrDT,EAAKoR,GAALt6B,KAAkBwnB,GAClB0B,EAAKqR,GAALv6B,KAAem8B,GACfjT,EAAKsR,GAALx6B,KAAoBo8B,GACpBlT,EAAK4O,GAAL93B,KAAuBq8B,GACvBnT,EAAKgP,GAALl4B,KAAuBs8B,GACvBpT,EAAK6Q,GAAL/5B,KAAyBosB,GACzBlD,EAAKgR,GAALl6B,KAAoBw8B,GACpBx8B,KAAKs9B,UAAYf,EACjBA,EAASgB,IAAI,gBAAiBv9B,KAAKw9B,gBAAgBjQ,KAAKvtB,MAAO,CAAE2pB,OAAAA,IACjE4S,EAASgB,IAAI,eAAgBv9B,KAAKy9B,eAAelQ,KAAKvtB,MAAO,CAAE2pB,OAAAA,IAC/D4S,EAASgB,IAAI,gBAAiBv9B,KAAK09B,gBAAgBnQ,KAAKvtB,MAAO,CAAE2pB,OAAAA,IACjE4S,EAASgB,IAAI,mBAAoBv9B,KAAK29B,mBAAmBpQ,KAAKvtB,MAAO,CACnE2pB,OAAAA,IAEF4S,EAASgB,IAAI,gBAAiBv9B,KAAK49B,gBAAgBrQ,KAAKvtB,MAAO,CAAE2pB,OAAAA,IACjE4S,EAASgB,IACP,+BACAM,GAAO79B,KAAK89B,aAAaD,EAAIr9B,KAAMq9B,EAAI/9B,OACvC,CAAE6pB,OAAAA,IAEJ7D,OAAO/L,iBACL,cACA,KACEmP,EAAKmQ,GAALr5B,MAAsB,IAExB,CAAEwtB,SAAS,EAAM7D,OAAAA,IAEnB7D,OAAO/L,iBACL,YACA,KACEmP,EAAKmQ,GAALr5B,MAAsB,IAExB,CAAEwtB,SAAS,EAAM7D,OAAAA,IAEnBzqB,EAAAw7B,GAAA16B,KAAK+9B,IAAqB1sB,KAA1BrR,MACAd,EAAAw7B,GAAA16B,KAAKg+B,IAAwB3sB,KAA7BrR,MACAd,EAAAw7B,GAAA16B,KAAKi+B,IAAmB5sB,KAAxBrR,MACAkpB,EAAK6O,GAAL/3B,KAA0Bw8B,EAAY7gB,mBACtCuN,EAAK2P,GAAL74B,KAAsBw8B,EAAY0B,eAClChV,EAAK8Q,GAALh6B,KAAmBy8B,GACnBvT,EAAK8P,GAALh5B,KAAwB08B,GAAmB,MAC3CxT,EAAKwP,GAAL14B,KAAsC28B,GACtCzT,EAAKyP,GAAL34B,KAA8B48B,GAC9B1T,EAAK0P,GAAL54B,KAAwC68B,GACxC3T,EAAKyQ,GAAL35B,KAAkB88B,GAAa,MAC/B98B,KAAKm+B,eAAiB,CACpBC,UAAW9gB,GAAc+gB,iBACzBjf,SAAU,GAEZpf,KAAKs+B,gBAAiB,EACtBt+B,KAAKu+B,eAAiBxB,GAAiB,KACvC/8B,KAAKw+B,sBAA+C,IAAxBxB,EACd,OAAdV,QAAc,IAAdA,GAAAA,EAAgBmC,oBAAoBz+B,KActC,CAEAmtB,OAAAA,GAAU,IAAAuR,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACkB,QAA1BR,EAAA9U,EAAK6Q,GAALz6B,aAA0B,IAAA0+B,GAA1BA,EAA4B7+B,UAC5BqpB,EAAKuR,GAALz6B,KAA6B,MAER,QAArB2+B,EAAA/U,EAAK6N,GAALz3B,aAAqB,IAAA2+B,GAArBA,EAAuBQ,QACvBjW,EAAKuO,GAALz3B,KAAwB,MACxBA,KAAK8pB,QAAU,KAEf,IAAK,MAAMsV,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAClCD,EAAMjS,UAERvD,EAAKiO,GAAL73B,MAAgBs/B,QAChB1V,EAAKgO,GAAL53B,MAAiBs/B,QACjB1V,EAAK6O,GAALz4B,MAAuBs/B,QACF,QAArBV,EAAAhV,EAAK8P,GAAL15B,aAAqB,IAAA4+B,GAArBA,EAAuBU,QACvBpW,EAAKwO,GAAL13B,KAAqB,MACrB4pB,EAAKiQ,GAAL75B,MAAsBs/B,QACtB1V,EAAKqO,GAALj4B,MAAqBmtB,UACD,QAApB0R,EAAAjV,EAAKkO,GAAL93B,aAAoB,IAAA6+B,GAApBA,EAAsB1R,UACF,QAApB2R,EAAAlV,EAAKsO,GAALl4B,aAAoB,IAAA8+B,GAApBA,EAAsB3R,UACA,QAAtB4R,EAAAnV,EAAKmQ,GAAL/5B,aAAsB,IAAA++B,GAAtBA,EAAwB5R,UACH,QAArB6R,EAAApV,EAAKsP,GAALl5B,aAAqB,IAAAg/B,GAArBA,EAAuBxU,OACvBtB,EAAKgQ,GAALl5B,KAAwB,MACM,QAA9Bi/B,EAAArV,EAAK6P,GAALz5B,aAA8B,IAAAi/B,GAA9BA,EAAgC9R,UAChCjE,EAAKuQ,GAALz5B,KAAiC,MACjCkpB,EAAKyO,GAAL33B,KAA+B,MAC3B4pB,EAAKkP,GAAL94B,QACFu/B,aAAa3V,EAAKkP,GAAL94B,OACbkpB,EAAK4P,GAAL94B,KAAoC,OAElC4pB,EAAKyQ,GAALr6B,QACFu/B,aAAa3V,EAAKyQ,GAALr6B,OACbkpB,EAAKmR,GAALr6B,KAA6B,OAEZ,QAAnBk/B,EAAAl/B,KAAKu+B,sBAAc,IAAAW,GAAnBA,EAAqB/R,UACrBjE,EAAKgR,GAALl6B,KAAoB,KACtB,CAEAw/B,cAAAA,CAAeC,GACb,OAAO1V,YAAY2V,IAAI,CAAC1/B,KAAK8pB,QAAS2V,EAAG9V,QAC3C,CAEA,aAAImT,GACF,OAAOlT,EAAK+P,GAAL35B,KACT,CAEA,qBAAI2/B,GACF,OAAO/V,EAAK+O,GAAL34B,KACT,CAEA,gCAAI4/B,GACF,OAAOhW,EAAKgP,GAAL54B,KACT,CAEA,aAAI6/B,GACF,OAAO/yB,GACL9M,KACA,YACA4pB,EAAKoQ,GAALh6B,MACI4pB,EAAKiP,GAAL74B,MAAoB8/B,aAClBlW,EAAKoQ,GAALh6B,MAAiB+/B,WACjBnW,EAAKoQ,GAALh6B,MAAiBggC,YAEnB,OAER,CAEA,aAAI3V,GACF,OAAOvd,GACL9M,KACA,YACAk3B,iBAAiBtN,EAAK0Q,GAALt6B,OAAiBqqB,UAEtC,CAEA,oBAAI4V,GACF,OAAOnzB,GACL9M,KACA,mBACA4pB,EAAKoP,GAALh5B,MACI,IAAIqnB,IACFuC,EAAKoP,GAALh5B,MAAsB6M,MAAM,KAAKgX,IAAIqc,KACnCA,EAAOA,EAAKrzB,MAAM,KAAKgX,IAAI/N,GAAKA,EAAEoL,SAC7B,GAAKgf,EAAK,GAAGC,cACXD,KAGX,KAER,CAEA,mBAAIxD,GACF,MAAM,iBAAEuD,GAAqBjgC,KAC7B,IAAKigC,EACH,OAAOnzB,GAAO9M,KAAM,kBAAmB,MAEzC,MAAM6jB,EAAM,IAAIwD,IACV+Y,IAAWxW,EAAKoQ,GAALh6B,MACjB,IAAK,MAAOuN,EAAMoW,KAAUsc,EAAkB,CAC5C,MAAMI,EAAe9yB,EAAK+yB,SAAS,QAC/BF,GAAUC,EACZxc,EAAIrlB,IAAI+O,EAAKgzB,QAAQ,OAAQ,IAAK5c,GAG/Byc,GAAWC,GACdxc,EAAIrlB,IAAI+O,EAAMoW,EAElB,CACA,OAAO7W,GAAO9M,KAAM,kBAAmB6jB,EACzC,CAEA,uBAAI2c,GACF,OAAO1zB,GACL9M,KACA,sBACAA,KAAK08B,gBACD,IAAIrV,IAAI9V,MAAMC,KAAKxR,KAAK08B,gBAAiBx+B,GAAKA,EAAEuiC,YAChD,KAER,CAEAC,cAAAA,CAAe/c,GACb,IAAK3jB,KAAKigC,iBACR,OAAOtc,EAET,MAAMgd,EAAY3gC,KAAKwgC,oBAAoBlhC,IAAIqkB,GAC/C,OAAO3jB,KAAKigC,iBAAiB3gC,IAAIqhC,IAAchd,CACjD,CAEAid,kBAAAA,CAAmBjd,GACjB,OAAO3jB,KAAKwgC,oBAAoBlhC,IAAIqkB,IAAUA,CAChD,CAMAkd,wBAAAA,CAAyBzB,GACnBA,GACFp/B,KAAKi8B,cACLj8B,KAAK8gC,mBAAkB,IAEvB9gC,KAAK8gC,mBAAkB,GAEzB5X,EAAKkP,GAALp4B,KAA8Bo/B,EAChC,CAEA2B,2BAAAA,CAA4B9U,GAC1B/C,EAAKuQ,GAALz5B,KAAiCisB,EACnC,CAEA+U,WAAAA,CAAYxY,GAA2B,IAAAyY,EAAA,IAAnBC,EAAS/hC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACP,QAApB8hC,EAAArX,EAAKkO,GAAL93B,aAAoB,IAAAihC,GAApBA,EAAsBD,YAAYhhC,KAAMwoB,EAAQ0Y,EAClD,CAEA5S,iBAAAA,GACE,QAAS1E,EAAKsO,GAALl4B,KACX,CAEAmhC,WAAAA,CAAY3Y,EAAQ4Y,EAAMC,EAAM31B,GAAS,IAAA41B,EACnB,QAApBA,EAAA1X,EAAKsO,GAALl4B,aAAoB,IAAAshC,GAApBA,EAAsBC,WAAWvhC,KAAMwoB,EAAQ4Y,EAAMC,EAAM31B,EAC7D,CAEA81B,aAAAA,CAAcC,EAAWC,GACvB,MAAMtC,EAAQxV,EAAKiO,GAAL73B,MAAgBV,IAAImiC,GAC5BjZ,EAAc,OAAL4W,QAAK,IAALA,OAAK,EAALA,EAAOuC,eAAeD,GAC/B,OAANlZ,QAAM,IAANA,GAAAA,EAAQoZ,eAA+B,GAAuB,EAChE,CAEAC,aAAAA,CAAcrZ,GAAQ,IAAAsZ,EACA,QAApBA,EAAAlY,EAAKsO,GAALl4B,aAAoB,IAAA8hC,GAApBA,EAAsBD,cAAcrZ,EAAOuZ,UAC7C,CAEAC,gBAAAA,CAAiBxZ,GAAQ,IAAAyZ,EACH,QAApBA,EAAArY,EAAKsO,GAALl4B,aAAoB,IAAAiiC,GAApBA,EAAsBD,iBAAiBxZ,EACzC,CAEA0Z,aAAAA,CAAc1Z,GAAQ,IAAA2Z,EACA,QAApBA,EAAAvY,EAAKsO,GAALl4B,aAAoB,IAAAmiC,GAApBA,EAAsBC,eAAe,CAAC5Z,EAAOkZ,KAC/C,CAEAE,aAAAA,CAAcpZ,EAAQ6Z,GAAoC,IAAAC,EAAA,IAAxBxL,EAAU33B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,QAAGsM,EACzB,QAApB62B,EAAA1Y,EAAKsO,GAALl4B,aAAoB,IAAAsiC,GAApBA,EAAsBC,mBAAmB/Z,EAAQ6Z,EAAYvL,EAC/D,CAEA0L,gBAAAA,CAAiB7e,EAAO8e,GAAS,IAAAC,EAC/B,OACG/e,IAA6B,QAAxB+e,EAAI9Y,EAAKsO,GAALl4B,aAAoB,IAAA0iC,OAAA,EAApBA,EAAsBF,iBAAiB7e,EAAO8e,KAAa,IAEzE,CAEAE,uBAAAA,GAA0B,IAAAC,EACxB,OAA2B,QAApBA,EAAAhZ,EAAKsO,GAALl4B,aAAoB,IAAA4iC,OAAA,EAApBA,EAAsBC,gBAAiB,IAChD,CAEA,4BAAMC,CAAuBC,GAC3B,GAAInZ,EAAKiO,GAAL73B,MAAgBpB,IAAImkC,EAAa,GACnC,OAEF,MAAM,QAAEljC,EAAO,QAAEmjC,GAAYtjC,QAAQujC,gBAC/BC,EAAoBrF,IACpBA,EAAIkF,aAAeA,IACrB/iC,KAAKs9B,UAAU6F,KAAK,kBAAmBD,GACvCrjC,MAGJG,KAAKs9B,UAAU8F,GAAG,kBAAmBF,SAC/BF,CACR,CAEAK,YAAAA,CAAa7a,GAAQ,IAAA8a,EACG,QAAtBA,EAAA1Z,EAAKmQ,GAAL/5B,aAAsB,IAAAsjC,GAAtBA,EAAwBD,aAAa,CAAEpV,UAAWjuB,KAAMwoB,UAC1D,CAEA,oBAAI4D,GACF,OAAOxC,EAAKmQ,GAAL/5B,KACT,CAEAujC,YAAAA,CAAaC,EAAMvN,GAEjBj2B,KAAKs9B,UAAU8F,GAAG,8BAA+BnN,EAAU,CACzDwN,MAAM,EACN9Z,OAAQ3pB,KAAK8pB,UAEf9pB,KAAKs9B,UAAUoG,SAAS,yBAA0B,CAChDC,OAAQ3jC,KACRwjC,QAEJ,CAEAI,aAAAA,CAAcr2B,EAAMzN,GAClBE,KAAKs9B,UAAUoG,SAAS,gBAAiB,CACvCC,OAAQ3jC,KACRuN,OACAzN,SAEJ,CAEA89B,eAAAA,CAAeiG,GAAkB,IAAjB,KAAEt2B,EAAI,MAAEzN,GAAO+jC,EAC7B,GACO,oCADCt2B,EAEJ2b,EAAK0P,GAAL54B,KAAwCF,EAG9C,CAEA29B,cAAAA,CAAcqG,GAAiB,IAAhB,WAAEf,GAAYe,EAC3B5a,EAAKmP,GAALr4B,KAAyB+iC,EAAa,EACxC,CAEAgB,kBAAAA,GACEna,EAAK0Q,GAALt6B,MAAgBgkC,OAClB,CAEAC,UAAAA,CAAWnuB,EAAGC,GACZ,IAAK,MAAMqpB,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAAU,CAC5C,MACEvpB,EAAGouB,EACHnuB,EAAGouB,EAAM,MACTnkB,EAAK,OACLC,GACEmf,EAAMjjB,IAAIioB,wBACd,GACEtuB,GAAKouB,GACLpuB,GAAKouB,EAASlkB,GACdjK,GAAKouB,GACLpuB,GAAKouB,EAASlkB,EAEd,OAAOmf,CAEX,CACA,OAAO,IACT,CAEA0B,iBAAAA,GAAiC,IAAfhhC,EAAKX,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACrByqB,EAAK2Q,GAALv6B,MAAagoB,UAAUqc,OAAO,eAAgBvkC,EAChD,CAEAwkC,gBAAAA,CAAiB9b,GACfoB,EAAK6O,GAALz4B,MAAuBhB,IAAIwpB,EAC7B,CAEA+b,mBAAAA,CAAoB/b,GAClBoB,EAAK6O,GAALz4B,MAAuBqrB,OAAO7C,EAChC,CAEAkV,eAAAA,CAAe8G,GAAY,IAAAC,EAAA,IAAX,MAAEtlB,GAAOqlB,EACvBxkC,KAAK0kC,iBACL1kC,KAAKm+B,eAAeC,UAAYjf,EAAQ7B,GAAc+gB,iBACtD,IAAK,MAAM7V,KAAUoB,EAAK6O,GAALz4B,MACnBwoB,EAAOkV,kBAEkB,QAA3B+G,EAAA7a,EAAKwO,GAALp4B,aAA2B,IAAAykC,GAA3BA,EAA6B/G,iBAC/B,CAEAC,kBAAAA,CAAkBgH,GAAoB,IAAnB,cAAEC,GAAeD,EAClC3kC,KAAK0kC,iBACL1kC,KAAKm+B,eAAe/e,SAAWwlB,CACjC,CAqBAnW,kBAAAA,GAA2D,IAAxCoW,EAAgB1lC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAAIusB,EAAOvsB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAC/C,MAAM2lC,EAAY/oB,SAASgpB,eAC3B,IAAKD,GAAaA,EAAUE,YAC1B,OAEF,MAAM,WAAEC,EAAU,aAAEC,EAAY,UAAEC,EAAS,YAAEC,GAAgBN,EACvD5mB,EAAO4mB,EAAUpzB,WAEjB2zB,EADgBnmC,EAAAw7B,GAAA16B,KAAKslC,IAA6Bj0B,KAAlCrR,KAAmC8kC,GACzBS,QAAQ,cAClCrX,EAAQluB,KAAKwlC,kBAAkBH,GACrC,IAAKnX,EACH,OAEF4W,EAAUW,QAEV,MAAMrG,EAAQlgC,EAAAw7B,GAAA16B,KAAK0lC,IAAqBr0B,KAA1BrR,KAA2BqlC,GACnCM,EAAa/b,EAAKgQ,GAAL55B,QAAekB,EAAqBC,KACjD80B,EAAWA,KACf,MAAMzN,EAAc,OAAL4W,QAAK,IAALA,OAAK,EAALA,EAAOwG,sBAAsB,CAAE9vB,EAAG,EAAGC,EAAG,IAAK,EAAO,CACjE8uB,mBACA3W,QACA+W,aACAC,eACAC,YACAC,cACAlnB,SAEEynB,GACF3lC,KAAK6lC,eAAe,aAAa,GAA2B,GAE1Dna,IACI,OAANlD,QAAM,IAANA,GAAAA,EAAQ2Y,gBAGRwE,EACF3lC,KAAKujC,aAAariC,EAAqBG,UAAW40B,GAGpDA,GACF,CAEAzH,gBAAAA,GAAwC,IAAvBqW,EAAgB1lC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAClCa,KAAKyuB,mBAAmBoW,GAAgC,EAC1D,CAyBAiB,qCAAAA,CAAsCC,GACpC,IAAKnc,EAAKmO,GAAL/3B,MACH,OAAO,KAET,MAAMkb,EAAM,GAAHlQ,OAAM/J,GAAsB+J,OAAG+6B,GAClCC,EAAcpc,EAAKmO,GAAL/3B,MAAwBimC,YAAY/qB,GAIxD,OAHI8qB,GACFpc,EAAKmO,GAAL/3B,MAAwB8qB,OAAO5P,GAE1B8qB,CACT,CAMAE,sBAAAA,CAAuB1d,GAElBA,EAAO2U,YACRvT,EAAKmO,GAAL/3B,OACC4pB,EAAKmO,GAAL/3B,MAAwBpB,IAAI4pB,EAAO/O,KAEpCmQ,EAAKmO,GAAL/3B,MAAwBia,SAASuO,EAAO/O,GAAI+O,EAEhD,CAEA2d,SAAAA,CAAUC,GAAwB,IAAbhuB,EAAIjZ,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC1B,MAAMi9B,EAAcxS,EAAK4Q,GAALx6B,MACfo8B,IAGLA,EAAYhiB,aAAa,eAAgBgsB,GACrChuB,EACFgkB,EAAYhiB,aAAa,iBAAkBisB,KAAKC,UAAUluB,IAE1DgkB,EAAY9hB,gBAAgB,kBAEhC,CAoHAisB,IAAAA,GAME,GALAvmC,KAAKs+B,gBAAiB,EAClB1U,EAAKqP,GAALj5B,QACFkpB,EAAK+P,GAALj5B,MAA6B,GAC7Bd,EAAAw7B,GAAA16B,KAAKwmC,IAAYn1B,KAAjBrR,KAAkB,kBAEfA,KAAKymC,aACR,OAMF,MAAM,cAAEzL,GAAkBjf,SAC1B,IAAK,MAAMyM,KAAUoB,EAAKiQ,GAAL75B,MACnB,GAAIwoB,EAAOrM,IAAI4e,SAASC,GAAgB,CACtC9R,EAAKsQ,GAALx5B,KAA0B,CAACwoB,EAAQwS,IACnCxS,EAAO6E,qBAAsB,EAC7B,KACF,CAEJ,CAEA2W,KAAAA,GACE,IAAKpa,EAAK4P,GAALx5B,MACH,OAEF,MAAO0mC,EAAYC,GAAqB/c,EAAK4P,GAALx5B,MACxCkpB,EAAKsQ,GAALx5B,KAA0B,MAC1B2mC,EAAkB5sB,iBAChB,UACA,KACE2sB,EAAWrZ,qBAAsB,GAEnC,CAAEoW,MAAM,EAAM9Z,OAAQ3pB,KAAK8pB,UAE7B6c,EAAkB3C,OACpB,CA2CA4C,gBAAAA,GACE1nC,EAAAw7B,GAAA16B,KAAKi+B,IAAmB5sB,KAAxBrR,MACAA,KAAK6mC,iBAAgB,EACvB,CAEAC,mBAAAA,GACE5nC,EAAAw7B,GAAA16B,KAAK+mC,IAAsB11B,KAA3BrR,MACAA,KAAK6mC,iBAAgB,EACvB,CAEAG,QAAAA,CAAShtB,GACP,IAAK,MAAM,KAAExZ,KAAUwZ,EAAMitB,aAAaruB,MACxC,IAAK,MAAMqS,KAAcrB,EAAK4O,GAALx4B,MACvB,GAAIirB,EAAWic,yBAAyB1mC,GAGtC,OAFAwZ,EAAMitB,aAAaE,WAAa,YAChCntB,EAAMqI,gBAKd,CAMA+kB,IAAAA,CAAKptB,GACH,IAAK,MAAMqtB,KAAQrtB,EAAMitB,aAAaruB,MACpC,IAAK,MAAMqS,KAAcrB,EAAK4O,GAALx4B,MACvB,GAAIirB,EAAWic,yBAAyBG,EAAK7mC,MAG3C,OAFAyqB,EAAWqc,MAAMD,EAAMrnC,KAAKunC,mBAC5BvtB,EAAMqI,gBAKd,CAMAmlB,IAAAA,CAAKxtB,GAAO,IAAAytB,EAMV,GALAztB,EAAMqI,iBAGY,QAAlBolB,EAAA7d,EAAK8N,GAAL13B,aAAkB,IAAAynC,GAAlBA,EAAoB/C,kBAEf1kC,KAAKymC,aACR,OAGF,MAAMiB,EAAU,GAChB,IAAK,MAAMlf,KAAUoB,EAAKiQ,GAAL75B,MAAuB,CAC1C,MAAM2nC,EAAanf,EAAOof,WAA+B,GACrDD,GACFD,EAAQ14B,KAAK24B,EAEjB,CACuB,IAAnBD,EAAQrpC,QAIZ2b,EAAM6tB,cAAcC,QAAQ,oBAAqBzB,KAAKC,UAAUoB,GAClE,CAMAK,GAAAA,CAAI/tB,GACFha,KAAKwnC,KAAKxtB,GACVha,KAAKqrB,QACP,CAMA,WAAMic,CAAMttB,GACVA,EAAMqI,iBACN,MAAM,cAAEwlB,GAAkB7tB,EAC1B,IAAK,MAAMqtB,KAAQQ,EAAcjvB,MAC/B,IAAK,MAAMqS,KAAcrB,EAAK4O,GAALx4B,MACvB,GAAIirB,EAAWic,yBAAyBG,EAAK7mC,MAE3C,YADAyqB,EAAWqc,MAAMD,EAAMrnC,KAAKunC,cAMlC,IAAIrf,EAAO2f,EAAc9F,QAAQ,qBACjC,IAAK7Z,EACH,OAGF,IACEA,EAAOme,KAAKh6B,MAAM6b,EACpB,CAAE,MAAO8f,GAEP,YADA/8B,GAAK,WAADD,OAAYg9B,EAAG16B,QAAO,MAE5B,CAEA,IAAKiE,MAAM02B,QAAQ/f,GACjB,OAGFloB,KAAKi8B,cACL,MAAMmD,EAAQp/B,KAAKunC,aAEnB,IACE,MAAMW,EAAa,GACnB,IAAK,MAAM1f,KAAUN,EAAM,CACzB,MAAMigB,QAA2B/I,EAAMgJ,YAAY5f,GACnD,IAAK2f,EACH,OAEFD,EAAWl5B,KAAKm5B,EAClB,CAEA,MAAMjT,EAAMA,KACV,IAAK,MAAM1M,KAAU0f,EACnBhpC,EAAAw7B,GAAA16B,KAAKqoC,IAAiBh3B,KAAtBrR,KAAuBwoB,GAEzBtpB,EAAAw7B,GAAA16B,KAAKsoC,IAAcj3B,KAAnBrR,KAAoBkoC,IAEhB/S,EAAOA,KACX,IAAK,MAAM3M,KAAU0f,EACnB1f,EAAOsC,UAGX9qB,KAAKuoC,YAAY,CAAErT,MAAKC,OAAME,UAAU,GAC1C,CAAE,MAAO2S,GACP/8B,GAAK,WAADD,OAAYg9B,EAAG16B,QAAO,MAC5B,CACF,CAMAk7B,OAAAA,CAAQxuB,GACDha,KAAKs+B,gBAAgC,UAAdtkB,EAAMkB,MAChClb,KAAKs+B,gBAAiB,GAGtB1U,EAAKgQ,GAAL55B,QAAekB,EAAqBC,MACnCnB,KAAKyoC,0BAEN9N,GAA0BC,iBAAiB7X,KAAK/iB,KAAMga,EAE1D,CAMA0uB,KAAAA,CAAM1uB,GACAha,KAAKs+B,gBAAgC,UAAdtkB,EAAMkB,MAC/Blb,KAAKs+B,gBAAiB,EAClB1U,EAAKqP,GAALj5B,QACFkpB,EAAK+P,GAALj5B,MAA6B,GAC7Bd,EAAAw7B,GAAA16B,KAAKwmC,IAAYn1B,KAAjBrR,KAAkB,iBAGxB,CAOAw9B,eAAAA,CAAemL,GAAW,IAAV,KAAEp7B,GAAMo7B,EACtB,OAAQp7B,GACN,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,YACHvN,KAAKuN,KACL,MACF,IAAK,qBACHvN,KAAKyuB,mBAAmB,gBACxB,MACF,IAAK,mBACHzuB,KAAKwuB,iBAAiB,gBAG5B,CA4CAqY,eAAAA,CAAgB3J,GACVA,GACFh+B,EAAAw7B,GAAA16B,KAAK4oC,IAAgBv3B,KAArBrR,MACAd,EAAAw7B,GAAA16B,KAAK6oC,IAAsBx3B,KAA3BrR,MACAd,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBk9B,UAAWtT,EAAKgQ,GAAL55B,QAAekB,EAAqBC,KAC/Cg8B,QAASj+B,EAAAw7B,GAAA16B,KAAK+oC,IAAQ13B,KAAbrR,MACT01B,mBAAoB9L,EAAKqO,GAALj4B,MAAqB01B,qBACzCC,mBAAoB/L,EAAKqO,GAALj4B,MAAqB21B,qBACzCyH,mBAAmB,MAGrBl+B,EAAAw7B,GAAA16B,KAAKgpC,IAAmB33B,KAAxBrR,MACAd,EAAAw7B,GAAA16B,KAAKipC,IAAyB53B,KAA9BrR,MACAd,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBk9B,WAAW,IAEbl9B,KAAK8gC,mBAAkB,GAE3B,CAEAoI,mBAAAA,CAAoBC,GAClB,IAAIvf,EAAK4O,GAALx4B,MAAJ,CAGAkpB,EAAKsP,GAALx4B,KAAoBmpC,GACpB,IAAK,MAAMle,KAAcrB,EAAK4O,GAALx4B,MACvBd,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBirB,EAAWoe,0BAHpC,CAKF,CAMAC,KAAAA,GACE,OAAO1f,EAAKuP,GAALn5B,MAAgByZ,EACzB,CAEA,gBAAI8tB,GACF,OAAO3d,EAAKiO,GAAL73B,MAAgBV,IAAIsqB,EAAKyO,GAALr4B,MAC7B,CAEAupC,QAAAA,CAAS9H,GACP,OAAO7X,EAAKiO,GAAL73B,MAAgBV,IAAImiC,EAC7B,CAEA,oBAAI+H,GACF,OAAO5f,EAAKyO,GAALr4B,KACT,CAMAypC,QAAAA,CAASrK,GACPxV,EAAKiO,GAAL73B,MAAgBxB,IAAI4gC,EAAMqC,UAAWrC,GACjCxV,EAAKwP,GAALp5B,MACFo/B,EAAMsK,SAENtK,EAAMuK,SAEV,CAMAC,WAAAA,CAAYxK,GACVxV,EAAKiO,GAAL73B,MAAgBqrB,OAAO+T,EAAMqC,UAC/B,CAaA,gBAAMoI,CACJrG,GAKA,IAAAsG,EAAAC,EAAA,IAJAC,EAAM7qC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACT8qC,EAAc9qC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACd+qC,EAAmB/qC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACnBgiC,EAAWhiC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAEX,GAAIyqB,EAAKgQ,GAAL55B,QAAewjC,KAIf5Z,EAAK6Q,GAALz6B,cACI4pB,EAAK6Q,GAALz6B,MAA2BgjC,QAC5BpZ,EAAK6Q,GAALz6B,QAFP,CAW+C,IAAAmqC,EAwBFC,EAxB7C,GAHAlhB,EAAKuR,GAALz6B,KAA6BN,QAAQujC,iBACV,QAA3B6G,EAAAlgB,EAAKwO,GAALp4B,aAA2B,IAAA8pC,GAA3BA,EAA6BpF,iBAEzB9a,EAAKgQ,GAAL55B,QAAekB,EAAqBM,MAClB,QAApB2oC,EAAAvgB,EAAKsO,GAALl4B,aAAoB,IAAAmqC,GAApBA,EAAsBE,cAKxB,GAHoB,QAApBN,EAAAngB,EAAKsO,GAALl4B,aAAoB,IAAA+pC,GAApBA,EAAsBO,eAEtBphB,EAAK0Q,GAAL55B,KAAawjC,GACTA,IAAStiC,EAAqBC,KAAM,KAAAopC,EACtCvqC,KAAK6mC,iBAAgB,GACrB3nC,EAAAw7B,GAAA16B,KAAKwqC,IAAWn5B,KAAhBrR,MACA,IAAK,MAAMwoB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SACpC7W,EAAOiiB,8BAOT,OAJmB,QAAnBF,EAAAvqC,KAAKu+B,sBAAc,IAAAgM,GAAnBA,EAAqB/f,OACrBxqB,KAAK4hC,cAA6B,WAElChY,EAAK6Q,GAALz6B,MAA2BH,SAE7B,CAEA,IAAK,MAAM2oB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SACpC7W,EAAOkiB,6BAGT,GAAIlH,IAAStiC,EAAqBO,gBACJ,QAA5B2oC,EAAMxgB,EAAKmQ,GAAL/5B,aAAsB,IAAAoqC,OAAA,EAAtBA,EAAwBO,kBAGhC3qC,KAAK6mC,iBAAgB,SACf3nC,EAAAw7B,GAAA16B,KAAK4qC,IAAUv5B,KAAfrR,MACNA,KAAKi8B,cACL,IAAK,MAAMmD,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAClCD,EAAMyK,WAAWrG,GAGnB,GAAIA,IAAStiC,EAAqBM,MAAO,KAAAqpC,EACvCjhB,EAAK+N,GAAL33B,OAAAkpB,EAAKyO,GAAL33B,WACQ4pB,EAAKsQ,GAALl6B,MAAkB8qC,qBACtB,IAAItb,IAAI5F,EAAK4O,GAALx4B,MAAkB6jB,IAAIknB,GAAeA,EAAYC,gBAE7D,MAAMC,EAAa,IAAIzb,IACjB0b,EAAc,GACpB,IAAK,MAAM1iB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SAAU,CAC9C,MAAM,oBAAE8L,EAAmB,WAAEC,EAAU,QAAEC,GAAY7iB,EACjD2iB,GACFF,EAAWjsC,IAAImsC,GAEbC,IAAeC,GACjBH,EAAYl8B,KAAKwZ,EAAOuZ,UAE5B,CACA,IAAK,MAAMuJ,KAAc1hB,EAAK+N,GAAL33B,MAA8B,CACrD,MAAM,GAAEyZ,EAAE,SAAE8xB,EAAQ,YAAEC,GAAgBF,EAEpCC,GACW,OAAXC,QAAW,IAAXA,GAAAA,EAAar8B,MACZ87B,EAAWrsC,IAAI6a,KACfmQ,EAAK0O,GAALt4B,MAAmCpB,IAAI6a,IAIxCyxB,EAAYl8B,KAAKs8B,EAErB,CACoB,QAApBT,EAAAjhB,EAAKsO,GAALl4B,aAAoB,IAAA6qC,GAApBA,EAAsBY,YAAYP,EACpC,CAEA,IAAKlB,EAMH,OALIC,GACFjqC,KAAK47B,gCAGPhS,EAAK6Q,GAALz6B,MAA2BH,UAI7B,IAAK,MAAM2oB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SAChC7W,EAAOkZ,MAAQsI,GACjBhqC,KAAK0rC,YAAYljB,GACb2Y,EACF3Y,EAAO2Y,cACE+I,EACT1hB,EAAOmjB,kBAEPnjB,EAAOwb,SAGTxb,EAAOojB,WAIXhiB,EAAK6Q,GAALz6B,MAA2BH,SAhG3B,CAiGF,CAEA+7B,wBAAAA,GACM57B,KAAKunC,aAAasE,2BACpB7rC,KAAKunC,aAAauE,cAEtB,CAQAC,aAAAA,CAAcrgC,GACRA,EAAQ83B,OAAS5Z,EAAKgQ,GAAL55B,OAGrBA,KAAKs9B,UAAUoG,SAAS,8BAA4BsI,EAAAA,EAAAA,GAAA,CAClDrI,OAAQ3jC,MACL0L,GAEP,CAOAoyB,YAAAA,CAAat9B,EAAMV,GACjB,GAAK8pB,EAAK4O,GAALx4B,MAAL,CAIA,OAAQQ,GACN,KAAKmB,EAA2BE,OAE9B,YADA7B,KAAKunC,aAAauE,aAAahsC,GAEjC,KAAK6B,EAA2BY,mBAC9BvC,KAAKs9B,UAAUoG,SAAS,kBAAmB,CACzCC,OAAQ3jC,KACR6N,QAAS,CACPrN,KAAM,UACN0nB,KAAM,CACJ1nB,KAAM,YACNyrC,OAAQ,yBAIbriB,EAAKqQ,GAALj6B,OAAAkpB,EAAK+Q,GAALj6B,KAAwB,IAAIqnB,MAAO7oB,IAAIgC,EAAMV,GAC9CE,KAAK6lC,eAAe,YAAa/lC,GAIrC,GAAIE,KAAKymC,aACP,IAAK,MAAMje,KAAUoB,EAAKiQ,GAAL75B,MACnBwoB,EAAOsV,aAAat9B,EAAMV,QAG5B,IAAK,MAAMmrB,KAAcrB,EAAK4O,GAALx4B,MACvBirB,EAAWihB,oBAAoB1rC,EAAMV,EA5BzC,CA+BF,CAEA+lC,cAAAA,CAAerlC,EAAM2rC,GAA+B,IAAAC,EAAAC,EAClD,IAAK,MAAM7jB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SAChC7W,EAAOyC,aAAezqB,GACxBgoB,EAAOmC,KAAKwhB,IAIyD,QAD9DC,EACU,QADVC,EACTziB,EAAKqQ,GAALj6B,aAAmB,IAAAqsC,OAAA,EAAnBA,EAAqB/sC,IAAIqC,EAA2BY,2BAAmB,IAAA6pC,GAAAA,KAE3DD,GACZjtC,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuB,CACrB,CAAC2B,EAA2BY,mBAAoB4pC,IAGtD,CAEAG,aAAAA,GAAgC,IAAlBC,EAAQptC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACpB,GAAIyqB,EAAK0P,GAALt5B,QAAoBusC,EAAxB,CAGArjB,EAAKoQ,GAALt5B,KAAkBusC,GAClB,IAAK,MAAMnN,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAC9BkN,EACFnN,EAAMoN,eAENpN,EAAMqN,cAERrN,EAAMjjB,IAAI6L,UAAUqc,OAAO,UAAWkI,EARxC,CAUF,CAwCA,WAACG,CAAWjL,GACV,IAAK,MAAMjZ,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SAChC7W,EAAOiZ,YAAcA,UACjBjZ,EAGZ,CAOAmkB,SAAAA,CAAUlzB,GACR,OAAOmQ,EAAKgO,GAAL53B,MAAiBV,IAAIma,EAC9B,CAMAmzB,SAAAA,CAAUpkB,GACRoB,EAAKgO,GAAL53B,MAAiBxB,IAAIgqB,EAAO/O,GAAI+O,EAClC,CAMAqkB,YAAAA,CAAarkB,GAaqB,IAAAskB,EAO9BC,GAnBEvkB,EAAOrM,IAAI4e,SAAShf,SAASif,iBAC3BpR,EAAKkP,GAAL94B,OACFu/B,aAAa3V,EAAKkP,GAAL94B,OAEfkpB,EAAK4P,GAAL94B,KAAoCgtC,WAAW,KAG7ChtC,KAAK+jC,qBACL7a,EAAK4P,GAAL94B,KAAoC,OACnC,KAEL4pB,EAAKgO,GAAL53B,MAAiBqrB,OAAO7C,EAAO/O,IAC3B+O,EAAO2iB,uBACY,QAArB2B,EAAAljB,EAAK8P,GAAL15B,aAAqB,IAAA8sC,GAArBA,EAAuBzhB,OAAO7C,EAAO2iB,uBAEvCnrC,KAAK4rC,SAASpjB,GAEXA,EAAO2iB,qBACPvhB,EAAK0O,GAALt4B,MAAmCpB,IAAI4pB,EAAO2iB,wBAExB,QAAvB4B,EAAAnjB,EAAKmO,GAAL/3B,aAAuB,IAAA+sC,GAAvBA,EAAyBjiB,OAAOtC,EAAO/O,IAE3C,CAMAwzB,2BAAAA,CAA4BzkB,GAC1BoB,EAAK0O,GAALt4B,MAAmChB,IAAIwpB,EAAO2iB,qBAC9CnrC,KAAKktC,6BAA6B1kB,GAClCA,EAAO6iB,SAAU,CACnB,CAOA8B,0BAAAA,CAA2BhC,GACzB,OAAOvhB,EAAK0O,GAALt4B,MAAmCpB,IAAIusC,EAChD,CAMAiC,8BAAAA,CAA+B5kB,GAC7BoB,EAAK0O,GAALt4B,MAAmCqrB,OAAO7C,EAAO2iB,qBACjDnrC,KAAKqtC,gCAAgC7kB,GACrCA,EAAO6iB,SAAU,CACnB,CAoBAiC,eAAAA,CAAgB9kB,GACVoB,EAAK8N,GAAL13B,QAAuBwoB,IAI3BU,EAAKwO,GAAL13B,KAAqBwoB,GACjBA,GACFtpB,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBwoB,EAAO+kB,oBAElC,CAcAC,QAAAA,CAAShlB,GACHppB,EAAAs7B,GAAA16B,KAAKytC,MAAwBjlB,GAC/BtpB,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBwoB,EAAO+kB,mBAElC,CAEAG,4BAAAA,CAA6BziB,GAC3B/rB,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBirB,EAAWoe,0BACpC,CAMAsE,cAAAA,CAAenlB,GACb,GAAIoB,EAAKiQ,GAAL75B,MAAsBpB,IAAI4pB,GAM5B,OALAoB,EAAKiQ,GAAL75B,MAAsBqrB,OAAO7C,GAC7BA,EAAOojB,gBACP1sC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBo9B,kBAAmBp9B,KAAKymC,eAI5B7c,EAAKiQ,GAAL75B,MAAsBhB,IAAIwpB,GAC1BA,EAAOolB,SACP1uC,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBwoB,EAAO+kB,oBAC9BruC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBo9B,mBAAmB,GAEvB,CAMAsO,WAAAA,CAAYljB,GAAQ,IAAAqlB,EAClB7tC,KAAK+rC,cAAc,CACjBvI,KAAMhb,EAAOgb,KACbwG,OAAQxhB,EAAOkZ,MAGU,QAA3BmM,EAAAjkB,EAAKwO,GAALp4B,aAA2B,IAAA6tC,GAA3BA,EAA6BnJ,iBAC7B,IAAK,MAAMoJ,KAAMlkB,EAAKiQ,GAAL75B,MACX8tC,IAAOtlB,GACTslB,EAAGlC,WAGPhiB,EAAKiQ,GAAL75B,MAAsBs/B,QAEtB1V,EAAKiQ,GAAL75B,MAAsBhB,IAAIwpB,GAC1BA,EAAOolB,SACP1uC,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuBwoB,EAAO+kB,oBAC9BruC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBo9B,mBAAmB,GAEvB,CAMAiF,UAAAA,CAAW7Z,GACT,OAAOoB,EAAKiQ,GAAL75B,MAAsBpB,IAAI4pB,EACnC,CAEA,uBAAIulB,GACF,OAAOnkB,EAAKiQ,GAAL75B,MAAsBq/B,SAASp/B,OAAOH,KAC/C,CAMA8rC,QAAAA,CAASpjB,GACPA,EAAOojB,WACPhiB,EAAKiQ,GAAL75B,MAAsBqrB,OAAO7C,GAC7BtpB,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBo9B,kBAAmBp9B,KAAKymC,cAE5B,CAEA,gBAAIA,GACF,OAAsC,IAA/B7c,EAAKiQ,GAAL75B,MAAsBywB,IAC/B,CAEA,kBAAIsL,GACF,OACiC,IAA/BnS,EAAKiQ,GAAL75B,MAAsBywB,MACtBzwB,KAAK+tC,oBAAoBhS,cAE7B,CAKA5G,IAAAA,GAAO,IAAA6Y,EACLpkB,EAAKqO,GAALj4B,MAAqBm1B,OACrBj2B,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzB01B,mBAAoB9L,EAAKqO,GAALj4B,MAAqB01B,qBACzCC,oBAAoB,EACpBwH,QAASj+B,EAAAw7B,GAAA16B,KAAK+oC,IAAQ13B,KAAbrR,QAEQ,QAAnBguC,EAAAhuC,KAAKu+B,sBAAc,IAAAyP,GAAnBA,EAAqBxjB,MACvB,CAKAiL,IAAAA,GACE7L,EAAKqO,GAALj4B,MAAqBy1B,OACrBv2B,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzB01B,oBAAoB,EACpBC,mBAAoB/L,EAAKqO,GAALj4B,MAAqB21B,qBACzCwH,QAASj+B,EAAAw7B,GAAA16B,KAAK+oC,IAAQ13B,KAAbrR,OAEb,CAMAuoC,WAAAA,CAAY0F,GACVrkB,EAAKqO,GAALj4B,MAAqBhB,IAAIivC,GACzB/uC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzB01B,oBAAoB,EACpBC,oBAAoB,EACpBwH,QAASj+B,EAAAw7B,GAAA16B,KAAK+oC,IAAQ13B,KAAbrR,OAEb,CAEAkuC,cAAAA,CAAe1tC,GACbopB,EAAKqO,GAALj4B,MAAqB41B,UAAUp1B,EACjC,CAmBA6qB,SAAS,IAAA8iB,EACPnuC,KAAK0kC,iBACL,MAAM0J,EAAiC,QAApBD,EAAGnuC,KAAKunC,oBAAY,IAAA4G,OAAA,EAAjBA,EAAmBE,mBACrB,GAEpB,IAAKruC,KAAKymC,eAAiB2H,EACzB,OAGF,MAAM1G,EAAU0G,EACZ,CAACA,GACD,IAAIxkB,EAAKiQ,GAAL75B,OAUFm1B,EAAOA,KACX,IAAK,MAAM3M,KAAUkf,EACnBxoC,EAAAw7B,GAAA16B,KAAKqoC,IAAiBh3B,KAAtBrR,KAAuBwoB,IAI3BxoB,KAAKuoC,YAAY,CAAErT,IAfPA,KAAM,IAAAoZ,EACG,QAAnBA,EAAAtuC,KAAKu+B,sBAAc,IAAA+P,GAAnBA,EAAqB3jB,KACnBwK,EACmB,IAAnBuS,EAAQrpC,OAAeqpC,EAAQ,GAAGzc,WAAayc,EAAQrpC,QAEzD,IAAK,MAAMmqB,KAAUkf,EACnBlf,EAAOsC,UASaqK,OAAME,UAAU,GAC1C,CAEAqP,cAAAA,GAAiB,IAAA6J,EAEG,QAAlBA,EAAA3kB,EAAK8N,GAAL13B,aAAkB,IAAAuuC,GAAlBA,EAAoB7J,gBACtB,CAEAxJ,qBAAAA,GACE,OAAOtR,EAAK8N,GAAL13B,OAAsBA,KAAKymC,YACpC,CAwBA9K,SAAAA,GACE,IAAK,MAAMnT,KAAUoB,EAAKiQ,GAAL75B,MACnBwoB,EAAOgmB,SAETtvC,EAAAw7B,GAAA16B,KAAKsoC,IAAcj3B,KAAnBrR,KAAoB4pB,EAAKgO,GAAL53B,MAAiBq/B,SACvC,CAKApD,WAAAA,GAAc,IAAAwS,EACZ,KAAI7kB,EAAK8N,GAAL13B,QAEF4pB,EAAK8N,GAAL13B,MAAmB0kC,iBACf9a,EAAKgQ,GAAL55B,QAAekB,EAAqBC,SAOX,QAA/BstC,EAAI7kB,EAAKwO,GAALp4B,aAA2B,IAAAyuC,IAA3BA,EAA6B/J,mBAI5B1kC,KAAKymC,aAAV,CAGA,IAAK,MAAMje,KAAUoB,EAAKiQ,GAAL75B,MACnBwoB,EAAOojB,WAEThiB,EAAKiQ,GAAL75B,MAAsBs/B,QACtBpgC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBo9B,mBAAmB,GANrB,CAQF,CAEAlB,wBAAAA,CAAyBpmB,EAAGC,GAI1B,GAJqC5W,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,IAEnCa,KAAK0kC,kBAEF1kC,KAAKymC,aACR,OAGF7c,EAAKwQ,GAALp6B,MAAkB,IAAM8V,EACxB8T,EAAKwQ,GAALp6B,MAAkB,IAAM+V,EACxB,MAAO24B,EAAQC,GAAU/kB,EAAKwQ,GAALp6B,MACnB0nC,EAAU,IAAI9d,EAAKiQ,GAAL75B,OAMhB4pB,EAAKyQ,GAALr6B,OACFu/B,aAAa3V,EAAKyQ,GAALr6B,OAGfkpB,EAAKmR,GAALr6B,KAA6BgtC,WAAW,KACtC9jB,EAAKmR,GAALr6B,KAA6B,MAC7B4pB,EAAKwQ,GAALp6B,MAAkB,GAAK4pB,EAAKwQ,GAALp6B,MAAkB,GAAK,EAE9CA,KAAKuoC,YAAY,CACfrT,IAAKA,KACH,IAAK,MAAM1M,KAAUkf,EACf9d,EAAKgO,GAAL53B,MAAiBpB,IAAI4pB,EAAO/O,MAC9B+O,EAAOomB,gBAAgBF,EAAQC,GAC/BnmB,EAAOqmB,oBAIb1Z,KAAMA,KACJ,IAAK,MAAM3M,KAAUkf,EACf9d,EAAKgO,GAAL53B,MAAiBpB,IAAI4pB,EAAO/O,MAC9B+O,EAAOomB,iBAAiBF,GAASC,GACjCnmB,EAAOqmB,oBAIbxZ,UAAU,KA3BO,MA+BrB,IAAK,MAAM7M,KAAUkf,EACnBlf,EAAOomB,gBAAgB94B,EAAGC,GAC1ByS,EAAOqmB,iBAEX,CAKAC,gBAAAA,GAGE,GAAK9uC,KAAKymC,aAAV,CAIAzmC,KAAK8gC,mBAAkB,GACvB5X,EAAKqP,GAALv4B,KAAwB,IAAIqnB,KAC5B,IAAK,MAAMmB,KAAUoB,EAAKiQ,GAAL75B,MACnB4pB,EAAK2O,GAALv4B,MAAsBxB,IAAIgqB,EAAQ,CAChCumB,OAAQvmB,EAAO1S,EACfk5B,OAAQxmB,EAAOzS,EACfk5B,eAAgBzmB,EAAOiZ,UACvByN,KAAM,EACNC,KAAM,EACNC,cAAe,GAXnB,CAcF,CAMAC,cAAAA,GACE,IAAKzlB,EAAK2O,GAALv4B,MACH,OAAO,EAETA,KAAK8gC,mBAAkB,GACvB,MAAMjd,EAAM+F,EAAK2O,GAALv4B,MACZkpB,EAAKqP,GAALv4B,KAAwB,MACxB,IAAIsvC,GAAyB,EAE7B,IAAK,OAAO,EAAEx5B,EAAC,EAAEC,EAAC,UAAE0rB,GAAa3hC,KAAU+jB,EACzC/jB,EAAMovC,KAAOp5B,EACbhW,EAAMqvC,KAAOp5B,EACbjW,EAAMsvC,aAAe3N,EACrB6N,IAAAA,EACEx5B,IAAMhW,EAAMivC,QACZh5B,IAAMjW,EAAMkvC,QACZvN,IAAc3hC,EAAMmvC,gBAGxB,IAAKK,EACH,OAAO,EAGT,MAAMC,EAAOA,CAAC/mB,EAAQ1S,EAAGC,EAAG0rB,KAC1B,GAAI7X,EAAKgO,GAAL53B,MAAiBpB,IAAI4pB,EAAO/O,IAAK,CAInC,MAAMkD,EAASiN,EAAKiO,GAAL73B,MAAgBV,IAAImiC,GAC/B9kB,EACF6L,EAAOgnB,sBAAsB7yB,EAAQ7G,EAAGC,IAExCyS,EAAOiZ,UAAYA,EACnBjZ,EAAO1S,EAAIA,EACX0S,EAAOzS,EAAIA,EAEf,GAiBF,OAdA/V,KAAKuoC,YAAY,CACfrT,IAAKA,KACH,IAAK,MAAO1M,GAAQ,KAAE0mB,EAAI,KAAEC,EAAI,aAAEC,MAAmBvrB,EACnD0rB,EAAK/mB,EAAQ0mB,EAAMC,EAAMC,IAG7Bja,KAAMA,KACJ,IAAK,MAAO3M,GAAQ,OAAEumB,EAAM,OAAEC,EAAM,eAAEC,MAAqBprB,EACzD0rB,EAAK/mB,EAAQumB,EAAQC,EAAQC,IAGjC5Z,UAAU,KAGL,CACT,CAOAoa,mBAAAA,CAAoBC,EAAIC,GACtB,GAAK/lB,EAAK2O,GAALv4B,MAGL,IAAK,MAAMwoB,KAAUoB,EAAK2O,GAALv4B,MAAsByR,OACzC+W,EAAOonB,KAAKF,EAAIC,EAEpB,CAOAE,OAAAA,CAAQrnB,GACN,GAAsB,OAAlBA,EAAO7L,OAAiB,CAC1B,MAAMA,EAAS3c,KAAKupC,SAAS/gB,EAAOiZ,WAChC9kB,GACFA,EAAOmzB,aAAatnB,GACpB7L,EAAOozB,aAAavnB,KAEpBxoB,KAAK4sC,UAAUpkB,GACfxoB,KAAKkmC,uBAAuB1d,GAC5BA,EAAOqnB,UAEX,MACErnB,EAAO7L,OAAOozB,aAAavnB,EAE/B,CAEA,4BAAIigB,GAA2B,IAAAuH,EAC7B,OACkB,QAAhBA,EAAAhwC,KAAKiwC,mBAAW,IAAAD,OAAA,EAAhBA,EAAkBE,4BACc,IAA/BtmB,EAAKiQ,GAAL75B,MAAsBywB,MACrBzwB,KAAK+tC,oBAAoBmC,yBAE/B,CAOAC,QAAAA,CAAS3nB,GACP,OAAOoB,EAAK8N,GAAL13B,QAAuBwoB,CAChC,CAMAynB,SAAAA,GACE,OAAOrmB,EAAK8N,GAAL13B,KACT,CAMAowC,OAAAA,GACE,OAAOxmB,EAAKgQ,GAAL55B,KACT,CAEAqwC,aAAAA,GACE,OAAOzmB,EAAKgQ,GAAL55B,QAAekB,EAAqBC,IAC7C,CAEA,gBAAImvC,GACF,OAAOxjC,GAAO9M,KAAM,eAAgB,IAAIsxB,GAC1C,CAEAkU,iBAAAA,CAAkBH,GAChB,IAAKA,EACH,OAAO,KAET,MAAMP,EAAY/oB,SAASgpB,eAC3B,IAAK,IAAIr2B,EAAI,EAAGuS,EAAK6jB,EAAUyL,WAAY7hC,EAAIuS,EAAIvS,IACjD,IACG22B,EAAUtK,SAAS+J,EAAU0L,WAAW9hC,GAAG+hC,yBAE5C,OAAO,KAIX,MACE36B,EAAGouB,EACHnuB,EAAGouB,EACHnkB,MAAO0wB,EACPzwB,OAAQ0wB,GACNtL,EAAUjB,wBAId,IAAIwM,EACJ,OAAQvL,EAAU7qB,aAAa,uBAC7B,IAAK,KACHo2B,EAAUA,CAAC96B,EAAGC,EAAGwO,EAAGC,KAAM,CACxB1O,GAAIC,EAAIouB,GAAUwM,EAClB56B,EAAG,GAAKD,EAAIyO,EAAI2f,GAAUwM,EAC1B1wB,MAAOwE,EAAImsB,EACX1wB,OAAQsE,EAAImsB,IAEd,MACF,IAAK,MACHE,EAAUA,CAAC96B,EAAGC,EAAGwO,EAAGC,KAAM,CACxB1O,EAAG,GAAKA,EAAIyO,EAAI2f,GAAUwM,EAC1B36B,EAAG,GAAKA,EAAIyO,EAAI2f,GAAUwM,EAC1B3wB,MAAOuE,EAAImsB,EACXzwB,OAAQuE,EAAImsB,IAEd,MACF,IAAK,MACHC,EAAUA,CAAC96B,EAAGC,EAAGwO,EAAGC,KAAM,CACxB1O,EAAG,GAAKC,EAAIyO,EAAI2f,GAAUwM,EAC1B56B,GAAID,EAAIouB,GAAUwM,EAClB1wB,MAAOwE,EAAImsB,EACX1wB,OAAQsE,EAAImsB,IAEd,MACF,QACEE,EAAUA,CAAC96B,EAAGC,EAAGwO,EAAGC,KAAM,CACxB1O,GAAIA,EAAIouB,GAAUwM,EAClB36B,GAAIA,EAAIouB,GAAUwM,EAClB3wB,MAAOuE,EAAImsB,EACXzwB,OAAQuE,EAAImsB,IAKlB,MAAMziB,EAAQ,GACd,IAAK,IAAIxf,EAAI,EAAGuS,EAAK6jB,EAAUyL,WAAY7hC,EAAIuS,EAAIvS,IAAK,CACtD,MAAMmiC,EAAQ/L,EAAU0L,WAAW9hC,GACnC,IAAImiC,EAAMC,UAGV,IAAK,MAAM,EAAEh7B,EAAC,EAAEC,EAAC,MAAEiK,EAAK,OAAEC,KAAY4wB,EAAME,iBAC5B,IAAV/wB,GAA0B,IAAXC,GAGnBiO,EAAMlf,KAAK4hC,EAAQ96B,EAAGC,EAAGiK,EAAOC,GAEpC,CACA,OAAwB,IAAjBiO,EAAM7vB,OAAe,KAAO6vB,CACrC,CAEAgf,4BAAAA,CAA4B8D,GAA8B,IAA7B,oBAAE7F,EAAmB,GAAE1xB,GAAIu3B,GACrDpnB,EAAKoO,GAALh4B,OAAAkpB,EAAK8O,GAALh4B,KAAqC,IAAIqnB,MAAO7oB,IAC/C2sC,EACA1xB,EAEJ,CAEA4zB,+BAAAA,CAA+B4D,GAA0B,IAAAC,EAAA,IAAzB,oBAAE/F,GAAqB8F,EACrB,QAAhCC,EAAAtnB,EAAKoO,GAALh4B,aAAgC,IAAAkxC,GAAhCA,EAAkC7lB,OAAO8f,EAC3C,CAEAgG,uBAAAA,CAAwB7F,GAAY,IAAA8F,EAClC,MAAMC,EAA2C,QAAnCD,EAAGxnB,EAAKoO,GAALh4B,aAAgC,IAAAoxC,OAAA,EAAhCA,EAAkC9xC,IAAIgsC,EAAWpjB,KAAKzO,IACvE,IAAK43B,EACH,OAEF,MAAM7oB,EAASoB,EAAKmO,GAAL/3B,MAAwBimC,YAAYoL,GAC9C7oB,IAGDoB,EAAKgQ,GAAL55B,QAAekB,EAAqBC,MAASqnB,EAAO8oB,kBAGxD9oB,EAAO2oB,wBAAwB7F,EACjC,CAEAiG,gBAAAA,CAAiBxL,EAAcoF,EAAqBxY,GAAQ,IAAA6e,EAC1D,MAAMhpB,EAA8B,QAAxBgpB,EAAG5nB,EAAK8P,GAAL15B,aAAqB,IAAAwxC,OAAA,EAArBA,EAAuBlyC,IAAIymC,GACrCvd,IAGLA,EAAOipB,UAAUtG,EAAqBxY,GACtC/I,EAAK8P,GAAL15B,MAAsBqrB,OAAO0a,GAC/B,CAEA2L,gBAAAA,CAAiB3L,EAAcvd,IAC5BoB,EAAK8P,GAAL15B,OAAAkpB,EAAKwQ,GAAL15B,KAA0B,IAAIqnB,MAAO7oB,IAAIunC,EAAcvd,EAC1D,EACF,SAAA8c,GAAAqM,GA3iDgD,IAAhB,WAAE1M,GAAY0M,EAC1C,OAAO1M,EAAW2M,WAAaC,KAAKC,UAChC7M,EAAW8M,cACX9M,CACN,UAAAS,GAEsBL,GACpB,MAAM,aAAEkC,GAAiBvnC,KACzB,GAAIunC,EAAayK,aAAa3M,GAC5B,OAAOkC,EAET,IAAK,MAAMnI,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAClC,GAAID,EAAM4S,aAAa3M,GACrB,OAAOjG,EAGX,OAAO,IACT,UAAA6S,KAgDE,MAAMnN,EAAY/oB,SAASgpB,eAC3B,IAAKD,GAAaA,EAAUE,YAC1B,OAEF,MACMK,EADgBnmC,EAAAw7B,GAAA16B,KAAKslC,IAA6Bj0B,KAAlCrR,KAAmC8kC,GACzBS,QAAQ,cAClCrX,EAAQluB,KAAKwlC,kBAAkBH,GAChCnX,IAGLtE,EAAKsP,GAALl5B,OAAAkpB,EAAKgQ,GAALl5B,KAA0B,IAAIguB,GAAgBhuB,OAC9C4pB,EAAKsP,GAALl5B,MAAsB2qB,KAAK0a,EAAWnX,EAA0B,QAAnBluB,KAAKqqB,WACpD,UAAA6nB,KAiDmB,IAAAC,EACjB,MAAMrN,EAAY/oB,SAASgpB,eAC3B,IAAKD,GAAaA,EAAUE,YAAa,CACX,IAAAoN,EAA5B,GAAIxoB,EAAKkQ,GAAL95B,MACmB,QAArBoyC,EAAAxoB,EAAKsP,GAALl5B,aAAqB,IAAAoyC,GAArBA,EAAuB5nB,OACvBtB,EAAK4Q,GAAL95B,KAAyB,MACzBd,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBq9B,iBAAiB,IAGrB,MACF,CACA,MAAM,WAAE4H,GAAeH,EACvB,GAAIG,IAAerb,EAAKkQ,GAAL95B,MACjB,OAGF,MACMqlC,EADgBnmC,EAAAw7B,GAAA16B,KAAKslC,IAA6Bj0B,KAAlCrR,KAAmC8kC,GACzBS,QAAQ,cAEV,IAAA8M,EAD9B,GAAKhN,GAiBL,GANqB,QAArB8M,EAAAvoB,EAAKsP,GAALl5B,aAAqB,IAAAmyC,GAArBA,EAAuB3nB,OACvBtB,EAAK4Q,GAAL95B,KAAyBilC,GACzB/lC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBq9B,iBAAiB,KAIjBzT,EAAKgQ,GAAL55B,QAAekB,EAAqBG,WACpCuoB,EAAKgQ,GAAL55B,QAAekB,EAAqBC,QAKlCyoB,EAAKgQ,GAAL55B,QAAekB,EAAqBG,WACtCrB,KAAK6lC,eAAe,aAAa,GAA2B,GAG9D3c,EAAK+P,GAALj5B,KAA6BA,KAAKs+B,iBAC7Bt+B,KAAKs+B,gBAAgB,CACxB,MAAMgU,EACJ1oB,EAAKgQ,GAAL55B,QAAekB,EAAqBG,UAChCnC,EAAAw7B,GAAA16B,KAAK0lC,IAAqBr0B,KAA1BrR,KAA2BqlC,GAC3B,KAGN,GAFW,OAAXiN,QAAW,IAAXA,GAAAA,EAAaC,gBAET3oB,EAAKyP,GAALr5B,MAAqB,CACvB,MAAMy/B,EAAK,IAAIxC,gBACTtT,EAAS3pB,KAAKw/B,eAAeC,GAE7B+S,EAAYt0C,IACD,cAAXA,EAAEsC,MAAqC,IAAbtC,EAAEgtB,SAIhCuU,EAAGN,QACQ,OAAXmT,QAAW,IAAXA,GAAAA,EAAaC,eAAc,GACZ,cAAXr0C,EAAEsC,MACJtB,EAAAw7B,GAAA16B,KAAKwmC,IAAYn1B,KAAjBrR,KAAkB,kBAGtB8lB,OAAO/L,iBAAiB,YAAay4B,EAAW,CAAE7oB,WAClD7D,OAAO/L,iBAAiB,OAAQy4B,EAAW,CAAE7oB,UAC/C,MAIa,OAAX2oB,QAAW,IAAXA,GAAAA,EAAaC,eAAc,GAC3BrzC,EAAAw7B,GAAA16B,KAAKwmC,IAAYn1B,KAAjBrR,KAAkB,eAEtB,OA3DM4pB,EAAKkQ,GAAL95B,QACmB,QAArBqyC,EAAAzoB,EAAKsP,GAALl5B,aAAqB,IAAAqyC,GAArBA,EAAuB7nB,OACvBtB,EAAK4Q,GAAL95B,KAAyB,MACzBd,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CACzBq9B,iBAAiB,IAwDzB,UAAAmJ,KAEoC,IAAvB3B,EAAgB1lC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAC1ByqB,EAAKgQ,GAAL55B,QAAekB,EAAqBG,UACtCrB,KAAKyuB,mBAAmBoW,GACfjb,EAAK8O,GAAL14B,OACTd,EAAAw7B,GAAA16B,KAAKiyC,IAAuB5gC,KAA5BrR,KAEJ,UAAA+9B,KAGEhiB,SAAShC,iBACP,kBACA7a,EAAAw7B,GAAA16B,KAAKkyC,IAAiB3kB,KAAKvtB,MAC3B,CAAE2pB,OAAQ3pB,KAAK8pB,SAEnB,UAAA8e,KAGE,GAAIhf,EAAKmP,GAAL/4B,MACF,OAEFkpB,EAAK6P,GAAL/4B,KAAuB,IAAIi9B,iBAC3B,MAAMtT,EAAS3pB,KAAKw/B,eAAe5V,EAAKmP,GAAL/4B,OAEnC8lB,OAAO/L,iBAAiB,QAAS/Z,KAAKgkC,MAAMzW,KAAKvtB,MAAO,CAAE2pB,WAC1D7D,OAAO/L,iBAAiB,OAAQ/Z,KAAKumC,KAAKhZ,KAAKvtB,MAAO,CAAE2pB,UAC1D,UAAAqf,KAEsB,IAAAyJ,EACA,QAApBA,EAAA7oB,EAAKmP,GAAL/4B,aAAoB,IAAAyyC,GAApBA,EAAsBtT,QACtBjW,EAAK6P,GAAL/4B,KAAuB,KACzB,UAAAi+B,KA0CE,GAAIrU,EAAK2P,GAALv5B,MACF,OAEFkpB,EAAKqQ,GAALv5B,KAA0B,IAAIi9B,iBAC9B,MAAMtT,EAAS3pB,KAAKw/B,eAAe5V,EAAK2P,GAALv5B,OAInC8lB,OAAO/L,iBAAiB,UAAW/Z,KAAKwoC,QAAQjb,KAAKvtB,MAAO,CAAE2pB,WAC9D7D,OAAO/L,iBAAiB,QAAS/Z,KAAK0oC,MAAMnb,KAAKvtB,MAAO,CAAE2pB,UAC5D,UAAAod,KAEyB,IAAA2L,EACA,QAAvBA,EAAA9oB,EAAK2P,GAALv5B,aAAuB,IAAA0yC,GAAvBA,EAAyBvT,QACzBjW,EAAKqQ,GAALv5B,KAA0B,KAC5B,UAAA6oC,KAGE,GAAIjf,EAAKuO,GAALn4B,MACF,OAEFkpB,EAAKiP,GAALn4B,KAAoB,IAAIi9B,iBACxB,MAAMtT,EAAS3pB,KAAKw/B,eAAe5V,EAAKuO,GAALn4B,OAEnC+b,SAAShC,iBAAiB,OAAQ/Z,KAAKwnC,KAAKja,KAAKvtB,MAAO,CAAE2pB,WAC1D5N,SAAShC,iBAAiB,MAAO/Z,KAAK+nC,IAAIxa,KAAKvtB,MAAO,CAAE2pB,WACxD5N,SAAShC,iBAAiB,QAAS/Z,KAAKsnC,MAAM/Z,KAAKvtB,MAAO,CAAE2pB,UAC9D,UAAAsf,KAE4B,IAAA0J,EACT,QAAjBA,EAAA/oB,EAAKuO,GAALn4B,aAAiB,IAAA2yC,GAAjBA,EAAmBxT,QACnBjW,EAAKiP,GAALn4B,KAAoB,KACtB,UAAAg+B,KAGE,MAAMrU,EAAS3pB,KAAK8pB,QACpB/N,SAAShC,iBAAiB,WAAY/Z,KAAKgnC,SAASzZ,KAAKvtB,MAAO,CAAE2pB,WAClE5N,SAAShC,iBAAiB,OAAQ/Z,KAAKonC,KAAK7Z,KAAKvtB,MAAO,CAAE2pB,UAC5D,UAAAmf,GAoMsBj7B,GACDvP,OAAO6c,QAAQtN,GAAS+kC,KACzCC,IAAA,IAAE33B,EAAKpb,GAAM+yC,EAAA,OAAKjpB,EAAKuQ,GAALn6B,MAAqBkb,KAASpb,MAIhDE,KAAKs9B,UAAUoG,SAAS,gCAAiC,CACvDC,OAAQ3jC,KACR6N,QAASvP,OAAO8c,OAAOwO,EAAKuQ,GAALn6B,MAAsB6N,KAM7C+b,EAAKgQ,GAAL55B,QAAekB,EAAqBG,YACN,IAA9BwM,EAAQuvB,mBAERl+B,EAAAw7B,GAAA16B,KAAKopC,IAAiB/3B,KAAtBrR,KAAuB,CACrB,CAAC2B,EAA2BW,gBAAgB,KAIpD,UAAA8mC,GAEkBv7B,GAChB7N,KAAKs9B,UAAUoG,SAAS,gCAAiC,CACvDC,OAAQ3jC,KACR6N,WAEJ,gBAAA+8B,KAiTE,IAAKhhB,EAAKwP,GAALp5B,MAAiB,CACpBkpB,EAAKkQ,GAALp5B,MAAkB,GAClB,MAAM8yC,EAAW,GACjB,IAAK,MAAM1T,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAClCyT,EAAS9jC,KAAKowB,EAAMsK,gBAEhBhqC,QAAQqzC,IAAID,GAClB,IAAK,MAAMtqB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SACpC7W,EAAOkhB,QAEX,CACF,UAAAc,KAOE,GADAxqC,KAAKi8B,cACDrS,EAAKwP,GAALp5B,MAAiB,CACnBkpB,EAAKkQ,GAALp5B,MAAkB,GAClB,IAAK,MAAMo/B,KAASxV,EAAKiO,GAAL73B,MAAgBq/B,SAClCD,EAAMuK,UAER,IAAK,MAAMnhB,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SACpC7W,EAAOmhB,SAEX,CACF,UAAAtB,GA8FkB7f,GAChB,MAAM4W,EAAQxV,EAAKiO,GAAL73B,MAAgBV,IAAIkpB,EAAOiZ,WACrCrC,EACFA,EAAM2Q,aAAavnB,IAEnBxoB,KAAK4sC,UAAUpkB,GACfxoB,KAAKkmC,uBAAuB1d,GAEhC,UAAAilB,GAAAuF,GAkBE,IAAIlF,EAAK,KACT,IAAKA,KAAMlkB,EAAKiQ,GAAgBmZ,IAGhC,OAAOlF,CACT,UAAA/E,KA6IE,GAA8B,IAA1Bnf,EAAKgO,GAAL53B,MAAiBywB,KACnB,OAAO,EAGT,GAA8B,IAA1B7G,EAAKgO,GAAL53B,MAAiBywB,KACnB,IAAK,MAAMjI,KAAUoB,EAAKgO,GAAL53B,MAAiBq/B,SACpC,OAAO7W,EAAO2U,UAIlB,OAAO,CACT,UAAAmL,GAgDeZ,GACb,IAAK,MAAMlf,KAAUoB,EAAKiQ,GAAL75B,MACnBwoB,EAAOojB,WAEThiB,EAAKiQ,GAAL75B,MAAsBs/B,QACtB,IAAK,MAAM9W,KAAUkf,EACflf,EAAO2U,YAGXvT,EAAKiQ,GAAL75B,MAAsBhB,IAAIwpB,GAC1BA,EAAOolB,UAET1uC,EAAAw7B,GAAA16B,KAAK8oC,IAAqBz3B,KAA1BrR,KAA2B,CAAEo9B,kBAAmBp9B,KAAKymC,cACvD,EAAA5nB,EAAAA,EAAAA,GArzDI8b,GAAyB,kBA4GJ,IAAC9b,EAAAA,EAAAA,GA5GtB8b,GAAyB,gBA8GN,I,uMCvvBzB,MAAMsY,GA6BJzlC,WAAAA,CAAYgb,GAAQ1pB,EAAA,KAAAo0C,IA5BpBj0C,EAAA,KAAAk0C,GAAW,MAEXl0C,EAAA,KAAAm0C,IAAqB,GAErBn0C,EAAA,KAAAo0C,GAAiB,MAEjBp0C,EAAA,KAAAq0C,GAAsB,MAEtBr0C,EAAA,KAAAs0C,GAAkB,MAElBt0C,EAAA,KAAAu0C,GAAyB,MAEzBv0C,EAAA,KAAAw0C,IAA0B,GAE1Bx0C,EAAA,KAAAy0C,GAAS,MAETz0C,EAAA,KAAA00C,GAAU,MAEV10C,EAAA,KAAA20C,GAAe,MAEf30C,EAAA,KAAA40C,GAAsB,MAEtB50C,EAAA,KAAA60C,IAAqB,GAOnB5qB,EAAKyqB,GAAL3zC,KAAewoB,GACfU,EAAK4qB,GAAL9zC,KAA0BwoB,EAAOqB,WAAW8V,mBAEpCoU,GAAcnxB,IAAdmxB,GAAcnxB,EAAKtkB,OAAO8qB,OAAO,CACvC4qB,MAAO,yCACP,cAAe,+CACf/lC,QAAS,2CACT,gBAAiB,iDACjBgmC,OAAQ,6CACR,eAAgB,qDAEpB,CAEA,iBAAOC,CAAWC,GAAM,IAAAC,EACT,QAAbA,EAAAnB,GAAQoB,aAAK,IAAAD,IAAbnB,GAAQoB,MAAUF,EACpB,CAEA,YAAM14B,GACJ,MAAM8P,EAAWrC,EAAKmqB,GAALrzC,KAAsB+b,SAASC,cAAc,WAC9DuP,EAAQ7D,UAAY,UACpB6D,EAAQJ,SAAW,IAEnB,MAAMmpB,EAASprB,EAAKoqB,GAALtzC,KAA2B+b,SAASC,cAAc,SACjEuP,EAAQnP,OAAOk4B,GAEX1qB,EAAKkqB,GAAL9zC,OACFurB,EAAQvD,UAAUhpB,IAAI,OACtBusB,EAAQnR,aAAa,eAAwB25B,GAAcnxB,EAAC3U,SAC5DqmC,EAAMl6B,aACJ,eACQ25B,GAAcnxB,EAAC,oBAGzB2I,EAAQnR,aAAa,eAAgB,gCACrCk6B,EAAMl6B,aAAa,eAAgB,uCAGrC,MAAMuP,EAASC,EAAK+pB,GAAL3zC,MAAa6pB,WAAWC,QACvCyB,EAAQxR,iBAAiB,cAAeqI,GAAe,CAAEuH,WACzD4B,EAAQxR,iBAAiB,cAAeC,GAASA,EAAMuI,kBAAmB,CACxEoH,WAGF,MAAM4qB,EAAUv6B,IACdA,EAAMqI,iBACNuH,EAAK+pB,GAAL3zC,MAAa6pB,WAAWmX,YAAYpX,EAAK+pB,GAAL3zC,OAChC4pB,EAAKkqB,GAAL9zC,OACF4pB,EAAK+pB,GAAL3zC,MAAaw0C,iBAAiB,CAC5BvI,OAAQ,kDACR/jB,KAAM,CAAEosB,MAAOl1C,EAAA8zC,GAAAlzC,KAAKy0C,QAiB1B,OAbAlpB,EAAQxR,iBAAiB,QAASw6B,EAAS,CAAE/mB,SAAS,EAAM7D,WAC5D4B,EAAQxR,iBACN,UACAC,IACMA,EAAME,SAAWqR,GAAyB,UAAdvR,EAAMkB,MACpCgO,EAAKuqB,GAALzzC,MAA+B,GAC/Bu0C,EAAQv6B,KAGZ,CAAE2P,iBAEEzqB,EAAAg0C,GAAAlzC,KAAK00C,IAASrjC,KAAdrR,MAECurB,CACT,CAUAopB,MAAAA,GACO/qB,EAAKypB,GAALrzC,QAGL4pB,EAAKypB,GAALrzC,MAAoBgkC,MAAM,CAAE4Q,aAAchrB,EAAK6pB,GAALzzC,QAC1CkpB,EAAKuqB,GAALzzC,MAA+B,GACjC,CAEAm9B,OAAAA,GACE,OAAIvT,EAAKkqB,GAAL9zC,MACuB,OAAlB4pB,EAAKupB,GAALnzC,OAED4pB,EAAKupB,GAALnzC,QAAkB4pB,EAAKwpB,GAALpzC,KAC5B,CAEA60C,OAAAA,GACE,OAAIjrB,EAAKkqB,GAAL9zC,MACuB,OAAlB4pB,EAAKupB,GAALnzC,SAA4B4pB,EAAKgqB,GAAL5zC,MAE9BA,KAAKm9B,SACd,CAEA,eAAI2X,GACF,OAAOlrB,EAAKgqB,GAAL5zC,KACT,CAEA,oBAAM+0C,CAAeD,GACG,OAAlBlrB,EAAKupB,GAALnzC,QAIJkpB,EAAK0qB,GAAL5zC,KAAoB80C,GACpB5rB,EAAK2qB,GAAL7zC,WAAiCizC,GAAQoB,MAAM/0C,IAC7C,+DACA,CAAE01C,iBAAkBF,KAEtB51C,EAAAg0C,GAAAlzC,KAAK00C,IAASrjC,KAAdrR,MACF,CAEAi1C,kBAAAA,GAAuC,IAApBne,EAAU33B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACoB,IAAA+1C,EAA/C,IAAKtrB,EAAKkqB,GAAL9zC,OAA2B4pB,EAAKupB,GAALnzC,MAG9B,OAFW,QAAXk1C,EAAAtrB,EAAK8pB,GAAL1zC,aAAW,IAAAk1C,GAAXA,EAAapqB,cACb5B,EAAKwqB,GAAL1zC,KAAc,MAGhB,IAAK4pB,EAAK8pB,GAAL1zC,MAAa,CAChB,MAAMm1C,EAASjsB,EAAKwqB,GAAL1zC,KAAc+b,SAASC,cAAc,QACpDm5B,EAAMztB,UAAY,iBAClBkC,EAAK+pB,GAAL3zC,MAAamc,IAAIC,OAAO+4B,EAC1B,CACAvrB,EAAK8pB,GAAL1zC,MAAYgoB,UAAUqc,OAAO,UAAWvN,EAC1C,CAEA8Q,SAAAA,CAAUwN,GACR,IAAI7pB,EAAU3B,EAAKupB,GAALnzC,MAId,OAHKo1C,GAAgBxrB,EAAKgqB,GAAL5zC,QAAsBurB,IACzCA,EAAU3B,EAAKiqB,GAAL7zC,OAEL,CACLurB,UACA8pB,WAAYzrB,EAAKwpB,GAALpzC,MACZ80C,YAAalrB,EAAKgqB,GAAL5zC,MACbs1C,mBAAoB1rB,EAAKiqB,GAAL7zC,MAExB,CAEA,QAAIkoB,GACF,MAAO,CACLqD,QAAS3B,EAAKupB,GAALnzC,MACTq1C,WAAYzrB,EAAKwpB,GAALpzC,MAEhB,CAKA,QAAIkoB,CAAIqtB,GAML,IANM,QACPhqB,EAAO,WACP8pB,EAAU,YACVP,EAAW,mBACXQ,EAAkB,OAClBE,GAAS,GACVD,EACKT,IACF5rB,EAAK0qB,GAAL5zC,KAAoB80C,GACpB5rB,EAAK2qB,GAAL7zC,KAA2Bs1C,IAEzB1rB,EAAKupB,GAALnzC,QAAkBurB,GAAW3B,EAAKwpB,GAALpzC,QAA4Bq1C,IAGxDG,IACHtsB,EAAKiqB,GAALnzC,KAAgBurB,GAChBrC,EAAKkqB,GAALpzC,KAA0Bq1C,IAE5Bn2C,EAAAg0C,GAAAlzC,KAAK00C,IAASrjC,KAAdrR,MACF,CAEAqkC,MAAAA,GAAwB,IAAjBoR,EAAOt2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACPyqB,EAAKypB,GAALrzC,SAGAy1C,GAAW7rB,EAAK4pB,GAALxzC,QACdu/B,aAAa3V,EAAK4pB,GAALxzC,OACbkpB,EAAKsqB,GAALxzC,KAA8B,OAEhC4pB,EAAKypB,GAALrzC,MAAoB01C,UAAYD,EAClC,CAEA1qB,KAAAA,GACEnB,EAAK+pB,GAAL3zC,MAAaw0C,iBAAiB,CAC5BvI,OAAQ,oDACR/jB,KAAM,CAAEosB,MAAOl1C,EAAA8zC,GAAAlzC,KAAKy0C,MAExB,CAEAtnB,OAAAA,GAAU,IAAAwoB,EAAAC,EACW,QAAnBD,EAAA/rB,EAAKypB,GAALrzC,aAAmB,IAAA21C,GAAnBA,EAAqB7qB,SACrB5B,EAAKmqB,GAALrzC,KAAsB,MACtBkpB,EAAKoqB,GAALtzC,KAA2B,MAC3BkpB,EAAKqqB,GAALvzC,KAAuB,MACZ,QAAX41C,EAAAhsB,EAAK8pB,GAAL1zC,aAAW,IAAA41C,GAAXA,EAAa9qB,SACb5B,EAAKwqB,GAAL1zC,KAAc,KAChB,EAyFF,SAAAy0C,GAAAoB,GA1NI,OACGjsB,EAAKupB,GAAQ0C,GAAI,QACC,OAAlBjsB,EAAKupB,GAAQ0C,IAAaA,EAAKf,aAAe,WAC/C,SAEJ,gBAAAJ,KA+HE,MAAMxpB,EAAStB,EAAKypB,GAALrzC,MACf,IAAKkrB,EACH,OAGF,GAAItB,EAAKkqB,GAAL9zC,MAAyB,KAAA81C,EAQPC,EAApB,GAPA7qB,EAAOlD,UAAUqc,OAAO,SAAUza,EAAKupB,GAALnzC,OAClCkrB,EAAO9Q,aAAa,eAAwB25B,GAAcnxB,EAACxjB,EAAA8zC,GAAAlzC,KAAKy0C,MAExC,QAAxBqB,EAAAlsB,EAAK0pB,GAALtzC,aAAwB,IAAA81C,GAAxBA,EAA0B17B,aACxB,eACQ25B,GAAcnxB,EAAC,GAAD5X,OAAI5L,EAAA8zC,GAAAlzC,KAAKy0C,IAAM,aAElC7qB,EAAKupB,GAALnzC,MAEH,YADoB,QAApB+1C,EAAAnsB,EAAK2pB,GAALvzC,aAAoB,IAAA+1C,GAApBA,EAAsBjrB,SAG1B,KAAO,CAC2C,IAAAkrB,EAAhD,IAAKpsB,EAAKupB,GAALnzC,QAAkB4pB,EAAKwpB,GAALpzC,MAGrB,OAFAkrB,EAAOlD,UAAU8C,OAAO,aACJ,QAApBkrB,EAAApsB,EAAK2pB,GAALvzC,aAAoB,IAAAg2C,GAApBA,EAAsBlrB,UAGxBI,EAAOlD,UAAUhpB,IAAI,QACrBksB,EAAO9Q,aAAa,eAAgB,oCACtC,CAEA,IAAI67B,EAAUrsB,EAAK2pB,GAALvzC,MACd,IAAKi2C,EAAS,CACZ/sB,EAAKqqB,GAALvzC,KAAuBi2C,EAAUl6B,SAASC,cAAc,SACxDi6B,EAAQvuB,UAAY,UACpBuuB,EAAQ77B,aAAa,OAAQ,WAC7B67B,EAAQx8B,GAAK,oBAAHzO,OAAuB4e,EAAK+pB,GAAL3zC,MAAayZ,IAE9C,MAAMy8B,EAAwB,IACxBvsB,EAASC,EAAK+pB,GAAL3zC,MAAa6pB,WAAWC,QACvCH,EAAO5P,iBACL,QACA,KACEwlB,aAAa3V,EAAK4pB,GAALxzC,OACbkpB,EAAKsqB,GAALxzC,KAA8B,OAEhC,CAAEyjC,MAAM,IAEVvY,EAAOnR,iBACL,aACA,KACEmP,EAAKsqB,GAALxzC,KAA8BgtC,WAAW,KACvC9jB,EAAKsqB,GAALxzC,KAA8B,MAC9B4pB,EAAK2pB,GAALvzC,MAAqBgoB,UAAUhpB,IAAI,QACnC4qB,EAAK+pB,GAAL3zC,MAAaw0C,iBAAiB,CAC5BvI,OAAQ,sBAETiK,KAEL,CAAEvsB,WAEJuB,EAAOnR,iBACL,aACA,KAAM,IAAAo8B,EACAvsB,EAAK4pB,GAALxzC,QACFu/B,aAAa3V,EAAK4pB,GAALxzC,OACbkpB,EAAKsqB,GAALxzC,KAA8B,OAEZ,QAApBm2C,EAAAvsB,EAAK2pB,GAALvzC,aAAoB,IAAAm2C,GAApBA,EAAsBnuB,UAAU8C,OAAO,SAEzC,CAAEnB,UAEN,CACIC,EAAKwpB,GAALpzC,MACFi2C,EAAQ77B,aACN,eACA,6CAGF67B,EAAQ37B,gBAAgB,gBACxB27B,EAAQv9B,YAAckR,EAAKupB,GAALnzC,OAGnBi2C,EAAQG,YACXlrB,EAAO9O,OAAO65B,GAGhB,MAAMv8B,EAAUkQ,EAAK+pB,GAAL3zC,MAAaq2C,uBACtB,OAAP38B,QAAO,IAAPA,GAAAA,EAASU,aAAa,mBAAoB67B,EAAQx8B,GACpD,KAAAs6B,GAAA,CAAAnxB,EApSwB,OAAI/D,EAAAA,EAAAA,GAzBxBo0B,GAAO,QA2BI,M,yKC3BjB,MAAMqD,GAqBJ9oC,WAAAA,CAAYgb,GAAQ1pB,EAAA,KAAAy3C,IApBpBt3C,EAAA,KAAAu3C,GAA2B,MAE3Bv3C,EAAA,KAAAw3C,GAAwB,MAExBx3C,EAAA,KAAAy3C,IAA0B,GAE1Bz3C,EAAA,KAAA03C,GAAU,MAEV13C,EAAA,KAAA23C,GAAe,MAEf33C,EAAA,KAAA43C,GAAY,MAEZ53C,EAAA,KAAA63C,GAAQ,MAER73C,EAAA,KAAA83C,GAAQ,MAER93C,EAAA,KAAA+3C,IAAW,GAEX/3C,EAAA,KAAAg4C,GAAiB,MAGf/tB,EAAKytB,GAAL32C,KAAewoB,EACjB,CAEAoD,gBAAAA,GACE,MAAMV,EAAUhC,EAAKutB,GAALz2C,KACd+b,SAASC,cAAc,WAEzB,OADAkP,EAAOxD,UAAY,UACZxoB,EAAAq3C,GAAAv2C,KAAKk3C,IAAO7lC,KAAZrR,KAAakrB,GAAQ,EAC9B,CAEAisB,mBAAAA,GACE,MAAMjsB,EAAUhC,EAAKstB,GAALx2C,KACd+b,SAASC,cAAc,WACzBkP,EAAOxD,UAAY,0BAEnB,MAAMyC,EAAWP,EAAK+sB,GAAL32C,MAAao3C,sBAC9B,GAAIjtB,EAAU,CACZ,MAAM,MAAE9O,GAAU6P,EAClB7P,EAAMiP,eAAiB,QAAHtf,OAClB,KACuC,QAAtC4e,EAAK+sB,GAAL32C,MAAa6pB,WAAWQ,UACrB,EAAIF,EAAS,GACbA,EAAS,IAAG,kCAElB9O,EAAMkP,IAAM,QAAHvf,OAAW,IAAMmf,EAAS,GAAE,kCACrC,MAAMxG,EAAQiG,EAAK+sB,GAAL32C,MAAaq3C,mBACvB1zB,IACFtI,EAAMi8B,gBAAkB3zB,EAE5B,CAEA,OAAOzkB,EAAAq3C,GAAAv2C,KAAKk3C,IAAO7lC,KAAZrR,KAAakrB,GAAQ,EAC9B,CAEAqsB,WAAAA,GACEvK,WAAW,KAAM,IAAAwK,EAAAC,EAC6C,QAA5DD,EAA8B,QAA9BC,EAAC7tB,EAAK4sB,GAALx2C,aAA6B,IAAAy3C,EAAAA,EAAI7tB,EAAK6sB,GAALz2C,aAA0B,IAAAw3C,GAA5DA,EAA+DxT,SAC9D,EACL,CAEA0T,cAAAA,GACE,IAAK9tB,EAAK4sB,GAALx2C,MACH,OAEF,MAAM2jB,EAAQiG,EAAK+sB,GAAL32C,MAAaq3C,mBACvB1zB,IACFiG,EAAK4sB,GAALx2C,MAA8Bqb,MAAMi8B,gBAAkB3zB,GAExDiG,EAAK+sB,GAAL32C,MAAa6pB,WAAWmY,iBAAiBpY,EAAK+sB,GAAL32C,MAC3C,CAEA,sBAAI23C,GAAqB,IAAAC,EAAAC,EACvB,OAC+D,QAA7DD,EAA8B,QAA9BC,EAACjuB,EAAK4sB,GAALx2C,aAA6B,IAAA63C,OAAA,EAA7BA,EAA+BzT,wBAAwBpkB,aAAK,IAAA43B,EAAAA,EAAI,GACjEhuB,EAAK+sB,GAAL32C,MAAa2c,OAAOm7B,mBAAmB93B,KAE3C,CAEA,+BAAI+3B,GACF,GAAInuB,EAAKqtB,GAALj3C,MACF,OAAO4pB,EAAKqtB,GAALj3C,MAET,IAAK4pB,EAAK4sB,GAALx2C,MACH,OAAO,KAET,MAAM,EAAE8V,EAAC,EAAEC,EAAC,OAAEkK,GACZ2J,EAAK4sB,GAALx2C,MAA8BokC,yBAE9BtuB,EAAGkiC,EACHjiC,EAAGkiC,EACHj4B,MAAO0wB,EACPzwB,OAAQ0wB,GACN/mB,EAAK+sB,GAAL32C,MAAa2c,OAAOm7B,mBACxB,MAAO,EAAEhiC,EAAIkiC,GAAWtH,GAAc36B,EAAIkK,EAASg4B,GAAWtH,EAChE,CAEA,+BAAIoH,CAA4BhlC,GAC9BmW,EAAK+tB,GAALj3C,KAAsB+S,EACxB,CAEAmlC,uBAAAA,GACE,OAA+B,OAAxBtuB,EAAKqtB,GAALj3C,KACT,CAEAm4C,6BAAAA,GAAgC,IAAAC,EACD,QAA7BA,EAAAxuB,EAAK4sB,GAALx2C,aAA6B,IAAAo4C,GAA7BA,EAA+BttB,SAC/B5B,EAAKstB,GAALx2C,KAAgC,KAClC,CAEAysB,0BAAAA,GAA6B,IAAA4rB,EACD,QAA1BA,EAAAzuB,EAAK6sB,GAALz2C,aAA0B,IAAAq4C,GAA1BA,EAA4BvtB,SAC5B5B,EAAKutB,GAALz2C,KAA6B,KAC/B,CAEAs4C,sBAAAA,CAAsBC,GAAyB,IAAxB,SAAE79B,EAAQ,SAAE89B,GAAUD,EACtC3uB,EAAK4sB,GAALx2C,QAGL4pB,EAAK4sB,GAALx2C,MAA8BgoB,UAAUqc,OAAO,WAAY3pB,GAC3DkP,EAAK4sB,GAALx2C,MAA8By4C,aAAeD,EAC/C,CAkGAE,IAAAA,CAAKhtC,GACH,MAAMye,EAAWnqB,KAAK+3C,4BACtB,IAAI3W,EAAMC,EACV,GAAIlX,GACDiX,EAAMC,GAAQlX,MACV,EAEJiX,EAAMC,GAAQzX,EAAK+sB,GAAL32C,MAAao3C,sBAC5B,MAAM,MAAEp3B,EAAK,OAAEC,EAAM,EAAEnK,EAAC,EAAEC,GAAM6T,EAAK+sB,GAAL32C,MAChCohC,EAAOtrB,EAAIsrB,EAAOphB,EAClBqhB,EAAOtrB,EAAIsrB,EAAOphB,CACpB,CACA,MAAM04B,EAAmB/uB,EAAK+sB,GAAL32C,MAAa2c,OAAOm7B,oBAE3ChiC,EAAGkiC,EACHjiC,EAAGkiC,EACHj4B,MAAO0wB,EACPzwB,OAAQ0wB,GACNgI,EACJ/uB,EAAK+sB,GAAL32C,MAAa6pB,WAAWsX,YACtBvX,EAAK+sB,GAAL32C,MACAg4C,EAAU5W,EAAOsP,EACjBuH,EAAU5W,EAAOsP,GAAY3E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACxBtgC,GAAO,IAAEitC,qBAElB,CAEAhE,MAAAA,GACO/qB,EAAK6sB,GAALz2C,QAGL4pB,EAAK6sB,GAALz2C,MAA2BgkC,MAAM,CAC/B4Q,aAAchrB,EAAK8sB,GAAL12C,QAEhBkpB,EAAKwtB,GAAL12C,MAA+B,GACjC,CAEA44C,SAAAA,GACE,OAAOhvB,EAAKotB,GAALh3C,OAAgC,KAAf4pB,EAAKktB,GAAL92C,KAC1B,CAEAm9B,OAAAA,GACE,OAAsB,OAAfvT,EAAKktB,GAAL92C,KACT,CAEA64C,aAAAA,GACE,OAAO74C,KAAK44C,aAAehvB,EAAKktB,GAAL92C,QAAe4pB,EAAKgtB,GAAL52C,KAC5C,CAEA4nC,SAAAA,GACE,OAAO5nC,KAAKkoB,IACd,CAEA,QAAIA,GACF,MAAO,CACLhK,KAAM0L,EAAKktB,GAAL92C,MACN84C,SAAUlvB,EAAKitB,GAAL72C,MACV+4C,KAAMnvB,EAAKmtB,GAAL/2C,MACNqrC,QAASrrC,KAAK44C,YAElB,CAKA,QAAI1wB,CAAKhK,GAIP,GAHIA,IAAS0L,EAAKktB,GAAL92C,OACXkpB,EAAK2tB,GAAL72C,KAAiB,MAEN,OAATke,EAGF,OAFAgL,EAAK4tB,GAAL92C,KAAa,SACbkpB,EAAK8tB,GAALh3C,MAAgB,GAGlBkpB,EAAK4tB,GAAL92C,KAAake,GACbgL,EAAK6tB,GAAL/2C,KAAa,IAAI2hB,MACjBuH,EAAK8tB,GAALh3C,MAAgB,EAClB,CAEAg5C,cAAAA,CAAe96B,GAAuB,IAAjB46B,EAAQ35C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC9B+pB,EAAK0tB,GAAL52C,KAAoBke,GACpBle,KAAKkoB,KAAOhK,EACZgL,EAAK6tB,GAAL/2C,KAAa,MACbkpB,EAAK2tB,GAAL72C,KAAiB84C,EACnB,CAEA/tB,KAAAA,GAAS,CAEToC,OAAAA,GAAU,IAAA8rB,EAAAC,EACkB,QAA1BD,EAAArvB,EAAK6sB,GAALz2C,aAA0B,IAAAi5C,GAA1BA,EAA4BnuB,SAC5B5B,EAAKutB,GAALz2C,KAA6B,MACA,QAA7Bk5C,EAAAtvB,EAAK4sB,GAALx2C,aAA6B,IAAAk5C,GAA7BA,EAA+BpuB,SAC/B5B,EAAKstB,GAALx2C,KAAgC,MAChCkpB,EAAK4tB,GAAL92C,KAAa,IACbkpB,EAAK2tB,GAAL72C,KAAiB,MACjBkpB,EAAK6tB,GAAL/2C,KAAa,MACbkpB,EAAKytB,GAAL32C,KAAe,MACfkpB,EAAKwtB,GAAL12C,MAA+B,GAC/BkpB,EAAK8tB,GAALh3C,MAAgB,EAClB,EACF,SAAAk3C,GApMUxrB,EAASytB,GACf,IAAKvvB,EAAK+sB,GAAL32C,MAAa6pB,WAAWyE,oBAC3B,OAAO,KAGT5C,EAAQP,SAAW,IACnBO,EAAQ0tB,aAAe,SAEnBD,GACFztB,EAAQ2tB,aAAe,eACvB3tB,EAAQtR,aAAa,eAAgB,+BAErCsR,EAAQ4tB,qBAAuB,CAC7B1vB,EAAK+sB,GAAL32C,MAAa6pB,WAAW8Y,2BAE1BjX,EAAQtR,aAAa,eAAgB,oCAGvC,MAAMuP,EAASC,EAAK+sB,GAAL32C,MAAa6pB,WAAWC,QACvC,KAAMH,aAAkBI,cAAgBJ,EAAOK,QAC7C,OAAO0B,EAGTA,EAAQ3R,iBAAiB,cAAeqI,GAAe,CAAEuH,WACrDwvB,IACFztB,EAAQ3R,iBACN,UACA7b,IACE0rB,EAAK+sB,GAAL32C,MAAaqtB,qBAAsB,EACnC/K,GAAUpkB,IAEZ,CACEsvB,SAAS,EACT7D,WAGJ+B,EAAQ3R,iBACN,WACA7b,IACE0rB,EAAK+sB,GAAL32C,MAAaqtB,qBAAsB,EACnC/K,GAAUpkB,IAEZ,CACEsvB,SAAS,EACT7D,YAIN+B,EAAQ3R,iBAAiB,cAAeC,GAASA,EAAMuI,kBAAmB,CACxEoH,WAGF,MAAM4qB,EAAUv6B,IACdA,EAAMqI,iBACFqJ,IAAY9B,EAAK6sB,GAALz2C,MACdA,KAAK04C,OAEL9uB,EAAK+sB,GAAL32C,MAAa4hC,eAAiC,IAoClD,OAjCAlW,EAAQ3R,iBAAiB,QAASw6B,EAAS,CAAE/mB,SAAS,EAAM7D,WAC5D+B,EAAQ3R,iBACN,UACAC,IACMA,EAAME,SAAWwR,GAAyB,UAAd1R,EAAMkB,MACpCgO,EAAKwtB,GAAL12C,MAA+B,GAC/Bu0C,EAAQv6B,KAGZ,CAAE2P,WAGJ+B,EAAQ3R,iBACN,eACA,KACE6P,EAAK+sB,GAAL32C,MAAa4hC,eACQ,GACA,IAGvB,CAAEjY,WAEJ+B,EAAQ3R,iBACN,eACA,KACE6P,EAAK+sB,GAAL32C,MAAa4hC,eACQ,GACA,IAGvB,CAAEjY,WAGG+B,CACT,C,uMC1NF,MAAM6tB,GAyBJ/rC,WAAAA,CAAWgsC,GAQR,IAPDhyB,UAAAA,EAAS,mBACTiyB,EAAqB,KAAI,kBACzBC,EAAoB,KAAI,aACxBC,EAAe,KAAI,WACnBC,EAAa,KAAI,WACjBC,EAAa,KACblwB,OAAAA,GACD6vB,EAAA16C,EAAA,KAAAg7C,IAhCD76C,EAAA,KAAA86C,QAAU,GAEV96C,EAAA,KAAA+6C,IAAc,GAEd/6C,EAAA,KAAAg7C,GAAqB,MAErBh7C,EAAA,KAAAi7C,QAAmB,GAEnBj7C,EAAA,KAAAk7C,QAAa,GAEbl7C,EAAA,KAAAm7C,QAAW,GAEXn7C,EAAA,KAAAo7C,QAAW,GAEXp7C,EAAA,KAAAq7C,GAAiB,MAEjBr7C,EAAA,KAAAs7C,QAAO,GAEPt7C,EAAA,KAAAu7C,GAAa,MAEbv7C,EAAA,KAAAw7C,QAAe,GAEfx7C,EAAA,KAAAy7C,GAAe,MAWbxxB,EAAK6wB,GAAL/5C,KAAkBwnB,GAClB0B,EAAK+wB,GAALj6C,KAA0B05C,GAC1BxwB,EAAKgxB,GAALl6C,KAA2By5C,GAC3BvwB,EAAKixB,GAALn6C,KAAqB25C,GACrBzwB,EAAKkxB,GAALp6C,KAAmB45C,GACnB1wB,EAAKmxB,GAALr6C,KAAmB65C,GACnB3wB,EAAKuxB,GAALz6C,KAAuB,IAAIi9B,iBAC3B/T,EAAKqxB,GAALv6C,KAAe+pB,YAAY2V,IAAI,CAAC/V,EAAQC,EAAK6wB,GAALz6C,MAAqB2pB,UAE7DnC,EAAUzN,iBAAiB,aAAc7a,EAAA46C,GAAA95C,KAAK26C,IAAcptB,KAAKvtB,MAAO,CACtE46C,SAAS,EACTjxB,OAAQC,EAAK2wB,GAALv6C,OAEZ,CAMA,+BAAI66C,GAOF,OAAO,GAAKl2B,GAAYC,UAC1B,CA0JAuI,OAAAA,GAAU,IAAA2tB,EAAAC,EACY,QAApBD,EAAAlxB,EAAK6wB,GAALz6C,aAAoB,IAAA86C,GAApBA,EAAsB3b,QACtBjW,EAAKuxB,GAALz6C,KAAuB,MACJ,QAAnB+6C,EAAAnxB,EAAK0wB,GAALt6C,aAAmB,IAAA+6C,GAAnBA,EAAqB5b,QACrBjW,EAAKoxB,GAALt6C,KAAsB,KACxB,EA5NgB,SAAA26C,GA+DF9c,GAAK,IAAAmd,EAAAC,EACjB,GAA4B,QAA5BD,EAAIpxB,EAAKswB,GAALl6C,aAAwB,IAAAg7C,GAAAA,EAAA3pC,KAAxBrR,MACF,OAGF,GAA2B,IAAvB69B,EAAIqd,QAAQ78C,OAAc,CAC5B,GAAIurB,EAAK0wB,GAALt6C,MACF,OAEF,MAAMm7C,EAAiBjyB,EAAKoxB,GAALt6C,KAAsB,IAAIi9B,iBAC3CtT,EAASI,YAAY2V,IAAI,CAAC9V,EAAK2wB,GAALv6C,MAAcm7C,EAAcxxB,SACtDnC,EAAYoC,EAAKmwB,GAAL/5C,MAIZo7C,EAAO,CAAE5tB,SAAS,EAAM7D,SAAQixB,SAAS,GACzCS,EAAoBn9C,IACO,IAAAo9C,EAAT,UAAlBp9C,EAAEwxB,cACe,QAAnB4rB,EAAA1xB,EAAK0wB,GAALt6C,aAAmB,IAAAs7C,GAAnBA,EAAqBnc,QACrBjW,EAAKoxB,GAALt6C,KAAsB,QAiB1B,OAdAwnB,EAAUzN,iBACR,cACA7b,IACwB,UAAlBA,EAAEwxB,cAGJpN,GAAUpkB,GACVm9C,EAAkBn9C,KAGtBk9C,GAEF5zB,EAAUzN,iBAAiB,YAAashC,EAAmBD,QAC3D5zB,EAAUzN,iBAAiB,gBAAiBshC,EAAmBD,EAEjE,CAEA,IAAKxxB,EAAK8wB,GAAL16C,MAAmB,KAAAu7C,EACtBryB,EAAKwxB,GAAL16C,KAAoB,IAAIi9B,iBACxB,MAAMtT,EAASI,YAAY2V,IAAI,CAAC9V,EAAK2wB,GAALv6C,MAAc4pB,EAAK8wB,GAAL16C,MAAkB2pB,SAC1DnC,EAAYoC,EAAKmwB,GAAL/5C,MAEZw7C,EAAM,CAAE7xB,SAAQ6D,SAAS,EAAOotB,SAAS,GAC/CpzB,EAAUzN,iBACR,YACA7a,EAAA46C,GAAA95C,KAAKy7C,IAAaluB,KAAKvtB,MACvBw7C,GAEF,MAAME,EAAax8C,EAAA46C,GAAA95C,KAAK27C,IAAYpuB,KAAKvtB,MACzCwnB,EAAUzN,iBAAiB,WAAY2hC,EAAYF,GACnDh0B,EAAUzN,iBAAiB,cAAe2hC,EAAYF,GAEtDA,EAAIhuB,SAAU,EACdhG,EAAUzN,iBAAiB,cAAeuI,GAAWk5B,GACrDh0B,EAAUzN,iBAAiB,cAAeuI,GAAWk5B,GACrDh0B,EAAUzN,iBAAiB,gBAAiBuI,GAAWk5B,GACvDh0B,EAAUzN,iBAAiB,YAAauI,GAAWk5B,GACjC,QAAlBD,EAAA3xB,EAAKuwB,GAALn6C,aAAkB,IAAAu7C,GAAAA,EAAAlqC,KAAlBrR,KACF,CAIA,GAFAsiB,GAAUub,GAEiB,IAAvBA,EAAIqd,QAAQ78C,QAAuC,QAA3B48C,EAAIrxB,EAAKqwB,GAALj6C,aAAuB,IAAAi7C,GAAAA,EAAA5pC,KAAvBrR,MAE9B,YADAkpB,EAAKsxB,GAALx6C,KAAkB,MAIpB,IAAK47C,EAAQC,GAAUhe,EAAIqd,QACvBU,EAAOE,WAAaD,EAAOC,cAC5BF,EAAQC,GAAU,CAACA,EAAQD,IAE9B1yB,EAAKsxB,GAALx6C,KAAkB,CAChB+7C,QAASH,EAAOI,QAChBC,QAASL,EAAOM,QAChBC,QAASN,EAAOG,QAChBI,QAASP,EAAOK,SAEpB,UAAAT,GAEa5d,GAAK,IAAAwe,EAChB,IAAKzyB,EAAK4wB,GAALx6C,OAA0C,IAAvB69B,EAAIqd,QAAQ78C,OAClC,OAGFikB,GAAUub,GAEV,IAAK+d,EAAQC,GAAUhe,EAAIqd,QACvBU,EAAOE,WAAaD,EAAOC,cAC5BF,EAAQC,GAAU,CAACA,EAAQD,IAE9B,MAAQI,QAASM,EAAUJ,QAASK,GAAaX,GACzCI,QAASQ,EAAUN,QAASO,GAAaZ,EAC3Ca,EAAY9yB,EAAK4wB,GAALx6C,OAEhB+7C,QAASY,EACTV,QAASW,EACTT,QAASU,EACTT,QAASU,GACPJ,EAEEK,EAAWF,EAAWF,EACtBK,EAAWF,EAAWF,EACtBK,EAAWT,EAAWF,EACtBY,EAAWT,EAAWF,EAEtBY,EAAWvuC,KAAKwuC,MAAMH,EAAUC,IAAa,EAC7CG,EAAYzuC,KAAKwuC,MAAML,EAAUC,IAAa,EACpD,IACGpzB,EAAKowB,GAALh6C,OACD4O,KAAKmI,IAAIsmC,EAAYF,IAAa5D,EAAasB,4BAE/C,OAQF,GALA6B,EAAUX,QAAUO,EACpBI,EAAUT,QAAUM,EACpBG,EAAUP,QAAUK,EACpBE,EAAUN,QAAUK,GAEf7yB,EAAKowB,GAALh6C,MAKH,YAHAkpB,EAAK8wB,GAALh6C,MAAmB,GAMrB,MAAMs9C,EAAS,EAAEhB,EAAWE,GAAY,GAAID,EAAWE,GAAY,GACnD,QAAhBJ,EAAAzyB,EAAKwwB,GAALp6C,aAAgB,IAAAq8C,GAAAA,EAAAhrC,KAAhBrR,KAAmBs9C,EAAQD,EAAWF,EACxC,UAAAxB,GAEY9d,GACV,KAAIA,EAAIqd,QAAQ78C,QAAU,GAA1B,CAIuB,IAAAk/C,EAAvB,GAAI3zB,EAAK8wB,GAAL16C,MACF4pB,EAAK8wB,GAAL16C,MAAkBm/B,QAClBjW,EAAKwxB,GAAL16C,KAAoB,MACJ,QAAhBu9C,EAAA3zB,EAAKywB,GAALr6C,aAAgB,IAAAu9C,GAAAA,EAAAlsC,KAAhBrR,MAGG4pB,EAAK4wB,GAALx6C,QAGLsiB,GAAUub,GACV3U,EAAKsxB,GAALx6C,KAAkB,MAClBkpB,EAAK8wB,GAALh6C,MAAmB,GAbnB,CAcF,CAQFw9C,EA7NMjE,G,yZC+BN,MAAMkE,GAoFJ,kCAAWC,GACT,MAAMC,EAASF,GAAiBv9C,UAAU09C,oBACpCriB,EAAQZ,GAA0Ba,gBAClCC,EAAMd,GAA0Be,cAEtC,OAAO5uB,GACL9M,KACA,0BACA,IAAI81B,GAAgB,CAClB,CAAC,CAAC,YAAa,iBAAkB6nB,EAAQ,CAAEvlC,KAAM,EAAEmjB,EAAO,KAC1D,CACE,CAAC,iBAAkB,uBACnBoiB,EACA,CAAEvlC,KAAM,EAAEqjB,EAAK,KAEjB,CAAC,CAAC,aAAc,kBAAmBkiB,EAAQ,CAAEvlC,KAAM,CAACmjB,EAAO,KAC3D,CACE,CAAC,kBAAmB,wBACpBoiB,EACA,CAAEvlC,KAAM,CAACqjB,EAAK,KAEhB,CAAC,CAAC,UAAW,eAAgBkiB,EAAQ,CAAEvlC,KAAM,CAAC,GAAImjB,KAClD,CAAC,CAAC,eAAgB,qBAAsBoiB,EAAQ,CAAEvlC,KAAM,CAAC,GAAIqjB,KAC7D,CAAC,CAAC,YAAa,iBAAkBkiB,EAAQ,CAAEvlC,KAAM,CAAC,EAAGmjB,KACrD,CAAC,CAAC,iBAAkB,uBAAwBoiB,EAAQ,CAAEvlC,KAAM,CAAC,EAAGqjB,KAChE,CACE,CAAC,SAAU,cACXgiB,GAAiBv9C,UAAU29C,6BAInC,CAKArwC,WAAAA,CAAYkO,GAAY5c,EAAA,KAAAg/C,IAvHxB7+C,EAAA,KAAA8+C,GAAqB,MAErB9+C,EAAA,KAAA++C,GAAkB,MAElB/+C,EAAA,KAAAg/C,GAAW,MAEXh/C,EAAA,KAAAi/C,GAAW,MAEXj/C,EAAA,KAAAk/C,GAA2B,MAE3Bl/C,EAAA,KAAAm/C,IAAY,GAEZn/C,EAAA,KAAAo/C,GAAiB,MAEjBp/C,EAAA,KAAAq/C,GAAmB,IAEnBr/C,EAAA,KAAAs/C,GAAe,MAEft/C,EAAA,KAAAu/C,GAAqB,MAErBv/C,EAAA,KAAAw/C,GAAmB,MAEnBx/C,EAAA,KAAAy/C,GAAkB,MAElBz/C,EAAA,KAAA0/C,GAAW,MAEX1/C,EAAA,KAAA2/C,GAAsB,IAEtB3/C,EAAA,KAAA4/C,IAAkB,GAElB5/C,EAAA,KAAA6/C,GAAe,MAEf7/C,EAAA,KAAA8/C,IAAa,GAEb9/C,EAAA,KAAA+/C,IAAgB,GAEhB//C,EAAA,KAAAggD,IAA+B,GAE/BhgD,EAAA,KAAAigD,GAAoB,MAEpBjgD,EAAA,KAAAkgD,GAAa,GAEblgD,EAAA,KAAAmgD,GAAa,GAEbngD,EAAA,KAAAogD,GAAqB,MAErBpgD,EAAA,KAAAqgD,GAAgB,OAAIzgC,EAAAA,EAAAA,GAAA,mBAEP,IAAKA,EAAAA,EAAAA,GAAA,gBAER,IAAKA,EAAAA,EAAAA,GAAA,oBAEA,OAAIA,EAAAA,EAAAA,GAAA,uBAEDvgB,OAAOwa,OAAO,QAAK+F,EAAAA,EAAAA,GAAA,oBAEtB,OAAIA,EAAAA,EAAAA,GAAA,mBAEN,IAAIA,EAAAA,EAAAA,GAAA,kBAEJ,OAAIA,EAAAA,EAAAA,GAAA,4BAEK,GAMtB5f,EAAA,KAAAsgD,IAAe,GAEftgD,EAAA,KAAAugD,GAAU/B,GAAiB+B,WAyDzBx/C,KAAK2c,OAASjB,EAAWiB,OACzB3c,KAAKyZ,GAAKiC,EAAWjC,GACrBzZ,KAAKggB,MAAQhgB,KAAKigB,OAAS,KAC3BjgB,KAAKyhC,UAAY/lB,EAAWiB,OAAO8kB,UACnCzhC,KAAKuN,KAAOmO,EAAWnO,KACvBvN,KAAKmc,IAAM,KACXnc,KAAK6pB,WAAanO,EAAWuS,UAC7BjuB,KAAKmrC,oBAAsB,KAC3BnrC,KAAKy/C,sBAAuB,EAC5Bz/C,KAAK0/C,gBAAgBC,WAAajkC,EAAWikC,WAC7C3/C,KAAK4/C,oBAAsB,KAC3B5/C,KAAKmrC,oBAAsBzvB,EAAWyvB,qBAAuB,KAC7DnrC,KAAK6/C,aAAenkC,EAAWmkC,cAAgB,IAAIl+B,KACnD3hB,KAAK8/C,iBAAmBpkC,EAAWokC,kBAAoB,KACvD9/C,KAAK+/C,eAAgB,EAErB,MACE3gC,SAAAA,EACAc,SAAWE,UAAAA,EAAWC,WAAAA,EAAU,MAAEC,EAAK,MAAEC,IACvCvgB,KAAK2c,OAAON,SAEhBrc,KAAKof,SAAWA,EAChBpf,KAAKggD,cACF,IAAM5gC,EAAWpf,KAAK6pB,WAAWsU,eAAe/e,UAAY,IAC/Dpf,KAAKigD,eAAiB,CAAC7/B,EAAWC,GAClCrgB,KAAKkgD,gBAAkB,CAAC5/B,EAAOC,GAE/B,MAAOP,EAAOC,GAAUjgB,KAAK24C,iBAC7B34C,KAAK8V,EAAI4F,EAAW5F,EAAIkK,EACxBhgB,KAAK+V,EAAI2F,EAAW3F,EAAIkK,EAExBjgB,KAAKmgD,iBAAkB,EACvBngD,KAAKqrC,SAAU,CACjB,CAEA,cAAIpgB,GACF,OAAO3sB,OAAO8hD,eAAepgD,MAAMwN,YAAY6yC,KACjD,CAEA,QAAI7c,GACF,OAAOllC,OAAO8hD,eAAepgD,MAAMwN,YAAYw9B,WACjD,CAEA,mBAAWsV,GACT,OAAO,CACT,CAEA,4BAAWC,GACT,OAAOzzC,GACL9M,KACA,oBACAA,KAAKwgD,cAAchpB,WAAW,cAElC,CAEA,8BAAOipB,CAAwBj4B,GAC7B,MAAMk4B,EAAa,IAAIC,GAAW,CAChClnC,GAAI+O,EAAO7L,OAAOikC,YAClBjkC,OAAQ6L,EAAO7L,OACfsR,UAAWzF,EAAOqB,aAEpB62B,EAAWvV,oBAAsB3iB,EAAO2iB,oBACxCuV,EAAWrV,SAAU,EACrBqV,EAAW72B,WAAWqc,uBAAuBwa,EAC/C,CAMA,iBAAOxM,CAAWC,EAAMtqB,GAAY,IAAAg3B,EAclC,GAbsB,QAAtBA,EAAApD,GAAiBpJ,aAAK,IAAAwM,IAAtBpD,GAAiBpJ,MAAUF,GAE3BsJ,GAAiBqD,eAAjBrD,GAAiBqD,aAAiBxiD,OAAO8qB,OAAO,CAC9CzI,QAAS,gCACTogC,UAAW,kCACXC,SAAU,iCACVC,YAAa,oCACbrgC,YAAa,oCACbsgC,aAAc,qCACdC,WAAY,mCACZC,WAAY,uCAG6B,IAAvC3D,GAAiB4D,iBACnB,OAEF,MAAMhmC,EAAQ6b,iBAAiBnb,SAASulC,iBACxC7D,GAAiB4D,iBACfE,WAAWlmC,EAAMmmC,iBAAiB,qBAAuB,CAC7D,CAOA,0BAAOtV,CAAoBmU,EAAOoB,GAAS,CAM3C,oCAAWpY,GACT,MAAO,EACT,CAQA,+BAAOnC,CAAyBwa,GAC9B,OAAO,CACT,CAQA,YAAOpa,CAAMD,EAAM1qB,GACjBzR,GAAY,kBACd,CAMA,sBAAIqiC,GACF,MAAO,EACT,CAEA,gBAAIgS,GACF,OAAO31B,EAAK21B,GAALv/C,KACT,CAEA,gBAAIu/C,CAAaz/C,GAAO,IAAA6hD,EACtBz4B,EAAKq2B,GAALv/C,KAAoBF,GACZ,QAAR6hD,EAAA3hD,KAAKmc,WAAG,IAAAwlC,GAARA,EAAU35B,UAAUqc,OAAO,YAAavkC,EAC1C,CAEA,OAAI4hC,GACF,OAAO1hC,KAAKmrC,qBAAuBnrC,KAAKyZ,EAC1C,CAKA,kBAAIsiB,GACF,OAAO,CACT,CAEA6lB,MAAAA,GACE,MAAOxhC,EAAWC,GAAcrgB,KAAKigD,eACrC,OAAQjgD,KAAK6hD,gBACX,KAAK,GACH7hD,KAAK8V,GAAM9V,KAAKigB,OAASI,GAA2B,EAAZD,GACxCpgB,KAAK+V,GAAM/V,KAAKggB,MAAQI,GAA2B,EAAbC,GACtC,MACF,KAAK,IACHrgB,KAAK8V,GAAK9V,KAAKggB,MAAQ,EACvBhgB,KAAK+V,GAAK/V,KAAKigB,OAAS,EACxB,MACF,KAAK,IACHjgB,KAAK8V,GAAM9V,KAAKigB,OAASI,GAA2B,EAAZD,GACxCpgB,KAAK+V,GAAM/V,KAAKggB,MAAQI,GAA2B,EAAbC,GACtC,MACF,QACErgB,KAAK8V,GAAK9V,KAAKggB,MAAQ,EACvBhgB,KAAK+V,GAAK/V,KAAKigB,OAAS,EAG5BjgB,KAAK8hD,mBACP,CAMAvZ,WAAAA,CAAY0F,GACVjuC,KAAK6pB,WAAW0e,YAAY0F,EAC9B,CAEA,gBAAI1G,GACF,OAAOvnC,KAAK6pB,WAAW0d,YACzB,CAKAwa,eAAAA,GACE/hD,KAAKmc,IAAId,MAAM2mC,OAAS,CAC1B,CAKAC,eAAAA,GACEjiD,KAAKmc,IAAId,MAAM2mC,OAASp4B,EAAK41B,GAALx/C,KAC1B,CAEAkiD,SAAAA,CAAUvlC,GAID,IAAAwlC,EAHQ,OAAXxlC,GACF3c,KAAKyhC,UAAY9kB,EAAO8kB,UACxBzhC,KAAKigD,eAAiBtjC,EAAOsjC,iBAG7B/gD,EAAA4+C,GAAA99C,KAAKoiD,IAAa/wC,KAAlBrR,MAGoB,QAApBmiD,EAAAv4B,EAAK80B,GAAL1+C,aAAoB,IAAAmiD,GAApBA,EAAsBr3B,SACtB5B,EAAKw1B,GAAL1+C,KAAuB,OAEzBA,KAAK2c,OAASA,CAChB,CAKA0lC,OAAAA,CAAQroC,GACDha,KAAKqtB,sBAGLzD,EAAKi1B,GAAL7+C,MAGHkpB,EAAK21B,GAAL7+C,MAAuB,GAFvBA,KAAK2c,OAAO+uB,YAAY1rC,MAI5B,CAMAsiD,QAAAA,CAAStoC,GAAO,IAAAuoC,EACd,IAAKviD,KAAKqtB,oBACR,OAGF,IAAKrtB,KAAKmgD,gBACR,OAOF,MAAMjmC,EAASF,EAAMwoC,cACX,OAANtoC,QAAM,IAANA,GAAAA,EAAQqrB,QAAQ,IAADv6B,OAAKhL,KAAKyZ,OAI7BO,EAAMqI,iBAEU,QAAZkgC,EAACviD,KAAK2c,cAAM,IAAA4lC,GAAXA,EAAaE,qBAChBziD,KAAK0kC,iBAET,CAEAA,cAAAA,GACM1kC,KAAKm9B,UACPn9B,KAAK8qB,SAEL9qB,KAAKwuC,QAET,CAKAA,MAAAA,GACOxuC,KAAK0iD,gBAGV1iD,KAAKkmC,wBACP,CAEAA,sBAAAA,GACElmC,KAAK6pB,WAAWqc,uBAAuBlmC,KACzC,CASA2iD,KAAAA,CAAM7sC,EAAGC,EAAG25B,EAAIC,GACd,MAAO3vB,EAAOC,GAAUjgB,KAAK24C,kBAC5BjJ,EAAIC,GAAM3vC,KAAK4iD,wBAAwBlT,EAAIC,GAE5C3vC,KAAK8V,GAAKA,EAAI45B,GAAM1vB,EACpBhgB,KAAK+V,GAAKA,EAAI45B,GAAM1vB,EAEpBjgB,KAAK8hD,mBACP,CAEAe,eAAAA,CAAgBC,EAAOC,GACrB,MAAOrS,EAAaC,GAAgB3wC,KAAK24C,iBACzC34C,KAAK2iD,MACHG,EAAQpS,EACRqS,EAAQpS,EACR3wC,KAAKggB,MAAQ0wB,EACb1wC,KAAKigB,OAAS0wB,GAEhB3wC,KAAKgjD,eACP,CAkBAC,SAAAA,CAAUntC,EAAGC,GAGX7W,EAAA4+C,GAAA99C,KAAKkjD,IAAU7xC,KAAfrR,KAAgBA,KAAK24C,iBAAkB7iC,EAAGC,EAC5C,CAQA64B,eAAAA,CAAgB94B,EAAGC,GACjB6T,EAAKk1B,GAAL9+C,OAAAkpB,EAAK41B,GAAL9+C,KAAsB,CAACA,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,SACxD/gB,EAAA4+C,GAAA99C,KAAKkjD,IAAU7xC,KAAfrR,KAAgBA,KAAKigD,eAAgBnqC,EAAGC,GACxC/V,KAAKmc,IAAIgnC,eAAe,CAAEC,MAAO,WACnC,CAEAvU,eAAAA,GACE7uC,KAAKgjD,cAAchjD,KAAK8V,EAAG9V,KAAK+V,EAClC,CAEA65B,IAAAA,CAAKF,EAAIC,GACP/lB,EAAKk1B,GAAL9+C,OAAAkpB,EAAK41B,GAAL9+C,KAAsB,CAACA,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,SACxD,MAAM,IACJ9D,EACAw8B,kBAAmBjI,EAAaC,IAC9B3wC,KAGJ,GAFAA,KAAK8V,GAAK45B,EAAKgB,EACf1wC,KAAK+V,GAAK45B,EAAKgB,EACX3wC,KAAK2c,SAAW3c,KAAK8V,EAAI,GAAK9V,KAAK8V,EAAI,GAAK9V,KAAK+V,EAAI,GAAK/V,KAAK+V,EAAI,GAAI,CASzE,MAAM,EAAED,EAAC,EAAEC,GAAM/V,KAAKmc,IAAIioB,wBACtBpkC,KAAK2c,OAAO0mC,cAAcrjD,KAAM8V,EAAGC,KACrC/V,KAAK8V,GAAKlH,KAAKiY,MAAM7mB,KAAK8V,GAC1B9V,KAAK+V,GAAKnH,KAAKiY,MAAM7mB,KAAK+V,GAE9B,CAKA,IAAI,EAAED,EAAC,EAAEC,GAAM/V,KACf,MAAOsjD,EAAIC,GAAMvjD,KAAKwjD,qBACtB1tC,GAAKwtC,EACLvtC,GAAKwtC,EAEL,MAAM,MAAEloC,GAAUc,EAClBd,EAAMooC,KAAO,GAAHz4C,QAAO,IAAM8K,GAAG4tC,QAAQ,GAAE,KACpCroC,EAAMkP,IAAM,GAAHvf,QAAO,IAAM+K,GAAG2tC,QAAQ,GAAE,KAEnC1jD,KAAK2jD,eAAe7tC,EAAGC,GAEvBoG,EAAIgnC,eAAe,CAAEC,MAAO,WAC9B,CAOAO,cAAAA,CAAe7tC,EAAGC,GAAI,CAOtBitC,aAAAA,CAAcltC,EAAGC,GAAI,CAErB,iBAAI6tC,GACF,QACIh6B,EAAKk1B,GAAL9+C,QACD4pB,EAAKk1B,GAAL9+C,MAAkB,KAAOA,KAAK8V,GAAK8T,EAAKk1B,GAAL9+C,MAAkB,KAAOA,KAAK+V,EAEtE,CAEA,mBAAI8tC,GACF,QACIj6B,EAAKk1B,GAAL9+C,QACD4pB,EAAKk1B,GAAL9+C,MAAkB,KAAOA,KAAKggB,OAC7B4J,EAAKk1B,GAAL9+C,MAAkB,KAAOA,KAAKigB,OAEpC,CASAujC,kBAAAA,GACE,MAAO9S,EAAaC,GAAgB3wC,KAAK24C,kBACnC,iBAAE0I,GAAqB5D,GACvB3nC,EAAIurC,EAAmB3Q,EACvB36B,EAAIsrC,EAAmB1Q,EAC7B,OAAQ3wC,KAAKof,UACX,KAAK,GACH,MAAO,EAAEtJ,EAAGC,GACd,KAAK,IACH,MAAO,CAACD,EAAGC,GACb,KAAK,IACH,MAAO,CAACD,GAAIC,GACd,QACE,MAAO,EAAED,GAAIC,GAEnB,CAMA,oBAAI+tC,GACF,OAAO,CACT,CAMAhC,iBAAAA,GAA4C,IAA1B1iC,EAAQjgB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAKof,SAChC,MACEjD,KAAK,MAAEd,GACP4kC,gBAAiB7/B,EAAWC,IAC1BrgB,KACJ,IAAI,EAAE8V,EAAC,EAAEC,EAAC,MAAEiK,EAAK,OAAEC,GAAWjgB,KAM9B,GALAggB,GAASI,EACTH,GAAUI,EACVvK,GAAKsK,EACLrK,GAAKsK,EAEDrgB,KAAK8jD,iBACP,OAAQ1kC,GACN,KAAK,EACHtJ,EAAI6B,GAAU7B,EAAG,EAAGsK,EAAYJ,GAChCjK,EAAI4B,GAAU5B,EAAG,EAAGsK,EAAaJ,GACjC,MACF,KAAK,GACHnK,EAAI6B,GAAU7B,EAAG,EAAGsK,EAAYH,GAChClK,EAAI4B,GAAU5B,EAAGiK,EAAOK,GACxB,MACF,KAAK,IACHvK,EAAI6B,GAAU7B,EAAGkK,EAAOI,GACxBrK,EAAI4B,GAAU5B,EAAGkK,EAAQI,GACzB,MACF,KAAK,IACHvK,EAAI6B,GAAU7B,EAAGmK,EAAQG,GACzBrK,EAAI4B,GAAU5B,EAAG,EAAGsK,EAAaL,GAKvChgB,KAAK8V,EAAIA,GAAKsK,EACdpgB,KAAK+V,EAAIA,GAAKsK,EAEd,MAAOijC,EAAIC,GAAMvjD,KAAKwjD,qBACtB1tC,GAAKwtC,EACLvtC,GAAKwtC,EAELloC,EAAMooC,KAAO,GAAHz4C,QAAO,IAAM8K,GAAG4tC,QAAQ,GAAE,KACpCroC,EAAMkP,IAAM,GAAHvf,QAAO,IAAM+K,GAAG2tC,QAAQ,GAAE,KAEnC1jD,KAAK+jD,WACP,CAoBAnB,uBAAAA,CAAwB9sC,EAAGC,GACzB,OAAOiuC,GAA6B3yC,KAA7BosC,GAA8B3nC,EAAGC,EAAG/V,KAAK6hD,eAClD,CAOAoC,uBAAAA,CAAwBnuC,EAAGC,GACzB,OAAOiuC,GAA6B3yC,KAA7BosC,GAA8B3nC,EAAGC,EAAG,IAAM/V,KAAK6hD,eACxD,CAmBA,eAAIqC,GACF,OAAOlkD,KAAK6pB,WAAWsU,eAAeC,SACxC,CAEA,kBAAIyjB,GACF,OAAQ7hD,KAAK6pB,WAAWsU,eAAe/e,SAAWpf,KAAKggD,cAAgB,GACzE,CAEA,oBAAIrH,GACF,MAAM,YACJuL,EACAjE,gBAAiB7/B,EAAWC,IAC1BrgB,KACJ,MAAO,CAACogB,EAAY8jC,EAAa7jC,EAAa6jC,EAChD,CAKAC,OAAAA,GACE,MACEhoC,KAAK,MAAEd,GAAO,MACd2E,EAAK,OACLC,GACEjgB,KACJqb,EAAM2E,MAAQ,GAAHhV,QAAO,IAAMgV,GAAO0jC,QAAQ,GAAE,KACzCroC,EAAM4E,OAAS,GAAHjV,QAAO,IAAMiV,GAAQyjC,QAAQ,GAAE,IAC7C,CAMAU,qBAAAA,GACE,MAAO,CAAC,EAAG,EACb,CA4GAC,UAAAA,GAAc,CA6Bd,aAAOC,CAAOxuC,GAIZ,OAAOlH,KAAK21C,MAAU,IAAJzuC,GAAa,GACjC,CAgJA0uC,WAAAA,GAAe,CAKfC,aAAAA,GAAgB,IAAAC,EACD,QAAbA,EAAA96B,EAAKq0B,GAALj+C,aAAa,IAAA0kD,GAAbA,EAAe/P,QACjB,CAMA,kBAAIgQ,GACF,OAAO,IACT,CAMA,oBAAMC,GACJ,GAAI5kD,KAAK6kD,cAAgBj7B,EAAKo1B,GAALh/C,MACvB,OAAOA,KAAK6kD,aAEd7kD,KAAK6kD,aAAe,IAAIt8B,GAAcvoB,MACtCA,KAAKmc,IAAIC,OAAOpc,KAAK6kD,aAAappC,UAClC,MAAM,eAAEkpC,GAAmB3kD,KAC3B,GAAI2kD,EACF,IAAK,MAAOp3C,EAAMof,KAASg4B,QACnB3kD,KAAK6kD,aAAan4B,UAAUnf,EAAMof,GAQ5C,OALK3sB,KAAKorC,YACRprC,KAAK6kD,aAAan4B,UAAU,UAAW1sB,KAAK8kD,oBAE9C9kD,KAAK6kD,aAAan4B,UAAU,UAErB1sB,KAAK6kD,YACd,CAEAE,yBAAAA,GAA4B,IAAAC,EACT,QAAjBA,EAAAhlD,KAAK6kD,oBAAY,IAAAG,GAAjBA,EAAmBp4B,gBACjB,UACA5sB,KAAK8kD,mBACL,gBAEJ,CAEAG,8BAAAA,GAAiC,IAAAC,EACd,QAAjBA,EAAAllD,KAAK6kD,oBAAY,IAAAK,GAAjBA,EAAmB54B,aAAa,UAClC,CAEA64B,iBAAAA,GAAoB,IAAAC,EAAAC,EACD,QAAjBD,EAAAplD,KAAK6kD,oBAAY,IAAAO,GAAjBA,EAAmBt6B,SACnB9qB,KAAK6kD,aAAe,KAIP,QAAbQ,EAAAz7B,EAAKq0B,GAALj+C,aAAa,IAAAqlD,GAAbA,EAAel4B,SACjB,CAEAm4B,YAAAA,CAAa99B,GAAW,IAAA+9B,EACtB,MAAMC,EAAkC,QAApBD,EAAGvlD,KAAK6kD,oBAAY,IAAAU,OAAA,EAAjBA,EAAmBppC,IACtCqpC,EACFA,EAAeC,OAAOj+B,GAEtBxnB,KAAKmc,IAAIC,OAAOoL,EAEpB,CAEAk+B,mBAAAA,GACE,OAAO1lD,KAAKmc,IAAIioB,uBAClB,CAMAuhB,aAAAA,GASE,OARK/7B,EAAKq0B,GAALj+C,QACHizC,GAAQiB,WAAWuJ,GAAiBpJ,OACpCnrB,EAAK+0B,GAALj+C,KAAgB,IAAIizC,GAAQjzC,OACxB4pB,EAAKm0B,GAAL/9C,QACF4pB,EAAKq0B,GAALj+C,MAAckoB,KAAO0B,EAAKm0B,GAAL/9C,MACrBkpB,EAAK60B,GAAL/9C,KAA0B,QAGvB4pB,EAAKq0B,GAALj+C,KACT,CAEA,eAAI4lD,GAAc,IAAAC,EAChB,OAAoB,QAApBA,EAAOj8B,EAAKq0B,GAALj+C,aAAa,IAAA6lD,OAAA,EAAbA,EAAe39B,IACxB,CAKA,eAAI09B,CAAY19B,GACT0B,EAAKq0B,GAALj+C,QAGL4pB,EAAKq0B,GAALj+C,MAAckoB,KAAOA,EACvB,CAEA,kBAAI49B,GAAiB,IAAAC,EACnB,OAAoB,QAApBA,EAAOn8B,EAAKq0B,GAALj+C,aAAa,IAAA+lD,OAAA,EAAbA,EAAejR,WACxB,CAEA,uBAAMkR,CAAkB9nC,GAAM,IAAA+nC,QACT,QAAnBA,EAAMr8B,EAAKq0B,GAALj+C,aAAa,IAAAimD,OAAA,EAAbA,EAAelR,eAAe72B,GACtC,CAEAgoC,gBAAAA,CAAiB9Q,GAAc,IAAA+Q,EAC7B,OAAoB,QAApBA,EAAOv8B,EAAKq0B,GAALj+C,aAAa,IAAAmmD,OAAA,EAAbA,EAAeve,UAAUwN,EAClC,CAEAgR,UAAAA,GACE,QAASx8B,EAAKq0B,GAALj+C,QAAkB4pB,EAAKq0B,GAALj+C,MAAcm9B,SAC3C,CAEAkpB,cAAAA,GAAiB,IAAAC,EAAAC,EACf,OAA+B,QAA/BD,EAAoB,QAApBC,EAAO38B,EAAKq0B,GAALj+C,aAAa,IAAAumD,OAAA,EAAbA,EAAe1R,iBAAS,IAAAyR,GAAAA,CACjC,CAEAE,kBAAAA,GAAqB,IAAAC,EACN,QAAbA,EAAA78B,EAAKs0B,GAALl+C,aAAa,IAAAymD,GAAbA,EAAelP,aACjB,CAEAuN,gBAAAA,GACE,OAAO9kD,KAAK+/C,cAAiBn2B,EAAKs0B,GAALl+C,OAAAkpB,EAAKg1B,GAALl+C,KAAkB,IAAIs2C,GAAQt2C,OAAS,IACtE,CAEA0qC,0BAAAA,GACO1qC,KAAK6pB,WAAWyE,sBAGjB1E,EAAKu0B,GAALn+C,MACEA,KAAK6pB,WAAWwmB,iBAClBzmB,EAAKu0B,GAALn+C,MAA8BgoB,UAAU8C,OAAO,UAI9C9qB,KAAKorC,aAGVliB,EAAKi1B,GAALn+C,KAAgC4pB,EAAKs0B,GAALl+C,MAAcm3C,uBAC9Cn3C,KAAKmc,IAAIC,OAAOwN,EAAKu0B,GAALn+C,QAClB,CAEAm4C,6BAAAA,GACEvuB,EAAKs0B,GAALl+C,MAAcm4C,gCACdjvB,EAAKi1B,GAALn+C,KAAgC,KAClC,CAEAyqC,2BAAAA,GAA8B,IAAAic,EACC,QAA7BA,EAAA98B,EAAKu0B,GAALn+C,aAA6B,IAAA0mD,GAA7BA,EAA+B1+B,UAAUhpB,IAAI,SAC/C,CAEA,WAAI0sB,GAAU,IAAAi7B,EACZ,MACEz+B,MAAM,SAAE4wB,EAAQ,KAAE56B,EAAI,KAAE66B,EAAI,QAAE1N,IAC5BzhB,EAAKs0B,GAALl+C,MACJ,MAAO,CACLke,OACA46B,WACAC,OACA1N,UACA1nB,MAAO3jB,KAAK0gC,iBACZ+B,QAAqB,QAAdkkB,EAAE3mD,KAAKyiC,eAAO,IAAAkkB,EAAAA,EAAI,EAE7B,CAEA,WAAIj7B,CAAQxN,GACV0L,EAAKs0B,GAALl+C,OAAAkpB,EAAKg1B,GAALl+C,KAAkB,IAAIs2C,GAAQt2C,OAC9B4pB,EAAKs0B,GAALl+C,MAAckoB,KAAOhK,EACjBle,KAAKorC,YACPprC,KAAKilD,iCACLjlD,KAAK0qC,6BACL1qC,KAAK6pB,WAAWgY,cAAc7hC,QAE9BA,KAAK+kD,4BACL/kD,KAAKm4C,gCACLn4C,KAAK6pB,WAAWqY,cAAcliC,MAElC,CAEA4mD,cAAAA,CAAcC,GAAkC,IAAjC,QAAEn7B,EAAO,SAAE6f,EAAQ,SAAEuN,GAAU+N,EAC5C,IAAKtb,EACH,OAKF,GAHA3hB,EAAKs0B,GAALl+C,OAAAkpB,EAAKg1B,GAALl+C,KAAkB,IAAIs2C,GAAQt2C,OAC9B4pB,EAAKs0B,GAALl+C,MAAcg5C,eAAettB,EAASotB,IAEjC94C,KAAKmrC,oBACR,OAEF,MAAMtxB,EAAa7Z,KAAK6pB,WAAWic,sCACjC9lC,KAAKmrC,qBAEHtxB,GACF7Z,KAAK8mD,0BAA0BjtC,EAEnC,CAEA,oBAAIktC,GAAmB,IAAAC,EACrB,OAAoB,QAApBA,EAAOp9B,EAAKs0B,GAALl+C,aAAa,IAAAgnD,OAAA,EAAbA,EAAenO,eACxB,CAEA,qBAAIoO,GAAoB,IAAAC,EACtB,OAAoB,QAApBA,EAAOt9B,EAAKs0B,GAALl+C,aAAa,IAAAknD,OAAA,EAAbA,EAAetO,WACxB,CAEA,cAAIxN,GACF,QACIxhB,EAAKs0B,GAALl+C,QAAkB4pB,EAAKs0B,GAALl+C,MAAcm9B,YAAcvT,EAAKs0B,GAALl+C,MAAc44C,WAElE,CAEA,iBAAMzX,CAAYz1B,GAChBke,EAAKs0B,GAALl+C,OAAAkpB,EAAKg1B,GAALl+C,KAAkB,IAAIs2C,GAAQt2C,OAC9B4pB,EAAKs0B,GAALl+C,MAAc04C,KAAKhtC,EACrB,CAEAk2B,aAAAA,CAAcS,GAAoC,IAAxBvL,EAAU33B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,QAAGsM,EACjCzL,KAAKorC,YACPprC,KAAK6pB,WAAW+X,cAAc5hC,KAAMqiC,EAAYvL,EAEpD,CAEAqwB,wBAAAA,CAAyBzsC,GACvBkP,EAAKs0B,GAALl+C,MAAconD,kBAAkB1sC,EAClC,CAEA+Q,UAAAA,CAAWkc,GACT,GAAI3nC,KAAK+mD,iBAAkB,CACzB,MAAMM,EAAsB,IACtBC,EAAuB,KACtB,CAAC,CAAF,CAAOC,GAAO5f,EAAWh0B,MACxByM,GAAapgB,KAAKigD,gBAClB3/B,GAAStgB,KAAKkgD,gBACfsH,EAAMlnC,EAAQF,EAAY,EAC1BqnC,EAAMF,EAAMD,EACZI,EAAMF,EAAMH,EAClB1f,EAAWggB,MAAQ,CACjBC,SAAU5nD,KAAK0rB,QAAQxN,KACvBmtB,QAASrrC,KAAK0rB,QAAQ2f,QACtB13B,KAAM,CAAC6zC,EAAKC,EAAKC,EAAKH,GAE1B,CACF,CAEAT,yBAAAA,CAAyBe,GAAmC,IAAhCF,OAAO,SAAEC,EAAQ,QAAEvc,IAAWwc,EACxDj+B,EAAKs0B,GAALl+C,MAAckoB,KAAOmjB,EAAU,KAAOuc,CACxC,CAEA,4BAAIE,GACF,OAAO9nD,KAAK2c,OAAOm7B,kBACrB,CAMAr8B,MAAAA,GAAS,IAAAssC,EACP,MAAM5rC,EAAOnc,KAAKmc,IAAMJ,SAASC,cAAc,OAC/CG,EAAI/B,aAAa,wBAAyB,IAAMpa,KAAKof,UAAY,KACjEjD,EAAIuL,UAAY1nB,KAAKuN,KACrB4O,EAAI/B,aAAa,KAAMpa,KAAKyZ,IAC5B0C,EAAIgP,SAAWvB,EAAKw0B,GAALp+C,OAAkB,EAAI,EACrCmc,EAAI/B,aAAa,OAAQ,eACrBpa,KAAKgoD,eACP7rC,EAAI/B,aAAa,eAAgBpa,KAAKgoD,eAEnChoD,KAAKioD,YACR9rC,EAAI6L,UAAUhpB,IAAI,UAGpBgB,KAAKiiD,kBACL/iD,EAAA4+C,GAAA99C,KAAKkoD,IAAkB72C,KAAvBrR,MAEA,MAAO0wC,EAAaC,GAAgB3wC,KAAK24C,iBACrC34C,KAAK6hD,eAAiB,MAAQ,IAChC1lC,EAAId,MAAM8sC,SAAW,GAAHn9C,QAAQ,IAAM2lC,EAAgBD,GAAagT,QAC3D,GACD,KACDvnC,EAAId,MAAM+sC,UAAY,GAAHp9C,QAAQ,IAAM0lC,EAAeC,GAAc+S,QAC5D,GACD,MAGH,MAAOhU,EAAIC,GAAM3vC,KAAKokD,wBAmBtB,OAlBApkD,KAAKijD,UAAUvT,EAAIC,GAEnBzgB,GAAWlvB,KAAMmc,EAAK,CAAC,UAAW,cAAe,aAE7Cnc,KAAKqoD,aAAeroD,KAAK6pB,WAAW2U,uBACtC5U,EAAK01B,GAALt/C,OAAAkpB,EAAKo2B,GAALt/C,KAAuB,IAAIu5C,GAAa,CACtC/xB,UAAWrL,EACXs9B,mBAAoBA,KAAOz5C,KAAKqiC,WAChCsX,aAAcz6C,EAAA4+C,GAAA99C,KAAKsoD,IAAyB/6B,KAAKvtB,MACjD45C,WAAY16C,EAAA4+C,GAAA99C,KAAKuoD,IAAoBh7B,KAAKvtB,MAC1C65C,WAAY36C,EAAA4+C,GAAA99C,KAAKwoD,IAAuBj7B,KAAKvtB,MAC7C2pB,OAAQ3pB,KAAK6pB,WAAWC,YAI5B9pB,KAAK0qC,6BACyB,QAA9Bqd,EAAA/nD,KAAK6pB,WAAW0U,sBAAc,IAAAwpB,GAA9BA,EAAgCv9B,OAEzBrO,CACT,CA4EAssC,WAAAA,CAAYzuC,GACV,MAAM,MAAEpJ,GAAUtB,GAAYgB,SACT,IAAjB0J,EAAMkR,QAAiBlR,EAAMwc,SAAW5lB,EAE1CoJ,EAAMqI,kBAGR6G,EAAK21B,GAAL7+C,MAAuB,GAEnBA,KAAKu/C,aACPrgD,EAAA4+C,GAAA99C,KAAK0oD,IAAiBr3C,KAAtBrR,KAAuBga,GAIzB9a,EAAA4+C,GAAA99C,KAAK2oD,IAAqBt3C,KAA1BrR,KAA2Bga,GAC7B,CA0GA4uC,gBAAAA,GAAoB,CAEpBC,eAAAA,GAAmB,CAEnB9E,SAAAA,GAIMn6B,EAAKs1B,GAALl/C,OACFu/B,aAAa3V,EAAKs1B,GAALl/C,OAEfkpB,EAAKg2B,GAALl/C,KAAyBgtC,WAAW,KAAM,IAAA8b,EACxC5/B,EAAKg2B,GAALl/C,KAAyB,MACd,QAAX8oD,EAAA9oD,KAAK2c,cAAM,IAAAmsC,GAAXA,EAAaC,gBAAgB/oD,OAM5B,GACL,CAEAwvC,qBAAAA,CAAsB7yB,EAAQ7G,EAAGC,GAC/B4G,EAAOmzB,aAAa9vC,MACpBA,KAAK8V,EAAIA,EACT9V,KAAK+V,EAAIA,EACT/V,KAAK8hD,oBACL9hD,KAAKgjD,eACP,CAQAgG,OAAAA,CAAQtZ,EAAIC,GAA8B,IAA1BvwB,EAAQjgB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAKof,SAC9B,MAAMD,EAAQnf,KAAKkkD,aACZ9jC,EAAWC,GAAcrgB,KAAKigD,gBAC9B3/B,EAAOC,GAASvgB,KAAKkgD,gBACtB+I,EAASvZ,EAAKvwB,EACd+pC,EAASvZ,EAAKxwB,EACdrJ,EAAI9V,KAAK8V,EAAIsK,EACbrK,EAAI/V,KAAK+V,EAAIsK,EACbL,EAAQhgB,KAAKggB,MAAQI,EACrBH,EAASjgB,KAAKigB,OAASI,EAE7B,OAAQjB,GACN,KAAK,EACH,MAAO,CACLtJ,EAAImzC,EAAS3oC,EACbD,EAAatK,EAAImzC,EAASjpC,EAASM,EACnCzK,EAAImzC,EAASjpC,EAAQM,EACrBD,EAAatK,EAAImzC,EAAS3oC,GAE9B,KAAK,GACH,MAAO,CACLzK,EAAIozC,EAAS5oC,EACbD,EAAatK,EAAIkzC,EAAS1oC,EAC1BzK,EAAIozC,EAASjpC,EAASK,EACtBD,EAAatK,EAAIkzC,EAASjpC,EAAQO,GAEtC,KAAK,IACH,MAAO,CACLzK,EAAImzC,EAASjpC,EAAQM,EACrBD,EAAatK,EAAImzC,EAAS3oC,EAC1BzK,EAAImzC,EAAS3oC,EACbD,EAAatK,EAAImzC,EAASjpC,EAASM,GAEvC,KAAK,IACH,MAAO,CACLzK,EAAIozC,EAASjpC,EAASK,EACtBD,EAAatK,EAAIkzC,EAASjpC,EAAQO,EAClCzK,EAAIozC,EAAS5oC,EACbD,EAAatK,EAAIkzC,EAAS1oC,GAE9B,QACE,MAAM,IAAIpV,MAAM,oBAEtB,CAEAg+C,sBAAAA,CAAuBx1C,EAAM0M,GAC3B,MAAOlK,EAAIC,EAAIE,EAAIC,GAAM5C,EAEnBqM,EAAQ1J,EAAKH,EACb8J,EAAS1J,EAAKH,EAEpB,OAAQpW,KAAKof,UACX,KAAK,EACH,MAAO,CAACjJ,EAAIkK,EAAa9J,EAAIyJ,EAAOC,GACtC,KAAK,GACH,MAAO,CAAC9J,EAAIkK,EAAajK,EAAI6J,EAAQD,GACvC,KAAK,IACH,MAAO,CAAC1J,EAAI+J,EAAajK,EAAI4J,EAAOC,GACtC,KAAK,IACH,MAAO,CAAC3J,EAAI+J,EAAa9J,EAAI0J,EAAQD,GACvC,QACE,MAAM,IAAI7U,MAAM,oBAEtB,CAOAi+C,UAAAA,GACE,OAAOppD,KAAKgpD,QAAQ,EAAG,EACzB,CAEAtoB,cAAAA,GACE,OACE1gC,KAAK2jB,OACL85B,GAAiB+C,cAAcppB,QAC7Bp3B,KAAK6pB,WAAW6W,eAAe1gC,KAAK2jB,OAG1C,CAKA+zB,cAAAA,GAAiB,IAAA2R,EACF,QAAbA,EAAAz/B,EAAKs0B,GAALl+C,aAAa,IAAAqpD,GAAbA,EAAe3R,gBACjB,CAEA3V,OAAAA,GACE,MACErW,SAAWxN,KAAM/O,EAAG,MAAEwU,EAAK,KAAEo1B,EAAI,QAAEtW,EAAO,QAAE4I,EAAO,SAAEyN,GACrDpX,IAAKjoB,EAAE,UACPgoB,EAAS,aACToe,EAAY,iBACZC,GACE9/C,KACJ,MAAO,CACLyZ,KACAgoB,YACA9tB,KAAM3T,KAAKopD,aACXtQ,WACAtN,YAAa,CAAEr8B,OACf0wC,eACAC,iBAAkB/G,GAAQ+G,EAC1BvU,UAAWF,EACX1nB,QACA8e,UAEJ,CAMA6mB,SAAAA,CAAUtlB,GAAQ,CAMlB7G,OAAAA,GACE,OAAO,CACT,CAMAosB,cAAAA,GACE,OAAIvpD,KAAK0iD,iBAGT1iD,KAAK2c,OAAOkqB,iBAAgB,GAC5B3d,EAAK81B,GAALh/C,MAAqB,IAEd,EACT,CAMAwpD,eAAAA,GACE,QAAKxpD,KAAK0iD,iBAGV1iD,KAAK2c,OAAOkqB,iBAAgB,GAC5B3d,EAAK81B,GAALh/C,MAAqB,IAEd,EACT,CAMA0iD,YAAAA,GACE,OAAO94B,EAAKo1B,GAALh/C,KACT,CAOAkwC,uBAAAA,GACE,OAAOtmB,EAAKq1B,GAALj/C,KACT,CAMAypD,gBAAAA,GACE,OAAOzpD,KAAKmc,MAAQnc,KAAKmgD,eAC3B,CAEA,cAAIuJ,GACF,MAAM,IAAEn/B,EAAG,KAAEk5B,EAAI,OAAEkG,EAAM,MAAEC,GAAU5pD,KAAK0lD,uBACpC,YAAEmE,EAAW,WAAEC,GAAehkC,OACpC,OAAO29B,EAAOqG,GAAcF,EAAQ,GAAKr/B,EAAMs/B,GAAeF,EAAS,CACzE,CAkBA9Z,OAAAA,GACE3wC,EAAA4+C,GAAA99C,KAAKkoD,IAAkB72C,KAAvBrR,KACF,CAMA+pD,MAAAA,CAAOC,GAAS,CAKhBrM,MAAAA,GAAU,CAMVsM,gBAAAA,GAAmB,IAAAC,EACjB,MAAO,CACLzwC,GAAIzZ,KAAKmrC,oBACTE,SAAS,EACT5J,UAAWzhC,KAAKyhC,UAChB8J,UAA2B,QAAjB2e,EAAAlqD,KAAKmqD,oBAAY,IAAAD,OAAA,EAAjBA,EAAmB3e,WAAY,GAE7C,CAYA3D,SAAAA,GAAgD,IAAAwiB,EAC9C,MAAO,CACLC,eAAgBrqD,KAAKwjC,KACrB/B,UAAWzhC,KAAKyhC,UAChB9tB,KAAM3T,KAAKopD,aACXhqC,SAAUpf,KAAKof,SACfkrC,mBAAoBtqD,KAAK4/C,oBACzBrU,UAA2B,QAAjB6e,EAAApqD,KAAKmqD,oBAAY,IAAAC,OAAA,EAAjBA,EAAmB7e,WAAY,GAE7C,CAWA,wBAAanD,CAAYlgB,EAAMvL,EAAQsR,GACrC,MAAMzF,EAAS,IAAIxoB,KAAKE,UAAUsN,YAAY,CAC5CmP,SACAlD,GAAIkD,EAAOikC,YACX3yB,YACAkd,oBAAqBjjB,EAAKijB,oBAC1B0U,aAAc33B,EAAK23B,aACnBC,iBAAkB53B,EAAK43B,mBAEzBt3B,EAAOpJ,SAAW8I,EAAK9I,SACvB8J,EAAO60B,GAAPv1B,EAA4BN,EAAKqiC,mBACjC/hC,EAAOgiC,QAAUtiC,EAAKuiC,SAAU,EAEhC,MAAOrqC,EAAWC,GAAcmI,EAAOy3B,gBAChCnqC,EAAGC,EAAGiK,EAAOC,GAAUuI,EAAO2gC,uBACnCjhC,EAAKvU,KACL0M,GAQF,OALAmI,EAAO1S,EAAIA,EAAIsK,EACfoI,EAAOzS,EAAIA,EAAIsK,EACfmI,EAAOxI,MAAQA,EAAQI,EACvBoI,EAAOvI,OAASA,EAASI,EAElBmI,CACT,CAOA,mBAAI8oB,GACF,QACItxC,KAAKmrC,sBAAwBnrC,KAAKqrC,SAAgC,OAArBrrC,KAAK4nC,YAExD,CAMA9c,MAAAA,GAAS,IAAA4/B,EAAAC,EAAAC,EAsBP,GArBa,QAAbF,EAAA9gC,EAAK+0B,GAAL3+C,aAAa,IAAA0qD,GAAbA,EAAevrB,QACfjW,EAAKy1B,GAAL3+C,KAAgB,MAEXA,KAAKm9B,WAGRn9B,KAAKwuC,SAEHxuC,KAAK2c,OACP3c,KAAK2c,OAAOmO,OAAO9qB,MAEnBA,KAAK6pB,WAAWgjB,aAAa7sC,MAE/BA,KAAK6qD,mBAEDjhC,EAAKs1B,GAALl/C,QACFu/B,aAAa3V,EAAKs1B,GAALl/C,OACbkpB,EAAKg2B,GAALl/C,KAAyB,OAE3Bd,EAAA4+C,GAAA99C,KAAKoiD,IAAa/wC,KAAlBrR,MACAA,KAAKmlD,oBACDv7B,EAAKy1B,GAALr/C,MAAyB,CAC3B,IAAK,MAAM8qD,KAAWlhC,EAAKy1B,GAALr/C,MAAwBq/B,SAC5CE,aAAaurB,GAEf5hC,EAAKm2B,GAALr/C,KAA0B,KAC5B,CACAA,KAAK2c,OAAS,KACI,QAAlBguC,EAAA/gC,EAAK01B,GAALt/C,aAAkB,IAAA2qD,GAAlBA,EAAoBx9B,UACpBjE,EAAKo2B,GAALt/C,KAAqB,MACD,QAApB4qD,EAAAhhC,EAAK80B,GAAL1+C,aAAoB,IAAA4qD,GAApBA,EAAsB9/B,SACtB5B,EAAKw1B,GAAL1+C,KAAuB,KACzB,CAKA,eAAIqoD,GACF,OAAO,CACT,CAKA0C,aAAAA,GACM/qD,KAAKqoD,cACPnpD,EAAA4+C,GAAA99C,KAAKgrD,IAAe35C,KAApBrR,MACA4pB,EAAK20B,GAALv+C,MAAkBgoB,UAAU8C,OAAO,UAEvC,CAEA,mBAAIV,GACF,OAAO,IACT,CAMA,yBAAIgtB,GACF,MAAqC,QAA9Bp3C,KAAK6pB,WAAWQ,UAAsB,CAAC,EAAG,GAAK,CAAC,EAAG,EAC5D,CAEA,+BAAI4gC,GACF,MACE7T,uBAAwBhW,EAAMC,IAC5BrhC,MACGwnD,EAAKC,EAAKC,EAAKH,GAAOvnD,KAAKopD,aAClC,MAAO,CACL3L,GAAiB6G,OAAOkD,GAAOE,EAAMF,GAAOpmB,GAC5Cqc,GAAiB6G,OAAOmD,GAAOF,EAAME,IAAQ,EAAIpmB,IAErD,CAEA,sBAAIgW,GACF,OAAOr3C,KAAK6pB,WAAW2Y,iBACrBxiC,KAAK0gC,iBACL1gC,KAAKyiC,QAET,CAEA,wBAAIyoB,GACF,OAAOthC,EAAKs0B,GAALl+C,MAAc+3C,2BACvB,CAEA,wBAAImT,CAAqBn4C,GACvB6W,EAAKs0B,GAALl+C,MAAc+3C,4BAA8BhlC,CAC9C,CAEAmlC,uBAAAA,GACE,OAAOtuB,EAAKs0B,GAALl+C,MAAck4C,yBACvB,CAEA,sBAAIP,GACF,OAAO/tB,EAAKs0B,GAALl+C,MAAc23C,kBACvB,CAEA,sBAAIwT,GACF,OAAOnrD,KAAKmc,GACd,CAEAm8B,sBAAAA,CAAuB5sC,GAAS,IAAA0/C,EACjB,QAAbA,EAAAxhC,EAAKs0B,GAALl+C,aAAa,IAAAorD,GAAbA,EAAe9S,uBAAuB5sC,EACxC,CAMA88B,OAAAA,CAAQxuB,GACN,IACGha,KAAKqoD,aACNruC,EAAME,SAAWla,KAAKmc,KACR,UAAdnC,EAAMkB,IAEN,OAEFlb,KAAK6pB,WAAW6hB,YAAY1rC,MAC5BkpB,EAAKu1B,GAALz+C,KAAwB,CACtB+uC,OAAQ/uC,KAAK8V,EACbk5B,OAAQhvC,KAAK+V,EACbs1C,WAAYrrD,KAAKggB,MACjBsrC,YAAatrD,KAAKigB,SAEpB,MAAM7G,EAAWwQ,EAAK20B,GAALv+C,MAAkBoZ,SACnC,IAAKwQ,EAAKo0B,GAALh+C,MAAsB,CACzBkpB,EAAK80B,GAALh+C,KAAuBuR,MAAMC,KAAK4H,IAClC,MAAMmyC,EAAsBrsD,EAAA4+C,GAAA99C,KAAKwrD,IAAgBj+B,KAAKvtB,MAChDyrD,EAAmBvsD,EAAA4+C,GAAA99C,KAAK0rD,IAAan+B,KAAKvtB,MAC1C2pB,EAAS3pB,KAAK6pB,WAAWC,QAC/B,IAAK,MAAM3N,KAAOyN,EAAKo0B,GAALh+C,MAAsB,CACtC,MAAMuN,EAAO4O,EAAI3B,aAAa,qBAC9B2B,EAAI/B,aAAa,OAAQ,cACzB+B,EAAIpC,iBAAiB,UAAWwxC,EAAqB,CAAE5hC,WACvDxN,EAAIpC,iBAAiB,OAAQ0xC,EAAkB,CAAE9hC,WACjDxN,EAAIpC,iBAAiB,QAAS7a,EAAA4+C,GAAA99C,KAAK2rD,IAAcp+B,KAAKvtB,KAAMuN,GAAO,CACjEoc,WAEFxN,EAAI/B,aAAa,eAAgBqjC,GAAiBqD,aAAavzC,GACjE,CACF,CAIA,MAAM0H,EAAQ2U,EAAKo0B,GAALh+C,MAAqB,GACnC,IAAI4rD,EAAgB,EACpB,IAAK,MAAMzvC,KAAO/C,EAAU,CAC1B,GAAI+C,IAAQlH,EACV,MAEF22C,GACF,CACA,MAAMC,GACD,IAAM7rD,KAAKof,SAAWpf,KAAK6hD,gBAAkB,IAAO,IACtDj4B,EAAKo0B,GAALh+C,MAAqB3B,OAAS,GAEjC,GAAIwtD,IAAsBD,EAAe,CAGvC,GAAIC,EAAoBD,EACtB,IAAK,IAAIl9C,EAAI,EAAGA,EAAIk9C,EAAgBC,EAAmBn9C,IACrDkb,EAAK20B,GAALv+C,MAAkBoc,OAAOwN,EAAK20B,GAALv+C,MAAkB+nB,wBAExC,GAAI8jC,EAAoBD,EAC7B,IAAK,IAAIl9C,EAAI,EAAGA,EAAIm9C,EAAoBD,EAAel9C,IACrDkb,EAAK20B,GAALv+C,MAAkB+nB,kBAAkB09B,OAClC77B,EAAK20B,GAALv+C,MAAkB8rD,kBAKxB,IAAIp9C,EAAI,EACR,IAAK,MAAM2K,KAASD,EAAU,CAC5B,MACM7L,EADMqc,EAAKo0B,GAALh+C,MAAqB0O,KAChB8L,aAAa,qBAC9BnB,EAAMe,aAAa,eAAgBqjC,GAAiBqD,aAAavzC,GACnE,CACF,CAEArO,EAAA4+C,GAAA99C,KAAK+rD,IAAmB16C,KAAxBrR,KAAyB,GACzBkpB,EAAK+1B,GAALj/C,MAAoC,GACpC4pB,EAAK20B,GAALv+C,MAAkB+nB,kBAAkBic,MAAM,CAAE4Q,cAAc,IAC1D56B,EAAMqI,iBACNrI,EAAMgyC,0BACR,CA4BApO,mBAAAA,CAAoB9nC,EAAGC,GAChB6T,EAAKq1B,GAALj/C,OAGLd,EAAA4+C,GAAA99C,KAAKisD,IAAmB56C,KAAxBrR,KAAyB4pB,EAAKg1B,GAAL5+C,MAA0B,CACjDksD,OAAQp2C,EACRq2C,OAAQp2C,EACRq2C,cAAc,GAElB,CAQAvO,yBAAAA,GACE3+C,EAAA4+C,GAAA99C,KAAKoiD,IAAa/wC,KAAlBrR,MACAA,KAAKmc,IAAI6nB,OACX,CAKA4J,MAAAA,GAAS,IAAAye,EAAAC,EAAAC,EACHvsD,KAAKqiC,YAAcriC,KAAK6kD,aAC1B7kD,KAAK6kD,aAAal6B,QAGpB3qB,KAAKqiC,YAAa,EAClBriC,KAAK+qD,gBACG,QAARsB,EAAArsD,KAAKmc,WAAG,IAAAkwC,GAARA,EAAUrkC,UAAUhpB,IAAI,kBACnBgB,KAAK6kD,cAWO,QAAjByH,EAAAtsD,KAAK6kD,oBAAY,IAAAyH,GAAjBA,EAAmB3hC,OACN,QAAb4hC,EAAA3iC,EAAKq0B,GAALj+C,aAAa,IAAAusD,GAAbA,EAAetX,oBAAmB,IAXhCj1C,KAAK4kD,iBAAiB7kD,KAAK,KAAM,IAAAysD,EACqBC,EAAxC,QAAZD,EAAIxsD,KAAKmc,WAAG,IAAAqwC,GAARA,EAAUxkC,UAAU+S,SAAS,oBAId,QAAjB0xB,EAAAzsD,KAAK6kD,oBAAY,IAAA4H,GAAjBA,EAAmB9hC,UAO3B,CAEAqZ,KAAAA,GACMhkC,KAAKmc,MAAQnc,KAAKmc,IAAI4e,SAAShf,SAASif,gBAC1CgS,WAAW,SAAA0f,EAAA,OAAc,QAAdA,EAAM1sD,KAAKmc,WAAG,IAAAuwC,OAAA,EAARA,EAAU1oB,MAAM,CAAE2oB,eAAe,KAAS,EAE/D,CAKA/gB,QAAAA,GAAW,IAAAghB,EAAAC,EAAAC,EAAAC,EAAAC,EACJhtD,KAAKqiC,aAGVriC,KAAKqiC,YAAa,EACD,QAAjBuqB,EAAAhjC,EAAK20B,GAALv+C,aAAiB,IAAA4sD,GAAjBA,EAAmB5kC,UAAUhpB,IAAI,UACzB,QAAR6tD,EAAA7sD,KAAKmc,WAAG,IAAA0wC,GAARA,EAAU7kC,UAAU8C,OAAO,kBACf,QAAZgiC,EAAI9sD,KAAKmc,WAAG,IAAA2wC,GAARA,EAAU/xB,SAAShf,SAASif,gBAG9Bh7B,KAAK6pB,WAAW0d,aAAaprB,IAAI6nB,MAAM,CACrC2oB,eAAe,IAGF,QAAjBI,EAAA/sD,KAAK6kD,oBAAY,IAAAkI,GAAjBA,EAAmBviC,OACN,QAAbwiC,EAAApjC,EAAKq0B,GAALj+C,aAAa,IAAAgtD,GAAbA,EAAe/X,oBAAmB,GAClCj1C,KAAK6qD,mBACP,CAEAA,gBAAAA,GACM7qD,KAAKorC,YACPprC,KAAK6pB,WAAW+X,cAAc,KAElC,CAOA9D,YAAAA,CAAat9B,EAAMV,GAAQ,CAM3BmtD,cAAAA,GAAkB,CAMlBC,aAAAA,GAAiB,CAQjB,oBAAIC,GACF,OAAO,CACT,CAKAxhB,eAAAA,GACO3rC,KAAKmtD,mBAGVntD,KAAKupD,iBACLvpD,KAAKmc,IAAI6nB,QACX,CAMAopB,QAAAA,CAASpzC,GACuB,WAA1BA,EAAME,OAAOmzC,WAIjBrtD,KAAK2rC,kBACL3rC,KAAK2c,OAAOovB,cAAc,CACxBvI,KAAMxjC,KAAKwN,YAAYw9B,YACvBhB,OAAQhqC,KAAK0hC,MAEjB,CAKA2U,oBAAAA,GACE,OAAOr2C,KAAKmc,GACd,CAMA,cAAImxC,GACF,OAAOttD,KAAKmc,GACd,CAMA,aAAI+gB,GACF,OAAOtT,EAAKm1B,GAAL/+C,KACT,CAMA,aAAIk9B,CAAUp9B,GACZopB,EAAK61B,GAAL/+C,KAAkBF,GACbE,KAAK2c,SAGN7c,GACFE,KAAK2c,OAAO+uB,YAAY1rC,MACxBA,KAAK2c,OAAO2wB,gBAAgBttC,OAE5BA,KAAK2c,OAAO2wB,gBAAgB,MAEhC,CAEA,mBAAWigB,GACT,OAAO,EACT,CAEA,8BAAO1hB,GACL,OAAO,CACT,CAMA,wBAAI2hB,GACF,MAAO,CAAEvhB,OAAQ,QACnB,CAMA,sBAAIwhB,GACF,OAAO,IACT,CAEAjZ,gBAAAA,CAAiBtsB,GACf,GAD6B/oB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACf,CACZyqB,EAAKy1B,GAALr/C,OAAAkpB,EAAKm2B,GAALr/C,KAA4B,IAAIqnB,KAChC,MAAM,OAAE4kB,GAAW/jB,EACnB,IAAI4iC,EAAUlhC,EAAKy1B,GAALr/C,MAAwBV,IAAI2sC,GAY1C,OAXI6e,GACFvrB,aAAaurB,GAEfA,EAAU9d,WAAW,KACnBhtC,KAAKw0C,iBAAiBtsB,GACtB0B,EAAKy1B,GAALr/C,MAAwBqrB,OAAO4gB,GACM,IAAjCriB,EAAKy1B,GAALr/C,MAAwBywB,MAC1BvH,EAAKm2B,GAALr/C,KAA0B,OAE3By9C,GAAiBiQ,wBACpB9jC,EAAKy1B,GAALr/C,MAAwBxB,IAAIytC,EAAQ6e,EAEtC,CACA5iC,EAAK1nB,OAAL0nB,EAAK1nB,KAASR,KAAKirB,YACnBjrB,KAAK6pB,WAAWyT,UAAUoG,SAAS,kBAAmB,CACpDC,OAAQ3jC,KACR6N,QAAS,CACPrN,KAAM,UACN0nB,SAGN,CAMAyC,IAAAA,GAAgC,IAA3BwhB,EAAOhtC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAKioD,WAClBjoD,KAAKmc,IAAI6L,UAAUqc,OAAO,UAAW8H,GACrCnsC,KAAKioD,WAAa9b,CACpB,CAEAzC,MAAAA,GACM1pC,KAAKmc,MACPnc,KAAKmc,IAAIgP,SAAW,GAEtBjC,EAAKk1B,GAALp+C,MAAiB,EACnB,CAEA2pC,OAAAA,GACM3pC,KAAKmc,MACPnc,KAAKmc,IAAIgP,UAAY,GAEvBjC,EAAKk1B,GAALp+C,MAAiB,EACnB,CAEA2tD,2BAAAA,CAA4BC,GAC1B,GAAKhkC,EAAK80B,GAAL1+C,OAAyBA,KAAKqrC,QAInC,OAAIrrC,KAAKqrC,SACPzhB,EAAK80B,GAAL1+C,MAAqB8qB,cACrB5B,EAAKw1B,GAAL1+C,KAAuB,aAGrBA,KAAK+mD,kBAAoB/mD,KAAK4jD,eAAiB5jD,KAAK6jD,kBACtDj6B,EAAK80B,GAAL1+C,MAAqB6tD,aAAa,CAChCl6C,KAAM3T,KAAKopD,aACXzB,MAAO3nD,KAAK0rB,WAXdxC,EAAKw1B,GAAL1+C,KAAuB4tD,EAAgBE,kBAAkB9tD,MAc7D,CAOAmxC,uBAAAA,CAAwB7F,GACtB,GAAItrC,KAAKqrC,QAEP,OADAC,EAAW9gB,OACJ,KAET,IAAIujC,EAAUziB,EAAW9jB,UAAUsF,cAAc,sBACjD,GAAKihC,GAIE,GAAyB,WAArBA,EAAQV,SAAuB,CACxC,MAAM16B,EAASo7B,EACfA,EAAUhyC,SAASC,cAAc,OACjC+xC,EAAQ/lC,UAAUhpB,IAAI,oBAAqBgB,KAAKirB,YAChD0H,EAAO8yB,OAAOsI,EAChB,OAREA,EAAUhyC,SAASC,cAAc,OACjC+xC,EAAQ/lC,UAAUhpB,IAAI,oBAAqBgB,KAAKirB,YAChDqgB,EAAW9jB,UAAUwmC,QAAQD,GAQ/B,OAAOA,CACT,CAEAE,sBAAAA,CAAuB3iB,GACrB,MAAM,kBAAEvjB,GAAsBujB,EAAW9jB,UAEP,SAAf,OAAjBO,QAAiB,IAAjBA,OAAiB,EAAjBA,EAAmBslC,WACnBtlC,EAAkBC,UAAU+S,SAAS,sBAErChT,EAAkB+C,QAEtB,EAxzEoB,SAAAo4B,GAAAgL,EAwbQp4C,EAAGC,GAAG,IAAtBiK,EAAOC,GAAOiuC,GACvBp4C,EAAGC,GAAK/V,KAAK4iD,wBAAwB9sC,EAAGC,GAEzC/V,KAAK8V,GAAKA,EAAIkK,EACdhgB,KAAK+V,GAAKA,EAAIkK,EAEdjgB,KAAK2jD,eAAe3jD,KAAK8V,EAAG9V,KAAK+V,GAEjC/V,KAAK8hD,mBACP,UAAAkC,GAoLoBluC,EAAGC,EAAGo4C,GACxB,OAAQA,GACN,KAAK,GACH,MAAO,CAACp4C,GAAID,GACd,KAAK,IACH,MAAO,EAAEA,GAAIC,GACf,KAAK,IACH,MAAO,EAAEA,EAAGD,GACd,QACE,MAAO,CAACA,EAAGC,GAEjB,UAAAq4C,GAoBmBhvC,GACjB,OAAQA,GACN,KAAK,GAAI,CACP,MAAOgB,EAAWC,GAAcrgB,KAAKigD,eACrC,MAAO,CAAC,GAAI7/B,EAAYC,EAAYA,EAAaD,EAAW,EAC9D,CACA,KAAK,IACH,MAAO,EAAE,EAAG,EAAG,GAAI,GACrB,KAAK,IAAK,CACR,MAAOA,EAAWC,GAAcrgB,KAAKigD,eACrC,MAAO,CAAC,EAAG7/B,EAAYC,GAAaA,EAAaD,EAAW,EAC9D,CACA,QACE,MAAO,CAAC,EAAG,EAAG,EAAG,GAEvB,UAAA4qC,KAwCE,GAAIphC,EAAK20B,GAALv+C,MACF,OAEFkpB,EAAKq1B,GAALv+C,KAAoB+b,SAASC,cAAc,QAC3C4N,EAAK20B,GAALv+C,MAAkBgoB,UAAUhpB,IAAI,YAIhC,MAAMqvD,EAAUruD,KAAKy/C,qBACjB,CAAC,UAAW,WAAY,cAAe,cACvC,CACE,UACA,YACA,WACA,cACA,cACA,eACA,aACA,cAEA91B,EAAS3pB,KAAK6pB,WAAWC,QAC/B,IAAK,MAAMvc,KAAQ8gD,EAAS,CAC1B,MAAMlyC,EAAMJ,SAASC,cAAc,OACnC4N,EAAK20B,GAALv+C,MAAkBoc,OAAOD,GACzBA,EAAI6L,UAAUhpB,IAAI,UAAWuO,GAC7B4O,EAAI/B,aAAa,oBAAqB7M,GACtC4O,EAAIpC,iBACF,cACA7a,EAAA4+C,GAAA99C,KAAKsuD,IAAoB/gC,KAAKvtB,KAAMuN,GACpC,CAAEoc,WAEJxN,EAAIpC,iBAAiB,cAAeqI,GAAe,CAAEuH,WACrDxN,EAAIgP,UAAY,CAClB,CACAnrB,KAAKmc,IAAI6xC,QAAQpkC,EAAK20B,GAALv+C,MACnB,UAAAsuD,GAEoB/gD,EAAMyM,GAAO,IAAAu0C,EAC/Bv0C,EAAMqI,iBACN,MAAM,MAAEzR,GAAUtB,GAAYgB,SAC9B,GAAqB,IAAjB0J,EAAMkR,QAAiBlR,EAAMwc,SAAW5lB,EAC1C,OAGW,QAAb29C,EAAA3kC,EAAKq0B,GAALj+C,aAAa,IAAAuuD,GAAbA,EAAelqB,QAAO,GAEtB,MAAMmqB,EAAiBxuD,KAAKu/C,aAC5Bv/C,KAAKu/C,cAAe,EACpBr2B,EAAKs1B,GAALx+C,KAA0B,CAACga,EAAMgiC,QAAShiC,EAAMkiC,UAEhD,MAAMzc,EAAK,IAAIxC,gBACTtT,EAAS3pB,KAAK6pB,WAAW2V,eAAeC,GAE9Cz/B,KAAK2c,OAAO8xC,qBAAoB,GAChC3oC,OAAO/L,iBACL,cACA7a,EAAA4+C,GAAA99C,KAAKisD,IAAoB1+B,KAAKvtB,KAAMuN,GACpC,CAAEqtC,SAAS,EAAMptB,SAAS,EAAM7D,WAElC7D,OAAO/L,iBACL,YACAuI,GACA,CAAEs4B,SAAS,EAAOjxB,WAEpB7D,OAAO/L,iBAAiB,cAAeqI,GAAe,CAAEuH,WACxDT,EAAKu1B,GAALz+C,KAAwB,CACtB+uC,OAAQ/uC,KAAK8V,EACbk5B,OAAQhvC,KAAK+V,EACbs1C,WAAYrrD,KAAKggB,MACjBsrC,YAAatrD,KAAKigB,SAEpB,MAAMyuC,EAAoB1uD,KAAK2c,OAAOR,IAAId,MAAMszC,OAC1CC,EAAc5uD,KAAKmc,IAAId,MAAMszC,OACnC3uD,KAAKmc,IAAId,MAAMszC,OAAS3uD,KAAK2c,OAAOR,IAAId,MAAMszC,OAC5C7oC,OAAOoR,iBAAiBld,EAAME,QAAQy0C,OAExC,MAAME,EAAoBA,KAAM,IAAAC,EAC9BrvB,EAAGN,QACHn/B,KAAK2c,OAAO8xC,qBAAoB,GACnB,QAAbK,EAAAllC,EAAKq0B,GAALj+C,aAAa,IAAA8uD,GAAbA,EAAezqB,QAAO,GACtBrkC,KAAKu/C,aAAeiP,EACpBxuD,KAAK2c,OAAOR,IAAId,MAAMszC,OAASD,EAC/B1uD,KAAKmc,IAAId,MAAMszC,OAASC,EAExB1vD,EAAA4+C,GAAA99C,KAAK+uD,IAAqB19C,KAA1BrR,OAEF8lB,OAAO/L,iBAAiB,YAAa80C,EAAmB,CAAEllC,WAG1D7D,OAAO/L,iBAAiB,OAAQ80C,EAAmB,CAAEllC,UACvD,UAAAqlC,GAEQl5C,EAAGC,EAAGiK,EAAOC,GACnBjgB,KAAKggB,MAAQA,EACbhgB,KAAKigB,OAASA,EACdjgB,KAAK8V,EAAIA,EACT9V,KAAK+V,EAAIA,EACT/V,KAAKmkD,UACLnkD,KAAK8hD,oBACL9hD,KAAKqkD,YACP,UAAA0K,KAQE,IAAKnlC,EAAK60B,GAALz+C,MACH,OAEF,MAAM,OAAE+uC,EAAM,OAAEC,EAAM,WAAEqc,EAAU,YAAEC,GAAgB1hC,EAAK60B,GAALz+C,MACpDkpB,EAAKu1B,GAALz+C,KAAwB,MAExB,MAAMkvC,EAAOlvC,KAAK8V,EACZq5B,EAAOnvC,KAAK+V,EACZk5C,EAAWjvD,KAAKggB,MAChBkvC,EAAYlvD,KAAKigB,OAErBivB,IAASH,GACTI,IAASH,GACTigB,IAAa5D,GACb6D,IAAc5D,GAKhBtrD,KAAKuoC,YAAY,CACfrT,IAAKh2B,EAAA4+C,GAAA99C,KAAKgvD,IAAQzhC,KAAKvtB,KAAMkvC,EAAMC,EAAM8f,EAAUC,GACnD/5B,KAAMj2B,EAAA4+C,GAAA99C,KAAKgvD,IAAQzhC,KAAKvtB,KAAM+uC,EAAQC,EAAQqc,EAAYC,GAC1Dj2B,UAAU,GAEd,UAAA42B,GASoB1+C,EAAMyM,GACxB,MAAO02B,EAAaC,GAAgB3wC,KAAK24C,iBACnC5J,EAAS/uC,KAAK8V,EACdk5B,EAAShvC,KAAK+V,EACds1C,EAAarrD,KAAKggB,MAClBsrC,EAActrD,KAAKigB,OACnBkvC,EAAW1R,EAAiB8P,SAAW7c,EACvC0e,EAAY3R,EAAiB8P,SAAW5c,EAExC0e,EAAiBnwD,EAAA4+C,GAAA99C,KAAKouD,IAAkB/8C,KAAvBrR,KAAwBA,KAAKof,UAC9CkwC,EAASA,CAACx5C,EAAGC,IAAM,CACvBs5C,EAAe,GAAKv5C,EAAIu5C,EAAe,GAAKt5C,EAC5Cs5C,EAAe,GAAKv5C,EAAIu5C,EAAe,GAAKt5C,GAExCw5C,EAAoBrwD,EAAA4+C,GAAA99C,KAAKouD,IAAkB/8C,KAAvBrR,KAAwB,IAAMA,KAAKof,UAK7D,IAAIowC,EACAC,EACAC,GAAa,EACbC,GAAe,EAEnB,OAAQpiD,GACN,IAAK,UACHmiD,GAAa,EACbF,EAAWA,CAACjrC,EAAGC,IAAM,CAAC,EAAG,GACzBirC,EAAcA,CAAClrC,EAAGC,IAAM,CAACD,EAAGC,GAC5B,MACF,IAAK,YACHgrC,EAAWA,CAACjrC,EAAGC,IAAM,CAACD,EAAI,EAAG,GAC7BkrC,EAAcA,CAAClrC,EAAGC,IAAM,CAACD,EAAI,EAAGC,GAChC,MACF,IAAK,WACHkrC,GAAa,EACbF,EAAWA,CAACjrC,EAAGC,IAAM,CAACD,EAAG,GACzBkrC,EAAcA,CAAClrC,EAAGC,IAAM,CAAC,EAAGA,GAC5B,MACF,IAAK,cACHmrC,GAAe,EACfH,EAAWA,CAACjrC,EAAGC,IAAM,CAACD,EAAGC,EAAI,GAC7BirC,EAAcA,CAAClrC,EAAGC,IAAM,CAAC,EAAGA,EAAI,GAChC,MACF,IAAK,cACHkrC,GAAa,EACbF,EAAWA,CAACjrC,EAAGC,IAAM,CAACD,EAAGC,GACzBirC,EAAcA,CAAClrC,EAAGC,IAAM,CAAC,EAAG,GAC5B,MACF,IAAK,eACHgrC,EAAWA,CAACjrC,EAAGC,IAAM,CAACD,EAAI,EAAGC,GAC7BirC,EAAcA,CAAClrC,EAAGC,IAAM,CAACD,EAAI,EAAG,GAChC,MACF,IAAK,aACHmrC,GAAa,EACbF,EAAWA,CAACjrC,EAAGC,IAAM,CAAC,EAAGA,GACzBirC,EAAcA,CAAClrC,EAAGC,IAAM,CAACD,EAAG,GAC5B,MACF,IAAK,aACHorC,GAAe,EACfH,EAAWA,CAACjrC,EAAGC,IAAM,CAAC,EAAGA,EAAI,GAC7BirC,EAAcA,CAAClrC,EAAGC,IAAM,CAACD,EAAGC,EAAI,GAIpC,MAAMorC,EAAQJ,EAASnE,EAAYC,GAC7BuE,EAAgBJ,EAAYpE,EAAYC,GAC9C,IAAIwE,EAAsBR,KAAUO,GACpC,MAAME,EAAYtS,EAAiB6G,OAAOvV,EAAS+gB,EAAoB,IACjEE,EAAYvS,EAAiB6G,OAAOtV,EAAS8gB,EAAoB,IACvE,IAGI5D,EAAQC,EAHR8D,EAAS,EACTC,EAAS,EAIb,GAAKl2C,EAAMoyC,eAaNF,SAAQC,UAAWnyC,OAbC,CAIvB,MAAM,QAAEgiC,EAAO,QAAEE,GAAYliC,GACtBm2C,EAAaC,GAAexmC,EAAK40B,GAALx+C,OAClCksD,EAAQC,GAAUnsD,KAAK4iD,wBACtB5G,EAAUmU,EACVjU,EAAUkU,GAEZxmC,EAAK40B,GAALx+C,MAAwB,GAAKg8C,EAC7BpyB,EAAK40B,GAALx+C,MAAwB,GAAKk8C,CAC/B,CAxEkBmU,IAACv6C,EAAGC,EA6EtB,IAFCm2C,EAAQC,IA3EUr2C,EA2EUo2C,EAASxb,EA3EhB36B,EA2E6Bo2C,EAASxb,EA3EhC,CAC1B4e,EAAkB,GAAKz5C,EAAIy5C,EAAkB,GAAKx5C,EAClDw5C,EAAkB,GAAKz5C,EAAIy5C,EAAkB,GAAKx5C,IA2EhD25C,EAAY,CACd,MAAMY,EAAU1hD,KAAKwuC,MAAMiO,EAAYC,GACvC2E,EAASC,EAASthD,KAAKiG,IACrBjG,KAAKC,IACHD,KAAKwuC,MACHyS,EAAc,GAAKD,EAAM,GAAK1D,EAC9B2D,EAAc,GAAKD,EAAM,GAAKzD,GAC5BmE,EAEJ,EAAIjF,EACJ,EAAIC,GAGN6D,EAAW9D,EACX+D,EAAY9D,EAEhB,MAAWqE,EACTM,EACEt4C,GAAU/I,KAAKmI,IAAI84C,EAAc,GAAKD,EAAM,GAAK1D,GAASiD,EAAU,GACpE9D,EAEF6E,EACEv4C,GACE/I,KAAKmI,IAAI84C,EAAc,GAAKD,EAAM,GAAKzD,GACvCiD,EACA,GACE9D,EAGR,MAAM2D,EAAWxR,EAAiB6G,OAAO+G,EAAa4E,GAChDf,EAAYzR,EAAiB6G,OAAOgH,EAAc4E,GACxDJ,EAAsBR,KAAUG,EAAYR,EAAUC,IACtD,MAAMhgB,EAAO6gB,EAAYD,EAAoB,GACvC3gB,EAAO6gB,EAAYF,EAAoB,GAE7ClmC,EAAKk1B,GAAL9+C,OAAAkpB,EAAK41B,GAAL9+C,KAAsB,CAACA,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,SACxDjgB,KAAKggB,MAAQivC,EACbjvD,KAAKigB,OAASivC,EACdlvD,KAAK8V,EAAIo5B,EACTlvC,KAAK+V,EAAIo5B,EAETnvC,KAAKmkD,UACLnkD,KAAK8hD,oBAEL9hD,KAAKwkD,aACP,UAAA8D,KA8T2B,IAAAiI,EACzBrnC,EAAKu1B,GAALz+C,KAAwB,CACtB+uC,OAAQ/uC,KAAK8V,EACbk5B,OAAQhvC,KAAK+V,EACbs1C,WAAYrrD,KAAKggB,MACjBsrC,YAAatrD,KAAKigB,SAEP,QAAbswC,EAAA3mC,EAAKq0B,GAALj+C,aAAa,IAAAuwD,GAAbA,EAAelsB,QAAO,GACtBrkC,KAAK2c,OAAO8xC,qBAAoB,EAClC,UAAAlG,GAEoBiI,EAASC,EAActT,GAIzC,IAAIuT,EACgBvT,EAAWsT,EAFR,GAEwB,EAFxB,GAGvB,GAAe,IAAXC,EACF,OAGF,MAAMrB,EAAiBnwD,EAAA4+C,GAAA99C,KAAKouD,IAAkB/8C,KAAvBrR,KAAwBA,KAAKof,UAC9CkwC,EAASA,CAACx5C,EAAGC,IAAM,CACvBs5C,EAAe,GAAKv5C,EAAIu5C,EAAe,GAAKt5C,EAC5Cs5C,EAAe,GAAKv5C,EAAIu5C,EAAe,GAAKt5C,IAIvC26B,EAAaC,GAAgB3wC,KAAK24C,iBACnC5J,EAAS/uC,KAAK8V,EACdk5B,EAAShvC,KAAK+V,EACds1C,EAAarrD,KAAKggB,MAClBsrC,EAActrD,KAAKigB,OAEnBkvC,EAAW1R,EAAiB8P,SAAW7c,EACvC0e,EAAY3R,EAAiB8P,SAAW5c,EAC9C+f,EAAS9hD,KAAKiG,IACZjG,KAAKC,IAAI6hD,EAAQ,EAAIrF,EAAY,EAAIC,GACrC6D,EAAW9D,EACX+D,EAAY9D,GAEd,MAAM2D,EAAWxR,EAAiB6G,OAAO+G,EAAaqF,GAChDxB,EAAYzR,EAAiB6G,OAAOgH,EAAcoF,GACxD,GAAIzB,IAAa5D,GAAc6D,IAAc5D,EAC3C,OAGF1hC,EAAKk1B,GAAL9+C,OAAAkpB,EAAK41B,GAAL9+C,KAAsB,CAAC+uC,EAAQC,EAAQqc,EAAYC,IACnD,MAAMqF,EAAoBrB,EAAOjE,EAAa,EAAGC,EAAc,GACzD9rC,EAAUi+B,EAAiB6G,OAAOvV,EAAS4hB,EAAkB,IAC7DlxC,EAAUg+B,EAAiB6G,OAAOtV,EAAS2hB,EAAkB,IAC7DC,EAAuBtB,EAAOL,EAAW,EAAGC,EAAY,GAE9DlvD,KAAK8V,EAAI0J,EAAUoxC,EAAqB,GACxC5wD,KAAK+V,EAAI0J,EAAUmxC,EAAqB,GACxC5wD,KAAKggB,MAAQivC,EACbjvD,KAAKigB,OAASivC,EAEdlvD,KAAKmkD,UACLnkD,KAAK8hD,oBAEL9hD,KAAKwkD,aACP,UAAAgE,KAEyB,IAAAqI,EACV,QAAbA,EAAAjnC,EAAKq0B,GAALj+C,aAAa,IAAA6wD,GAAbA,EAAexsB,QAAO,GACtBrkC,KAAK2c,OAAO8xC,qBAAoB,GAChCvvD,EAAA4+C,GAAA99C,KAAK+uD,IAAqB19C,KAA1BrR,KACF,UAAA2oD,GAuBsB3uC,GACpB,MAAM,MAAEpJ,GAAUtB,GAAYgB,SAE3B0J,EAAMwc,UAAY5lB,GACnBoJ,EAAM0c,UACL1c,EAAMyc,SAAW7lB,EAElB5Q,KAAK2c,OAAOgxB,eAAe3tC,MAE3BA,KAAK2c,OAAO+uB,YAAY1rC,KAE5B,UAAA0oD,GAEkB1uC,GAChB,MAAM,WAAEqoB,GAAeriC,KACvBA,KAAK6pB,WAAWilB,mBAChB,IAAIgiB,GAAqB,EAEzB,MAAMrxB,EAAK,IAAIxC,gBACTtT,EAAS3pB,KAAK6pB,WAAW2V,eAAeC,GACxC2b,EAAO,CAAE5tB,SAAS,EAAMotB,SAAS,EAAOjxB,UACxConC,EAAa7yD,IACjBuhC,EAAGN,QAEHjW,EAAKm1B,GAALr+C,KAAsB,MACtBkpB,EAAK21B,GAAL7+C,MAAuB,GAClBA,KAAK6pB,WAAWwlB,kBACnBnwC,EAAA4+C,GAAA99C,KAAK2oD,IAAqBt3C,KAA1BrR,KAA2B9B,GAEzB4yD,GACF9wD,KAAK6oD,mBAILxmB,IACFnZ,EAAKi2B,GAALn/C,KAAkBga,EAAMg3C,SACxB9nC,EAAKk2B,GAALp/C,KAAkBga,EAAMi3C,SACxB/nC,EAAKm1B,GAALr+C,KAAsBga,EAAMsV,WAC5BpG,EAAKo1B,GAALt+C,KAAwBga,EAAM0V,aAC9B5J,OAAO/L,iBACL,cACA7b,IACO4yD,IACHA,GAAqB,EACrB9wD,KAAK6pB,WAAW+X,cACd5hC,MACmB,GACA,GAErBA,KAAK4oD,oBAEP,MAAQoI,QAASl7C,EAAGm7C,QAASl7C,EAAC,UAAEuZ,GAAcpxB,EAC9C,GAAIoxB,IAAc1F,EAAKy0B,GAALr+C,MAEhB,YADAsiB,GAAUpkB,GAGZ,MAAOwxC,EAAIC,GAAM3vC,KAAK4iD,wBACpB9sC,EAAI8T,EAAKu1B,GAALn/C,MACJ+V,EAAI6T,EAAKw1B,GAALp/C,OAENkpB,EAAKi2B,GAALn/C,KAAkB8V,GAClBoT,EAAKk2B,GAALp/C,KAAkB+V,GAClB/V,KAAK6pB,WAAW4lB,oBAAoBC,EAAIC,IAE1CyL,GAEFt1B,OAAO/L,iBACL,YACAuI,GACA84B,GAEFt1B,OAAO/L,iBACL,cAEA7b,IACMA,EAAEwxB,cAAgB9F,EAAK00B,GAALt+C,QAKhB4pB,EAAK01B,GAALt/C,OAAsB9B,EAAEgzD,YAC1BH,EAAW7yD,GAGfokB,GAAUpkB,IAEZk9C,IAIJ,MAAMyT,EAAoB3wD,IACnB0rB,EAAKy0B,GAALr+C,OAAuB4pB,EAAKy0B,GAALr+C,QAAwB9B,EAAEoxB,UAItDhN,GAAUpkB,GAHR6yD,EAAW7yD,IAKf4nB,OAAO/L,iBAAiB,YAAa80C,EAAmB,CAAEllC,WAI1D7D,OAAO/L,iBAAiB,OAAQ80C,EAAmB,CAAEllC,UACvD,UAAAu+B,KAgOE,GAAIt+B,EAAK+0B,GAAL3+C,QAAkBA,KAAKmc,IACzB,OAEF+M,EAAKy1B,GAAL3+C,KAAgB,IAAIi9B,iBACpB,MAAMtT,EAAS3pB,KAAK6pB,WAAW2V,eAAe5V,EAAK+0B,GAAL3+C,OAE9CA,KAAKmc,IAAIpC,iBAAiB,UAAW/Z,KAAKqiD,QAAQ90B,KAAKvtB,MAAO,CAAE2pB,WAChE3pB,KAAKmc,IAAIpC,iBAAiB,WAAY/Z,KAAKsiD,SAAS/0B,KAAKvtB,MAAO,CAAE2pB,UACpE,UAAA6hC,GAsSgBxxC,GACdyjC,EAAiBC,wBAAwB36B,KAAK/iB,KAAMga,EACtD,UAAA0xC,GAEa1xC,GAAO,IAAAm3C,EAEhBvnC,EAAKq1B,GAALj/C,QACmB,QAAnBmxD,EAAAn3C,EAAMwoC,qBAAa,IAAA2O,OAAA,EAAnBA,EAAqB/a,cAAexsB,EAAK20B,GAALv+C,OAEpCd,EAAA4+C,GAAA99C,KAAKoiD,IAAa/wC,KAAlBrR,KAEJ,UAAA2rD,GAEcp+C,GACZ2b,EAAK01B,GAAL5+C,KAA2B4pB,EAAKq1B,GAALj/C,MAAoCuN,EAAO,GACxE,UAAAw+C,GAEoBjsD,GAClB,GAAK8pB,EAAKo0B,GAALh+C,MAGL,IAAK,MAAMmc,KAAOyN,EAAKo0B,GAALh+C,MAChBmc,EAAIgP,SAAWrrB,CAEnB,UAAAsiD,KAcEl5B,EAAK+1B,GAALj/C,MAAoC,GACpCd,EAAA4+C,GAAA99C,KAAK+rD,IAAmB16C,KAAxBrR,MAA0B,GAC1Bd,EAAA4+C,GAAA99C,KAAK+uD,IAAqB19C,KAA1BrR,KACF,CAkSFoxD,EAzzEM3T,IAuhEJ5+B,EAAAA,EAAAA,GAvhEI4+B,GAAgB,QAiEL,OAAI5+B,EAAAA,EAAAA,GAjEf4+B,GAAgB,eAmEE,OAAI5+B,EAAAA,EAAAA,GAnEtB4+B,GAAgB,oBAyEO,IAAC5+B,EAAAA,EAAAA,GAzExB4+B,GAAgB,gBA2EG,IAAI9mB,KAAc9X,EAAAA,EAAAA,GA3ErC4+B,GAAgB,UA6EH,IAAC5+B,EAAAA,EAAAA,GA7Ed4+B,GAAgB,oBAkFO,KA0uE7B,MAAMkD,WAAmBlD,GACvBjwC,WAAAA,CAAYygC,GACVtgC,MAAMsgC,GACNjuC,KAAKmrC,oBAAsB8C,EAAO9C,oBAClCnrC,KAAKqrC,SAAU,CACjB,CAEAzD,SAAAA,GACE,OAAO5nC,KAAKiqD,kBACd,ECl2EF,MAAMoH,GAAO,WAEPC,GAAY,WACZC,GAAW,MAEjB,MAAMC,GACJhkD,WAAAA,CAAYikD,GACVzxD,KAAK0xD,GAAKD,EAAc,WAAPA,EAAoBJ,GACrCrxD,KAAK2xD,GAAKF,EAAc,WAAPA,EAAoBJ,EACvC,CAEAl0C,MAAAA,CAAOuF,GACL,IAAIwF,EAAM7pB,EACV,GAAqB,kBAAVqkB,EAAoB,CAC7BwF,EAAO,IAAI9Y,WAA0B,EAAfsT,EAAMrkB,QAC5BA,EAAS,EACT,IAAK,IAAIqQ,EAAI,EAAGuS,EAAKyB,EAAMrkB,OAAQqQ,EAAIuS,EAAIvS,IAAK,CAC9C,MAAMhB,EAAOgV,EAAMrT,WAAWX,GAC1BhB,GAAQ,IACVwa,EAAK7pB,KAAYqP,GAEjBwa,EAAK7pB,KAAYqP,IAAS,EAC1Bwa,EAAK7pB,KAAmB,IAAPqP,EAErB,CACF,KAAO,KAAIkkD,YAAYC,OAAOnvC,GAI5B,MAAM,IAAIvX,MAAM,wDAHhB+c,EAAOxF,EAAMrN,QACbhX,EAAS6pB,EAAK4pC,UAGhB,CAEA,MAAMC,EAAc1zD,GAAU,EACxB2zD,EAAa3zD,EAAuB,EAAd0zD,EAEtBE,EAAa,IAAIxiD,YAAYyY,EAAKxY,OAAQ,EAAGqiD,GACnD,IAAIG,EAAK,EACPC,EAAK,EACHT,EAAK1xD,KAAK0xD,GACZC,EAAK3xD,KAAK2xD,GACZ,MAAMS,EAAK,WACTC,EAAK,UACDC,EAASF,MACbG,EAASF,MAEX,IAAK,IAAI3jD,EAAI,EAAGA,EAAIqjD,EAAarjD,IACvB,EAAJA,GACFwjD,EAAKD,EAAWvjD,GAChBwjD,EAAOA,EAAKE,EAAMd,GAAeY,EAAKI,EAAUf,GAChDW,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,EAAOA,EAAKG,EAAMf,GAAeY,EAAKK,EAAUhB,GAChDG,GAAMQ,EACNR,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,EAAU,EAALA,EAAS,aAEdS,EAAKF,EAAWvjD,GAChByjD,EAAOA,EAAKC,EAAMd,GAAea,EAAKG,EAAUf,GAChDY,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,EAAOA,EAAKE,EAAMf,GAAea,EAAKI,EAAUhB,GAChDI,GAAMQ,EACNR,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,EAAU,EAALA,EAAS,YAMlB,OAFAO,EAAK,EAEGF,GACN,KAAK,EACHE,GAAMhqC,EAAmB,EAAd6pC,EAAkB,IAAM,GAErC,KAAK,EACHG,GAAMhqC,EAAmB,EAAd6pC,EAAkB,IAAM,EAErC,KAAK,EACHG,GAAMhqC,EAAmB,EAAd6pC,GAGXG,EAAOA,EAAKE,EAAMd,GAAeY,EAAKI,EAAUf,GAChDW,EAAMA,GAAM,GAAOA,IAAO,GAC1BA,EAAOA,EAAKG,EAAMf,GAAeY,EAAKK,EAAUhB,GAC9B,EAAdQ,EACFL,GAAMQ,EAENP,GAAMO,EAIZlyD,KAAK0xD,GAAKA,EACV1xD,KAAK2xD,GAAKA,CACZ,CAEAa,SAAAA,GACE,IAAId,EAAK1xD,KAAK0xD,GACZC,EAAK3xD,KAAK2xD,GAcZ,OAZAD,GAAMC,IAAO,EACbD,EAAY,WAALA,EAAmBJ,GAAoB,MAALI,EAAeH,GACxDI,EACS,WAALA,EAAmBL,IACW,YAA3BK,GAAM,GAAOD,IAAO,IAAqBJ,MAAe,GAC/DI,GAAMC,IAAO,EACbD,EAAY,UAALA,EAAmBJ,GAAoB,MAALI,EAAeH,GACxDI,EACS,WAALA,EAAmBL,IACW,YAA3BK,GAAM,GAAOD,IAAO,IAAqBJ,MAAe,GAC/DI,GAAMC,IAAO,GAGVD,IAAO,GAAGhgD,SAAS,IAAIC,SAAS,EAAG,MACnCggD,IAAO,GAAGjgD,SAAS,IAAIC,SAAS,EAAG,IAExC,EChHF,MAAM8gD,GAAoBn0D,OAAO8qB,OAAO,CACtCvF,IAAK,KACLpX,KAAM,GACNimD,cAAUjnD,IACV,IAAAknD,GAAA,IAAAhlC,QAAAilC,GAAA,IAAAjlC,QAAAklC,GAAA,IAAAllC,QAAAmlC,GAAA,IAAAnlC,QAAAolC,GAAA,IAAAhlC,QAKF,MAAMilC,GASJxlD,WAAAA,GAAc1O,EAAA,KAAAi0D,IARd9zD,EAAA,KAAA0zD,IAAY,GAEZ1zD,EAAA,KAAA2zD,GAAe,MAEf3zD,EAAA,KAAA4zD,GAAc,MAEd5zD,EAAA,KAAA6zD,GAAW,IAAIzrC,KAObrnB,KAAKizD,cAAgB,KACrBjzD,KAAKkzD,gBAAkB,KACvBlzD,KAAKmzD,mBAAqB,IAY5B,CAQAr5C,QAAAA,CAASoB,EAAKk4C,GACZ,MAAMtzD,EAAQ8pB,EAAKkpC,GAAL9yD,MAAcV,IAAI4b,GAChC,YAAczP,IAAV3L,EACKszD,EAGF90D,OAAO8c,OAAOg4C,EAActzD,EACrC,CAOAmmC,WAAAA,CAAY/qB,GACV,OAAO0O,EAAKkpC,GAAL9yD,MAAcV,IAAI4b,EAC3B,CAMA4P,MAAAA,CAAO5P,GACL,MAAM8qB,EAAcpc,EAAKkpC,GAAL9yD,MAAcV,IAAI4b,GACtC,QAAoBzP,IAAhBu6B,IAGAA,aAAuByX,IACzB7zB,EAAKipC,GAAL7yD,MAAiBqrB,OAAO2a,EAAYmF,qBAEtCvhB,EAAKkpC,GAAL9yD,MAAcqrB,OAAOnQ,GAEM,IAAvB0O,EAAKkpC,GAAL9yD,MAAcywB,MAChBzwB,KAAKqzD,gBAGgC,oBAA5BrzD,KAAKmzD,oBAAmC,CACjD,IAAK,MAAMrzD,KAAS8pB,EAAKkpC,GAAL9yD,MAAcq/B,SAChC,GAAIv/B,aAAiB29C,GACnB,OAGJz9C,KAAKmzD,mBAAmB,KAC1B,CACF,CAOAl5C,QAAAA,CAASiB,EAAKpb,GACZ,MAAMiN,EAAM6c,EAAKkpC,GAAL9yD,MAAcV,IAAI4b,GAC9B,IAAIo4C,GAAW,EACf,QAAY7nD,IAARsB,EACF,IAAK,MAAOwmD,EAAOC,KAAQl1D,OAAO6c,QAAQrb,GACpCiN,EAAIwmD,KAAWC,IACjBF,GAAW,EACXvmD,EAAIwmD,GAASC,QAIjBF,GAAW,EACX1pC,EAAKkpC,GAAL9yD,MAAcxB,IAAI0c,EAAKpb,GAErBwzD,GACFp0D,EAAA6zD,GAAA/yD,KAAKyzD,IAAYpiD,KAAjBrR,MAGEF,aAAiB29C,MAClB7zB,EAAKipC,GAAL7yD,OAAAkpB,EAAK2pC,GAAL7yD,KAAqB,IAAIqnB,MAAO7oB,IAAIsB,EAAMqrC,oBAAqBrrC,GACzB,oBAA5BE,KAAKmzD,oBACdnzD,KAAKmzD,mBAAmBrzD,EAAM0N,YAAY6yC,OAGhD,CAOAzhD,GAAAA,CAAIsc,GACF,OAAO0O,EAAKkpC,GAAL9yD,MAAcpB,IAAIsc,EAC3B,CAEA,QAAIuV,GACF,OAAO7G,EAAKkpC,GAAL9yD,MAAcywB,IACvB,CAWA4iC,aAAAA,GACMzpC,EAAK+oC,GAAL3yD,QACFkpB,EAAKypC,GAAL3yD,MAAiB,GACmB,oBAAzBA,KAAKkzD,iBACdlzD,KAAKkzD,kBAGX,CAKA,SAAIQ,GACF,OAAO,IAAIC,GAAuB3zD,KACpC,CAMA,gBAAI4zD,GACF,GAA2B,IAAvBhqC,EAAKkpC,GAAL9yD,MAAcywB,KAChB,OAAOgiC,GAET,MAAM5uC,EAAM,IAAIwD,IACd5a,EAAO,IAAI+kD,GACXkB,EAAW,GACPmB,EAAUv1D,OAAOwa,OAAO,MAC9B,IAAIg7C,GAAY,EAEhB,IAAK,MAAO54C,EAAKs4C,KAAQ5pC,EAAKkpC,GAAL9yD,MAAe,CACtC,MAAM2nC,EACJ6rB,aAAe/V,GACX+V,EAAI5rB,WAA+B,EAAOisB,GAC1CL,EACF7rB,IACF9jB,EAAIrlB,IAAI0c,EAAKysB,GAEbl7B,EAAK0Q,OAAO,GAADnS,OAAIkQ,EAAG,KAAAlQ,OAAIq7B,KAAKC,UAAUqB,KACrCmsB,IAAAA,IAAgBnsB,EAAWnV,QAE/B,CAEA,GAAIshC,EAGF,IAAK,MAAMh0D,KAAS+jB,EAAIwb,SAClBv/B,EAAM0yB,QACRkgC,EAAS1jD,KAAKlP,EAAM0yB,QAK1B,OAAO3O,EAAI4M,KAAO,EACd,CAAE5M,MAAKpX,KAAMA,EAAK+lD,YAAaE,YAC/BD,EACN,CAEA,eAAIsB,GACF,IAAIC,EAAQ,KACZ,MAAMC,EAAe,IAAI5sC,IACzB,IAAI6sC,EAAyB,EACzBC,EAA0B,EAC9B,IAAK,MAAMr0D,KAAS8pB,EAAKkpC,GAAL9yD,MAAcq/B,SAAU,KAAA+0B,EAC1C,KAAMt0D,aAAiB29C,IAAmB,CACpC39C,EAAM6nD,QACJ7nD,EAAM6nD,MAAMtc,QACd8oB,GAA2B,EAE3BD,GAA0B,GAG9B,QACF,CACIp0D,EAAMu0D,iBACRF,GAA2B,EAClBr0D,EAAMinD,mBACfmN,GAA0B,GAE5B,MAAMH,EAAcj0D,EAAM2tD,mBAC1B,IAAKsG,EACH,SAEF,MAAM,KAAEvzD,GAASuzD,EACZE,EAAar1D,IAAI4B,IACpByzD,EAAaz1D,IAAIgC,EAAMlC,OAAO8hD,eAAetgD,GAAO0N,aAEtDwmD,IAAAA,EAAU11D,OAAOwa,OAAO,OACxB,MAAM+K,GAAOuwC,EAAAJ,GAAMxzD,KAAN4zD,EAAM5zD,GAAU,IAAI6mB,KACjC,IAAK,MAAOnM,EAAKs4C,KAAQl1D,OAAO6c,QAAQ44C,GAAc,KAAAO,EACpD,GAAY,SAARp5C,EACF,SAEF,IAAIq5C,EAAW1wC,EAAIvkB,IAAI4b,GAClBq5C,IACHA,EAAW,IAAIltC,IACfxD,EAAIrlB,IAAI0c,EAAKq5C,IAEf,MAAMC,EAAyB,QAApBF,EAAGC,EAASj1D,IAAIk0D,UAAI,IAAAc,EAAAA,EAAI,EACnCC,EAAS/1D,IAAIg1D,EAAKgB,EAAQ,EAC5B,CACF,CAQA,IAPIL,EAA0B,GAAKD,EAAyB,KAC1DF,IAAAA,EAAU11D,OAAOwa,OAAO,OACxBk7C,EAAMS,SAAW,CACfppB,QAAS8oB,EACTO,OAAQR,KAGPF,EACH,OAAO,KAET,IAAK,MAAOxzD,EAAMgoB,KAAWyrC,EAC3BD,EAAMxzD,GAAQgoB,EAAOmsC,0BAA0BX,EAAMxzD,IAEvD,OAAOwzD,CACT,CAEAY,gBAAAA,GACE1rC,EAAK0pC,GAAL5yD,KAAoB,KACtB,CAEA60D,YAAAA,CAAa9uB,EAAc7d,GAAM,IAAA4sC,EAC/B,MAAMh1D,EAAwB,QAAnBg1D,EAAGlrC,EAAKipC,GAAL7yD,aAAgB,IAAA80D,OAAA,EAAhBA,EAAkBx1D,IAAIymC,GACpC,QAAIjmC,IACFA,EAAMgnD,0BAA0B5+B,IACzB,EAGX,CAEAykB,SAAAA,CAAU5G,GAAc,IAAAgvB,EACtB,OAAuB,QAAhBA,EAAAnrC,EAAKipC,GAAL7yD,aAAgB,IAAA+0D,OAAA,EAAhBA,EAAkBz1D,IAAIymC,KAAiB,IAChD,CAKA,eAAIivB,GACF,GAAIprC,EAAKgpC,GAAL5yD,MACF,OAAO4pB,EAAKgpC,GAAL5yD,MAET,MAAMi1D,EAAM,GACZ,GAAIrrC,EAAKipC,GAAL7yD,MACF,IAAK,MAAMF,KAAS8pB,EAAKipC,GAAL7yD,MAAiBq/B,SAC9Bv/B,EAAM8nC,aAGXqtB,EAAIjmD,KAAKlP,EAAMqrC,qBAGnB,OAAQjiB,EAAK0pC,GAAL5yD,KAAoB,CAC1Bi1D,IAAK,IAAIzlC,IAAIylC,GACbxoD,KAAMwoD,EAAIhmD,KAAK,MAEnB,CAEA,CAACimD,OAAOC,YACN,OAAOvrC,EAAKkpC,GAAL9yD,MAAcmb,SACvB,EACF,SAAAs4C,KAxKS7pC,EAAK+oC,GAAL3yD,QACHkpB,EAAKypC,GAAL3yD,MAAiB,GACiB,oBAAvBA,KAAKizD,eACdjzD,KAAKizD,gBAGX,KAAAmC,GAAA,IAAAznC,QAyKF,MAAMgmC,WAA+BX,GAGnCxlD,WAAAA,CAAYmP,GACVhP,QAHF1O,EAAA,KAAAm2D,QAAa,GAIX,MAAM,IAAEvxC,EAAG,KAAEpX,EAAI,SAAEimD,GAAa/1C,EAAOi3C,aAEjCpzC,EAAQ60C,gBAAgBxxC,EAAK6uC,EAAW,CAAEA,YAAa,MAE7DxpC,EAAKksC,GAALp1D,KAAqB,CAAE6jB,IAAKrD,EAAO/T,OAAMimD,YAC3C,CAMA,SAAIgB,GACFxoD,GAAY,+CACd,CAMA,gBAAI0oD,GACF,OAAOhqC,EAAKwrC,GAALp1D,KACT,CAEA,eAAIg1D,GACF,OAAOloD,GAAO9M,KAAM,cAAe,CACjCi1D,IAAK,IAAIzlC,IACT/iB,KAAM,IAEV,E,mBChVF,MAAM6oD,GAGJ9nD,WAAAA,CAAW+nD,GAGR,IAHS,cACVC,EAAgBtkD,WAAW6K,SAAQ,aACnC05C,EAAe,MAChBF,EALDt2D,EAAA,KAAAy2D,GAAe,IAAIlmC,KAMjBxvB,KAAK21D,UAAYH,EAEjBx1D,KAAK41D,gBAAkB,IAAIpmC,IAC3BxvB,KAAKy1D,aAGC,KAGJz1D,KAAK61D,gBAAkB,GACvB71D,KAAK81D,eAAiB,CAE1B,CAEAC,iBAAAA,CAAkBC,GAChBh2D,KAAK41D,gBAAgB52D,IAAIg3D,GACzBh2D,KAAK21D,UAAUM,MAAMj3D,IAAIg3D,EAC3B,CAEAE,oBAAAA,CAAqBF,GACnBh2D,KAAK41D,gBAAgBvqC,OAAO2qC,GAC5Bh2D,KAAK21D,UAAUM,MAAM5qC,OAAO2qC,EAC9B,CAEAG,UAAAA,CAAWC,GACJp2D,KAAKy1D,eACRz1D,KAAKy1D,aAAez1D,KAAK21D,UAAU35C,cAAc,SACjDhc,KAAK21D,UAAUrU,gBACZ+U,qBAAqB,QAAQ,GAC7Bj6C,OAAOpc,KAAKy1D,eAEjB,MAAMa,EAAat2D,KAAKy1D,aAAac,MACrCD,EAAWH,WAAWC,EAAME,EAAWE,SAASn4D,OAClD,CAEAihC,KAAAA,GACE,IAAK,MAAM02B,KAAkBh2D,KAAK41D,gBAChC51D,KAAK21D,UAAUM,MAAM5qC,OAAO2qC,GAE9Bh2D,KAAK41D,gBAAgBt2B,QACrB1V,EAAK8rC,GAAL11D,MAAkBs/B,QAEdt/B,KAAKy1D,eAEPz1D,KAAKy1D,aAAa3qC,SAClB9qB,KAAKy1D,aAAe,KAExB,CAEA,oBAAMgB,CAAcC,GAIjB,IAHDC,eAAgB9rD,EAAI,gBACpB+rD,EAAe,aACfC,GACDH,EACC,GAAK7rD,IAAQ+e,EAAK8rC,GAAL11D,MAAkBpB,IAAIiM,EAAKisD,YAAxC,CAQA,GALA1rD,IACGwrD,EACD,qEAGE52D,KAAK+2D,0BAA2B,CAClC,MAAM,WAAED,EAAU,IAAEllC,EAAG,MAAEvW,GAAUxQ,EAC7BmsD,EAAW,IAAIC,SAASH,EAAYllC,EAAKvW,GAC/Crb,KAAK+1D,kBAAkBiB,GACvB,UACQA,EAASE,OACfttC,EAAK8rC,GAAL11D,MAAkBhB,IAAI83D,GACV,OAAZD,QAAY,IAAZA,GAAAA,EAAehsD,EACjB,CAAE,MAAAssD,GACAlsD,GAAK,4BAADD,OAC0BH,EAAKusD,aAAY,yDAG/Cp3D,KAAKk2D,qBAAqBc,EAC5B,CACA,MACF,CAEA9rD,GACE,gEAzBF,CA2BF,CAEA,UAAMqiB,CAAK8pC,GAET,GAAIA,EAAKC,UAAaD,EAAKE,cAAgBF,EAAKV,eAC9C,OAIF,GAFAU,EAAKC,UAAW,EAEZD,EAAKV,eAEP,kBADM32D,KAAKy2D,eAAeY,GAI5B,GAAIr3D,KAAK+2D,0BAA2B,CAClC,MAAMf,EAAiBqB,EAAKG,uBAC5B,GAAIxB,EAAgB,CAClBh2D,KAAK+1D,kBAAkBC,GACvB,UACQA,EAAeyB,MACvB,CAAE,MAAOzvB,GAKP,MAJA/8B,GAAK,wBAADD,OAAyBgrD,EAAe0B,OAAM,QAAA1sD,OAAOg9B,EAAE,OAG3DqvB,EAAKT,iBAAkB,EACjB5uB,CACR,CACF,CACA,MACF,CAGA,MAAMouB,EAAOiB,EAAKM,qBAClB,GAAIvB,EAAM,CAGR,GAFAp2D,KAAKm2D,WAAWC,GAEZp2D,KAAK43D,2BACP,aAKI,IAAIl4D,QAAQG,IAChB,MAAMse,EAAUne,KAAK63D,sBAAsBh4D,GAC3CG,KAAK83D,sBAAsBT,EAAMl5C,IAGrC,CACF,CAEA,6BAAI44C,GAA4B,IAAAgB,EAS9B,OAAOjrD,GAAO9M,KAAM,8BARa,QAAf+3D,EAAC/3D,KAAK21D,iBAAS,IAAAoC,IAAdA,EAAgB9B,OASrC,CAEA,8BAAI2B,GAOF,OAAO9qD,GACL9M,KACA,6BAEGG,GAAYmP,GAAYgB,SAASQ,UAExC,CAEA+mD,qBAAAA,CAAsB5hC,GAgBpB,MAAM,gBAAE4/B,GAAoB71D,KACtBme,EAAU,CACdve,MAAM,EACNo4D,SAdF,WAKE,IAJA5sD,IAAQ+S,EAAQve,KAAM,6CACtBue,EAAQve,MAAO,EAGRi2D,EAAgBx3D,OAAS,GAAKw3D,EAAgB,GAAGj2D,MAAM,CAC5D,MAAMq4D,EAAepC,EAAgBqC,QACrClrB,WAAWirB,EAAahiC,SAAU,EACpC,CACF,EAMEA,YAGF,OADA4/B,EAAgB7mD,KAAKmP,GACdA,CACT,CAEA,iBAAIg6C,GA+BF,OAAOrrD,GAAO9M,KAAM,gBAxBHo4D,KACf,49CAwBJ,CAEAN,qBAAAA,CAAsBT,EAAMl5C,GAW1B,SAASk6C,EAAMnwC,EAAMowC,GACnB,OACGpwC,EAAK7Y,WAAWipD,IAAW,GAC3BpwC,EAAK7Y,WAAWipD,EAAS,IAAM,GAC/BpwC,EAAK7Y,WAAWipD,EAAS,IAAM,EACD,IAA9BpwC,EAAK7Y,WAAWipD,EAAS,EAE9B,CACA,SAASC,EAAal5D,EAAGi5D,EAAQxtC,EAAQ0tC,GAGvC,OAFen5D,EAAE8hB,UAAU,EAAGm3C,GAEdE,EADDn5D,EAAE8hB,UAAUm3C,EAASxtC,EAEtC,CACA,IAAIpc,EAAGuS,EAGP,MAAM0R,EAAS3yB,KAAK21D,UAAU35C,cAAc,UAC5C2W,EAAO3S,MAAQ,EACf2S,EAAO1S,OAAS,EAChB,MAAM8D,EAAM4O,EAAOnB,WAAW,MAE9B,IAAIinC,EAAS,EAkBb,MAAM3C,EAAiB,KAAH9qD,OAAQ2W,KAAKC,OAAK5W,OAAGhL,KAAK81D,kBAM9C,IAAI5tC,EAAOloB,KAAKm4D,cAEhBjwC,EAAOqwC,EACLrwC,EAFqB,IAIrB4tC,EAAez3D,OACfy3D,GAGF,MACM4C,EAAa,WACnB,IAAIC,EAAWN,EAAMnwC,EAFO,IAG5B,IAAKxZ,EAAI,EAAGuS,EAAK60C,EAAez3D,OAAS,EAAGqQ,EAAIuS,EAAIvS,GAAK,EACvDiqD,EAAYA,EAAWD,EAAaL,EAAMvC,EAAgBpnD,GAAM,EZ2QtE,IAAkB5O,EYzQV4O,EAAIonD,EAAez3D,SAErBs6D,EAAYA,EAAWD,EAAaL,EAAMvC,EAAiB,MAAOpnD,GAAM,GAE1EwZ,EAAOqwC,EAAarwC,EAVQ,GAUmB,GZqQjCpoB,EYrQ6C64D,EZ4QtDpqD,OAAOC,aACX1O,GAAS,GAAM,IACfA,GAAS,GAAM,IACfA,GAAS,EAAK,IACP,IAARA,KY9QA,MAAMyL,EAAM,iCAAHP,OAAoCgN,KAAKkQ,GAAK,MACjDkuC,EAAO,4BAAHprD,OAA+B8qD,EAAc,UAAA9qD,OAASO,EAAG,KACnEvL,KAAKm2D,WAAWC,GAEhB,MAAMj6C,EAAMnc,KAAK21D,UAAU35C,cAAc,OACzCG,EAAId,MAAMyb,WAAa,SACvB3a,EAAId,MAAM2E,MAAQ7D,EAAId,MAAM4E,OAAS,OACrC9D,EAAId,MAAM8O,SAAW,WACrBhO,EAAId,MAAMkP,IAAMpO,EAAId,MAAMooC,KAAO,MAEjC,IAAK,MAAMl2C,IAAQ,CAAC8pD,EAAKP,WAAYhB,GAAiB,CACpD,MAAM7mC,EAAOjvB,KAAK21D,UAAU35C,cAAc,QAC1CiT,EAAKvW,YAAc,KACnBuW,EAAK5T,MAAMu9C,WAAarrD,EACxB4O,EAAIC,OAAO6S,EACb,CACAjvB,KAAK21D,UAAU3+B,KAAK5a,OAAOD,GA5D3B,SAAS08C,EAAYtrD,EAAM0oB,GAEzB,KAAMwiC,EAAS,GAGb,OAFAxtD,GAAK,qCACLgrB,IAGFlS,EAAIszC,KAAO,QAAU9pD,EACrBwW,EAAI+0C,SAAS,IAAK,EAAG,IACH/0C,EAAIgO,aAAa,EAAG,EAAG,EAAG,GAC9B7J,KAAK,GAAK,EACtB+N,IAGF+W,WAAW6rB,EAAYtrC,KAAK,KAAMhgB,EAAM0oB,GAC1C,CA+CA4iC,CAAY/C,EAAgB,KAC1B35C,EAAI2O,SACJ3M,EAAQ65C,YAGZ,EACF,IAAAe,GAAA,IAAAprC,QAEA,MAAMqrC,GAGJxrD,WAAAA,CAAYyrD,GAAiE,IAAjDC,EAAW/5D,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAAMg6D,EAAKh6D,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EAAE2tD,EAAoBj6D,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EAF3ExM,EAAA,KAAA85D,QAAS,GAGP/4D,KAAKq5D,eAAiB/6D,OAAOwa,OAAO,MACpCoQ,EAAK6vC,GAAL/4D,KAAiBi5D,GASjBj5D,KAAK62D,aAAeqC,EAChBC,GACF76D,OAAO8c,OAAOpb,KAAMm5D,GAElBC,IACFp5D,KAAKo5D,qBAAuBA,EAEhC,CAEA5B,oBAAAA,GAAuB,IAAA8B,EACrB,IAAKt5D,KAAKkoB,MAAQloB,KAAK42D,gBACrB,OAAO,KAET,IAAIZ,EACJ,GAAKh2D,KAAKu5D,YAEH,CACL,MAAMC,EAAM,CACVC,OAAQz5D,KAAKu5D,YAAYG,YAEvB15D,KAAKu5D,YAAYI,cACnBH,EAAIn+C,MAAQ,WAAHrQ,OAAchL,KAAKu5D,YAAYI,YAAW,QAErD3D,EAAiB,IAAIiB,SACnBj3D,KAAKu5D,YAAYX,WACjB54D,KAAKkoB,KACLsxC,EAEJ,MAbExD,EAAiB,IAAIiB,SAASj3D,KAAK82D,WAAY92D,KAAKkoB,KAAM,CAAC,GAgB7D,OADiB,QAAjBoxC,EAAAt5D,KAAK62D,oBAAY,IAAAyC,GAAjBA,EAAAjoD,KAAArR,KAAoBA,MACbg2D,CACT,CAEA2B,kBAAAA,GAAqB,IAAAiC,EACnB,IAAK55D,KAAKkoB,MAAQloB,KAAK42D,gBACrB,OAAO,KAGT,MAAMrrD,EAAM,YAAHP,OAAehL,KAAK65D,SAAQ,YAAA7uD,OAAW6M,GAAa7X,KAAKkoB,MAAK,MACvE,IAAIkuC,EACJ,GAAKp2D,KAAKu5D,YAEH,CACL,IAAIC,EAAM,gBAAHxuD,OAAmBhL,KAAKu5D,YAAYG,WAAU,KACjD15D,KAAKu5D,YAAYI,cACnBH,GAAO,uBAAJxuD,OAA2BhL,KAAKu5D,YAAYI,YAAW,SAE5DvD,EAAO,4BAAHprD,OAA+BhL,KAAKu5D,YAAYX,WAAU,MAAA5tD,OAAKwuD,EAAG,QAAAxuD,OAAOO,EAAG,IAClF,MAPE6qD,EAAO,4BAAHprD,OAA+BhL,KAAK82D,WAAU,UAAA9rD,OAASO,EAAG,KAUhE,OADiB,QAAjBquD,EAAA55D,KAAK62D,oBAAY,IAAA+C,GAAjBA,EAAAvoD,KAAArR,KAAoBA,KAAMuL,GACnB6qD,CACT,CAEA0D,gBAAAA,CAAiBC,EAAMC,GACrB,QAAuCvuD,IAAnCzL,KAAKq5D,eAAeW,GACtB,OAAOh6D,KAAKq5D,eAAeW,GAG7B,MAAMC,EAAQj6D,KAAK82D,WAAa,SAAWkD,EAC3C,IAAIE,EACJ,IACEA,EAAOH,EAAKz6D,IAAI26D,EAClB,CAAE,MAAOjyB,GACP/8B,GAAK,2CAADD,OAA4Cg9B,EAAE,MACpD,CACA,MAAM7f,EAAOF,GAAoBiyC,GAMjC,OAJKl6D,KAAKm6D,qBAERJ,EAAK1uC,OAAO4uC,GAENj6D,KAAKq5D,eAAeW,GAAa7xC,CAC3C,CAEA,SAAIiyC,GACF,OAAOxwC,EAAKmvC,GAAL/4D,MAAeo6D,KACxB,CAEA,QAAIC,GACF,OAAOzwC,EAAKmvC,GAAL/4D,MAAeq6D,IACxB,CAEA,mBAAIzD,GAAkB,IAAA0D,EACpB,OAAqC,QAArCA,EAAO1wC,EAAKmvC,GAAL/4D,MAAe42D,uBAAe,IAAA0D,GAAAA,CACvC,CAEA,mBAAI1D,CAAgB92D,GAClBgN,GAAO9M,KAAM,oBAAqBF,EACpC,CAEA,uBAAIq6D,GAAsB,IAAAI,EACxB,OAAyC,QAAzCA,EAAO3wC,EAAKmvC,GAAL/4D,MAAem6D,2BAAmB,IAAAI,GAAAA,CAC3C,CAEA,sBAAIC,GACF,OAAO5wC,EAAKmvC,GAAL/4D,MAAew6D,kBACxB,CAEA,eAAIC,GACF,OAAO7wC,EAAKmvC,GAAL/4D,MAAey6D,WACxB,CAEA,UAAIC,GACF,OAAO9wC,EAAKmvC,GAAL/4D,MAAe06D,MACxB,CAEA,eAAInD,GACF,OAAO3tC,EAAKmvC,GAAL/4D,MAAeu3D,WACxB,CAEA,aAAIoD,GACF,OAAO/wC,EAAKmvC,GAAL/4D,MAAe26D,SACxB,CAEA,YAAIC,GACF,OAAOhxC,EAAKmvC,GAAL/4D,MAAe46D,QACxB,CAEA,UAAIC,GACF,OAAOjxC,EAAKmvC,GAAL/4D,MAAe66D,MACxB,CAEA,gBAAIC,GACF,OAAOlxC,EAAKmvC,GAAL/4D,MAAe86D,YACxB,CAEA,WAAIC,GACF,OAAOnxC,EAAKmvC,GAAL/4D,MAAe+6D,OACxB,CAEA,QAAIC,GACF,OAAOpxC,EAAKmvC,GAAL/4D,MAAeg7D,IACxB,CAEA,QAAIA,CAAKA,GACPluD,GAAO9M,KAAM,OAAQg7D,EACvB,CAEA,cAAIC,GACF,OAAOrxC,EAAKmvC,GAAL/4D,MAAei7D,UACxB,CAEA,gBAAIC,GACF,OAAOtxC,EAAKmvC,GAAL/4D,MAAek7D,YACxB,CAEA,cAAIpE,GACF,OAAOltC,EAAKmvC,GAAL/4D,MAAe82D,UACxB,CAEA,YAAI+C,GACF,OAAOjwC,EAAKmvC,GAAL/4D,MAAe65D,QACxB,CAEA,QAAItsD,GACF,OAAOqc,EAAKmvC,GAAL/4D,MAAeuN,IACxB,CAEA,QAAI2a,GACF,OAAO0B,EAAKmvC,GAAL/4D,MAAekoB,IACxB,CAEAizC,SAAAA,GACEvxC,EAAKmvC,GAAL/4D,MAAem7D,WACjB,CAEA,eAAI5B,GACF,OAAO3vC,EAAKmvC,GAAL/4D,MAAeu5D,WACxB,CAEA,kBAAI5C,GACF,OAAO/sC,EAAKmvC,GAAL/4D,MAAe22D,cACxB,CAEA,mBAAIyE,GACF,OAAOxxC,EAAKmvC,GAAL/4D,MAAeo7D,eACxB,E,gECphBF,MAAMC,GASJ,YAAOC,CAAMzwD,GACX,MAAM0wD,EAAU,IAAIC,YACdC,EAAiB,CAAC,EACxB,IAAIC,EAAgB,EACpB,IAAK,MAAM1uD,KAAQquD,GAAYM,QAAS,CACtC,MAAMC,EAAUL,EAAQM,OAAOhxD,EAAKmC,IACpCyuD,EAAezuD,GAAQ4uD,EACvBF,GAAiB,EAAIE,EAAQv9D,MAC/B,CAEA,MAAMqR,EAAS,IAAIkiD,YAAY8J,GACzBxzC,EAAO,IAAI9Y,WAAWM,GACtBosD,EAAO,IAAIC,SAASrsD,GAC1B,IAAI4oD,EAAS,EAEb,IAAK,MAAMtrD,KAAQquD,GAAYM,QAAS,CACtC,MAAMC,EAAUH,EAAezuD,GACzB3O,EAASu9D,EAAQv9D,OACvBy9D,EAAKE,UAAU1D,EAAQj6D,GACvB6pB,EAAK1pB,IAAIo9D,EAAStD,EAAS,GAC3BA,GAAU,EAAIj6D,CAChB,CAEA,OADA+M,GAAOktD,IAAW5oD,EAAOoiD,WAAY,sCAC9BpiD,CACT,CAEAlC,WAAAA,CAAYkC,GAAQ5Q,EAAA,KAAAm9D,IAlCpBh9D,EAAA,KAAAi9D,QAAO,GAEPj9D,EAAA,KAAAk9D,QAAK,GAELl9D,EAAA,KAAAm9D,QAAQ,GA+BNlzC,EAAKgzC,GAALl8D,KAAe0P,GACfwZ,EAAKizC,GAALn8D,KAAa,IAAI+7D,SAASnyC,EAAKsyC,GAALl8D,QAC1BkpB,EAAKkzC,GAALp8D,KAAgB,IAAIq8D,YACtB,CAcA,cAAIzD,GACF,OAAO15D,EAAA+8D,GAAAj8D,KAAKs8D,IAAWjrD,KAAhBrR,KAAiB,EAC1B,CAEA,cAAI05D,GACF,OAAOx6D,EAAA+8D,GAAAj8D,KAAKs8D,IAAWjrD,KAAhBrR,KAAiB,EAC1B,CAEA,eAAI25D,GACF,OAAOz6D,EAAA+8D,GAAAj8D,KAAKs8D,IAAWjrD,KAAhBrR,KAAiB,EAC1B,EA/De,SAAAs8D,GAyCHC,GACVnxD,GAAOmxD,EAAQlB,EAAYM,QAAQt9D,OAAQ,wBAC3C,IAAIi6D,EAAS,EACb,IAAK,IAAI5pD,EAAI,EAAGA,EAAI6tD,EAAO7tD,IACzB4pD,GAAU1uC,EAAKuyC,GAALn8D,MAAWw8D,UAAUlE,GAAU,EAE3C,MAAMj6D,EAASurB,EAAKuyC,GAALn8D,MAAWw8D,UAAUlE,GACpC,OAAO1uC,EAAKwyC,GAALp8D,MAAc6xB,OACnB,IAAIziB,WAAWwa,EAAKsyC,GAALl8D,MAAcs4D,EAAS,EAAGj6D,GAE7C,CAaFo+D,EAhEMpB,IAmDJx8C,EAAAA,EAAAA,GAnDIw8C,GAAW,UAOE,CAAC,aAAc,aAAc,gBAAc,IAAAqB,GAAA,IAAA/uC,QAAAgvC,GAAA,IAAAhvC,QAAAivC,GAAA,IAAAjvC,QAAAkvC,GAAA,IAAA9uC,QA2D9D,MAAM+uC,GASJ,YAAOxB,CAAMzwD,GACX,MAAM0wD,EAAU,IAAIC,YACdC,EAAiB,CAAC,EACxB,IAAIC,EAAgB,EACpB,IAAK,MAAM1uD,KAAQ8vD,GAAenB,QAAS,CACzC,MAAMC,EAAUL,EAAQM,OAAOhxD,EAAKmC,IACpCyuD,EAAezuD,GAAQ4uD,EACvBF,GAAiB,EAAIE,EAAQv9D,MAC/B,CACAq9D,GAAiB,EACjB,IAAIqB,EACFC,EACAC,EAAiB,EAAIvB,EACnB7wD,EAAKwQ,QACP0hD,EAAoBxB,EAAQM,OAAOhxD,EAAKwQ,MAAMA,OAC9C2hD,EAAqBzB,EAAQM,OAAOhxD,EAAKwQ,MAAMo+C,QAC/CwD,GACE,EAAIF,EAAkB1+D,OAAS,EAAI2+D,EAAmB3+D,QAG1D,MAAMqR,EAAS,IAAIkiD,YAAYqL,GACzB/0C,EAAO,IAAI9Y,WAAWM,GACtBosD,EAAO,IAAIC,SAASrsD,GAC1B,IAAI4oD,EAAS,EAEbwD,EAAKoB,SAAS5E,IAAUztD,EAAKsyD,cAAgB,EAAI,GACjDrB,EAAKE,UAAU1D,EAAQ,GACvBA,GAAU,EACVoD,EAAgB,EAChB,IAAK,MAAM1uD,KAAQ8vD,GAAenB,QAAS,CACzC,MAAMC,EAAUH,EAAezuD,GACzB3O,EAASu9D,EAAQv9D,OACvBq9D,GAAiB,EAAIr9D,EACrBy9D,EAAKE,UAAU1D,EAAQj6D,GACvB6pB,EAAK1pB,IAAIo9D,EAAStD,EAAS,GAC3BA,GAAU,EAAIj6D,CAChB,CAeA,OAdAy9D,EAAKE,UAAU1D,EAASoD,EAAgB,EAAGA,GAEvC7wD,EAAKwQ,QACPygD,EAAKE,UAAU1D,EAAQyE,EAAkB1+D,QACzC6pB,EAAK1pB,IAAIu+D,EAAmBzE,EAAS,GACrCA,GAAU,EAAIyE,EAAkB1+D,OAChCy9D,EAAKE,UAAU1D,EAAQ0E,EAAmB3+D,QAC1C6pB,EAAK1pB,IAAIw+D,EAAoB1E,EAAS,GACtCA,GAAU,EAAI0E,EAAmB3+D,QAEnC+M,GACEktD,GAAU5oD,EAAOoiD,WACjB,yCAEKpiD,EAAO0tD,sBAAsB9E,EACtC,CAEA9qD,WAAAA,CAAYkC,GAAQ5Q,EAAA,KAAA+9D,IA9DpB59D,EAAA,KAAAy9D,QAAO,GAEPz9D,EAAA,KAAA09D,QAAK,GAEL19D,EAAA,KAAA29D,QAAQ,GA2DN1zC,EAAKwzC,GAAL18D,KAAe0P,GACfwZ,EAAKyzC,GAAL38D,KAAa,IAAI+7D,SAASnyC,EAAK8yC,GAAL18D,QAC1BkpB,EAAK0zC,GAAL58D,KAAgB,IAAIq8D,YACtB,CAEA,iBAAIc,GACF,OAAkC,IAA3BvzC,EAAK+yC,GAAL38D,MAAWq9D,SAAS,EAC7B,CAcA,OAAI7D,GACF,OAAOt6D,EAAA29D,GAAA78D,KAAKs9D,IAAWjsD,KAAhBrR,KAAiB,EAC1B,CAEA,cAAI82D,GACF,OAAO53D,EAAA29D,GAAA78D,KAAKs9D,IAAWjsD,KAAhBrR,KAAiB,EAC1B,CAEA,gBAAIo3D,GACF,OAAOl4D,EAAA29D,GAAA78D,KAAKs9D,IAAWjsD,KAAhBrR,KAAiB,EAC1B,CAEA,OAAI4xB,GACF,OAAO1yB,EAAA29D,GAAA78D,KAAKs9D,IAAWjsD,KAAhBrR,KAAiB,EAC1B,CAEA,SAAIqb,GACF,IAAIi9C,EAAS,EACbA,GAAU,EAAI1uC,EAAK+yC,GAAL38D,MAAWw8D,UAAUlE,GACnC,MAAMiF,EAAc3zC,EAAK+yC,GAAL38D,MAAWw8D,UAAUlE,GACnCj9C,EAAQuO,EAAKgzC,GAAL58D,MAAc6xB,OAC1B,IAAIziB,WAAWwa,EAAK8yC,GAAL18D,MAAcs4D,EAAS,EAAGiF,IAE3CjF,GAAU,EAAIiF,EACd,MAAMC,EAAe5zC,EAAK+yC,GAAL38D,MAAWw8D,UAAUlE,GAI1C,MAAO,CAAEj9C,QAAOo+C,OAHD7vC,EAAKgzC,GAAL58D,MAAc6xB,OAC3B,IAAIziB,WAAWwa,EAAK8yC,GAAL18D,MAAcs4D,EAAS,EAAGkF,IAG7C,EAlHkB,SAAAF,GAyENf,GACVnxD,GAAOmxD,EAAQO,EAAenB,QAAQt9D,OAAQ,wBAC9C,IAAIi6D,EAAS,EACb,IAAK,IAAI5pD,EAAI,EAAGA,EAAI6tD,EAAO7tD,IACzB4pD,GAAU1uC,EAAK+yC,GAAL38D,MAAWw8D,UAAUlE,GAAU,EAE3C,MAAMj6D,EAASurB,EAAK+yC,GAAL38D,MAAWw8D,UAAUlE,GACpC,OAAO1uC,EAAKgzC,GAAL58D,MAAc6xB,OACnB,IAAIziB,WAAWwa,EAAK8yC,GAAL18D,MAAcs4D,EAAS,EAAGj6D,GAE7C,CAgCFo/D,EAnHMX,IAmFJj+C,EAAAA,EAAAA,GAnFIi+C,GAAc,UAOD,CAAC,MAAO,aAAc,eAAgB,QAAM,IAAAY,GAAA,IAAA/vC,QAAAgwC,GAAA,IAAAhwC,QAAAiwC,GAAA,IAAAjwC,QAAAkwC,GAAA,IAAA9vC,QA8G/D,MAAM+vC,GAkCJtwD,WAAAA,CAAWuwD,GAAkB,IAAjB,KAAE71C,EAAI,MAAEixC,GAAO4E,EAAAj/D,EAAA,KAAA++D,IAN3B5+D,EAAA,KAAAy+D,QAAO,GAEPz+D,EAAA,KAAA0+D,QAAQ,GAER1+D,EAAA,KAAA2+D,QAAK,GAGH10C,EAAKw0C,GAAL19D,KAAekoB,GACfgB,EAAKy0C,GAAL39D,KAAgB,IAAIq8D,aACpBnzC,EAAK00C,GAAL59D,KAAa,IAAI+7D,SAASnyC,EAAK8zC,GAAL19D,QACtBm5D,GACF76D,OAAO8c,OAAOpb,KAAMm5D,EAExB,CAUA,SAAIiB,GACF,OAAOl7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,QAAIq6D,GACF,OAAOn7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,mBAAI42D,GACF,OAAO13D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,uBAAIm6D,GACF,OAAOj7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,sBAAIw6D,GACF,OAAOt7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,eAAIy6D,GACF,OAAOv7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,UAAI06D,GACF,OAAOx7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,eAAIu3D,GACF,OAAOr4D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,aAAI26D,GACF,OAAOz7D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAEA,YAAI46D,GACF,OAAO17D,EAAA2+D,GAAA79D,KAAKg+D,IAAY3sD,KAAjBrR,KAAkB,EAC3B,CAOA,UAAI66D,GACF,OAAO37D,EAAA2+D,GAAA79D,KAAKi+D,IAAW5sD,KAAhBrR,KAAiB,EAC1B,CAEA,gBAAI86D,GACF,OAAO57D,EAAA2+D,GAAA79D,KAAKi+D,IAAW5sD,KAAhBrR,KAAiB,EAC1B,CAEA,WAAI+6D,GACF,OAAO77D,EAAA2+D,GAAA79D,KAAKi+D,IAAW5sD,KAAhBrR,KAAiB,EAC1B,CAEA,QAAIg7D,GACF,IAAI1C,EAAkB4F,GAAYt7C,EAElC,GAAkB,IADAgH,EAAKg0C,GAAL59D,MAAWq9D,SAAS/E,GAEpC,OAEFA,GAAU,EACV,MAAM0C,EAAO,GACb,IAAK,IAAItsD,EAAI,EAAGA,EAAI,EAAGA,IACrBssD,EAAKhsD,KAAK4a,EAAKg0C,GAAL59D,MAAWm+D,SAAS7F,GAAQ,IACtCA,GAAU,EAEZ,OAAO0C,CACT,CAEA,cAAIC,GACF,IAAI3C,EAAkB8F,GAAmBx7C,EAEzC,GAAkB,IADAgH,EAAKg0C,GAAL59D,MAAWq9D,SAAS/E,GAEpC,OAEFA,GAAU,EACV,MAAM2C,EAAa,GACnB,IAAK,IAAIvsD,EAAI,EAAGA,EAAI,EAAGA,IACrBusD,EAAWjsD,KAAK4a,EAAKg0C,GAAL59D,MAAWq+D,WAAW/F,GAAQ,IAC9CA,GAAU,EAEZ,OAAO2C,CACT,CAEA,mBAAIG,GACF,IAAI9C,EAAkBgG,GAAwB17C,EAE9C,GAAmB,IADAgH,EAAKg0C,GAAL59D,MAAWq9D,SAAS/E,GAErC,OAEFA,GAAU,EACV,MAAM8C,EAAkB,GACxB,IAAK,IAAI1sD,EAAI,EAAGA,EAAI,EAAGA,IACrB0sD,EAAgBpsD,KAAK4a,EAAKg0C,GAAL59D,MAAWm+D,SAAS7F,GAAQ,IACjDA,GAAU,EAEZ,OAAO8C,CACT,CAcA,gBAAIF,GACF,OAAOh8D,EAAA2+D,GAAA79D,KAAKu+D,IAAWltD,KAAhBrR,KAAiB,EAC1B,CAEA,cAAI82D,GACF,OAAO53D,EAAA2+D,GAAA79D,KAAKu+D,IAAWltD,KAAhBrR,KAAiB,EAC1B,CAEA,YAAI65D,GACF,OAAO36D,EAAA2+D,GAAA79D,KAAKu+D,IAAWltD,KAAhBrR,KAAiB,EAC1B,CAEA,QAAIuN,GACF,OAAOrO,EAAA2+D,GAAA79D,KAAKu+D,IAAWltD,KAAhBrR,KAAiB,EAC1B,CAEA,QAAIkoB,GACF,IAAIowC,EAAkBkG,GAAe57C,EAErC01C,GAAU,EADY1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAG3CA,GAAU,EADmB1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAGlDA,GAAU,EADgB1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAE/C,MAAMj6D,EAASurB,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GACpC,GAAe,IAAXj6D,EAGJ,OAAO,IAAI+Q,WAAWwa,EAAK8zC,GAAL19D,MAAcs4D,EAAS,EAAGj6D,EAClD,CAEA88D,SAAAA,GACE,IAAI7C,EAAkBkG,GAAe57C,EAErC01C,GAAU,EADY1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAG3CA,GAAU,EADmB1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAGlDA,GAAU,EADgB1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAE/C,MAAMj6D,EAASurB,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GACvB,IAAIlpD,WAAWwa,EAAK8zC,GAAL19D,MAAcs4D,EAAS,EAAGj6D,GACjD2H,KAAK,GACV4jB,EAAKg0C,GAAL59D,MAAWg8D,UAAU1D,EAAQ,EAE/B,CAEA,eAAIiB,GACF,IAAIjB,EAAkBkG,GAAe57C,EAErC01C,GAAU,EADY1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAG3CA,GAAU,EADmB1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAElD,MAAMmG,EAAoB70C,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAC/C,GAA0B,IAAtBmG,EACF,OAAO,KAET,MAAMC,EAAkB,IAAItvD,WAAWqvD,GAIvC,OAHAC,EAAgBlgE,IACd,IAAI4Q,WAAWwa,EAAK8zC,GAAL19D,MAAcs4D,EAAS,EAAGmG,IAEpC,IAAIpD,GAAYqD,EAAgBhvD,OACzC,CAEA,kBAAIinD,GACF,IAAI2B,EAAkBkG,GAAe57C,EAErC01C,GAAU,EADY1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAE3C,MAAMqG,EAAuB/0C,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAClD,GAA6B,IAAzBqG,EACF,OAAO,KAET,MAAMC,EAAqB,IAAIxvD,WAAWuvD,GAI1C,OAHAC,EAAmBpgE,IACjB,IAAI4Q,WAAWwa,EAAK8zC,GAAL19D,MAAcs4D,EAAS,EAAGqG,IAEpC,IAAI7B,GAAe8B,EAAmBlvD,OAC/C,CAEA,YAAO4rD,CAAMjE,GACX,MAAMwH,EAAuBxH,EAAKV,eAC9BmG,GAAexB,MAAMjE,EAAKV,gBAC1B,KACEmI,EAAoBzH,EAAKkC,YAC3B8B,GAAYC,MAAMjE,EAAKkC,aACvB,KAEEgC,EAAU,IAAIC,YACdC,EAAiB,CAAC,EACxB,IAAIC,EAAgB,EACpB,IAAK,MAAM1uD,KAAQ8wD,GAASnC,QAC1BF,EAAezuD,GAAQuuD,EAAQM,OAAOxE,EAAKrqD,IAC3C0uD,GAAiB,EAAID,EAAezuD,GAAM3O,OAG5C,MAAM4+D,EACKuB,GAAe57C,EACxB,EACA84C,EACA,GACCmD,EAAuBA,EAAqB/M,WAAa,GAC1D,GACCgN,EAAoBA,EAAkBhN,WAAa,GACpD,GACCuF,EAAKnvC,KAAOmvC,EAAKnvC,KAAK7pB,OAAS,GAE5BqR,EAAS,IAAIkiD,YAAYqL,GACzB/0C,EAAO,IAAI9Y,WAAWM,GACtBosD,EAAO,IAAIC,SAASrsD,GAC1B,IAAI4oD,EAAS,EAEb,MAAMyG,EAAWjB,GAASkB,MAAM3gE,OAChC,IAAI4gE,EAAW,EACbC,EAAU,EACZ,IAAK,IAAIxwD,EAAI,EAAGA,EAAIqwD,EAAUrwD,IAAK,CACjC,MAAM5O,EAAQu3D,EAAKyG,GAASkB,MAAMtwD,IAGlCuwD,SADuBxzD,IAAV3L,EAAsB,EAAOA,EAAQ,EAAO,IACrCo/D,EACpBA,GAAW,EACK,IAAZA,GAAiBxwD,IAAMqwD,EAAW,IACpCjD,EAAKoB,SAAS5E,IAAU2G,GACxBA,EAAW,EACXC,EAAU,EAEd,CACA9zD,GACEktD,IAAoB6G,GAAev8C,EACnC,sDAGF,IAAK,MAAM5V,KAAQ8wD,GAASvlD,QAC1BujD,EAAKsD,WAAW9G,EAAQjB,EAAKrqD,IAC7BsrD,GAAU,EAOZ,GALAltD,GACEktD,IAAoB4F,GAAYt7C,EAChC,qDAGEy0C,EAAK2D,KAAM,CACbc,EAAKoB,SAAS5E,IAAU,GACxB,IAAK,MAAM+G,KAAShI,EAAK2D,KACvBc,EAAKwD,SAAShH,EAAQ+G,GAAO,GAC7B/G,GAAU,CAEd,MACEwD,EAAKoB,SAAS5E,IAAU,GACxBA,GAAU,EAQZ,GALAltD,GACEktD,IAAoB8F,GAAmBx7C,EACvC,mDAGEy0C,EAAK4D,WAAY,CACnBa,EAAKoB,SAAS5E,IAAU,GACxB,IAAK,MAAM1I,KAASyH,EAAK4D,WACvBa,EAAKsD,WAAW9G,EAAQ1I,GAAO,GAC/B0I,GAAU,CAEd,MACEwD,EAAKoB,SAAS5E,IAAU,GACxBA,GAAU,GAQZ,GALAltD,GACEktD,IAAoBgG,GAAwB17C,EAC5C,yDAGEy0C,EAAK+D,gBAAiB,CACxBU,EAAKoB,SAAS5E,IAAU,GACxB,IAAK,MAAMiH,KAAUlI,EAAK+D,gBACxBU,EAAKwD,SAAShH,EAAQiH,GAAQ,GAC9BjH,GAAU,CAEd,MACEwD,EAAKoB,SAAS5E,IAAU,GACxBA,GAAU,EAGZltD,GACEktD,IAAoBkG,GAAe57C,EACnC,8DAGFk5C,EAAKE,UAAmBwC,GAAe57C,EAAE,GACzC01C,GAAU,EACV,IAAK,MAAMtrD,KAAQ8wD,GAASnC,QAAS,CACnC,MAAMC,EAAUH,EAAezuD,GACzB3O,EAASu9D,EAAQv9D,OACvBy9D,EAAKE,UAAU1D,EAAQj6D,GACvB6pB,EAAK1pB,IAAIo9D,EAAStD,EAAS,GAC3BA,GAAU,EAAIj6D,CAChB,CAMA,GALAy9D,EAAKE,UACMwC,GAAe57C,EACxB01C,EAAkBkG,GAAe57C,EAAG,GAGjCi8C,EAGE,CACL,MAAMxgE,EAASwgE,EAAqB/M,WACpCgK,EAAKE,UAAU1D,EAAQj6D,GACvB+M,GACEktD,EAAS,EAAIj6D,GAAUqR,EAAOoiD,WAC9B,qDAEF5pC,EAAK1pB,IAAI,IAAI4Q,WAAWyvD,GAAuBvG,EAAS,GACxDA,GAAU,EAAIj6D,CAChB,MAXEy9D,EAAKE,UAAU1D,EAAQ,GACvBA,GAAU,EAYZ,GAAKwG,EAGE,CACL,MAAMzgE,EAASygE,EAAkBhN,WACjCgK,EAAKE,UAAU1D,EAAQj6D,GACvB+M,GACEktD,EAAS,EAAIj6D,GAAUqR,EAAOoiD,WAC9B,kDAEF5pC,EAAK1pB,IAAI,IAAI4Q,WAAW0vD,GAAoBxG,EAAS,GACrDA,GAAU,EAAIj6D,CAChB,MAXEy9D,EAAKE,UAAU1D,EAAQ,GACvBA,GAAU,EAsBZ,YAVkB7sD,IAAd4rD,EAAKnvC,MACP4zC,EAAKE,UAAU1D,EAAQ,GACvBA,GAAU,IAEVwD,EAAKE,UAAU1D,EAAQjB,EAAKnvC,KAAK7pB,QACjC6pB,EAAK1pB,IAAI64D,EAAKnvC,KAAMowC,EAAS,GAC7BA,GAAU,EAAIjB,EAAKnvC,KAAK7pB,QAG1B+M,GAAOktD,GAAU5oD,EAAOoiD,WAAY,mCAC7BpiD,EAAO0tD,sBAAsB9E,EACtC,EArZY,SAAA0F,GA2CCzB,GACXnxD,GAAOmxD,EAAQuB,EAASkB,MAAM3gE,OAAQ,yBACtC,MAAMmhE,EAAa5wD,KAAKiY,MAAM01C,EAAQ,GAChCkD,EAAqB,EAARlD,EAAa,EAC1Bz8D,EAAS8pB,EAAKg0C,GAAL59D,MAAWq9D,SAASmC,IAAeC,EAAa,EAC/D,OAAiB,IAAV3/D,OAAiB2L,EAAsB,IAAV3L,CACtC,UAAAm+D,GA0CY1B,GAEV,OADAnxD,GAAOmxD,EAAQuB,EAASvlD,QAAQla,OAAQ,wBACjCurB,EAAKg0C,GAAL59D,MAAWq+D,WAAoBc,GAAev8C,EAAW,EAAR25C,EAC1D,UAAAgC,GA2DYhC,GACVnxD,GAAOmxD,EAAQuB,EAASnC,QAAQt9D,OAAQ,wBACxC,IAAIi6D,EAAkBkG,GAAe57C,EAAG,EACxC,IAAK,IAAIlU,EAAI,EAAGA,EAAI6tD,EAAO7tD,IACzB4pD,GAAU1uC,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAAU,EAE3C,MAAMj6D,EAASurB,EAAKg0C,GAAL59D,MAAWw8D,UAAUlE,GAC9BoH,EAAa,IAAItwD,WAAW/Q,GAElC,OADAqhE,EAAWlhE,IAAI,IAAI4Q,WAAWwa,EAAK8zC,GAAL19D,MAAcs4D,EAAS,EAAGj6D,IACjDurB,EAAK+zC,GAAL39D,MAAc6xB,OAAO6tC,EAC9B,CAmPFC,EAtZM7B,IAmKJj/C,EAAAA,EAAAA,GAnKIi/C,GAAQ,QACG,CACb,QACA,OACA,kBACA,sBACA,qBACA,cACA,SACA,cACA,YACA,cACDj/C,EAAAA,EAAAA,GAZGi/C,GAAQ,UAcK,CAAC,SAAU,eAAgB,aAAUj/C,EAAAA,EAAAA,GAdlDi/C,GAAQ,UAgBK,CAAC,eAAgB,aAAc,WAAY,SAAO,IAAAqB,GAAA,CAAAv8C,EAE1ChU,KAAKiX,KAA0B,EAApB85C,EAAKX,MAAM3gE,OAAc,IAAE6/D,GAAA,CAAAt7C,EAEzC1jB,EApBlB4+D,EAAQ6B,EAoBeR,IAAev8C,EAAyB,EAAtB+8C,EAAKpnD,QAAQla,QAAU+/D,GAAA,CAAAx7C,EAEvC1jB,EAtBzB4+D,EAAQ6B,EAsBsBzB,IAAYt7C,EAAG,EAAI,GAAK07C,GAAA,CAAA17C,EAExB1jB,EAxB9B4+D,EAAQ6B,EAwB2BvB,IAAmBx7C,EAAG,EAAI,IAAK47C,GAAA,CAAA57C,EAE7C1jB,EA1BrB4+D,EAAQ6B,EA0BkBrB,IAAwB17C,EAAG,EAAI,GA8X/D,MAAMg9C,GAiBJpyD,WAAAA,CAAYkC,GACV1P,KAAK0P,OAASA,EACd1P,KAAK87D,KAAO,IAAIC,SAASrsD,GACzB1P,KAAKkoB,KAAO,IAAI9Y,WAAWM,EAC7B,CAEA,YAAO4rD,CAAMuE,GACX,IAAIC,EACF9E,EAAO,KACP+E,EAAS,GACTlpC,EAAS,GACTmpC,EAAa,GACbC,EAAU,GACVC,EAAc,KACdlgC,EAAa,KAEf,OAAQ6/B,EAAG,IACT,IAAK,cACHC,EAAiB,UAAVD,EAAG,GAAiB,EAAI,EAC/B7E,EAAO6E,EAAG,GACVG,EAAaH,EAAG,GACH,IAATC,EACFC,EAAO/wD,QAAQ6wD,EAAG,MAAOA,EAAG,IAE5BE,EAAO/wD,KAAK6wD,EAAG,GAAG,GAAIA,EAAG,GAAG,GAAIA,EAAG,GAAIA,EAAG,GAAG,GAAIA,EAAG,GAAG,GAAIA,EAAG,IAEhE,MACF,IAAK,OACHC,EAAO,EACPI,EAAcL,EAAG,GACjBE,EAASF,EAAG,GACZhpC,EAASgpC,EAAG,GACZI,EAAUJ,EAAG,IAAM,GACnB7E,EAAO6E,EAAG,GACV7/B,EAAa6/B,EAAG,GAChB,MACF,QACE,MAAM,IAAI10D,MAAM,6BAADH,OAA8B60D,EAAG,KAGpD,MAAMM,EAASvxD,KAAKiY,MAAMk5C,EAAO1hE,OAAS,GACpC+hE,EAASxxD,KAAKiY,MAAMgQ,EAAOx4B,OAAS,GACpCgiE,EAAQL,EAAW3hE,OACnBiiE,EAAWL,EAAQ5hE,OAEzB,IAAIkiE,EAAc,EAClB,IAAK,MAAMC,KAAUP,EACnBM,GAAe,EACfA,EAA2C,EAA7B3xD,KAAKiX,KAAK06C,EAAc,GACtCA,GAAe,EAA2B,EAAvBC,EAAOT,OAAO1hE,OACjCkiE,GAAe,EAA2B,EAAvBC,EAAO3pC,OAAOx4B,YACHoN,IAA1B+0D,EAAOC,iBACTF,GAAe,GAInB,MAQM7wD,EAAS,IAAIkiD,YAPjB,GACS,EAATuO,EACS,EAATC,EACQ,EAARC,GACCrF,EAAO,GAAK,IACZh7B,EAAa,EAAI,GAClBugC,GAEIG,EAAW,IAAI3E,SAASrsD,GACxBixD,EAAS,IAAIvxD,WAAWM,GAE9BgxD,EAASxD,SAAqB0D,GAAKh+C,EAAEk9C,GACrCY,EAASxD,SAAqB2D,GAASj+C,EAAEo4C,EAAO,EAAI,GACpD0F,EAASxD,SAAqB4D,GAAel+C,EAAEod,EAAa,EAAI,GAChE0gC,EAASxD,SAAqB6D,GAAan+C,EAAEs9C,GAC7CQ,EAAS1E,UAAsBgF,GAAQp+C,EAAEu9C,GAAQ,GACjDO,EAAS1E,UAAsBiF,GAAQr+C,EAAEw9C,GAAQ,GACjDM,EAAS1E,UAAsBkF,GAAOt+C,EAAEy9C,GAAO,GAC/CK,EAAS1E,UAAsBmF,GAAUv+C,EAAE09C,GAAU,GAErD,IAAIhI,EAAS,GACM,IAAI8I,aAAa1xD,EAAQ4oD,EAAiB,EAAT6H,GACzC3hE,IAAIuhE,GACfzH,GAAmB,EAAT6H,EAEVQ,EAAOniE,IAAIq4B,EAAQyhC,GACnBA,GAAmB,EAAT8H,EAEV,IAAK,MAAOrtD,EAAKsuD,KAAQrB,EACvBU,EAASY,WAAWhJ,EAAQvlD,GAAK,GACjCulD,GAAU,EACVoI,EAAS1E,UAAU1D,EAAQr1C,SAASo+C,EAAIhsD,MAAM,GAAI,KAAK,GACvDijD,GAAU,EAEZ,GAAI0C,EACF,IAAK,MAAMpjD,KAAKojD,EACd0F,EAASY,WAAWhJ,EAAQ1gD,GAAG,GAC/B0gD,GAAU,EAIVt4B,IACF2gC,EAAOniE,IAAIwhC,EAAYs4B,GACvBA,GAAU,GAGZ,IAAK,IAAI5pD,EAAI,EAAGA,EAAIuxD,EAAQ5hE,OAAQqQ,IAAK,CACvC,MAAM8xD,EAASP,EAAQvxD,GACvBgyD,EAASxD,SAAS5E,EAAQkI,EAAOhgE,MACjC83D,GAAU,EAEVA,EAAiC,EAAxB1pD,KAAKiX,KAAKyyC,EAAS,GAC5BoI,EAAS1E,UAAU1D,EAAQkI,EAAOT,OAAO1hE,QAAQ,GACjDi6D,GAAU,EACe,IAAIiJ,WAC3B7xD,EACA4oD,EACAkI,EAAOT,OAAO1hE,QAECG,IAAIgiE,EAAOT,QAC5BzH,GAAiC,EAAvBkI,EAAOT,OAAO1hE,OACxBqiE,EAAS1E,UAAU1D,EAAQkI,EAAO3pC,OAAOx4B,QAAQ,GACjDi6D,GAAU,EACS,IAAIiJ,WAAW7xD,EAAQ4oD,EAAQkI,EAAO3pC,OAAOx4B,QACrDG,IAAIgiE,EAAO3pC,QACtByhC,GAAiC,EAAvBkI,EAAO3pC,OAAOx4B,YAEMoN,IAA1B+0D,EAAOC,iBACTC,EAAS1E,UAAU1D,EAAQkI,EAAOC,gBAAgB,GAClDnI,GAAU,EAEd,CACA,OAAO5oD,CACT,CAEA8xD,KAAAA,GACE,MAAMd,EAAW1gE,KAAK87D,KAChBgE,EAAO9/D,KAAKkoB,KAAiB04C,GAAKh+C,GAClC6+C,IAAYzhE,KAAKkoB,KAAiB24C,GAASj+C,GAC3C8+C,IAAkB1hE,KAAKkoB,KAAiB44C,GAAel+C,GACvDu9C,EAASO,EAASlE,UAAsBwE,GAAQp+C,GAAE,GAClDw9C,EAASM,EAASlE,UAAsByE,GAAQr+C,GAAE,GAClDy9C,EAAQK,EAASlE,UAAsB0E,GAAOt+C,GAAE,GAChD09C,EAAWI,EAASlE,UAAsB2E,GAAUv+C,GAAE,GAE5D,IAAI01C,EAAS,GACb,MAAMyH,EAAS,IAAIqB,aAAaphE,KAAK0P,OAAQ4oD,EAAiB,EAAT6H,GACrD7H,GAAmB,EAAT6H,EACV,MAAMtpC,EAAS,IAAIznB,WAAWpP,KAAK0P,OAAQ4oD,EAAiB,EAAT8H,GACnD9H,GAAmB,EAAT8H,EACV,MAAMuB,EAAQ,GACd,IAAK,IAAIjzD,EAAI,EAAGA,EAAI2xD,IAAS3xD,EAAG,CAC9B,MAAMoE,EAAI4tD,EAASkB,WAAWtJ,GAAQ,GACtCA,GAAU,EACV,MAAM7xC,EAAMi6C,EAASlE,UAAUlE,GAAQ,GACvCA,GAAU,EACVqJ,EAAM3yD,KAAK,CAAC8D,EAAG,IAAF9H,OAAMyb,EAAI/U,SAAS,IAAIC,SAAS,EAAG,OAClD,CACA,IAAIqpD,EAAO,KACX,GAAIyG,EAAS,CACXzG,EAAO,GACP,IAAK,IAAItsD,EAAI,EAAGA,EAAI,IAAKA,EACvBssD,EAAKhsD,KAAK0xD,EAASkB,WAAWtJ,GAAQ,IACtCA,GAAU,CAEd,CAEA,IAAIt4B,EAAa,KACb0hC,IACF1hC,EAAa,IAAI5wB,WAAWpP,KAAK0P,OAAQ4oD,EAAQ,GACjDA,GAAU,GAGZ,MAAM2H,EAAU,GAChB,IAAK,IAAIvxD,EAAI,EAAGA,EAAI4xD,IAAY5xD,EAAG,CACjC,MAAMlO,EAAOkgE,EAASrD,SAAS/E,GAC/BA,GAAU,EAEVA,EAAiC,EAAxB1pD,KAAKiX,KAAKyyC,EAAS,GAE5B,MAAMuJ,EAAenB,EAASlE,UAAUlE,GAAQ,GAChDA,GAAU,EACV,MAAMwJ,EAAe,IAAIP,WAAWvhE,KAAK0P,OAAQ4oD,EAAQuJ,GACzDvJ,GAAyB,EAAfuJ,EAEV,MAAME,EAAerB,EAASlE,UAAUlE,GAAQ,GAChDA,GAAU,EACV,MAAM0J,EAAe,IAAIT,WAAWvhE,KAAK0P,OAAQ4oD,EAAQyJ,GACzDzJ,GAAyB,EAAfyJ,EAEV,MAAMvB,EAAS,CACbhgE,OACAu/D,OAAQ+B,EACRjrC,OAAQmrC,GAGNxhE,IAASiC,IACX+9D,EAAOC,eAAiBC,EAASlE,UAAUlE,GAAQ,GACnDA,GAAU,GAGZ2H,EAAQjxD,KAAKwxD,EACf,CAEA,GAAa,IAATV,EAEF,MAAO,CACL,cACA,QACA9E,EACA2G,EACApwD,MAAMC,KAAKuuD,EAAO1qD,MAAM,EAAG,IAC3B9D,MAAMC,KAAKuuD,EAAO1qD,MAAM,EAAG,IAC3B,KACA,MAGJ,GAAa,IAATyqD,EACF,MAAO,CACL,cACA,SACA9E,EACA2G,EACA,CAAC5B,EAAO,GAAIA,EAAO,IACnB,CAACA,EAAO,GAAIA,EAAO,IACnBA,EAAO,GACPA,EAAO,IAGX,GAAa,IAATD,EAAY,CACd,MAAMI,EAAclgE,KAAKkoB,KAAiB64C,GAAan+C,GACvD,IAAIq/C,EAAS,KACb,GAAIlC,EAAO1hE,OAAS,EAAG,CACrB,IAAI6jE,EAAOnC,EAAO,GAChBoC,EAAOpC,EAAO,GACZqC,EAAOrC,EAAO,GAChBsC,EAAOtC,EAAO,GAChB,IAAK,IAAIrxD,EAAI,EAAGA,EAAIqxD,EAAO1hE,OAAQqQ,GAAK,EAAG,CACzC,MAAMoH,EAAIiqD,EAAOrxD,GACfqH,EAAIgqD,EAAOrxD,EAAI,GACjBwzD,EAAOA,EAAOpsD,EAAIA,EAAIosD,EACtBE,EAAOA,EAAOrsD,EAAIA,EAAIqsD,EACtBD,EAAOA,EAAOrsD,EAAIA,EAAIqsD,EACtBE,EAAOA,EAAOtsD,EAAIA,EAAIssD,CACxB,CACAJ,EAAS,CAACC,EAAME,EAAMD,EAAME,EAC9B,CACA,MAAO,CACL,OACAnC,EACAH,EACAlpC,EACAopC,EACAgC,EACAjH,EACAh7B,EAEJ,CACA,MAAM,IAAI70B,MAAM,6BAADH,OAA8B80D,GAC/C,EACF,IAAAc,GAAA,CAAAh+C,EAjRiB,GAACi+C,GAAA,CAAAj+C,EAEG,GAACk+C,GAAA,CAAAl+C,EAEK,GAACm+C,GAAA,CAAAn+C,EAEH,GAACo+C,GAAA,CAAAp+C,EAEN,GAACq+C,GAAA,CAAAr+C,EAED,GAACs+C,GAAA,CAAAt+C,EAEF,IAAEu+C,GAAA,CAAAv+C,EAEC,IC1hBtB,SAAS0/C,GAAkB9O,GACzB,GAAmB,kBAARA,EACT,OAAO,KAET,GAAIA,EAAIlzB,SAAS,KACf,OAAOkzB,EAET,MAAM,IAAIroD,MAAM,yBAADH,OAA0BwoD,EAAG,kCAC9C,CAEA,MAAM+O,GAAa3qD,GACJ,kBAANA,GACPlN,OAAOC,UAAW,OAADiN,QAAC,IAADA,OAAC,EAADA,EAAG4qD,MACpB5qD,EAAE4qD,KAAO,GACT93D,OAAOC,UAAW,OAADiN,QAAC,IAADA,OAAC,EAADA,EAAG6qD,MACpB7qD,EAAE6qD,KAAO,EAILC,GdujCN,SAA8BC,EAAUC,EAAWC,GACjD,IAAKtxD,MAAM02B,QAAQ46B,IAASA,EAAKxkE,OAAS,EACxC,OAAO,EAET,MAAOykE,EAAMC,KAAS3qD,GAAQyqD,EAC9B,IAAKF,EAASG,KAAUp4D,OAAOC,UAAUm4D,GACvC,OAAO,EAET,IAAKF,EAAUG,GACb,OAAO,EAET,MAAMC,EAAU5qD,EAAK/Z,OACrB,IAAI4kE,GAAY,EAChB,OAAQF,EAAKx1D,MACX,IAAK,MACH,GAAIy1D,EAAU,GAAKA,EAAU,EAC3B,OAAO,EAET,MACF,IAAK,MACL,IAAK,OACH,OAAmB,IAAZA,EACT,IAAK,OACL,IAAK,QACL,IAAK,OACL,IAAK,QACH,GAAIA,EAAU,EACZ,OAAO,EAET,MACF,IAAK,OACH,GAAgB,IAAZA,EACF,OAAO,EAETC,GAAY,EACZ,MACF,QACE,OAAO,EAEX,IAAK,MAAMC,KAAO9qD,EAChB,KAAmB,kBAAR8qD,GAAqBD,GAAqB,OAARC,GAG7C,OAAO,EAET,OAAO,CACT,EcrmCiD31C,KAC/C,KACiBg1C,GAJC3qD,GAAkB,kBAANA,GAAqC,kBAAX,OAADA,QAAC,IAADA,OAAC,EAADA,EAAGrK,OAM3D,IAAA41D,GAAA,IAAAx1C,QAAAy1C,GAAA,IAAAz1C,QAED,MAAM01C,GAAa71D,WAAAA,GACjBvO,EAAA,KAAAkkE,GAAa,IAAI97C,KAEjBpoB,EAAA,KAAAmkE,GAAY1jE,QAAQG,UAAS,CAE7ByjE,WAAAA,CAAYv2D,EAAK2lD,GACf,MAAM14C,EAAQ,CACZkO,KAAMmtC,gBAAgBtoD,EAAK2lD,EAAW,CAAEA,YAAa,OAGvD9oC,EAAKw5C,GAALpjE,MAAeD,KAAK,KAClB,IAAK,MAAOwjE,KAAa35C,EAAKu5C,GAALnjE,MACvBujE,EAASlyD,KAAKrR,KAAMga,IAG1B,CAEAD,gBAAAA,CAAiBxM,EAAMg2D,GAA0B,IAAhB73D,EAAOvM,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACrCqkE,EAAU,KACd,IAAW,OAAP93D,QAAO,IAAPA,OAAO,EAAPA,EAASie,kBAAkBI,YAAa,CAC1C,MAAM,OAAEJ,GAAWje,EACnB,GAAIie,EAAOK,QAET,YADA/e,GAAK,kDAGP,MAAMw4D,EAAUA,IAAMzjE,KAAK0jE,oBAAoBn2D,EAAMg2D,GACrDC,EAAUA,IAAM75C,EAAO+5C,oBAAoB,QAASD,GAEpD95C,EAAO5P,iBAAiB,QAAS0pD,EACnC,CACA75C,EAAKu5C,GAALnjE,MAAgBxB,IAAI+kE,EAAUC,EAChC,CAEAE,mBAAAA,CAAoBn2D,EAAMg2D,GACxB,MAAMC,EAAU55C,EAAKu5C,GAALnjE,MAAgBV,IAAIikE,GAC7B,OAAPC,QAAO,IAAPA,GAAAA,IAEA55C,EAAKu5C,GAALnjE,MAAgBqrB,OAAOk4C,EACzB,CAEAI,SAAAA,GACE,IAAK,MAAO,CAAEH,KAAY55C,EAAKu5C,GAALnjE,MACjB,OAAPwjE,QAAO,IAAPA,GAAAA,IAEF55C,EAAKu5C,GAALnjE,MAAgBs/B,OAClB,EClIF,MAAMskC,GACE,EADFA,GAEG,EAGHC,GACI,EADJA,GAEa,EAFbA,GAGG,EAHHA,GAIK,EAJLA,GAKG,EALHA,GAME,EANFA,GAOW,EAPXA,GAQY,EAGlB,SAASC,KAAQ,CAEjB,SAASC,GAAW/7B,GAClB,GACEA,aAAc75B,IACd65B,aAAcl6B,IACdk6B,aAAcv6B,IACdu6B,aAAcj6B,IACdi6B,aAAcp6B,GAGd,OAAOo6B,EAQT,OALMA,aAAc78B,OAAwB,kBAAP68B,GAA0B,OAAPA,GACtD98B,GACE,kEAGI88B,EAAGz6B,MACT,IAAK,iBACH,OAAO,IAAIY,GAAe65B,EAAG16B,SAC/B,IAAK,sBACH,OAAO,IAAIQ,GAAoBk6B,EAAG16B,SACpC,IAAK,oBACH,OAAO,IAAIG,GAAkBu6B,EAAG16B,QAAS06B,EAAGt6B,MAC9C,IAAK,oBACH,OAAO,IAAIK,GAAkBi6B,EAAG16B,QAAS06B,EAAGh6B,OAAQg6B,EAAG/5B,SACzD,IAAK,wBACH,OAAO,IAAIL,GAAsBo6B,EAAG16B,QAAS06B,EAAGn6B,SAEpD,OAAO,IAAID,GAAsBo6B,EAAG16B,QAAS06B,EAAGt2B,WAClD,KAAAsyD,GAAA,IAAAr2C,QAAAs2C,GAAA,IAAAl2C,QAEA,MAAMm2C,GAGJ12D,WAAAA,CAAY22D,EAAYC,EAAYC,GAAQvlE,EAAA,KAAAmlE,IAF5ChlE,EAAA,KAAA+kE,GAAa,IAAI/mC,iBAGfj9B,KAAKmkE,WAAaA,EAClBnkE,KAAKokE,WAAaA,EAClBpkE,KAAKqkE,OAASA,EACdrkE,KAAKskE,WAAa,EAClBtkE,KAAKukE,SAAW,EAChBvkE,KAAKwkE,YAAclmE,OAAOwa,OAAO,MACjC9Y,KAAKykE,kBAAoBnmE,OAAOwa,OAAO,MACvC9Y,KAAK0kE,qBAAuBpmE,OAAOwa,OAAO,MAC1C9Y,KAAK2kE,cAAgBrmE,OAAOwa,OAAO,MAEnCurD,EAAOtqD,iBAAiB,UAAW7a,EAAA+kE,GAAAjkE,KAAK4kE,IAAWr3C,KAAKvtB,MAAO,CAC7D2pB,OAAQC,EAAKo6C,GAALhkE,MAAgB2pB,QAE5B,CAiEAyZ,EAAAA,CAAGyhC,EAAYC,GAOb,MAAMC,EAAK/kE,KAAK2kE,cAChB,GAAII,EAAGF,GACL,MAAM,IAAI15D,MAAM,0CAADH,OAA2C65D,EAAU,MAEtEE,EAAGF,GAAcC,CACnB,CAQAnmD,IAAAA,CAAKkmD,EAAY38C,EAAM88C,GACrBhlE,KAAKqkE,OAAOf,YACV,CACEa,WAAYnkE,KAAKmkE,WACjBC,WAAYpkE,KAAKokE,WACjBn4B,OAAQ44B,EACR38C,QAEF88C,EAEJ,CAUAC,eAAAA,CAAgBJ,EAAY38C,EAAM88C,GAChC,MAAMV,EAAatkE,KAAKskE,aAClBY,EAAaxlE,QAAQujC,gBAC3BjjC,KAAK0kE,qBAAqBJ,GAAcY,EACxC,IACEllE,KAAKqkE,OAAOf,YACV,CACEa,WAAYnkE,KAAKmkE,WACjBC,WAAYpkE,KAAKokE,WACjBn4B,OAAQ44B,EACRP,aACAp8C,QAEF88C,EAEJ,CAAE,MAAOh9B,GACPk9B,EAAWvlE,OAAOqoC,EACpB,CACA,OAAOk9B,EAAWliC,OACpB,CAYAmiC,cAAAA,CAAeN,EAAY38C,EAAMk9C,EAAkBJ,GACjD,MAAMT,EAAWvkE,KAAKukE,WACpBJ,EAAankE,KAAKmkE,WAClBC,EAAapkE,KAAKokE,WAClBC,EAASrkE,KAAKqkE,OAEhB,OAAO,IAAIgB,eACT,CACEtjD,MAAOujD,IACL,MAAMC,EAAkB7lE,QAAQujC,gBAoBhC,OAnBAjjC,KAAKykE,kBAAkBF,GAAY,CACjCe,aACAE,UAAWD,EACXE,SAAU,KACVC,WAAY,KACZC,UAAU,GAEZtB,EAAOf,YACL,CACEa,aACAC,aACAn4B,OAAQ44B,EACRN,WACAr8C,OACA09C,YAAaN,EAAWM,aAE1BZ,GAGKO,EAAgBviC,SAGzB6iC,KAAMP,IACJ,MAAMQ,EAAiBpmE,QAAQujC,gBAW/B,OAVAjjC,KAAKykE,kBAAkBF,GAAUkB,SAAWK,EAC5CzB,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAqB,YAAaN,EAAWM,cAInBE,EAAe9iC,SAGxBwS,OAAQwwB,IACN56D,GAAO46D,aAAkB76D,MAAO,mCAChC,MAAM86D,EAAmBvmE,QAAQujC,gBAWjC,OAVAjjC,KAAKykE,kBAAkBF,GAAUmB,WAAaO,EAC9CjmE,KAAKykE,kBAAkBF,GAAUoB,UAAW,EAC5CtB,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAyB,OAAQjC,GAAWiC,KAGdC,EAAiBjjC,UAG5BoiC,EAEJ,CA8OAj4C,OAAAA,GAAU,IAAA+4C,EACO,QAAfA,EAAAt8C,EAAKo6C,GAALhkE,aAAe,IAAAkmE,GAAfA,EAAiB/mC,QACjBjW,EAAK86C,GAALhkE,KAAkB,KACpB,EACF,SAAA4kE,GAAAuB,GAzbuB,IAAV,KAAEj+C,GAAMi+C,EACjB,GAAIj+C,EAAKk8C,aAAepkE,KAAKmkE,WAC3B,OAEF,GAAIj8C,EAAK69C,OAEP,YADA7mE,EAAA+kE,GAAAjkE,KAAKomE,IAAqB/0D,KAA1BrR,KAA2BkoB,GAG7B,GAAIA,EAAK+N,SAAU,CACjB,MAAMquC,EAAap8C,EAAKo8C,WAClBY,EAAallE,KAAK0kE,qBAAqBJ,GAC7C,IAAKY,EACH,MAAM,IAAI/5D,MAAM,2BAADH,OAA4Bs5D,IAI7C,UAFOtkE,KAAK0kE,qBAAqBJ,GAE7Bp8C,EAAK+N,WAAa2tC,GACpBsB,EAAWrlE,QAAQqoB,EAAKA,UACnB,IAAIA,EAAK+N,WAAa2tC,GAG3B,MAAM,IAAIz4D,MAAM,4BAFhB+5D,EAAWvlE,OAAOokE,GAAW77C,EAAK89C,QAGpC,CACA,MACF,CACA,MAAM/5B,EAASjsC,KAAK2kE,cAAcz8C,EAAK+jB,QACvC,IAAKA,EACH,MAAM,IAAI9gC,MAAM,+BAADH,OAAgCkd,EAAK+jB,SAEtD,GAAI/jB,EAAKo8C,WAAY,CACnB,MAAMH,EAAankE,KAAKmkE,WACtBC,EAAal8C,EAAKi8C,WAClBE,EAASrkE,KAAKqkE,OAsBhB,YApBA3kE,QAAQuY,IAAIg0B,EAAQ/jB,EAAKA,MAAMnoB,KAC7B,SAAUu0B,GACR+vC,EAAOf,YAAY,CACjBa,aACAC,aACAnuC,SAAU2tC,GACVU,WAAYp8C,EAAKo8C,WACjBp8C,KAAMoM,GAEV,EACA,SAAU0xC,GACR3B,EAAOf,YAAY,CACjBa,aACAC,aACAnuC,SAAU2tC,GACVU,WAAYp8C,EAAKo8C,WACjB0B,OAAQjC,GAAWiC,IAEvB,EAGJ,CACI99C,EAAKq8C,SACPrlE,EAAA+kE,GAAAjkE,KAAKqmE,IAAiBh1D,KAAtBrR,KAAuBkoB,GAGzB+jB,EAAO/jB,EAAKA,KACd,UAAAm+C,GA4IkBn+C,GAChB,MAAMq8C,EAAWr8C,EAAKq8C,SACpBJ,EAAankE,KAAKmkE,WAClBC,EAAal8C,EAAKi8C,WAClBE,EAASrkE,KAAKqkE,OACVluC,EAAOn2B,KACXisC,EAASjsC,KAAK2kE,cAAcz8C,EAAK+jB,QAE7Bq6B,EAAa,CACjBC,OAAAA,CAAQz3D,GAA4B,IAArB2hB,EAAItxB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAG6lE,EAAS7lE,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EAChC,GAAIzL,KAAKwmE,YACP,OAEF,MAAMC,EAAkBzmE,KAAK4lE,YAC7B5lE,KAAK4lE,aAAen1C,EAIhBg2C,EAAkB,GAAKzmE,KAAK4lE,aAAe,IAC7C5lE,KAAK0mE,eAAiBhnE,QAAQujC,gBAC9BjjC,KAAK2mE,MAAQ3mE,KAAK0mE,eAAe1jC,SAEnCqhC,EAAOf,YACL,CACEa,aACAC,aACA2B,OAAQlC,GACRU,WACAz1D,SAEFk2D,EAEJ,EAEAxxC,KAAAA,GACMxzB,KAAKwmE,cAGTxmE,KAAKwmE,aAAc,EACnBnC,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,oBAEKpuC,EAAKquC,YAAYD,GAC1B,EAEAqC,KAAAA,CAAMZ,GACJ56D,GAAO46D,aAAkB76D,MAAO,kCAC5BnL,KAAKwmE,cAGTxmE,KAAKwmE,aAAc,EACnBnC,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAyB,OAAQjC,GAAWiC,KAEvB,EAEAU,eAAgBhnE,QAAQujC,gBACxB4jC,OAAQ,KACRC,SAAU,KACVN,aAAa,EACbZ,YAAa19C,EAAK09C,YAClBe,MAAO,MAGTL,EAAWI,eAAe7mE,UAC1BymE,EAAWK,MAAQL,EAAWI,eAAe1jC,QAC7ChjC,KAAKwkE,YAAYD,GAAY+B,EAE7B5mE,QAAQuY,IAAIg0B,EAAQ/jB,EAAKA,KAAMo+C,GAAYvmE,KACzC,WACEskE,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAwC,SAAS,GAEb,EACA,SAAUf,GACR3B,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAyB,OAAQjC,GAAWiC,IAEvB,EAEJ,UAAAI,GAEsBl+C,GACpB,MAAMq8C,EAAWr8C,EAAKq8C,SACpBJ,EAAankE,KAAKmkE,WAClBC,EAAal8C,EAAKi8C,WAClBE,EAASrkE,KAAKqkE,OACV2C,EAAmBhnE,KAAKykE,kBAAkBF,GAC9C+B,EAAatmE,KAAKwkE,YAAYD,GAEhC,OAAQr8C,EAAK69C,QACX,KAAKlC,GACC37C,EAAK6+C,QACPC,EAAiBxB,UAAU3lE,UAE3BmnE,EAAiBxB,UAAU7lE,OAAOokE,GAAW77C,EAAK89C,SAEpD,MACF,KAAKnC,GACC37C,EAAK6+C,QACPC,EAAiBvB,SAAS5lE,UAE1BmnE,EAAiBvB,SAAS9lE,OAAOokE,GAAW77C,EAAK89C,SAEnD,MACF,KAAKnC,GAEH,IAAKyC,EAAY,CACfjC,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAwC,SAAS,IAEX,KACF,CAGIT,EAAWV,aAAe,GAAK19C,EAAK09C,YAAc,GACpDU,EAAWI,eAAe7mE,UAG5BymE,EAAWV,YAAc19C,EAAK09C,YAE9BlmE,QAAQuY,IAAIquD,EAAWO,QAAU/C,IAAM/jE,KACrC,WACEskE,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAwC,SAAS,GAEb,EACA,SAAUf,GACR3B,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAyB,OAAQjC,GAAWiC,IAEvB,GAEF,MACF,KAAKnC,GAEH,GADAz4D,GAAO47D,EAAkB,yCACrBA,EAAiBrB,SACnB,MAEFqB,EAAiB1B,WAAWiB,QAAQr+C,EAAKpZ,OACzC,MACF,KAAK+0D,GAEH,GADAz4D,GAAO47D,EAAkB,uCACrBA,EAAiBrB,SACnB,MAEFqB,EAAiBrB,UAAW,EAC5BqB,EAAiB1B,WAAW9xC,QAC5Bt0B,EAAA+kE,GAAAjkE,KAAKinE,IAAuB51D,KAA5BrR,KAA6BgnE,EAAkBzC,GAC/C,MACF,KAAKV,GACHz4D,GAAO47D,EAAkB,uCACzBA,EAAiB1B,WAAWsB,MAAM7C,GAAW77C,EAAK89C,SAClD9mE,EAAA+kE,GAAAjkE,KAAKinE,IAAuB51D,KAA5BrR,KAA6BgnE,EAAkBzC,GAC/C,MACF,KAAKV,GACC37C,EAAK6+C,QACPC,EAAiBtB,WAAW7lE,UAE5BmnE,EAAiBtB,WAAW/lE,OAAOokE,GAAW77C,EAAK89C,SAErD9mE,EAAA+kE,GAAAjkE,KAAKinE,IAAuB51D,KAA5BrR,KAA6BgnE,EAAkBzC,GAC/C,MACF,KAAKV,GACH,IAAKyC,EACH,MAEF,MAAMY,EAAanD,GAAW77C,EAAK89C,QAEnCtmE,QAAQuY,IAAIquD,EAAWQ,UAAYhD,GAAMoD,GAAYnnE,KACnD,WACEskE,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAwC,SAAS,GAEb,EACA,SAAUf,GACR3B,EAAOf,YAAY,CACjBa,aACAC,aACA2B,OAAQlC,GACRU,WACAyB,OAAQjC,GAAWiC,IAEvB,GAEFM,EAAWI,eAAe/mE,OAAOunE,GACjCZ,EAAWE,aAAc,SAClBxmE,KAAKwkE,YAAYD,GACxB,MACF,QACE,MAAM,IAAIp5D,MAAM,0BAEtB,gBAAA87D,GAE8BD,EAAkBzC,GAAU,IAAA4C,EAAAC,EAAAC,QAGlD3nE,QAAQ4nE,WAAW,CACG,QADHH,EACvBH,EAAiBxB,iBAAS,IAAA2B,OAAA,EAA1BA,EAA4BnkC,QACH,QADUokC,EACnCJ,EAAiBvB,gBAAQ,IAAA2B,OAAA,EAAzBA,EAA2BpkC,QACA,QADOqkC,EAClCL,EAAiBtB,kBAAU,IAAA2B,OAAA,EAA3BA,EAA6BrkC,iBAExBhjC,KAAKykE,kBAAkBF,EAChC,C,mBChgBF,MAAMgD,GAGJ/5D,WAAAA,CAAWg6D,GAAwB,IAAvB,UAAEC,GAAY,GAAOD,EAFjCvoE,EAAA,KAAAyoE,IAAa,GASXx+C,EAAKw+C,GAAL1nE,KAAkBynE,EACpB,CAEA3uD,MAAAA,CAAOkH,EAAOC,GACZ,GAAID,GAAS,GAAKC,GAAU,EAC1B,MAAM,IAAI9U,MAAM,uBAElB,MAAMwnB,EAAS3yB,KAAK2nE,cAAc3nD,EAAOC,GACzC,MAAO,CACL0S,SACAkhC,QAASlhC,EAAOnB,WAAW,KAAM,CAC/BC,oBAAqB7H,EAAK89C,GAAL1nE,QAG3B,CAEA4nE,KAAAA,CAAMC,EAAkB7nD,EAAOC,GAC7B,IAAK4nD,EAAiBl1C,OACpB,MAAM,IAAIxnB,MAAM,2BAElB,GAAI6U,GAAS,GAAKC,GAAU,EAC1B,MAAM,IAAI9U,MAAM,uBAElB08D,EAAiBl1C,OAAO3S,MAAQA,EAChC6nD,EAAiBl1C,OAAO1S,OAASA,CACnC,CAEAkN,OAAAA,CAAQ06C,GACN,IAAKA,EAAiBl1C,OACpB,MAAM,IAAIxnB,MAAM,2BAIlB08D,EAAiBl1C,OAAO3S,MAAQ,EAChC6nD,EAAiBl1C,OAAO1S,OAAS,EACjC4nD,EAAiBl1C,OAAS,KAC1Bk1C,EAAiBhU,QAAU,IAC7B,CAKA8T,aAAAA,CAAc3nD,EAAOC,GACnB/U,GAAY,0CACd,EAGF,MAAM48D,WAAyBP,GAC7B/5D,WAAAA,CAAWu6D,GAA6D,IAA5D,cAAEvS,EAAgBtkD,WAAW6K,SAAQ,UAAE0rD,GAAY,GAAOM,EACpEp6D,MAAM,CAAE85D,cACRznE,KAAK21D,UAAYH,CACnB,CAKAmS,aAAAA,CAAc3nD,EAAOC,GACnB,MAAM0S,EAAS3yB,KAAK21D,UAAU35C,cAAc,UAG5C,OAFA2W,EAAO3S,MAAQA,EACf2S,EAAO1S,OAASA,EACT0S,CACT,ECtEF,MAAMq1C,GACJx6D,WAAAA,CAAWy6D,GAA0C,IAAzC,QAAEz8D,EAAU,KAAI,aAAE08D,GAAe,GAAMD,EAOjDjoE,KAAKwL,QAAUA,EACfxL,KAAKkoE,aAAeA,CACtB,CAEA,WAAMtqD,CAAKuqD,GAAW,IAAV,KAAE56D,GAAM46D,EAClB,IAAKnoE,KAAKwL,QACR,MAAM,IAAIL,MACR,2EAGJ,IAAKoC,EACH,MAAM,IAAIpC,MAAM,gCAElB,MAAMI,EAAMvL,KAAKwL,QAAU+B,GAAQvN,KAAKkoE,aAAe,SAAW,IAElE,OAAOloE,KAAKooE,OAAO78D,GAChBxL,KAAKsoE,IAAY,CAAGA,WAAUH,aAAcloE,KAAKkoE,gBACjDI,MAAMtC,IACL,MAAM,IAAI76D,MAAM,kBAADH,OACKhL,KAAKkoE,aAAe,UAAY,GAAE,aAAAl9D,OAAYO,KAGxE,CAMA,YAAM68D,CAAO78D,GACXL,GAAY,mCACd,EAGF,MAAMq9D,WAA6BP,GAIjC,YAAMI,CAAO78D,GACX,MAAM2c,QAAa1K,GACjBjS,EACavL,KAAKkoE,aAAe,cAAgB,QAEnD,OAAOhgD,aAAgB0pC,YACnB,IAAIxiD,WAAW8Y,GACfhZ,GAAcgZ,EACpB,ECrDF,MAAMsgD,GAUJC,SAAAA,CAAUC,GACR,MAAO,MACT,CAEA5oC,YAAAA,CAAa6oC,EAASC,GACpB,MAAO,MACT,CAEAC,cAAAA,CAAehlD,GACb,MAAO,MACT,CAEAilD,mBAAAA,CAAoBjlD,GAClB,MAAO,MACT,CAEAklD,qBAAAA,CAAsBC,EAAYL,EAASC,EAASK,EAAYC,GAC9D,MAAO,MACT,CAEA/7C,OAAAA,GAA0B,EAC5B,IAAAg8C,GAAA,IAAAx7C,QAAAy7C,GAAA,IAAAz7C,QAAA07C,GAAA,IAAA17C,QAAA27C,GAAA,IAAA37C,QAAAgoC,GAAA,IAAAhoC,QAAA47C,GAAA,IAAA57C,QAAA67C,GAAA,IAAA77C,QAAA87C,GAAA,IAAA17C,QAWA,MAAM27C,WAAyBlB,GAe7Bh7D,WAAAA,CAAWm8D,GAAiD,IAAhD,MAAEC,EAAK,cAAEpU,EAAgBtkD,WAAW6K,UAAU4tD,EACxDh8D,QAAO7O,EAAA,KAAA2qE,IAfTxqE,EAAA,KAAAkqE,QAAQ,GAERlqE,EAAA,KAAAmqE,QAAO,GAEPnqE,EAAA,KAAAoqE,QAAM,GAENpqE,EAAA,KAAAqqE,QAAM,GAENrqE,EAAA,KAAA02D,QAAS,GAET12D,EAAA,KAAAsqE,QAAU,GAEVtqE,EAAA,KAAAuqE,GAAM,GAIJtgD,EAAKogD,GAALtpE,KAAc4pE,GACd1gD,EAAKysC,GAAL31D,KAAiBw1D,EACnB,CAyEAiT,SAAAA,CAAUC,GAAM,IAAAmB,EAAAC,EACd,IAAKpB,EACH,MAAO,OAKT,IAAI5oE,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAIopE,GAC5B,GAAI5oE,EACF,OAAOA,EAGT,MAAOkqE,EAAQC,EAAQC,GAAUhrE,EAAAuqE,GAAAzpE,KAAKmqE,IAAa94D,KAAlBrR,KAAmB0oE,GAC9CxtD,EAAsB,IAAhBwtD,EAAKrqE,OAAe2rE,EAAS,GAAHh/D,OAAMg/D,GAAMh/D,OAAGi/D,GAAMj/D,OAAGk/D,GAG9D,GADApqE,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAI4b,GACpBpb,EAEF,OADAV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIkqE,EAAM5oE,GACfA,EAMT,MAAM2Z,EAAK,KAAHzO,OAAQ4e,EAAK0/C,GAALtpE,MAAW,kBAAAgL,QAAiBke,EAAKsgD,GAALxpE,MAAI6pE,EAAJjgD,EAAK4/C,GAALxpE,MAAQ8pE,EAAAD,IAAAA,IAAAC,IAC9Cv+D,EAAMrM,EAAAuqE,GAAAzpE,KAAKoqE,IAAU/4D,KAAfrR,KAAgByZ,GAC5Bra,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIkqE,EAAMn9D,GACtBnM,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAI0c,EAAK3P,GAErB,MAAM8+D,EAASnrE,EAAAuqE,GAAAzpE,KAAKsqE,IAAaj5D,KAAlBrR,KAAmByZ,GAGlC,OAFAva,EAAAuqE,GAAAzpE,KAAKuqE,IAAyBl5D,KAA9BrR,KAA+BgqE,EAAQC,EAAQC,EAAQG,GAEhD9+D,CACT,CAEAu0B,YAAAA,CAAa6oC,EAASC,GAAS,IAAA4B,EAC7B,MAAMtvD,EAAM,GAAHlQ,OAAM29D,EAAO,KAAA39D,OAAI49D,GACpBI,EAAa,OACnB,IAAIn+D,EAAOzL,EAAAqqE,GAAAzpE,KAAKyqE,IAAUnrE,IAAI0pE,GAC9B,IAAQ,QAAJwB,EAAA3/D,SAAI,IAAA2/D,OAAA,EAAJA,EAAMtvD,OAAQA,EAChB,OAAOrQ,EAAKU,IAGJ,IAAAm/D,EAAN7/D,GACS,QAAX6/D,EAAA7/D,EAAKw/D,cAAM,IAAAK,GAAXA,EAAa5/C,SACbjgB,EAAKqQ,IAAMA,EACXrQ,EAAKU,IAAM,OACXV,EAAKw/D,OAAS,OAEdx/D,EAAO,CACLqQ,MACA3P,IAAK,OACL8+D,OAAQ,MAEVjrE,EAAAqqE,GAAAzpE,KAAKyqE,IAAUjsE,IAAIwqE,EAAYn+D,IAGjC,IAAK89D,IAAYC,EACf,OAAO/9D,EAAKU,IAGd,MAAMo/D,EAAQzrE,EAAAuqE,GAAAzpE,KAAK4qE,IAAOv5D,KAAZrR,KAAa2oE,GAC3BA,EAAU/2D,GAAKC,gBAAgB84D,GAC/B,MAAME,EAAQ3rE,EAAAuqE,GAAAzpE,KAAK4qE,IAAOv5D,KAAZrR,KAAa4oE,GAI3B,GAHAA,EAAUh3D,GAAKC,gBAAgBg5D,GAC/BzrE,EAAAqqE,GAAAzpE,KAAK8qE,IAAMzvD,MAAMsI,MAAQ,GAGV,YAAZglD,GAAqC,YAAZC,GAC1BD,IAAYC,EAEZ,OAAO/9D,EAAKU,IAYd,MAAMsY,EAAM,IAAItS,MAAM,KACtB,IAAK,IAAI7C,EAAI,EAAGA,GAAK,IAAKA,IAAK,CAC7B,MAAMoH,EAAIpH,EAAI,IACdmV,EAAInV,GAAKoH,GAAK,OAAUA,EAAI,QAAUA,EAAI,MAAS,QAAU,GAC/D,CACA,MAAMi1D,EAAQlnD,EAAI5U,KAAK,KAEjBwK,EAAK,KAAHzO,OAAQ4e,EAAK0/C,GAALtpE,MAAW,eACrBqqE,EAAUx/D,EAAKw/D,OAASnrE,EAAAuqE,GAAAzpE,KAAKsqE,IAAaj5D,KAAlBrR,KAAmByZ,GACjDva,EAAAuqE,GAAAzpE,KAAKuqE,IAAyBl5D,KAA9BrR,KAA+B+qE,EAAOA,EAAOA,EAAOV,GACpDnrE,EAAAuqE,GAAAzpE,KAAKgrE,IAAkB35D,KAAvBrR,KAAwBqqE,GAExB,MAAMY,EAAWA,CAAC/4D,EAAG/T,KACnB,MAAM4jB,EAAQ4oD,EAAMz4D,GAAK,IACnB8P,EAAM6oD,EAAM34D,GAAK,IACjB4F,EAAM,IAAIvG,MAAMpT,EAAI,GAC1B,IAAK,IAAIuQ,EAAI,EAAGA,GAAKvQ,EAAGuQ,IACtBoJ,EAAIpJ,GAAKqT,EAASrT,EAAIvQ,GAAM6jB,EAAMD,GAEpC,OAAOjK,EAAI7I,KAAK,MAUlB,OARA/P,EAAAuqE,GAAAzpE,KAAKuqE,IAAyBl5D,KAA9BrR,KACEirE,EAAS,EAAG,GACZA,EAAS,EAAG,GACZA,EAAS,EAAG,GACZZ,GAGFx/D,EAAKU,IAAMrM,EAAAuqE,GAAAzpE,KAAKoqE,IAAU/4D,KAAfrR,KAAgByZ,GACpB5O,EAAKU,GACd,CAEAs9D,cAAAA,CAAehlD,GAAK,IAAAqnD,EAAAC,EAGlB,IAAIrrE,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAIukB,GAC5B,GAAI/jB,EACF,OAAOA,EAGT,MAAOsrE,GAAUlsE,EAAAuqE,GAAAzpE,KAAKmqE,IAAa94D,KAAlBrR,KAAmB,CAAC6jB,IAC/B3I,EAAM,SAAHlQ,OAAYogE,GAGrB,GADAtrE,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAI4b,GACpBpb,EAEF,OADAV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIqlB,EAAK/jB,GACdA,EAGT,MAAM2Z,EAAK,KAAHzO,OAAQ4e,EAAK0/C,GAALtpE,MAAW,eAAAgL,QAAcke,EAAKsgD,GAALxpE,MAAIkrE,EAAJthD,EAAK4/C,GAALxpE,MAAQmrE,EAAAD,IAAAA,IAAAC,IAC3C5/D,EAAMrM,EAAAuqE,GAAAzpE,KAAKoqE,IAAU/4D,KAAfrR,KAAgByZ,GAC5Bra,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIqlB,EAAKtY,GACrBnM,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAI0c,EAAK3P,GAErB,MAAM8+D,EAASnrE,EAAAuqE,GAAAzpE,KAAKsqE,IAAaj5D,KAAlBrR,KAAmByZ,GAGlC,OAFAva,EAAAuqE,GAAAzpE,KAAKqrE,IAA8Bh6D,KAAnCrR,KAAoCorE,EAAQf,GAErC9+D,CACT,CAEAu9D,mBAAAA,CAAoBjlD,GAAK,IAAAynD,EAAAC,EAGvB,IAKIH,EAAQlwD,EALRpb,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAIukB,GAAO,cACnC,GAAI/jB,EACF,OAAOA,EAYT,GARI+jB,IACDunD,GAAUlsE,EAAAuqE,GAAAzpE,KAAKmqE,IAAa94D,KAAlBrR,KAAmB,CAAC6jB,IAC/B3I,EAAM,cAAHlQ,OAAiBogE,IAEpBlwD,EAAM,aAGRpb,EAAQV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOzqE,IAAI4b,GACpBpb,EAEF,OADAV,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIqlB,EAAK/jB,GACdA,EAGT,MAAM2Z,EAAK,KAAHzO,OAAQ4e,EAAK0/C,GAALtpE,MAAW,oBAAAgL,QAAmBke,EAAKsgD,GAALxpE,MAAIsrE,EAAJ1hD,EAAK4/C,GAALxpE,MAAQurE,EAAAD,IAAAA,IAAAC,IAChDhgE,EAAMrM,EAAAuqE,GAAAzpE,KAAKoqE,IAAU/4D,KAAfrR,KAAgByZ,GAC5Bra,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAIqlB,EAAKtY,GACrBnM,EAAAqqE,GAAAzpE,KAAK+pE,IAAOvrE,IAAI0c,EAAK3P,GAErB,MAAM8+D,EAASnrE,EAAAuqE,GAAAzpE,KAAKsqE,IAAaj5D,KAAlBrR,KAAmByZ,GAMlC,OALAva,EAAAuqE,GAAAzpE,KAAKwrE,IAAwBn6D,KAA7BrR,KAA8BqqE,GAC1BxmD,GACF3kB,EAAAuqE,GAAAzpE,KAAKqrE,IAA8Bh6D,KAAnCrR,KAAoCorE,EAAQf,GAGvC9+D,CACT,CAEAw9D,qBAAAA,CAAsBC,EAAYL,EAASC,EAASK,EAAYC,GAAY,IAAAuC,EAC1E,MAAMvwD,EAAM,GAAHlQ,OAAM29D,EAAO,KAAA39D,OAAI49D,EAAO,KAAA59D,OAAIi+D,EAAU,KAAAj+D,OAAIk+D,GACnD,IAAIr+D,EAAOzL,EAAAqqE,GAAAzpE,KAAKyqE,IAAUnrE,IAAI0pE,GAC9B,IAAQ,QAAJyC,EAAA5gE,SAAI,IAAA4gE,OAAA,EAAJA,EAAMvwD,OAAQA,EAChB,OAAOrQ,EAAKU,IAGJ,IAAAmgE,EAAN7gE,GACS,QAAX6gE,EAAA7gE,EAAKw/D,cAAM,IAAAqB,GAAXA,EAAa5gD,SACbjgB,EAAKqQ,IAAMA,EACXrQ,EAAKU,IAAM,OACXV,EAAKw/D,OAAS,OAEdx/D,EAAO,CACLqQ,MACA3P,IAAK,OACL8+D,OAAQ,MAEVjrE,EAAAqqE,GAAAzpE,KAAKyqE,IAAUjsE,IAAIwqE,EAAYn+D,IAGjC,IAAK89D,IAAYC,EACf,OAAO/9D,EAAKU,IAGd,MAAOo/D,EAAOE,GAAS,CAAClC,EAASC,GAAS/kD,IAAI3kB,EAAAuqE,GAAAzpE,KAAK4qE,IAAQr9C,KAAKvtB,OAChE,IAAI2rE,EAAS/8D,KAAK21C,MAChB,MAASomB,EAAM,GAAK,MAASA,EAAM,GAAK,MAASA,EAAM,IAErDiB,EAASh9D,KAAK21C,MAChB,MAASsmB,EAAM,GAAK,MAASA,EAAM,GAAK,MAASA,EAAM,KAEpDgB,EAAUC,GAAY,CAAC7C,EAAYC,GAAYrlD,IAClD3kB,EAAAuqE,GAAAzpE,KAAK4qE,IAAQr9C,KAAKvtB,OAEhB4rE,EAASD,KACVA,EAAQC,EAAQC,EAAUC,GAAY,CACrCF,EACAD,EACAG,EACAD,IAGJzsE,EAAAqqE,GAAAzpE,KAAK8qE,IAAMzvD,MAAMsI,MAAQ,GAezB,MAAMsnD,EAAWA,CAACc,EAAIC,EAAI7tE,KACxB,MAAM2Z,EAAM,IAAIvG,MAAM,KAChB06D,GAAQL,EAASD,GAAUxtE,EAC3B+tE,EAAWH,EAAK,IAChBI,GAAWH,EAAKD,IAAO,IAAM5tE,GACnC,IAAIiuE,EAAO,EACX,IAAK,IAAI19D,EAAI,EAAGA,GAAKvQ,EAAGuQ,IAAK,CAC3B,MAAM29D,EAAIz9D,KAAK21C,MAAMonB,EAASj9D,EAAIu9D,GAC5BnsE,EAAQosE,EAAWx9D,EAAIy9D,EAC7B,IAAK,IAAIG,EAAIF,EAAME,GAAKD,EAAGC,IACzBx0D,EAAIw0D,GAAKxsE,EAEXssE,EAAOC,EAAI,CACb,CACA,IAAK,IAAI39D,EAAI09D,EAAM19D,EAAI,IAAKA,IAC1BoJ,EAAIpJ,GAAKoJ,EAAIs0D,EAAO,GAEtB,OAAOt0D,EAAI7I,KAAK,MAGZwK,EAAK,KAAHzO,OAAQ4e,EAAK0/C,GAALtpE,MAAW,SAAAgL,OAAQg+D,EAAU,WACvCqB,EAAUx/D,EAAKw/D,OAASnrE,EAAAuqE,GAAAzpE,KAAKsqE,IAAaj5D,KAAlBrR,KAAmByZ,GAWjD,OATAva,EAAAuqE,GAAAzpE,KAAKgrE,IAAkB35D,KAAvBrR,KAAwBqqE,GACxBnrE,EAAAuqE,GAAAzpE,KAAKuqE,IAAyBl5D,KAA9BrR,KACEirE,EAASY,EAAS,GAAIC,EAAS,GAAI,GACnCb,EAASY,EAAS,GAAIC,EAAS,GAAI,GACnCb,EAASY,EAAS,GAAIC,EAAS,GAAI,GACnCzB,GAGFx/D,EAAKU,IAAMrM,EAAAuqE,GAAAzpE,KAAKoqE,IAAU/4D,KAAfrR,KAAgByZ,GACpB5O,EAAKU,GACd,CAEA4hB,OAAAA,GAAyB,IAAAo/C,EAAAC,EAAAC,EAAAC,EAAVvtE,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,IACiB,QAAnBotE,EAAI3iD,EAAK2/C,GAALvpE,aAAe,IAAAusE,GAAfA,EAAiB97C,OAGrB,QAAX+7C,EAAA5iD,EAAKy/C,GAALrpE,aAAW,IAAAwsE,GAAXA,EAAap2B,WAAWA,WAAWtrB,SACnC5B,EAAKmgD,GAALrpE,KAAc,MAEF,QAAZysE,EAAA7iD,EAAKw/C,GAALppE,aAAY,IAAAysE,GAAZA,EAAcntC,QACdpW,EAAKkgD,GAALppE,KAAe,MAEA,QAAf0sE,EAAA9iD,EAAK2/C,GAALvpE,aAAe,IAAA0sE,GAAfA,EAAiBptC,QACjBpW,EAAKqgD,GAALvpE,KAAkB,MAElBkpB,EAAKsgD,GAALxpE,KAAW,GACb,EAoEF,SAAA+pE,GAAA4C,GAxaI,OAAQ/iD,EAAKw/C,GAAOuD,IAAZzjD,EAAKkgD,GAAOuD,EAAK,IAAItlD,IAC/B,UAAAojD,GAAAmC,GAGE,OAAQhjD,EAAK2/C,GAAUqD,IAAf1jD,EAAKqgD,GAAUqD,EAAK,IAAIvlD,IAClC,UAAAyjD,GAAA+B,GAGE,IAAKjjD,EAAKy/C,GAAMwD,GAAE,CAChB,MAAM1wD,EAAMyN,EAAK+rC,GAASkX,GAAC7wD,cAAc,QACnC,MAAEX,GAAUc,EAClBd,EAAMyb,WAAa,SACnBzb,EAAMyxD,QAAU,SAChBzxD,EAAM2E,MAAQ3E,EAAM4E,OAAS,EAC7B5E,EAAM8O,SAAW,WACjB9O,EAAMkP,IAAMlP,EAAMooC,KAAO,EACzBpoC,EAAM2mC,QAAU,EAEhB,MAAM+qB,EAAMnjD,EAAK+rC,GAASkX,GAAC7vD,gBAAgBK,GAAQ,OACnD0vD,EAAI3yD,aAAa,QAAS,GAC1B2yD,EAAI3yD,aAAa,SAAU,GAC3B8O,EAAKmgD,GAAMwD,EAAGjjD,EAAK+rC,GAASkX,GAAC7vD,gBAAgBK,GAAQ,SACrDlB,EAAIC,OAAO2wD,GACXA,EAAI3wD,OAAOwN,EAAKy/C,GAAMwD,IACtBjjD,EAAK+rC,GAASkX,GAAC71C,KAAK5a,OAAOD,EAC7B,CACA,OAAOyN,EAAKy/C,GAAMwD,EACpB,UAAA1C,GAEczB,GACZ,GAAoB,IAAhBA,EAAKrqE,OAAc,CACrB,MAAM2uE,EAAOtE,EAAK,GACZh5D,EAAS,IAAI6B,MAAM,KACzB,IAAK,IAAI7C,EAAI,EAAGA,EAAI,IAAKA,IACvBgB,EAAOhB,GAAKs+D,EAAKt+D,GAAK,IAGxB,MAAMq8D,EAAQr7D,EAAOT,KAAK,KAC1B,MAAO,CAAC87D,EAAOA,EAAOA,EACxB,CAEA,MAAOiC,EAAMC,EAAMC,GAAQxE,EACrByE,EAAU,IAAI57D,MAAM,KACpB67D,EAAU,IAAI77D,MAAM,KACpB87D,EAAU,IAAI97D,MAAM,KAC1B,IAAK,IAAI7C,EAAI,EAAGA,EAAI,IAAKA,IACvBy+D,EAAQz+D,GAAKs+D,EAAKt+D,GAAK,IACvB0+D,EAAQ1+D,GAAKu+D,EAAKv+D,GAAK,IACvB2+D,EAAQ3+D,GAAKw+D,EAAKx+D,GAAK,IAEzB,MAAO,CAACy+D,EAAQl+D,KAAK,KAAMm+D,EAAQn+D,KAAK,KAAMo+D,EAAQp+D,KAAK,KAC7D,UAAAm7D,GAEW3wD,GACT,QAAsBhO,IAAlBme,EAAKu/C,GAALnpE,MAA6B,CAE/BkpB,EAAKigD,GAALnpE,KAAgB,IAEhB,MAAMuL,EAAMqe,EAAK+rC,GAAL31D,MAAeoM,IACvBb,IAAQqe,EAAK+rC,GAAL31D,MAAe0d,UACrBsD,GAAazV,GACfN,GAAK,2DAELie,EAAKigD,GAALnpE,KAAgBwM,GAAcjB,EAAK,KAGzC,CACA,MAAO,OAAPP,OAAc4e,EAAKu/C,GAALnpE,MAAa,KAAAgL,OAAIyO,EAAE,IACnC,UAAA+xD,GAkSyBnB,GACvB,MAAMiD,EAAgB1jD,EAAK+rC,GAAL31D,MAAegd,gBACnCK,GACA,iBAEFiwD,EAAclzD,aAAa,OAAQ,UACnCkzD,EAAclzD,aACZ,SACA,mDAEFiwD,EAAOjuD,OAAOkxD,EAChB,UAAAtC,GAEmBX,GACjB,MAAMiD,EAAgB1jD,EAAK+rC,GAAL31D,MAAegd,gBACnCK,GACA,iBAEFiwD,EAAclzD,aAAa,OAAQ,UACnCkzD,EAAclzD,aACZ,SACA,wFAEFiwD,EAAOjuD,OAAOkxD,EAChB,UAAAhD,GAEc7wD,GACZ,MAAM4wD,EAASzgD,EAAK+rC,GAAL31D,MAAegd,gBAAgBK,GAAQ,UAKtD,OAJAgtD,EAAOjwD,aAAa,8BAA+B,QACnDiwD,EAAOjwD,aAAa,KAAMX,GAC1Bra,EAAAqqE,GAAAzpE,KAAK8qE,IAAM1uD,OAAOiuD,GAEXA,CACT,UAAAkD,GAEcC,EAAqBC,EAAM1C,GACvC,MAAM2C,EAAS9jD,EAAK+rC,GAAL31D,MAAegd,gBAAgBK,GAAQowD,GACtDC,EAAOtzD,aAAa,OAAQ,YAC5BszD,EAAOtzD,aAAa,cAAe2wD,GACnCyC,EAAoBpxD,OAAOsxD,EAC7B,UAAAnD,GAE0BoD,EAAQC,EAAQC,EAAQxD,GAChD,MAAMmD,EAAsB5jD,EAAK+rC,GAAL31D,MAAegd,gBACzCK,GACA,uBAEFgtD,EAAOjuD,OAAOoxD,GACdtuE,EAAAuqE,GAAAzpE,KAAKutE,IAAal8D,KAAlBrR,KAAmBwtE,EAAqB,UAAWG,GACnDzuE,EAAAuqE,GAAAzpE,KAAKutE,IAAal8D,KAAlBrR,KAAmBwtE,EAAqB,UAAWI,GACnD1uE,EAAAuqE,GAAAzpE,KAAKutE,IAAal8D,KAAlBrR,KAAmBwtE,EAAqB,UAAWK,EACrD,UAAAxC,GAE+ByC,EAAQzD,GACrC,MAAMmD,EAAsB5jD,EAAK+rC,GAAL31D,MAAegd,gBACzCK,GACA,uBAEFgtD,EAAOjuD,OAAOoxD,GACdtuE,EAAAuqE,GAAAzpE,KAAKutE,IAAal8D,KAAlBrR,KAAmBwtE,EAAqB,UAAWM,EACrD,UAAAlD,GAEQjnD,GAEN,OADAvkB,EAAAqqE,GAAAzpE,KAAK8qE,IAAMzvD,MAAMsI,MAAQA,EAClBD,GAAOwT,iBAAiB93B,EAAAqqE,GAAAzpE,KAAK8qE,KAAOtpB,iBAAiB,SAC9D,CCveF,MAAMusB,GACJvgE,WAAAA,CAAWwgE,GAAqB,IAApB,QAAExiE,EAAU,MAAMwiE,EAO5BhuE,KAAKwL,QAAUA,CACjB,CAEA,WAAMoS,CAAKqwD,GAAe,IAAd,SAAE3sD,GAAU2sD,EACtB,IAAKjuE,KAAKwL,QACR,MAAM,IAAIL,MACR,oEAGJ,IAAKmW,EACH,MAAM,IAAInW,MAAM,oCAElB,MAAMI,EAAM,GAAHP,OAAMhL,KAAKwL,SAAOR,OAAGsW,GAE9B,OAAOthB,KAAKooE,OAAO78D,GAAK+8D,MAAMtC,IAC5B,MAAM,IAAI76D,MAAM,gCAADH,OAAiCO,KAEpD,CAMA,YAAM68D,CAAO78D,GACXL,GAAY,mCACd,EAGF,MAAMgjE,WAAmCH,GAIvC,YAAM3F,CAAO78D,GACX,MAAM2c,QAAa1K,GAAUjS,EAAkB,eAC/C,OAAO,IAAI6D,WAAW8Y,EACxB,EC3CF,MAAMimD,GACJ3gE,WAAAA,CAAW4gE,GAAqB,IAApB,QAAE5iE,EAAU,MAAM4iE,EAO5BpuE,KAAKwL,QAAUA,CACjB,CAEA,WAAMoS,CAAKywD,GAAe,IAAd,SAAE/sD,GAAU+sD,EACtB,IAAKruE,KAAKwL,QACR,MAAM,IAAIL,MAAM,wDAElB,IAAKmW,EACH,MAAM,IAAInW,MAAM,oCAElB,MAAMI,EAAM,GAAHP,OAAMhL,KAAKwL,SAAOR,OAAGsW,GAE9B,OAAOthB,KAAKooE,OAAO78D,GAAK+8D,MAAMtC,IAC5B,MAAM,IAAI76D,MAAM,gCAADH,OAAiCO,KAEpD,CAMA,YAAM68D,CAAO78D,GACXL,GAAY,mCACd,EAGF,MAAMojE,WAAuBH,GAI3B,YAAM/F,CAAO78D,GACX,MAAM2c,QAAa1K,GAAUjS,EAAkB,eAC/C,OAAO,IAAI6D,WAAW8Y,EACxB,ECoBF3K,eAAegxD,GAAUhjE,GACvB,MAAMijE,EAAKpuE,QAAQquE,iBAAiB,MAC9BvmD,QAAasmD,EAAG17B,SAAS47B,SAASnjE,GACxC,OAAO,IAAI6D,WAAW8Y,EACxB,CAtDI/nB,GAEA8K,GAAK,0DAsDT,MAAM0jE,WAA0BnG,IAEhC,MAAMoG,WAA0BrH,GAI9BI,aAAAA,CAAc3nD,EAAOC,GAKnB,OAJgB7f,QACbquE,iBAAiB,UACjBI,cAAcC,wGACFC,CAAQ,mBACTC,aAAahvD,EAAOC,EACpC,EAGF,MAAMgvD,WAA8BjH,GAIlC,YAAMI,CAAO78D,GACX,OAAOgjE,GAAUhjE,EACnB,EAGF,MAAM2jE,WAAoCnB,GAIxC,YAAM3F,CAAO78D,GACX,OAAOgjE,GAAUhjE,EACnB,EAGF,MAAM4jE,WAAwBhB,GAI5B,YAAM/F,CAAO78D,GACX,OAAOgjE,GAAUhjE,EACnB,EC1HF,MAAM6jE,GAA0B,sBAE1B,MAAEvoD,GAAK,KAAEhB,IAASjX,KAExB,SAASygE,GAAWC,EAAO/S,EAAO2F,EAAME,EAAMD,EAAME,GAClDiN,EAAc,EAAR/S,EAAY,GAAK3tD,KAAKC,IAAIygE,EAAc,EAAR/S,EAAY,GAAI2F,GACtDoN,EAAc,EAAR/S,EAAY,GAAK3tD,KAAKC,IAAIygE,EAAc,EAAR/S,EAAY,GAAI6F,GACtDkN,EAAc,EAAR/S,EAAY,GAAK3tD,KAAKiG,IAAIy6D,EAAc,EAAR/S,EAAY,GAAI4F,GACtDmN,EAAc,EAAR/S,EAAY,GAAK3tD,KAAKiG,IAAIy6D,EAAc,EAAR/S,EAAY,GAAI8F,EACxD,CAIA,MAAMkN,GAAa,IAAI9/D,YAAY,IAAIL,WAAW,CAAC,IAAK,IAAK,EAAG,IAAIM,QAAQ,GAAE,IAAA8/D,GAAA,IAAA7hD,QAAA8hD,GAAA,IAAA9hD,QAE9E,MAAM+hD,GAKJliE,WAAAA,CAAYmiE,EAAQ5P,GAJpB9gE,EAAA,KAAAuwE,QAAO,GAEPvwE,EAAA,KAAAwwE,QAAO,GAGLvmD,EAAKsmD,GAALxvE,KAAe2vE,GACfzmD,EAAKumD,GAALzvE,KAAe+/D,EACjB,CAEA,UAAI1hE,GACF,OAAOurB,EAAK4lD,GAALxvE,MAAa3B,MACtB,CAEA8+B,OAAAA,CAAQzuB,GACN,OAAOkb,EAAK4lD,GAALxvE,MAAa0O,KAAO6gE,EAC7B,CAEArN,IAAAA,CAAKxzD,GACH,OAAOkb,EAAK6lD,GAALzvE,MAAiB,EAAJ0O,EAAQ,GAAK,GACnC,CAEA0zD,IAAAA,CAAK1zD,GACH,OAAOkb,EAAK6lD,GAALzvE,MAAiB,EAAJ0O,EAAQ,GAAK,GACnC,CAEAyzD,IAAAA,CAAKzzD,GACH,OAAQkb,EAAK6lD,GAALzvE,MAAiB,EAAJ0O,EAAQ,GAAK,GAAK,GACzC,CAEA2zD,IAAAA,CAAK3zD,GACH,OAAQkb,EAAK6lD,GAALzvE,MAAiB,EAAJ0O,EAAQ,GAAK,GAAK,GACzC,EAGF,MAAMkhE,GAAsBA,CAAC/rD,EAAK3I,KAChC,IAAK2I,EACH,OAEF,IAAI/jB,EAAQ+jB,EAAIvkB,IAAI4b,GAKpB,OAJKpb,IACHA,EAAQ,CAAE+vE,aAAc,IAAIrgD,IAAOsgD,sBAAsB,GACzDjsD,EAAIrlB,IAAI0c,EAAKpb,IAERA,GACR,IAAAiwE,GAAA,IAAApiD,QAAAqiD,GAAA,IAAAriD,QAAAsiD,GAAA,IAAAtiD,QAAAuiD,GAAA,IAAAviD,QAAAwiD,GAAA,IAAAxiD,QAAAyiD,GAAA,IAAAziD,QAAA0iD,GAAA,IAAA1iD,QAAA2iD,GAAA,IAAA3iD,QAAA4iD,GAAA,IAAA5iD,QAAA6iD,GAAA,IAAA7iD,QAAA8iD,GAAA,IAAA9iD,QAAA+iD,GAAA,IAAA/iD,QAAAgjD,GAAA,IAAAhjD,QAAAijD,GAAA,IAAAjjD,QAAAkjD,GAAA,IAAAljD,QAAAmjD,GAAA,IAAAnjD,QAAAojD,GAAA,IAAApjD,QAAAqjD,GAAA,IAAAjjD,QAgBD,MAAMkjD,GA6CJzjE,WAAAA,CAAYmlB,EAAQu+C,GAA8C,IAA7BC,EAAmBhyE,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAAQL,EAAA,KAAAkyE,IA3ChE/xE,EAAA,KAAA8wE,GAAU,CAAEqB,UAAW,OAGvBnyE,EAAA,KAAA+wE,GAAe,CACboB,UAAW,KACX9rE,UAAW,GACX4B,SAAU,GACVmqE,aAAc,GACd,CAACjC,IAA0B,KAG7BnwE,EAAA,KAAAgxE,GAAqB,IAAI5oD,KAEzBpoB,EAAA,KAAAixE,GAAc,IAEdjxE,EAAA,KAAAkxE,GAAsB,IAEtBlxE,EAAA,KAAAmxE,GAAsB,CAAC,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,KAEvCnxE,EAAA,KAAAoxE,GAAW,EAAE/qD,KAAWA,IAAUA,IAAUA,MAG5CrmB,EAAA,KAAAqxE,GAAe,IAAIgB,aAAa,CAAChsD,IAAUA,KAAWA,KAAWA,OAEjErmB,EAAA,KAAAsxE,IAAmB,GAEnBtxE,EAAA,KAAAuxE,GAAuB,IAAIhhD,KAE3BvwB,EAAA,KAAAwxE,GAAc,IAAIppD,KAElBpoB,EAAA,KAAAyxE,GAAuB,IAAIrpD,KAE3BpoB,EAAA,KAAA0xE,QAAY,GAEZ1xE,EAAA,KAAA2xE,QAAa,GAGb3xE,EAAA,KAAA4xE,QAAa,GAEb5xE,EAAA,KAAA6xE,QAAO,GAEP7xE,EAAA,KAAA8xE,QAAc,GAGZ7nD,EAAKynD,GAAL3wE,KAAoB2yB,EAAO3S,OAC3BkJ,EAAK0nD,GAAL5wE,KAAqB2yB,EAAO1S,QAC5B/gB,EAAA8xE,GAAAhxE,KAAKuxE,IAAiBlgE,KAAtBrR,KAAuBkxE,GACnBC,GACFjoD,EAAK6nD,GAAL/wE,KAAsB,IAAIqnB,IAE9B,CAEAmqD,mBAAAA,CAAoBN,GACdA,GAAmBtnD,EAAKknD,GAAL9wE,MAAa3B,QAClCa,EAAA8xE,GAAAhxE,KAAKuxE,IAAiBlgE,KAAtBrR,KAAuBkxE,EAAiBtnD,EAAKknD,GAAL9wE,MAE5C,CAcAoF,IAAAA,CAAKqsE,GAcH,OAbAvoD,EAAK6mD,GAAL/vE,KAAe,CAAEoxE,UAAWxnD,EAAKmmD,GAAL/vE,QAC5BkpB,EAAK8mD,GAALhwE,KAAoB,CAClBoxE,UAAWxnD,EAAKomD,GAALhwE,MACXsF,UAAW,CAAE8rE,UAAWxnD,EAAKomD,GAALhwE,MAAkBsF,WAC1C4B,SAAU,CAAEkqE,UAAWxnD,EAAKomD,GAALhwE,MAAkBkH,UACzCmqE,aAAc,CAAED,UAAWxnD,EAAKomD,GAALhwE,MAAkBqxE,cAC7C,CAACjC,IAA0B,CACzBgC,UAAWxnD,EAAKomD,GAALhwE,MAAkBovE,OAGjClmD,EAAKmnD,GAALrwE,KAAgB,CAAEoxE,UAAWxnD,EAAKymD,GAALrwE,QAC7B4pB,EAAKsmD,GAALlwE,MAAiBgP,KAAKyiE,GAEfzxE,IACT,CAEAqF,OAAAA,CAAQosE,GACN,MAAMC,EAAWpzE,OAAO8hD,eAAex2B,EAAKmmD,GAAL/vE,OACvC,GAAiB,OAAb0xE,EAGF,OAAO1xE,KAETkpB,EAAK6mD,GAAL/vE,KAAe0xE,GACfxoD,EAAK8mD,GAALhwE,KAAoB1B,OAAO8hD,eAAex2B,EAAKomD,GAALhwE,QAC1CkpB,EAAKmnD,GAALrwE,KAAgB1B,OAAO8hD,eAAex2B,EAAKymD,GAALrwE,QAEtC,MAAM2xE,EAAW/nD,EAAKsmD,GAALlwE,MAAiB6c,MACN,IAAA+0D,OAAXnmE,IAAbkmE,IAC6C,QAA/CC,EAAAhC,GAAoBhmD,EAAKmnD,GAAL/wE,MAAqByxE,UAAM,IAAAG,GAA/CA,EAAiD/B,aAAa7wE,IAC5D2yE,GAEF/nD,EAAKknD,GAAL9wE,MAAayxE,GAAS7nD,EAAKknD,GAAL9wE,MAAa2xE,IAGrC,OAAO3xE,IACT,CAKA6xE,gBAAAA,CAAiBC,GAEf,OADAloD,EAAKsmD,GAALlwE,MAAiBgP,KAAK8iE,GACf9xE,IACT,CAEA+xE,aAAAA,GACE,OAAgC,IAA5BnoD,EAAKsmD,GAALlwE,MAAiB3B,OACZ,KAEFurB,EAAKsmD,GAALlwE,MAAiB4c,IAAI,EAC9B,CAEAo1D,iBAAAA,CAAkBP,GAChB,MAAME,EAAW/nD,EAAKsmD,GAALlwE,MAAiB6c,MACN,IAAAo1D,OAAXxmE,IAAbkmE,IAC6C,QAA/CM,EAAArC,GAAoBhmD,EAAKmnD,GAAL/wE,MAAqByxE,UAAM,IAAAQ,GAA/CA,EAAiDpC,aAAa7wE,IAC5D2yE,GAEF/nD,EAAKknD,GAAL9wE,MAAayxE,GAAS7nD,EAAKknD,GAAL9wE,MAAa2xE,IAErC,OAAO3xE,IACT,CAIA+I,kBAAAA,CAAmB0oE,GAEjB,OADA7nD,EAAKumD,GAALnwE,MAAyBgP,KAAKyiE,GACvBzxE,IACT,CAEAiJ,gBAAAA,CAAiBwoE,GACf,MAAME,EAAW/nD,EAAKumD,GAALnwE,MAAyB6c,MACd,IAAAq1D,OAAXzmE,IAAbkmE,IAC6C,QAA/CO,EAAAtC,GAAoBhmD,EAAKmnD,GAAL/wE,MAAqByxE,UAAM,IAAAS,GAA/CA,EAAiDrC,aAAa7wE,IAC5D2yE,GAEF/nD,EAAKknD,GAAL9wE,MAAayxE,GAAS7nD,EAAKknD,GAAL9wE,MAAa2xE,IAErC,OAAO3xE,IACT,CAEAmyE,iBAAAA,CAAkBpuD,GAOhB,OANA6F,EAAKwmD,GAALpwE,MAAyBgP,KACvB4C,GAAKc,oBACHkX,EAAKwmD,GAALpwE,MAAyB4c,IAAI,GAC7BmH,EAAIC,iBAGDhkB,IACT,CAEAoyE,gBAAAA,GAIE,OAHIxoD,EAAKwmD,GAALpwE,MAAyB3B,OAAS,GACpCurB,EAAKwmD,GAALpwE,MAAyB6c,MAEpB7c,IACT,CAMAqyE,gBAAAA,CAAiB9kE,EAAMukE,GAErB,OADAloD,EAAKmmD,GAAL/vE,MAAauN,GAAQukE,EACd9xE,IACT,CAMAsyE,qBAAAA,CAAsB/kE,EAAMukE,GAE1B,OADAloD,EAAKomD,GAALhwE,MAAkBuN,GAAMyB,KAAK8iE,GACtB9xE,IACT,CAMAuyE,oBAAAA,CAAqBhlE,EAAMukE,GAEzB,OADAloD,EAAKomD,GAALhwE,MAAkBuN,GAAMlP,OAAS,EAC1B2B,IACT,CAEAwyE,eAAAA,CAAgBjlE,EAAMukE,GAEpB,OADAloD,EAAKqmD,GAALjwE,MAAwBxB,IAAI+O,EAAMukE,GAC3B9xE,IACT,CAOAyyE,yBAAAA,CAA0BllE,EAAMmlE,EAASC,GAAa,IAAAC,EACpDhpD,EAAKmmD,GAAL/vE,MAAauN,GAA4C,QAAvCqlE,EAAGhpD,EAAKqmD,GAALjwE,MAAwBV,IAAIozE,UAAQ,IAAAE,EAAAA,EAAID,CAC/D,CAGAE,4BAAAA,CAA6BtlE,EAAMukE,GAEjC,OADA9xE,KAAKsyE,sBAAsBlD,GAAyB0C,GAC7C9xE,IACT,CAIA8yE,2CAAAA,CAA4C3jD,GAC1C,IAAK,MAAM5hB,KAAQ4hB,EACb5hB,KAAQqc,EAAKmmD,GAAL/vE,OACVA,KAAK6yE,6BAA6BtlE,EAAMqc,EAAKmmD,GAAL/vE,MAAauN,IAGzD,OAAOvN,IACT,CAEA+yE,oDAAAA,GACE,IAAK,MAAMC,KAAOppD,EAAK4mD,GAALxwE,MAChBA,KAAK6yE,6BAA6BzD,GAAyB4D,GAE7D,OAAOhzE,IACT,CAEAizE,SAAAA,CAAUnB,GAQR,OAPIloD,EAAK2mD,GAALvwE,QAAyB8xE,IAC3B5oD,EAAKqnD,GAALvwE,KAAuB8xE,GACvBloD,EAAK0mD,GAALtwE,MAAkB,GAAKslB,IACvBsE,EAAK0mD,GAALtwE,MAAkB,GAAKslB,IACvBsE,EAAK0mD,GAALtwE,MAAkB,IAAMslB,IACxBsE,EAAK0mD,GAALtwE,MAAkB,IAAMslB,KAEnBtlB,IACT,CAEAkzE,aAAAA,CAAcpB,EAAK/tD,EAAKm+C,EAAMC,EAAMC,EAAMC,GACxC,MAAM/8D,EAAYsM,GAAKc,oBACrBkX,EAAKwmD,GAALpwE,MAAyB4c,IAAI,GAC7BmH,EAAIC,gBAEAmvD,EAAU,CAAC7tD,IAAUA,KAAWA,KAAWA,KACjD1T,GAAK8B,wBAAwB,CAACwuD,EAAME,EAAMD,EAAME,GAAO/8D,EAAW6tE,GAClE,MAAMC,EAAexhE,GAAK0D,UAAUsU,EAAKymD,GAALrwE,MAAemzE,GAUnD,OATIC,GACFxpD,EAAKymD,GAALrwE,MAAc,GAAKozE,EAAa,GAChCxpD,EAAKymD,GAALrwE,MAAc,GAAKozE,EAAa,GAChCxpD,EAAKymD,GAALrwE,MAAc,GAAKozE,EAAa,GAChCxpD,EAAKymD,GAALrwE,MAAc,GAAKozE,EAAa,KAEhCxpD,EAAKymD,GAALrwE,MAAc,GAAK4pB,EAAKymD,GAALrwE,MAAc,GAAKslB,IACtCsE,EAAKymD,GAALrwE,MAAc,GAAK4pB,EAAKymD,GAALrwE,MAAc,IAAMslB,KAElCtlB,IACT,CAEAqzE,UAAAA,CAAWvB,EAAK/tD,EAAKm+C,EAAMC,EAAMC,EAAMC,GACrC,MAAM8Q,EAAUvpD,EAAKymD,GAALrwE,MAChB,GAAImzE,EAAQ,KAAO7tD,IACjB,OAAOtlB,KAGT,MAAMsF,EAAYsM,GAAKc,oBACrBkX,EAAKwmD,GAALpwE,MAAyB4c,IAAI,GAC7BmH,EAAIC,gBAEN,GAAImvD,EAAQ,MAAQ7tD,IAMlB,OALA1T,GAAK8B,wBACH,CAACwuD,EAAME,EAAMD,EAAME,GACnB/8D,EACAskB,EAAK0mD,GAALtwE,OAEKA,KAGT,MAAMg7D,EAAO,CAAC11C,IAAUA,KAAWA,KAAWA,KAkB9C,OAjBA1T,GAAK8B,wBAAwB,CAACwuD,EAAME,EAAMD,EAAME,GAAO/8D,EAAW01D,GAClEpxC,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKC,IAC1B+a,EAAK0mD,GAALtwE,MAAkB,GAClB4O,KAAKiG,IAAImmD,EAAK,GAAImY,EAAQ,KAE5BvpD,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKC,IAC1B+a,EAAK0mD,GAALtwE,MAAkB,GAClB4O,KAAKiG,IAAImmD,EAAK,GAAImY,EAAQ,KAE5BvpD,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKiG,IAC1B+U,EAAK0mD,GAALtwE,MAAkB,GAClB4O,KAAKC,IAAImsD,EAAK,GAAImY,EAAQ,KAE5BvpD,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKiG,IAC1B+U,EAAK0mD,GAALtwE,MAAkB,GAClB4O,KAAKC,IAAImsD,EAAK,GAAImY,EAAQ,KAErBnzE,IACT,CAEAszE,mBAAAA,CAAoBxB,EAAK/tD,EAAKszC,GAA2C,IAArCl4C,EAAKhgB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAG2W,EAAC3W,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAG4W,EAAC5W,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAGo0E,EAAUp0E,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EACrE,MAAM+nE,EAAWnc,EAAK2D,KACtB,IAAIyY,EACAC,EAEJ,GAAIF,IACFC,EAGED,EAAS,KAAOA,EAAS,IACzBA,EAAS,KAAOA,EAAS,IACzB5pD,EAAK8mD,GAAL1wE,MAA0BV,IAAI+3D,IAEN,IAAtBoc,IACFC,EAAe,CAAC,EAAG,EAAG,EAAG,GACzB9hE,GAAK8B,wBAAwB8/D,EAAUnc,EAAK4D,WAAYyY,GAC1C,IAAVv0D,GAAqB,IAANrJ,GAAiB,IAANC,GAC5BnE,GAAKS,YAAY,CAAC8M,EAAO,EAAG,GAAIA,EAAOrJ,EAAGC,GAAI29D,GAG5CD,IACF,OAAOzzE,KAAKqzE,WACVvB,EACA/tD,EACA2vD,EAAa,GACbA,EAAa,GACbA,EAAa,GACbA,EAAa,IAMrB,IAAKH,EAGH,OAAOvzE,KAAK2zE,mBAAmB7B,GAGjC,MAAM8B,EAAUL,IAEhB,OAAIC,GAAYE,QAAsCjoE,IAAtBgoE,IAM9BA,EACEC,EAAa,IAAM59D,EAAI89D,EAAQC,uBAC/BH,EAAa,IAAM59D,EAAI89D,EAAQE,wBAC/BJ,EAAa,IAAM39D,EAAI69D,EAAQG,yBAC/BL,EAAa,IAAM39D,EAAI69D,EAAQI,yBACjCpqD,EAAK8mD,GAAL1wE,MAA0BxB,IAAI64D,EAAMoc,GAChCA,GACKzzE,KAAKqzE,WACVvB,EACA/tD,EACA2vD,EAAa,GACbA,EAAa,GACbA,EAAa,GACbA,EAAa,IAOZ1zE,KAAKqzE,WACVvB,EACA/tD,EACAjO,EAAI89D,EAAQC,sBACZ/9D,EAAI89D,EAAQE,uBACZ/9D,EAAI69D,EAAQG,wBACZh+D,EAAI69D,EAAQI,yBAEhB,CAEAL,kBAAAA,CAAmB7B,GAMjB,OALAloD,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKiG,IAAI,EAAG+U,EAAKymD,GAALrwE,MAAc,IACjD4pB,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKiG,IAAI,EAAG+U,EAAKymD,GAALrwE,MAAc,IACjD4pB,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKC,IAAI+a,EAAK+mD,GAAL3wE,MAAmB4pB,EAAKymD,GAALrwE,MAAc,IACjE4pB,EAAK0mD,GAALtwE,MAAkB,GAAK4O,KAAKC,IAAI+a,EAAKgnD,GAAL5wE,MAAoB4pB,EAAKymD,GAALrwE,MAAc,IAE3DA,IACT,CAEAi0E,cAAAA,CAAeC,GACb,OAAOtqD,EAAKmmD,GAAL/vE,MAAak0E,EACtB,CAEAC,kBAAAA,CAAmBrC,EAAKsC,GACtB,MAAMC,EAAsBzqD,EAAK4mD,GAALxwE,MACtBs0E,EAAS1qD,EAAKmmD,GAAL/vE,MACTu0E,EAAc3qD,EAAKomD,GAALhwE,MACpB,IAAK,MAAMuN,KAAQ6mE,EACb7mE,KAAQqc,EAAKmmD,GAAL/vE,MACVq0E,EAAoBr1E,IAAIs1E,EAAO/mE,IACtBA,KAAQgnE,GACjBA,EAAYhnE,GAAMinE,QAAQH,EAAoBr1E,IAAKq1E,GAIvD,OAAOr0E,IACT,CAEAy0E,qBAAAA,CAAsB3C,EAAKvkE,GAKzB,OAJIqc,EAAKqmD,GAALjwE,MAAwBpB,IAAI2O,IAC9Bqc,EAAK4mD,GAALxwE,MAA0BhB,IAAI4qB,EAAKqmD,GAALjwE,MAAwBV,IAAIiO,IAGrDvN,IACT,CAKA00E,eAAAA,CAAgB5C,GAAuB,IAAlB6C,EAAQx1E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAG3B,GAFAa,KAAKm0E,mBAAmBrC,EAAK,CAAC1C,KAE1BxlD,EAAKmnD,GAAL/wE,MAAqB,CACvB,MAAM40E,EAAWhF,GAAoBhmD,EAAKmnD,GAAL/wE,MAAqB8xE,IACpD,aAAEjC,GAAiB+E,EACzBhrD,EAAK4mD,GAALxwE,MAA0Bw0E,QAAQ3E,EAAa7wE,IAAK6wE,GACpDjmD,EAAKsmD,GAALlwE,MAAiBw0E,QAAQ3E,EAAa7wE,IAAK6wE,GAC3CjmD,EAAKumD,GAALnwE,MAAyBw0E,QAAQ3E,EAAa7wE,IAAK6wE,GACnDA,EAAaxkD,OAAOymD,GACpB8C,EAAS9E,sBAAuB,CAClC,CAEA,GAAIlmD,EAAK2mD,GAALvwE,QAAyB8xE,EAAK,CAChC,MAAM5P,EAAOr7C,GAA8B,IAAvB+C,EAAK0mD,GAALtwE,MAAkB,GAAY4pB,EAAK+mD,GAAL3wE,OAC5CoiE,EAAOv7C,GAA8B,IAAvB+C,EAAK0mD,GAALtwE,MAAkB,GAAY4pB,EAAKgnD,GAAL5wE,OAC5CmiE,EAAOt8C,GAA6B,IAAvB+D,EAAK0mD,GAALtwE,MAAkB,GAAY4pB,EAAK+mD,GAAL3wE,OAC3CqiE,EAAOx8C,GAA6B,IAAvB+D,EAAK0mD,GAALtwE,MAAkB,GAAY4pB,EAAKgnD,GAAL5wE,OAEjDqvE,GAAWzlD,EAAKinD,GAAL7wE,MAAoB8xE,EAAK5P,EAAME,EAAMD,EAAME,GACtD,IAAK,MAAMwS,KAAUjrD,EAAK4mD,GAALxwE,MACf60E,IAAW/C,GACbzC,GAAWzlD,EAAKinD,GAAL7wE,MAAoB60E,EAAQ3S,EAAME,EAAMD,EAAME,GAG7D,IAAK,MAAMyS,KAAWlrD,EAAKsmD,GAALlwE,MAChB80E,IAAYhD,GACdzC,GAAWzlD,EAAKinD,GAAL7wE,MAAoB80E,EAAS5S,EAAME,EAAMD,EAAME,GAG9D,IAAK,MAAMyS,KAAWlrD,EAAKumD,GAALnwE,MAChB80E,IAAYhD,GACdzC,GAAWzlD,EAAKinD,GAAL7wE,MAAoB80E,EAAS5S,EAAME,EAAMD,EAAME,GAIzDsS,IACH/qD,EAAK4mD,GAALxwE,MAA0Bs/B,QAC1BpW,EAAKqnD,GAALvwE,MAAwB,GAE5B,CAEA,OAAOA,IACT,CAEA+0E,uBAAAA,CAAwBjD,GAAuB,IAAlB6C,EAAQx1E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACnC,MAAM61E,EAAOzjE,MAAMC,KAAKoY,EAAK4mD,GAALxwE,OACxBA,KAAK00E,gBAAgB5C,EAAK6C,GAC1B30E,KAAKsyE,sBAAsB,eAAgBR,GAC3C,IAAK,MAAMkB,KAAOgC,EAChBh1E,KAAKsyE,sBAAsB,eAAgBU,GAE7C,OAAOhzE,IACT,CAEAi1E,0BAAAA,CAA2BnD,GAAuB,IAAlB6C,EAAQx1E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAatC,OAZIyqB,EAAK2mD,GAALvwE,QAAyB8xE,IAC3B5oD,EAAKqnD,GAALvwE,MAAwB,GAExB4pB,EAAKymD,GAALrwE,MAAc,GAAK4O,KAAKiG,IAAI+U,EAAKymD,GAALrwE,MAAc,GAAI4pB,EAAK0mD,GAALtwE,MAAkB,IAChE4pB,EAAKymD,GAALrwE,MAAc,GAAK4O,KAAKiG,IAAI+U,EAAKymD,GAALrwE,MAAc,GAAI4pB,EAAK0mD,GAALtwE,MAAkB,IAChE4pB,EAAKymD,GAALrwE,MAAc,GAAK4O,KAAKC,IAAI+a,EAAKymD,GAALrwE,MAAc,GAAI4pB,EAAK0mD,GAALtwE,MAAkB,IAChE4pB,EAAKymD,GAALrwE,MAAc,GAAK4O,KAAKC,IAAI+a,EAAKymD,GAALrwE,MAAc,GAAI4pB,EAAK0mD,GAALtwE,MAAkB,IAE3D20E,GACH/qD,EAAK4mD,GAALxwE,MAA0Bs/B,SAGvBt/B,IACT,CAEAk1E,wBAAAA,GACE,MAAMb,EAAsBzqD,EAAK4mD,GAALxwE,MAE5B,OADAkpB,EAAKsnD,GAALxwE,KAA4B,IAAIwvB,KACzB6kD,CACT,CAEAc,iBAAAA,CAAkBrD,GAChB,MAAMsD,EAAYxrD,EAAK6mD,GAALzwE,MAAiBV,IAAIwyE,GAEvC,OADAloD,EAAK6mD,GAALzwE,MAAiBqrB,OAAOymD,GACjBsD,CACT,CAEAC,wBAAAA,CAAyBxF,GACvB,IAAK,MAAMmD,KAAOnD,EAChBjmD,EAAK4mD,GAALxwE,MAA0BhB,IAAIg0E,EAElC,CAEAsC,IAAAA,GAEE,OADA1rD,EAAK8mD,GAAL1wE,MAA0Bs/B,QACnB,IAAIowC,GAAW9lD,EAAKknD,GAAL9wE,MAAc4pB,EAAKinD,GAAL7wE,MACtC,CAEAu1E,iBAAAA,GACE,OAAO3rD,EAAKmnD,GAAL/wE,KACT,EACF,SAAAuxE,GA7coBL,EAAiBsE,GACjC,MAAM9lE,EAAS,IAAIkiD,YAA8B,EAAlBsf,GAC/BhoD,EAAK2nD,GAAL7wE,KAAqB,IAAIy1E,kBAAkB/lE,IAC3CwZ,EAAK4nD,GAAL9wE,KAAe,IAAIyP,YAAYC,IAC3B8lE,GAAaA,EAAUn3E,OAAS,GAClCurB,EAAKknD,GAAL9wE,MAAaxB,IAAIg3E,GACjB5rD,EAAKknD,GAAL9wE,MAAagG,KAAKupE,GAAYiG,EAAUn3E,SAExCurB,EAAKknD,GAAL9wE,MAAagG,KAAKupE,GAEtB,KAAAmG,GAAA,IAAA/nD,QAAAgoD,GAAA,IAAAhoD,QAAAioD,GAAA,IAAAjoD,QAAAkoD,GAAA,IAAAloD,QAAAmoD,GAAA,IAAAnoD,QA4cF,MAAMooD,GAaJvoE,WAAAA,CAAYwoE,EAAmBvE,EAAOwE,GACpC,GAZFh3E,EAAA,KAAAy2E,QAAkB,GAGlBz2E,EAAA,KAAA02E,QAAM,GAEN12E,EAAA,KAAA22E,QAAa,GAEb32E,EAAA,KAAA42E,GAAgB,GAEhB52E,EAAA,KAAA62E,GAAc,GAIVE,aAA6BD,IAC7BnsD,EAAkBgsD,GAAlBI,OAAsCC,EAKtC,OAAOD,EAGT9sD,EAAKwsD,GAAL11E,KAA0Bg2E,GAC1B9sD,EAAKysD,GAAL31E,KAAcyxE,GACdvoD,EAAK0sD,GAAL51E,OAAuBi2E,EACzB,CAEAzE,mBAAAA,GACE,MAAM,IAAIrmE,MAAM,cAClB,CAEA/F,IAAAA,CAAKqsE,GAAO,IAAAyE,EAGV,OAFAhtD,EAAK4sD,GAAL91E,MAAIk2E,EAAJtsD,EAAKksD,GAAL91E,MAAgBk2E,IAAAA,IAChBtsD,EAAK8rD,GAAL11E,MAAwBoF,KAAKwkB,EAAK+rD,GAAL31E,OACtBA,IACT,CAEAqF,OAAAA,CAAQosE,GACoB,IAAA0E,EAAtBvsD,EAAKksD,GAAL91E,MAAmB,IACrB4pB,EAAK8rD,GAAL11E,MAAwBqF,QAAQukB,EAAK+rD,GAAL31E,OAChCkpB,EAAK4sD,GAAL91E,MAAIm2E,EAAJvsD,EAAKksD,GAAL91E,MAAgBm2E,IAAAA,KAElB,OAAOn2E,IACT,CAEA6xE,gBAAAA,CAAiBC,GAAK,IAAAsE,EAEpB,OADAltD,EAAK2sD,GAAL71E,MAAIo2E,EAAJxsD,EAAKisD,GAAL71E,MAAkBo2E,IAAAA,IACXp2E,IACT,CAEA+xE,aAAAA,GACE,OAAOnoD,EAAKisD,GAAL71E,MAAqB,EACxB4pB,EAAK+rD,GAAL31E,MACA4pB,EAAK8rD,GAAL11E,MAAwB+xE,eAC9B,CAEAC,iBAAAA,CAAkBF,GAAK,IAAAuE,EAErB,OADAntD,EAAK2sD,GAAL71E,MAAIq2E,EAAJzsD,EAAKisD,GAAL71E,MAAkBq2E,IAAAA,IACXr2E,IACT,CAEA+I,kBAAAA,CAAmB0oE,GACjB,OAAOzxE,IACT,CAEAiJ,gBAAAA,CAAiBwoE,GACf,OAAOzxE,IACT,CAEAmyE,iBAAAA,CAAkBpuD,GAEhB,OADA6F,EAAK8rD,GAAL11E,MAAwBmyE,kBAAkBpuD,GACnC/jB,IACT,CAEAoyE,gBAAAA,GAEE,OADAxoD,EAAK8rD,GAAL11E,MAAwBoyE,mBACjBpyE,IACT,CAMAqyE,gBAAAA,CAAiB9kE,EAAMukE,GAErB,OADAloD,EAAK8rD,GAAL11E,MAAwBqyE,iBAAiB9kE,EAAMqc,EAAK+rD,GAAL31E,OACxCA,IACT,CAMAsyE,qBAAAA,CAAsB/kE,EAAMukE,GAE1B,OADAloD,EAAK8rD,GAAL11E,MAAwBsyE,sBAAsB/kE,EAAMqc,EAAK+rD,GAAL31E,OAC7CA,IACT,CAMAuyE,oBAAAA,CAAqBhlE,EAAMukE,GAEzB,OADAloD,EAAK8rD,GAAL11E,MAAwBuyE,qBAAqBhlE,EAAMqc,EAAK+rD,GAAL31E,OAC5CA,IACT,CAEAwyE,eAAAA,CAAgBjlE,EAAMukE,GAEpB,OAAO9xE,IACT,CAOAyyE,yBAAAA,CAA0BllE,EAAMmlE,EAASC,GAMvC,OALA/oD,EAAK8rD,GAAL11E,MAAwByyE,0BACtBllE,EACAmlE,EACA9oD,EAAK+rD,GAAL31E,OAEKA,IACT,CAGA6yE,4BAAAA,CAA6BtlE,EAAMukE,GAEjC,OADAloD,EAAK8rD,GAAL11E,MAAwB6yE,6BAA6BtlE,EAAMqc,EAAK+rD,GAAL31E,OACpDA,IACT,CAIA8yE,2CAAAA,CAA4C3jD,GAE1C,OADAvF,EAAK8rD,GAAL11E,MAAwB8yE,4CAA4C3jD,GAC7DnvB,IACT,CAEA+yE,oDAAAA,GAEE,OADAnpD,EAAK8rD,GAAL11E,MAAwB+yE,uDACjB/yE,IACT,CAEAizE,SAAAA,CAAUnB,GAIR,OAHKloD,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwBizE,UAAUrpD,EAAK+rD,GAAL31E,OAE7BA,IACT,CAEAkzE,aAAAA,CAAcpB,EAAK/tD,EAAKm+C,EAAMC,EAAMC,EAAMC,GAWxC,OAVKz4C,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwBkzE,cACtBtpD,EAAK+rD,GAAL31E,MACA+jB,EACAm+C,EACAC,EACAC,EACAC,GAGGriE,IACT,CAEAqzE,UAAAA,CAAWvB,EAAK/tD,EAAKm+C,EAAMC,EAAMC,EAAMC,GAWrC,OAVKz4C,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwBqzE,WACtBzpD,EAAK+rD,GAAL31E,MACA+jB,EACAm+C,EACAC,EACAC,EACAC,GAGGriE,IACT,CAEAszE,mBAAAA,CAAoBxB,EAAK/tD,EAAKszC,EAAMl4C,EAAOrJ,EAAGC,EAAGw9D,GAY/C,OAXK3pD,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwBszE,oBACtB1pD,EAAK+rD,GAAL31E,MACA+jB,EACAszC,EACAl4C,EACArJ,EACAC,EACAw9D,GAGGvzE,IACT,CAEA2zE,kBAAAA,CAAmB7B,GAIjB,OAHKloD,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwB2zE,mBAAmB/pD,EAAK+rD,GAAL31E,OAEtCA,IACT,CAEAi0E,cAAAA,CAAeC,GACb,OAAOtqD,EAAK8rD,GAAL11E,MAAwBi0E,eAAeC,EAChD,CAEAC,kBAAAA,CAAmBrC,EAAKsC,GAEtB,OADAxqD,EAAK8rD,GAAL11E,MAAwBm0E,mBAAmBvqD,EAAK+rD,GAAL31E,MAAao0E,GACjDp0E,IACT,CAEAy0E,qBAAAA,CAAsB3C,EAAKvkE,GAEzB,OADAqc,EAAK8rD,GAAL11E,MAAwBy0E,sBAAsB7qD,EAAK+rD,GAAL31E,MAAauN,GACpDvN,IACT,CAMA00E,eAAAA,CAAgB5C,GAEd,OADAloD,EAAK8rD,GAAL11E,MAAwB00E,gBAAgB9qD,EAAK+rD,GAAL31E,OAAa,GAC9CA,IACT,CAEA+0E,uBAAAA,CAAwBjD,GAEtB,OADAloD,EAAK8rD,GAAL11E,MAAwB+0E,wBAAwBnrD,EAAK+rD,GAAL31E,OAAa,GACtDA,IACT,CAEAi1E,0BAAAA,CAA2BnD,GAIzB,OAHKloD,EAAKgsD,GAAL51E,OACH4pB,EAAK8rD,GAAL11E,MAAwBi1E,2BAA2BrrD,EAAK+rD,GAAL31E,OAAa,GAE3DA,IACT,CAEAs1E,IAAAA,GACE,MAAM,IAAInqE,MAAM,cAClB,CAEAoqE,iBAAAA,GACE,MAAM,IAAIpqE,MAAM,cAClB,EAIF,MAAMmrE,GACI,CACN,OACA,YACA,SACA,cACA,cACA,YACA,UACA,WACA,aACA,QAXEA,GAaE,CACJ,OACA,YACA,SACA,YACA,YACA,2BACA,SApBEA,GAsBU,CACZ,YACA,QACA,SACA,YACA,cACA,4BA5BEA,GA8BS,CAAC,SAAU,YAAa,aA9BjCA,GA+BM,CACR,YACA,UACA,cACA,cACA,SACA,WACA,WACA,aACA,OACA,UACA,SACA,YACA,oBACA,QACA,YACA,cACA,2BAEA,gBAlDEA,GAoDO,CAAC,aApDRA,GAqDc,CAAC,YAAa,aCp3B5BC,GACE,OADFA,GAEI,SAFJA,GAGK,UAGX,SAASC,GAAiBzyD,EAAKi3C,GAC7B,IAAKA,EACH,OAEF,MAAMh7C,EAAQg7C,EAAK,GAAKA,EAAK,GACvB/6C,EAAS+6C,EAAK,GAAKA,EAAK,GACxByb,EAAS,IAAIruD,OACnBquD,EAAO9iE,KAAKqnD,EAAK,GAAIA,EAAK,GAAIh7C,EAAOC,GACrC8D,EAAIxd,KAAKkwE,EACX,CAEA,MAAMC,GAUJC,2BAAAA,GACE,OAAO,CACT,CAEAC,UAAAA,GACE1rE,GAAY,uCACd,EAGF,MAAM2rE,WAAkCH,GACtClpE,WAAAA,CAAYspE,GACVnpE,QACA3N,KAAKqgD,MAAQy2B,EAAG,GAChB92E,KAAK+2E,MAAQD,EAAG,GAChB92E,KAAKg3E,YAAcF,EAAG,GACtB92E,KAAKi3E,IAAMH,EAAG,GACd92E,KAAKk3E,IAAMJ,EAAG,GACd92E,KAAKm3E,IAAML,EAAG,GACd92E,KAAKo3E,IAAMN,EAAG,GACd92E,KAAKgV,OAAS,IAChB,CAEAqiE,eAAAA,CAAgBtzD,GACd,IAAIuzD,EACe,UAAft3E,KAAKqgD,MACPi3B,EAAOvzD,EAAIwzD,qBACTv3E,KAAKi3E,IAAI,GACTj3E,KAAKi3E,IAAI,GACTj3E,KAAKk3E,IAAI,GACTl3E,KAAKk3E,IAAI,IAEa,WAAfl3E,KAAKqgD,QACdi3B,EAAOvzD,EAAIyzD,qBACTx3E,KAAKi3E,IAAI,GACTj3E,KAAKi3E,IAAI,GACTj3E,KAAKm3E,IACLn3E,KAAKk3E,IAAI,GACTl3E,KAAKk3E,IAAI,GACTl3E,KAAKo3E,MAIT,IAAK,MAAMK,KAAaz3E,KAAKg3E,YAC3BM,EAAKI,aAAaD,EAAU,GAAIA,EAAU,IAE5C,OAAOH,CACT,CAEAV,UAAAA,CAAW7yD,EAAK4zD,EAAOC,EAASC,GAC9B,IAAIC,EACJ,GAAID,IAAatB,IAAmBsB,IAAatB,GAAe,CAC9D,MAAMwB,EAAYJ,EAAMK,QAAQC,0BAC9BJ,EACA/zD,GAAoBC,KACjB,CAAC,EAAG,EAAG,EAAG,GAIT/D,EAAQpR,KAAKiX,KAAKkyD,EAAU,GAAKA,EAAU,KAAO,EAClD93D,EAASrR,KAAKiX,KAAKkyD,EAAU,GAAKA,EAAU,KAAO,EAEnDG,EAAYP,EAAMQ,eAAeC,UACrC,UACAp4D,EACAC,GAGIo4D,EAASH,EAAUrkB,QACzBwkB,EAAOC,UAAU,EAAG,EAAGD,EAAO1lD,OAAO3S,MAAOq4D,EAAO1lD,OAAO1S,QAC1Do4D,EAAOE,YACPF,EAAO1kE,KAAK,EAAG,EAAG0kE,EAAO1lD,OAAO3S,MAAOq4D,EAAO1lD,OAAO1S,QAIrDo4D,EAAOp1B,WAAW80B,EAAU,IAAKA,EAAU,IAC3CH,EAAUhmE,GAAKtM,UAAUsyE,EAAS,CAChC,EACA,EACA,EACA,EACAG,EAAU,GACVA,EAAU,KAGZM,EAAO/yE,aAAaqyE,EAAMa,eACtBx4E,KAAKgV,QACPqjE,EAAO/yE,aAAatF,KAAKgV,QAE3BwhE,GAAiB6B,EAAQr4E,KAAK+2E,OAE9BsB,EAAOI,UAAYz4E,KAAKq3E,gBAAgBgB,GACxCA,EAAOryE,OAEP8xE,EAAU/zD,EAAI20D,cAAcR,EAAUvlD,OAAQ,aAC9C,MAAMgmD,EAAY,IAAIC,UAAUhB,GAChCE,EAAQe,aAAaF,EACvB,MAIEnC,GAAiBzyD,EAAK/jB,KAAK+2E,OAC3Be,EAAU93E,KAAKq3E,gBAAgBtzD,GAEjC,OAAO+zD,CACT,EAGF,SAASgB,GAAa5wD,EAAM2rC,EAAS5gD,EAAI8lE,EAAIC,EAAIC,EAAIC,EAAIC,GAEvD,MAAMpZ,EAASlM,EAAQkM,OACrBlpC,EAASg9B,EAAQh9B,OACbxoB,EAAQ6Z,EAAKA,KACjBkxD,EAAuB,EAAblxD,EAAKlI,MACjB,IAAIq5D,EACAtZ,EAAO9sD,EAAK,GAAK8sD,EAAOgZ,EAAK,KAC/BM,EAAMpmE,EACNA,EAAK8lE,EACLA,EAAKM,EACLA,EAAMJ,EACNA,EAAKC,EACLA,EAAKG,GAEHtZ,EAAOgZ,EAAK,GAAKhZ,EAAOiZ,EAAK,KAC/BK,EAAMN,EACNA,EAAKC,EACLA,EAAKK,EACLA,EAAMH,EACNA,EAAKC,EACLA,EAAKE,GAEHtZ,EAAO9sD,EAAK,GAAK8sD,EAAOgZ,EAAK,KAC/BM,EAAMpmE,EACNA,EAAK8lE,EACLA,EAAKM,EACLA,EAAMJ,EACNA,EAAKC,EACLA,EAAKG,GAEP,MAAMljE,GAAM4pD,EAAO9sD,GAAM4gD,EAAQx0C,SAAWw0C,EAAQylB,OAC9CljE,GAAM2pD,EAAO9sD,EAAK,GAAK4gD,EAAQv0C,SAAWu0C,EAAQ0lB,OAClDjjE,GAAMypD,EAAOgZ,GAAMllB,EAAQx0C,SAAWw0C,EAAQylB,OAC9C/iE,GAAMwpD,EAAOgZ,EAAK,GAAKllB,EAAQv0C,SAAWu0C,EAAQ0lB,OAClD/iE,GAAMupD,EAAOiZ,GAAMnlB,EAAQx0C,SAAWw0C,EAAQylB,OAC9C7iE,GAAMspD,EAAOiZ,EAAK,GAAKnlB,EAAQv0C,SAAWu0C,EAAQ0lB,OACxD,GAAInjE,GAAMK,EACR,OAEF,MAAM+iE,EAAM3iD,EAAOoiD,GACjBQ,EAAM5iD,EAAOoiD,EAAK,GAClBS,EAAM7iD,EAAOoiD,EAAK,GACdU,EAAM9iD,EAAOqiD,GACjBU,EAAM/iD,EAAOqiD,EAAK,GAClBW,EAAMhjD,EAAOqiD,EAAK,GACdY,EAAMjjD,EAAOsiD,GACjBY,EAAMljD,EAAOsiD,EAAK,GAClBa,EAAMnjD,EAAOsiD,EAAK,GAEd/W,EAAOxzD,KAAK21C,MAAMnuC,GACtBisD,EAAOzzD,KAAK21C,MAAM9tC,GACpB,IAAIwjE,EAAIC,EAAKC,EAAKC,EACdC,EAAIC,EAAKC,EAAKC,EAClB,IAAK,IAAIzkE,EAAIqsD,EAAMrsD,GAAKssD,EAAMtsD,IAAK,CACjC,GAAIA,EAAIQ,EAAI,CACV,MAAM81D,EAAIt2D,EAAIK,EAAK,GAAKA,EAAKL,IAAMK,EAAKG,GACxC0jE,EAAK9jE,GAAMA,EAAKG,GAAM+1D,EACtB6N,EAAMV,GAAOA,EAAMG,GAAOtN,EAC1B8N,EAAMV,GAAOA,EAAMG,GAAOvN,EAC1B+N,EAAMV,GAAOA,EAAMG,GAAOxN,CAC5B,KAAO,CACL,IAAIA,EAEFA,EADEt2D,EAAIU,EACF,EACKF,IAAOE,EACZ,GAECF,EAAKR,IAAMQ,EAAKE,GAEvBwjE,EAAK3jE,GAAMA,EAAKE,GAAM61D,EACtB6N,EAAMP,GAAOA,EAAMG,GAAOzN,EAC1B8N,EAAMP,GAAOA,EAAMG,GAAO1N,EAC1B+N,EAAMP,GAAOA,EAAMG,GAAO3N,CAC5B,CAEA,IAAIA,EAEFA,EADEt2D,EAAIK,EACF,EACKL,EAAIU,EACT,GAECL,EAAKL,IAAMK,EAAKK,GAEvB4jE,EAAKlkE,GAAMA,EAAKK,GAAM61D,EACtBiO,EAAMd,GAAOA,EAAMM,GAAOzN,EAC1BkO,EAAMd,GAAOA,EAAMM,GAAO1N,EAC1BmO,EAAMd,GAAOA,EAAMM,GAAO3N,EAC1B,MAAMoO,EAAM7rE,KAAK21C,MAAM31C,KAAKC,IAAIorE,EAAII,IAC9BK,EAAM9rE,KAAK21C,MAAM31C,KAAKiG,IAAIolE,EAAII,IACpC,IAAI/N,EAAI8M,EAAUrjE,EAAU,EAAN0kE,EACtB,IAAK,IAAI3kE,EAAI2kE,EAAK3kE,GAAK4kE,EAAK5kE,IAC1Bu2D,GAAK4N,EAAKnkE,IAAMmkE,EAAKI,GACjBhO,EAAI,EACNA,EAAI,EACKA,EAAI,IACbA,EAAI,GAENh+D,EAAMi+D,KAAQ4N,GAAOA,EAAMI,GAAOjO,EAAK,EACvCh+D,EAAMi+D,KAAQ6N,GAAOA,EAAMI,GAAOlO,EAAK,EACvCh+D,EAAMi+D,KAAQ8N,GAAOA,EAAMI,GAAOnO,EAAK,EACvCh+D,EAAMi+D,KAAO,GAEjB,CACF,CAEA,SAASqO,GAAWzyD,EAAMs4C,EAAQ3M,GAChC,MAAM+mB,EAAKpa,EAAOT,OACZ8a,EAAKra,EAAO3pC,OAClB,IAAInoB,EAAGuS,EACP,OAAQu/C,EAAOhgE,MACb,KAAKiC,EACH,MAAMg+D,EAAiBD,EAAOC,eACxBqa,EAAOlsE,KAAKiY,MAAM+zD,EAAGv8E,OAASoiE,GAAkB,EAChDsa,EAAOta,EAAiB,EAC9B,IAAK/xD,EAAI,EAAGA,EAAIosE,EAAMpsE,IAAK,CACzB,IAAIssE,EAAItsE,EAAI+xD,EACZ,IAAK,IAAI6L,EAAI,EAAGA,EAAIyO,EAAMzO,IAAK0O,IAC7BlC,GACE5wD,EACA2rC,EACA+mB,EAAGI,GACHJ,EAAGI,EAAI,GACPJ,EAAGI,EAAIva,GACPoa,EAAGG,GACHH,EAAGG,EAAI,GACPH,EAAGG,EAAIva,IAETqY,GACE5wD,EACA2rC,EACA+mB,EAAGI,EAAIva,EAAiB,GACxBma,EAAGI,EAAI,GACPJ,EAAGI,EAAIva,GACPoa,EAAGG,EAAIva,EAAiB,GACxBoa,EAAGG,EAAI,GACPH,EAAGG,EAAIva,GAGb,CACA,MACF,KAAKh+D,EACH,IAAKiM,EAAI,EAAGuS,EAAK25D,EAAGv8E,OAAQqQ,EAAIuS,EAAIvS,GAAK,EACvCoqE,GACE5wD,EACA2rC,EACA+mB,EAAGlsE,GACHksE,EAAGlsE,EAAI,GACPksE,EAAGlsE,EAAI,GACPmsE,EAAGnsE,GACHmsE,EAAGnsE,EAAI,GACPmsE,EAAGnsE,EAAI,IAGX,MACF,QACE,MAAM,IAAIvD,MAAM,kBAEtB,CAEA,MAAM8vE,WAA2BvE,GAC/BlpE,WAAAA,CAAYspE,GACVnpE,QACA3N,KAAKyvE,QAAUqH,EAAG,GAClB92E,KAAK42B,QAAUkgD,EAAG,GAClB92E,KAAKk7E,SAAWpE,EAAG,GACnB92E,KAAKm7E,QAAUrE,EAAG,GAClB92E,KAAK+2E,MAAQD,EAAG,GAChB92E,KAAKo7E,YAActE,EAAG,GACtB92E,KAAKgV,OAAS,IAChB,CAEAqmE,iBAAAA,CAAkBC,EAAehkC,EAAiB6gC,GAGhD,MAOM94D,EAAUzQ,KAAKiY,MAAM7mB,KAAKm7E,QAAQ,IAClC77D,EAAU1Q,KAAKiY,MAAM7mB,KAAKm7E,QAAQ,IAClCI,EAAc3sE,KAAKiX,KAAK7lB,KAAKm7E,QAAQ,IAAM97D,EAC3Cm8D,EAAe5sE,KAAKiX,KAAK7lB,KAAKm7E,QAAQ,IAAM77D,EAE5CU,EAAQpR,KAAKC,IACjBD,KAAKiX,KAAKjX,KAAKmI,IAAIwkE,EAAcD,EAAc,GAb1B,MAEE,KAcnBr7D,EAASrR,KAAKC,IAClBD,KAAKiX,KAAKjX,KAAKmI,IAAIykE,EAAeF,EAAc,GAjB3B,MAEE,KAkBnBhC,EAASiC,EAAcv7D,EACvBu5D,EAASiC,EAAev7D,EAExB4zC,EAAU,CACdkM,OAAQ//D,KAAKyvE,QACb54C,OAAQ72B,KAAK42B,QACbvX,SAAUA,EACVC,SAAUA,EACVg6D,OAAQ,EAAIA,EACZC,OAAQ,EAAIA,GAGRkC,EAAcz7D,EAAQ07D,EACtBC,EAAe17D,EAASy7D,EAExBxD,EAAYC,EAAeC,UAC/B,OACAqD,EACAE,GAEItD,EAASH,EAAUrkB,QAEnB3rC,EAAOmwD,EAAOuD,gBAAgB57D,EAAOC,GAC3C,GAAIq3B,EAAiB,CACnB,MAAMjpC,EAAQ6Z,EAAKA,KACnB,IAAK,IAAIxZ,EAAI,EAAGuS,EAAK5S,EAAMhQ,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC9CL,EAAMK,GAAK4oC,EAAgB,GAC3BjpC,EAAMK,EAAI,GAAK4oC,EAAgB,GAC/BjpC,EAAMK,EAAI,GAAK4oC,EAAgB,GAC/BjpC,EAAMK,EAAI,GAAK,GAEnB,CACA,IAAK,MAAM8xD,KAAUxgE,KAAKk7E,SACxBP,GAAWzyD,EAAMs4C,EAAQ3M,GAE3BwkB,EAAOwD,aAAa3zD,EAlDA,KAqDpB,MAAO,CACLyK,OAHaulD,EAAUvlD,OAIvBtT,QAASA,EAvDS,EAuDei6D,EACjCh6D,QAASA,EAxDS,EAwDei6D,EACjCD,SACAC,SAEJ,CAEA5C,2BAAAA,GACE,OAAO,CACT,CAEAC,UAAAA,CAAW7yD,EAAK4zD,EAAOC,EAASC,GAC9BrB,GAAiBzyD,EAAK/jB,KAAK+2E,OAC3B,MAAM53D,EAAQ,IAAIiiD,aAAa,GAC/B,GAAIyW,IAAatB,GACf3kE,GAAKmD,8BAA8B+O,GAAoBC,GAAM5E,QACxD,GAAInf,KAAKgV,OAAQ,CAEtBpD,GAAKmD,8BAA8B/U,KAAKgV,OAAQmK,GAChD,MAAO28D,EAAcC,GAAgB58D,EACrCvN,GAAKmD,8BAA8B4iE,EAAMa,cAAer5D,GACxDA,EAAM,IAAM28D,EACZ38D,EAAM,IAAM48D,CACd,MACEnqE,GAAKmD,8BAA8B4iE,EAAMa,cAAer5D,GAK1D,MAAM68D,EAAyBh8E,KAAKq7E,kBAClCl8D,EACA04D,IAAatB,GAAmB,KAAOv2E,KAAKo7E,YAC5CzD,EAAMQ,gBAgBR,OAbIN,IAAatB,KACfxyD,EAAI80D,gBAAgBlB,EAAMa,eACtBx4E,KAAKgV,QACP+O,EAAIze,aAAatF,KAAKgV,SAI1B+O,EAAIk/B,UACF+4B,EAAuB38D,QACvB28D,EAAuB18D,SAEzByE,EAAI5E,MAAM68D,EAAuB1C,OAAQ0C,EAAuBzC,QAEzDx1D,EAAI20D,cAAcsD,EAAuBrpD,OAAQ,YAC1D,EAGF,MAAMspD,WAA4BvF,GAChCE,UAAAA,GACE,MAAO,SACT,EAeF,MAAMsF,GACK,EADLA,GAEO,EAGb,MAAMC,GAIJ3uE,WAAAA,CAAYspE,EAAI/yD,EAAKq4D,EAAuB5D,GAC1Cx4E,KAAK2jB,MAAQmzD,EAAG,GAChB92E,KAAKq8E,aAAevF,EAAG,GACvB92E,KAAKgV,OAAS8hE,EAAG,GACjB92E,KAAKg7D,KAAO8b,EAAG,GACf92E,KAAKs8E,MAAQxF,EAAG,GAChB92E,KAAKu8E,MAAQzF,EAAG,GAChB92E,KAAKw8E,UAAY1F,EAAG,GACpB92E,KAAKy8E,WAAa3F,EAAG,GACrB92E,KAAK+jB,IAAMA,EACX/jB,KAAKo8E,sBAAwBA,EAC7Bp8E,KAAKw4E,cAAgBA,CACvB,CAEAkE,mBAAAA,CAAoB/E,EAAOlG,GAAO,IAAAkL,EAAAC,EAChC,MAAM,KACJ5hB,EAAI,aACJqhB,EAAY,UACZG,EAAS,WACTC,EAAU,MACV94D,EAAK,sBACLy4D,GACEp8E,KACJ,IAAI,MAAEs8E,EAAK,MAAEC,GAAUv8E,KACvBs8E,EAAQ1tE,KAAKmI,IAAIulE,GACjBC,EAAQ3tE,KAAKmI,IAAIwlE,GAEjB1xE,GAAK,eAAiB4xE,GAoBtB,MAAMxmE,EAAK+kD,EAAK,GACd9kD,EAAK8kD,EAAK,GACV7kD,EAAK6kD,EAAK,GACV5kD,EAAK4kD,EAAK,GACNh7C,EAAQ7J,EAAKF,EACbgK,EAAS7J,EAAKF,EAGdiJ,EAAQ,IAAIiiD,aAAa,GAC/BxvD,GAAKmD,8BAA8B/U,KAAKgV,OAAQmK,GAChD,MAAO28D,EAAcC,GAAgB58D,EACrCvN,GAAKmD,8BAA8B/U,KAAKw4E,cAAer5D,GACvD,MAAM09D,EAAiBf,EAAe38D,EAAM,GACtC29D,EAAiBf,EAAe58D,EAAM,GAE5C,IAAI49D,EAAc/8D,EAChBg9D,EAAe/8D,EACfg9D,GAAqB,EACrBC,GAAmB,EAErB,MAAMC,EAAcvuE,KAAKiX,KAAKy2D,EAAQO,GAChCO,EAAcxuE,KAAKiX,KAAK02D,EAAQO,GAIlCK,GAHiBvuE,KAAKiX,KAAK7F,EAAQ68D,GAIrCE,EAAcT,EAEdW,GAAqB,EAEnBG,GAPkBxuE,KAAKiX,KAAK5F,EAAS68D,GAQvCE,EAAeT,EAEfW,GAAmB,EAMrB,MAAMG,EAAOr9E,KAAKs9E,gBAChBP,EACA/8E,KAAK+jB,IAAI4O,OAAO3S,MAChB68D,GAEIU,EAAOv9E,KAAKs9E,gBAChBN,EACAh9E,KAAK+jB,IAAI4O,OAAO1S,OAChB68D,GAGI5E,EAAYP,EAAMQ,eAAeC,UACrC,UACAiF,EAAK5sD,KACL8sD,EAAK9sD,MAED4nD,EAASH,EAAUrkB,QACnB2pB,EAAWpB,EAAsBqB,qBAAqBpF,EAAQ5G,GAoCpE,GAnCA+L,EAASE,WAAa/F,EAAM+F,WAE5B19E,KAAK29E,+BAA+BH,EAAUhB,EAAW74D,GAEzD00D,EAAOp1B,WAAWo6B,EAAKl+D,MAAQlJ,GAAKsnE,EAAKp+D,MAAQjJ,GACjDsnE,EAASl4E,UAKP,EACA+3E,EAAKl+D,MACL,EACA,EACAo+D,EAAKp+D,MACL,EACA,GAKFk5D,EAAOjzE,OACmB,QAA1Bu3E,EAAAa,EAASxH,yBAAiB,IAAA2G,GAA1BA,EAA4Bv3E,OAE5BpF,KAAK49E,SAASJ,EAAUvnE,EAAIC,EAAIC,EAAIC,GAEpConE,EAAShF,cAAgB10D,GAAoB05D,EAASz5D,KAEtDy5D,EAASK,oBAAoBxB,GAE7BmB,EAASM,aAEiB,QAA1BlB,EAAAY,EAASxH,yBAAiB,IAAA4G,GAA1BA,EAA4Bv3E,UAC5BgzE,EAAOhzE,UAEH43E,GAAsBC,EAAkB,CAQ1C,MAAMxrD,EAAQwmD,EAAUvlD,OACpBsqD,IACFF,EAAcT,GAEZY,IACFF,EAAeT,GAGjB,MAAMwB,EAAQ/9E,KAAKs9E,gBACjBP,EACA/8E,KAAK+jB,IAAI4O,OAAO3S,MAChB68D,GAEImB,EAAQh+E,KAAKs9E,gBACjBN,EACAh9E,KAAK+jB,IAAI4O,OAAO1S,OAChB68D,GAGImB,EAAQF,EAAMttD,KACdytD,EAAQF,EAAMvtD,KACd0tD,EAAaxG,EAAMQ,eAAeC,UACtC,qBACA6F,EACAC,GAEIE,EAAUD,EAAWtqB,QACrB5yC,EAAKg8D,EAAqBruE,KAAKiY,MAAM7G,EAAQs8D,GAAS,EACtD+B,EAAKnB,EAAmBtuE,KAAKiY,MAAM5G,EAASs8D,GAAS,EAG3D,IAAK,IAAI7tE,EAAI,EAAGA,GAAKuS,EAAIvS,IACvB,IAAK,IAAI49D,EAAI,EAAGA,GAAK+R,EAAI/R,IACvB8R,EAAQtsD,UACNJ,EACAusD,EAAQvvE,EACRwvE,EAAQ5R,EACR2R,EACAC,EACA,EACA,EACAD,EACAC,GAIN,MAAO,CACLvrD,OAAQwrD,EAAWxrD,OACnB2mD,OAAQyE,EAAM5+D,MACdo6D,OAAQyE,EAAM7+D,MACdE,QAASpJ,EACTqJ,QAASpJ,EAEb,CAEA,MAAO,CACLyc,OAAQulD,EAAUvlD,OAClB2mD,OAAQ+D,EAAKl+D,MACbo6D,OAAQgE,EAAKp+D,MACbE,QAASpJ,EACTqJ,QAASpJ,EAEb,CAEAonE,eAAAA,CAAgBrR,EAAMqS,EAAgBn/D,GAKpC,MAAM6V,EAAUpmB,KAAKiG,IAAIsnE,GAAcoC,iBAAkBD,GACzD,IAAI7tD,EAAO7hB,KAAKiX,KAAKomD,EAAO9sD,GAM5B,OALIsR,GAAQuE,EACVvE,EAAOuE,EAEP7V,EAAQsR,EAAOw7C,EAEV,CAAE9sD,QAAOsR,OAClB,CAEAmtD,QAAAA,CAASJ,EAAUvnE,EAAIC,EAAIC,EAAIC,GAC7B,MAAMooE,EAAYroE,EAAKF,EACjBwoE,EAAaroE,EAAKF,EACxBsnE,EAASz5D,IAAIpQ,KAAKsC,EAAIC,EAAIsoE,EAAWC,GACrC7sE,GAAK8B,wBACH,CAACuC,EAAIC,EAAIC,EAAIC,GACb0N,GAAoB05D,EAASz5D,KAC7By5D,EAASxF,QAAQ1lE,QAEnBkrE,EAASj3E,OACTi3E,EAASl3E,SACX,CAEAq3E,8BAAAA,CAA+BH,EAAUhB,EAAW74D,GAClD,MAAMkwC,EAAU2pB,EAASz5D,IACvBi0D,EAAUwF,EAASxF,QACrB,OAAQwE,GACN,KAAKN,GACH,MAAM,UAAEzD,EAAS,YAAEiG,GAAgB1+E,KAAK+jB,IACxC8vC,EAAQ4kB,UAAYT,EAAQ2G,UAAYlG,EACxC5kB,EAAQ6qB,YAAc1G,EAAQ4G,YAAcF,EAC5C,MACF,KAAKxC,GACHroB,EAAQ4kB,UAAY5kB,EAAQ6qB,YAAc/6D,EAE1Cq0D,EAAQ2G,UAAY3G,EAAQ4G,YAAcj7D,EAC1C,MACF,QACE,MAAM,IAAIzV,GAAY,2BAADlD,OAA4BwxE,IAEvD,CAEA7F,2BAAAA,GACE,OAAO,CACT,CAEAC,UAAAA,CAAW7yD,EAAK4zD,EAAOC,EAASC,EAAUpG,GAExC,IAAIz8D,EAAS4iE,EACTC,IAAatB,KACfvhE,EAASpD,GAAKtM,UAAU0P,EAAQ2iE,EAAMa,eAClCx4E,KAAKgV,SACPA,EAASpD,GAAKtM,UAAU0P,EAAQhV,KAAKgV,UAIzC,MAAMgnE,EAAyBh8E,KAAK08E,oBAAoB/E,EAAOlG,GAE/D,IAAIkH,EAAY,IAAIC,UAAU5jE,GAG9B2jE,EAAYA,EAAU11B,UACpB+4B,EAAuB38D,QACvB28D,EAAuB18D,SAEzBq5D,EAAYA,EAAUx5D,MACpB,EAAI68D,EAAuB1C,OAC3B,EAAI0C,EAAuBzC,QAG7B,MAAMzB,EAAU/zD,EAAI20D,cAAcsD,EAAuBrpD,OAAQ,UAGjE,OAFAmlD,EAAQe,aAAaF,GAEdb,CACT,EC9tBF,SAAS+G,GAA0BC,GAQhC,IARiC,IAClCltD,EAAG,OACHmtD,EAAS,EAAC,KACVlc,EAAI,MACJ7iD,EAAK,OACLC,EAAM,cACN++D,EAAgB,WAAU,cAC1BC,GAAgB,GACjBH,EACC,MAAM1kB,EAAQ9qD,GAAYC,eAAiB,WAAa,KACjD2vE,EAAaC,GAAcF,EAC9B,CAACD,EAAe5kB,GAChB,CAACA,EAAO4kB,GACNI,EAAgBp/D,GAAS,EACzBq/D,EAAyB,EAARr/D,EACjBs/D,EAAY1tD,EAAIvzB,OACtBwkE,EAAO,IAAIpzD,YAAYozD,EAAKnzD,QAC5B,IAAI6vE,EAAU,EAEd,IAAK,IAAI7wE,EAAI,EAAGA,EAAIuR,EAAQvR,IAAK,CAC/B,IAAK,MAAMmG,EAAMkqE,EAASK,EAAeL,EAASlqE,EAAKkqE,IAAU,CAC/D,MAAMS,EAAOT,EAASO,EAAY1tD,EAAImtD,GAAU,IAChDlc,EAAK0c,KAAoB,IAAPC,EAAoBL,EAAaD,EACnDrc,EAAK0c,KAAoB,GAAPC,EAAmBL,EAAaD,EAClDrc,EAAK0c,KAAoB,GAAPC,EAAkBL,EAAaD,EACjDrc,EAAK0c,KAAoB,GAAPC,EAAiBL,EAAaD,EAChDrc,EAAK0c,KAAoB,EAAPC,EAAgBL,EAAaD,EAC/Crc,EAAK0c,KAAoB,EAAPC,EAAeL,EAAaD,EAC9Crc,EAAK0c,KAAoB,EAAPC,EAAcL,EAAaD,EAC7Crc,EAAK0c,KAAoB,EAAPC,EAAaL,EAAaD,CAC9C,CACA,GAAuB,IAAnBG,EACF,SAEF,MAAMG,EAAOT,EAASO,EAAY1tD,EAAImtD,KAAY,IAClD,IAAK,IAAIzS,EAAI,EAAGA,EAAI+S,EAAgB/S,IAClCzJ,EAAK0c,KAAaC,EAAQ,GAAM,EAAIlT,EAAM6S,EAAaD,CAE3D,CACA,MAAO,CAAEH,SAAQQ,UACnB,EDurBA1gE,EAAAA,EAAAA,GAvSMs9D,GAAa,mBAES,KEta5B,MAUMsD,GAAoB,GAIpBC,GAAe,IAAI9G,UAGnB+G,GAAK,IAAIve,aAAa,GAGtBwe,GAAe,IAAIxe,aAAa,CACpC97C,IACAA,KACCA,KACAA,MAqIH,MAAMu6D,GACJryE,WAAAA,CAAYsyE,GACV9/E,KAAK8/E,cAAgBA,EACrB9/E,KAAK+/E,MAAQzhF,OAAOwa,OAAO,KAC7B,CAEAs/D,SAAAA,CAAU3+D,EAAIuG,EAAOC,GACnB,IAAI+/D,EAQJ,YAPuBv0E,IAAnBzL,KAAK+/E,MAAMtmE,IACbumE,EAAchgF,KAAK+/E,MAAMtmE,GACzBzZ,KAAK8/E,cAAclY,MAAMoY,EAAahgE,EAAOC,KAE7C+/D,EAAchgF,KAAK8/E,cAAchnE,OAAOkH,EAAOC,GAC/CjgB,KAAK+/E,MAAMtmE,GAAMumE,GAEZA,CACT,CAEA30D,OAAO5R,UACEzZ,KAAK+/E,MAAMtmE,EACpB,CAEA6lB,KAAAA,GACE,IAAK,MAAM7lB,KAAMzZ,KAAK+/E,MAAO,CAC3B,MAAMC,EAAchgF,KAAK+/E,MAAMtmE,GAC/BzZ,KAAK8/E,cAAc3yD,QAAQ6yD,UACpBhgF,KAAK+/E,MAAMtmE,EACpB,CACF,EAGF,SAASwmE,GACPl8D,EACAm8D,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,MAAO3hF,EAAGgT,EAAGG,EAAGC,EAAGu9B,EAAIC,GAAM7rB,GAAoBC,GACjD,GAAU,IAANhS,GAAiB,IAANG,EAAS,CAWtB,MAAMyuE,EAAMJ,EAAQxhF,EAAI2wC,EAClBkxC,EAAOhyE,KAAK21C,MAAMo8B,GAClBE,EAAML,EAAQruE,EAAIw9B,EAClBmxC,EAAOlyE,KAAK21C,MAAMs8B,GAClBE,GAAOR,EAAQE,GAAS1hF,EAAI2wC,EAI5BsxC,EAASpyE,KAAKmI,IAAInI,KAAK21C,MAAMw8B,GAAOH,IAAS,EAC7CK,GAAOT,EAAQE,GAASvuE,EAAIw9B,EAC5BuxC,EAAUtyE,KAAKmI,IAAInI,KAAK21C,MAAM08B,GAAOH,IAAS,EASpD,OAJA/8D,EAAI80D,aAAajqE,KAAKuyE,KAAKpiF,GAAI,EAAG,EAAG6P,KAAKuyE,KAAKhvE,GAAIyuE,EAAME,GACzD/8D,EAAI+N,UAAUouD,EAAQC,EAAMC,EAAMC,EAAMC,EAAM,EAAG,EAAGU,EAAQE,GAC5Dn9D,EAAI80D,aAAa95E,EAAGgT,EAAGG,EAAGC,EAAGu9B,EAAIC,GAE1B,CAACqxC,EAAQE,EAClB,CAEA,GAAU,IAANniF,GAAiB,IAANoT,EAAS,CAEtB,MAAMwuE,EAAMH,EAAQtuE,EAAIw9B,EAClBkxC,EAAOhyE,KAAK21C,MAAMo8B,GAClBE,EAAMN,EAAQxuE,EAAI49B,EAClBmxC,EAAOlyE,KAAK21C,MAAMs8B,GAClBE,GAAOP,EAAQE,GAASxuE,EAAIw9B,EAC5BsxC,EAASpyE,KAAKmI,IAAInI,KAAK21C,MAAMw8B,GAAOH,IAAS,EAC7CK,GAAOV,EAAQE,GAAS1uE,EAAI49B,EAC5BuxC,EAAUtyE,KAAKmI,IAAInI,KAAK21C,MAAM08B,GAAOH,IAAS,EAMpD,OAJA/8D,EAAI80D,aAAa,EAAGjqE,KAAKuyE,KAAKpvE,GAAInD,KAAKuyE,KAAKjvE,GAAI,EAAG0uE,EAAME,GACzD/8D,EAAI+N,UAAUouD,EAAQC,EAAMC,EAAMC,EAAMC,EAAM,EAAG,EAAGY,EAASF,GAC7Dj9D,EAAI80D,aAAa95E,EAAGgT,EAAGG,EAAGC,EAAGu9B,EAAIC,GAE1B,CAACuxC,EAASF,EACnB,CAGAj9D,EAAI+N,UAAUouD,EAAQC,EAAMC,EAAMC,EAAMC,EAAMC,EAAOC,EAAOC,EAAOC,GAInE,MAAO,CAFQ9xE,KAAKwuC,MAAMr+C,EAAGgT,GAEZ0uE,EADF7xE,KAAKwuC,MAAMlrC,EAAGC,GACIuuE,EACnC,CAEA,MAAMU,GAyDJ5zE,WAAAA,CAAYwS,EAAOC,EAAQohE,IAASxiE,EAAAA,EAAAA,GAAA,qBAvDrB,IAAKA,EAAAA,EAAAA,GAAA,gBAET,IAACA,EAAAA,EAAAA,GAAA,qBAEI,IAACA,EAAAA,EAAAA,GAAA,kBAEJ,OAAIA,EAAAA,EAAAA,GAAA,uBAEC,IAACA,EAAAA,EAAAA,GAAA,kBAENpe,IAAoBoe,EAAAA,EAAAA,GAAA,eAEvB,IAACA,EAAAA,EAAAA,GAAA,SAGP,IAACA,EAAAA,EAAAA,GAAA,SAED,IAACA,EAAAA,EAAAA,GAAA,aAGG,IAACA,EAAAA,EAAAA,GAAA,aAED,IAACA,EAAAA,EAAAA,GAAA,mBAGK,IAACA,EAAAA,EAAAA,GAAA,mBAED,IAACA,EAAAA,EAAAA,GAAA,kBAEF,IAACA,EAAAA,EAAAA,GAAA,yBAEMnc,IAAsBmc,EAAAA,EAAAA,GAAA,gBAE/B,IAACA,EAAAA,EAAAA,GAAA,iBAGA,YAASA,EAAAA,EAAAA,GAAA,mBAEP,YAASA,EAAAA,EAAAA,GAAA,oBAET,IAAKA,EAAAA,EAAAA,GAAA,sBAEH,IAAKA,EAAAA,EAAAA,GAAA,iBAGT,IAACA,EAAAA,EAAAA,GAAA,mBAEC,IAACA,EAAAA,EAAAA,GAAA,iBAEH,IAACA,EAAAA,EAAAA,GAAA,mBAEC,OAAIA,EAAAA,EAAAA,GAAA,oBAEH,QAGN,OAAPwiE,QAAO,IAAPA,GAAAA,EAAUrhF,MAEVA,KAAKmzE,QAAU,IAAI/R,aAAa,CAAC,EAAG,EAAGphD,EAAOC,IAC9CjgB,KAAKsS,OAASstE,GAAavqE,OAC7B,CAEAmL,KAAAA,GACE,MAAMA,EAAQliB,OAAOwa,OAAO9Y,MAG5B,OAFAwgB,EAAM2yD,QAAUnzE,KAAKmzE,QAAQ99D,QAC7BmL,EAAMlO,OAAStS,KAAKsS,OAAO+C,QACpBmL,CACT,CAEA8gE,kBAAAA,GAA+D,IAA5CzJ,EAAQ14E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGo3E,GAAejxE,EAASnG,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACvD,MAAMyvB,EAAM5uB,KAAKsS,OAAO+C,QACxB,GAAIwiE,IAAatB,GAAiB,CAC3BjxE,GACH4F,GAAY,+CAId0G,GAAKmD,8BAA8BzP,EAAWq6E,IAC9C,MAAM4B,EAAc5B,GAAG,GAAK3/E,KAAKwhF,UAAa,EACxCC,EAAc9B,GAAG,GAAK3/E,KAAKwhF,UAAa,EAC9C5yD,EAAI,IAAM2yD,EACV3yD,EAAI,IAAM6yD,EACV7yD,EAAI,IAAM2yD,EACV3yD,EAAI,IAAM6yD,CACZ,CACA,OAAO7yD,CACT,CAEA8yD,kBAAAA,GACE,MAAMpsE,EAAY1D,GAAK0D,UAAUtV,KAAKmzE,QAASnzE,KAAKshF,sBACpDthF,KAAK2hF,uBAAuBrsE,GAAa,CAAC,EAAG,EAAG,EAAG,GACrD,CAEAssE,WAAAA,GACE,OAAO5hF,KAAKsS,OAAO,KAAOgT,GAC5B,CAEAq8D,sBAAAA,CAAuB/yD,GACrB5uB,KAAKmzE,QAAQ30E,IAAIowB,EAAK,GACtB5uB,KAAKsS,OAAO9T,IAAIohF,GAAc,EAChC,CAEA3H,yBAAAA,GAAsE,IAA5CJ,EAAQ14E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGo3E,GAAejxE,EAASnG,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC9D,OAAOyS,GAAK0D,UACVtV,KAAKmzE,QACLnzE,KAAKshF,mBAAmBzJ,EAAUvyE,GAEtC,EAGF,SAASu8E,GAAmB99D,EAAK+9D,GAC/B,GAAIA,aAAmBC,UAErB,YADAh+D,EAAI83D,aAAaiG,EAAS,EAAG,GAe/B,MAAM7hE,EAAS6hE,EAAQ7hE,OACrBD,EAAQ8hE,EAAQ9hE,MACZgiE,EAAqB/hE,EAASw/D,GAC9BwC,GAAchiE,EAAS+hE,GAAsBvC,GAC7CyC,EAAqC,IAAvBF,EAA2BC,EAAaA,EAAa,EAEnEE,EAAep+D,EAAI63D,gBAAgB57D,EAAOy/D,IAChD,IACEF,EADER,EAAS,EAEb,MAAMntD,EAAMkwD,EAAQ55D,KACd26C,EAAOsf,EAAaj6D,KAC1B,IAAIxZ,EAAG49D,EAAG8V,EAAiBC,EAI3B,GAAIP,EAAQhiB,OAASn9D,GAAUC,eAAgB,CAE7C,MAAM08E,EAAY1tD,EAAIkgC,WAChBwwB,EAAS,IAAI7yE,YAAYozD,EAAKnzD,OAAQ,EAAGmzD,EAAK/Q,YAAc,GAC5DywB,EAAmBD,EAAOjkF,OAC1BmkF,EAAexiE,EAAQ,GAAM,EAC7ByiE,EAAQ,WACRroB,EAAQ9qD,GAAYC,eAAiB,WAAa,IAExD,IAAKb,EAAI,EAAGA,EAAIwzE,EAAaxzE,IAAK,CAGhC,IAFA0zE,EAAkB1zE,EAAIuzE,EAAaxC,GAAoBuC,EACvDzC,EAAU,EACLjT,EAAI,EAAGA,EAAI8V,EAAiB9V,IAAK,CACpC,MAAMoW,EAAUpD,EAAYP,EAC5B,IAAI1S,EAAI,EACR,MAAMsW,EAAOD,EAAUF,EAAcxiE,EAAkB,EAAV0iE,EAAc,EACrDE,GAAsB,EAAPD,EACrB,IAAIE,EAAO,EACPC,EAAU,EACd,KAAOzW,EAAIuW,EAAcvW,GAAK,EAC5ByW,EAAUlxD,EAAImtD,KACduD,EAAO/C,KAAuB,IAAVuD,EAAgBL,EAAQroB,EAC5CkoB,EAAO/C,KAAuB,GAAVuD,EAAeL,EAAQroB,EAC3CkoB,EAAO/C,KAAuB,GAAVuD,EAAeL,EAAQroB,EAC3CkoB,EAAO/C,KAAuB,GAAVuD,EAAeL,EAAQroB,EAC3CkoB,EAAO/C,KAAuB,EAAVuD,EAAcL,EAAQroB,EAC1CkoB,EAAO/C,KAAuB,EAAVuD,EAAcL,EAAQroB,EAC1CkoB,EAAO/C,KAAuB,EAAVuD,EAAcL,EAAQroB,EAC1CkoB,EAAO/C,KAAuB,EAAVuD,EAAcL,EAAQroB,EAE5C,KAAOiS,EAAIsW,EAAMtW,IACF,IAATwW,IACFC,EAAUlxD,EAAImtD,KACd8D,EAAO,KAGTP,EAAO/C,KAAauD,EAAUD,EAAOJ,EAAQroB,EAC7CyoB,IAAS,CAEb,CAEA,KAAOtD,EAAUgD,GACfD,EAAO/C,KAAa,EAGtBx7D,EAAI83D,aAAasG,EAAc,EAAGzzE,EAAI+wE,GACxC,CACF,MAAO,GAAIqC,EAAQhiB,OAASn9D,GAAUG,WAAY,CAIhD,IAFAwpE,EAAI,EACJ+V,EAAmBriE,EAAQy/D,GAAoB,EAC1C/wE,EAAI,EAAGA,EAAIuzE,EAAYvzE,IAC1Bm0D,EAAKrkE,IAAIozB,EAAI7iB,SAASgwE,EAAQA,EAASsD,IACvCtD,GAAUsD,EAEVt+D,EAAI83D,aAAasG,EAAc,EAAG7V,GAClCA,GAAKmT,GAEH/wE,EAAIwzE,IACNG,EAAmBriE,EAAQgiE,EAAqB,EAChDnf,EAAKrkE,IAAIozB,EAAI7iB,SAASgwE,EAAQA,EAASsD,IAEvCt+D,EAAI83D,aAAasG,EAAc,EAAG7V,GAEtC,KAAO,IAAIwV,EAAQhiB,OAASn9D,GAAUE,UAqBpC,MAAM,IAAIsI,MAAM,mBAADH,OAAoB82E,EAAQhiB,OAjB3C,IAFAsiB,EAAkB3C,GAClB4C,EAAmBriE,EAAQoiE,EACtB1zE,EAAI,EAAGA,EAAIwzE,EAAaxzE,IAAK,CAOhC,IANIA,GAAKuzE,IACPG,EAAkBJ,EAClBK,EAAmBriE,EAAQoiE,GAG7B7C,EAAU,EACLjT,EAAI+V,EAAkB/V,KACzBzJ,EAAK0c,KAAa3tD,EAAImtD,KACtBlc,EAAK0c,KAAa3tD,EAAImtD,KACtBlc,EAAK0c,KAAa3tD,EAAImtD,KACtBlc,EAAK0c,KAAa,IAGpBx7D,EAAI83D,aAAasG,EAAc,EAAGzzE,EAAI+wE,GACxC,CAGF,CACF,CAEA,SAASsD,GAAmBh/D,EAAK+9D,GAC/B,GAAIA,EAAQtvD,OAGV,YADAzO,EAAI+N,UAAUgwD,EAAQtvD,OAAQ,EAAG,GAKnC,MAAMvS,EAAS6hE,EAAQ7hE,OACrBD,EAAQ8hE,EAAQ9hE,MACZgiE,EAAqB/hE,EAASw/D,GAC9BwC,GAAchiE,EAAS+hE,GAAsBvC,GAC7CyC,EAAqC,IAAvBF,EAA2BC,EAAaA,EAAa,EAEnEE,EAAep+D,EAAI63D,gBAAgB57D,EAAOy/D,IAChD,IAAIV,EAAS,EACb,MAAMntD,EAAMkwD,EAAQ55D,KACd26C,EAAOsf,EAAaj6D,KAE1B,IAAK,IAAIxZ,EAAI,EAAGA,EAAIwzE,EAAaxzE,IAAK,CACpC,MAAM0zE,EACJ1zE,EAAIuzE,EAAaxC,GAAoBuC,IAKpCjD,UAAWF,GAA2B,CACvCjtD,MACAmtD,SACAlc,OACA7iD,QACAC,OAAQmiE,EACRpD,cAAe,KAGjBj7D,EAAI83D,aAAasG,EAAc,EAAGzzE,EAAI+wE,GACxC,CACF,CAEA,SAASuD,GAAaC,EAAWC,GAC/B,MAAMC,EAAa,CACjB,cACA,YACA,WACA,cACA,YACA,UACA,WACA,aACA,2BACA,OACA,UAEF,IAAK,MAAMC,KAAYD,OACO13E,IAAxBw3E,EAAUG,KACZF,EAAQE,GAAYH,EAAUG,SAGJ33E,IAA1Bw3E,EAAUI,cACZH,EAAQG,YAAYJ,EAAUK,eAC9BJ,EAAQK,eAAiBN,EAAUM,eAEvC,CAEA,SAASC,GAAkBz/D,GACzBA,EAAI26D,YAAc36D,EAAI00D,UAAY,UAClC10D,EAAI0/D,SAAW,UACf1/D,EAAI2/D,YAAc,EAClB3/D,EAAIy9D,UAAY,EAChBz9D,EAAI4/D,QAAU,OACd5/D,EAAI6/D,SAAW,QACf7/D,EAAI8/D,WAAa,GACjB9/D,EAAI+/D,yBAA2B,cAC/B//D,EAAIszC,KAAO,uBACa5rD,IAApBsY,EAAIs/D,cACNt/D,EAAIs/D,YAAY,IAChBt/D,EAAIw/D,eAAiB,GAEvB,MAAM,OAAElZ,GAAWtmD,EACJ,SAAXsmD,GAAgC,KAAXA,IACvBtmD,EAAIsmD,OAAS,OAEjB,CAEA,SAAS0Z,GAAyBz+E,EAAW0+E,GAK3C,GAAIA,EACF,OAAO,EAGTpyE,GAAKmD,8BAA8BzP,EAAWq6E,IAG9C,MAAMsE,EAAcr1E,KAAKs1E,OACvBv/D,GAAYC,WAAatH,GAAc+gB,kBAGzC,OAAOshD,GAAG,IAAMsE,GAAetE,GAAG,IAAMsE,CAC1C,CAEA,MAAME,GAAkB,CAAC,OAAQ,QAAS,UACpCC,GAAmB,CAAC,QAAS,QAAS,SACtCC,GAAc,CAAC,EACfC,GAAU,CAAC,EAAC,IAAAC,GAAA,IAAAx2D,QAElB,MAAMy2D,GACJh3E,WAAAA,CACEi3E,EACAC,EACA3qB,EACA+lB,EACA5hD,EAAaymD,EAEbC,EACAnoD,EACAu5C,GACA,IAJA,sBAAE6O,EAAqB,mBAAEC,EAAqB,MAAMH,EAAA7lF,EAAA,KAAAylF,IAKpDvkF,KAAK+jB,IAAM0gE,EACXzkF,KAAKg4E,QAAU,IAAIoJ,GACjBphF,KAAK+jB,IAAI4O,OAAO3S,MAChBhgB,KAAK+jB,IAAI4O,OAAO1S,QAElBjgB,KAAK+kF,WAAa,GAClB/kF,KAAKglF,YAAc,KACnBhlF,KAAKilF,eAAgB,EACrBjlF,KAAK2M,IAAM,KACX3M,KAAKklF,MAAQ,KACbllF,KAAK0kF,WAAaA,EAClB1kF,KAAK+5D,KAAOA,EACZ/5D,KAAK8/E,cAAgBA,EACrB9/E,KAAKk+B,cAAgBA,EACrBl+B,KAAKmlF,WAAa,GAGlBnlF,KAAKw4E,cAAgB,KACrBx4E,KAAKolF,mBAAqB,GAC1BplF,KAAK09E,WAAa,EAClB19E,KAAKqlF,WAAa,GAClBrlF,KAAKslF,aAAe,EACpBtlF,KAAKulF,UAAY,KACjBvlF,KAAKwlF,aAAe,KACpBxlF,KAAKylF,gBAAiB,EACtBzlF,KAAK8kF,mBAAqBA,GAAsB,GAChD9kF,KAAK6kF,sBAAwBA,EAC7B7kF,KAAKm4E,eAAiB,IAAI0H,GAAe7/E,KAAK8/E,eAC9C9/E,KAAK0lF,eAAiB,IAAIr+D,IAC1BrnB,KAAK4kF,oBAAsBA,EAC3B5kF,KAAK2lF,cAAgB,EACrB3lF,KAAK4lF,aAAe,EACpB5lF,KAAK6lF,aAAe,EACpB7lF,KAAKy8B,WAAaA,EAElBz8B,KAAK8lF,wBAA0B,EAAE,EAAG,GACpC9lF,KAAK+lF,2BAA6B,KAClC/lF,KAAKgmF,kBAAoB,IAAI3+D,IAE7BrnB,KAAKg2E,kBAAqC,OAAjBA,QAAiB,IAAjBA,EAAAA,EAAqB,IAChD,CAEAiQ,SAAAA,CAAUxU,EAAOvpD,GAAuB,IAAjBg+D,EAAQ/mF,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACF,IAAAgnF,EAA9B,MAAoB,kBAATj+D,GACa,QAAtBi+D,EAAAnmF,KAAKg2E,yBAAiB,IAAAmQ,GAAtBA,EAAwB1R,sBAAsBhD,EAAOvpD,GAC9CA,EAAKtc,WAAW,MACnB5L,KAAK0kF,WAAWplF,IAAI4oB,GACpBloB,KAAK+5D,KAAKz6D,IAAI4oB,IAEbg+D,CACT,CAEAE,YAAAA,CAAYC,GAKT,IALU,UACX/gF,EAAS,SACT+W,EAAQ,aACRiqE,GAAe,EAAK,WACpBtmD,EAAa,MACdqmD,EAMC,MAAMrmE,EAAQhgB,KAAK+jB,IAAI4O,OAAO3S,MACxBC,EAASjgB,KAAK+jB,IAAI4O,OAAO1S,OAEzBsmE,EAAiBvmF,KAAK+jB,IAAI00D,UAKhC,GAJAz4E,KAAK+jB,IAAI00D,UAAYz4C,GAAc,UACnChgC,KAAK+jB,IAAIyiE,SAAS,EAAG,EAAGxmE,EAAOC,GAC/BjgB,KAAK+jB,IAAI00D,UAAY8N,EAEjBD,EAAc,CAChB,MAAMG,EAAoBzmF,KAAKm4E,eAAeC,UAC5C,cACAp4D,EACAC,GAEFjgB,KAAK0mF,aAAe1mF,KAAK+jB,IACzB/jB,KAAKymF,kBAAoBA,EAAkB9zD,OAC3C3yB,KAAK+jB,IAAM0iE,EAAkB5yB,QAC7B7zD,KAAK+jB,IAAI3e,OAGTpF,KAAK+jB,IAAIze,aAAawe,GAAoB9jB,KAAK0mF,cACjD,CAEA1mF,KAAK+jB,IAAI3e,OACTo+E,GAAkBxjF,KAAK+jB,KACnBze,IACFtF,KAAK+jB,IAAIze,aAAaA,GACtBtF,KAAK4lF,aAAetgF,EAAU,GAC9BtF,KAAK6lF,aAAevgF,EAAU,IAEhCtF,KAAK+jB,IAAIze,aAAa+W,EAAS/W,WAC/BtF,KAAK2lF,cAAgBtpE,EAAS8C,MAE9Bnf,KAAKw4E,cAAgB10D,GAAoB9jB,KAAK+jB,IAChD,CAEA85D,mBAAAA,CACExB,EACAsK,EACAC,EACAC,EACAC,GAEA,MAAMC,EAAY1K,EAAa0K,UACzBC,EAAU3K,EAAa2K,QAC7B,IAAIt4E,EAAIi4E,GAAqB,EAC7B,MAAMM,EAAeF,EAAU1oF,OAG/B,GAAI4oF,IAAiBv4E,EACnB,OAAOA,EAGT,MAAMw4E,EACJD,EAAev4E,EAltBG,IAmtBU,oBAArBk4E,EACHO,EAAUD,EAAkBvlE,KAAKC,MAttBpB,GAstB6C,EAChE,IAAIwlE,EAAQ,EAEZ,MAAM1C,EAAa1kF,KAAK0kF,WAClB3qB,EAAO/5D,KAAK+5D,KAClB,IAAIstB,EAAMC,EAEV,OAAa,CACX,QAAgB77E,IAAZo7E,GAAyBn4E,IAAMm4E,EAAQU,eAEzC,OADAV,EAAQW,QAAQ94E,EAAGk4E,GACZl4E,EAGqC,IAAA+4E,EAA9C,IAAKX,GAAoBA,EAAiBp4E,GAKxC,GAJA24E,EAAOL,EAAQt4E,GAEf44E,EAAqB,QAAfG,EAAGV,EAAUr4E,UAAE,IAAA+4E,EAAAA,EAAI,KAErBJ,IAAS3iF,GAAIC,WACA,OAAX2iF,EACFtnF,KAAKqnF,GAAM34E,GAEX1O,KAAKqnF,GAAM34E,KAAM44E,QAGnB,IAAK,MAAMI,KAAYJ,EAAQ,KAAAK,EACP,QAAtBA,EAAA3nF,KAAKg2E,yBAAiB,IAAA2R,GAAtBA,EAAwBnV,gBAAgBkV,EAAUh5E,GAClD,MAAMk5E,EAAWF,EAAS97E,WAAW,MAAQ84E,EAAa3qB,EAI1D,IAAK6tB,EAAShpF,IAAI8oF,GAEhB,OADAE,EAAStoF,IAAIooF,EAAUd,GAChBl4E,CAEX,CAOJ,GAHAA,IAGIA,IAAMu4E,EACR,OAAOv4E,EAKT,GAAIw4E,KAAqBE,EApwBP,GAowBgC,CAChD,GAAIzlE,KAAKC,MAAQulE,EAEf,OADAP,IACOl4E,EAET04E,EAAQ,CACV,CAIF,CACF,CAqBAtJ,UAAAA,GACE5+E,EAAAqlF,GAAAvkF,KAAK6nF,IAAoBx2E,KAAzBrR,MAEAA,KAAKm4E,eAAe74C,QACpBt/B,KAAK0lF,eAAepmD,QAEpB,IAAK,MAAMygD,KAAS//E,KAAKgmF,kBAAkB3mD,SAAU,CACnD,IAAK,MAAM1M,KAAUotD,EAAM1gD,SAEM,qBAAtByoD,mBACPn1D,aAAkBm1D,oBAElBn1D,EAAO3S,MAAQ2S,EAAO1S,OAAS,GAGnC8/D,EAAMzgD,OACR,CACAt/B,KAAKgmF,kBAAkB1mD,QACvBpgC,EAAAqlF,GAAAvkF,KAAK+nF,IAAW12E,KAAhBrR,KACF,CAiBAgoF,WAAAA,CAAYC,EAAKnzE,GAAkB,IAAAozE,EAAAC,EAMjC,MAAMnoE,EAAiB,QAAZkoE,EAAGD,EAAIjoE,aAAK,IAAAkoE,EAAAA,EAAID,EAAIG,aACzBnoE,EAAmB,QAAbkoE,EAAGF,EAAIhoE,cAAM,IAAAkoE,EAAAA,EAAIF,EAAII,cACjC,IAYInQ,EAAWG,EAZXiQ,EAAa15E,KAAKiG,IACpBjG,KAAKwuC,MAAMtoC,EAAiB,GAAIA,EAAiB,IACjD,GAEEyzE,EAAc35E,KAAKiG,IACrBjG,KAAKwuC,MAAMtoC,EAAiB,GAAIA,EAAiB,IACjD,GAGE0zE,EAAaxoE,EACfyoE,EAAcxoE,EACZyoE,EAAc,YAElB,KACGJ,EAAa,GAAKE,EAAa,GAC/BD,EAAc,GAAKE,EAAc,GAClC,CACA,IAAIx5B,EAAWu5B,EACbt5B,EAAYu5B,EACVH,EAAa,GAAKE,EAAa,IAIjCv5B,EACEu5B,GAAc,MACV55E,KAAKiY,MAAM2hE,EAAa,GAAK,GAAK,EAClC55E,KAAKiX,KAAK2iE,EAAa,GAC7BF,GAAcE,EAAav5B,GAEzBs5B,EAAc,GAAKE,EAAc,IAEnCv5B,EACEu5B,GAAe,MACX75E,KAAKiY,MAAM4hE,EAAc,GAAK,GAAK,EACnC75E,KAAKiX,KAAK4iE,GAAe,EAC/BF,GAAeE,EAAcv5B,GAE/BgpB,EAAYl4E,KAAKm4E,eAAeC,UAC9BsQ,EACAz5B,EACAC,GAEFmpB,EAASH,EAAUrkB,QACnBwkB,EAAOC,UAAU,EAAG,EAAGrpB,EAAUC,GACjCmpB,EAAOvmD,UACLm2D,EACA,EACA,EACAO,EACAC,EACA,EACA,EACAx5B,EACAC,GAEF+4B,EAAM/P,EAAUvlD,OAChB61D,EAAav5B,EACbw5B,EAAcv5B,EACdw5B,EAA8B,cAAhBA,EAA8B,YAAc,WAC5D,CACA,MAAO,CACLT,MACAO,aACAC,cAEJ,CAEAE,iBAAAA,CAAkBlX,EAAOwW,GAAK,IAAAW,EAC5B,MAAM7kE,EAAM/jB,KAAK+jB,KACX,MAAE/D,EAAK,OAAEC,GAAWgoE,EACpBtJ,EAAY3+E,KAAKg4E,QAAQ2G,UACzBkK,EAAgB7oF,KAAKg4E,QAAQ8Q,YAC7BC,EAAmBjlE,GAAoBC,GAE7C,IAAIg8D,EAAOiJ,EAAUjkE,EAAQkkE,EAC7B,IAAKhB,EAAIz1D,QAAUy1D,EAAI//D,OAAS+/D,EAAIzzB,MAAQ,EAAG,CAC7C,MAAM00B,EAAUjB,EAAIz1D,QAAUy1D,EAAI//D,KAAKxY,OAOvCs5E,EAAW3iD,KAAKC,UACduiD,EACIE,EACA,CAACA,EAAiB1zE,MAAM,EAAG,GAAIspE,IAGrCoB,EAAQ//E,KAAKgmF,kBAAkB1mF,IAAI4pF,GAC9BnJ,IACHA,EAAQ,IAAI14D,IACZrnB,KAAKgmF,kBAAkBxnF,IAAI0qF,EAASnJ,IAEtC,MAAMoJ,EAAcpJ,EAAMzgF,IAAI0pF,GAC9B,GAAIG,IAAgBN,EAAe,KAAAO,EACjC,MAAM/pE,EAAUzQ,KAAK21C,MACnB31C,KAAKC,IAAIk6E,EAAiB,GAAIA,EAAiB,IAC7CA,EAAiB,IAEfzpE,EAAU1Q,KAAK21C,MACnB31C,KAAKC,IAAIk6E,EAAiB,GAAIA,EAAiB,IAC7CA,EAAiB,IAOrB,OAJsB,QAAtBK,EAAAppF,KAAKg2E,yBAAiB,IAAAoT,GAAtBA,EAAwBjV,mBACtB1C,EACA6E,IAEK,CACL3jD,OAAQw2D,EACR9pE,UACAC,UAEJ,CACAyF,EAASokE,CACX,CAEKpkE,IACHkkE,EAAajpF,KAAKm4E,eAAeC,UAAU,aAAcp4D,EAAOC,GAChE8iE,GAAmBkG,EAAWp1B,QAASo0B,IAQzC,IAAIoB,EAAez3E,GAAKtM,UAAUyjF,EAAkB,CAClD,EAAI/oE,EACJ,EACA,GACC,EAAIC,EACL,EACA,IAEFopE,EAAez3E,GAAKtM,UAAU+jF,EAAc,CAAC,EAAG,EAAG,EAAG,EAAG,GAAIppE,IAC7D,MAAM3N,EAASstE,GAAavqE,QAC5BzD,GAAK8B,wBAAwB,CAAC,EAAG,EAAGsM,EAAOC,GAASopE,EAAc/2E,GAClE,MAAO4vD,EAAME,EAAMD,EAAME,GAAQ/vD,EAC3Bg3E,EAAa16E,KAAK21C,MAAM4d,EAAOD,IAAS,EACxCqnB,EAAc36E,KAAK21C,MAAM8d,EAAOD,IAAS,EACzConB,EAAaxpF,KAAKm4E,eAAeC,UACrC,aACAkR,EACAC,GAEIE,EAAUD,EAAW31B,QAMrBx0C,EAAU6iD,EACV5iD,EAAU8iD,EAChBqnB,EAAQxmC,WAAW5jC,GAAUC,GAC7BmqE,EAAQnkF,aAAa+jF,GAEhBtkE,IAEHA,EAAS/kB,KAAKgoF,YACZiB,EAAWt2D,OACX1O,GAA2BwlE,IAE7B1kE,EAASA,EAAOkjE,IACZlI,GAAS8I,GACX9I,EAAMvhF,IAAIwqF,EAAUjkE,IAIxB0kE,EAAQC,sBAAwB3F,GAC9BjgE,GAAoB2lE,GACpBxB,EAAIjE,aAGN/D,GACEwJ,EACA1kE,EACA,EACA,EACAA,EAAO/E,MACP+E,EAAO9E,OACP,EACA,EACAD,EACAC,GAEFwpE,EAAQ3F,yBAA2B,YAEnC,MAAMlM,EAAUhmE,GAAKtM,UAAU2e,GAA2BwlE,GAAU,CAClE,EACA,EACA,EACA,GACCpqE,GACAC,IAqBH,OAnBAmqE,EAAQhR,UAAYoQ,EAChBlK,EAAU/H,WAAW7yD,EAAK/jB,KAAM43E,EAASrB,GAAe9E,GACxDkN,EAEJ8K,EAAQjD,SAAS,EAAG,EAAGxmE,EAAOC,GAE1B8/D,IAAU8I,IAGZ7oF,KAAKm4E,eAAe9sD,OAAO,cAC3B00D,EAAMvhF,IAAIwqF,EAAUQ,EAAW72D,SAGX,QAAtBi2D,EAAA5oF,KAAKg2E,yBAAiB,IAAA4S,GAAtBA,EAAwBzU,mBACtB1C,EACA6E,IAIK,CACL3jD,OAAQ62D,EAAW72D,OACnBtT,QAASzQ,KAAK21C,MAAMllC,GACpBC,QAAS1Q,KAAK21C,MAAMjlC,GAExB,CAGA1a,YAAAA,CAAa6sE,EAAOzxD,GAAO,IAAA2pE,EACH,QAAtBA,EAAA3pF,KAAKg2E,yBAAiB,IAAA2T,GAAtBA,EAAwBtX,iBAAiB,YAAaZ,GAClDzxD,IAAUhgB,KAAKg4E,QAAQwJ,YACzBxhF,KAAK8lF,wBAAwB,IAAM,GAErC9lF,KAAKg4E,QAAQwJ,UAAYxhE,EACzBhgB,KAAK+jB,IAAIy9D,UAAYxhE,CACvB,CAEAnb,UAAAA,CAAW4sE,EAAOp2D,GAAO,IAAAuuE,EACD,QAAtBA,EAAA5pF,KAAKg2E,yBAAiB,IAAA4T,GAAtBA,EAAwBvX,iBAAiB,UAAWZ,GACpDzxE,KAAK+jB,IAAI4/D,QAAUQ,GAAgB9oE,EACrC,CAEAvW,WAAAA,CAAY2sE,EAAOp2D,GAAO,IAAAwuE,EACF,QAAtBA,EAAA7pF,KAAKg2E,yBAAiB,IAAA6T,GAAtBA,EAAwBxX,iBAAiB,WAAYZ,GACrDzxE,KAAK+jB,IAAI6/D,SAAWQ,GAAiB/oE,EACvC,CAEAtW,aAAAA,CAAc0sE,EAAOqY,GAAO,IAAAC,EACJ,QAAtBA,EAAA/pF,KAAKg2E,yBAAiB,IAAA+T,GAAtBA,EAAwB1X,iBAAiB,aAAcZ,GACvDzxE,KAAK+jB,IAAI8/D,WAAaiG,CACxB,CAEA9kF,OAAAA,CAAQysE,EAAOuY,EAAWC,GAAW,IAAAC,EACb,QAAtBA,EAAAlqF,KAAKg2E,yBAAiB,IAAAkU,GAAtBA,EAAwB7X,iBAAiB,OAAQZ,GACjD,MAAM1tD,EAAM/jB,KAAK+jB,SACOtY,IAApBsY,EAAIs/D,cACNt/D,EAAIs/D,YAAY2G,GAChBjmE,EAAIw/D,eAAiB0G,EAEzB,CAEAhlF,kBAAAA,CAAmBwsE,EAAO73D,GAE1B,CAEA1U,WAAAA,CAAYusE,EAAO0Y,GAEnB,CAEAhlF,SAAAA,CAAUssE,EAAO2Y,GAAQ,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACvB,IAAK,MAAOvvE,EAAKpb,KAAUsqF,EACzB,OAAQlvE,GACN,IAAK,KACHlb,KAAK4E,aAAa6sE,EAAO3xE,GACzB,MACF,IAAK,KACHE,KAAK6E,WAAW4sE,EAAO3xE,GACvB,MACF,IAAK,KACHE,KAAK8E,YAAY2sE,EAAO3xE,GACxB,MACF,IAAK,KACHE,KAAK+E,cAAc0sE,EAAO3xE,GAC1B,MACF,IAAK,IACHE,KAAKgF,QAAQysE,EAAO3xE,EAAM,GAAIA,EAAM,IACpC,MACF,IAAK,KACHE,KAAKiF,mBAAmBwsE,EAAO3xE,GAC/B,MACF,IAAK,KACHE,KAAKkF,YAAYusE,EAAO3xE,GACxB,MACF,IAAK,OACHE,KAAK+G,QAAQ0qE,EAAO3xE,EAAM,GAAIA,EAAM,IACpC,MACF,IAAK,KACmB,QAAtBuqF,EAAArqF,KAAKg2E,yBAAiB,IAAAqU,GAAtBA,EAAwBhY,iBAAiB,cAAeZ,GACxDzxE,KAAKg4E,QAAQ0S,YAAc5qF,EAC3B,MACF,IAAK,KACmB,QAAtBwqF,EAAAtqF,KAAKg2E,yBAAiB,IAAAsU,GAAtBA,EAAwBjY,iBAAiB,YAAaZ,GACtDzxE,KAAK+jB,IAAI2/D,YAAc1jF,KAAKg4E,QAAQ2S,UAAY7qF,EAChD,MACF,IAAK,KACmB,QAAtByqF,EAAAvqF,KAAKg2E,yBAAiB,IAAAuU,GAAtBA,EAAwBlY,iBACtB,2BACAZ,GAEFzxE,KAAK+jB,IAAI+/D,yBAA2BhkF,EACpC,MACF,IAAK,QACmB,QAAtB0qF,EAAAxqF,KAAKg2E,yBAAiB,IAAAwU,GAAtBA,EAAwBnY,iBAAiB,QAASZ,GAClDzxE,KAAKg4E,QAAQ4S,YAAc9qF,EAAQE,KAAKulF,UAAY,KACpDvlF,KAAKulF,UAAY,KACjBvlF,KAAK6qF,kBACL,MACF,IAAK,KACmB,QAAtBJ,EAAAzqF,KAAKg2E,yBAAiB,IAAAyU,GAAtBA,EAAwBpY,iBAAiB,SAAUZ,GACnDzxE,KAAK+jB,IAAIsmD,OAASrqE,KAAKg4E,QAAQ8S,aAC7B9qF,KAAKk+B,cAAcuqC,UAAU3oE,GAIvC,CAEA,eAAIirF,GACF,QAAS/qF,KAAKwlF,YAChB,CAEAqF,eAAAA,GACE,MAAME,EAAc/qF,KAAK+qF,YACrB/qF,KAAKg4E,QAAQ4S,cAAgBG,EAC/B/qF,KAAKgrF,kBACKhrF,KAAKg4E,QAAQ4S,aAAeG,GACtC/qF,KAAKirF,cAGT,CAWAD,cAAAA,CAAevZ,GACb,GAAIzxE,KAAK+qF,YACP,MAAM,IAAI5/E,MAAM,qDAElB,MAAMm+E,EAAatpF,KAAK+jB,IAAI4O,OAAO3S,MAC7BupE,EAAcvpF,KAAK+jB,IAAI4O,OAAO1S,OAC9BirE,EAAU,eAAiBlrF,KAAK09E,WAChCyN,EAAgBnrF,KAAKm4E,eAAeC,UACxC8S,EACA5B,EACAC,GAEFvpF,KAAKwlF,aAAexlF,KAAK+jB,IACzB,MAAMA,EAAO/jB,KAAK+jB,IAAMonE,EAAct3B,QACtC9vC,EAAI80D,aAAa74E,KAAKwlF,aAAaxhE,gBACnCg/D,GAAahjF,KAAKwlF,aAAczhE,GAvpCpC,SAAiCA,EAAKm/D,GACpC,GAAIn/D,EAAIqnE,iBACN,MAAM,IAAIjgF,MAAM,6CAElB4Y,EAAIsnE,eAAiBtnE,EAAI3e,KACzB2e,EAAIunE,kBAAoBvnE,EAAI1e,QAC5B0e,EAAIwnE,iBAAmBxnE,EAAIgmC,OAC3BhmC,EAAIynE,gBAAkBznE,EAAI5E,MAC1B4E,EAAI0nE,oBAAsB1nE,EAAIk/B,UAC9Bl/B,EAAI2nE,oBAAsB3nE,EAAIze,UAC9Bye,EAAI4nE,uBAAyB5nE,EAAI80D,aACjC90D,EAAI6nE,yBAA2B7nE,EAAI8nE,eACnC9nE,EAAI+nE,eAAiB/nE,EAAIxd,KACzBwd,EAAIgoE,iBAAmBhoE,EAAIxe,OAC3Bwe,EAAIioE,iBAAmBjoE,EAAIve,OAC3Bue,EAAIkoE,wBAA0BloE,EAAIsE,cAClCtE,EAAImoE,eAAiBnoE,EAAIpQ,KACzBoQ,EAAIooE,oBAAsBpoE,EAAIne,UAC9Bme,EAAIqoE,oBAAsBroE,EAAIw0D,UAE9Bx0D,EAAIqnE,iBAAmB,KACrBrnE,EAAI3e,KAAO2e,EAAIsnE,eACftnE,EAAI1e,QAAU0e,EAAIunE,kBAClBvnE,EAAIgmC,OAAShmC,EAAIwnE,iBACjBxnE,EAAI5E,MAAQ4E,EAAIynE,gBAChBznE,EAAIk/B,UAAYl/B,EAAI0nE,oBACpB1nE,EAAIze,UAAYye,EAAI2nE,oBACpB3nE,EAAI80D,aAAe90D,EAAI4nE,uBACvB5nE,EAAI8nE,eAAiB9nE,EAAI6nE,yBAEzB7nE,EAAIxd,KAAOwd,EAAI+nE,eACf/nE,EAAIxe,OAASwe,EAAIgoE,iBACjBhoE,EAAIve,OAASue,EAAIioE,iBACjBjoE,EAAIsE,cAAgBtE,EAAIkoE,wBACxBloE,EAAIpQ,KAAOoQ,EAAImoE,eACfnoE,EAAIne,UAAYme,EAAIooE,oBACpBpoE,EAAIw0D,UAAYx0D,EAAIqoE,2BACbroE,EAAIqnE,kBAGbrnE,EAAI3e,KAAO,WACT89E,EAAQ99E,OACRpF,KAAKqrF,gBACP,EAEAtnE,EAAI1e,QAAU,WACZ69E,EAAQ79E,UACRrF,KAAKsrF,mBACP,EAEAvnE,EAAIk/B,UAAY,SAAUntC,EAAGC,GAC3BmtE,EAAQjgC,UAAUntC,EAAGC,GACrB/V,KAAKyrF,oBAAoB31E,EAAGC,EAC9B,EAEAgO,EAAI5E,MAAQ,SAAUrJ,EAAGC,GACvBmtE,EAAQ/jE,MAAMrJ,EAAGC,GACjB/V,KAAKwrF,gBAAgB11E,EAAGC,EAC1B,EAEAgO,EAAIze,UAAY,SAAUvG,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GACvC8wE,EAAQ59E,UAAUvG,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GACjCpS,KAAK0rF,oBAAoB3sF,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,EAC1C,EAEA2R,EAAI80D,aAAe,SAAU95E,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GAC1C8wE,EAAQrK,aAAa95E,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GACpCpS,KAAK2rF,uBAAuB5sF,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,EAC7C,EAEA2R,EAAI8nE,eAAiB,WACnB3I,EAAQ2I,iBACR7rF,KAAK4rF,0BACP,EAEA7nE,EAAIgmC,OAAS,SAAUoE,GACrB+0B,EAAQn5B,OAAOoE,GACfnuD,KAAKurF,iBAAiBp9B,EACxB,EAEApqC,EAAIxd,KAAO,SAAU6vD,GACnB8sB,EAAQ38E,KAAK6vD,GACbp2D,KAAK8rF,eAAe11B,EACtB,EAEAryC,EAAIxe,OAAS,SAAUuQ,EAAGC,GACxBmtE,EAAQ39E,OAAOuQ,EAAGC,GAClB/V,KAAK+rF,iBAAiBj2E,EAAGC,EAC3B,EAEAgO,EAAIve,OAAS,SAAUsQ,EAAGC,GACxBmtE,EAAQ19E,OAAOsQ,EAAGC,GAClB/V,KAAKgsF,iBAAiBl2E,EAAGC,EAC3B,EAEAgO,EAAIsE,cAAgB,SAAUgkE,EAAMC,EAAMC,EAAMC,EAAM12E,EAAGC,GACvDmtE,EAAQ76D,cAAcgkE,EAAMC,EAAMC,EAAMC,EAAM12E,EAAGC,GACjD/V,KAAKisF,wBAAwBI,EAAMC,EAAMC,EAAMC,EAAM12E,EAAGC,EAC1D,EAEAgO,EAAIpQ,KAAO,SAAUmC,EAAGC,EAAGiK,EAAOC,GAChCijE,EAAQvvE,KAAKmC,EAAGC,EAAGiK,EAAOC,GAC1BjgB,KAAKksF,eAAep2E,EAAGC,EAAGiK,EAAOC,EACnC,EAEA8D,EAAIne,UAAY,WACds9E,EAAQt9E,YACR5F,KAAKmsF,qBACP,EAEApoE,EAAIw0D,UAAY,WACd2K,EAAQ3K,YACRv4E,KAAKosF,qBACP,CACF,CAsiCIK,CAAwB1oE,EAAK/jB,KAAKwlF,cAElCxlF,KAAKmF,UAAUssE,EAAO,CAAC,CAAC,KAAM,gBAChC,CAEAwZ,YAAAA,GACE,IAAKjrF,KAAK+qF,YACR,MAAM,IAAI5/E,MAAM,+CAIlBnL,KAAK+jB,IAAIqnE,mBACTpI,GAAahjF,KAAK+jB,IAAK/jB,KAAKwlF,cAC5BxlF,KAAK+jB,IAAM/jB,KAAKwlF,aAEhBxlF,KAAKwlF,aAAe,IACtB,CAEAkH,OAAAA,CAAQC,GACN,IAAK3sF,KAAKg4E,QAAQ4S,YAChB,OAGG+B,GAGHA,EAAS,GAAK/9E,KAAKiY,MAAM8lE,EAAS,IAClCA,EAAS,GAAK/9E,KAAKiY,MAAM8lE,EAAS,IAClCA,EAAS,GAAK/9E,KAAKiX,KAAK8mE,EAAS,IACjCA,EAAS,GAAK/9E,KAAKiX,KAAK8mE,EAAS,KALjCA,EAAW,CAAC,EAAG,EAAG3sF,KAAK+jB,IAAI4O,OAAO3S,MAAOhgB,KAAK+jB,IAAI4O,OAAO1S,QAO3D,MAAM2sE,EAAQ5sF,KAAKg4E,QAAQ4S,YACrBpF,EAAexlF,KAAKwlF,aAE1BxlF,KAAK6sF,aAAarH,EAAcoH,EAAO5sF,KAAK+jB,IAAK4oE,GAGjD3sF,KAAK+jB,IAAI3e,OACTpF,KAAK+jB,IAAI80D,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GACrC74E,KAAK+jB,IAAIu0D,UAAU,EAAG,EAAGt4E,KAAK+jB,IAAI4O,OAAO3S,MAAOhgB,KAAK+jB,IAAI4O,OAAO1S,QAChEjgB,KAAK+jB,IAAI1e,SACX,CAEAwnF,YAAAA,CAAa9oE,EAAK6oE,EAAOE,EAAUC,GACjC,MAAMC,EAAeD,EAAS,GACxBE,EAAeF,EAAS,GACxBG,EAAaH,EAAS,GAAKC,EAC3BG,EAAcJ,EAAS,GAAKE,EACf,IAAfC,GAAoC,IAAhBC,IAGxBntF,KAAKotF,oBACHR,EAAM/4B,QACNi5B,EACAI,EACAC,EACAP,EAAMS,QACNT,EAAMU,SACNV,EAAMW,YACNP,EACAC,EACAL,EAAMvtE,QACNutE,EAAMttE,SAERyE,EAAI3e,OACJ2e,EAAI2/D,YAAc,EAClB3/D,EAAI+/D,yBAA2B,cAC/B//D,EAAI80D,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAChC90D,EAAI+N,UAAUg7D,EAASn6D,OAAQ,EAAG,GAClC5O,EAAI1e,UACN,CAEA+nF,mBAAAA,CACEI,EACAV,EACA9sE,EACAC,EACAotE,EACAC,EACAC,EACAP,EACAC,EACAQ,EACAC,GAEA,IAAIzE,EAAauE,EAAQ76D,OACrBg7D,EAAQX,EAAeS,EACvBG,EAAQX,EAAeS,EAE3B,GAAIJ,EACF,GACEK,EAAQ,GACRC,EAAQ,GACRD,EAAQ3tE,EAAQipE,EAAWjpE,OAC3B4tE,EAAQ3tE,EAASgpE,EAAWhpE,OAC5B,CACA,MAAM0S,EAAS3yB,KAAKm4E,eAAeC,UACjC,gBACAp4D,EACAC,GAEI8D,EAAM4O,EAAOkhC,QACnB9vC,EAAI+N,UAAUm3D,GAAa0E,GAAQC,GACnC7pE,EAAI+/D,yBAA2B,mBAC/B//D,EAAI00D,UAAY6U,EAChBvpE,EAAIyiE,SAAS,EAAG,EAAGxmE,EAAOC,GAC1B8D,EAAI+/D,yBAA2B,cAE/BmF,EAAat2D,EAAOA,OACpBg7D,EAAQC,EAAQ,CAClB,KAAO,CACLJ,EAAQpoF,OACRooF,EAAQ9J,YAAc,EACtB8J,EAAQ3U,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GACpC,MAAMtyE,EAAO,IAAI6hB,OACjB7hB,EAAKoN,KAAKg6E,EAAOC,EAAO5tE,EAAOC,GAC/ButE,EAAQjnF,KAAKA,GACbinF,EAAQ1J,yBAA2B,mBACnC0J,EAAQ/U,UAAY6U,EACpBE,EAAQhH,SAASmH,EAAOC,EAAO5tE,EAAOC,GACtCutE,EAAQnoF,SACV,CAGFynF,EAAS1nF,OACT0nF,EAASpJ,YAAc,EACvBoJ,EAASjU,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAErB,UAAZwU,GAAuBE,EACzBT,EAASziB,OAASrqE,KAAKk+B,cAAc2qC,eAAe0kB,GAC/B,eAAZF,IACTP,EAASziB,OAASrqE,KAAKk+B,cAAc4qC,oBAAoBykB,IAG3D,MAAMhnF,EAAO,IAAI6hB,OACjB7hB,EAAKoN,KAAKq5E,EAAcC,EAAcjtE,EAAOC,GAC7C6sE,EAASvmF,KAAKA,GACdumF,EAAShJ,yBAA2B,iBACpCgJ,EAASh7D,UACPm3D,EACA0E,EACAC,EACA5tE,EACAC,EACA+sE,EACAC,EACAjtE,EACAC,GAEF6sE,EAASznF,SACX,CAEAD,IAAAA,CAAKqsE,GAAO,IAAAoc,EACN7tF,KAAK+qF,aAIP/H,GAAahjF,KAAK+jB,IAAK/jB,KAAKwlF,cAE9BxlF,KAAK+jB,IAAI3e,OACT,MAAM0oF,EAAM9tF,KAAKg4E,QACjBh4E,KAAK+kF,WAAW/1E,KAAK8+E,GACrB9tF,KAAKg4E,QAAU8V,EAAIttE,QACG,QAAtBqtE,EAAA7tF,KAAKg2E,yBAAiB,IAAA6X,GAAtBA,EAAwBzoF,KAAKqsE,EAC/B,CAEApsE,OAAAA,CAAQosE,GAAO,IAAAsc,EACS,QAAtBA,EAAA/tF,KAAKg2E,yBAAiB,IAAA+X,GAAtBA,EAAwB1oF,QAAQosE,GAED,IAA3BzxE,KAAK+kF,WAAW1mF,QAOpB2B,KAAKg4E,QAAUh4E,KAAK+kF,WAAWloE,MAC/B7c,KAAK+jB,IAAI1e,UACLrF,KAAK+qF,aAGP/H,GAAahjF,KAAKwlF,aAAcxlF,KAAK+jB,KAEvC/jB,KAAK6qF,kBAGL7qF,KAAKglF,YAAc,KAEnBhlF,KAAK8lF,wBAAwB,IAAM,EACnC9lF,KAAK+lF,2BAA6B,MAnB5B/lF,KAAK+qF,aACP/qF,KAAKirF,cAmBX,CAEA3lF,SAAAA,CAAUmsE,EAAO1yE,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GAAG,IAAA47E,EACX,QAAtBA,EAAAhuF,KAAKg2E,yBAAiB,IAAAgY,GAAtBA,EAAwB1b,sBAAsB,YAAab,GAC3DzxE,KAAK+jB,IAAIze,UAAUvG,EAAGgT,EAAGG,EAAGC,EAAGjU,EAAGkU,GAElCpS,KAAK8lF,wBAAwB,IAAM,EACnC9lF,KAAK+lF,2BAA6B,IACpC,CAGA77E,aAAAA,CAAcunE,EAAOwc,EAAI/lE,EAAM5V,GAC7B,IAAK6V,GAAQD,EACb,IAAK5V,EAIH,OAFA6V,IAAAA,EAASD,EAAK,GAAK,IAAIE,aACvBpoB,KAAKiuF,GAAIxc,EAAOtpD,GAIlB,GAA+B,OAA3BnoB,KAAKg2E,kBAA4B,CACnC,MAAMkY,EAAiBD,IAAOvpF,GAAIoB,OAAS9F,KAAKg4E,QAAQwJ,UAAY,EAAI,EACxExhF,KAAKg2E,kBACF/C,UAAUxB,GACV4B,WACC5B,EACAzxE,KAAK+jB,IACLzR,EAAO,GAAK47E,EACZ57E,EAAO,GAAK47E,EACZ57E,EAAO,GAAK47E,EACZ57E,EAAO,GAAK47E,GAEb/Z,mBAAmB1C,EAAO,CAAC,aAChC,CAEMtpD,aAAgBC,SACpBD,EAAOD,EAAK,GAAKD,GAAoBE,IAEvCvW,GAAK8B,wBACHpB,EACAwR,GAAoB9jB,KAAK+jB,KACzB/jB,KAAKg4E,QAAQ1lE,QAEftS,KAAKiuF,GAAIxc,EAAOtpD,GAEhBnoB,KAAKmuF,cAAgB1c,CACvB,CAEA7rE,SAAAA,CAAU6rE,GACRzxE,KAAK+jB,IAAIne,WACX,CAEAE,MAAAA,CAAO2rE,EAAOtpD,GAA0B,IAAAimE,EAAA,IAApBC,IAAWlvF,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAC7B,MAAM4kB,EAAM/jB,KAAK+jB,IACX66D,EAAc5+E,KAAKg4E,QAAQ4G,YAIjC,GADA76D,EAAI2/D,YAAc1jF,KAAKg4E,QAAQ0S,YAC3B1qF,KAAKylF,eACP,GAA2B,kBAAhB7G,GAAuC,OAAXA,QAAW,IAAXA,GAAAA,EAAahI,WAAY,CAC9D,MAAM4B,EAAgBoG,EAAYjI,8BAC9B5yD,EAAIC,eACJ,KASJ,GARAD,EAAI3e,OACJ2e,EAAI26D,YAAcE,EAAYhI,WAC5B7yD,EACA/jB,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAEE+G,EAAe,CACjB,MAAM8V,EAAU,IAAIlmE,OACpBkmE,EAAQC,QACNpmE,EACApE,EAAIC,eAAeE,aAAasqE,aAAahW,IAE/CrwD,EAAOmmE,CACT,CACAtuF,KAAKyuF,iBAAiBtmE,GAAwB,GAC9CpE,EAAI1e,SACN,MACErF,KAAKyuF,iBAAiBtmE,GAAwB,GAI5B,QAAtBimE,EAAApuF,KAAKg2E,yBAAiB,IAAAoY,GAAtBA,EAAwBja,mBAAmB1C,EAAO6E,IAE9C+X,GACFruF,KAAKquF,YACH5c,EACAtpD,EACAnoB,KAAKg4E,QAAQC,0BACX1B,GACAzyD,GAAoB9jB,KAAK+jB,OAM/BA,EAAI2/D,YAAc1jF,KAAKg4E,QAAQ2S,SACjC,CAEA5kF,WAAAA,CAAY0rE,EAAOtpD,GACjBnoB,KAAK8F,OAAO2rE,EAAOtpD,EACrB,CAEAniB,IAAAA,CAAKyrE,EAAOtpD,GAA0B,IAAAumE,EAAA,IAApBL,IAAWlvF,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAC3B,MAAM4kB,EAAM/jB,KAAK+jB,IACX46D,EAAY3+E,KAAKg4E,QAAQ2G,UAE/B,IAAIgQ,GAAc,EAElB,GAHsB3uF,KAAKg4E,QAAQ8Q,YAGhB,KAAA8F,EACjB,MAAMpW,EAAgBmG,EAAUhI,8BAC5B5yD,EAAIC,eACJ,KAUJ,GATsB,QAAtB4qE,EAAA5uF,KAAKg2E,yBAAiB,IAAA4Y,GAAtBA,EAAwBxpF,KAAKqsE,GAC7B1tD,EAAI3e,OACJ2e,EAAI00D,UAAYkG,EAAU/H,WACxB7yD,EACA/jB,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAEE+G,EAAe,CACjB,MAAM8V,EAAU,IAAIlmE,OACpBkmE,EAAQC,QACNpmE,EACApE,EAAIC,eAAeE,aAAasqE,aAAahW,IAE/CrwD,EAAOmmE,CACT,CACAK,GAAc,CAChB,CAEA,MAAMr5E,EAAYtV,KAAKg4E,QAAQC,4BAYd,IAAA4W,GAXb7uF,KAAKylF,gBAAgC,OAAdnwE,IACrBtV,KAAKilF,eACPlhE,EAAI/d,KAAKmiB,EAAM,WACfnoB,KAAKilF,eAAgB,GAErBlhE,EAAI/d,KAAKmiB,IAIS,QAAtBumE,EAAA1uF,KAAKg2E,yBAAiB,IAAA0Y,GAAtBA,EAAwBva,mBAAmB1C,EAAO6E,IAE9CqY,KACF5qE,EAAI1e,UACkB,QAAtBwpF,EAAA7uF,KAAKg2E,yBAAiB,IAAA6Y,GAAtBA,EAAwBxpF,QAAQosE,IAE9B4c,GACFruF,KAAKquF,YAAY5c,EAAOtpD,EAAM7S,EAElC,CAEArP,MAAAA,CAAOwrE,EAAOtpD,GACZnoB,KAAKilF,eAAgB,EACrBjlF,KAAKgG,KAAKyrE,EAAOtpD,EACnB,CAEAjiB,UAAAA,CAAWurE,EAAOtpD,GAChBnoB,KAAKgG,KAAKyrE,EAAOtpD,GAAM,GACvBnoB,KAAK8F,OAAO2rE,EAAOtpD,GAAM,GAEzBnoB,KAAKquF,YAAY5c,EAAOtpD,EAC1B,CAEAhiB,YAAAA,CAAasrE,EAAOtpD,GAClBnoB,KAAKilF,eAAgB,EACrBjlF,KAAKkG,WAAWurE,EAAOtpD,EACzB,CAEA/hB,eAAAA,CAAgBqrE,EAAOtpD,GACrBnoB,KAAKkG,WAAWurE,EAAOtpD,EACzB,CAEA9hB,iBAAAA,CAAkBorE,EAAOtpD,GACvBnoB,KAAKilF,eAAgB,EACrBjlF,KAAKkG,WAAWurE,EAAOtpD,EACzB,CAEA7hB,OAAAA,CAAQmrE,EAAOtpD,GACbnoB,KAAKquF,YAAY5c,EAAOtpD,EAC1B,CAEA9d,WAAAA,CAAYonE,EAAOtpD,GAAM,IAAA2mE,EACvB9uF,KAAK+jB,IAAI/d,KAAKmiB,GACQ,QAAtB2mE,EAAA9uF,KAAKg2E,yBAAiB,IAAA8Y,GAAtBA,EACI3a,mBAAmB1C,EAAO6E,IAC3B5B,gBAAgBjD,EACrB,CAGAlrE,IAAAA,CAAKkrE,GAAO,IAAAsd,EACY,QAAtBA,EAAA/uF,KAAKg2E,yBAAiB,IAAA+Y,GAAtBA,EAAwBlc,6BAA6B,WAAYpB,GACjEzxE,KAAKglF,YAAcX,EACrB,CAEA79E,MAAAA,CAAOirE,GAAO,IAAAud,EACU,QAAtBA,EAAAhvF,KAAKg2E,yBAAiB,IAAAgZ,GAAtBA,EAAwBnc,6BAA6B,WAAYpB,GACjEzxE,KAAKglF,YAAcV,EACrB,CAGA79E,SAAAA,CAAUgrE,GAAO,IAAAwd,EACfjvF,KAAKg4E,QAAQkX,WAAa,KAC1BlvF,KAAKg4E,QAAQmX,gBAAkB,EAC/BnvF,KAAKg4E,QAAQliE,EAAI9V,KAAKg4E,QAAQoX,MAAQ,EACtCpvF,KAAKg4E,QAAQjiE,EAAI/V,KAAKg4E,QAAQqX,MAAQ,EAEhB,QAAtBJ,EAAAjvF,KAAKg2E,yBAAiB,IAAAiZ,GAAtBA,EACIpd,iBAAiBJ,GAClBc,qBAAqB,gBACrBA,qBAAqB,WAAYd,EACtC,CAEA/qE,OAAAA,CAAQ+qE,GACN,MAAM6d,EAAQtvF,KAAKuvF,iBACbxrE,EAAM/jB,KAAK+jB,IAEjB,GAAI/jB,KAAKg2E,kBAAmB,CAC1B,MAAM,kBAAEA,GAAsBh2E,UAChByL,IAAV6jF,GACFtZ,EACGnD,6BACC,WACAmD,EAAkBjE,iBAEnBc,6BAA6B,WAAYpB,GAE9CuE,EAAkBhE,kBAAkBP,EACtC,CAEA,QAAchmE,IAAV6jF,EAAqB,CACvB,MAAMhB,EAAU,IAAIlmE,OACdioC,EAAYtsC,EAAIC,eAAeE,aACrC,IAAK,MAAM,UAAE5e,EAAS,EAAEwQ,EAAC,EAAEC,EAAC,SAAEy5E,EAAQ,KAAErnE,KAAUmnE,EAC3CnnE,GAGLmmE,EAAQC,QACNpmE,EACA,IAAIywD,UAAUtzE,GACXmqF,gBAAgBp/B,GAChBpN,UAAUntC,EAAGC,GACboJ,MAAMqwE,GAAWA,IAIxBzrE,EAAIxd,KAAK+nF,EACX,QACOtuF,KAAKuvF,gBACd,CAEA5oF,cAAAA,CAAe8qE,EAAOie,GAAS,IAAAC,EACP,QAAtBA,EAAA3vF,KAAKg2E,yBAAiB,IAAA2Z,GAAtBA,EAAwBtd,iBAAiB,cAAeZ,GACxDzxE,KAAKg4E,QAAQ4X,YAAcF,CAC7B,CAEA9oF,cAAAA,CAAe6qE,EAAOie,GAAS,IAAAG,EACP,QAAtBA,EAAA7vF,KAAKg2E,yBAAiB,IAAA6Z,GAAtBA,EAAwBxd,iBAAiB,cAAeZ,GACxDzxE,KAAKg4E,QAAQ8X,YAAcJ,CAC7B,CAEA7oF,SAAAA,CAAU4qE,EAAOtyD,GAAO,IAAA4wE,EACA,QAAtBA,EAAA/vF,KAAKg2E,yBAAiB,IAAA+Z,GAAtBA,EAAwB1d,iBAAiB,SAAUZ,GACnDzxE,KAAKg4E,QAAQgY,WAAa7wE,EAAQ,GACpC,CAEArY,UAAAA,CAAW2qE,EAAOwe,GAAS,IAAAC,EACH,QAAtBA,EAAAlwF,KAAKg2E,yBAAiB,IAAAka,GAAtBA,EAAwB7d,iBAAiB,UAAWZ,GACpDzxE,KAAKg4E,QAAQiY,SAAWA,CAC1B,CAEAlpF,OAAAA,CAAQ0qE,EAAO0e,EAAa1/D,GAAM,IAAA2/D,EAAAC,EACV,QAAtBD,EAAApwF,KAAKg2E,yBAAiB,IAAAoa,GAAtBA,EACI/d,iBAAiB,OAAQZ,GAC1BgB,0BAA0B,UAAW0d,EAAa1e,GACrD,MAAM6e,EAAUtwF,KAAK0kF,WAAWplF,IAAI6wF,GAC9BnY,EAAUh4E,KAAKg4E,QAErB,IAAKsY,EACH,MAAM,IAAInlF,MAAM,uBAADH,OAAwBmlF,IAsBzC,GApBAnY,EAAQ/c,WAAaq1B,EAAQr1B,YAAcx6D,EAIb,IAA1Bu3E,EAAQ/c,WAAW,IAAsC,IAA1B+c,EAAQ/c,WAAW,IACpDhwD,GAAK,gCAAkCklF,GAKrC1/D,EAAO,GACTA,GAAQA,EACRunD,EAAQuY,eAAiB,GAEzBvY,EAAQuY,cAAgB,EAG1BvwF,KAAKg4E,QAAQ3gB,KAAOi5B,EACpBtwF,KAAKg4E,QAAQwX,SAAW/+D,EAEpB6/D,EAAQ71B,YACV,OAGF,MAAMltD,EAAO+iF,EAAQx5B,YAAc,aAC7B05B,GACkB,QAAtBH,EAAAC,EAAQ35B,sBAAc,IAAA05B,OAAA,EAAtBA,EAAwB72B,MAAG,IAAAxuD,OAAQuC,EAAI,OAAAvC,OAAMslF,EAAQp1B,cAEvD,IAAIb,EAAO,SACPi2B,EAAQl2B,MACVC,EAAO,MACEi2B,EAAQj2B,OACjBA,EAAO,QAET,MAAMK,EAAS41B,EAAQ51B,OAAS,SAAW,SAM3C,IAAI+1B,EAAkBhgE,EAClBA,EAvsDc,GAwsDhBggE,EAxsDgB,GAysDPhgE,EAvsDO,MAwsDhBggE,EAxsDgB,KA0sDlBzwF,KAAKg4E,QAAQ0Y,cAAgBjgE,EAAOggE,EAEpCzwF,KAAK+jB,IAAIszC,KAAO,GAAHrsD,OAAM0vD,EAAM,KAAA1vD,OAAIqvD,EAAI,KAAArvD,OAAIylF,EAAe,OAAAzlF,OAAMwlF,EAC5D,CAEAxpF,oBAAAA,CAAqByqE,EAAOjuC,GAAM,IAAAmtD,EACV,QAAtBA,EAAA3wF,KAAKg2E,yBAAiB,IAAA2a,GAAtBA,EAAwBte,iBAAiB,oBAAqBZ,GAC9DzxE,KAAKg4E,QAAQ4Y,kBAAoBptD,CACnC,CAEAv8B,WAAAA,CAAYwqE,EAAOof,GAAM,IAAAC,EACD,QAAtBA,EAAA9wF,KAAKg2E,yBAAiB,IAAA8a,GAAtBA,EAAwBze,iBAAiB,WAAYZ,GACrDzxE,KAAKg4E,QAAQ+Y,SAAWF,CAC1B,CAEA3pF,QAAAA,CAASuqE,EAAO37D,EAAGC,GAAG,IAAAi7E,EACE,QAAtBA,EAAAhxF,KAAKg2E,yBAAiB,IAAAgb,GAAtBA,EACIze,qBAAqB,gBACtBD,sBAAsB,WAAYb,GACrCzxE,KAAKg4E,QAAQliE,EAAI9V,KAAKg4E,QAAQoX,OAASt5E,EACvC9V,KAAKg4E,QAAQjiE,EAAI/V,KAAKg4E,QAAQqX,OAASt5E,CACzC,CAEA5O,kBAAAA,CAAmBsqE,EAAO37D,EAAGC,GAC3B/V,KAAK8G,WAAW2qE,GAAQ17D,GACxB/V,KAAKkH,SAASuqE,EAAO37D,EAAGC,EAC1B,CAEA3O,aAAAA,CAAcqqE,EAAOz8D,GAAQ,IAAAi8E,EACL,QAAtBA,EAAAjxF,KAAKg2E,yBAAiB,IAAAib,GAAtBA,EACI1e,qBAAqB,gBACtBF,iBAAiB,aAAcZ,GAClC,MAAM,QAAEuG,GAAYh4E,KACpBg4E,EAAQkX,WAAal6E,EACrBgjE,EAAQmX,gBAAkBvgF,KAAKwuC,MAAMpoC,EAAO,GAAIA,EAAO,IAEvDgjE,EAAQliE,EAAIkiE,EAAQoX,MAAQ,EAC5BpX,EAAQjiE,EAAIiiE,EAAQqX,MAAQ,CAC9B,CAEAhoF,QAAAA,CAASoqE,GAAO,IAAAyf,EAAAC,EACdnxF,KAAKkH,SAASuqE,EAAO,EAAGzxE,KAAKg4E,QAAQiY,SAEf,QAAtBiB,EAAAlxF,KAAKg2E,yBAAiB,IAAAkb,GAAtBA,EAAwB5e,sBACtB,WAIgD,QAJtC6e,EAIVnxF,KAAKg2E,kBAAkB/B,eAAe,kBAAU,IAAAkd,EAAAA,EAAI1f,EAExD,CAWA2f,SAAAA,CACE3f,EACAzX,EACAlkD,EACAC,EACAs7E,EACAC,GAEA,MAAMvtE,EAAM/jB,KAAK+jB,IACXi0D,EAAUh4E,KAAKg4E,QACf3gB,EAAO2gB,EAAQ3gB,KACfu5B,EAAoB5Y,EAAQ4Y,kBAC5BpB,EAAWxX,EAAQwX,SAAWxX,EAAQ0Y,cACtCa,EACJX,EAAoBluF,EAChB8uF,KACJZ,EAAoBluF,IAEhBomF,EAAc9Q,EAAQ8Q,cAAgBzxB,EAAKE,YAC3Ck6B,EAAgBzZ,EAAQyZ,gBAAkBp6B,EAAKE,YAErD,IAAIpvC,EAWJ,IATGkvC,EAAKT,iBACJ46B,GACA1I,GACA2I,KACDp6B,EAAKE,cAENpvC,EAAOkvC,EAAKyC,iBAAiB95D,KAAK0kF,WAAY1qB,IAG5C7xC,IAASkvC,EAAKT,iBAAmBkyB,GAAe2I,GAAgB,KAAAC,EAOlE,IAAI3I,EACJ,GAPAhlE,EAAI3e,OACJ2e,EAAIk/B,UAAUntC,EAAGC,GACjBgO,EAAI5E,MAAMqwE,GAAWA,GAEC,QAAtBkC,EAAA1xF,KAAKg2E,yBAAiB,IAAA0b,GAAtBA,EAAwBpe,oBAAoB7B,EAAO1tD,EAAKszC,GAItDk6B,IAAmB7uF,GACnB6uF,IAAmB7uF,EAEnB,GAAI2uF,EAAsB,CACxBtI,EAAmBhlE,EAAIC,eACvBD,EAAI80D,gBAAgBwY,GACpB,MAAMM,EAAazyF,EAAAqlF,GAAAvkF,KAAK4xF,IAAcvgF,KAAnBrR,KACjBmoB,EACA4gE,EACAsI,GAEFttE,EAAI/d,KAAK2rF,EACX,MACE5tE,EAAI/d,KAAKmiB,GAGb,GACEopE,IAAmB7uF,GACnB6uF,IAAmB7uF,EAEnB,GAAI4uF,EAAwB,CAC1BvI,IAAAA,EAAqBhlE,EAAIC,gBACzBD,EAAI80D,gBAAgByY,GACpB,MAAM,EAAEvyF,EAAC,EAAEgT,EAAC,EAAEG,EAAC,EAAEC,GAAM42E,EACjB8I,EAAsBjgF,GAAKkD,iBAC/Bw8E,GAEIhiC,EAAS19C,GAAKtM,UAClB,CAACvG,EAAGgT,EAAGG,EAAGC,EAAG,EAAG,GAChB0/E,GAEFjgF,GAAKmD,8BAA8Bu6C,EAAQqwB,IAK3C57D,EAAIy9D,WAAa5yE,KAAKiG,IAAI8qE,GAAG,GAAIA,GAAG,IAAM6P,EAC1CzrE,EAAIje,OACF5G,EAAAqlF,GAAAvkF,KAAK4xF,IAAcvgF,KAAnBrR,KAAoBmoB,EAAM4gE,EAAkBuI,GAEhD,MACEvtE,EAAIy9D,WAAagO,EACjBzrE,EAAIje,OAAOqiB,GAGfpE,EAAI1e,SACN,KAAO,CAIH,IAAAysF,EAHF,GACEP,IAAmB7uF,GACnB6uF,IAAmB7uF,EAEnBqhB,EAAI+0C,SAASkB,EAAWlkD,EAAGC,GACL,QAAtB+7E,EAAA9xF,KAAKg2E,yBAAiB,IAAA8b,GAAtBA,EAAwBxe,oBACtB7B,EACA1tD,EACAszC,EACAm4B,EACA15E,EACAC,EACA,IAAMgO,EAAIguE,YAAY/3B,IAG1B,GACEu3B,IAAmB7uF,GACnB6uF,IAAmB7uF,EACnB,CAC4B,IAAAsvF,EAA5B,GAAIhyF,KAAKg2E,kBACe,QAAtBgc,EAAAhyF,KAAKg2E,yBAAiB,IAAAgc,GAAtBA,EACI1e,oBAAoB7B,EAAO1tD,EAAKszC,EAAMm4B,EAAU15E,EAAGC,EAAG,IACtDgO,EAAIguE,YAAY/3B,IAEjBma,mBAAmB1C,EAAO6E,IAE/BvyD,EAAIkuE,WAAWj4B,EAAWlkD,EAAGC,EAC/B,CACF,CAEA,GAAIy7E,EAAgB,KAAAU,GACHlyF,KAAKuvF,mBAALvvF,KAAKuvF,iBAAqB,KACnCvgF,KAAK,CACT1J,UAAWwe,GAAoBC,GAC/BjO,IACAC,IACAy5E,WACArnE,SAEoB,QAAtB+pE,EAAAlyF,KAAKg2E,yBAAiB,IAAAkc,GAAtBA,EAAwB5e,oBACtB7B,EACA1tD,EACAszC,EACAm4B,EACA15E,EACAC,EAEJ,CACF,CAEA,2BAAIo8E,GAGF,MAAQt+B,QAAS9vC,GAAQ/jB,KAAKm4E,eAAeC,UAC3C,0BACA,GACA,IAEFr0D,EAAI5E,MAAM,IAAK,GACf4E,EAAI+0C,SAAS,IAAK,EAAG,IACrB,MAAM5wC,EAAOnE,EAAIgO,aAAa,EAAG,EAAG,GAAI,IAAI7J,KAC5C,IAAIutB,GAAU,EACd,IAAK,IAAI/mC,EAAI,EAAGA,EAAIwZ,EAAK7pB,OAAQqQ,GAAK,EACpC,GAAIwZ,EAAKxZ,GAAK,GAAKwZ,EAAKxZ,GAAK,IAAK,CAChC+mC,GAAU,EACV,KACF,CAEF,OAAO3oC,GAAO9M,KAAM,0BAA2By1C,EACjD,CAEAnuC,QAAAA,CAASmqE,EAAO2gB,GAAQ,IAAAC,EAClBryF,KAAKg2E,oBACPh2E,KAAKg2E,kBACF7B,mBAAmB1C,EAAO6E,IAC1BrD,UAAUxB,GACTzxE,KAAKg4E,QAAQ4Y,kBAAoBluF,IACnC1C,KAAKg2E,kBACFnD,6BAA6B,WAAYpB,GACzCsB,wDAIP,MAAMiF,EAAUh4E,KAAKg4E,QACf3gB,EAAO2gB,EAAQ3gB,KACC,IAAAi7B,EAAtB,GAAIj7B,EAAKoD,YAGP,OAFAz6D,KAAKuyF,cAAc9gB,EAAO2gB,QACJ,QAAtBE,EAAAtyF,KAAKg2E,yBAAiB,IAAAsc,GAAtBA,EAAwBvd,wBAAwBtD,IAIlD,MAAM+d,EAAWxX,EAAQwX,SACL,IAAAgD,EAApB,GAAiB,IAAbhD,EAEF,YADsB,QAAtBgD,EAAAxyF,KAAKg2E,yBAAiB,IAAAwc,GAAtBA,EAAwB9d,gBAAgBjD,IAI1C,MAAM1tD,EAAM/jB,KAAK+jB,IACX2sE,EAAgB1Y,EAAQ0Y,cACxBd,EAAc5X,EAAQ4X,YACtBE,EAAc9X,EAAQ8X,YACtBS,EAAgBvY,EAAQuY,cACxBP,EAAahY,EAAQgY,WAAaO,EAClCkC,EAAeL,EAAO/zF,OACtBu8D,EAAWvD,EAAKuD,SAChB83B,EAAa93B,EAAW,GAAK,EAC7BQ,EAAkB/D,EAAK+D,gBACvBu3B,EAAoBnD,EAAWxX,EAAQ/c,WAAW,GAElD23B,EACJ5a,EAAQ4Y,oBAAsBluF,IAC7B20D,EAAKT,kBACLohB,EAAQ8Q,YAcX,IAAIuI,EAAsBC,EAC1B,GAbAvtE,EAAI3e,OACA4yE,EAAQkX,YACVnrE,EAAIze,aAAa0yE,EAAQkX,YAE3BnrE,EAAIk/B,UAAU+0B,EAAQliE,EAAGkiE,EAAQjiE,EAAIiiE,EAAQ+Y,UAEzCR,EAAgB,EAClBxsE,EAAI5E,MAAM6wE,GAAa,GAEvBjsE,EAAI5E,MAAM6wE,EAAY,GAIpBhY,EAAQ8Q,YAAa,CACvB/kE,EAAI3e,OACJ,MAAM0yE,EAAUE,EAAQ2G,UAAU/H,WAChC7yD,EACA/jB,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAEF4f,EAAuBvtE,GAAoBC,GAC3CA,EAAI1e,UACJ0e,EAAI00D,UAAYX,CAClB,CAEA,GAAIE,EAAQyZ,cAAe,CACzB1tE,EAAI3e,OACJ,MAAM0yE,EAAUE,EAAQ4G,YAAYhI,WAClC7yD,EACA/jB,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAEF6f,EAAyBxtE,GAAoBC,GAC7CA,EAAI1e,UACJ0e,EAAI26D,YAAc5G,CACpB,CAEA,IAAI0J,EAAYxJ,EAAQwJ,UACxB,MAAMriE,EAAQ64D,EAAQmX,gBACtB,GAAc,IAAVhwE,GAA6B,IAAdqiE,EAAiB,CAClC,MAAM+P,EACJvZ,EAAQ4Y,kBAAoBluF,EAE5B6uF,IAAmB7uF,GACnB6uF,IAAmB7uF,IAEnB8+E,EAAYxhF,KAAK6yF,sBAErB,MACErR,GAAariE,EAUf,GAPsB,IAAlBuxE,IACF3sE,EAAI5E,MAAMuxE,EAAeA,GACzBlP,GAAakP,GAGf3sE,EAAIy9D,UAAYA,EAEZnqB,EAAKmD,mBAAoB,CAC3B,MAAMs4B,EAAQ,GACd,IAAI9yE,EAAQ,EACZ,IAAK,MAAM+yE,KAASX,EAClBU,EAAM9jF,KAAK+jF,EAAMC,SACjBhzE,GAAS+yE,EAAM/yE,MAEjB,MAAMizE,EAAcH,EAAM7jF,KAAK,IAE/B,GADA8U,EAAI+0C,SAASm6B,EAAa,EAAG,GACE,OAA3BjzF,KAAKg2E,kBAA4B,CACnC,MAAMpC,EAAU7vD,EAAIguE,YAAYkB,GAChCjzF,KAAKg2E,kBACF3C,WACC5B,EACAzxE,KAAK+jB,KACJ6vD,EAAQC,sBACTD,EAAQE,wBACPF,EAAQG,wBACTH,EAAQI,0BAETe,wBAAwBtD,EAC7B,CAIA,OAHAuG,EAAQliE,GAAKkK,EAAQ2yE,EAAoB3C,EACzCjsE,EAAI1e,eACJrF,KAAK0sF,SAEP,CAEA,IACEh+E,EADEoH,EAAI,EAER,IAAKpH,EAAI,EAAGA,EAAI+jF,IAAgB/jF,EAAG,CACjC,MAAMqkF,EAAQX,EAAO1jF,GACrB,GAAqB,kBAAVqkF,EAAoB,CAC7Bj9E,GAAM48E,EAAaK,EAAQvD,EAAY,IACvC,QACF,CAEA,IAAI0D,GAAgB,EACpB,MAAMxD,GAAWqD,EAAMI,QAAUrD,EAAc,GAAKF,EAC9C51B,EAAY+4B,EAAMK,SAClBC,EAASN,EAAMM,OACrB,IAAIC,EAASC,EAgBT3f,EAfA5zD,EAAQ+yE,EAAM/yE,MAClB,GAAI46C,EAAU,CACZ,MAAM44B,EAAUT,EAAMS,SAAWp4B,EAC3Bq4B,IACFV,EAAMS,QAAUA,EAAQ,GAAa,GAARxzE,GAAe2yE,EAC1Ce,EAAKF,EAAQ,GAAKb,EAExB3yE,EAAQwzE,GAAWA,EAAQ,GAAKxzE,EAChCszE,EAAUG,EAAK/C,EACf6C,GAAWz9E,EAAI49E,GAAMhD,CACvB,MACE4C,EAAUx9E,EAAI46E,EACd6C,EAAU,EAKZ,GAAIl8B,EAAKsD,WAAa36C,EAAQ,EAAG,CAC/B4zD,EAAU7vD,EAAIguE,YAAY/3B,GAK1B,MAAM25B,EACc,IAAhB/f,EAAQ5zD,MAAgBwvE,EAAYkB,EACxC,GAAI1wE,EAAQ2zE,GAAiB3zF,KAAKmyF,wBAAyB,CACzD,MAAMyB,EAAkB5zE,EAAQ2zE,EAChCT,GAAgB,EAChBnvE,EAAI3e,OACJ2e,EAAI5E,MAAMy0E,EAAiB,GAC3BN,GAAWM,CACb,MAAW5zE,IAAU2zE,IACnBL,IACKtzE,EAAQ2zE,GAAiB,IAAQnE,EAAYkB,EAEtD,CAKiC,IAAAmD,EADjC,GAAI7zF,KAAKylF,iBAAmBsN,EAAMe,UAAYz8B,EAAKE,aACjD,GAAIq7B,IAAmBS,EAErBtvE,EAAI+0C,SAASkB,EAAWs5B,EAASC,GAEX,QAAtBM,EAAA7zF,KAAKg2E,yBAAiB,IAAA6d,GAAtBA,EAAwBvgB,oBACtB7B,EACA1tD,EAEA6vD,EAAU,CAAE5Y,KAAM,MAAS3D,EAC3Bm4B,EAAWkB,EACX4C,EACAC,EACA,IAAa,OAAP3f,QAAO,IAAPA,EAAAA,EAAW7vD,EAAIguE,YAAY/3B,SAWnC,GARAh6D,KAAKoxF,UACH3f,EACAzX,EACAs5B,EACAC,EACAlC,EACAC,GAEE+B,EAAQ,CACV,MAAMU,EACJT,EAAW9D,EAAW6D,EAAO/6B,OAAOxiD,EAAK46E,EACrCsD,EACJT,EAAW/D,EAAW6D,EAAO/6B,OAAOviD,EAAK26E,EAC3C1wF,KAAKoxF,UACH3f,EACA4hB,EAAOD,SACPW,EACAC,EACA3C,EACAC,EAEJ,CAOJx7E,GAHkB8kD,EACd56C,EAAQ2yE,EAAoBjD,EAAUa,EACtCvwE,EAAQ2yE,EAAoBjD,EAAUa,EAGtC2C,GACFnvE,EAAI1e,SAER,CACIu1D,EACFod,EAAQjiE,GAAKD,EAEbkiE,EAAQliE,GAAKA,EAAIk6E,EAEnBjsE,EAAI1e,UACJrF,KAAK0sF,UAEiB,QAAtB2F,EAAAryF,KAAKg2E,yBAAiB,IAAAqc,GAAtBA,EAAwBtd,wBAAwBtD,EAElD,CAEA8gB,aAAAA,CAAc9gB,EAAO2gB,GAEnB,MAAMruE,EAAM/jB,KAAK+jB,IACXi0D,EAAUh4E,KAAKg4E,QACf3gB,EAAO2gB,EAAQ3gB,KACfm4B,EAAWxX,EAAQwX,SACnBe,EAAgBvY,EAAQuY,cACxBmC,EAAar7B,EAAKuD,SAAW,GAAK,EAClCg1B,EAAc5X,EAAQ4X,YACtBE,EAAc9X,EAAQ8X,YACtBE,EAAahY,EAAQgY,WAAaO,EAClCt1B,EAAa+c,EAAQ/c,YAAcx6D,EACnCgyF,EAAeL,EAAO/zF,OAG5B,IAAIqQ,EAAGqkF,EAAO/yE,EAAOi0E,EAErB,GAHEjc,EAAQ4Y,oBAAsBluF,GAGI,IAAb8sF,EACrB,OAEFxvF,KAAK8lF,wBAAwB,IAAM,EACnC9lF,KAAK+lF,2BAA6B,KAElChiE,EAAI3e,OACA4yE,EAAQkX,YACVnrE,EAAIze,aAAa0yE,EAAQkX,YAE3BnrE,EAAIk/B,UAAU+0B,EAAQliE,EAAGkiE,EAAQjiE,EAAIiiE,EAAQ+Y,UAE7ChtE,EAAI5E,MAAM6wE,EAAYO,GAItB,MAAMva,EAAoBh2E,KAAKg2E,kBAK/B,IAJAh2E,KAAKg2E,kBAAoBA,EACrB,IAAID,GAA8BC,EAAmBvE,GACrD,KAEC/iE,EAAI,EAAGA,EAAI+jF,IAAgB/jF,EAAG,CAEjC,GADAqkF,EAAQX,EAAO1jF,GACM,kBAAVqkF,EAAoB,CAC7BkB,EAAiBvB,EAAaK,EAAQvD,EAAY,IAClDxvF,KAAK+jB,IAAIk/B,UAAUgxC,EAAe,GAClCjc,EAAQliE,GAAKm+E,EAAgBjE,EAC7B,QACF,CAEA,MAAMN,GAAWqD,EAAMI,QAAUrD,EAAc,GAAKF,EAC9CvT,EAAehlB,EAAK+B,qBAAqB25B,EAAMmB,gBAChD7X,EAEMr8E,KAAKylF,iBACdzlF,KAAKoF,OACL2e,EAAI5E,MAAMqwE,EAAUA,GACpBzrE,EAAIze,aAAa21D,GACjBj7D,KAAK69E,oBAAoBxB,GACzBr8E,KAAKqF,WANL4F,GAAK,oBAADD,OAAqB+nF,EAAMmB,eAAc,wBAS/C,MAAMphF,EAAI,CAACigF,EAAM/yE,MAAO,GACxBpO,GAAKiB,eAAeC,EAAGmoD,GACvBj7C,EAAQlN,EAAE,GAAK08E,EAAWE,EAE1B3rE,EAAIk/B,UAAUjjC,EAAO,GACrBg4D,EAAQliE,GAAKkK,EAAQgwE,CACvB,CACAjsE,EAAI1e,UACA2wE,IACFh2E,KAAKg2E,kBAAoBA,EAE7B,CAGAtuE,YAAAA,CAAa+pE,EAAO0iB,EAAQC,GAG5B,CAEAzsF,qBAAAA,CAAsB8pE,EAAO0iB,EAAQC,EAAQC,EAAKC,EAAKC,EAAKC,GAAK,IAAAC,EAC/D,MAAMluF,EAAO,IAAI6hB,OACjB7hB,EAAKoN,KAAK0gF,EAAKC,EAAKC,EAAMF,EAAKG,EAAMF,GACrCt0F,KAAK+jB,IAAIxd,KAAKA,GACQ,QAAtBkuF,EAAAz0F,KAAKg2E,yBAAiB,IAAAye,GAAtBA,EACIphB,WAAW5B,EAAOzxE,KAAK+jB,IAAKswE,EAAKE,EAAKD,EAAKE,GAC5CthB,cAAczB,EAAOzxE,KAAK+jB,IAAKswE,EAAKE,EAAKD,EAAKE,GACjDx0F,KAAKsG,QAAQmrE,EACf,CAGAijB,iBAAAA,CAAkBjjB,EAAOqF,GACvB,IAAIgB,EACJ,GAAc,kBAAVhB,EAAG,GAAwB,CAC7B,MAAM0B,EAAgBx4E,KAAKw4E,eAAiB10D,GAAoB9jB,KAAK+jB,KAC/Dq4D,EAAwB,CAC5BqB,qBAAsBA,CAAC15D,EAAK4wE,IAC1B,IAAInQ,GACFzgE,EACA/jB,KAAK0kF,WACL1kF,KAAK+5D,KACL/5D,KAAK8/E,cACL9/E,KAAKk+B,cACL,CACE2mD,sBAAuB7kF,KAAK6kF,sBAC5BC,mBAAoB9kF,KAAK8kF,yBAE3Br5E,OACAA,EACAzL,KAAKg2E,kBACD,IAAID,GACF/1E,KAAKg2E,kBACL2e,GACmB,GAErB,OAGV7c,EAAU,IAAIqE,GACZrF,EACA92E,KAAK+jB,IACLq4D,EACA5D,EAEJ,MACEV,EAAU93E,KAAK40F,YAAYnjB,EAAOqF,EAAG,GAAIA,EAAG,IAE9C,OAAOgB,CACT,CAEA/vE,eAAAA,CAAgB0pE,GAAgB,IAAAojB,EACR,QAAtBA,EAAA70F,KAAKg2E,yBAAiB,IAAA6e,GAAtBA,EAAwBxiB,iBAAiB,cAAeZ,GAAM,QAAAqjB,EAAA31F,UAAAd,OADtC+Z,EAAI,IAAA7G,MAAAujF,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJ38E,EAAI28E,EAAA,GAAA51F,UAAA41F,GAE5B/0F,KAAKg4E,QAAQ4G,YAAc5+E,KAAK00F,kBAAkBjjB,EAAOr5D,GACzDpY,KAAKg4E,QAAQyZ,eAAgB,CAC/B,CAEAxpF,aAAAA,CAAcwpE,GAAgB,IAAAujB,EACN,QAAtBA,EAAAh1F,KAAKg2E,yBAAiB,IAAAgf,GAAtBA,EAAwB3iB,iBAAiB,YAAaZ,GAAM,QAAAwjB,EAAA91F,UAAAd,OADtC+Z,EAAI,IAAA7G,MAAA0jF,EAAA,EAAAA,EAAA,KAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJ98E,EAAI88E,EAAA,GAAA/1F,UAAA+1F,GAE1Bl1F,KAAKg4E,QAAQ2G,UAAY3+E,KAAK00F,kBAAkBjjB,EAAOr5D,GACvDpY,KAAKg4E,QAAQ8Q,aAAc,CAC7B,CAEA1gF,iBAAAA,CAAkBqpE,EAAO9tD,GAAO,IAAAwxE,EACR,QAAtBA,EAAAn1F,KAAKg2E,yBAAiB,IAAAmf,GAAtBA,EAAwB9iB,iBAAiB,cAAeZ,GACxDzxE,KAAK+jB,IAAI26D,YAAc1+E,KAAKg4E,QAAQ4G,YAAcj7D,EAClD3jB,KAAKg4E,QAAQyZ,eAAgB,CAC/B,CAEAtnF,oBAAAA,CAAqBsnE,GAAO,IAAA2jB,EACJ,QAAtBA,EAAAp1F,KAAKg2E,yBAAiB,IAAAof,GAAtBA,EAAwB/iB,iBAAiB,cAAeZ,GACxDzxE,KAAK+jB,IAAI26D,YAAc1+E,KAAKg4E,QAAQ4G,YAAc,cAClD5+E,KAAKg4E,QAAQyZ,eAAgB,CAC/B,CAEAppF,eAAAA,CAAgBopE,EAAO9tD,GAAO,IAAA0xE,EACN,QAAtBA,EAAAr1F,KAAKg2E,yBAAiB,IAAAqf,GAAtBA,EAAwBhjB,iBAAiB,YAAaZ,GACtDzxE,KAAK+jB,IAAI00D,UAAYz4E,KAAKg4E,QAAQ2G,UAAYh7D,EAC9C3jB,KAAKg4E,QAAQ8Q,aAAc,CAC7B,CAEA1+E,kBAAAA,CAAmBqnE,GAAO,IAAA6jB,EACF,QAAtBA,EAAAt1F,KAAKg2E,yBAAiB,IAAAsf,GAAtBA,EAAwBjjB,iBAAiB,YAAaZ,GACtDzxE,KAAK+jB,IAAI00D,UAAYz4E,KAAKg4E,QAAQ2G,UAAY,cAC9C3+E,KAAKg4E,QAAQ8Q,aAAc,CAC7B,CAEA8L,WAAAA,CAAYnjB,EAAOxX,GAAsB,IACnC6d,EADoB9iE,EAAM7V,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAWjC,OATIa,KAAK0lF,eAAe9mF,IAAIq7D,GAC1B6d,EAAU93E,KAAK0lF,eAAepmF,IAAI26D,IAElC6d,EFv7DN,SAA2BhB,GACzB,OAAQA,EAAG,IACT,IAAK,cACH,OAAO,IAAID,GAA0BC,GACvC,IAAK,OACH,OAAO,IAAImE,GAAmBnE,GAChC,IAAK,QACH,OAAO,IAAImF,GAEf,MAAM,IAAI9wE,MAAM,oBAADH,OAAqB8rE,EAAG,IACzC,CE66DgBye,CAAkBv1F,KAAKimF,UAAUxU,EAAOxX,IAClDj6D,KAAK0lF,eAAelnF,IAAIy7D,EAAO6d,IAE7B9iE,IACF8iE,EAAQ9iE,OAASA,GAEZ8iE,CACT,CAEAtvE,WAAAA,CAAYipE,EAAOxX,GAAO,IAAAu7B,EACxB,IAAKx1F,KAAKylF,eACR,OAEF,MAAM1hE,EAAM/jB,KAAK+jB,IAEjB/jB,KAAKoF,KAAKqsE,GACV,MAAMqG,EAAU93E,KAAK40F,YAAYnjB,EAAOxX,GACxCl2C,EAAI00D,UAAYX,EAAQlB,WACtB7yD,EACA/jB,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAGF,MAAMgkB,EAAMxxE,GAA2BF,GACvC,GAAI0xE,EAAK,CACP,MAAM,MAAEz1E,EAAK,OAAEC,GAAW8D,EAAI4O,OACxBrgB,EAASstE,GAAavqE,QAC5BzD,GAAK8B,wBAAwB,CAAC,EAAG,EAAGsM,EAAOC,GAASw1E,EAAKnjF,GACzD,MAAO2D,EAAIC,EAAIC,EAAIC,GAAM9D,EAEzBtS,KAAK+jB,IAAIyiE,SAASvwE,EAAIC,EAAIC,EAAKF,EAAIG,EAAKF,EAC1C,MAOElW,KAAK+jB,IAAIyiE,UAAU,MAAO,KAAM,KAAM,MAGlB,QAAtBgP,EAAAx1F,KAAKg2E,yBAAiB,IAAAwf,GAAtBA,EACIviB,UAAUxB,GAEXkC,mBAAmBlC,GACnB0C,mBAAmB1C,EAAO6E,IAC1BnC,mBAAmB1C,EAAO6E,IAC1B5B,gBAAgBjD,GAEnBzxE,KAAK0sF,QAAQ1sF,KAAKg4E,QAAQC,6BAC1Bj4E,KAAKqF,QAAQosE,EACf,CAGAhpE,gBAAAA,GACEyC,GAAY,mCACd,CAEAxC,cAAAA,GACEwC,GAAY,iCACd,CAEA9B,qBAAAA,CAAsBqoE,EAAOz8D,EAAQgmD,GACnC,GAAKh7D,KAAKylF,iBAGVzlF,KAAKoF,KAAKqsE,GACVzxE,KAAKolF,mBAAmBp2E,KAAKhP,KAAKw4E,eAE9BxjE,GACFhV,KAAKsF,UAAUmsE,KAAUz8D,GAE3BhV,KAAKw4E,cAAgB10D,GAAoB9jB,KAAK+jB,KAE1Ci3C,GAAM,KAAA06B,EACR9jF,GAAK8B,wBACHsnD,EACAh7D,KAAKw4E,cACLx4E,KAAKg4E,QAAQ1lE,QAEf,MAAO2D,EAAIC,EAAIC,EAAIC,GAAM4kD,EACnBz0D,EAAO,IAAI6hB,OACjB7hB,EAAKoN,KAAKsC,EAAIC,EAAIC,EAAKF,EAAIG,EAAKF,GAChClW,KAAK+jB,IAAIxd,KAAKA,GACQ,QAAtBmvF,EAAA11F,KAAKg2E,yBAAiB,IAAA0f,GAAtBA,EAAwBxiB,cAAczB,EAAOzxE,KAAK+jB,IAAK9N,EAAIE,EAAID,EAAIE,GACnEpW,KAAKsG,QAAQmrE,EACf,CACF,CAEApoE,mBAAAA,CAAoBooE,GACbzxE,KAAKylF,iBAGVzlF,KAAKqF,QAAQosE,GACbzxE,KAAKw4E,cAAgBx4E,KAAKolF,mBAAmBvoE,MAC/C,CAEAvT,UAAAA,CAAWmoE,EAAOkkB,GAAO,IAAAC,EACvB,IAAK51F,KAAKylF,eACR,OAGFzlF,KAAKoF,KAAKqsE,GAGNzxE,KAAK+qF,cACP/qF,KAAKirF,eACLjrF,KAAKg4E,QAAQ4S,YAAc,MAG7B,MAAMiL,EAAa71F,KAAK+jB,IAcnB4xE,EAAMG,UACTjrF,GAAK,sCAKH8qF,EAAMI,UACR9qF,GAAK,kCAGP,MAAM89E,EAAmBjlE,GAAoB+xE,GAI7C,GAHIF,EAAM3gF,QACR6gF,EAAWvwF,aAAaqwF,EAAM3gF,SAE3B2gF,EAAM36B,KACT,MAAM,IAAI7vD,MAAM,6BAKlB,IAAI82D,EAAS2d,GAAavqE,QAC1BzD,GAAK8B,wBACHiiF,EAAM36B,KACNl3C,GAAoB+xE,GACpB5zB,GAIF,MAAM+zB,EAAe,CACnB,EACA,EACAH,EAAWljE,OAAO3S,MAClB61E,EAAWljE,OAAO1S,QAEpBgiD,EAASrwD,GAAK0D,UAAU2sD,EAAQ+zB,IAAiB,CAAC,EAAG,EAAG,EAAG,GAG3D,MAAM32E,EAAUzQ,KAAKiY,MAAMo7C,EAAO,IAC5B3iD,EAAU1Q,KAAKiY,MAAMo7C,EAAO,IAC5BqnB,EAAa16E,KAAKiG,IAAIjG,KAAKiX,KAAKo8C,EAAO,IAAM5iD,EAAS,GACtDkqE,EAAc36E,KAAKiG,IAAIjG,KAAKiX,KAAKo8C,EAAO,IAAM3iD,EAAS,GAE7Dtf,KAAKg4E,QAAQ2J,uBAAuB,CAAC,EAAG,EAAG2H,EAAYC,IAEvD,IAAI2B,EAAU,UAAYlrF,KAAK09E,WAC3BiY,EAAM/I,QAER1B,GAAW,UAAalrF,KAAKslF,eAAiB,GAEhD,MAAM6F,EAAgBnrF,KAAKm4E,eAAeC,UACxC8S,EACA5B,EACAC,GAEI0M,EAAW9K,EAAct3B,QAI/BoiC,EAAShzC,WAAW5jC,GAAUC,GAC9B22E,EAAS3wF,aAAayjF,GAGtB,IAAIxiF,EAAO,IAAI6hB,OACf,MAAOnS,EAAIC,EAAIC,EAAIC,GAAMu/E,EAAM36B,KAE/B,GADAz0D,EAAKoN,KAAKsC,EAAIC,EAAIC,EAAKF,EAAIG,EAAKF,GAC5By/E,EAAM3gF,OAAQ,CAChB,MAAMmT,EAAO,IAAIC,OACjBD,EAAKomE,QAAQhoF,EAAM,IAAIqyE,UAAU+c,EAAM3gF,SACvCzO,EAAO4hB,CACT,CACA8tE,EAAS1vF,KAAKA,GAEVovF,EAAM/I,OAER5sF,KAAKqlF,WAAWr2E,KAAK,CACnB2jB,OAAQw4D,EAAcx4D,OACtBkhC,QAASoiC,EACT52E,UACAC,UACA+tE,QAASsI,EAAM/I,MAAMS,QACrBC,SAAUqI,EAAM/I,MAAMU,SACtBC,YAAaoI,EAAM/I,MAAMW,aAAe,KACxC2I,sBAAuB,OAIxBP,EAAM/I,QAIP5sF,KAAKg2E,oBAIL6f,EAAWhd,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GACvCgd,EAAW5yC,UAAU5jC,EAASC,GAC9Bu2E,EAAWzwF,QAIb49E,GAAa6S,EAAYI,GACzBj2F,KAAK+jB,IAAMkyE,EACW,QAAtBL,EAAA51F,KAAKg2E,yBAAiB,IAAA4f,GAAtBA,EACI9iB,4CAA4C,CAC5C,YACA,cACA,6BAEDX,kBAAkB0jB,GACrB71F,KAAKmF,UAAUssE,EAAO,CACpB,CAAC,KAAM,eACP,CAAC,KAAM,GACP,CAAC,KAAM,KAETzxE,KAAKmlF,WAAWn2E,KAAK6mF,GACrB71F,KAAK09E,YACP,CAEAn0E,QAAAA,CAASkoE,EAAOkkB,GAAO,IAAAQ,EACrB,IAAKn2F,KAAKylF,eACR,OAEFzlF,KAAK09E,aACL,MAAMuY,EAAWj2F,KAAK+jB,IAChBA,EAAM/jB,KAAKmlF,WAAWtoE,MAQ5B,GAPA7c,KAAK+jB,IAAMA,EAGX/jB,KAAK+jB,IAAI2lE,uBAAwB,EAEX,QAAtByM,EAAAn2F,KAAKg2E,yBAAiB,IAAAmgB,GAAtBA,EAAwB/jB,mBAEpBujB,EAAM/I,MACR5sF,KAAKulF,UAAYvlF,KAAKqlF,WAAWxoE,MACjC7c,KAAKqF,QAAQosE,GACTzxE,KAAKg2E,mBACPh2E,KAAK+jB,IAAI1e,cAEN,CACLrF,KAAK+jB,IAAI1e,UACT,MAAM+wF,EAAatyE,GAAoB9jB,KAAK+jB,KAC5C/jB,KAAKqF,QAAQosE,GACbzxE,KAAK+jB,IAAI3e,OACTpF,KAAK+jB,IAAI80D,gBAAgBud,GACzB,MAAMzJ,EAAW/M,GAAavqE,QAC9BzD,GAAK8B,wBACH,CAAC,EAAG,EAAGuiF,EAAStjE,OAAO3S,MAAOi2E,EAAStjE,OAAO1S,QAC9Cm2E,EACAzJ,GAEF3sF,KAAK+jB,IAAI+N,UAAUmkE,EAAStjE,OAAQ,EAAG,GACvC3yB,KAAK+jB,IAAI1e,UACTrF,KAAK0sF,QAAQC,EACf,CACF,CAEAnjF,eAAAA,CAAgBioE,EAAOh4D,EAAI9F,EAAMrO,EAAW0P,EAAQqhF,GAelD,GAVAn3F,EAAAqlF,GAAAvkF,KAAK6nF,IAAoBx2E,KAAzBrR,MACAwjF,GAAkBxjF,KAAK+jB,KAEvB/jB,KAAK+jB,IAAI3e,OACTpF,KAAKoF,KAAKqsE,GAENzxE,KAAKw4E,eACPx4E,KAAK+jB,IAAI80D,gBAAgB74E,KAAKw4E,eAG5B7kE,EAAM,CACR,MAAMqM,EAAQrM,EAAK,GAAKA,EAAK,GACvBsM,EAAStM,EAAK,GAAKA,EAAK,GAE9B,GAAI0iF,GAAgBr2F,KAAK4kF,oBAAqB,EAC5Ct/E,EAAYA,EAAU+P,SACZ,IAAM1B,EAAK,GACrBrO,EAAU,IAAMqO,EAAK,IAErBA,EAAOA,EAAK0B,SACP,GAAK1B,EAAK,GAAK,EACpBA,EAAK,GAAKqM,EACVrM,EAAK,GAAKsM,EAEVrO,GAAKmD,8BAA8B+O,GAAoB9jB,KAAK+jB,KAAM47D,IAClE,MAAM,cAAEgG,GAAkB3lF,KACpB+8E,EAAcnuE,KAAKiX,KACvB7F,EAAQhgB,KAAK4lF,aAAeD,GAExB3I,EAAepuE,KAAKiX,KACxB5F,EAASjgB,KAAK6lF,aAAeF,GAG/B3lF,KAAKs2F,iBAAmBt2F,KAAK8/E,cAAchnE,OACzCikE,EACAC,GAEF,MAAM,OAAErqD,EAAM,QAAEkhC,GAAY7zD,KAAKs2F,iBACjCt2F,KAAK4kF,oBAAoBpmF,IAAIib,EAAIkZ,GACjC3yB,KAAKs2F,iBAAiBC,SAAWv2F,KAAK+jB,IACtC/jB,KAAK+jB,IAAM8vC,EACX7zD,KAAK+jB,IAAI3e,OACTpF,KAAK+jB,IAAI80D,aAAa8G,GAAG,GAAI,EAAG,GAAIA,GAAG,GAAI,EAAG1/D,EAAS0/D,GAAG,IAE1D6D,GAAkBxjF,KAAK+jB,IACzB,KAAO,CACLy/D,GAAkBxjF,KAAK+jB,KAGvB/jB,KAAKsG,QAAQmrE,GAEb,MAAMlrE,EAAO,IAAI6hB,OACjB7hB,EAAKoN,KAAKA,EAAK,GAAIA,EAAK,GAAIqM,EAAOC,GACnCjgB,KAAK+jB,IAAIxd,KAAKA,EAChB,CACF,CAEAvG,KAAKg4E,QAAU,IAAIoJ,GACjBphF,KAAK+jB,IAAI4O,OAAO3S,MAChBhgB,KAAK+jB,IAAI4O,OAAO1S,QAGlBjgB,KAAKsF,UAAUmsE,KAAUnsE,GACzBtF,KAAKsF,UAAUmsE,KAAUz8D,EAC3B,CAEAvL,aAAAA,CAAcgoE,GACRzxE,KAAKs2F,mBACPt2F,KAAK+jB,IAAI1e,UACTnG,EAAAqlF,GAAAvkF,KAAK+nF,IAAW12E,KAAhBrR,MAEAA,KAAK+jB,IAAM/jB,KAAKs2F,iBAAiBC,gBAC1Bv2F,KAAKs2F,iBAAiBC,gBACtBv2F,KAAKs2F,iBAEhB,CAEA5sF,qBAAAA,CAAsB+nE,EAAOwW,GAAK,IAAAuO,EAChC,IAAKx2F,KAAKylF,eACR,OAGF,MAAMjxB,EAAQyzB,EAAIzzB,OAClByzB,EAAMjoF,KAAKimF,UAAUxU,EAAOwW,EAAI//D,KAAM+/D,IAClCzzB,MAAQA,EAEZ,MAAMzwC,EAAM/jB,KAAK+jB,IACX8+D,EAAO7iF,KAAK2oF,kBAAkBlX,EAAOwW,GACrCgB,EAAapG,EAAKlwD,OAExB5O,EAAI3e,OAGJ2e,EAAI80D,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAChC90D,EAAI+N,UAAUm3D,EAAYpG,EAAKxjE,QAASwjE,EAAKvjE,SACvB,QAAtBk3E,EAAAx2F,KAAKg2E,yBAAiB,IAAAwgB,GAAtBA,EACIvjB,UAAUxB,GACX4B,WACC5B,EACAzxE,KAAK+jB,IACL8+D,EAAKxjE,QACLwjE,EAAKxjE,QAAU4pE,EAAWjpE,MAC1B6iE,EAAKvjE,QACLujE,EAAKvjE,QAAU2pE,EAAWhpE,QAE3By0D,gBAAgBjD,GACnB1tD,EAAI1e,UACJrF,KAAK0sF,SACP,CAEA1iF,2BAAAA,CACEynE,EACAwW,EACA3O,GAKA,IAAAmd,EAAAC,EAAA,IAJAC,EAAKx3F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EACRy3F,EAAKz3F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EACRo6E,EAAMp6E,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EACNorF,EAAS13F,UAAAd,OAAA,EAAAc,UAAA,QAAAsM,EAET,IAAKzL,KAAKylF,eACR,OAGFwC,EAAMjoF,KAAKimF,UAAUxU,EAAOwW,EAAI//D,KAAM+/D,GAEtC,MAAMlkE,EAAM/jB,KAAK+jB,IACjBA,EAAI3e,OACJ,MAAM2jF,EAAmBjlE,GAAoBC,GAC7CA,EAAIze,UAAUg0E,EAAQqd,EAAOC,EAAOrd,EAAQ,EAAG,GAC/C,MAAMsJ,EAAO7iF,KAAK2oF,kBAAkBlX,EAAOwW,GAE3ClkE,EAAI80D,aACF,EACA,EACA,EACA,EACAgK,EAAKxjE,QAAU0pE,EAAiB,GAChClG,EAAKvjE,QAAUypE,EAAiB,IAEZ,QAAtB0N,EAAAz2F,KAAKg2E,yBAAiB,IAAAygB,GAAtBA,EAAwBxjB,UAAUxB,GAClC,IAAK,IAAI/iE,EAAI,EAAGuS,EAAK41E,EAAUx4F,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,KAAAooF,EACrD,MAAMC,EAAQnlF,GAAKtM,UAAUyjF,EAAkB,CAC7CzP,EACAqd,EACAC,EACArd,EACAsd,EAAUnoF,GACVmoF,EAAUnoF,EAAI,KAKhBqV,EAAI+N,UAAU+wD,EAAKlwD,OAAQokE,EAAM,GAAIA,EAAM,IACrB,QAAtBD,EAAA92F,KAAKg2E,yBAAiB,IAAA8gB,GAAtBA,EAAwBzjB,WACtB5B,EACAzxE,KAAK+jB,IACLgzE,EAAM,GACNA,EAAM,GAAKlU,EAAKlwD,OAAO3S,MACvB+2E,EAAM,GACNA,EAAM,GAAKlU,EAAKlwD,OAAO1S,OAE3B,CACA8D,EAAI1e,UACJrF,KAAK0sF,UAEiB,QAAtBgK,EAAA12F,KAAKg2E,yBAAiB,IAAA0gB,GAAtBA,EAAwBhiB,gBAAgBjD,EAC1C,CAEA9nE,0BAAAA,CAA2B8nE,EAAOulB,GAAQ,IAAAC,EAAAC,EACxC,IAAKl3F,KAAKylF,eACR,OAEF,MAAM1hE,EAAM/jB,KAAK+jB,IAEX46D,EAAY3+E,KAAKg4E,QAAQ2G,UACzBkK,EAAgB7oF,KAAKg4E,QAAQ8Q,YAEb,QAAtBmO,EAAAj3F,KAAKg2E,yBAAiB,IAAAihB,GAAtBA,EACIhkB,UAAUxB,GACX0C,mBAAmB1C,EAAO6E,IAE7B,IAAK,MAAM5kD,KAASslE,EAAQ,KAAAG,EAC1B,MAAM,KAAEjvE,EAAI,MAAElI,EAAK,OAAEC,EAAM,UAAE3a,GAAcosB,EAErCu3D,EAAajpF,KAAKm4E,eAAeC,UACrC,aACAp4D,EACAC,GAEIutE,EAAUvE,EAAWp1B,QAC3B25B,EAAQpoF,OAGR29E,GAAmByK,EADPxtF,KAAKimF,UAAUxU,EAAOvpD,EAAMwJ,IAGxC87D,EAAQ1J,yBAA2B,YAEnC0J,EAAQ/U,UAAYoQ,EAChBlK,EAAU/H,WACR4W,EACAxtF,KACAikB,GAA2BF,GAC3BwyD,GACA9E,GAEFkN,EACJ6O,EAAQhH,SAAS,EAAG,EAAGxmE,EAAOC,GAE9ButE,EAAQnoF,UAER0e,EAAI3e,OACJ2e,EAAIze,aAAaA,GACjBye,EAAI5E,MAAM,GAAI,GACd8gE,GACEl8D,EACAklE,EAAWt2D,OACX,EACA,EACA3S,EACAC,EACA,GACC,EACD,EACA,GAGoB,QAAtBk3E,EAAAn3F,KAAKg2E,yBAAiB,IAAAmhB,GAAtBA,EAAwB9jB,WAAW5B,EAAO1tD,EAAK,EAAG/D,EAAO,EAAGC,GAC5D8D,EAAI1e,SACN,CACArF,KAAK0sF,UACiB,QAAtBwK,EAAAl3F,KAAKg2E,yBAAiB,IAAAkhB,GAAtBA,EAAwBxiB,gBAAgBjD,EAC1C,CAEA7nE,iBAAAA,CAAkB6nE,EAAOxX,GACvB,IAAKj6D,KAAKylF,eACR,OAEF,MAAM3D,EAAU9hF,KAAKimF,UAAUxU,EAAOxX,GACjC6nB,EAKL9hF,KAAK6J,wBAAwB4nE,EAAOqQ,GAJlC72E,GAAK,kCAKT,CAEAlB,uBAAAA,CAAwB0nE,EAAOxX,EAAOqf,EAAQC,EAAQsd,GACpD,IAAK72F,KAAKylF,eACR,OAEF,MAAM3D,EAAU9hF,KAAKimF,UAAUxU,EAAOxX,GACtC,IAAK6nB,EAEH,YADA72E,GAAK,mCAIP,MAAM+U,EAAQ8hE,EAAQ9hE,MAChBC,EAAS6hE,EAAQ7hE,OACjB4D,EAAM,GACZ,IAAK,IAAInV,EAAI,EAAGuS,EAAK41E,EAAUx4F,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAClDmV,EAAI7U,KAAK,CACP1J,UAAW,CAACg0E,EAAQ,EAAG,EAAGC,EAAQsd,EAAUnoF,GAAImoF,EAAUnoF,EAAI,IAC9DoH,EAAG,EACHC,EAAG,EACHwO,EAAGvE,EACHwE,EAAGvE,IAGPjgB,KAAK8J,6BAA6B2nE,EAAOqQ,EAASj+D,EACpD,CAEAuzE,yBAAAA,CAA0BrzE,GAMxB,MALkC,SAA9B/jB,KAAKg4E,QAAQ8S,eACf/mE,EAAIsmD,OAASrqE,KAAKg4E,QAAQ8S,aAC1B/mE,EAAI+N,UAAU/N,EAAI4O,OAAQ,EAAG,GAC7B5O,EAAIsmD,OAAS,QAERtmD,EAAI4O,MACb,CAEA0kE,yBAAAA,CAA0BvV,GACxB,GAAkC,SAA9B9hF,KAAKg4E,QAAQ8S,aACf,OAAOhJ,EAAQtvD,OAEjB,MAAM,OAAEA,EAAM,MAAExS,EAAK,OAAEC,GAAW6hE,EAC5B5J,EAAYl4E,KAAKm4E,eAAeC,UACpC,cACAp4D,EACAC,GAEIo4D,EAASH,EAAUrkB,QAKzB,OAJAwkB,EAAOhO,OAASrqE,KAAKg4E,QAAQ8S,aAC7BzS,EAAOvmD,UAAUU,EAAQ,EAAG,GAC5B6lD,EAAOhO,OAAS,OAET6N,EAAUvlD,MACnB,CAEA9oB,uBAAAA,CAAwB4nE,EAAOqQ,GAAS,IAAAwV,EACtC,IAAKt3F,KAAKylF,eACR,OAEF,MAAMzlE,EAAQ8hE,EAAQ9hE,MAChBC,EAAS6hE,EAAQ7hE,OACjB8D,EAAM/jB,KAAK+jB,IAEjB/jB,KAAKoF,KAAKqsE,GAMV,MAAM,OAAEpH,GAAWtmD,EAQnB,IAAIwzE,EACJ,GARe,SAAXltB,GAAgC,KAAXA,IACvBtmD,EAAIsmD,OAAS,QAIftmD,EAAI5E,MAAM,EAAIa,GAAQ,EAAIC,GAGtB6hE,EAAQtvD,OACV+kE,EAAav3F,KAAKq3F,0BAA0BvV,QACvC,GACmB,oBAAhB0V,aAA8B1V,aAAmB0V,cACxD1V,EAAQ55D,KAGTqvE,EAAazV,MACR,CACL,MAKMzJ,EALYr4E,KAAKm4E,eAAeC,UACpC,cACAp4D,EACAC,GAEuB4zC,QACzBguB,GAAmBxJ,EAAQyJ,GAC3ByV,EAAav3F,KAAKo3F,0BAA0B/e,EAC9C,CAEA,MAAMtzD,EAAS/kB,KAAKgoF,YAClBuP,EACAtzE,GAA2BF,IAE7BA,EAAI2lE,sBAAwB3F,GAC1BjgE,GAAoBC,GACpB+9D,EAAQkC,aAGY,QAAtBsT,EAAAt3F,KAAKg2E,yBAAiB,IAAAshB,GAAtBA,EACIrkB,UAAUxB,GACX4B,WAAW5B,EAAO1tD,EAAK,EAAG/D,GAAQC,EAAQ,GAC1Ck0D,mBAAmB1C,EAAO6E,IAC1B5B,gBAAgBjD,GAEnBwO,GACEl8D,EACAgB,EAAOkjE,IACP,EACA,EACAljE,EAAOyjE,WACPzjE,EAAO0jE,YACP,GACCxoE,EACDD,EACAC,GAEFjgB,KAAK0sF,UACL1sF,KAAKqF,QAAQosE,EACf,CAEA3nE,4BAAAA,CAA6B2nE,EAAOqQ,EAASj+D,GAAK,IAAA4zE,EAAAC,EAChD,IAAK13F,KAAKylF,eACR,OAEF,MAAM1hE,EAAM/jB,KAAK+jB,IACjB,IAAIwzE,EACJ,GAAIzV,EAAQtvD,OACV+kE,EAAazV,EAAQtvD,WAChB,CACL,MAAMjO,EAAIu9D,EAAQ9hE,MACZwE,EAAIs9D,EAAQ7hE,OAGZo4D,EADYr4E,KAAKm4E,eAAeC,UAAU,cAAe7zD,EAAGC,GACzCqvC,QACzBguB,GAAmBxJ,EAAQyJ,GAC3ByV,EAAav3F,KAAKo3F,0BAA0B/e,EAC9C,CAEsB,QAAtBof,EAAAz3F,KAAKg2E,yBAAiB,IAAAyhB,GAAtBA,EAAwBxkB,UAAUxB,GAElC,IAAK,MAAMle,KAAS1vC,EAAK,KAAA8zE,EACvB5zE,EAAI3e,OACJ2e,EAAIze,aAAaiuD,EAAMjuD,WACvBye,EAAI5E,MAAM,GAAI,GACd8gE,GACEl8D,EACAwzE,EACAhkC,EAAMz9C,EACNy9C,EAAMx9C,EACNw9C,EAAMhvC,EACNgvC,EAAM/uC,EACN,GACC,EACD,EACA,GAEoB,QAAtBmzE,EAAA33F,KAAKg2E,yBAAiB,IAAA2hB,GAAtBA,EAAwBtkB,WAAW5B,EAAO1tD,EAAK,EAAG,GAAI,EAAG,GACzDA,EAAI1e,SACN,CACsB,QAAtBqyF,EAAA13F,KAAKg2E,yBAAiB,IAAA0hB,GAAtBA,EAAwBhjB,gBAAgBjD,GACxCzxE,KAAK0sF,SACP,CAEAziF,wBAAAA,CAAyBwnE,GAAO,IAAAmmB,EACzB53F,KAAKylF,iBAGY,QAAtBmS,EAAA53F,KAAKg2E,yBAAiB,IAAA4hB,GAAtBA,EACI3kB,UAAUxB,GACX4B,WAAW5B,EAAOzxE,KAAK+jB,IAAK,EAAG,EAAG,EAAG,GACrCowD,mBAAmB1C,EAAO6E,IAC1B5B,gBAAgBjD,GACnBzxE,KAAK+jB,IAAIyiE,SAAS,EAAG,EAAG,EAAG,GAC3BxmF,KAAK0sF,UACP,CAIA7jF,SAAAA,CAAU4oE,EAAOomB,GAEjB,CAEA/uF,cAAAA,CAAe2oE,EAAOomB,EAAK1U,GAE3B,CAEAp6E,kBAAAA,CAAmB0oE,EAAOomB,GAAK,IAAAC,EACP,QAAtBA,EAAA93F,KAAKg2E,yBAAiB,IAAA8hB,GAAtBA,EAAwB/uF,mBAAmB0oE,GAC3CzxE,KAAK8kF,mBAAmB91E,KAAK,CAC3Bm9B,SAAS,GAEb,CAEAnjC,uBAAAA,CAAwByoE,EAAOomB,EAAK1U,GAAY,IAAA4U,EACxB,QAAtBA,EAAA/3F,KAAKg2E,yBAAiB,IAAA+hB,GAAtBA,EAAwBhvF,mBAAmB0oE,GAC/B,OAARomB,EACF73F,KAAK8kF,mBAAmB91E,KAAK,CAC3Bm9B,QAASnsC,KAAK6kF,sBAAsBmT,UAAU7U,KAGhDnjF,KAAK8kF,mBAAmB91E,KAAK,CAC3Bm9B,SAAS,IAGbnsC,KAAKylF,eAAiBzlF,KAAKi4F,kBAC7B,CAEAhvF,gBAAAA,CAAiBwoE,GAAO,IAAAymB,EACA,QAAtBA,EAAAl4F,KAAKg2E,yBAAiB,IAAAkiB,GAAtBA,EAAwBjvF,iBAAiBwoE,GACzCzxE,KAAK8kF,mBAAmBjoE,MACxB7c,KAAKylF,eAAiBzlF,KAAKi4F,kBAC7B,CAIA/uF,WAAAA,CAAYuoE,GAEZ,CAEAtoE,SAAAA,CAAUsoE,GAEV,CAIA4c,WAAAA,CAAY5c,EAAOtpD,EAAMgrD,GACvB,MAAMh2C,EAAUn9B,KAAKg4E,QAAQ4J,cACzB5hF,KAAKglF,aACPhlF,KAAKg4E,QAAQ0J,qBAEV1hF,KAAKglF,aACRhlF,KAAK0sF,QAAQvZ,GAEf,MAAMpvD,EAAM/jB,KAAK+jB,IACK,IAAAo0E,EAYfC,EAZHp4F,KAAKglF,aACF7nD,IACCn9B,KAAKglF,cAAgBV,GACvBvgE,EAAIxd,KAAK4hB,EAAM,WAEfpE,EAAIxd,KAAK4hB,IAGbnoB,KAAKglF,YAAc,KACG,QAAtBmT,EAAAn4F,KAAKg2E,yBAAiB,IAAAmiB,GAAtBA,EACIljB,2BAA2BxD,GAC5BoB,6BAA6B,WAAYpB,IAEtB,QAAtB2mB,EAAAp4F,KAAKg2E,yBAAiB,IAAAoiB,GAAtBA,EAAwB1jB,gBAAgBjD,GAG1CzxE,KAAKg4E,QAAQ2J,uBAAuB3hF,KAAKg4E,QAAQ7E,QACnD,CAEA0f,mBAAAA,GACE,IAAK7yF,KAAK+lF,2BAA4B,CACpC,MAAMpzE,EAAImR,GAAoB9jB,KAAK+jB,KACnC,GAAa,IAATpR,EAAE,IAAqB,IAATA,EAAE,GAElB3S,KAAK+lF,2BACH,EAAIn3E,KAAKC,IAAID,KAAKmI,IAAIpE,EAAE,IAAK/D,KAAKmI,IAAIpE,EAAE,SACrC,CACL,MAAM0lF,EAASzpF,KAAKmI,IAAIpE,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IACzC2lF,EAAQ1pF,KAAKwuC,MAAMzqC,EAAE,GAAIA,EAAE,IAC3B4lF,EAAQ3pF,KAAKwuC,MAAMzqC,EAAE,GAAIA,EAAE,IACjC3S,KAAK+lF,2BAA6Bn3E,KAAKiG,IAAIyjF,EAAOC,GAASF,CAC7D,CACF,CACA,OAAOr4F,KAAK+lF,0BACd,CAEAyS,mBAAAA,GAOE,IAAyC,IAArCx4F,KAAK8lF,wBAAwB,GAAW,CAC1C,MAAM,UAAEtE,GAAcxhF,KAAKg4E,SACrB,EAAEj5E,EAAC,EAAEgT,EAAC,EAAEG,EAAC,EAAEC,GAAMnS,KAAK+jB,IAAIC,eAChC,IAAIs1D,EAAQC,EAEZ,GAAU,IAANxnE,GAAiB,IAANG,EAAS,CAEtB,MAAMomF,EAAQ1pF,KAAKmI,IAAIhY,GACjBw5F,EAAQ3pF,KAAKmI,IAAI5E,GACvB,GAAImmF,IAAUC,EACZ,GAAkB,IAAd/W,EACFlI,EAASC,EAAS,EAAI+e,MACjB,CACL,MAAMG,EAAkBH,EAAQ9W,EAChClI,EAASC,EAASkf,EAAkB,EAAI,EAAIA,EAAkB,CAChE,MACK,GAAkB,IAAdjX,EACTlI,EAAS,EAAIgf,EACb/e,EAAS,EAAIgf,MACR,CACL,MAAMG,EAAmBJ,EAAQ9W,EAC3BmX,EAAmBJ,EAAQ/W,EACjClI,EAASof,EAAmB,EAAI,EAAIA,EAAmB,EACvDnf,EAASof,EAAmB,EAAI,EAAIA,EAAmB,CACzD,CACF,KAAO,CAOL,MAAMN,EAASzpF,KAAKmI,IAAIhY,EAAIoT,EAAIJ,EAAIG,GAC9BomF,EAAQ1pF,KAAKwuC,MAAMr+C,EAAGgT,GACtBwmF,EAAQ3pF,KAAKwuC,MAAMlrC,EAAGC,GAC5B,GAAkB,IAAdqvE,EACFlI,EAASif,EAAQF,EACjB9e,EAAS+e,EAAQD,MACZ,CACL,MAAMO,EAAWpX,EAAY6W,EAC7B/e,EAASif,EAAQK,EAAWL,EAAQK,EAAW,EAC/Crf,EAAS+e,EAAQM,EAAWN,EAAQM,EAAW,CACjD,CACF,CACA54F,KAAK8lF,wBAAwB,GAAKxM,EAClCt5E,KAAK8lF,wBAAwB,GAAKvM,CACpC,CACA,OAAOv5E,KAAK8lF,uBACd,CAIA2I,gBAAAA,CAAiBtmE,EAAM0wE,GACrB,MAAM,IACJ90E,EACAi0D,SAAS,UAAEwJ,IACTxhF,MACGs5E,EAAQC,GAAUv5E,KAAKw4F,sBAE9B,GAAIlf,IAAWC,EAGb,OAFAx1D,EAAIy9D,WAAaA,GAAa,GAAKlI,OACnCv1D,EAAIje,OAAOqiB,GAIb,MAAM2wE,EAAS/0E,EAAIu/D,cACfuV,GACF90E,EAAI3e,OAGN2e,EAAI5E,MAAMm6D,EAAQC,GAClBmG,GAAa3gF,EAAI,EAAIu6E,EACrBoG,GAAavtE,EAAI,EAAIonE,EACrB,MAAM+U,EAAU,IAAIlmE,OAUpB,GATAkmE,EAAQC,QAAQpmE,EAAMu3D,IASlBoZ,EAAOz6F,OAAS,EAAG,CACrB,MAAM8gB,EAAQvQ,KAAKiG,IAAIykE,EAAQC,GAC/Bx1D,EAAIs/D,YAAYyV,EAAOj1E,IAAI/N,GAAKA,EAAIqJ,IACpC4E,EAAIw/D,gBAAkBpkE,CACxB,CAEA4E,EAAIy9D,UAAYA,GAAa,EAC7Bz9D,EAAIje,OAAOwoF,GAEPuK,GACF90E,EAAI1e,SAER,CAEA4yF,gBAAAA,GACE,IAAK,IAAIvpF,EAAI1O,KAAK8kF,mBAAmBzmF,OAAS,EAAGqQ,GAAK,EAAGA,IACvD,IAAK1O,KAAK8kF,mBAAmBp2E,GAAGy9B,QAC9B,OAAO,EAGX,OAAO,CACT,EACF,SAAA07C,KAv8EI,KAAO7nF,KAAK+kF,WAAW1mF,QAAU2B,KAAK+qF,aACpC/qF,KAAKqF,UAGPrF,KAAKg4E,QAAQ4S,YAAc,KAC3B5qF,KAAK+jB,IAAI1e,UAELrF,KAAKymF,oBACPzmF,KAAK+jB,IAAM/jB,KAAK0mF,aAChB1mF,KAAK+jB,IAAI3e,OACTpF,KAAK+jB,IAAI80D,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GACrC74E,KAAK+jB,IAAI+N,UAAU9xB,KAAKymF,kBAAmB,EAAG,GAC9CzmF,KAAK+jB,IAAI1e,UACTrF,KAAKymF,kBAAoB,KAE7B,UAAAsB,KAwBE,GAAI/nF,KAAKy8B,WAAY,CACnB,MAAMs8D,EAAc/4F,KAAKk+B,cAAc4B,aACrC9/B,KAAKy8B,WAAWsD,WAChB//B,KAAKy8B,WAAWuD,YAElB,GAAoB,SAAhB+4D,EAAwB,CAC1B,MAAMC,EAAch5F,KAAK+jB,IAAIsmD,OAC7BrqE,KAAK+jB,IAAIsmD,OAAS0uB,EAClB/4F,KAAK+jB,IAAI+N,UAAU9xB,KAAK+jB,IAAI4O,OAAQ,EAAG,GACvC3yB,KAAK+jB,IAAIsmD,OAAS2uB,CACpB,CACF,CACF,UAAApH,GAk7BezpE,EAAM4gE,EAAkBzjF,GACrC,MAAMgpF,EAAU,IAAIlmE,OAKpB,OAJAkmE,EAAQC,QACNpmE,EACA,IAAIywD,UAAUtzE,GAAW4e,aAAasqE,aAAazF,IAE9CuF,CACT,CA69CF,IAAK,MAAML,MAAMvpF,QACsB+G,IAAjC+4E,GAAetkF,UAAU+tF,MAC3BzJ,GAAetkF,UAAUwE,GAAIupF,KAAOzJ,GAAetkF,UAAU+tF,KCvwGjE,MAAMgL,GAQJ,qBAAWC,GACT,OAAOh6F,EATL+5F,GASKj5F,KAAKm5F,IAAKv2E,CACnB,CAMA,qBAAWs2E,CAAW1lC,GACpB,KACsB,qBAAX4lC,QAA0B5lC,aAAe4lC,SAC1C,OAAR5lC,EAEA,MAAM,IAAIroD,MAAM,8BAEbguF,GAAKv2E,EAAA1jB,EAvBR+5F,GAuBFj5F,KAAawzD,EACf,CAKA,oBAAW6lC,GACT,OAAOn6F,EA9BL+5F,GA8BKj5F,KAAKs5F,IAAI12E,CAClB,CASA,oBAAWy2E,CAAU7lC,GACnB,GAAmB,kBAARA,EACT,MAAM,IAAIroD,MAAM,6BAEbmuF,GAAI12E,EAAA1jB,EA5CP+5F,GA4CFj5F,KAAYwzD,EACd,EACF,IAAA2lC,GAAA,CAAAv2E,EA7CiB,MAAI02E,GAAA,CAAA12E,EAEL,I,8BCHhB,MAAM22E,GAKJ/rF,WAAAA,CAAWgsF,GAA0B,IAAzB,WAAEC,EAAU,QAAE/lE,GAAS8lE,EAJnCv6F,EAAA,KAAAy6F,QAAI,GAEJz6F,EAAA,KAAA06F,QAAK,GAGHzwE,EAAKwwE,GAAL15F,KAAYy5F,GACZvwE,EAAKywE,GAAL35F,KAAa0zB,EACf,CAEAkmE,MAAAA,GACE,OAAOhwE,EAAK+vE,GAAL35F,KACT,CAEAV,GAAAA,CAAIiO,GAAM,IAAAssF,EACR,OAA0B,QAA1BA,EAAOjwE,EAAK8vE,GAAL15F,MAAUV,IAAIiO,UAAK,IAAAssF,EAAAA,EAAI,IAChC,CAEA,CAAC3kC,OAAOC,YACN,OAAOvrC,EAAK8vE,GAAL15F,MAAUmb,SACnB,ECZF,MAAM2+E,GAAW5kC,OAAO,YAAW,IAAA6kC,GAAA,IAAApsE,QAAAqsE,GAAA,IAAArsE,QAAAssE,GAAA,IAAAtsE,QAAAusE,GAAA,IAAAvsE,QAEnC,MAAMwsE,GASJ3sF,WAAAA,CAAY4sF,EAAeC,GAAqC,IAAnC,KAAE9sF,EAAI,OAAEqM,EAAM,MAAE0gF,EAAK,SAAEC,GAAUF,EAR9Dp7F,EAAA,KAAA86F,IAAa,GAEb96F,EAAA,KAAA+6F,IAAW,GAEX/6F,EAAA,KAAAg7F,IAAW,GAEXh7F,EAAA,KAAAi7F,IAAW,GAGThxE,EAAK6wE,GAAL/5F,QAAqBo6F,EAAkBz5F,IACvCuoB,EAAK8wE,GAALh6F,QAAmBo6F,EAAkBz5F,IAErCX,KAAKuN,KAAOA,EACZvN,KAAK4Z,OAASA,EACd5Z,KAAKs6F,MAAQA,EACbt6F,KAAKu6F,SAAWA,CAClB,CAKA,WAAIpuD,GACF,GAAIviB,EAAKqwE,GAALj6F,MACF,OAAO4pB,EAAKswE,GAALl6F,MAET,IAAK4pB,EAAKswE,GAALl6F,MACH,OAAO,EAET,MAAM,MAAE0zD,EAAK,KAAEoI,GAAS97D,KAAKs6F,MAE7B,OAAI1wE,EAAKmwE,GAAL/5F,MACyB,SAAhB,OAAJ87D,QAAI,IAAJA,OAAI,EAAJA,EAAM0+B,YACJ5wE,EAAKowE,GAALh6F,OACoB,SAAjB,OAAL0zD,QAAK,IAALA,OAAK,EAALA,EAAO+mC,WAGlB,CAKAC,WAAAA,CAAYC,EAAUxuD,GAA0B,IAAjByuD,EAAOz7F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAChCw7F,IAAab,IACf5uF,GAAY,yCAEdge,EAAK+wE,GAALj6F,KAAgB46F,GAChB1xE,EAAKgxE,GAALl6F,KAAgBmsC,EAClB,EACF,IAAA0uD,GAAA,IAAAltE,QAAAmtE,GAAA,IAAAntE,QAAAotE,GAAA,IAAAptE,QAAAqtE,GAAA,IAAArtE,QAAAstE,GAAA,IAAAltE,QAEA,MAAMmtE,GASJ1tF,WAAAA,CAAY0a,GAAqD,IAA/CkyE,EAAej7F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGwB,EAMlC,GAN6D7B,EAAA,KAAAm8F,IAR/Dh8F,EAAA,KAAA47F,GAAiB,MAEjB57F,EAAA,KAAA67F,GAAU,IAAIzzE,KAEdpoB,EAAA,KAAA87F,GAAe,MAEf97F,EAAA,KAAA+7F,GAAS,MAGPh7F,KAAKo6F,gBAAkBA,EAEvBp6F,KAAKuN,KAAO,KACZvN,KAAKm7F,QAAU,KAEF,OAATjzE,EAAJ,CAGAloB,KAAKuN,KAAO2a,EAAK3a,KACjBvN,KAAKm7F,QAAUjzE,EAAKizE,QACpBjyE,EAAK8xE,GAALh7F,KAAckoB,EAAKkzE,OACnB,IAAK,MAAMzF,KAASztE,EAAKmzE,OACvBzxE,EAAKkxE,GAAL96F,MAAaxB,IACXm3F,EAAMl8E,GACN,IAAI0gF,GAAqBC,EAAiBzE,IAI9C,GAAuB,QAAnBztE,EAAKozE,UACP,IAAK,MAAM3F,KAAS/rE,EAAKkxE,GAAL96F,MAAaq/B,SAC/Bs2D,EAAM+E,YAAYZ,IAAU,GAIhC,IAAK,MAAM12D,KAAMlb,EAAKkb,GACpBxZ,EAAKkxE,GAAL96F,MAAaV,IAAI8jC,GAAIs3D,YAAYZ,IAAU,GAG7C,IAAK,MAAMyB,KAAOrzE,EAAKqzE,IACrB3xE,EAAKkxE,GAAL96F,MAAaV,IAAIi8F,GAAKb,YAAYZ,IAAU,GAI9C5wE,EAAK6xE,GAAL/6F,KAAoBA,KAAKw7F,UA1BzB,CA2BF,CAuCAxD,SAAAA,CAAUrC,GACR,GAA0B,IAAtB/rE,EAAKkxE,GAAL96F,MAAaywB,KACf,OAAO,EAET,IAAKklE,EAEH,OADA9qF,GAAK,wCACE,EAET,GAAmB,QAAf8qF,EAAMn1F,KACR,OAAKopB,EAAKkxE,GAAL96F,MAAapB,IAAI+2F,EAAMl8E,IAIrBmQ,EAAKkxE,GAAL96F,MAAaV,IAAIq2F,EAAMl8E,IAAI0yB,SAHhClhC,GAAK,qCAADD,OAAsC2qF,EAAMl8E,MACzC,GAGJ,GAAmB,SAAfk8E,EAAMn1F,KAAiB,CAEhC,GAAIm1F,EAAM8F,WACR,OAAOv8F,EAAA+7F,GAAAj7F,KAAK07F,IAA6BrqF,KAAlCrR,KAAmC21F,EAAM8F,YAElD,IAAK9F,EAAMgG,QAA2B,UAAjBhG,EAAMgG,OAAoB,CAE7C,IAAK,MAAMliF,KAAMk8E,EAAM1gC,IAAK,CAC1B,IAAKrrC,EAAKkxE,GAAL96F,MAAapB,IAAI6a,GAEpB,OADAxO,GAAK,qCAADD,OAAsCyO,KACnC,EAET,GAAImQ,EAAKkxE,GAAL96F,MAAaV,IAAIma,GAAI0yB,QACvB,OAAO,CAEX,CACA,OAAO,CACT,CAAO,GAAqB,UAAjBwpD,EAAMgG,OAAoB,CACnC,IAAK,MAAMliF,KAAMk8E,EAAM1gC,IAAK,CAC1B,IAAKrrC,EAAKkxE,GAAL96F,MAAapB,IAAI6a,GAEpB,OADAxO,GAAK,qCAADD,OAAsCyO,KACnC,EAET,IAAKmQ,EAAKkxE,GAAL96F,MAAaV,IAAIma,GAAI0yB,QACxB,OAAO,CAEX,CACA,OAAO,CACT,CAAO,GAAqB,WAAjBwpD,EAAMgG,OAAqB,CACpC,IAAK,MAAMliF,KAAMk8E,EAAM1gC,IAAK,CAC1B,IAAKrrC,EAAKkxE,GAAL96F,MAAapB,IAAI6a,GAEpB,OADAxO,GAAK,qCAADD,OAAsCyO,KACnC,EAET,IAAKmQ,EAAKkxE,GAAL96F,MAAaV,IAAIma,GAAI0yB,QACxB,OAAO,CAEX,CACA,OAAO,CACT,CAAO,GAAqB,WAAjBwpD,EAAMgG,OAAqB,CACpC,IAAK,MAAMliF,KAAMk8E,EAAM1gC,IAAK,CAC1B,IAAKrrC,EAAKkxE,GAAL96F,MAAapB,IAAI6a,GAEpB,OADAxO,GAAK,qCAADD,OAAsCyO,KACnC,EAET,GAAImQ,EAAKkxE,GAAL96F,MAAaV,IAAIma,GAAI0yB,QACvB,OAAO,CAEX,CACA,OAAO,CACT,CAEA,OADAlhC,GAAK,mCAADD,OAAoC2qF,EAAMgG,OAAM,OAC7C,CACT,CAEA,OADA1wF,GAAK,sBAADD,OAAuB2qF,EAAMn1F,KAAI,OAC9B,CACT,CAEAo7F,aAAAA,CAAcniF,GAAuC,IAAnC0yB,IAAOhtC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAAS08F,IAAU18F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAC1C,MAAMw2F,EAAQ/rE,EAAKkxE,GAAL96F,MAAaV,IAAIma,GAC/B,GAAKk8E,EAAL,CAQA,GAAIkG,GAAc1vD,GAAWwpD,EAAM4E,SAASl8F,OAC1C,IAAK,MAAMy9F,KAAWnG,EAAM4E,SAC1B,IAAK,MAAMwB,KAAWD,EAAS,CACT,IAAAE,EAApB,GAAID,IAAYtiF,EACW,QAAzBuiF,EAAApyE,EAAKkxE,GAAL96F,MAAaV,IAAIy8F,UAAQ,IAAAC,GAAzBA,EAA2BtB,YAAYZ,IAAU,GAAO,EAE5D,CAIJnE,EAAM+E,YAAYZ,KAAY3tD,GAAyB,GAEvDjjB,EAAK2xE,GAAL76F,KAAsB,KAjBtB,MAFEiL,GAAK,qCAADD,OAAsCyO,GAoB9C,CAEAwiF,WAAAA,CAAWC,GAAwB,IAC7BC,GADM,MAAEC,EAAK,WAAEP,GAAYK,EAG/B,IAAK,MAAM1c,KAAQ4c,EAAO,CACxB,OAAQ5c,GACN,IAAK,KACL,IAAK,MACL,IAAK,SACH2c,EAAW3c,EACX,SAGJ,MAAMmW,EAAQ/rE,EAAKkxE,GAAL96F,MAAaV,IAAIkgF,GAC/B,GAAKmW,EAGL,OAAQwG,GACN,IAAK,KACHn8F,KAAK47F,cAAcpc,GAAM,EAAMqc,GAC/B,MACF,IAAK,MACH77F,KAAK47F,cAAcpc,GAAM,EAAOqc,GAChC,MACF,IAAK,SACH77F,KAAK47F,cAAcpc,GAAOmW,EAAMxpD,QAAS0vD,GAG/C,CAEA3yE,EAAK2xE,GAAL76F,KAAsB,KACxB,CAEA,wBAAIq8F,GACF,OAA6B,OAAtBzyE,EAAKmxE,GAAL/6F,OAA8BA,KAAKw7F,YAAc5xE,EAAKmxE,GAAL/6F,KAC1D,CAEAs8F,QAAAA,GACE,OAAK1yE,EAAKkxE,GAAL96F,MAAaywB,KAGd7G,EAAKoxE,GAALh7F,MACK4pB,EAAKoxE,GAALh7F,MAAYqV,QAEd,IAAIuU,EAAKkxE,GAAL96F,MAAayR,QALf,IAMX,CAEA8qF,QAAAA,CAAS9iF,GACP,OAAOmQ,EAAKkxE,GAAL96F,MAAaV,IAAIma,IAAO,IACjC,CAEA+hF,OAAAA,GACE,GAA4B,OAAxB5xE,EAAKixE,GAAL76F,MACF,OAAO4pB,EAAKixE,GAAL76F,MAET,MAAMyM,EAAO,IAAI+kD,GAEjB,IAAK,MAAO/3C,EAAIk8E,KAAU/rE,EAAKkxE,GAAL96F,MACxByM,EAAK0Q,OAAO,GAADnS,OAAIyO,EAAE,KAAAzO,OAAI2qF,EAAMxpD,UAE7B,OAAQjjB,EAAK2xE,GAAL76F,KAAsByM,EAAK+lD,YACrC,CAEA,CAAC0C,OAAOC,YACN,OAAOvrC,EAAKkxE,GAAL96F,MAAamb,SACtB,EACF,SAAAugF,GAvMgCpsB,GAC5B,MAAMjxE,EAASixE,EAAMjxE,OACrB,GAAIA,EAAS,EACX,OAAO,EAET,MAAM89F,EAAW7sB,EAAM,GACvB,IAAK,IAAI5gE,EAAI,EAAGA,EAAIrQ,EAAQqQ,IAAK,CAC/B,MAAMgL,EAAU41D,EAAM5gE,GACtB,IAAI0tF,EACJ,GAAI7qF,MAAM02B,QAAQvuB,GAChB0iF,EAAQl9F,EAAA+7F,GAAAj7F,KAAK07F,IAA6BrqF,KAAlCrR,KAAmC0Z,OACtC,KAAIkQ,EAAKkxE,GAAL96F,MAAapB,IAAI8a,GAI1B,OADAzO,GAAK,qCAADD,OAAsC0O,KACnC,EAHP0iF,EAAQxyE,EAAKkxE,GAAL96F,MAAaV,IAAIoa,GAASyyB,OAIpC,CACA,OAAQgwD,GACN,IAAK,MACH,IAAKC,EACH,OAAO,EAET,MACF,IAAK,KACH,GAAIA,EACF,OAAO,EAET,MACF,IAAK,MACH,OAAQA,EACV,QACE,OAAO,EAEb,CACA,MAAoB,QAAbD,CACT,CCrIF,MAAMK,GACJhvF,WAAAA,CACEivF,EAAqBC,GAErB,IADA,aAAEC,GAAe,EAAK,cAAEC,GAAgB,GAAOF,EAE/CtxF,GACEqxF,EACA,+EAEF,MAAM,OAAEp+F,EAAM,YAAEw+F,EAAW,gBAAEC,EAAe,2BAAEC,GAC5CN,EAMF,GAJAz8F,KAAKg9F,cAAgB,GACrBh9F,KAAKi9F,iBAAmBH,EACxB98F,KAAKk9F,4BAA8BH,GAEpB,OAAXF,QAAW,IAAXA,OAAW,EAAXA,EAAax+F,QAAS,EAAG,CAG3B,MAAMqR,EACJmtF,aAAuBztF,YACvBytF,EAAY/qC,aAAe+qC,EAAYntF,OAAOoiD,WAC1C+qC,EAAYntF,OACZ,IAAIN,WAAWytF,GAAantF,OAClC1P,KAAKg9F,cAAchuF,KAAKU,EAC1B,CAEA1P,KAAKm9F,uBAAyBV,EAC9Bz8F,KAAKo9F,uBAAyBR,EAC9B58F,KAAKq9F,mBAAqBV,EAC1B38F,KAAKs9F,eAAiBj/F,EAEtB2B,KAAKu9F,mBAAqB,KAC1Bv9F,KAAKw9F,cAAgB,GAErBf,EAAsBgB,iBAAiB,CAACC,EAAO5uF,KAC7C9O,KAAK29F,eAAe,CAAED,QAAO5uF,YAG/B2tF,EAAsBmB,oBAAoB,CAACnmC,EAAQomC,KACjD79F,KAAK89F,YAAY,CAAErmC,SAAQomC,YAG7BpB,EAAsBsB,2BAA2BjvF,IAC/C9O,KAAK29F,eAAe,CAAE7uF,YAGxB2tF,EAAsBuB,2BAA2B,KAC/Ch+F,KAAKi+F,uBAGPxB,EAAsByB,gBACxB,CAEAP,cAAAA,CAAcQ,GAAmB,IAAlB,MAAET,EAAK,MAAE5uF,GAAOqvF,EAG7B,MAAMzuF,EACJZ,aAAiBM,YACjBN,EAAMgjD,aAAehjD,EAAMY,OAAOoiD,WAC9BhjD,EAAMY,OACN,IAAIN,WAAWN,GAAOY,OAE5B,QAAcjE,IAAViyF,EACE19F,KAAKu9F,mBACPv9F,KAAKu9F,mBAAmBa,SAAS1uF,GAEjC1P,KAAKg9F,cAAchuF,KAAKU,OAErB,CAQLtE,GAPcpL,KAAKw9F,cAAc5qD,KAAK,SAAUyrD,GAC9C,OAAIA,EAAYC,SAAWZ,IAG3BW,EAAYD,SAAS1uF,IACd,EACT,GAGE,0EAEJ,CACF,CAEA,0BAAI6uF,GAAyB,IAAAC,EAAAC,EAC3B,OAAuC,QAAvCD,EAA8B,QAA9BC,EAAOz+F,KAAKu9F,0BAAkB,IAAAkB,OAAA,EAAvBA,EAAyBC,eAAO,IAAAF,EAAAA,EAAI,CAC7C,CAEAV,WAAAA,CAAYjgE,GACmB,IAAA8gE,EAAAC,EAGtBC,EAAAC,OAHWrzF,IAAdoyB,EAAIggE,MAEe,QAArBc,EAAA3+F,KAAKw9F,cAAc,UAAE,IAAAmB,GAAY,QAAZC,EAArBD,EAAuBI,kBAAU,IAAAH,GAAjCA,EAAAvtF,KAAAstF,EAAoC,CAAElnC,OAAQ55B,EAAI45B,SAE3B,QAAvBonC,EAAA7+F,KAAKu9F,0BAAkB,IAAAsB,GAAY,QAAZC,EAAvBD,EAAyBE,kBAAU,IAAAD,GAAnCA,EAAAztF,KAAAwtF,EAAsC,CACpCpnC,OAAQ55B,EAAI45B,OACZomC,MAAOhgE,EAAIggE,OAGjB,CAEAI,kBAAAA,GAAqB,IAAAe,EACI,QAAvBA,EAAAh/F,KAAKu9F,0BAAkB,IAAAyB,GAAvBA,EAAyBlC,kBACzB98F,KAAKi9F,kBAAmB,CAC1B,CAEAgC,kBAAAA,CAAmBC,GACjB,MAAMxwF,EAAI1O,KAAKw9F,cAAc2B,QAAQD,GACjCxwF,GAAK,GACP1O,KAAKw9F,cAAchoE,OAAO9mB,EAAG,EAEjC,CAEA0wF,aAAAA,GACEh0F,IACGpL,KAAKu9F,mBACN,iEAEF,MAAM8B,EAAer/F,KAAKg9F,cAE1B,OADAh9F,KAAKg9F,cAAgB,KACd,IAAIsC,GACTt/F,KACAq/F,EACAr/F,KAAKi9F,iBACLj9F,KAAKk9F,4BAET,CAEAqC,cAAAA,CAAe7B,EAAO17E,GACpB,GAAIA,GAAOhiB,KAAKu+F,uBACd,OAAO,KAET,MAAMW,EAAS,IAAIM,GAAkCx/F,KAAM09F,EAAO17E,GAGlE,OAFAhiB,KAAKm9F,uBAAuBsC,iBAAiB/B,EAAO17E,GACpDhiB,KAAKw9F,cAAcxuF,KAAKkwF,GACjBA,CACT,CAEAQ,iBAAAA,CAAkB15B,GAAQ,IAAA25B,EACD,QAAvBA,EAAA3/F,KAAKu9F,0BAAkB,IAAAoC,GAAvBA,EAAyBnqD,OAAOwwB,GAEhC,IAAK,MAAMk5B,KAAUl/F,KAAKw9F,cAAcnoF,MAAM,GAC5C6pF,EAAO1pD,OAAOwwB,GAEhBhmE,KAAKm9F,uBAAuBh+D,OAC9B,EAIF,MAAMmgE,GACJ9xF,WAAAA,CACEu4D,EACAs5B,GAGA,IAFAvC,EAAe39F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACf49F,EAA0B59F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAE7Ba,KAAK4/F,QAAU75B,EACf/lE,KAAK6/F,MAAQ/C,IAAmB,EAChC98F,KAAK8/F,UAAYz+E,GAAU07E,GACvBA,EACA,KACJ/8F,KAAKg9F,cAAgBqC,GAAgB,GACrCr/F,KAAK0+F,QAAU,EACf,IAAK,MAAM5vF,KAAS9O,KAAKg9F,cACvBh9F,KAAK0+F,SAAW5vF,EAAMgjD,WAExB9xD,KAAK+/F,UAAY,GACjB//F,KAAKggG,cAAgBtgG,QAAQG,UAC7BkmE,EAAOw3B,mBAAqBv9F,KAE5BA,KAAK++F,WAAa,IACpB,CAEAX,QAAAA,CAAStvF,GACP,IAAI9O,KAAK6/F,MAAT,CAGA,GAAI7/F,KAAK+/F,UAAU1hG,OAAS,EAAG,CACH2B,KAAK+/F,UAAU7nC,QACvBr4D,QAAQ,CAAEC,MAAOgP,EAAOlP,MAAM,GAClD,MACEI,KAAKg9F,cAAchuF,KAAKF,GAE1B9O,KAAK0+F,SAAW5vF,EAAMgjD,UAPtB,CAQF,CAEA,gBAAImuC,GACF,OAAOjgG,KAAKggG,aACd,CAEA,YAAI1+E,GACF,OAAOthB,KAAK8/F,SACd,CAEA,oBAAII,GACF,OAAOlgG,KAAK4/F,QAAQvC,iBACtB,CAEA,wBAAI8C,GACF,OAAOngG,KAAK4/F,QAAQxC,qBACtB,CAEA,iBAAIgD,GACF,OAAOpgG,KAAK4/F,QAAQtC,cACtB,CAEA,UAAM+C,GACJ,GAAIrgG,KAAKg9F,cAAc3+F,OAAS,EAAG,CAEjC,MAAO,CAAEyB,MADKE,KAAKg9F,cAAc9kC,QACVt4D,MAAM,EAC/B,CACA,GAAII,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,MAAM0gG,EAAoB5gG,QAAQujC,gBAElC,OADAjjC,KAAK+/F,UAAU/wF,KAAKsxF,GACbA,EAAkBt9D,OAC3B,CAEAwS,MAAAA,CAAOwwB,GACLhmE,KAAK6/F,OAAQ,EACb,IAAK,MAAMS,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,CAC1B,CAEAy+F,eAAAA,GACM98F,KAAK6/F,QAGT7/F,KAAK6/F,OAAQ,EACf,EAIF,MAAML,GACJhyF,WAAAA,CAAYu4D,EAAQ23B,EAAO17E,GACzBhiB,KAAK4/F,QAAU75B,EACf/lE,KAAKs+F,OAASZ,EACd19F,KAAKugG,KAAOv+E,EACZhiB,KAAKwgG,aAAe,KACpBxgG,KAAK+/F,UAAY,GACjB//F,KAAK6/F,OAAQ,EAEb7/F,KAAK++F,WAAa,IACpB,CAEAX,QAAAA,CAAStvF,GACP,IAAI9O,KAAK6/F,MAAT,CAGA,GAA8B,IAA1B7/F,KAAK+/F,UAAU1hG,OACjB2B,KAAKwgG,aAAe1xF,MACf,CACsB9O,KAAK+/F,UAAU7nC,QACvBr4D,QAAQ,CAAEC,MAAOgP,EAAOlP,MAAM,IACjD,IAAK,MAAM0gG,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,CAC1B,CACA2B,KAAK6/F,OAAQ,EACb7/F,KAAK4/F,QAAQX,mBAAmBj/F,KAZhC,CAaF,CAEA,wBAAImgG,GACF,OAAO,CACT,CAEA,UAAME,GACJ,GAAIrgG,KAAKwgG,aAAc,CACrB,MAAM1xF,EAAQ9O,KAAKwgG,aAEnB,OADAxgG,KAAKwgG,aAAe,KACb,CAAE1gG,MAAOgP,EAAOlP,MAAM,EAC/B,CACA,GAAII,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,MAAM0gG,EAAoB5gG,QAAQujC,gBAElC,OADAjjC,KAAK+/F,UAAU/wF,KAAKsxF,GACbA,EAAkBt9D,OAC3B,CAEAwS,MAAAA,CAAOwwB,GACLhmE,KAAK6/F,OAAQ,EACb,IAAK,MAAMS,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,EACxB2B,KAAK4/F,QAAQX,mBAAmBj/F,KAClC,ECvSF,SAASygG,GAAcC,EAAQC,GAC7B,MAAMC,EAAU,IAAIC,QAEpB,IAAKH,IAAWC,GAAsC,kBAAhBA,EACpC,OAAOC,EAET,IAAK,MAAM1lF,KAAOylF,EAAa,CAC7B,MAAMntC,EAAMmtC,EAAYzlF,QACZzP,IAAR+nD,GACFotC,EAAQxkF,OAAOlB,EAAKs4C,EAExB,CACA,OAAOotC,CACT,CAEA,SAASE,GAAkBv1F,GAAK,IAAAw1F,EAAAC,EAE9B,OAA6B,QAA7BD,EAAqB,QAArBC,EAAO50F,IAAIC,MAAMd,UAAI,IAAAy1F,OAAA,EAAdA,EAAgB1jD,cAAM,IAAAyjD,EAAAA,EAAI,IACnC,CAEA,SAASE,GAAgCC,GAKtC,IALuC,gBACxCC,EAAe,OACfT,EAAM,eACNU,EAAc,aACdzE,GACDuE,EAOC,MAAMG,EAAe,CACnBC,oBAAoB,EACpBC,qBAAiB91F,GAGbpN,EAAS4kB,SAASk+E,EAAgB7hG,IAAI,kBAAmB,IAC/D,IAAKoL,OAAOC,UAAUtM,GACpB,OAAOgjG,EAKT,GAFAA,EAAaE,gBAAkBljG,EAE3BA,GAAU,EAAI+iG,EAGhB,OAAOC,EAGT,GAAI1E,IAAiB+D,EACnB,OAAOW,EAET,GAA6C,UAAzCF,EAAgB7hG,IAAI,iBACtB,OAAO+hG,EAIT,MAAwB,cADAF,EAAgB7hG,IAAI,qBAAuB,cAKnE+hG,EAAaC,oBAAqB,GAHzBD,CAKX,CAEA,SAASG,GAA0BL,GACjC,MAAMM,EAAqBN,EAAgB7hG,IAAI,uBAC/C,GAAImiG,EAAoB,CACtB,IAAIngF,EC1DR,SAAiDmgF,GAC/C,IAAIC,GAAqB,EAGrBroB,EAAMsoB,EAAc,cAAe,KAAK5+E,KAAK0+E,GACjD,GAAIpoB,EAAK,CACPA,EAAMA,EAAI,GACV,IAAI/3D,EAAWsgF,EAAevoB,GAI9B,OAHA/3D,EAAWugF,SAASvgF,GACpBA,EAAWwgF,EAAcxgF,GACzBA,EAAWygF,EAAczgF,GAClB0gF,EAAc1gF,EACvB,CAMA,GADA+3D,EA6DA,SAAyB4oB,GACvB,MAAMn/E,EAAU,GAChB,IAAIhX,EAGJ,MAAMo2F,EAAOP,EAAc,kCAAmC,MAC9D,KAAsD,QAA9C71F,EAAQo2F,EAAKn/E,KAAKk/E,KAAkC,CAC1D,IAAK,CAAE9jG,EAAGgkG,EAAMC,GAAQt2F,EAExB,GADA3N,EAAI8kB,SAAS9kB,EAAG,IACZA,KAAK2kB,GAEP,GAAU,IAAN3kB,EACF,WAIJ2kB,EAAQ3kB,GAAK,CAACgkG,EAAMC,EACtB,CACA,MAAMC,EAAQ,GACd,IAAK,IAAIlkG,EAAI,EAAGA,EAAI2kB,EAAQzkB,QACpBF,KAAK2kB,IADyB3kB,EAAG,CAKvC,IAAKgkG,EAAMC,GAAQt/E,EAAQ3kB,GAC3BikG,EAAOR,EAAeQ,GAClBD,IACFC,EAAOP,SAASO,GACN,IAANjkG,IACFikG,EAAON,EAAcM,KAGzBC,EAAMrzF,KAAKozF,EACb,CACA,OAAOC,EAAMpzF,KAAK,GACpB,CAhGMqzF,CAAgBb,GAClBpoB,EAGF,OAAO2oB,EADUD,EAAc1oB,IAMjC,GADAA,EAAMsoB,EAAc,WAAY,KAAK5+E,KAAK0+E,GACtCpoB,EAAK,CACPA,EAAMA,EAAI,GACV,IAAI/3D,EAAWsgF,EAAevoB,GAE9B,OADA/3D,EAAWygF,EAAczgF,GAClB0gF,EAAc1gF,EACvB,CAKA,SAASqgF,EAAcY,EAAkBC,GACvC,OAAO,IAAI3/E,OACT,cACE0/E,EADF,sDAUAC,EAEJ,CACA,SAASC,EAAWC,EAAU5iG,GAC5B,GAAI4iG,EAAU,CACZ,IAAK,iBAAiBnhF,KAAKzhB,GACzB,OAAOA,EAET,IACE,MAAM6iG,EAAU,IAAItmC,YAAYqmC,EAAU,CAAEE,OAAO,IAC7ClzF,EAASR,GAAcpP,GAC7BA,EAAQ6iG,EAAQ9wE,OAAOniB,GACvBgyF,GAAqB,CACvB,CAAE,MAAAmB,GAEF,CACF,CACA,OAAO/iG,CACT,CACA,SAASkiG,EAAcliG,GASrB,OARI4hG,GAAsB,cAAcngF,KAAKzhB,KAE3CA,EAAQ2iG,EAAW,QAAS3iG,GACxB4hG,IAEF5hG,EAAQ2iG,EAAW,aAAc3iG,KAG9BA,CACT,CAqCA,SAAS8hG,EAAe9hG,GACtB,GAAIA,EAAM8L,WAAW,KAAM,CACzB,MAAMy2F,EAAQviG,EAAMuV,MAAM,GAAGxI,MAAM,OAEnC,IAAK,IAAI6B,EAAI,EAAGA,EAAI2zF,EAAMhkG,SAAUqQ,EAAG,CACrC,MAAMo0F,EAAYT,EAAM3zF,GAAGywF,QAAQ,MAChB,IAAf2D,IACFT,EAAM3zF,GAAK2zF,EAAM3zF,GAAG2G,MAAM,EAAGytF,GAC7BT,EAAMhkG,OAASqQ,EAAI,GAErB2zF,EAAM3zF,GAAK2zF,EAAM3zF,GAAGq0F,WAAW,SAAU,KAC3C,CACAjjG,EAAQuiG,EAAMpzF,KAAK,IACrB,CACA,OAAOnP,CACT,CACA,SAASgiG,EAAckB,GAErB,MAAMC,EAAcD,EAAS7D,QAAQ,KACrC,OAAqB,IAAjB8D,EAIKD,EAMFP,EAJUO,EAAS3tF,MAAM,EAAG4tF,GACjBD,EAAS3tF,MAAM4tF,EAAc,GAEvB1iE,QAAQ,UAAW,IAE7C,CACA,SAASwhE,EAAcjiG,GAWrB,OAAKA,EAAM8L,WAAW,OAAS,uBAAuB2V,KAAKzhB,GAClDA,EASFA,EAAMijG,WACX,iDACA,SAAUjgF,EAASogF,EAASR,EAAUxkF,GACpC,GAAiB,MAAbwkF,GAAiC,MAAbA,EAMtB,OAAOD,EAAWS,EAHlBhlF,GADAA,EAAOA,EAAK6kF,WAAW,IAAK,MAChBA,WAAW,qBAAsB,SAAUj3F,EAAOu1D,GAC5D,OAAO9yD,OAAOC,aAAayU,SAASo+C,EAAK,IAC3C,IAGF,IACEnjD,EAAOk6C,KAAKl6C,EACd,CAAE,MAAAilF,GAAO,CACT,OAAOV,EAAWS,EAAShlF,EAC7B,EAEJ,CAEA,MAAO,EACT,CDhImBklF,CAAwC3B,GACvD,GAAIngF,EAAS5Q,SAAS,KACpB,IACE4Q,EAAWtV,mBAAmBsV,EAChC,CAAE,MAAA+hF,GAAO,CAEX,GAAIhiF,GAAUC,GACZ,OAAOA,CAEX,CACA,OAAO,IACT,CAEA,SAASgiF,GAAoBt1F,EAAQzC,GACnC,OAAO,IAAIwC,GAAkB,+BAAD/C,OACKgD,EAAM,4BAAAhD,OAA2BO,EAAG,MACnEyC,EAC2B,MAAXA,GAA8B,IAAXA,GAAgBzC,EAAIK,WAAW,SAEtE,CAEA,SAAS23F,GAAuBv1F,GAC9B,OAAkB,MAAXA,GAA6B,MAAXA,CAC3B,CEhFA,SAASw1F,GAAmB5C,EAAS6C,EAAiBC,GACpD,MAAO,CACLC,OAAQ,MACR/C,UACAj3E,OAAQ+5E,EAAgB/5E,OACxB6Z,KAAM,OACNogE,YAAaH,EAAkB,UAAY,cAC3CI,SAAU,SAEd,CAEA,SAASC,GAAetwC,GACtB,OAAIA,aAAepkD,WACVokD,EAAI9jD,OAET8jD,aAAe5B,YACV4B,GAETvoD,GAAK,4CAADD,OAA6CwoD,IAC1C,IAAIpkD,WAAWokD,GAAK9jD,OAC7B,CAGA,MAAMq0F,GAGJv2F,WAAAA,CAAYm2B,IAAQ9kB,EAAAA,EAAAA,GAAA,uBAFF,MAGhB7e,KAAK2jC,OAASA,EACd3jC,KAAK0gG,OAAS,YAAYn/E,KAAKoiB,EAAOp4B,KACtCvL,KAAK4gG,QAAUH,GAAczgG,KAAK0gG,OAAQ/8D,EAAOg9D,aAEjD3gG,KAAKu9F,mBAAqB,KAC1Bv9F,KAAKgkG,qBAAuB,EAC9B,CAEA,0BAAIzF,GAAyB,IAAA0F,EAAAC,EAC3B,OAAuC,QAAvCD,EAA8B,QAA9BC,EAAOlkG,KAAKu9F,0BAAkB,IAAA2G,OAAA,EAAvBA,EAAyBxF,eAAO,IAAAuF,EAAAA,EAAI,CAC7C,CAEA7E,aAAAA,GAME,OALAh0F,IACGpL,KAAKu9F,mBACN,yDAEFv9F,KAAKu9F,mBAAqB,IAAI4G,GAAqBnkG,MAC5CA,KAAKu9F,kBACd,CAEAgC,cAAAA,CAAe7B,EAAO17E,GACpB,GAAIA,GAAOhiB,KAAKu+F,uBACd,OAAO,KAET,MAAMW,EAAS,IAAIkF,GAA0BpkG,KAAM09F,EAAO17E,GAE1D,OADAhiB,KAAKgkG,qBAAqBh1F,KAAKkwF,GACxBA,CACT,CAEAQ,iBAAAA,CAAkB15B,GAAQ,IAAAq+B,EACD,QAAvBA,EAAArkG,KAAKu9F,0BAAkB,IAAA8G,GAAvBA,EAAyB7uD,OAAOwwB,GAEhC,IAAK,MAAMk5B,KAAUl/F,KAAKgkG,qBAAqB3uF,MAAM,GACnD6pF,EAAO1pD,OAAOwwB,EAElB,EAIF,MAAMm+B,GACJ32F,WAAAA,CAAYu4D,GACV/lE,KAAK4/F,QAAU75B,EACf/lE,KAAKskG,QAAU,KACftkG,KAAK0+F,QAAU,EACf1+F,KAAK8/F,UAAY,KACjB,MAAMn8D,EAASoiC,EAAOpiC,OACtB3jC,KAAKukG,iBAAmB5gE,EAAO8/D,kBAAmB,EAClDzjG,KAAKs9F,eAAiB35D,EAAOtlC,OAC7B2B,KAAKwkG,mBAAqB9kG,QAAQujC,gBAClCjjC,KAAKykG,cAAgB9gE,EAAOg5D,eAAgB,EAC5C38F,KAAK0kG,gBAAkB/gE,EAAOy9D,eACzBphG,KAAK0kG,iBAAoB1kG,KAAKykG,gBACjCzkG,KAAKykG,eAAgB,GAGvBzkG,KAAKy3B,iBAAmB,IAAIwF,gBAC5Bj9B,KAAKo9F,uBAAyBz5D,EAAOi5D,cACrC58F,KAAKq9F,mBAAqB15D,EAAOg5D,aAEjC,MAAMiE,EAAU,IAAIC,QAAQ96B,EAAO66B,SAE7Br1F,EAAMo4B,EAAOp4B,IACnBqS,MACErS,EACAi4F,GAAmB5C,EAAS5gG,KAAKukG,iBAAkBvkG,KAAKy3B,mBAEvD13B,KAAK4d,IAGJ,GAFAooD,EAAO4+B,gBAAkB7D,GAAkBnjF,EAASpS,MAE/Cg4F,GAAuB5lF,EAAS3P,QACnC,MAAMs1F,GAAoB3lF,EAAS3P,OAAQzC,GAE7CvL,KAAKskG,QAAU3mF,EAASqZ,KAAK4tE,YAC7B5kG,KAAKwkG,mBAAmB3kG,UAExB,MAAMshG,EAAkBxjF,EAASijF,SAE3B,mBAAEU,EAAkB,gBAAEC,GAC1BN,GAAiC,CAC/BE,kBACAT,OAAQ36B,EAAO26B,OACfU,eAAgBphG,KAAK0kG,gBACrB/H,aAAc38F,KAAKykG,gBAGvBzkG,KAAKq9F,kBAAoBiE,EAEzBthG,KAAKs9F,eAAiBiE,GAAmBvhG,KAAKs9F,eAE9Ct9F,KAAK8/F,UAAY0B,GAA0BL,IAItCnhG,KAAKo9F,uBAAyBp9F,KAAKq9F,mBACtCr9F,KAAKw1C,OAAO,IAAIrnC,GAAe,6BAGlCm6D,MAAMtoE,KAAKwkG,mBAAmB7kG,QAEjCK,KAAK++F,WAAa,IACpB,CAEA,gBAAIkB,GACF,OAAOjgG,KAAKwkG,mBAAmBxhE,OACjC,CAEA,YAAI1hB,GACF,OAAOthB,KAAK8/F,SACd,CAEA,iBAAIM,GACF,OAAOpgG,KAAKs9F,cACd,CAEA,oBAAI4C,GACF,OAAOlgG,KAAKq9F,iBACd,CAEA,wBAAI8C,GACF,OAAOngG,KAAKo9F,qBACd,CAEA,UAAMiD,GAAO,IAAAwE,QACL7kG,KAAKwkG,mBAAmBxhE,QAC9B,MAAM,MAAEljC,EAAK,KAAEF,SAAeI,KAAKskG,QAAQjE,OAC3C,OAAIzgG,EACK,CAAEE,QAAOF,SAElBI,KAAK0+F,SAAW5+F,EAAMgyD,WACP,QAAf+yC,EAAA7kG,KAAK++F,kBAAU,IAAA8F,GAAfA,EAAAxzF,KAAArR,KAAkB,CAChBy3D,OAAQz3D,KAAK0+F,QACbb,MAAO79F,KAAKs9F,iBAGP,CAAEx9F,MAAOgkG,GAAehkG,GAAQF,MAAM,GAC/C,CAEA41C,MAAAA,CAAOwwB,GAAQ,IAAA8+B,EACD,QAAZA,EAAA9kG,KAAKskG,eAAO,IAAAQ,GAAZA,EAActvD,OAAOwwB,GACrBhmE,KAAKy3B,iBAAiB0H,OACxB,EAIF,MAAMilE,GACJ52F,WAAAA,CAAYu4D,EAAQ23B,EAAO17E,GACzBhiB,KAAK4/F,QAAU75B,EACf/lE,KAAKskG,QAAU,KACftkG,KAAK0+F,QAAU,EACf,MAAM/6D,EAASoiC,EAAOpiC,OACtB3jC,KAAKukG,iBAAmB5gE,EAAO8/D,kBAAmB,EAClDzjG,KAAK+kG,gBAAkBrlG,QAAQujC,gBAC/BjjC,KAAKo9F,uBAAyBz5D,EAAOi5D,cAErC58F,KAAKy3B,iBAAmB,IAAIwF,gBAE5B,MAAM2jE,EAAU,IAAIC,QAAQ96B,EAAO66B,SACnCA,EAAQxkF,OAAO,QAAS,SAAFpR,OAAW0yF,EAAK,KAAA1yF,OAAIgX,EAAM,IAEhD,MAAMzW,EAAMo4B,EAAOp4B,IACnBqS,MACErS,EACAi4F,GAAmB5C,EAAS5gG,KAAKukG,iBAAkBvkG,KAAKy3B,mBAEvD13B,KAAK4d,IACJ,MAAMqnF,EAAiBlE,GAAkBnjF,EAASpS,KAElD,GAAIy5F,IAAmBj/B,EAAO4+B,gBAC5B,MAAM,IAAIx5F,MAAM,mCAADH,OACsBg6F,EAAc,gBAAAh6F,OAAe+6D,EAAO4+B,gBAAe,OAG1F,IAAKpB,GAAuB5lF,EAAS3P,QACnC,MAAMs1F,GAAoB3lF,EAAS3P,OAAQzC,GAE7CvL,KAAK+kG,gBAAgBllG,UACrBG,KAAKskG,QAAU3mF,EAASqZ,KAAK4tE,cAE9Bt8B,MAAMtoE,KAAK+kG,gBAAgBplG,QAE9BK,KAAK++F,WAAa,IACpB,CAEA,wBAAIoB,GACF,OAAOngG,KAAKo9F,qBACd,CAEA,UAAMiD,GAAO,IAAA4E,QACLjlG,KAAK+kG,gBAAgB/hE,QAC3B,MAAM,MAAEljC,EAAK,KAAEF,SAAeI,KAAKskG,QAAQjE,OAC3C,OAAIzgG,EACK,CAAEE,QAAOF,SAElBI,KAAK0+F,SAAW5+F,EAAMgyD,WACP,QAAfmzC,EAAAjlG,KAAK++F,kBAAU,IAAAkG,GAAfA,EAAA5zF,KAAArR,KAAkB,CAAEy3D,OAAQz3D,KAAK0+F,UAE1B,CAAE5+F,MAAOgkG,GAAehkG,GAAQF,MAAM,GAC/C,CAEA41C,MAAAA,CAAOwwB,GAAQ,IAAAk/B,EACD,QAAZA,EAAAllG,KAAKskG,eAAO,IAAAY,GAAZA,EAAc1vD,OAAOwwB,GACrBhmE,KAAKy3B,iBAAiB0H,OACxB,EC5NF,MAAMgmE,GAGJ33F,WAAAA,CAAW43F,GAAwC,IAAvC,IAAE75F,EAAG,YAAEo1F,EAAW,gBAAE8C,GAAiB2B,GAAAvmF,EAAAA,EAAAA,GAAA,uBAF/B,MAGhB7e,KAAKuL,IAAMA,EACXvL,KAAK0gG,OAAS,YAAYn/E,KAAKhW,GAC/BvL,KAAK4gG,QAAUH,GAAczgG,KAAK0gG,OAAQC,GAC1C3gG,KAAKyjG,gBAAkBA,IAAmB,EAE1CzjG,KAAKqlG,UAAY,EACjBrlG,KAAKslG,gBAAkBhnG,OAAOwa,OAAO,KACvC,CAEAqF,OAAAA,CAAQ/F,GACN,MAAMmtF,EAAM,IAAInnF,eACVonF,EAAQxlG,KAAKqlG,YACbI,EAAkBzlG,KAAKslG,gBAAgBE,GAAS,CAAED,OAExDA,EAAIlnF,KAAK,MAAOre,KAAKuL,KACrBg6F,EAAI9B,gBAAkBzjG,KAAKyjG,gBAC3B,IAAK,MAAOvoF,EAAKs4C,KAAQxzD,KAAK4gG,QAC5B2E,EAAIG,iBAAiBxqF,EAAKs4C,GAwB5B,OAtBIxzD,KAAK0gG,QAAU,UAAWtoF,GAAQ,QAASA,GAC7CmtF,EAAIG,iBAAiB,QAAS,SAAF16F,OAAWoN,EAAKslF,MAAK,KAAA1yF,OAAIoN,EAAK4J,IAAM,IAChEyjF,EAAeE,eAnCY,KAqC3BF,EAAeE,eAtCD,IAwChBJ,EAAIjnF,aAAe,cAEnBlT,GAAOgN,EAAKwtF,QAAS,+CACrBL,EAAIhxE,QAAU,KACZnc,EAAKwtF,QAAQL,EAAIv3F,SAEnBu3F,EAAIhnF,mBAAqBve,KAAK6lG,cAAct4E,KAAKvtB,KAAMwlG,GACvDD,EAAIO,WAAa9lG,KAAK++F,WAAWxxE,KAAKvtB,KAAMwlG,GAE5CC,EAAeM,kBAAoB3tF,EAAK2tF,kBACxCN,EAAeO,OAAS5tF,EAAK4tF,OAC7BP,EAAeG,QAAUxtF,EAAKwtF,QAC9BH,EAAe1G,WAAa3mF,EAAK2mF,WAEjCwG,EAAI5mF,KAAK,MAEF6mF,CACT,CAEAzG,UAAAA,CAAWyG,EAAO3nE,GAAK,IAAAooE,EACrB,MAAMR,EAAiBzlG,KAAKslG,gBAAgBE,GACvCC,IAGoB,QAAzBQ,EAAAR,EAAe1G,kBAAU,IAAAkH,GAAzBA,EAAA50F,KAAAo0F,EAA4B5nE,GAC9B,CAEAgoE,aAAAA,CAAcL,EAAO3nE,GACnB,MAAM4nE,EAAiBzlG,KAAKslG,gBAAgBE,GAC5C,IAAKC,EACH,OAGF,MAAMF,EAAME,EAAeF,IAM3B,GALIA,EAAI/mF,YAAc,GAAKinF,EAAeM,oBACxCN,EAAeM,2BACRN,EAAeM,mBAGD,IAAnBR,EAAI/mF,WACN,OAGF,KAAMgnF,KAASxlG,KAAKslG,iBAGlB,OAMF,UAHOtlG,KAAKslG,gBAAgBE,GAGT,IAAfD,EAAIv3F,QAAgBhO,KAAK0gG,OAE3B,YADA+E,EAAeG,QAAQL,EAAIv3F,QAG7B,MAAMk4F,EAAYX,EAAIv3F,QAhGN,IAyGhB,KAzGgB,MAsGdk4F,GArG2B,MAsG3BT,EAAeE,iBAIfO,IAAcT,EAAeE,eAG7B,YADAF,EAAeG,QAAQL,EAAIv3F,QAI7B,MAAMc,EA9GV,SAAwBy2F,GACtB,MAAMr9E,EAAOq9E,EAAI5nF,SACjB,MAAoB,kBAATuK,EACFA,EAEFhZ,GAAcgZ,GAAMxY,MAC7B,CAwGkBy2F,CAAeZ,GAC7B,GAjH6B,MAiHzBW,EAAwC,CAC1C,MAAME,EAAcb,EAAIc,kBAAkB,iBACpCvjF,EAAU,2BAA2BC,KAAKqjF,GAC5CtjF,EACF2iF,EAAeO,OAAO,CACpBtI,MAAOz6E,SAASH,EAAQ,GAAI,IAC5BhU,WAGF7D,GAAK,8CACLw6F,EAAeG,QAAQ,GAE3B,MAAW92F,EACT22F,EAAeO,OAAO,CACpBtI,MAAO,EACP5uF,UAGF22F,EAAeG,QAAQL,EAAIv3F,OAE/B,CAEAs4F,aAAAA,CAAcd,GACZ,OAAOxlG,KAAKslG,gBAAgBE,GAAOD,GACrC,CAEAgB,gBAAAA,CAAiBf,GACf,OAAOA,KAASxlG,KAAKslG,eACvB,CAEAkB,YAAAA,CAAahB,GACX,MAAMD,EAAMvlG,KAAKslG,gBAAgBE,GAAOD,WACjCvlG,KAAKslG,gBAAgBE,GAC5BD,EAAIpmE,OACN,EAIF,MAAMsnE,GACJj5F,WAAAA,CAAYm2B,GACV3jC,KAAK0mG,QAAU/iE,EACf3jC,KAAK2mG,SAAW,IAAIxB,GAAexhE,GACnC3jC,KAAK0kG,gBAAkB/gE,EAAOy9D,eAC9BphG,KAAKu9F,mBAAqB,KAC1Bv9F,KAAKgkG,qBAAuB,EAC9B,CAEA4C,2BAAAA,CAA4B1H,GAC1B,MAAMxwF,EAAI1O,KAAKgkG,qBAAqB7E,QAAQD,GACxCxwF,GAAK,GACP1O,KAAKgkG,qBAAqBxuE,OAAO9mB,EAAG,EAExC,CAEA0wF,aAAAA,GASE,OARAh0F,IACGpL,KAAKu9F,mBACN,2DAEFv9F,KAAKu9F,mBAAqB,IAAIsJ,GAC5B7mG,KAAK2mG,SACL3mG,KAAK0mG,SAEA1mG,KAAKu9F,kBACd,CAEAgC,cAAAA,CAAe7B,EAAO17E,GACpB,MAAMk9E,EAAS,IAAI4H,GACjB9mG,KAAK2mG,SACLjJ,EACA17E,GAIF,OAFAk9E,EAAO6H,SAAW/mG,KAAK4mG,4BAA4Br5E,KAAKvtB,MACxDA,KAAKgkG,qBAAqBh1F,KAAKkwF,GACxBA,CACT,CAEAQ,iBAAAA,CAAkB15B,GAAQ,IAAAghC,EACD,QAAvBA,EAAAhnG,KAAKu9F,0BAAkB,IAAAyJ,GAAvBA,EAAyBxxD,OAAOwwB,GAEhC,IAAK,MAAMk5B,KAAUl/F,KAAKgkG,qBAAqB3uF,MAAM,GACnD6pF,EAAO1pD,OAAOwwB,EAElB,EAIF,MAAM6gC,GACJr5F,WAAAA,CAAYy5F,EAAStjE,GACnB3jC,KAAK2mG,SAAWM,EAEhBjnG,KAAKknG,KAAOvjE,EAAOp4B,IACnBvL,KAAKmnG,eAAiBF,EAAQ9oF,QAAQ,CACpC4nF,kBAAmB/lG,KAAKonG,mBAAmB75E,KAAKvtB,MAChDgmG,OAAQhmG,KAAKqnG,QAAQ95E,KAAKvtB,MAC1B4lG,QAAS5lG,KAAKsnG,SAAS/5E,KAAKvtB,MAC5B++F,WAAY/+F,KAAK89F,YAAYvwE,KAAKvtB,QAEpCA,KAAKwkG,mBAAqB9kG,QAAQujC,gBAClCjjC,KAAKykG,cAAgB9gE,EAAOg5D,eAAgB,EAC5C38F,KAAKs9F,eAAiB35D,EAAOtlC,OAC7B2B,KAAK0kG,gBAAkB/gE,EAAOy9D,eACzBphG,KAAK0kG,iBAAoB1kG,KAAKykG,gBACjCzkG,KAAKykG,eAAgB,GAGvBzkG,KAAKo9F,uBAAwB,EAC7Bp9F,KAAKq9F,mBAAoB,EAEzBr9F,KAAKunG,cAAgB,GACrBvnG,KAAK+/F,UAAY,GACjB//F,KAAK6/F,OAAQ,EACb7/F,KAAKwnG,kBAAe/7F,EACpBzL,KAAK8/F,UAAY,KAEjB9/F,KAAK++F,WAAa,IACpB,CAEAqI,kBAAAA,GACE,MAAMK,EAAmBznG,KAAKmnG,eACxBO,EAAiB1nG,KAAK2mG,SAASL,cAAcmB,GAEnDznG,KAAK2mG,SAAShC,gBAAkB7D,GAC9B4G,EAAeC,aAGjB,MAAMC,EAAqBF,EAAeG,wBACpC1G,EAAkB,IAAIN,QAC1B+G,EACIA,EACGE,YACAvnE,QAAQ,WAAY,IACpB1zB,MAAM,WACNgX,IAAI/N,IACH,MAAOoF,KAAQs4C,GAAO19C,EAAEjJ,MAAM,MAC9B,MAAO,CAACqO,EAAKs4C,EAAIvkD,KAAK,SAE1B,KAGA,mBAAEqyF,EAAkB,gBAAEC,GAC1BN,GAAiC,CAC/BE,kBACAT,OAAQ1gG,KAAK2mG,SAASjG,OACtBU,eAAgBphG,KAAK0kG,gBACrB/H,aAAc38F,KAAKykG,gBAGnBnD,IACFthG,KAAKq9F,mBAAoB,GAG3Br9F,KAAKs9F,eAAiBiE,GAAmBvhG,KAAKs9F,eAE9Ct9F,KAAK8/F,UAAY0B,GAA0BL,GAEvCnhG,KAAKq9F,mBAKPr9F,KAAK2mG,SAASH,aAAaiB,GAG7BznG,KAAKwkG,mBAAmB3kG,SAC1B,CAEAwnG,OAAAA,CAAQn/E,GACN,GAAIA,EACF,GAAIloB,KAAK+/F,UAAU1hG,OAAS,EAAG,CACH2B,KAAK+/F,UAAU7nC,QACvBr4D,QAAQ,CAAEC,MAAOooB,EAAKpZ,MAAOlP,MAAM,GACvD,MACEI,KAAKunG,cAAcv4F,KAAKkZ,EAAKpZ,OAIjC,GADA9O,KAAK6/F,OAAQ,IACT7/F,KAAKunG,cAAclpG,OAAS,GAAhC,CAGA,IAAK,MAAMiiG,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,CAJxB,CAKF,CAEAipG,QAAAA,CAASt5F,GACPhO,KAAKwnG,aAAelE,GAAoBt1F,EAAQhO,KAAKknG,MACrDlnG,KAAKwkG,mBAAmB7kG,OAAOK,KAAKwnG,cACpC,IAAK,MAAMlH,KAAqBtgG,KAAK+/F,UACnCO,EAAkB3gG,OAAOK,KAAKwnG,cAEhCxnG,KAAK+/F,UAAU1hG,OAAS,EACxB2B,KAAKunG,cAAclpG,OAAS,CAC9B,CAEAy/F,WAAAA,CAAYjgE,GAAK,IAAAkqE,EACA,QAAfA,EAAA/nG,KAAK++F,kBAAU,IAAAgJ,GAAfA,EAAA12F,KAAArR,KAAkB,CAChBy3D,OAAQ55B,EAAI45B,OACZomC,MAAOhgE,EAAImqE,iBAAmBnqE,EAAIggE,MAAQ79F,KAAKs9F,gBAEnD,CAEA,YAAIh8E,GACF,OAAOthB,KAAK8/F,SACd,CAEA,oBAAII,GACF,OAAOlgG,KAAKq9F,iBACd,CAEA,wBAAI8C,GACF,OAAOngG,KAAKo9F,qBACd,CAEA,iBAAIgD,GACF,OAAOpgG,KAAKs9F,cACd,CAEA,gBAAI2C,GACF,OAAOjgG,KAAKwkG,mBAAmBxhE,OACjC,CAEA,UAAMq9D,GAGJ,SAFMrgG,KAAKwkG,mBAAmBxhE,QAE1BhjC,KAAKwnG,aACP,MAAMxnG,KAAKwnG,aAEb,GAAIxnG,KAAKunG,cAAclpG,OAAS,EAAG,CAEjC,MAAO,CAAEyB,MADKE,KAAKunG,cAAcrvC,QACVt4D,MAAM,EAC/B,CACA,GAAII,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,MAAM0gG,EAAoB5gG,QAAQujC,gBAElC,OADAjjC,KAAK+/F,UAAU/wF,KAAKsxF,GACbA,EAAkBt9D,OAC3B,CAEAwS,MAAAA,CAAOwwB,GACLhmE,KAAK6/F,OAAQ,EACb7/F,KAAKwkG,mBAAmB7kG,OAAOqmE,GAC/B,IAAK,MAAMs6B,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,EACpB2B,KAAK2mG,SAASJ,iBAAiBvmG,KAAKmnG,iBACtCnnG,KAAK2mG,SAASH,aAAaxmG,KAAKmnG,gBAElCnnG,KAAKu9F,mBAAqB,IAC5B,EAIF,MAAMuJ,GACJt5F,WAAAA,CAAYy5F,EAASvJ,EAAO17E,GAC1BhiB,KAAK2mG,SAAWM,EAEhBjnG,KAAKknG,KAAOD,EAAQ17F,IACpBvL,KAAKioG,WAAahB,EAAQ9oF,QAAQ,CAChCu/E,QACA17E,MACA+jF,kBAAmB/lG,KAAKonG,mBAAmB75E,KAAKvtB,MAChDgmG,OAAQhmG,KAAKqnG,QAAQ95E,KAAKvtB,MAC1B4lG,QAAS5lG,KAAKsnG,SAAS/5E,KAAKvtB,MAC5B++F,WAAY/+F,KAAK89F,YAAYvwE,KAAKvtB,QAEpCA,KAAK+/F,UAAY,GACjB//F,KAAKwgG,aAAe,KACpBxgG,KAAK6/F,OAAQ,EACb7/F,KAAKwnG,kBAAe/7F,EAEpBzL,KAAK++F,WAAa,KAClB/+F,KAAK+mG,SAAW,IAClB,CAEAK,kBAAAA,GAAqB,IAAAc,EACnB,MAAMlD,EAAiBlE,GACuB,QADNoH,EACtCloG,KAAK2mG,SAASL,cAActmG,KAAKioG,mBAAW,IAAAC,OAAA,EAA5CA,EAA8CP,aAG5C3C,IAAmBhlG,KAAK2mG,SAAShC,kBACnC3kG,KAAKwnG,aAAe,IAAIr8F,MAAM,mCAADH,OACQg6F,EAAc,gBAAAh6F,OAAehL,KAAK2mG,SAAShC,gBAAe,OAE/F3kG,KAAKsnG,SAAS,GAElB,CAEAa,MAAAA,GAAS,IAAAC,EACM,QAAbA,EAAApoG,KAAK+mG,gBAAQ,IAAAqB,GAAbA,EAAA/2F,KAAArR,KAAgBA,KAClB,CAEAqnG,OAAAA,CAAQn/E,GACN,MAAMpZ,EAAQoZ,EAAKpZ,MACnB,GAAI9O,KAAK+/F,UAAU1hG,OAAS,EAAG,CACH2B,KAAK+/F,UAAU7nC,QACvBr4D,QAAQ,CAAEC,MAAOgP,EAAOlP,MAAM,GAClD,MACEI,KAAKwgG,aAAe1xF,EAEtB9O,KAAK6/F,OAAQ,EACb,IAAK,MAAMS,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,EACxB2B,KAAKmoG,QACP,CAEAb,QAAAA,CAASt5F,GAAQ,IAAAq6F,EACE,QAAjBA,EAAAroG,KAAKwnG,oBAAY,IAAAa,IAAjBroG,KAAKwnG,aAAiBlE,GAAoBt1F,EAAQhO,KAAKknG,OACvD,IAAK,MAAM5G,KAAqBtgG,KAAK+/F,UACnCO,EAAkB3gG,OAAOK,KAAKwnG,cAEhCxnG,KAAK+/F,UAAU1hG,OAAS,EACxB2B,KAAKwgG,aAAe,IACtB,CAEA1C,WAAAA,CAAYjgE,GACsB,IAAAyqE,EAA3BtoG,KAAKmgG,uBACO,QAAfmI,EAAAtoG,KAAK++F,kBAAU,IAAAuJ,GAAfA,EAAAj3F,KAAArR,KAAkB,CAAEy3D,OAAQ55B,EAAI45B,SAEpC,CAEA,wBAAI0oC,GACF,OAAO,CACT,CAEA,UAAME,GACJ,GAAIrgG,KAAKwnG,aACP,MAAMxnG,KAAKwnG,aAEb,GAA0B,OAAtBxnG,KAAKwgG,aAAuB,CAC9B,MAAM1xF,EAAQ9O,KAAKwgG,aAEnB,OADAxgG,KAAKwgG,aAAe,KACb,CAAE1gG,MAAOgP,EAAOlP,MAAM,EAC/B,CACA,GAAII,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,MAAM0gG,EAAoB5gG,QAAQujC,gBAElC,OADAjjC,KAAK+/F,UAAU/wF,KAAKsxF,GACbA,EAAkBt9D,OAC3B,CAEAwS,MAAAA,CAAOwwB,GACLhmE,KAAK6/F,OAAQ,EACb,IAAK,MAAMS,KAAqBtgG,KAAK+/F,UACnCO,EAAkBzgG,QAAQ,CAAEC,WAAO2L,EAAW7L,MAAM,IAEtDI,KAAK+/F,UAAU1hG,OAAS,EACpB2B,KAAK2mG,SAASJ,iBAAiBvmG,KAAKioG,aACtCjoG,KAAK2mG,SAASH,aAAaxmG,KAAKioG,YAElCjoG,KAAKmoG,QACP,EC5dF,MAAMI,GAAW,wBAUjB,MAAMC,GACJh7F,WAAAA,CAAYm2B,GACV3jC,KAAK2jC,OAASA,EACd3jC,KAAKuL,IAXT,SAAwBk9F,GACtB,GAAIF,GAAShnF,KAAKknF,GAChB,OAAO,IAAIr8F,IAAIq8F,GAEjB,MAAMl9F,EAAMnL,QAAQquE,iBAAiB,OACrC,OAAO,IAAIriE,IAAIb,EAAIm9F,cAAcD,GACnC,CAKeE,CAAehlE,EAAOp4B,KACjCH,GACwB,UAAtBpL,KAAKuL,IAAIe,SACT,6CAGFtM,KAAKu9F,mBAAqB,KAC1Bv9F,KAAKgkG,qBAAuB,EAC9B,CAEA,0BAAIzF,GAAyB,IAAAqK,EAAAC,EAC3B,OAAuC,QAAvCD,EAA8B,QAA9BC,EAAO7oG,KAAKu9F,0BAAkB,IAAAsL,OAAA,EAAvBA,EAAyBnK,eAAO,IAAAkK,EAAAA,EAAI,CAC7C,CAEAxJ,aAAAA,GAME,OALAh0F,IACGpL,KAAKu9F,mBACN,wDAEFv9F,KAAKu9F,mBAAqB,IAAIuL,GAA0B9oG,MACjDA,KAAKu9F,kBACd,CAEAgC,cAAAA,CAAex9E,EAAOC,GACpB,GAAIA,GAAOhiB,KAAKu+F,uBACd,OAAO,KAET,MAAMF,EAAc,IAAI0K,GAA2B/oG,KAAM+hB,EAAOC,GAEhE,OADAhiB,KAAKgkG,qBAAqBh1F,KAAKqvF,GACxBA,CACT,CAEAqB,iBAAAA,CAAkB15B,GAAQ,IAAAgjC,EACD,QAAvBA,EAAAhpG,KAAKu9F,0BAAkB,IAAAyL,GAAvBA,EAAyBxzD,OAAOwwB,GAEhC,IAAK,MAAMk5B,KAAUl/F,KAAKgkG,qBAAqB3uF,MAAM,GACnD6pF,EAAO1pD,OAAOwwB,EAElB,EAGF,MAAM8iC,GACJt7F,WAAAA,CAAYu4D,GACV/lE,KAAKknG,KAAOnhC,EAAOx6D,IACnBvL,KAAK6/F,OAAQ,EACb7/F,KAAKwnG,aAAe,KACpBxnG,KAAK++F,WAAa,KAClB,MAAMp7D,EAASoiC,EAAOpiC,OACtB3jC,KAAKs9F,eAAiB35D,EAAOtlC,OAC7B2B,KAAK0+F,QAAU,EACf1+F,KAAK8/F,UAAY,KAEjB9/F,KAAKykG,cAAgB9gE,EAAOg5D,eAAgB,EAC5C38F,KAAK0kG,gBAAkB/gE,EAAOy9D,eACzBphG,KAAK0kG,iBAAoB1kG,KAAKykG,gBACjCzkG,KAAKykG,eAAgB,GAGvBzkG,KAAKo9F,uBAAyBz5D,EAAOi5D,cACrC58F,KAAKq9F,mBAAqB15D,EAAOg5D,aAEjC38F,KAAKipG,gBAAkB,KACvBjpG,KAAK+kG,gBAAkBrlG,QAAQujC,gBAC/BjjC,KAAKwkG,mBAAqB9kG,QAAQujC,gBAElC,MAAMurC,EAAKpuE,QAAQquE,iBAAiB,MACpCD,EAAG17B,SAASo2D,MAAMlpG,KAAKknG,MAAMnnG,KAC3BopG,IAEEnpG,KAAKs9F,eAAiB6L,EAAK14E,KAE3BzwB,KAAKopG,mBAAmB56B,EAAG66B,iBAAiBrpG,KAAKknG,OACjDlnG,KAAKwkG,mBAAmB3kG,WAE1B+mE,IACqB,WAAfA,EAAMl5D,OACRk5D,EAAQ08B,GAAmC,EAAGtjG,KAAKknG,KAAKt6F,OAE1D5M,KAAKwnG,aAAe5gC,EACpB5mE,KAAKwkG,mBAAmB7kG,OAAOinE,IAGrC,CAEA,gBAAIq5B,GACF,OAAOjgG,KAAKwkG,mBAAmBxhE,OACjC,CAEA,YAAI1hB,GACF,OAAOthB,KAAK8/F,SACd,CAEA,iBAAIM,GACF,OAAOpgG,KAAKs9F,cACd,CAEA,oBAAI4C,GACF,OAAOlgG,KAAKq9F,iBACd,CAEA,wBAAI8C,GACF,OAAOngG,KAAKo9F,qBACd,CAEA,UAAMiD,GAAO,IAAAiJ,EAEX,SADMtpG,KAAK+kG,gBAAgB/hE,QACvBhjC,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,GAAII,KAAKwnG,aACP,MAAMxnG,KAAKwnG,aAGb,MAAM14F,EAAQ9O,KAAKipG,gBAAgB5I,OACnC,GAAc,OAAVvxF,EAEF,OADA9O,KAAK+kG,gBAAkBrlG,QAAQujC,gBACxBjjC,KAAKqgG,OAEdrgG,KAAK0+F,SAAW5vF,EAAMzQ,OACP,QAAfirG,EAAAtpG,KAAK++F,kBAAU,IAAAuK,GAAfA,EAAAj4F,KAAArR,KAAkB,CAChBy3D,OAAQz3D,KAAK0+F,QACbb,MAAO79F,KAAKs9F,iBAKd,MAAO,CAAEx9F,MADM,IAAIsP,WAAWN,GAAOY,OACb9P,MAAM,EAChC,CAEA41C,MAAAA,CAAOwwB,GAGAhmE,KAAKipG,gBAIVjpG,KAAKipG,gBAAgB97E,QAAQ64C,GAH3BhmE,KAAKupG,OAAOvjC,EAIhB,CAEAujC,MAAAA,CAAOvjC,GACLhmE,KAAKwnG,aAAexhC,EACpBhmE,KAAK+kG,gBAAgBllG,SACvB,CAEAupG,kBAAAA,CAAmBI,GACjBxpG,KAAKipG,gBAAkBO,EACvBA,EAAepmE,GAAG,WAAY,KAC5BpjC,KAAK+kG,gBAAgBllG,YAGvB2pG,EAAepmE,GAAG,MAAO,KAEvBomE,EAAer8E,UACfntB,KAAK6/F,OAAQ,EACb7/F,KAAK+kG,gBAAgBllG,YAGvB2pG,EAAepmE,GAAG,QAAS4iC,IACzBhmE,KAAKupG,OAAOvjC,MAKThmE,KAAKo9F,uBAAyBp9F,KAAKq9F,mBACtCr9F,KAAKupG,OAAO,IAAIp7F,GAAe,0BAI7BnO,KAAKwnG,cACPxnG,KAAKipG,gBAAgB97E,QAAQntB,KAAKwnG,aAEtC,EAGF,MAAMuB,GACJv7F,WAAAA,CAAYu4D,EAAQhkD,EAAOC,GACzBhiB,KAAKknG,KAAOnhC,EAAOx6D,IACnBvL,KAAK6/F,OAAQ,EACb7/F,KAAKwnG,aAAe,KACpBxnG,KAAK++F,WAAa,KAClB/+F,KAAK0+F,QAAU,EACf1+F,KAAKipG,gBAAkB,KACvBjpG,KAAK+kG,gBAAkBrlG,QAAQujC,gBAC/B,MAAMU,EAASoiC,EAAOpiC,OACtB3jC,KAAKo9F,uBAAyBz5D,EAAOi5D,cAErC,MAAMpuB,EAAKpuE,QAAQquE,iBAAiB,MACpCzuE,KAAKopG,mBACH56B,EAAG66B,iBAAiBrpG,KAAKknG,KAAM,CAAEnlF,QAAOC,IAAKA,EAAM,IAEvD,CAEA,wBAAIm+E,GACF,OAAOngG,KAAKo9F,qBACd,CAEA,UAAMiD,GAAO,IAAAoJ,EAEX,SADMzpG,KAAK+kG,gBAAgB/hE,QACvBhjC,KAAK6/F,MACP,MAAO,CAAE//F,WAAO2L,EAAW7L,MAAM,GAEnC,GAAII,KAAKwnG,aACP,MAAMxnG,KAAKwnG,aAGb,MAAM14F,EAAQ9O,KAAKipG,gBAAgB5I,OACnC,GAAc,OAAVvxF,EAEF,OADA9O,KAAK+kG,gBAAkBrlG,QAAQujC,gBACxBjjC,KAAKqgG,OAEdrgG,KAAK0+F,SAAW5vF,EAAMzQ,OACP,QAAforG,EAAAzpG,KAAK++F,kBAAU,IAAA0K,GAAfA,EAAAp4F,KAAArR,KAAkB,CAAEy3D,OAAQz3D,KAAK0+F,UAIjC,MAAO,CAAE5+F,MADM,IAAIsP,WAAWN,GAAOY,OACb9P,MAAM,EAChC,CAEA41C,MAAAA,CAAOwwB,GAGAhmE,KAAKipG,gBAIVjpG,KAAKipG,gBAAgB97E,QAAQ64C,GAH3BhmE,KAAKupG,OAAOvjC,EAIhB,CAEAujC,MAAAA,CAAOvjC,GACLhmE,KAAKwnG,aAAexhC,EACpBhmE,KAAK+kG,gBAAgBllG,SACvB,CAEAupG,kBAAAA,CAAmBI,GACjBxpG,KAAKipG,gBAAkBO,EACvBA,EAAepmE,GAAG,WAAY,KAC5BpjC,KAAK+kG,gBAAgBllG,YAGvB2pG,EAAepmE,GAAG,MAAO,KAEvBomE,EAAer8E,UACfntB,KAAK6/F,OAAQ,EACb7/F,KAAK+kG,gBAAgBllG,YAGvB2pG,EAAepmE,GAAG,QAAS4iC,IACzBhmE,KAAKupG,OAAOvjC,KAIVhmE,KAAKwnG,cACPxnG,KAAKipG,gBAAgB97E,QAAQntB,KAAKwnG,aAEtC,ECrRF,MAAMkC,GAAex0C,OAAO,gBAAe,IAAAy0C,GAAA,IAAAh8E,QAAAi8E,GAAA,IAAA77E,QAO3C,MAAM87E,GAAWr8F,WAAAA,GAAA1O,EAAA,KAAA8qG,IACf3qG,EAAA,KAAA0qG,GAAQrrG,OAAOwa,OAAO,MAAK,CA2B3BxZ,GAAAA,CAAI26D,GAAwB,IAAjBhkC,EAAQ92B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAGpB,GAAI82B,EAAU,CACZ,MAAMlpB,EAAM7N,EAAA0qG,GAAA5pG,KAAK8pG,IAAUz4F,KAAfrR,KAAgBi6D,GAE5B,OADAltD,EAAIi2B,QAAQjjC,KAAK,IAAMk2B,EAASlpB,EAAImb,OAC7B,IACT,CAGA,MAAMnb,EAAM6c,EAAK+/E,GAAL3pG,MAAWi6D,GAGvB,IAAKltD,GAAOA,EAAImb,OAASwhF,GACvB,MAAM,IAAIv+F,MAAM,6CAADH,OAA8CivD,EAAK,MAEpE,OAAOltD,EAAImb,IACb,CAMAtpB,GAAAA,CAAIq7D,GACF,MAAMltD,EAAM6c,EAAK+/E,GAAL3pG,MAAWi6D,GACvB,QAASltD,GAAOA,EAAImb,OAASwhF,EAC/B,CAMAr+E,OAAO4uC,GACL,MAAMltD,EAAM6c,EAAK+/E,GAAL3pG,MAAWi6D,GACvB,SAAKltD,GAAOA,EAAImb,OAASwhF,aAIlB9/E,EAAK+/E,GAAL3pG,MAAWi6D,IACX,EACT,CAQAp6D,OAAAA,CAAQo6D,GAAoB,IAAb/xC,EAAI/oB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACpB,MAAM4N,EAAM7N,EAAA0qG,GAAA5pG,KAAK8pG,IAAUz4F,KAAfrR,KAAgBi6D,GAC5BltD,EAAImb,KAAOA,EACXnb,EAAIlN,SACN,CAEAy/B,KAAAA,GACE,IAAK,MAAM26B,KAASrwC,EAAK+/E,GAAL3pG,MAAY,KAAA+pG,EAC9B,MAAM,KAAE7hF,GAAS0B,EAAK+/E,GAAL3pG,MAAWi6D,GACxB,OAAJ/xC,QAAI,IAAJA,GAAY,QAAR6hF,EAAJ7hF,EAAMsK,cAAM,IAAAu3E,GAAZA,EAAcv2E,OAChB,CACAtK,EAAKygF,GAAL3pG,KAAa1B,OAAOwa,OAAO,MAC7B,CAEA,EAAEo8C,OAAOC,YACP,IAAK,MAAM8E,KAASrwC,EAAK+/E,GAAL3pG,MAAY,CAC9B,MAAM,KAAEkoB,GAAS0B,EAAK+/E,GAAL3pG,MAAWi6D,GAExB/xC,IAASwhF,UAGP,CAACzvC,EAAO/xC,GAChB,CACF,EACF,SAAA4hF,GA3Fa7vC,GAAO,IAAA+vC,EAChB,OAAQA,EAAApgF,EAAK+/E,GAAL3pG,OAAWi6D,KAAX+vC,EAAW/vC,IAAMjuB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACpBtsC,QAAQujC,iBAAe,IAC1B/a,KAAMwhF,KAEV,CCW0B,IAAAO,GAAA,IAAAt8E,QAAAu8E,GAAA,IAAAv8E,QAAAw8E,GAAA,IAAAx8E,QAAAy8E,GAAA,IAAAz8E,QAAA08E,GAAA,IAAA18E,QAAA28E,GAAA,IAAA38E,QAAA48E,GAAA,IAAA58E,QAAA68E,GAAA,IAAA78E,QAAA22E,GAAA,IAAA32E,QAAA88E,GAAA,IAAA98E,QAAA+8E,GAAA,IAAA/8E,QAAAg9E,GAAA,IAAAh9E,QAAAi9E,GAAA,IAAAj9E,QAAAk9E,GAAA,IAAAl9E,QAAAm9E,GAAA,IAAAn9E,QAAAo9E,GAAA,IAAAp9E,QAAAq9E,GAAA,IAAAr9E,QAAAs9E,GAAA,IAAAt9E,QAAAu9E,GAAA,IAAAn9E,QAE5B,MAAMo9E,GAkDJ39F,WAAAA,CAAW49F,GAA6C,IAAAC,EAAA,IAA5C,kBAAEC,EAAiB,UAAE9jF,EAAS,SAAEnL,GAAU+uF,EACpD,GADoDtsG,EAAA,KAAAosG,IAjDtDjsG,EAAA,KAAAgrG,GAAcvqG,QAAQujC,iBAEtBhkC,EAAA,KAAAirG,GAAa,MAEbjrG,EAAA,KAAAkrG,IAAuB,GAEvBlrG,EAAA,KAAAmrG,KAAkD,QAAzBiB,EAACn6F,WAAWq6F,qBAAa,IAAAF,IAAxBA,EAA0B51D,UAEpDx2C,EAAA,KAAAorG,GAAQ,MAERprG,EAAA,KAAAqrG,GAAoB,MAEpBrrG,EAAA,KAAAsrG,GAAc,GAEdtrG,EAAA,KAAAurG,GAAa,GAEbvrG,EAAA,KAAAqlG,GAAU,MAEVrlG,EAAA,KAAAwrG,GAAiB,MAEjBxrG,EAAA,KAAAyrG,GAAY,GAEZzrG,EAAA,KAAA0rG,GAAS,GAET1rG,EAAA,KAAA2rG,GAActsG,OAAOwa,OAAO,OAE5B7Z,EAAA,KAAA4rG,GAAuB,IAEvB5rG,EAAA,KAAA6rG,GAAqB,MAErB7rG,EAAA,KAAA8rG,GAAY,IAEZ9rG,EAAA,KAAA+rG,GAAqB,IAAIr9E,SAEzB1uB,EAAA,KAAAgsG,GAAa,MAgBPK,aAA6BjmC,eAC/Bn8C,EAAK4hF,GAAL9qG,KAA0BsrG,OACrB,IAEwB,kBAAtBA,EASP,MAAM,IAAIngG,MAAM,+CAPhB+d,EAAK4hF,GAAL9qG,KAA0B,IAAIqlE,eAAe,CAC3CtjD,KAAAA,CAAMujD,GACJA,EAAWiB,QAAQ+kC,GACnBhmC,EAAW9xC,OACb,IAIJ,CACAtK,EAAKghF,GAALlqG,KAAkBkpB,EAAKuhF,GAALzqG,KAAsBwnB,IAExC0B,EAAKyhF,GAAL3qG,KAAcqc,EAAS8C,MAAQwF,GAAYC,YAC3CsE,EAAKwhF,GAAL1qG,KAAiBqc,EAAS+C,UAC1B8J,EAAKohF,GAALtqG,KAAyB,CACvBmc,IAAK,KACLgnE,WAAY,KACZp/D,IAAK,OAEP,MAAM,UAAE3D,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,GAAUlE,EAAS6D,QACzDgJ,EAAK+hF,GAALjrG,KAAkB,CAAC,EAAG,EAAG,GAAI,GAAIsgB,EAAOC,EAAQF,IAChD6I,EAAKshF,GAALxqG,KAAkBogB,GAClB8I,EAAKqhF,GAALvqG,KAAmBqgB,GAEnBmrF,GAAoCn6F,KAApC85F,IAEAhnF,GAAmBqD,EAAWnL,GAG9BuN,EAAKqgF,GAALjqG,MAAiBgjC,QACdyoE,QAAQ,KACGC,GAAkB9oF,EAACyI,OAAOrrB,MACpCkpB,EAAKohF,GAALtqG,KAAyB,MACzBkpB,EAAK0hF,GAAL5qG,KAAmB,QAEpBsoE,MAAM,OAiBX,CAEA,wBAAWqjC,GACT,MAAM,UAAE96F,EAAS,UAAEC,GAAcxB,GAAYgB,SAC7C,OAAOxD,GACL9M,KACA,gBACA,IAAIqnB,IAAI,CACN,CACE,aAAY,GAAArc,OACT6F,GAAaC,EAAY,YAAc,GAAE,eAE9C,CACE,YAAW,GAAA9F,OACR6F,GAAaC,EAAY,mBAAqB,GAAE,gBAI3D,CAMA2K,MAAAA,GACE,MAAMmwF,EAAOA,KACXhiF,EAAK06E,GAALtkG,MAAaqgG,OAAOtgG,KAAK8rG,IAAqB,IAAAC,EAAA,IAApB,MAAEhsG,EAAK,KAAEF,GAAMisG,EACnCjsG,EACFgqB,EAAKqgF,GAALjqG,MAAiBH,WAGT,QAAVisG,EAAAliF,EAAKygF,GAALrqG,aAAU,IAAA8rG,GAAV5iF,EAAKmhF,GAALrqG,KAAeF,EAAMisG,MACrBztG,OAAO8c,OAAOwO,EAAKghF,GAAL5qG,MAAkBF,EAAM+Y,QACtC3Z,EAAAgsG,GAAAlrG,KAAKgsG,IAAa36F,KAAlBrR,KAAmBF,EAAM8Y,OACzBgzF,MACChiF,EAAKqgF,GAALjqG,MAAiBL,SAMtB,OAJAupB,EAAKo7E,GAALtkG,KAAe4pB,EAAKkhF,GAAL9qG,MAAwB4kG,aAC7B8G,GAAkB9oF,EAAC5jB,IAAIgB,MACjC4rG,IAEOhiF,EAAKqgF,GAALjqG,MAAiBgjC,OAC1B,CAOA7lB,MAAAA,CAAM8uF,GAAgC,IAA/B,SAAE5vF,EAAQ,SAAE6vF,EAAW,MAAMD,EAClC,MAAM9sF,EAAQ9C,EAAS8C,MAAQwF,GAAYC,WACrCxF,EAAW/C,EAAS+C,SAQ1B,GANIA,IAAawK,EAAK8gF,GAAL1qG,QACP,OAARksG,QAAQ,IAARA,GAAAA,IACAhjF,EAAKwhF,GAAL1qG,KAAiBof,GACjB+E,GAAmByF,EAAK6gF,GAALzqG,MAAqB,CAAEof,cAGxCD,IAAUyK,EAAK+gF,GAAL3qG,MAAa,CACjB,OAARksG,QAAQ,IAARA,GAAAA,IACAhjF,EAAKyhF,GAAL3qG,KAAcmf,GACd,MAAM8uB,EAAS,CACb9xB,IAAK,KACLgnE,WAAY,KACZp/D,IAAKooF,GAAiB96F,KAAjB85F,GAAkBvhF,EAAKygF,GAALrqG,QAEzB,IAAK,MAAMmc,KAAOyN,EAAKmhF,GAAL/qG,MAChBiuC,EAAOk1C,WAAav5D,EAAKohF,GAALhrG,MAAwBV,IAAI6c,GAChD8xB,EAAO9xB,IAAMA,EACbjd,EAAAgsG,GAAAlrG,KAAKosG,IAAO/6F,KAAZrR,KAAaiuC,EAEjB,CACF,CAMAuH,MAAAA,GAAS,IAAA62D,EACP,MAAMC,EAAU,IAAIn+F,GAAe,6BAEvB,QAAZk+F,EAAAziF,EAAK06E,GAALtkG,aAAY,IAAAqsG,GAAZA,EAAc72D,OAAO82D,GAAShkC,MAAM,QAGpCp/C,EAAKo7E,GAALtkG,KAAe,MAEf4pB,EAAKqgF,GAALjqG,MAAiBL,OAAO2sG,EAC1B,CAOA,YAAIhwF,GACF,OAAOsN,EAAKmhF,GAAL/qG,KACT,CAOA,uBAAIusG,GACF,OAAO3iF,EAAKihF,GAAL7qG,KACT,CA6LA,cAAOwsG,GACL,KAAIttG,EApZFisG,GAoZEnrG,KAAK0rG,IAAkB9oF,EAAC6N,KAAO,GAAnC,CAGAvxB,EAvZEisG,GAuZFnrG,KAAKysG,IAAY7pF,EAAC0c,QAElB,IAAK,MAAM,OAAE3M,KAAYzzB,EAzZvBisG,GAyZuBnrG,KAAK0sG,IAAe9pF,EAACyc,SAC5C1M,EAAO7H,SAET5rB,EA5ZEisG,GA4ZFnrG,KAAK0sG,IAAe9pF,EAAC0c,OANrB,CAOF,EA7Za,SAAA0sE,GAwNCpzF,GAAO,IAAA+zF,EAAAC,EACnB,GAAIhjF,EAAKugF,GAALnqG,MACF,OAEwB,QAA1B4sG,GAAAD,EAAA/iF,EAAK0gF,GAALtqG,OAAuB+jB,WAAG,IAAA6oF,IAA1BD,EAAuB5oF,IAAQooF,GAAiB96F,KAAjB85F,EAAkBvhF,EAAKygF,GAALrqG,QAEjD,MAAMsc,EAAWsN,EAAKmhF,GAAL/qG,MACfusG,EAAsB3iF,EAAKihF,GAAL7qG,MAExB,IAAK,MAAMqnC,KAAQzuB,EAAO,CAGxB,GAAI0D,EAASje,OAvOa,IA2OxB,OAHA4M,GAAK,8DAELie,EAAKihF,GAALnqG,MAA4B,GAI9B,QAAiByL,IAAb47B,EAAKl4B,IAiBTo9F,EAAoBv9F,KAAKq4B,EAAKl4B,KAC9BjQ,EAAAgsG,GAAAlrG,KAAK6sG,IAAWx7F,KAAhBrR,KAAiBqnC,QAjBf,GACgB,4BAAdA,EAAK7mC,MACS,uBAAd6mC,EAAK7mC,KACL,CACA,MAAMmc,EAASiN,EAAKsgF,GAALlqG,MACfkpB,EAAKghF,GAALlqG,KAAkB+b,SAASC,cAAc,SACzC4N,EAAKsgF,GAALlqG,MAAgBgoB,UAAUhpB,IAAI,iBAC1BqoC,EAAK5tB,IACPmQ,EAAKsgF,GAALlqG,MAAgBoa,aAAa,KAAM,GAAFpP,OAAKq8B,EAAK5tB,KAE7CkD,EAAOP,OAAOwN,EAAKsgF,GAALlqG,MAChB,KAAyB,qBAAdqnC,EAAK7mC,MACd0oB,EAAKghF,GAALlqG,KAAkB4pB,EAAKsgF,GAALlqG,MAAgBo2C,WAMxC,CACF,UAAAy2D,GAEYC,GAEV,MAAMC,EAAUhxF,SAASC,cAAc,QACjCgxF,EAAoB,CACxB7+C,MAAO,EACP4uB,YAAa,EACbkwB,QAAsB,KAAbH,EAAK39F,IACd+9F,OAAQJ,EAAKI,OACb1d,SAAU,GAEZ5lE,EAAKmhF,GAAL/qG,MAAegP,KAAK+9F,GAEpB,MAAMr9D,EAAK99B,GAAKtM,UAAUskB,EAAKqhF,GAALjrG,MAAiB8sG,EAAKxnG,WAChD,IAAI6oD,EAAQv/C,KAAKu+F,MAAMz9D,EAAG,GAAIA,EAAG,IACjC,MAAMr0B,EAAQuO,EAAKghF,GAAL5qG,MAAiB8sG,EAAKM,UAChC/xF,EAAMu/C,WACRzM,GAASv/C,KAAKy+F,GAAK,GAGrB,IAAIz0C,EACDhvC,EAAKwgF,GAALpqG,OAA8Bqb,EAAMiyF,kBACrCjyF,EAAMu9C,WAGRA,EAAauyC,EAAUQ,cAAcrsG,IAAIs5D,IAAeA,EACxD,MAAM20C,EAAa3+F,KAAKwuC,MAAM1N,EAAG,GAAIA,EAAG,IAClC89D,EACJD,EAAaE,GAAoBp8F,KAApB85F,EAAqBvyC,EAAYv9C,EAAOuO,EAAKygF,GAALrqG,OAEvD,IAAIyjD,EAAMl5B,EACI,IAAV4jC,GACF1K,EAAO/T,EAAG,GACVnlB,EAAMmlB,EAAG,GAAK89D,IAEd/pD,EAAO/T,EAAG,GAAK89D,EAAa5+F,KAAK8+F,IAAIv/C,GACrC5jC,EAAMmlB,EAAG,GAAK89D,EAAa5+F,KAAK++F,IAAIx/C,IAGtC,MAAMy/C,EAAiB,mCACjBC,EAAWd,EAAQ1xF,MAGrBuO,EAAKsgF,GAALlqG,QAAoB4pB,EAAK6gF,GAALzqG,OACtB6tG,EAASpqD,KAAO,GAAHz4C,QAAQ,IAAMy4C,EAAQ75B,EAAK4gF,GAALxqG,OAAiB0jD,QAAQ,GAAE,KAC9DmqD,EAAStjF,IAAM,GAAHvf,QAAQ,IAAMuf,EAAOX,EAAK2gF,GAALvqG,OAAkB0jD,QAAQ,GAAE,OAG7DmqD,EAASpqD,KAAO,GAAHz4C,OAAM4iG,GAAc5iG,OAAGy4C,EAAKC,QAAQ,GAAE,OACnDmqD,EAAStjF,IAAM,GAAHvf,OAAM4iG,GAAc5iG,OAAGuf,EAAIm5B,QAAQ,GAAE,QAMnDmqD,EAASre,SAAW,GAAHxkF,OAAM4iG,GAAc5iG,QAAc8iG,GAAYlrF,EAAG2qF,GAAY7pD,QAAQ,GAAE,OACxFmqD,EAASj1C,WAAaA,EAEtBo0C,EAAkBxd,SAAW+d,EAG7BR,EAAQ3yF,aAAa,OAAQ,gBAE7B2yF,EAAQr0F,YAAco0F,EAAK39F,IAE3B49F,EAAQtlF,IAAMqlF,EAAKrlF,IAIfmC,EAAKwgF,GAALpqG,QACF+sG,EAAQgB,QAAQX,SACd/xF,EAAM2yF,4BAA8BlB,EAAKM,UAE/B,IAAVj/C,IACF6+C,EAAkB7+C,MAAQA,GAAS,IAAMv/C,KAAKy+F,KAKhD,IAAIY,GAAkB,EACtB,GAAInB,EAAK39F,IAAI9Q,OAAS,EACpB4vG,GAAkB,OACb,GAAiB,MAAbnB,EAAK39F,KAAe29F,EAAKxnG,UAAU,KAAOwnG,EAAKxnG,UAAU,GAAI,CACtE,MAAM4oG,EAAYt/F,KAAKmI,IAAI+1F,EAAKxnG,UAAU,IACxC6oG,EAAYv/F,KAAKmI,IAAI+1F,EAAKxnG,UAAU,IAIpC4oG,IAAcC,GACdv/F,KAAKiG,IAAIq5F,EAAWC,GAAav/F,KAAKC,IAAIq/F,EAAWC,GAAa,MAElEF,GAAkB,EAEtB,CAcA,GAbIA,IACFjB,EAAkBjwB,YAAc1hE,EAAMu/C,SAAWkyC,EAAK7sF,OAAS6sF,EAAK9sF,OAEtE4J,EAAKohF,GAALhrG,MAAwBxB,IAAIuuG,EAASC,GAGrCpjF,EAAK0gF,GAALtqG,MAAuBmc,IAAM4wF,EAC7BnjF,EAAK0gF,GAALtqG,MAAuBmjF,WAAa6pB,EACpC9tG,EAAAgsG,GAAAlrG,KAAKosG,IAAO/6F,KAAZrR,KAAa4pB,EAAK0gF,GAALtqG,OAETgtG,EAAkBC,SACpBrjF,EAAKsgF,GAALlqG,MAAgBoc,OAAO2wF,GAErBC,EAAkBE,OAAQ,CAC5B,MAAMkB,EAAKryF,SAASC,cAAc,MAClCoyF,EAAGh0F,aAAa,OAAQ,gBACxBwP,EAAKsgF,GAALlqG,MAAgBoc,OAAOgyF,EACzB,CACF,UAAAhC,GAEQn+D,GACN,MAAM,IAAE9xB,EAAG,WAAEgnE,EAAU,IAAEp/D,GAAQkqB,GAC3B,MAAE5yB,GAAUc,EAElB,IAAI7W,EAAY,GAKhB,GAJcwoG,GAAYlrF,EAAG,IAC3Btd,EAAY,SAAH0F,OAAY,EAAc8iG,GAAYlrF,EAAA,MAGlB,IAA3BugE,EAAWpG,aAAqBoG,EAAW8pB,QAAS,CACtD,MAAM,WAAEr0C,GAAev9C,GACjB,YAAE0hE,EAAW,SAAEyS,GAAarM,EAElCkrB,GAAwBh9F,KAAxB85F,EAAyBpnF,EAAKyrE,EAAW5lE,EAAK+gF,GAAL3qG,MAAa44D,GAEtD,MAAM,MAAE54C,GAAU+D,EAAIguE,YAAY51E,EAAIzD,aAElCsH,EAAQ,IACV1a,EAAY,UAAH0F,OAAc+xE,EAAcnzD,EAAK+gF,GAAL3qG,MAAeggB,EAAK,MAAAhV,OAAK1F,GAElE,CACyB,IAArB69E,EAAWh1B,QACb7oD,EAAY,UAAH0F,OAAam4E,EAAWh1B,MAAK,SAAAnjD,OAAQ1F,IAE5CA,EAAUjH,OAAS,IACrBgd,EAAM/V,UAAYA,EAEtB,UAAA6mG,KAkB4B,IAAbJ,EAAI5sG,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAChB4kB,EAAM7kB,EAhaRisG,EAgaQnrG,KAAK0sG,IAAe9pF,EAACtjB,IAAKysG,IAAAA,EAAS,KAC7C,IAAKhoF,EAAK,CAWR,MAAM4O,EAAS5W,SAASC,cAAc,UACtC2W,EAAOjL,UAAY,sBACnBiL,EAAOo5E,KAAOA,EACdhwF,SAASib,KAAK5a,OAAOuW,GACrB5O,EAAM4O,EAAOnB,WAAW,KAAM,CAC5B88E,OAAO,EACP78E,oBAAoB,IAEtBvyB,EApbAisG,EAobAnrG,KAAK0sG,IAAe9pF,EAACpkB,IAAIutG,EAAMhoF,GAG/B7kB,EAvbAisG,EAubAnrG,KAAKuuG,IAAe3rF,EAACpkB,IAAIulB,EAAK,CAAE0M,KAAM,EAAGinC,OAAQ,IACnD,CACA,OAAO3zC,CACT,UAAAsqF,GAEsBtqF,EAAK0M,EAAMinC,GAC/B,MAAM82C,EAAStvG,EA7bbisG,EA6banrG,KAAKuuG,IAAe3rF,EAACtjB,IAAIykB,GACpC0M,IAAS+9E,EAAO/9E,MAAQinC,IAAW82C,EAAO92C,SAG9C3zC,EAAIszC,KAAO,GAAHrsD,OAAMylB,EAAI,OAAAzlB,OAAM0sD,GACxB82C,EAAO/9E,KAAOA,EACd+9E,EAAO92C,OAASA,EAClB,UAAA8zC,KAME,GAA0B,OAAtBtsG,EA1cFisG,EA0cEnrG,KAAK8tG,IAAYlrF,EACnB,OAEF,MAAMzG,EAAMJ,SAASC,cAAc,OACnCG,EAAId,MAAMonB,QAAU,EACpBtmB,EAAId,MAAMozF,WAAa,EACvBtyF,EAAId,MAAMm0E,SAAW,MACrBrzE,EAAId,MAAM8O,SAAW,WACrBhO,EAAIzD,YAAc,IAClBqD,SAASib,KAAK5a,OAAOD,GAIhB2xF,GAAYlrF,EAAA1jB,EAvdfisG,EAudFnrG,KAAoBmc,EAAIioB,wBAAwBnkB,QAChD9D,EAAI2O,QACN,UAAA2iF,GAEkB70C,EAAYv9C,EAAO0wF,GACnC,MAAM2C,EAAexvG,EA5dnBisG,EA4dmBnrG,KAAKysG,IAAY7pF,EAACtjB,IAAIs5D,GAC3C,GAAI81C,EACF,OAAOA,EAET,MAAM3qF,EAAM7kB,EAheVisG,EAgeUnrG,KAAKmsG,IAAO96F,KAAZrR,KAAa+rG,GAEzBhoF,EAAI4O,OAAO3S,MAAQ+D,EAAI4O,OAAO1S,OApeR,GAqetB/gB,EAneEisG,EAmeFnrG,KAAKquG,IAAch9F,KAAnBrR,KAAoB+jB,EAreE,GAqesB60C,GAC5C,MAAM+1C,EAAU5qF,EAAIguE,YAAY,IAE1Bl3B,EAAS8zC,EAAQC,sBACjB7zC,EAAUnsD,KAAKmI,IAAI43F,EAAQE,wBAEjC9qF,EAAI4O,OAAO3S,MAAQ+D,EAAI4O,OAAO1S,OAAS,EACvC,IAAI6uF,EAAQ,GAsBZ,OApBIj0C,EACFi0C,EAAQj0C,GAAUA,EAASE,IAIzBzrD,GAAYgB,SAASQ,WAErB7F,GACE,qHAIAoQ,EAAMw/C,OACRi0C,EAAQzzF,EAAMw/C,OACLx/C,EAAM0/C,UACf+zC,EAAQ,EAAIzzF,EAAM0/C,UAItB77D,EA/fEisG,EA+fFnrG,KAAKysG,IAAY7pF,EAACpkB,IAAIo6D,EAAYk2C,GAC3BA,CACT,CACFC,EAlgBM5D,GAigBJ,IAAAsB,GAAA,CAAA7pF,EA5dsB,IAAIyE,KAAKqlF,GAAA,CAAA9pF,EAEN,IAAIyE,KAAKknF,GAAA,CAAA3rF,EAET,IAAI+K,SAASmgF,GAAA,CAAAlrF,EAEhB,MAAI8oF,GAAA,CAAA9oF,EAEE,IAAI4M,KCqJlC,SAASw/E,KAAsB,IAAAC,EAAAC,EAAA,IAAVt9E,EAAGzyB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAEL,kBAARyyB,GAAoBA,aAAexlB,IAC5CwlB,EAAM,CAAErmB,IAAKqmB,IACJA,aAAeggC,aAAeA,YAAYC,OAAOjgC,MAC1DA,EAAM,CAAE1J,KAAM0J,IAGlB,MAAMu9E,EAAO,IAAIC,IACX,MAAExlC,GAAUulC,EAEZ5jG,EAAMqmB,EAAIrmB,IvBxOlB,SAAoBioD,GAIlB,GAAIA,aAAepnD,IACjB,OAAOonD,EAAI5mD,KAEb,GAAmB,kBAAR4mD,EAAkB,CAC3B,GAGErzD,EAEA,OAAOqzD,EAIT,MAAMjoD,EAAMa,IAAIC,MAAMmnD,EAAK1tC,OAAOupF,UAClC,GAAI9jG,EACF,OAAOA,EAAIqB,IAEf,CACA,MAAM,IAAIzB,MACR,qFAGJ,CuB8MwBmkG,CAAW19E,EAAIrmB,KAAO,KACtC2c,EAAO0J,EAAI1J,KvB7MnB,SAAqBsrC,GAEnB,GAGErzD,GACkB,qBAAXovG,QACP/7C,aAAe+7C,OAEf,MAAM,IAAIpkG,MACR,qEAGJ,GAAIqoD,aAAepkD,YAAcokD,EAAI1B,aAAe0B,EAAI9jD,OAAOoiD,WAI7D,OAAO0B,EAET,GAAmB,kBAARA,EACT,OAAOtkD,GAAcskD,GAEvB,GACEA,aAAe5B,aACfA,YAAYC,OAAO2B,IACH,kBAARA,IAAqBg8C,MAAS,OAAHh8C,QAAG,IAAHA,OAAG,EAAHA,EAAKn1D,QAExC,OAAO,IAAI+Q,WAAWokD,GAExB,MAAM,IAAIroD,MACR,6GAGJ,CuB4K0BskG,CAAY79E,EAAI1J,MAAQ,KAC1Cy4E,EAAc/uE,EAAI+uE,aAAe,KACjC8C,GAA0C,IAAxB7xE,EAAI6xE,gBACtBiM,EAAuB,QAAfT,EAAGr9E,EAAI89E,gBAAQ,IAAAT,EAAAA,EAAI,KAC3BU,EACJ/9E,EAAIif,iBAAiB++D,GAAwBh+E,EAAIif,MAAQ,KACrDuwD,EACJ12F,OAAOC,UAAUinB,EAAIwvE,iBAAmBxvE,EAAIwvE,eAAiB,EACzDxvE,EAAIwvE,eACJ,MACN,IAAIyO,EAASj+E,EAAIi+E,kBAAkBC,GAAYl+E,EAAIi+E,OAAS,KAC5D,MAAMtlG,EAAYqnB,EAAIrnB,UAIhBwlG,EACsB,kBAAnBn+E,EAAIm+E,YAA4B/uF,GAAa4Q,EAAIm+E,YAEpD,KADAn+E,EAAIm+E,WAEJC,EAAU1tC,GAAkB1wC,EAAIo+E,SAChCC,GAAgC,IAAnBr+E,EAAIq+E,WACjBC,EACJt+E,EAAIs+E,oBAC4D/vG,EAC5D8uE,GACA1G,IACA4nC,EAAS7tC,GAAkB1wC,EAAIu+E,QAC/BC,EAAsB9tC,GAAkB1wC,EAAIw+E,qBAC5CC,EACJz+E,EAAIy+E,0BAC4DlwG,EAC5D+uE,GACAhB,IACAoiC,EAAUhuC,GAAkB1wC,EAAI0+E,SAChCC,EACJ3+E,EAAI2+E,cAC4DpwG,EAC5DgvE,GACAb,IACAkiC,GAAoC,IAArB5+E,EAAI6+E,aACnBC,EACJhmG,OAAOC,UAAUinB,EAAI8+E,eAAiB9+E,EAAI8+E,cAAgB,EACtD9+E,EAAI8+E,cACH,EACD/gG,GAA0C,IAAxBiiB,EAAIjiB,gBACtBG,EACsC,mBAAnC8hB,EAAI9hB,2BACP8hB,EAAI9hB,4BACH3P,EACD6P,EAEmC,mBAAhC4hB,EAAI5hB,wBACP4hB,EAAI5hB,yBAMC7P,IAAamP,GAAYgB,SAASQ,YAAcI,WAAWy/F,QAChEC,EAAuBlmG,OAAOC,UAAUinB,EAAIg/E,sBAC9Ch/E,EAAIg/E,sBACH,EACCh6C,EAC2B,mBAAxBhlC,EAAIglC,gBAAgChlC,EAAIglC,gBAAkBz2D,EAC7Dg6D,GAAkD,IAA5BvoC,EAAIuoC,oBAC1B02C,GAA8B,IAAlBj/E,EAAIi/E,UAChBr7C,EAAgB5jC,EAAI4jC,eAAiBtkD,WAAW6K,SAChD4gF,GAAoC,IAArB/qE,EAAI+qE,aACnBC,GAAsC,IAAtBhrE,EAAIgrE,cACpBkU,GAA4C,IAAzBl/E,EAAIk/E,iBACvBC,GAAwB,IAAfn/E,EAAIm/E,OACbC,EACJp/E,EAAIo/E,gBAC4D7wG,EAC5DyuE,GACA9G,IACAmpC,EACJr/E,EAAIq/E,gBAC4D9wG,EAC5DwuE,GACAjF,IACAjC,GAA8B,IAAlB71C,EAAI61C,UAChBypC,GAA0B,IAAhBt/E,EAAIs/E,QAGd7yG,EAASsxG,EAAiBA,EAAetxG,OAAoB,QAAd6wG,EAAIt9E,EAAIvzB,cAAM,IAAA6wG,EAAAA,EAAIt+E,IACjEugF,EAC0B,mBAAvBv/E,EAAIu/E,eACPv/E,EAAIu/E,gBACHhxG,IAAay2D,EACdw6C,EAC0B,mBAAvBx/E,EAAIw/E,eACPx/E,EAAIw/E,kBAGFlB,IAAsB3nC,IACtB8nC,IAA4BniC,IAC5BqiC,IAAgBjiC,IAChB0hC,GACAI,GACAE,GACA7yF,GAAgBuyF,EAASj0F,SAAS2B,UAClCD,GAAgB2yF,EAAqBr0F,SAAS2B,UAC9CD,GAAgB6yF,EAASv0F,SAAS2B,UAU1ClT,GAAkBD,GAIlB,MAAM8mG,EAAmB,CACvBvxB,cAAe,IAAIkxB,EAAc,CAAEx7C,gBAAeiS,cAClDvpC,cAAe,IAAI+yE,EAAc,CAAErnC,QAAOpU,kBAC1C87C,kBAEEF,EACI,KACA,IAAIlB,EAAkB,CAAE1kG,QAASwkG,EAAS9nC,aAAc+nC,IAC9DsB,wBAEEH,EACI,KACA,IAAIf,EAAwB,CAAE7kG,QAAS4kG,IAC7CoB,YAEEJ,EACI,KACA,IAAIb,EAAY,CAAE/kG,QAAS8kG,KAG9BT,IAGHA,EAASC,GAAUh3F,OAAO,CACxBvO,YACAknG,KAAMxY,GAAoBC,aAE5BiW,EAAKuC,QAAU7B,GAGjB,MAAM8B,EAAY,CAChB/nC,QACAgoC,WAEM,UAEN1pF,OACAwnF,WACAoB,mBACA1P,iBACA/iG,SACA0xG,aACAc,YACAgB,iBAAkB,CAChBnB,eACA95C,kBACA45C,eACA7gG,kBACAG,6BACAE,0BACA4gG,uBACAz2C,sBACAg3C,iBACAD,UACAE,iBACApB,UACAG,SACAC,sBACAE,YAGEwB,EAAkB,CACtBt8C,gBACAu7C,SACAt7C,aAvEI,KAwEJs8C,cAAe,CACbjB,mBACAD,cA2EJ,OAvEAhB,EAAO7sE,QACJjjC,KAAK,WACJ,GAAIovG,EAAK6C,UACP,MAAM,IAAI7mG,MAAM,mBAElB,GAAI0kG,EAAOmC,UACT,MAAM,IAAI7mG,MAAM,wBAGlB,MAAM8mG,EAAkBpC,EAAOqC,eAAejtC,gBAC5C,gBACA0sC,EACAzpF,EAAO,CAACA,EAAKxY,QAAU,MAGzB,IAAIyiG,EACJ,GAAIxC,EACFwC,EAAgB,IAAI3V,GAAuBmT,EAAgB,CACzDhT,eACAC,uBAEG,IAAK10E,EAAM,CAIhB,IAAK3c,EACH,MAAM,IAAIJ,MAAM,8CAGlB,MAAMinG,EAAgB30F,GAAgBlS,GAClCw4F,GAGE5jG,EACAqoG,GACA/B,GAEN0L,EAAgB,IAAIC,EAAc,CAChC7mG,MACAlN,SACAsiG,cACA8C,kBACArC,iBACAzE,eACAC,iBAEJ,CAEA,OAAOqV,EAAgBlyG,KAAKsyG,IAC1B,GAAIlD,EAAK6C,UACP,MAAM,IAAI7mG,MAAM,mBAElB,GAAI0kG,EAAOmC,UACT,MAAM,IAAI7mG,MAAM,wBAGlB,MAAM+mG,EAAiB,IAAIhuC,GAAe0F,EAAOyoC,EAAUxC,EAAO4B,MAC5Da,EAAY,IAAIC,GACpBL,EACA/C,EACAgD,EACAL,EACAT,EACA5pC,GAEF0nC,EAAKqD,WAAaF,EAClBJ,EAAevzF,KAAK,QAAS,OAEjC,GACC2pD,MAAM6mC,EAAKlF,YAAYtqG,QAEnBwvG,CACT,CAaA,MAAMC,GAAuB5hG,WAAAA,IAAAqR,EAAAA,EAAAA,GAAA,mBAMbnf,QAAQujC,kBAAepkB,EAAAA,EAAAA,GAAA,kBAKxB,OAAIA,EAAAA,EAAAA,GAAA,eAKP,OAAIA,EAAAA,EAAAA,GAAA,iBAAA7T,QAMqBynG,GAAM7vF,GAAA8vF,EAAND,GAAM7vF,EAAA+vF,EAAAD,IAAAA,GAAAC,MAAA9zF,EAAAA,EAAAA,GAAA,kBAM7B,IAAKA,EAAAA,EAAAA,GAAA,kBAQJ,OAAIA,EAAAA,EAAAA,GAAA,kBAQJ,KAAI,CAMjB,WAAImkB,GACF,OAAOhjC,KAAKiqG,YAAYjnE,OAC1B,CAOA,aAAM7V,GAAU,IAAAylF,EACd5yG,KAAKgyG,WAAY,EAEjB,IAAI,IAAAa,EAAAC,EACc,QAAhBD,EAAI7yG,KAAK0xG,eAAO,IAAAmB,GAAZA,EAAcpB,OAChBzxG,KAAK0xG,QAAQqB,iBAAkB,SAEZ,QAArBD,EAAM9yG,KAAKwyG,kBAAU,IAAAM,OAAA,EAAfA,EAAiB3lF,UACzB,CAAE,MAAO6a,GAAI,IAAAgrE,EAIX,MAHgB,QAAhBA,EAAIhzG,KAAK0xG,eAAO,IAAAsB,GAAZA,EAAcvB,aACTzxG,KAAK0xG,QAAQqB,gBAEhB/qE,CACR,CACAhoC,KAAKwyG,WAAa,KAEN,QAAZI,EAAA5yG,KAAK0xG,eAAO,IAAAkB,GAAZA,EAAczlF,UACdntB,KAAK0xG,QAAU,IACjB,CAQA,aAAM3vE,GACJ,OAAO/hC,KAAKwyG,WAAWzwE,SACzB,EACF,IAAA0wE,GAAA,CAAA7vF,EAvFkB,GAACqwF,GAAA,IAAAtlF,QAAAulF,GAAA,IAAAvlF,QAAAwlF,GAAA,IAAAxlF,QAAAylF,GAAA,IAAAzlF,QAAA0lF,GAAA,IAAA1lF,QAgGnB,MAAMiiF,GAiBJpiG,WAAAA,CACEnP,EACAw+F,GAGA,IAFAC,EAAe39F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACf49F,EAA0B59F,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KApB/BF,EAAA,KAAAg0G,GAAcvzG,QAAQujC,iBAEtBhkC,EAAA,KAAAi0G,GAA4B,IAE5Bj0G,EAAA,KAAAk0G,GAA4B,IAE5Bl0G,EAAA,KAAAm0G,GAAqB,IAErBn0G,EAAA,KAAAo0G,GAAkB,IAchBrzG,KAAK3B,OAASA,EACd2B,KAAK68F,YAAcA,EACnB78F,KAAK88F,gBAAkBA,EACvB98F,KAAK+8F,2BAA6BA,CACpC,CAKAU,gBAAAA,CAAiBl6B,GACf35C,EAAKypF,GAALrzG,MAAqBgP,KAAKu0D,EAC5B,CAKAq6B,mBAAAA,CAAoBr6B,GAClB35C,EAAKwpF,GAALpzG,MAAwBgP,KAAKu0D,EAC/B,CAKAw6B,0BAAAA,CAA2Bx6B,GACzB35C,EAAKupF,GAALnzG,MAA+BgP,KAAKu0D,EACtC,CAKAy6B,0BAAAA,CAA2Bz6B,GACzB35C,EAAKspF,GAALlzG,MAA+BgP,KAAKu0D,EACtC,CAMA+vC,WAAAA,CAAY5V,EAAO5uF,GACjB,IAAK,MAAMy0D,KAAY35C,EAAKypF,GAALrzG,MACrBujE,EAASm6B,EAAO5uF,EAEpB,CAMAykG,cAAAA,CAAe97C,EAAQomC,GACrBj0E,EAAKqpF,GAALjzG,MAAiBgjC,QAAQjjC,KAAK,KAC5B,IAAK,MAAMwjE,KAAY35C,EAAKwpF,GAALpzG,MACrBujE,EAAS9L,EAAQomC,IAGvB,CAKA2V,qBAAAA,CAAsB1kG,GACpB8a,EAAKqpF,GAALjzG,MAAiBgjC,QAAQjjC,KAAK,KAC5B,IAAK,MAAMwjE,KAAY35C,EAAKupF,GAALnzG,MACrBujE,EAASz0D,IAGf,CAEA2kG,qBAAAA,GACE7pF,EAAKqpF,GAALjzG,MAAiBgjC,QAAQjjC,KAAK,KAC5B,IAAK,MAAMwjE,KAAY35C,EAAKspF,GAALlzG,MACrBujE,KAGN,CAEA26B,cAAAA,GACEt0E,EAAKqpF,GAALjzG,MAAiBH,SACnB,CAMA4/F,gBAAAA,CAAiB/B,EAAO17E,GACtB9W,GAAY,yDACd,CAEAi0B,KAAAA,GAAS,EAMX,MAAMu0E,GACJlmG,WAAAA,CAAYmmG,EAASrB,GACnBtyG,KAAK4zG,SAAWD,EAChB3zG,KAAKwyG,WAAaF,CAiBpB,CAKA,qBAAI32F,GACF,OAAO3b,KAAKwyG,WAAW72F,iBACzB,CAKA,iBAAImkE,GACF,OAAO9/E,KAAKwyG,WAAW1yB,aACzB,CAKA,iBAAI5hD,GACF,OAAOl+B,KAAKwyG,WAAWt0E,aACzB,CAKA,YAAI21E,GACF,OAAO7zG,KAAK4zG,SAASC,QACvB,CAQA,gBAAIC,GACF,OAAO9zG,KAAK4zG,SAASE,YACvB,CAKA,aAAIC,GACF,OAAOjnG,GAAO9M,KAAM,cAAeA,KAAKwyG,WAAWwB,YACrD,CAQA,cAAIC,GACF,OAAOj0G,KAAKwyG,WAAWwB,WACzB,CAOAE,OAAAA,CAAQnxE,GACN,OAAO/iC,KAAKwyG,WAAW0B,QAAQnxE,EACjC,CAOAoxE,YAAAA,CAAaC,GACX,OAAOp0G,KAAKwyG,WAAW2B,aAAaC,EACtC,CAQAC,eAAAA,GACE,OAAOr0G,KAAKwyG,WAAW6B,iBACzB,CAQAC,cAAAA,CAAe76F,GACb,OAAOzZ,KAAKwyG,WAAW8B,eAAe76F,EACxC,CAOA86F,aAAAA,GACE,OAAOv0G,KAAKwyG,WAAW+B,eACzB,CAMAC,aAAAA,GACE,OAAOx0G,KAAKwyG,WAAWgC,eACzB,CAMAC,WAAAA,GACE,OAAOz0G,KAAKwyG,WAAWiC,aACzB,CAOAC,oBAAAA,GACE,OAAO10G,KAAKwyG,WAAWkC,sBACzB,CAOAC,aAAAA,GACE,OAAO30G,KAAKwyG,WAAWmC,eACzB,CAMAC,cAAAA,GACE,OAAO50G,KAAKwyG,WAAWoC,gBACzB,CAQA9pE,oBAAAA,CAAqB3B,EAAO0rE,GAC1B,OAAO70G,KAAKwyG,WAAW1nE,qBAAqB3B,EAAO0rE,EACrD,CASAC,YAAAA,GACE,OAAO90G,KAAKwyG,WAAWuC,iBACzB,CAqBAC,UAAAA,GACE,OAAOh1G,KAAKwyG,WAAWwC,YACzB,CAmBAC,wBAAAA,GAAsD,IAA7B,OAAEr7F,EAAS,WAAWza,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACjD,MAAM,gBAAEi7F,GAAoBp6F,KAAKwyG,WAAW0C,mBAAmBt7F,GAE/D,OAAO5Z,KAAKwyG,WAAWyC,yBAAyB7a,EAClD,CAOA+a,cAAAA,GACE,OAAOn1G,KAAKwyG,WAAW2C,gBACzB,CASAC,WAAAA,GACE,OAAOp1G,KAAKwyG,WAAW4C,aACzB,CAeAC,WAAAA,GACE,OAAOr1G,KAAKwyG,WAAW6C,aACzB,CAMAtzE,OAAAA,GACE,OAAO/hC,KAAKwyG,WAAWzwE,SACzB,CAMAuzE,YAAAA,GACE,OAAOt1G,KAAKwyG,WAAW8C,cACzB,CAgBAC,YAAAA,CAAaC,GACX,OAAOx1G,KAAKwyG,WAAW+C,aAAaC,EACtC,CAOAC,eAAAA,GACE,OAAOz1G,KAAKwyG,WAAWkD,uBAAuB1yE,OAChD,CAcAwpE,OAAAA,GAAiC,IAAzBmJ,EAAex2G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACrB,OAAOa,KAAKwyG,WAAWoD,aAAaD,GAAmB31G,KAAK+zG,UAC9D,CAKA5mF,OAAAA,GACE,OAAOntB,KAAK61G,YAAY1oF,SAC1B,CAMA2oF,gBAAAA,CAAiB1B,GACf,OAAOp0G,KAAKwyG,WAAWsD,iBAAiB1B,EAC1C,CAMA,iBAAIrC,GACF,OAAO/xG,KAAKwyG,WAAWT,aACzB,CAKA,eAAI8D,GACF,OAAO71G,KAAKwyG,WAAWqD,WACzB,CAOAE,eAAAA,GACE,OAAO/1G,KAAKwyG,WAAWuD,iBACzB,CAMAC,YAAAA,GACE,OAAOh2G,KAAKwyG,WAAWwD,cACzB,CAOAC,sBAAAA,GACE,OAAOj2G,KAAKwyG,WAAWyD,wBACzB,EACF,IAAAC,GAAA,IAAAvoF,QAAAwoF,GAAA,IAAApoF,QAsMA,MAAMqoF,GAGJ5oG,WAAAA,CAAYi0B,EAAW40E,EAAU/D,GAA2B,IAAhBvB,EAAM5xG,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAAQL,EAAA,KAAAq3G,IAF1Dl3G,EAAA,KAAAi3G,IAAkB,GAGhBl2G,KAAKs2G,WAAa70E,EAClBzhC,KAAKu2G,UAAYF,EACjBr2G,KAAKwyG,WAAaF,EAClBtyG,KAAKo0D,OAAS28C,EAAS,IAAIvvF,GAAc,KACzCxhB,KAAKw2G,QAAUzF,EAEf/wG,KAAK0kF,WAAa4tB,EAAU5tB,WAC5B1kF,KAAK+5D,KAAO,IAAI8vC,GAEhB7pG,KAAKy2G,cAAgB,IAAIpvF,IACzBrnB,KAAKgyG,WAAY,EACjBhyG,KAAK02G,eAAiB,IACxB,CAKA,cAAI3zE,GACF,OAAO/iC,KAAKs2G,WAAa,CAC3B,CAKA,UAAIvsD,GACF,OAAO/pD,KAAKu2G,UAAUxsD,MACxB,CAKA,OAAIqqD,GACF,OAAOp0G,KAAKu2G,UAAUnC,GACxB,CAKA,YAAIl1F,GACF,OAAOlf,KAAKu2G,UAAUr3F,QACxB,CAMA,QAAI48C,GACF,OAAO97D,KAAKu2G,UAAUz6C,IACxB,CAOA66C,WAAAA,GAMQ,IANI,MACVx3F,EAAK,SACLC,EAAWpf,KAAK+pD,OAAM,QACtB1qC,EAAU,EAAC,QACXC,EAAU,EAAC,SACXC,GAAW,GACZpgB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACH,OAAO,IAAI4f,GAAa,CACtBE,QAASjf,KAAK87D,KACd58C,SAAUlf,KAAKkf,SACfC,QACAC,WACAC,UACAC,UACAC,YAEJ,CAOAq3F,cAAAA,GAA4C,IAA7B,OAAEh9F,EAAS,WAAWza,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACvC,MAAM,gBAAEi7F,GAAoBp6F,KAAKwyG,WAAW0C,mBAAmBt7F,GAE/D,OAAO5Z,KAAKwyG,WAAWoE,eAAe52G,KAAKs2G,WAAYlc,EACzD,CAMA0a,YAAAA,GACE,OAAO90G,KAAKwyG,WAAWqE,iBAAiB72G,KAAKs2G,WAC/C,CAKA,iBAAIp4E,GACF,OAAOl+B,KAAKwyG,WAAWt0E,aACzB,CAKA,aAAI61E,GACF,OAAOjnG,GAAO9M,KAAM,cAAeA,KAAKwyG,WAAWwB,YACrD,CAQA,YAAM8C,GAAS,IAAAC,EACb,OAAkC,QAA3BA,EAAA/2G,KAAKwyG,WAAWwB,mBAAW,IAAA+C,OAAA,EAA3BA,EAA6B39F,SAASpZ,KAAKs2G,cAAe,IACnE,CASA76F,MAAAA,CAAMu7F,GAeH,IAAAC,EAAAC,EAAAC,EAAA,IAfI,cACLC,EAAa,OACbzkF,EAASykF,EAAczkF,OAAM,SAC7BtW,EAAQ,OACRzC,EAAS,UAAS,eAClBy9F,EAAiBz2G,EAAeE,OAAM,UACtCwE,EAAY,KAAI,WAChB06B,EAAa,KAAI,6BACjBs3E,EAA+B,KAAI,oBACnC1yB,EAAsB,KAAI,WAC1BnoD,EAAa,KAAI,uBACjB86E,EAAyB,KAAI,UAC7Br6E,GAAY,EAAK,iBACjBs6E,GAAmB,EAAK,iBACxB1wB,EAAmB,MACpBkwB,EACY,QAAXC,EAAAj3G,KAAKo0D,cAAM,IAAA6iD,GAAXA,EAAax1F,KAAK,WAElB,MAAMg2F,EAAaz3G,KAAKwyG,WAAW0C,mBACjCt7F,EACAy9F,EACAE,EACAr6E,IAEI,gBAAEk9D,EAAe,SAAEpR,GAAayuB,EAGtCvuF,EAAKgtF,GAALl2G,MAAuB,GAEvBs3G,IAAAA,EACEt3G,KAAKwyG,WAAWyC,yBAAyB7a,IAE3C,IAAIsd,EAAc13G,KAAKy2G,cAAcn3G,IAAI0pF,GACpC0uB,IACHA,EAAcp5G,OAAOwa,OAAO,MAC5B9Y,KAAKy2G,cAAcj4G,IAAIwqF,EAAU0uB,IAI/BA,EAAYC,4BACdp4E,aAAam4E,EAAYC,2BACzBD,EAAYC,0BAA4B,MAG1C,MAAMC,KAAiBxd,EAAkBz5F,GAIA,IAAAk3G,EAApCH,EAAYI,yBACfJ,EAAYI,uBAAyBp4G,QAAQujC,gBAC7Cy0E,EAAYr7B,aAAe,CACzB2K,QAAS,GACTD,UAAW,GACXgxB,WAAW,EACXC,eAAgB,MAGP,QAAXH,EAAA73G,KAAKo0D,cAAM,IAAAyjD,GAAXA,EAAap2F,KAAK,gBAClBzhB,KAAKi4G,kBAAkBR,IAGzB,MAAMS,EAAoBC,QACxBn4G,KAAKw2G,UAAoC,QAA7BU,EAAIhmG,WAAWknG,sBAAc,IAAAlB,OAAA,EAAzBA,EAA2BzhE,UAGvC4iE,GACHr4G,KAAK02G,iBAAmBc,GAAoBU,GAEzClgD,EAAW4O,IAGf,GAFA8wC,EAAYY,YAAYjtF,OAAOktF,GAE3BF,EAAwB,KAAAG,EAC1B,MAAM9B,EAAuC,QAAzB8B,EAAGD,EAAmBE,WAAG,IAAAD,OAAA,EAAtBA,EAAwBxiC,kBAAkBV,OAC7DohC,IACE6B,EAAmB1xB,SACrB0xB,EAAmB1xB,QAAQ6xB,kBACzBhC,EACA6B,EAAmBE,IAAIziC,kBAAkBT,qBAGzCiiC,IACFx3G,KAAK02G,eAAiBA,GAG5B,CAoBiB,IAAAiC,GAhBbf,GACF1uF,EAAKgtF,GAALl2G,MAAuB,GAEzBd,EAAAi3G,GAAAn2G,KAAK44G,IAAWvnG,KAAhBrR,MAEI4mE,GACF2xC,EAAmBrzC,WAAWvlE,OAAOinE,GAErC5mE,KAAK64G,mBAAmB,CACtBnB,cACA1xC,OAAQY,aAAiBz7D,MAAQy7D,EAAQ,IAAIz7D,MAAMy7D,MAGrD2xC,EAAmBrzC,WAAWrlE,UAG5BG,KAAKo0D,UACPp0D,KAAKo0D,OAAOvyC,QAAQ,aACpB7hB,KAAKo0D,OAAOvyC,QAAQ,WAEA,QAApB82F,EAAIznG,WAAW4nG,aAAK,IAAAH,GAAhBA,EAAkBljE,SACpBvkC,WAAW4nG,MAAM95G,IAAIgB,KAAK+iC,WAAY/iC,KAAKo0D,UAK3CmkD,EAAqB,IAAIQ,GAAmB,CAChD9iF,SAAU+hC,EAEV/pB,OAAQ,CACNtb,SACAykF,gBACAphC,kBAAmBqiC,EACf,IAAIpnC,GACFt+C,EACA+kF,EAAYr7B,aAAah+E,OACzB65G,GAEF,KACJ77F,WACA/W,YACA06B,cAEF+5B,KAAM/5D,KAAK+5D,KACX2qB,WAAY1kF,KAAK0kF,WACjBE,sBACAvI,aAAcq7B,EAAYr7B,aAC1B56C,UAAWzhC,KAAKs2G,WAChBx2B,cAAe9/E,KAAKwyG,WAAW1yB,cAC/B5hD,cAAel+B,KAAKwyG,WAAWt0E,cAC/B86E,0BAA2BpB,EAC3B7G,OAAQ/wG,KAAKw2G,QACb/5E,aACAgrC,UAAWznE,KAAKwyG,WAAW/qC,UAC3Bqf,uBAGDqwB,EAAAO,GAAYY,cAAZnB,EAAYmB,YAAgB,IAAI9oF,MAAOxwB,IAAIu5G,GAC5C,MAAMU,EAAaV,EAAmBpJ,KA2BtC,OAzBAzvG,QAAQqzC,IAAI,CACV2kE,EAAYI,uBAAuB90E,QACnCs0E,IAECv3G,KAAKm5G,IAA2C,IAAAC,EAAA,IAAzC7yB,EAAczB,GAAsBq0B,EAC1C,GAAIl5G,KAAKgyG,UACPh6C,QADF,CAMA,GAFW,QAAXmhD,EAAAn5G,KAAKo0D,cAAM,IAAA+kD,GAAXA,EAAa13F,KAAK,eAEZojE,EAAsBuV,gBAAkBA,GAC5C,MAAM,IAAIjvF,MACR,uIAIJotG,EAAmBa,mBAAmB,CACpC9yB,eACAzB,0BAEF0zB,EAAmBc,qBAbnB,IAeD/wC,MAAMtQ,GAEFihD,CACT,CAQAK,eAAAA,GAKQ,IALQ,OACd1/F,EAAS,UAAS,eAClBy9F,EAAiBz2G,EAAeE,OAAM,uBACtCy2G,EAAyB,KAAI,UAC7Br6E,GAAY,GACb/9B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAYH,MAAMs4G,EAAaz3G,KAAKwyG,WAAW0C,mBACjCt7F,EACAy9F,EACAE,EACAr6E,GACiB,GAEnB,IAKIq8E,EALA7B,EAAc13G,KAAKy2G,cAAcn3G,IAAIm4G,EAAWzuB,UAOb,IAAAwwB,EAAAC,GANlC/B,IACHA,EAAcp5G,OAAOwa,OAAO,MAC5B9Y,KAAKy2G,cAAcj4G,IAAIi5G,EAAWzuB,SAAU0uB,IAIzCA,EAAYgC,wBACfH,EAAaj7G,OAAOwa,OAAO,MAC3BygG,EAAWF,oBAxBb,WACM3B,EAAYr7B,aAAa07B,YAC3BL,EAAYgC,qBAAqB75G,QAAQ63G,EAAYr7B,cAErDq7B,EAAYY,YAAYjtF,OAAOkuF,GAEnC,EAmBE7B,EAAYgC,qBAAuBh6G,QAAQujC,kBAC1Cu2E,EAAA9B,GAAYY,cAAZkB,EAAYlB,YAAgB,IAAI9oF,MAAOxwB,IAAIu6G,GAC5C7B,EAAYr7B,aAAe,CACzB2K,QAAS,GACTD,UAAW,GACXgxB,WAAW,EACXC,eAAgB,MAGP,QAAXyB,EAAAz5G,KAAKo0D,cAAM,IAAAqlD,GAAXA,EAAah4F,KAAK,gBAClBzhB,KAAKi4G,kBAAkBR,IAEzB,OAAOC,EAAYgC,qBAAqB12E,OAC1C,CASA22E,iBAAAA,GAGQ,IAHU,qBAChBC,GAAuB,EAAK,qBAC5BC,GAAuB,GACxB16G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAGH,OAAOa,KAAKwyG,WAAWN,eAAe/sC,eACpC,iBACA,CACE1jC,UAAWzhC,KAAKs2G,WAChBsD,sBAA+C,IAAzBA,EACtBC,sBAA+C,IAAzBA,GAExB,CACEC,cAV4B,IAW5BrpF,KAAK/X,GACIA,EAAYE,MAAMva,QAIjC,CAUA07G,cAAAA,GAA4B,IAAb9rE,EAAM9uC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACvB,GAAIa,KAAKwyG,WAAWwB,YAGlB,OAAOh0G,KAAK82G,SAAS/2G,KAAK4Y,GAAOF,GAAQC,YAAYC,IAEvD,MAAM6wF,EAAiBxpG,KAAK25G,kBAAkB1rE,GAE9C,OAAO,IAAIvuC,QAAQ,SAAUG,EAASF,GAcpC,MAAMu/F,EAASsK,EAAe5E,YACxBlsF,EAAc,CAClBE,MAAO,GACPC,OAAQva,OAAOwa,OAAO,MACtBizF,KAAM,OAjBR,SAASH,IACP1M,EAAOmB,OAAOtgG,KAAK,SAAAi6G,GAA2B,IAAAC,EAAA,IAAjB,MAAEn6G,EAAK,KAAEF,GAAMo6G,EACtCp6G,EACFC,EAAQ6Y,IAGM,QAAhBuhG,EAAAvhG,EAAYqzF,YAAI,IAAAkO,IAAhBvhG,EAAYqzF,KAASjsG,EAAMisG,MAC3BztG,OAAO8c,OAAO1C,EAAYG,OAAQ/Y,EAAM+Y,QACxCH,EAAYE,MAAM5J,QAAQlP,EAAM8Y,OAChCgzF,IACF,EAAGjsG,EACL,CAQAisG,EACF,EACF,CAOAsO,aAAAA,GACE,OAAOl6G,KAAKwyG,WAAW0H,cAAcl6G,KAAKs2G,WAC5C,CAMA6D,QAAAA,GACEn6G,KAAKgyG,WAAY,EAEjB,MAAMoI,EAAS,GACf,IAAK,MAAM1C,KAAe13G,KAAKy2G,cAAcp3E,SAO3C,GANAr/B,KAAK64G,mBAAmB,CACtBnB,cACA1xC,OAAQ,IAAI76D,MAAM,uBAClBkvG,OAAO,KAGL3C,EAAYgC,qBAIhB,IAAK,MAAMnB,KAAsBb,EAAYY,YAC3C8B,EAAOprG,KAAKupG,EAAmB+B,WAC/B/B,EAAmB/iE,SAMvB,OAHAx1C,KAAK+5D,KAAKz6B,QACVpW,EAAKgtF,GAALl2G,MAAuB,GAEhBN,QAAQqzC,IAAIqnE,EACrB,CASA5N,OAAAA,GAA4B,IAApB+N,EAAUp7G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAChB+pB,EAAKgtF,GAALl2G,MAAuB,GACvB,MAAM+mE,EAAU7nE,EAAAi3G,GAAAn2G,KAAK44G,IAAWvnG,KAAhBrR,MAKhB,OAHIu6G,GAAcxzC,GAChB/mE,KAAKo0D,SAALp0D,KAAKo0D,OAAW,IAAI5yC,IAEfulD,CACT,CAwBAyzC,gBAAAA,CAAiBl0B,EAAc0C,GAAU,IAAAyxB,EAAAC,EACvC,MAAMhD,EAAc13G,KAAKy2G,cAAcn3G,IAAI0pF,GACtC0uB,IAGM,QAAX+C,EAAAz6G,KAAKo0D,cAAM,IAAAqmD,GAAXA,EAAa54F,QAAQ,gBAIa,QAAlC64F,EAAAhD,EAAYI,8BAAsB,IAAA4C,GAAlCA,EAAoC76G,QAAQymF,GAC9C,CAKAq0B,gBAAAA,CAAiBC,EAAmBlD,GAElC,IAAK,IAAIhpG,EAAI,EAAGuS,EAAK25F,EAAkBv8G,OAAQqQ,EAAIuS,EAAIvS,IACrDgpG,EAAYr7B,aAAa2K,QAAQh4E,KAAK4rG,EAAkB5zB,QAAQt4E,IAChEgpG,EAAYr7B,aAAa0K,UAAU/3E,KAAK4rG,EAAkB7zB,UAAUr4E,IAEtEgpG,EAAYr7B,aAAa07B,UAAY6C,EAAkB7C,UACvDL,EAAYr7B,aAAa27B,eAAiB4C,EAAkB5C,eAG5D,IAAK,MAAMO,KAAsBb,EAAYY,YAC3CC,EAAmBc,sBAGjBuB,EAAkB7C,WACpB74G,EAAAi3G,GAAAn2G,KAAK44G,IAAWvnG,KAAhBrR,KAEJ,CAKAi4G,iBAAAA,CAAiB4C,GAKd,IALe,gBAChBzgB,EAAe,SACfpR,EAAQ,8BACR8xB,EAA6B,YAC7B9lD,GACD6lD,EAOC,MAAM,IAAEh3F,EAAG,SAAE6uC,GAAaooD,EAapB5b,EAXiBl/F,KAAKwyG,WAAWN,eAAe/sC,eACpD,kBACA,CACE1jC,UAAWzhC,KAAKs2G,WAChB18F,OAAQwgF,EACRpR,WACArtE,kBAAmBkI,EACnBmxC,eAEFtC,GAE4BkyC,YAExB8S,EAAc13G,KAAKy2G,cAAcn3G,IAAI0pF,GAC3C0uB,EAAYqD,aAAe7b,EAE3B,MAAM0M,EAAOA,KACX1M,EAAOmB,OAAOtgG,KACZi7G,IAAqB,IAApB,MAAEl7G,EAAK,KAAEF,GAAMo7G,EACVp7G,EACF83G,EAAYqD,aAAe,KAGzB/6G,KAAKwyG,WAAWR,YAGpBhyG,KAAK26G,iBAAiB76G,EAAO43G,GAC7B9L,MAEF5lC,IAGE,GAFA0xC,EAAYqD,aAAe,MAEvB/6G,KAAKwyG,WAAWR,UAApB,CAGA,GAAI0F,EAAYr7B,aAAc,CAE5Bq7B,EAAYr7B,aAAa07B,WAAY,EAErC,IAAK,MAAMQ,KAAsBb,EAAYY,YAC3CC,EAAmBc,sBAErBn6G,EAAAi3G,GAAAn2G,KAAK44G,IAAWvnG,KAAhBrR,KACF,CAEA,GAAI03G,EAAYI,uBACdJ,EAAYI,uBAAuBn4G,OAAOqmE,OACrC,KAAI0xC,EAAYgC,qBAGrB,MAAM1zC,EAFN0xC,EAAYgC,qBAAqB/5G,OAAOqmE,EAG1C,CAjBA,KAqBN4lC,GACF,CAKAiN,kBAAAA,CAAkBoC,GAAyC,IAAxC,YAAEvD,EAAW,OAAE1xC,EAAM,MAAEq0C,GAAQ,GAAOY,EAQvD,GAAKvD,EAAYqD,aAAjB,CASA,GALIrD,EAAYC,4BACdp4E,aAAam4E,EAAYC,2BACzBD,EAAYC,0BAA4B,OAGrC0C,EAAO,CAGV,GAAI3C,EAAYY,YAAY7nF,KAAO,EACjC,OAKF,GAAIu1C,aAAkBllD,GAA6B,CACjD,IAAIo6F,EA91DwB,IAw2D5B,OATIl1C,EAAOjlD,WAAa,GAAKilD,EAAOjlD,WAAwB,MAE1Dm6F,GAASl1C,EAAOjlD,iBAGlB22F,EAAYC,0BAA4B3qE,WAAW,KACjD0qE,EAAYC,0BAA4B,KACxC33G,KAAK64G,mBAAmB,CAAEnB,cAAa1xC,SAAQq0C,OAAO,KACrDa,GAEL,CACF,CAQA,GAPAxD,EAAYqD,aACTvlE,OAAO,IAAIrnC,GAAe63D,EAAO14D,UACjCg7D,MAAM,QAGTovC,EAAYqD,aAAe,MAEvB/6G,KAAKwyG,WAAWR,UAApB,CAKA,IAAK,MAAOmJ,EAAaC,KAAmBp7G,KAAKy2G,cAC/C,GAAI2E,IAAmB1D,EAAa,CAClC13G,KAAKy2G,cAAcprF,OAAO8vF,GAC1B,KACF,CAGFn7G,KAAKwsG,SAVL,CAvCA,CAkDF,CAMA,SAAIx4C,GACF,OAAOh0D,KAAKo0D,MACd,EACF,SAAAwkD,KAtMI,IAAKhvF,EAAKssF,GAALl2G,OAAwBA,KAAKgyG,UAChC,OAAO,EAET,IAAK,MAAM,YAAEsG,EAAW,aAAEj8B,KAAkBr8E,KAAKy2G,cAAcp3E,SAC7D,GAAIi5E,EAAY7nF,KAAO,IAAM4rD,EAAa07B,UACxC,OAAO,EAMX,OAHA/3G,KAAKy2G,cAAcn3E,QACnBt/B,KAAK+5D,KAAKz6B,QACVpW,EAAKgtF,GAALl2G,MAAuB,IAChB,CACT,KAAAq7G,GAAA,IAAA1tF,QAAA2tF,GAAA,IAAA3tF,QAAA4tF,GAAA,IAAA5tF,QAAA6tF,GAAA,IAAA7tF,QAAA8tF,GAAA,IAAA1tF,QA4MF,MAAM+hF,GAmEJtiG,WAAAA,GAIQ,IAJI,KACVD,EAAO,KACPkkG,KAAAA,EAAO,KAAI,UACXlnG,EAAYK,MACbzL,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAKH,GALIL,EAAA,KAAA28G,IAtENx8G,EAAA,KAAAo8G,GAAc37G,QAAQujC,iBAEtBhkC,EAAA,KAAAq8G,GAAkB,MAElBr8G,EAAA,KAAAs8G,GAAQ,MAERt8G,EAAA,KAAAu8G,GAAa,MAiEXx7G,KAAKuN,KAAOA,EACZvN,KAAKgyG,WAAY,EACjBhyG,KAAKuK,UAAYA,EAEbknG,EAAM,CACR,GAAciK,GAAY94F,EAAChkB,IAAI6yG,GAC7B,MAAM,IAAItmG,MAAM,gDAERuwG,GAAY94F,EAACpkB,IAAIizG,EAAMzxG,MACjCd,EAAAu8G,GAAAz7G,KAAK27G,IAAmBtqG,KAAxBrR,KAAyByxG,EAC3B,MACEvyG,EAAAu8G,GAAAz7G,KAAK47G,IAAWvqG,KAAhBrR,KAWJ,CAMA,WAAIgjC,GACF,OAAOpZ,EAAKyxF,GAALr7G,MAAiBgjC,OAC1B,CAcA,QAAIyuE,GACF,OAAO7nF,EAAK2xF,GAALv7G,KACT,CAMA,kBAAIkyG,GACF,OAAOtoF,EAAK0xF,GAALt7G,KACT,CAsJAmtB,OAAAA,GAAU,IAAA0uF,EAAAC,EACR97G,KAAKgyG,WAAY,EAGF,QAAf6J,EAAAjyF,EAAK4xF,GAALx7G,aAAe,IAAA67G,GAAfA,EAAiBl4C,YACjBz6C,EAAKsyF,GAALx7G,KAAkB,MAER07G,GAAY94F,EAACyI,OAAOzB,EAAK2xF,GAALv7G,OAC9BkpB,EAAKqyF,GAALv7G,KAAa,MAEO,QAApB87G,EAAAlyF,EAAK0xF,GAALt7G,aAAoB,IAAA87G,GAApBA,EAAsB3uF,UACtBjE,EAAKoyF,GAALt7G,KAAuB,KACzB,CAMA,aAAO8Y,CAAOm1B,GACZ,MAAM8tE,EAAa78G,EAvSjB4wG,GAuSiB9vG,KAAK07G,IAAY94F,EAACtjB,IAAU,OAAN2uC,QAAM,IAANA,OAAM,EAANA,EAAQwjE,MACjD,GAAIsK,EAAY,CACd,GAAIA,EAAWhJ,gBACb,MAAM,IAAI5nG,MACR,yHAIJ,OAAO4wG,CACT,CACA,OAAO,IAAIjM,GAAU7hE,EACvB,CAMA,oBAAWorD,GACT,GAAIJ,GAAoBI,UACtB,OAAOJ,GAAoBI,UAE7B,MAAM,IAAIluF,MAAM,gDAClB,CAWA,iCAAW6wG,GAaT,OAAOlvG,GAAO9M,KAAM,yBAZLud,WACb,GAAIne,EA1UJ0wG,GA0UI9vG,KAAKi8G,IAEP,OAAO78G,EA5UT0wG,GA4US9vG,KAAKi8G,IAMd,aADY,OAAej8G,KAAKq5F,YAClB6iB,sBAG8BC,GAChD,EAtVa,SAAAC,KAyGXxyF,EAAKyxF,GAALr7G,MAAiBH,UAEjB+pB,EAAK0xF,GAALt7G,MAAqB2e,KAAK,YAAa,CACrCpU,UAAWvK,KAAKuK,WAEpB,UAAAoxG,GAkBoBlK,GAClBvoF,EAAKqyF,GAALv7G,KAAayxG,GACbvoF,EAAKoyF,GAALt7G,KAAuB,IAAIkkE,GAAe,OAAQ,SAAUutC,IAC5D7nF,EAAK0xF,GAALt7G,MAAqBojC,GAAG,QAAS,QAIjClkC,EAAAu8G,GAAAz7G,KAAKo8G,IAAQ/qG,KAAbrR,KACF,UAAA47G,KAQE,GACYS,GAAiBz5F,GACjBq5F,GAAVnM,GAGA,YADA5wG,EAAAu8G,GAAAz7G,KAAKs8G,IAAgBjrG,KAArBrR,MAGF,IAAI,UAAEq5F,GAAcyW,EAEpB,IAMKA,EAAUyM,cAAcz2F,OAAOupF,SAAUhW,KAE1CA,EAAYyW,EAAU0M,kBACpB,IAAIpwG,IAAIitF,EAAWvzE,OAAOupF,UAAUziG,OAIxC,MAAMijG,EAAS,IAAIzW,OAAOC,EAAW,CAAE74F,KAAM,WACvC0xG,EAAiB,IAAIhuC,GAAe,OAAQ,SAAU2rC,GACtD4M,EAAiBA,KACrBh9E,EAAGN,QACH+yE,EAAe/kF,UACf0iF,EAAOlsC,YACH3jE,KAAKgyG,UACPpoF,EAAKyxF,GAALr7G,MAAiBL,OAAO,IAAIwL,MAAM,yBAIlCjM,EAAAu8G,GAAAz7G,KAAKs8G,IAAgBjrG,KAArBrR,OAIEy/B,EAAK,IAAIxC,gBACf4yE,EAAO91F,iBACL,QACA,KACO6P,EAAK4xF,GAALx7G,OAGHy8G,KAGJ,CAAE9yF,OAAQ8V,EAAG9V,SAGfuoF,EAAe9uE,GAAG,OAAQlb,IACxBuX,EAAGN,SACCn/B,KAAKgyG,WAAc9pF,GAIvBgB,EAAKoyF,GAALt7G,KAAuBkyG,GACvBhpF,EAAKqyF,GAALv7G,KAAa6vG,GACb3mF,EAAKsyF,GAALx7G,KAAkB6vG,GAElB3wG,EAAAu8G,GAAAz7G,KAAKo8G,IAAQ/qG,KAAbrR,OAPEy8G,MAUJvK,EAAe9uE,GAAG,QAASlb,IAEzB,GADAuX,EAAGN,QACCn/B,KAAKgyG,UACPyK,SAGF,IACEC,GACF,CAAE,MAAAC,GAEAz9G,EAAAu8G,GAAAz7G,KAAKs8G,IAAgBjrG,KAArBrR,KACF,IAGF,MAAM08G,EAAWA,KACf,MAAME,EAAU,IAAIxtG,WAEpB8iG,EAAevzF,KAAK,OAAQi+F,EAAS,CAACA,EAAQltG,UAOhD,YADAgtG,GAEF,CAAE,MAAAG,GACAhyG,GAAK,gCACP,CAGA3L,EAAAu8G,GAAAz7G,KAAKs8G,IAAgBjrG,KAArBrR,KACF,UAAAs8G,KAGiBD,GAAiBz5F,IAC9B3X,GAAK,2BACKoxG,GAAiBz5F,GAAG,GAGhCktF,EAAUkM,uBACPj8G,KAAKm8G,IAAwB,IAAAY,EAAAC,EAC5B,GAAI/8G,KAAKgyG,UAEP,YADApoF,EAAKyxF,GAALr7G,MAAiBL,OAAO,IAAIwL,MAAM,yBAGpC,MAAMsmG,EAAO,IAAIpuC,GACjBn6C,EAAKqyF,GAALv7G,KAAayxG,GAGb,MAAMh4F,EAAK,OAAHzO,QAAoBgyG,GAAap6F,GAAAk6F,EAAbE,GAAap6F,EAAAm6F,EAAAD,IAAAA,GAAAC,IAInCE,EAAgB,IAAI/4C,GAAezqD,EAAK,UAAWA,EAAIg4F,GAC7DyK,EAAqBgB,MAAMD,EAAexL,GAE1CvoF,EAAKoyF,GAALt7G,KAAuB,IAAIkkE,GAAezqD,EAAIA,EAAK,UAAWg4F,IAC9DvyG,EAAAu8G,GAAAz7G,KAAKo8G,IAAQ/qG,KAAbrR,QAEDsoE,MAAMtC,IACLp8C,EAAKyxF,GAALr7G,MAAiBL,OACf,IAAIwL,MAAM,mCAADH,OAAoCg7D,EAAO14D,QAAO,SAGnE,UAAA2uG,GAAAkB,GAiDE,IAAI,IAAAC,EACF,OAA6B,QAAtBA,EAAAlsG,WAAWmsG,mBAAW,IAAAD,OAAA,EAAtBA,EAAwBlB,uBAAwB,IACzD,CAAE,MAAAoB,GACA,OAAO,IACT,CACF,CAkBFC,EAvVMzN,GAqUJ,IAAAkN,GAAA,CAAAp6F,EA5TuB,GAACy5F,GAAA,CAAAz5F,GAEG,GAAK84F,GAAA,CAAA94F,EAEV,IAAI+K,SAIlBxtB,IAEGk8G,GAAiBz5F,EAAA1jB,EAnBxB4wG,EAASyN,GAmBkB,GAEzBtkB,GAAoBI,YAApBJ,GAAoBI,UAEhB,qBAKNkkB,EAAKhB,cAAgB,CAAC/wG,EAASgyG,KAC7B,MAAMC,EAAOrxG,IAAIC,MAAMb,GACvB,GAAS,OAAJiyG,QAAI,IAAJA,IAAAA,EAAMngE,QAA0B,SAAhBmgE,EAAKngE,OACxB,OAAO,EAET,MAAMogE,EAAQ,IAAItxG,IAAIoxG,EAAUC,GAChC,OAAOA,EAAKngE,SAAWogE,EAAMpgE,QAG/BigE,EAAKf,kBAAoBjxG,IAKvB,MAAMoyG,EAAU,iBAAH3yG,OAAoBO,EAAG,OACpC,OAAOa,IAAIwxG,gBACT,IAAI7pF,KAAK,CAAC4pF,GAAU,CAAEn9G,KAAM,sBAIhC+8G,EAAKM,SAAW5vE,IlC1jDtB,IAAoBpgC,EkC8jDZ,GlC9jDYA,EkC4jDV,gElC1jDR9C,QAAQ+yG,IAAI,yBAA2BjwG,GkC4jDtB,OAANogC,QAAM,IAANA,IAAAA,EAAQwjE,KACX,MAAM,IAAItmG,MAAM,kDAElB,OAAOoyG,EAAKzkG,OAAOm1B,IACpB,IAAA8vE,GAAA,IAAApwF,QAAAqwF,GAAA,IAAArwF,QAAAswF,GAAA,IAAAtwF,QAAAuwF,GAAA,IAAAvwF,QAAAwwF,GAAA,IAAAxwF,QAAAywF,GAAA,IAAArwF,QAqSP,MAAMwkF,GAWJ/kG,WAAAA,CACE0kG,EACA2D,EACA1D,EACAlkE,EACAowE,EACA52C,GACA3oE,EAAA,KAAAs/G,IAjBFn/G,EAAA,KAAA8+G,GAAkB,IAAI12F,KAEtBpoB,EAAA,KAAA++G,GAAa,IAAI32F,KAEjBpoB,EAAA,KAAAg/G,GAAgB,IAAI52F,KAEpBpoB,EAAA,KAAAi/G,GAAgB,IAAI72F,KAEpBpoB,EAAA,KAAAk/G,GAAsB,MAUpBn+G,KAAKkyG,eAAiBA,EACtBlyG,KAAK61G,YAAcA,EACnB71G,KAAK0kF,WAAa,IAAImlB,GACtB7pG,KAAKs+G,WAAa,IAAIhpD,GAAW,CAC/BE,cAAevnB,EAAOunB,cACtBC,aAAcxnB,EAAOwnB,eAEvBz1D,KAAK+xG,cAAgB9jE,EAAO8jE,cAC5B/xG,KAAKu+G,QAAUtwE,EAEfjuC,KAAK8/E,cAAgBu+B,EAAQv+B,cAC7B9/E,KAAKk+B,cAAgBmgF,EAAQngF,cAC7Bl+B,KAAKsxG,kBAAoB+M,EAAQ/M,kBACjCtxG,KAAKuxG,wBAA0B8M,EAAQ9M,wBACvCvxG,KAAKwxG,YAAc6M,EAAQ7M,YAE3BxxG,KAAKgyG,WAAY,EACjBhyG,KAAKw+G,kBAAoB,KAEzBx+G,KAAKy+G,eAAiBtM,EACtBnyG,KAAK0+G,YAAc,KACnB1+G,KAAK2+G,cAAgB,KACrB3+G,KAAK01G,uBAAyBh2G,QAAQujC,gBACtCjjC,KAAKynE,UAAYA,EAEjBznE,KAAK4+G,qBAwBP,CAaA,qBAAIjjG,GACF,OAAO7O,GAAO9M,KAAM,oBAAqB,IAAIgzD,GAC/C,CAEAkiD,kBAAAA,CACEt7F,GAKA,IAJAy9F,EAAcl4G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGyB,EAAeE,OAChCy2G,EAAsBp4G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACzB+9B,EAAS/9B,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACT0/G,EAAQ1/G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAEJi7F,EAAkBz5F,EAClBm6G,EAAgCroD,GAEpC,OAAQ74C,GACN,IAAK,MACHwgF,EAAkBz5F,EAClB,MACF,IAAK,UACH,MACF,IAAK,QACHy5F,EAAkBz5F,EAClB,MACF,QACEsK,GAAK,wCAADD,OAAyC4O,IAGjD,MAAM+B,EACJy+E,EAAkBz5F,GAClB42G,aAAkC5jD,GAC9B4jD,EACAv3G,KAAK2b,kBAEX,OAAQ07F,GACN,KAAKz2G,EAAeC,QAClBu5F,GAAmBz5F,EACnB,MACF,KAAKC,EAAeE,OAClB,MACF,KAAKF,EAAeG,aAClBq5F,GAAmBz5F,EACnB,MACF,KAAKC,EAAeI,eAClBo5F,GAAmBz5F,EAEnBm6G,EAAgCn/F,EAAkBi4C,aAClD,MACF,QACE3oD,GAAK,gDAADD,OAAiDqsG,IAGrDn6E,IACFk9D,GAAmBz5F,GAEjBk+G,IACFzkB,GAAmBz5F,GAGrB,MAAQs0D,IAAKD,EAAavoD,KAAMqyG,GAC9BnjG,EAAkBq5C,YAQpB,MAAO,CACLolC,kBACApR,SARkB,CAClBoR,EACA0gB,EAA8BruG,KAC9BqyG,GAKsB7vG,KAAK,KAC3B6rG,gCACA9lD,cAEJ,CAEA7nC,OAAAA,GAAU,IAAA4xF,EACR,GAAI/+G,KAAKw+G,kBACP,OAAOx+G,KAAKw+G,kBAAkBx7E,QAGhChjC,KAAKgyG,WAAY,EACjBhyG,KAAKw+G,kBAAoB9+G,QAAQujC,gBAET,QAAxB87E,EAAAn1F,EAAKu0F,GAALn+G,aAAwB,IAAA++G,GAAxBA,EAA0Bp/G,OACxB,IAAIwL,MAAM,oDAGZ,MAAMivG,EAAS,GAGf,IAAK,MAAMt3C,KAAQl5C,EAAKo0F,GAALh+G,MAAgBq/B,SACjC+6E,EAAOprG,KAAK8zD,EAAKq3C,YAEnBvwF,EAAKo0F,GAALh+G,MAAgBs/B,QAChB1V,EAAKq0F,GAALj+G,MAAmBs/B,QACnB1V,EAAKs0F,GAALl+G,MAAmBs/B,QAEft/B,KAAK2a,eAAe,sBACtB3a,KAAK2b,kBAAkB03C,gBAGzB,MAAM2rD,EAAah/G,KAAKkyG,eAAejtC,gBAAgB,YAAa,MAmBpE,OAlBAm1C,EAAOprG,KAAKgwG,GAEZt/G,QAAQqzC,IAAIqnE,GAAQr6G,KAAK,KAAM,IAAAk/G,EAAAC,EAC7Bl/G,KAAK0kF,WAAWplD,QAChBt/B,KAAKs+G,WAAWh/E,QAChB1V,EAAKm0F,GAAL/9G,MAAqBs/B,QACrBt/B,KAAKk+B,cAAc/Q,UACnBg+E,GAAUqB,UAES,QAAnByS,EAAAj/G,KAAKy+G,sBAAc,IAAAQ,GAAnBA,EAAqBvf,kBACnB,IAAIvxF,GAAe,2BAGF,QAAnB+wG,EAAAl/G,KAAKkyG,sBAAc,IAAAgN,GAAnBA,EAAqB/xF,UACrBntB,KAAKkyG,eAAiB,KAEtBlyG,KAAKw+G,kBAAkB3+G,WACtBG,KAAKw+G,kBAAkB7+G,QACnBK,KAAKw+G,kBAAkBx7E,OAChC,CAEA47E,mBAAAA,GACE,MAAM,eAAE1M,EAAc,YAAE2D,GAAgB71G,KAExCkyG,EAAe9uE,GAAG,YAAa,CAAClb,EAAMi3F,KACpC/zG,GACEpL,KAAKy+G,eACL,mDAEFz+G,KAAK0+G,YAAc1+G,KAAKy+G,eAAerf,gBACvCp/F,KAAK0+G,YAAY3f,WAAalhE,IAC5B79B,KAAK2+G,cAAgB,CACnBlnD,OAAQ55B,EAAI45B,OACZomC,MAAOhgE,EAAIggE,QAGfshB,EAAKt4C,OAAS,KACZ7mE,KAAK0+G,YACFre,OACAtgG,KAAK,SAAAq/G,GAA2B,IAAjB,MAAEt/G,EAAK,KAAEF,GAAMw/G,EACzBx/G,EACFu/G,EAAK3rF,SAGPpoB,GACEtL,aAAiB8xD,YACjB,wCAIFutD,EAAK54C,QAAQ,IAAIn3D,WAAWtP,GAAQ,EAAG,CAACA,IAC1C,GACCwoE,MAAMtC,IACLm5C,EAAKv4C,MAAMZ,MAIjBm5C,EAAKr4C,SAAWd,IACdhmE,KAAK0+G,YAAYlpE,OAAOwwB,GAExBm5C,EAAKx4C,MAAM2B,MAAM+2C,IACf,IAAIr/G,KAAKgyG,UAGT,MAAMqN,OAKZnN,EAAe9uE,GAAG,qBAAsB7lB,gBAChCvd,KAAK0+G,YAAYze,aAEvB,MAAM,qBAAEE,EAAoB,iBAAED,EAAgB,cAAEE,GAC9CpgG,KAAK0+G,YAIP,IAAKve,IAAyBD,EAAkB,CACtB,IAAAof,EAAxB,GAAIt/G,KAAK2+G,cACe,QAAtBW,EAAAzJ,EAAY9W,kBAAU,IAAAugB,GAAtBA,EAAAjuG,KAAAwkG,EAAyB71G,KAAK2+G,eAEhC3+G,KAAK0+G,YAAY3f,WAAalhE,IAAO,IAAA0hF,EACb,QAAtBA,EAAA1J,EAAY9W,kBAAU,IAAAwgB,GAAtBA,EAAAluG,KAAAwkG,EAAyB,CACvBp+C,OAAQ55B,EAAI45B,OACZomC,MAAOhgE,EAAIggE,QAGjB,CAEA,MAAO,CAAEsC,uBAAsBD,mBAAkBE,mBAGnD8R,EAAe9uE,GAAG,iBAAkB,CAAClb,EAAMi3F,KACzC/zG,GACEpL,KAAKy+G,eACL,wDAEF,MAAMpgB,EAAcr+F,KAAKy+G,eAAelf,eACtCr3E,EAAKw1E,MACLx1E,EAAKlG,KAaFq8E,GAKL8gB,EAAKt4C,OAAS,KACZw3B,EACGgC,OACAtgG,KAAK,SAAAy/G,GAA2B,IAAjB,MAAE1/G,EAAK,KAAEF,GAAM4/G,EACzB5/G,EACFu/G,EAAK3rF,SAGPpoB,GACEtL,aAAiB8xD,YACjB,6CAEFutD,EAAK54C,QAAQ,IAAIn3D,WAAWtP,GAAQ,EAAG,CAACA,IAC1C,GACCwoE,MAAMtC,IACLm5C,EAAKv4C,MAAMZ,MAIjBm5C,EAAKr4C,SAAWd,IACdq4B,EAAY7oD,OAAOwwB,GAEnBm5C,EAAKx4C,MAAM2B,MAAM+2C,IACf,IAAIr/G,KAAKgyG,UAGT,MAAMqN,MA9BRF,EAAK3rF,UAmCT0+E,EAAe9uE,GAAG,SAAUq8E,IAAiB,IAAhB,QAAE9L,GAAS8L,EACtCz/G,KAAK0/G,UAAY/L,EAAQE,SACzB7zG,KAAKg0G,YAAcL,EAAQgM,kBACpBhM,EAAQgM,WACf9J,EAAY5L,YAAYpqG,QAAQ,IAAI6zG,GAAiBC,EAAS3zG,SAGhEkyG,EAAe9uE,GAAG,eAAgB4E,IAChC6tE,EAAY5L,YAAYtqG,OAAOokE,GAAW/7B,MAG5CkqE,EAAe9uE,GAAG,kBAAmB4E,IACnC9e,EAAKi1F,GAALn+G,KAA2BN,QAAQujC,iBAEnC,IACE,IAAK4yE,EAAY+J,WACf,MAAM77C,GAAW/7B,GAGnB,MAAM63E,EAAiBnQ,IACjBA,aAAoBvkG,MACtBye,EAAKu0F,GAALn+G,MAAyBL,OAAO+vG,GAEhC9lF,EAAKu0F,GAALn+G,MAAyBH,QAAQ,CAAE6vG,cAGvCmG,EAAY+J,WAAWC,EAAgB73E,EAAGt6B,KAC5C,CAAE,MAAOoyG,GACPl2F,EAAKu0F,GAALn+G,MAAyBL,OAAOmgH,EAClC,CACA,OAAOl2F,EAAKu0F,GAALn+G,MAAyBgjC,UAGlCkvE,EAAe9uE,GAAG,aAAclb,IAAQ,IAAA63F,EAGhB,QAAtBA,EAAAlK,EAAY9W,kBAAU,IAAAghB,GAAtBA,EAAA1uG,KAAAwkG,EAAyB,CACvBp+C,OAAQvvC,EAAK7pB,OACbw/F,MAAO31E,EAAK7pB,SAGd2B,KAAK01G,uBAAuB71G,QAAQqoB,KAGtCgqF,EAAe9uE,GAAG,kBAAmBlb,IACnC,GAAIloB,KAAKgyG,UACP,OAGWpoF,EAAKo0F,GAALh+G,MAAgBV,IAAI4oB,EAAKuZ,WACjC+4E,iBAAiBtyF,EAAKo+D,aAAcp+D,EAAK8gE,YAGhDkpB,EAAe9uE,GAAG,YAAa48E,IAA8B,IAAAC,EAAA,IAA5BxmG,EAAIjZ,EAAM0/G,GAAaF,EACtD,GAAIhgH,KAAKgyG,UACP,OAAO,KAGT,GAAIhyG,KAAK0kF,WAAW9lF,IAAI6a,GACtB,OAAO,KAGT,OAAQjZ,GACN,IAAK,OACH,GAAI,UAAW0/G,EAAc,CAC3B,MAAMC,EAAgBD,EAAat5C,MACnC37D,GAAK,8BAADD,OAA+Bm1G,IACnCngH,KAAK0kF,WAAW7kF,QAAQ4Z,EAAI0mG,GAC5B,KACF,CAEA,MAAMC,EAAW,IAAItiD,GAASoiD,GACxBhnD,EACJl5D,KAAKu+G,QAAQxN,QAAkC,QAA5BkP,EAAI/uG,WAAWq6F,qBAAa,IAAA0U,GAAxBA,EAA0BxqE,QAC7C,CAAC4hB,EAAM9rD,IAAQ2F,WAAWq6F,cAAc8U,UAAUhpD,EAAM9rD,GACxD,KACA8rD,EAAO,IAAI2B,GACfonD,EACAlnD,EACAgnD,EAAa/mD,MACb+mD,EAAa9mD,sBAGfp5D,KAAKs+G,WACF/wF,KAAK8pC,GACLiR,MAAM,IAAM4pC,EAAejtC,gBAAgB,eAAgB,CAAExrD,QAC7DgyF,QAAQ,MACFp0C,EAAK8C,qBAAuB9C,EAAKnvC,MAMpCmvC,EAAK8D,YAEPn7D,KAAK0kF,WAAW7kF,QAAQ4Z,EAAI49C,KAEhC,MACF,IAAK,iBACH,MAAM,SAAEipD,GAAaJ,EACrB90G,GAAOk1G,EAAU,iCAEjB,IAAK,MAAMC,KAAa32F,EAAKo0F,GAALh+G,MAAgBq/B,SACtC,IAAK,MAAO,CAAEnX,KAASq4F,EAAUxmD,KAC/B,IAAQ,OAAJ7xC,QAAI,IAAJA,OAAI,EAAJA,EAAMksF,OAAQkM,EAGlB,OAAKp4F,EAAKs4F,SAGVxgH,KAAK0kF,WAAW7kF,QAAQ4Z,EAAI47C,gBAAgBntC,IACrCA,EAAKs4F,SAHH,KAMb,MACF,IAAK,WACL,IAAK,QACHxgH,KAAK0kF,WAAW7kF,QAAQ4Z,EAAIymG,GAC5B,MACF,IAAK,UACH,MAAMpoC,EAAU,IAAIlY,GAAYsgD,GAChClgH,KAAK0kF,WAAW7kF,QAAQ4Z,EAAIq+D,EAAQtW,SACpC,MACF,QACE,MAAM,IAAIr2D,MAAM,kCAADH,OAAmCxK,IAGtD,OAAO,OAGT0xG,EAAe9uE,GAAG,MAAOq9E,IAAsC,IAApChnG,EAAIgoB,EAAWjhC,EAAMkgH,GAAUD,EACxD,GAAIzgH,KAAKgyG,UAEP,OAGF,MAAMuO,EAAY32F,EAAKo0F,GAALh+G,MAAgBV,IAAImiC,GAKE,IAAAk/E,EAJxC,IAAIJ,EAAUxmD,KAAKn7D,IAAI6a,GAIvB,GAAqC,IAAjC8mG,EAAU9J,cAAchmF,KAK5B,OAAQjwB,GACN,IAAK,QACL,IAAK,UACH+/G,EAAUxmD,KAAKl6D,QAAQ4Z,EAAIinG,GAC3B,MACF,QACE,MAAM,IAAIv1G,MAAM,2BAADH,OAA4BxK,SAVpC,OAATkgH,QAAS,IAATA,GAAiB,QAARC,EAATD,EAAWluF,cAAM,IAAAmuF,GAAjBA,EAAmBntF,UAcvB0+E,EAAe9uE,GAAG,cAAelb,IAAQ,IAAA04F,EACnC5gH,KAAKgyG,WAGa,QAAtB4O,EAAA/K,EAAY9W,kBAAU,IAAA6hB,GAAtBA,EAAAvvG,KAAAwkG,EAAyB,CACvBp+C,OAAQvvC,EAAKuvC,OACbomC,MAAO31E,EAAK21E,UAIhBqU,EAAe9uE,GAAG,kBAAmB7lB,UAInC,GAAIvd,KAAKgyG,UACP,MAAM,IAAI7mG,MAAM,yBAElB,MAAMkzG,EAAUr+G,KAAKkoB,EAAK1nB,MAE1B,IAAK69G,EACH,MAAM,IAAIlzG,MAAM,GAADH,OACVkd,EAAK1nB,KAAI,0DAGhB,OAAO69G,EAAQzgG,MAAMsK,IAEzB,CAEA6Z,OAAAA,GACE,OAAO/hC,KAAKkyG,eAAejtC,gBAAgB,UAAW,KACxD,CAEAqwC,YAAAA,GAAe,IAAAuL,EAAAC,EACT9gH,KAAK2b,kBAAkB8U,MAAQ,GACjCxlB,GACE,kGAIJ,MAAM,IAAE4Y,EAAG,SAAE6uC,GAAa1yD,KAAK2b,kBAAkBi4C,aAEjD,OAAO5zD,KAAKkyG,eACTjtC,gBACC,eACA,CACE8uC,YAAa/zG,KAAKg0G,YAClBH,SAAU7zG,KAAK0/G,UACf/jG,kBAAmBkI,EACnBvC,SAAoC,QAA5Bu/F,EAAkB,QAAlBC,EAAE9gH,KAAK0+G,mBAAW,IAAAoC,OAAA,EAAhBA,EAAkBx/F,gBAAQ,IAAAu/F,EAAAA,EAAI,MAE1CnuD,GAED+4C,QAAQ,KACPzrG,KAAK2b,kBAAkB03C,iBAE7B,CAEAkiD,YAAAA,CAAaC,GACX,OAAOx1G,KAAKkyG,eAAejtC,gBAAgB,eAAgB,CAAEuwC,aAC/D,CAEAtB,OAAAA,CAAQnxE,GACN,IACGr4B,OAAOC,UAAUo4B,IAClBA,GAAc,GACdA,EAAa/iC,KAAK0/G,UAElB,OAAOhgH,QAAQC,OAAO,IAAIwL,MAAM,0BAGlC,MAAMs2B,EAAYsB,EAAa,EAC7Bg+E,EAAgBn3F,EAAKq0F,GAALj+G,MAAmBV,IAAImiC,GACzC,GAAIs/E,EACF,OAAOA,EAET,MAAM/9E,EAAUhjC,KAAKkyG,eAClBjtC,gBAAgB,UAAW,CAC1BxjC,cAED1hC,KAAKs2G,IACJ,GAAIr2G,KAAKgyG,UACP,MAAM,IAAI7mG,MAAM,uBAEdkrG,EAAS2K,QACXp3F,EAAKs0F,GAALl+G,MAAmBxB,IAAI63G,EAAS2K,OAAQj+E,GAG1C,MAAM+/B,EAAO,IAAIszC,GACf30E,EACA40E,EACAr2G,KACAA,KAAKu+G,QAAQxN,QAGf,OADAnnF,EAAKo0F,GAALh+G,MAAgBxB,IAAIijC,EAAWqhC,GACxBA,IAGX,OADAl5C,EAAKq0F,GAALj+G,MAAmBxB,IAAIijC,EAAWuB,GAC3BA,CACT,CAEAmxE,YAAAA,CAAaC,GACX,OAAK7xC,GAAW6xC,GAGTp0G,KAAKkyG,eAAejtC,gBAAgB,eAAgB,CACzDzC,IAAK4xC,EAAI5xC,IACTC,IAAK2xC,EAAI3xC,MAJF/iE,QAAQC,OAAO,IAAIwL,MAAM,8BAMpC,CAEAyrG,cAAAA,CAAen1E,EAAW7nB,GACxB,OAAO5Z,KAAKkyG,eAAejtC,gBAAgB,iBAAkB,CAC3DxjC,YACA7nB,UAEJ,CAEAm8F,eAAAA,GACE,OAAO72G,EAAAk/G,GAAAp+G,KAAKihH,IAAkB5vG,KAAvBrR,KAAwB,kBACjC,CAEAg2G,YAAAA,GACE,OAAO92G,EAAAk/G,GAAAp+G,KAAKihH,IAAkB5vG,KAAvBrR,KAAwB,eACjC,CAEAi2G,sBAAAA,GACE,OAAOj2G,KAAKkyG,eAAejtC,gBAAgB,yBAA0B,KACvE,CAEAovC,eAAAA,GACE,OAAOr0G,KAAKkyG,eAAejtC,gBAAgB,kBAAmB,KAChE,CAEAqvC,cAAAA,CAAe76F,GACb,MAAkB,kBAAPA,EACF/Z,QAAQC,OAAO,IAAIwL,MAAM,iCAE3BnL,KAAKkyG,eAAejtC,gBAAgB,iBAAkB,CAC3DxrD,MAEJ,CAEA86F,aAAAA,GACE,OAAOv0G,KAAKkyG,eAAejtC,gBAAgB,gBAAiB,KAC9D,CAEAuvC,aAAAA,GACE,OAAOx0G,KAAKkyG,eAAejtC,gBAAgB,gBAAiB,KAC9D,CAEAwvC,WAAAA,GACE,OAAOz0G,KAAKkyG,eAAejtC,gBAAgB,cAAe,KAC5D,CAEAyvC,oBAAAA,GACE,OAAO10G,KAAKkyG,eAAejtC,gBAAgB,uBAAwB,KACrE,CAEA0vC,aAAAA,GACE,OAAO30G,KAAKkyG,eAAejtC,gBAAgB,gBAAiB,KAC9D,CAEA2vC,cAAAA,GACE,OAAO50G,KAAKkyG,eAAejtC,gBAAgB,iBAAkB,KAC/D,CAEAn6B,oBAAAA,CAAqB3B,EAAO0rE,GAC1B,OAAO70G,KAAKkyG,eAAejtC,gBAAgB,uBAAwB,CACjE97B,QACA0rE,qBAEJ,CAEAE,eAAAA,GACE,OAAO71G,EAAAk/G,GAAAp+G,KAAKihH,IAAkB5vG,KAAvBrR,KAAwB,kBACjC,CAEA62G,gBAAAA,CAAiBp1E,GACf,OAAOzhC,KAAKkyG,eAAejtC,gBAAgB,mBAAoB,CAC7DxjC,aAEJ,CAEAy4E,aAAAA,CAAcz4E,GACZ,OAAOzhC,KAAKkyG,eAAejtC,gBAAgB,gBAAiB,CAC1DxjC,aAEJ,CAEAuzE,UAAAA,GACE,OAAOh1G,KAAKkyG,eAAejtC,gBAAgB,aAAc,KAC3D,CAEAgwC,wBAAAA,CAAyB7a,GACvB,OAAOl7F,EAAAk/G,GAAAp+G,KAAKihH,IAAkB5vG,KAAvBrR,KAAwB,4BAA4BD,KACzDmoB,GAAQ,IAAIgzE,GAAsBhzE,EAAMkyE,GAE5C,CAEA+a,cAAAA,GACE,OAAOn1G,KAAKkyG,eAAejtC,gBAAgB,iBAAkB,KAC/D,CAEAmwC,WAAAA,GACE,MAAM7nG,EAAO,cACXwzG,EAAgBn3F,EAAKm0F,GAAL/9G,MAAqBV,IAAIiO,GAC3C,GAAIwzG,EACF,OAAOA,EAET,MAAM/9E,EAAUhjC,KAAKkyG,eAClBjtC,gBAAgB13D,EAAM,MACtBxN,KAAKmhH,IAAO,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,MAAK,CAChBz2G,KAAMq2G,EAAQ,GACdtsC,SAAUssC,EAAQ,GAAK,IAAI3nB,GAAS2nB,EAAQ,IAAM,KAClDnkB,2BAAsD,QAA5BokB,EAAkB,QAAlBC,EAAEphH,KAAK0+G,mBAAW,IAAA0C,OAAA,EAAhBA,EAAkB9/F,gBAAQ,IAAA6/F,EAAAA,EAAI,KAC1D/gB,cAA8C,QAAjCihB,EAAkB,QAAlBC,EAAEthH,KAAK0+G,mBAAW,IAAA4C,OAAA,EAAhBA,EAAkBlhB,qBAAa,IAAAihB,EAAAA,EAAI,KAClDE,cAAeL,EAAQ,MAG3B,OADAt3F,EAAKm0F,GAAL/9G,MAAqBxB,IAAI+O,EAAMy1B,GACxBA,CACT,CAEAqyE,WAAAA,GACE,OAAOr1G,KAAKkyG,eAAejtC,gBAAgB,cAAe,KAC5D,CAEA,kBAAM2wC,GAAsC,IAAzBD,EAAex2G,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAChC,IAAIa,KAAKgyG,UAAT,OAGMhyG,KAAKkyG,eAAejtC,gBAAgB,UAAW,MAErD,IAAK,MAAMnC,KAAQl5C,EAAKo0F,GAALh+G,MAAgBq/B,SAAU,CAG3C,IAF0ByjC,EAAK0pC,UAG7B,MAAM,IAAIrhG,MAAM,sBAADH,OACS83D,EAAK//B,WAAU,4BAG3C,CACA/iC,KAAK0kF,WAAWplD,QACXq2E,GACH31G,KAAKs+G,WAAWh/E,QAElB1V,EAAKm0F,GAAL/9G,MAAqBs/B,QACrBt/B,KAAKk+B,cAAc/Q,SAAwB,GAC3Cg+E,GAAUqB,SAlBV,CAmBF,CAEAsJ,gBAAAA,CAAiB1B,GAAK,IAAAoN,EACpB,IAAKj/C,GAAW6xC,GACd,OAAO,KAET,MAAM4M,EAAqB,IAAZ5M,EAAI3xC,IAAY,GAAHz3D,OAAMopG,EAAI5xC,IAAG,QAAAx3D,OAASopG,EAAI5xC,IAAG,KAAAx3D,OAAIopG,EAAI3xC,KACjE,OAAqC,QAArC++C,EAAO53F,EAAKs0F,GAALl+G,MAAmBV,IAAI0hH,UAAO,IAAAQ,EAAAA,EAAI,IAC3C,EACF,SAAAP,GAlqBqB1zG,GAAmB,IAAb2a,EAAI/oB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC9B,MAAM4hH,EAAgBn3F,EAAKm0F,GAAL/9G,MAAqBV,IAAIiO,GAC/C,GAAIwzG,EACF,OAAOA,EAET,MAAM/9E,EAAUhjC,KAAKkyG,eAAejtC,gBAAgB13D,EAAM2a,GAG1D,OADA0B,EAAKm0F,GAAL/9G,MAAqBxB,IAAI+O,EAAMy1B,GACxBA,CACT,KAAAy+E,GAAA,IAAA9zF,QA8pBF,MAAM+zF,GAqBJl0G,WAAAA,CAAY+qG,GApBZt5G,EAAA,KAAAwiH,GAAsB,OAAI5iG,EAAAA,EAAAA,GAAA,kBAQb,OAAIA,EAAAA,EAAAA,GAAA,eAUP,MAGRqK,EAAKu4F,GAALzhH,KAA2Bu4G,EAQ7B,CAMA,WAAIv1E,GACF,OAAOpZ,EAAK63F,GAALzhH,MAAyBklE,WAAWliC,OAC7C,CASAwS,MAAAA,GAAuB,IAAhBz0B,EAAU5hB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAClByqB,EAAK63F,GAALzhH,MAAyBw1C,OAAqB,KAAMz0B,EACtD,CAMA,kBAAIi3F,GACF,MAAM,eAAEA,GAAmBpuF,EAAK63F,GAALzhH,MAAyBq8E,aACpD,IAAK27B,EACH,OAAO,EAET,MAAM,oBAAEpzB,GAAwBh7D,EAAK63F,GAALzhH,MAChC,OACEg4G,EAAe2J,MACd3J,EAAerlF,SAA6B,OAAnBiyD,QAAmB,IAAnBA,OAAmB,EAAnBA,EAAqBn0D,MAAO,CAE1D,EACF,IAAAmxF,GAAA,IAAAj0F,QAMA,MAAMorF,GAKJvrG,WAAAA,CAAWq0G,GAeR,IAfS,SACV5rF,EAAQ,OACRgY,EAAM,KACN8rB,EAAI,WACJ2qB,EAAU,oBACVE,EAAmB,aACnBvI,EAAY,UACZ56C,EAAS,cACTq+C,EAAa,cACb5hD,EAAa,yBACb86E,GAA2B,EAAK,OAChCjI,GAAS,EAAK,WACdt0E,EAAa,KAAI,UACjBgrC,GAAY,EAAK,iBACjBqf,EAAmB,MACpB+6B,EAnBD5iH,EAAA,KAAA2iH,GAAO,MAoBL5hH,KAAKi2B,SAAWA,EAChBj2B,KAAKiuC,OAASA,EACdjuC,KAAK+5D,KAAOA,EACZ/5D,KAAK0kF,WAAaA,EAClB1kF,KAAK4kF,oBAAsBA,EAC3B5kF,KAAK8hH,gBAAkB,KACvB9hH,KAAKq8E,aAAeA,EACpBr8E,KAAKs2G,WAAa70E,EAClBzhC,KAAK8/E,cAAgBA,EACrB9/E,KAAKk+B,cAAgBA,EACrBl+B,KAAKw2G,QAAUzF,EACf/wG,KAAKy8B,WAAaA,EAElBz8B,KAAK+hH,SAAU,EACf/hH,KAAKgiH,sBAAwB,KAC7BhiH,KAAKiiH,eAAgB,EACrBjiH,KAAKkiH,2BAC0B,IAA7BlJ,GAAuD,qBAAXlzF,OAC9C9lB,KAAKmiH,WAAY,EACjBniH,KAAKklE,WAAaxlE,QAAQujC,gBAC1BjjC,KAAKmvG,KAAO,IAAIuS,GAAW1hH,MAE3BA,KAAKoiH,aAAepiH,KAAKw1C,OAAOjoB,KAAKvtB,MACrCA,KAAKqiH,eAAiBriH,KAAKsiH,UAAU/0F,KAAKvtB,MAC1CA,KAAKuiH,mBAAqBviH,KAAKwiH,cAAcj1F,KAAKvtB,MAClDA,KAAKyiH,WAAaziH,KAAK0iH,MAAMn1F,KAAKvtB,MAClCA,KAAK2iH,QAAU10E,EAAOtb,OACtB3yB,KAAK4iH,eAAiB30E,EAAOtb,OAAS,KAAOsb,EAAOmpE,cACpDp3G,KAAK0nE,WAAaD,EAClBznE,KAAK01E,mBAAqBznC,EAAO+nC,kBACjCh2E,KAAK6iH,kBAAoB/7B,CAC3B,CAEA,aAAIwzB,GACF,OAAOt6G,KAAKklE,WAAWliC,QAAQslC,MAAM,WAGrC,EACF,CAEA8wC,kBAAAA,CAAkB0J,GAAkD,IAAAC,EAAAC,EAAA,IAAjD,aAAE18B,GAAe,EAAK,sBAAEzB,GAAuBi+B,EAChE,GAAI9iH,KAAKmiH,UACP,OAEF,GAAIniH,KAAK2iH,QAAS,CAChB,GAAuBM,GAAYrgG,EAAChkB,IAAIoB,KAAK2iH,SAC3C,MAAM,IAAIx3G,MACR,mJAKe83G,GAAYrgG,EAAC5jB,IAAIgB,KAAK2iH,QAC3C,CAEI3iH,KAAKw2G,SAAoC,QAA7BuM,EAAI7xG,WAAWknG,sBAAc,IAAA2K,GAAzBA,EAA2BttE,UAC7Cz1C,KAAK6mF,QAAU31E,WAAWknG,eAAet/F,OAAO9Y,KAAKs2G,YACrDt2G,KAAK6mF,QAAQq8B,KAAKljH,KAAKq8E,cACvBr8E,KAAK6mF,QAAQU,eAAiBvnF,KAAK6mF,QAAQs8B,qBAE7C,MAAM,SAAE9mG,EAAQ,UAAE/W,EAAS,WAAE06B,EAAU,kBAAEg2C,GAAsBh2E,KAAKiuC,OAI9DmpE,EACJp3G,KAAK4iH,gBACL5iH,KAAK2iH,QAAQnxF,WAAW,KAAM,CAC5B88E,OAAO,EACP78E,oBAAqBzxB,KAAK0nE,aAG9B1nE,KAAKy4G,IAAM,IAAIj0B,GACb4yB,EACAp3G,KAAK0kF,WACL1kF,KAAK+5D,KACL/5D,KAAK8/E,cACL9/E,KAAKk+B,cACL,CAAE2mD,yBACF7kF,KAAK4kF,oBACL5kF,KAAKy8B,WACLu5C,GAEFh2E,KAAKy4G,IAAIryB,aAAa,CACpB9gF,YACA+W,WACAiqE,eACAtmD,eAEFhgC,KAAK8hH,gBAAkB,EACvB9hH,KAAKiiH,eAAgB,EACK,QAA1Be,EAAAhjH,KAAKgiH,6BAAqB,IAAAgB,GAA1BA,EAAA3xG,KAAArR,KACF,CAEAw1C,MAAAA,GAAqC,IAAA4tE,EAAAC,EAAAC,EAAA,IAA9B18C,EAAKznE,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAAM4hB,EAAU5hB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAChCa,KAAK+hH,SAAU,EACf/hH,KAAKmiH,WAAY,EACT,QAARiB,EAAApjH,KAAKy4G,WAAG,IAAA2K,GAARA,EAAUtlC,aACNl0D,EAAKg4F,GAAL5hH,QACF8lB,OAAOy9F,qBAAqB35F,EAAKg4F,GAAL5hH,OAC5BkpB,EAAK04F,GAAL5hH,KAAY,OAEKijH,GAAYrgG,EAACyI,OAAOrrB,KAAK2iH,SAE5C/7C,IAAAA,EAAU,IAAI9lD,GAA4B,6BAAD9V,OACVhL,KAAKs2G,WAAa,GAC/Cv1F,IAEF/gB,KAAKi2B,SAAS2wC,GAEG,QAAjBy8C,GAAAC,EAAAtjH,KAAKmvG,MAAKvJ,eAAO,IAAAyd,GAAjBA,EAAAhyG,KAAAiyG,EAAoB18C,EACtB,CAEAyyC,mBAAAA,GAAsB,IAAAmK,EAAAC,EACfzjH,KAAKiiH,eAIgB,QAA1BuB,EAAAxjH,KAAKy4G,IAAIziC,yBAAiB,IAAAwtC,GAA1BA,EAA4BhyC,oBAC1BxxE,KAAKq8E,aAAa2K,QAAQ3oF,QAEhB,QAAZolH,EAAAzjH,KAAK6mF,eAAO,IAAA48B,GAAZA,EAAcC,mBAAmB1jH,KAAKq8E,cAElCr8E,KAAK+hH,SAGT/hH,KAAKsiH,aAXHtiH,KAAKgiH,wBAALhiH,KAAKgiH,sBAA0BhiH,KAAKqiH,eAYxC,CAEAC,SAAAA,GACEtiH,KAAK+hH,SAAU,EACX/hH,KAAKmiH,YAGLniH,KAAKmvG,KAAKwU,WACZ3jH,KAAKmvG,KAAKwU,WAAW3jH,KAAKuiH,oBAE1BviH,KAAKwiH,gBAET,CAEAA,aAAAA,GACMxiH,KAAKkiH,0BACPh5F,EAAK04F,GAAL5hH,KAAY8lB,OAAO89F,sBAAsB,KACvC16F,EAAK04F,GAAL5hH,KAAY,MACZA,KAAKyiH,aAAan6C,MAAMtoE,KAAKoiH,iBAG/B1iH,QAAQG,UAAUE,KAAKC,KAAKyiH,YAAYn6C,MAAMtoE,KAAKoiH,aAEvD,CAEA,WAAMM,GACA1iH,KAAKmiH,YAGTniH,KAAK8hH,gBAAkB9hH,KAAKy4G,IAAI56B,oBAC9B79E,KAAKq8E,aACLr8E,KAAK8hH,gBACL9hH,KAAKqiH,eACLriH,KAAK6mF,QACL7mF,KAAK6iH,mBAEH7iH,KAAK8hH,kBAAoB9hH,KAAKq8E,aAAa0K,UAAU1oF,SACvD2B,KAAK+hH,SAAU,EACX/hH,KAAKq8E,aAAa07B,YACpB/3G,KAAKy4G,IAAI36B,aACUmlC,GAAYrgG,EAACyI,OAAOrrB,KAAK2iH,SAE5C3iH,KAAKi2B,aAGX,EACF,IAAAgtF,GAAA,CAAArgG,EA9LwB,IAAImL,S,yKCxmG5B,MAAM81F,GAuBJ,2BAAWjpF,GACT,OAAO9tB,GACL9M,KACA,mBACA,IAAI81B,GAAgB,CAClB,CACE,CAAC,SAAU,cACX+tF,GAAY3jH,UAAU4jH,2BAExB,CAAC,CAAC,IAAK,SAAUD,GAAY3jH,UAAU6jH,0BACvC,CACE,CAAC,YAAa,aAAc,gBAAiB,kBAC7CF,GAAY3jH,UAAU8jH,aAExB,CACE,CAAC,UAAW,YAAa,cAAe,iBACxCH,GAAY3jH,UAAU+jH,iBAExB,CAAC,CAAC,OAAQ,YAAaJ,GAAY3jH,UAAUgkH,kBAC7C,CAAC,CAAC,MAAO,WAAYL,GAAY3jH,UAAUikH,cAGjD,CAEA32G,WAAAA,CAAW42G,GAAsC,IAAAC,EAAAC,EAAA,IAArC,OAAE97F,EAAS,KAAI,UAAEyF,EAAY,MAAMm2F,EAAAtlH,EAAA,KAAAylH,IA9C/CtlH,EAAA,KAAAulH,GAAU,MAEVvlH,EAAA,KAAAwlH,GAAgB,MAEhBxlH,EAAA,KAAAylH,QAAa,GAEbzlH,EAAA,KAAA0lH,GAAY,MAEZ1lH,EAAA,KAAA2lH,IAA2B,GAE3B3lH,EAAA,KAAA4lH,IAAqB,GAErB5lH,EAAA,KAAA6lH,GAAU,MAEV7lH,EAAA,KAAAq+B,QAAS,GAETr+B,EAAA,KAAA8lH,GAAkB,MAElB9lH,EAAA,KAAA+lH,GAAa,MA6BPx8F,GACFU,EAAK27F,GAAL7kH,MAA0B,GAC1BkpB,EAAK47F,GAAL9kH,KAAewoB,IAEfU,EAAK27F,GAAL7kH,MAA0B,GAE5BkpB,EAAK87F,GAALhlH,MAAwB,OAANwoB,QAAM,IAANA,OAAM,EAANA,EAAQqB,aAAcoE,GACxC/E,EAAKoU,GAALt9B,KAAiB4pB,EAAKo7F,GAALhlH,MAAgBs9B,WACjCpU,EAAKw7F,GAAL1kH,MACQ,OAANwoB,QAAM,IAANA,GAAa,QAAP67F,EAAN77F,EAAQ7E,aAAK,IAAA0gG,OAAA,EAAbA,EAAelkF,iBACA,QADamkF,EAC5B16F,EAAKo7F,GAALhlH,aAAe,IAAAskH,OAAA,EAAfA,EAAiB5nF,gBAAgB2C,SAASp/B,OAAOH,QACjD,WAEUmlH,GAAUriG,IAAVqiG,GAAUriG,EAAKtkB,OAAO8qB,OAAO,CACvC87F,KAAM,gCACNC,MAAO,iCACPC,KAAM,gCACNC,IAAK,+BACLC,OAAQ,oCAEZ,CAEAp5F,YAAAA,GACE,MAAMhB,EAAUhC,EAAKs7F,GAALxkH,KAAe+b,SAASC,cAAc,WACtDkP,EAAOxD,UAAY,cACnBwD,EAAOC,SAAW,IAClBD,EAAO9Q,aAAa,eAAgB,mCACpC8Q,EAAOkuB,aAAe,OAClBxvB,EAAKk7F,GAAL9kH,QACFkrB,EAAOmuB,aAAe,GAAHruC,OAAM4e,EAAKk7F,GAAL9kH,MAAayZ,GAAE,0BAE1C,MAAMkQ,EAASC,EAAKo7F,GAALhlH,MAAgB8pB,QAC/BoB,EAAOnR,iBAAiB,QAAS7a,EAAAqlH,GAAAvkH,KAAKulH,IAAch4F,KAAKvtB,MAAO,CAAE2pB,WAClEuB,EAAOnR,iBAAiB,UAAW7a,EAAAqlH,GAAAvkH,KAAKwlH,IAASj4F,KAAKvtB,MAAO,CAAE2pB,WAC/D,MAAM87F,EAAUv8F,EAAKu7F,GAALzkH,KAAqB+b,SAASC,cAAc,SAK5D,OAJAypG,EAAO/9F,UAAY,SACnB+9F,EAAOC,WAAa,OACpBD,EAAOpqG,MAAMi8B,gBAAkB1tB,EAAK86F,GAAL1kH,MAC/BkrB,EAAO9O,OAAOqpG,GACPv6F,CACT,CAEAy6F,kBAAAA,GACE,MAAMC,EAAY18F,EAAKy7F,GAAL3kH,KAAiBd,EAAAqlH,GAAAvkH,KAAK6lH,IAAgBx0G,KAArBrR,OAInC,OAHA4lH,EAASE,gBAAkB,aAC3BF,EAASG,eAAiB,4BAEnBH,CACT,CA+CA7B,wBAAAA,CAAyB/pG,GACvB,GAAIA,EAAME,SAAW0P,EAAK46F,GAALxkH,MAEnB,YADAd,EAAAqlH,GAAAvkH,KAAKulH,IAAal0G,KAAlBrR,KAAmBga,GAGrB,MAAM2J,EAAQ3J,EAAME,OAAOM,aAAa,cACnCmJ,GAGLzkB,EAAAqlH,GAAAvkH,KAAKgmH,IAAY30G,KAAjBrR,KAAkB2jB,EAAO3J,EAC3B,CAEAgqG,WAAAA,CAAYhqG,GAAO,IAAAisG,EAKkBC,EAJ9B9mH,EAAAmlH,GAAAvkH,KAAKmmH,IAINnsG,EAAME,SAAW0P,EAAK46F,GAALxkH,MAIG,QAAxBimH,EAAAjsG,EAAME,OAAOksG,mBAAW,IAAAH,GAAxBA,EAA0BjiF,QAHQ,QAAhCkiF,EAAAt8F,EAAK+6F,GAAL3kH,MAAe+nB,yBAAiB,IAAAm+F,GAAhCA,EAAkCliF,QAJlC9kC,EAAAqlH,GAAAvkH,KAAKulH,IAAal0G,KAAlBrR,KAAmBga,EAQvB,CAEAiqG,eAAAA,CAAgBjqG,GAAO,IAAAqsG,EAAAC,EAEnBtsG,EAAME,UAAyB,QAAnBmsG,EAAKz8F,EAAK+6F,GAAL3kH,aAAc,IAAAqmH,OAAA,EAAdA,EAAgBt+F,oBACjC/N,EAAME,SAAW0P,EAAK46F,GAALxkH,OAOdZ,EAAAmlH,GAAAvkH,KAAKmmH,KACRjnH,EAAAqlH,GAAAvkH,KAAKulH,IAAal0G,KAAlBrR,KAAmBga,GAEO,QAA5BssG,EAAAtsG,EAAME,OAAOqsG,uBAAe,IAAAD,GAA5BA,EAA8BtiF,SARxB5kC,EAAAmlH,GAAAvkH,KAAKmmH,KACPnmH,KAAK8jH,2BAQX,CAEAI,gBAAAA,CAAiBlqG,GAAO,IAAAwsG,EACjBpnH,EAAAmlH,GAAAvkH,KAAKmmH,IAIsB,QAAhCK,EAAA58F,EAAK+6F,GAAL3kH,MAAe+nB,yBAAiB,IAAAy+F,GAAhCA,EAAkCxiF,QAHhC9kC,EAAAqlH,GAAAvkH,KAAKulH,IAAal0G,KAAlBrR,KAAmBga,EAIvB,CAEAmqG,UAAAA,CAAWnqG,GAAO,IAAAysG,EACXrnH,EAAAmlH,GAAAvkH,KAAKmmH,IAIqB,QAA/BM,EAAA78F,EAAK+6F,GAAL3kH,MAAe8rD,wBAAgB,IAAA26D,GAA/BA,EAAiCziF,QAH/B9kC,EAAAqlH,GAAAvkH,KAAKulH,IAAal0G,KAAlBrR,KAAmBga,EAIvB,CAoCA0Q,YAAAA,GAAe,IAAAg8F,EAAAC,EACC,QAAdD,EAAA98F,EAAK+6F,GAAL3kH,aAAc,IAAA0mH,GAAdA,EAAgB1+F,UAAUhpB,IAAI,UAC9B4qB,EAAK46F,GAALxkH,MAAay4C,aAAe,QACR,QAApBkuE,EAAA/8F,EAAKm7F,GAAL/kH,aAAoB,IAAA2mH,GAApBA,EAAsBxnF,QACtBjW,EAAK67F,GAAL/kH,KAAuB,KACzB,CAMA8jH,yBAAAA,GAIgC,IAAA8C,EAH1Bh9F,EAAKi7F,GAAL7kH,QAGCZ,EAAAmlH,GAAAvkH,KAAKmmH,KAMVnmH,KAAK0qB,eACLd,EAAK46F,GAALxkH,MAAagkC,MAAM,CACjB2oB,eAAe,EACf/X,aAAchrB,EAAKg7F,GAAL5kH,SANF,QAAZ4mH,EAAAh9F,EAAKk7F,GAAL9kH,aAAY,IAAA4mH,GAAZA,EAAch7E,WAQlB,CAEAi7E,WAAAA,CAAYljG,GAIV,GAHIiG,EAAK66F,GAALzkH,QACF4pB,EAAK66F,GAALzkH,MAAmBqb,MAAMi8B,gBAAkB3zB,IAExCiG,EAAK+6F,GAAL3kH,MACH,OAGF,MAAM0O,EAAIkb,EAAKo7F,GAALhlH,MAAgB08B,gBAAgB2C,SAC1C,IAAK,MAAMhmB,KAASuQ,EAAK+6F,GAAL3kH,MAAeoZ,SACjCC,EAAMytG,aAAep4G,EAAEzO,OAAOH,QAAU6jB,EAAMwc,aAElD,CAEAhT,OAAAA,GAAU,IAAA45F,EAAAC,EACI,QAAZD,EAAAn9F,EAAK46F,GAALxkH,aAAY,IAAA+mH,GAAZA,EAAcj8F,SACd5B,EAAKs7F,GAALxkH,KAAe,MACfkpB,EAAKu7F,GAALzkH,KAAqB,MACP,QAAdgnH,EAAAp9F,EAAK+6F,GAAL3kH,aAAc,IAAAgnH,GAAdA,EAAgBl8F,SAChB5B,EAAKy7F,GAAL3kH,KAAiB,KACnB,EAzRe,SAAA6lH,KAmGb,MAAM1pG,EAAMJ,SAASC,cAAc,OAC7B2N,EAASC,EAAKo7F,GAALhlH,MAAgB8pB,QAC/B3N,EAAIpC,iBAAiB,cAAeqI,GAAe,CAAEuH,WACrDxN,EAAIuL,UAAY,WAChBvL,EAAI8qG,KAAO,UACX9qG,EAAI+qG,oBAAsB,QAC1B/qG,EAAI2pG,gBAAkB,WACtB3pG,EAAI/B,aAAa,eAAgB,qCAC7BwP,EAAKk7F,GAAL9kH,QACFmc,EAAI1C,GAAK,GAAHzO,OAAM4e,EAAKk7F,GAAL9kH,MAAayZ,GAAE,0BAE7B,IAAK,MAAOlM,EAAMoW,KAAUiG,EAAKo7F,GAALhlH,MAAgB08B,gBAAiB,CAC3D,MAAMxR,EAASnP,SAASC,cAAc,UACtCkP,EAAOC,SAAW,IAClBD,EAAO+7F,KAAO,SACd/7F,EAAO9Q,aAAa,aAAcuJ,GAClCuH,EAAO+B,MAAQ1f,EACf2d,EAAO9Q,aAAa,eAA4B6qG,GAAUriG,EAACrV,IAC3D,MAAMk4G,EAAS1pG,SAASC,cAAc,QACtCkP,EAAO9O,OAAOqpG,GACdA,EAAO/9F,UAAY,SACnB+9F,EAAOpqG,MAAMi8B,gBAAkB3zB,EAC/BuH,EAAO47F,aAAenjG,IAAUiG,EAAK86F,GAAL1kH,MAChCkrB,EAAOnR,iBAAiB,QAAS7a,EAAAqlH,GAAAvkH,KAAKgmH,IAAaz4F,KAAKvtB,KAAM2jB,GAAQ,CACpEgG,WAEFxN,EAAIC,OAAO8O,EACb,CAIA,OAFA/O,EAAIpC,iBAAiB,UAAW7a,EAAAqlH,GAAAvkH,KAAKwlH,IAASj4F,KAAKvtB,MAAO,CAAE2pB,WAErDxN,CACT,UAAA6pG,GAEariG,EAAO3J,GAClBA,EAAMuI,kBACNqH,EAAK0T,GAALt9B,MAAe0jC,SAAS,+BAAgC,CACtDC,OAAQ3jC,KACRQ,KAAMmB,EAA2BS,gBACjCtC,MAAO6jB,IAET3jB,KAAK6mH,YAAYljG,EACnB,UAAA6hG,GA0DSxrG,GACP6pG,EAAYjpF,iBAAiB7X,KAAK/iB,KAAMga,EAC1C,UAAAurG,GAEcvrG,GACZ,GAAI5a,EAAAmlH,GAAAvkH,KAAKmmH,IAEP,YADAnmH,KAAK0qB,eAaP,GAVAxB,EAAK07F,GAAL5kH,KAAiD,IAAjBga,EAAMmtG,QAEjCv9F,EAAKm7F,GAAL/kH,QACHkpB,EAAK67F,GAAL/kH,KAAuB,IAAIi9B,iBAE3BnX,OAAO/L,iBAAiB,cAAe7a,EAAAqlH,GAAAvkH,KAAKonH,IAAa75F,KAAKvtB,MAAO,CACnE2pB,OAAQC,EAAKo7F,GAALhlH,MAAgBw/B,eAAe5V,EAAKm7F,GAAL/kH,UAG3C4pB,EAAK46F,GAALxkH,MAAay4C,aAAe,OACxB7uB,EAAK+6F,GAAL3kH,MAEF,YADA4pB,EAAK+6F,GAAL3kH,MAAegoB,UAAU8C,OAAO,UAGlC,MAAMlP,EAAQsN,EAAKy7F,GAAL3kH,KAAiBd,EAAAqlH,GAAAvkH,KAAK6lH,IAAgBx0G,KAArBrR,OAC/B4pB,EAAK46F,GAALxkH,MAAaoc,OAAOR,EACtB,UAAAwrG,GAEaptG,GAAO,IAAAqtG,EACA,QAAlBA,EAAIz9F,EAAK+6F,GAAL3kH,aAAc,IAAAqnH,GAAdA,EAAgBtsF,SAAS/gB,EAAME,SAGnCla,KAAK0qB,cACP,UAAAy7F,GAAAmB,GAUE,OAAO19F,EAAK+6F,GAAS2C,KAAK19F,EAAK+6F,GAAS2C,GAACt/F,UAAU+S,SAAS,SAC9D,CAwCFwsF,EA1RM1D,GAkPJ,IAAAoB,GAAA,CAAAriG,EA7NoB,MAAI4kG,GAAA,IAAA75F,QAAA85F,GAAA,IAAA95F,QAAA+5F,GAAA,IAAA/5F,QA4Q1B,MAAMg6F,GASJn6G,WAAAA,CAAYgb,GARZvpB,EAAA,KAAAuoH,GAAS,MAETvoH,EAAA,KAAAwoH,GAAU,MAEVxoH,EAAA,KAAAyoH,GAAa,MAKXx+F,EAAKu+F,GAALznH,KAAewoB,GACfU,EAAKw+F,GAAL1nH,KAAkBwoB,EAAOqB,YAER+9F,GAAUhlG,IAAVglG,GAAUhlG,EAAKtkB,OAAO8qB,OAAO,CAC5CC,SAAU,4CACVE,IAAK,wCAET,CAEA2C,YAAAA,GACE,GAAItC,EAAK49F,GAALxnH,MACF,OAAO4pB,EAAK49F,GAALxnH,MAET,MAAM,WAAEirB,EAAU,UAAE48F,EAAS,MAAElkG,GAAUiG,EAAK69F,GAALznH,MACnC0iB,EAASwG,EAAKs+F,GAALxnH,KAAc+b,SAASC,cAAc,UAapD,OAZA0G,EAAMliB,KAAO,QACbkiB,EAAM5iB,MAAQ6jB,GAAS,UACvBjB,EAAMgF,UAAY,mBAClBhF,EAAMyI,SAAW,EACjBzI,EAAMtI,aAAa,eAAiCwtG,GAAUhlG,EAACqI,IAC/DvI,EAAM3I,iBACJ,QACA,KACE6P,EAAK89F,GAAL1nH,MAAgB89B,aAAa+pF,EAAWnlG,EAAM5iB,QAEhD,CAAE6pB,OAAQC,EAAK89F,GAAL1nH,MAAgB8pB,UAErBpH,CACT,CAEAvF,MAAAA,CAAOrd,GACA8pB,EAAK49F,GAALxnH,QAGL4pB,EAAK49F,GAALxnH,MAAYF,MAAQA,EACtB,CAEAqtB,OAAAA,GAAU,IAAA26F,EACG,QAAXA,EAAAl+F,EAAK49F,GAALxnH,aAAW,IAAA8nH,GAAXA,EAAah9F,SACb5B,EAAKs+F,GAALxnH,KAAc,KAChB,CAEA0qB,YAAAA,GAAgB,EAClB,IAAAk9F,GAAA,CAAAhlG,EA9CsB,MC1StB,SAASmlG,GAAc5pH,GACrB,OAAOyQ,KAAKiY,MAAoC,IAA9BjY,KAAKiG,IAAI,EAAGjG,KAAKC,IAAI,EAAG1Q,KACvCuT,SAAS,IACTC,SAAS,EAAG,IACjB,CAEA,SAASq2G,GAAclyG,GACrB,OAAOlH,KAAKiG,IAAI,EAAGjG,KAAKC,IAAI,IAAK,IAAMiH,GACzC,CAGA,MAAMmyG,GACJ,aAAOC,CAAMC,GAAe,IAAbj2G,EAAG6D,EAAGpD,EAAG05D,GAAE87C,EACxB,MAAO,CAAC,IAAK,EAAIv5G,KAAKC,IAAI,EAAG,GAAMqD,EAAI,IAAOS,EAAI,IAAOoD,EAAIs2D,GAC/D,CAEA,aAAO+7C,CAAMC,GAAM,IAAJv2G,GAAEu2G,EACf,MAAO,CAAC,OAAQ,EAAG,EAAG,EAAG,EAAIv2G,EAC/B,CAEA,YAAOw2G,CAAKC,GAAM,IAAJz2G,GAAEy2G,EACd,MAAO,CAAC,MAAOz2G,EAAGA,EAAGA,EACvB,CAEA,YAAO02G,CAAKC,GAAM,IAAJ32G,GAAE22G,EAEd,OADA32G,EAAIk2G,GAAcl2G,GACX,CAACA,EAAGA,EAAGA,EAChB,CAEA,aAAO42G,CAAMC,GAAM,IAAJ72G,GAAE62G,EACf,MAAMC,EAAIb,GAAcj2G,GACxB,MAAO,IAAP9G,OAAW49G,GAAC59G,OAAG49G,GAAC59G,OAAG49G,EACrB,CAEA,YAAOC,CAAKC,GAAY,IAAV1qH,EAAG0T,EAAGC,GAAE+2G,EACpB,MAAO,CAAC,IAAK,GAAM1qH,EAAI,IAAO0T,EAAI,IAAOC,EAC3C,CAEA,cAAOg3G,CAAQplG,GACb,OAAOA,EAAME,IAAImkG,GACnB,CAEA,eAAOgB,CAASrlG,GACd,MAAO,IAAP3Y,OAAW2Y,EAAME,IAAIkkG,IAAe94G,KAAK,IAC3C,CAEA,aAAOg6G,GACL,MAAO,WACT,CAEA,YAAOC,GACL,MAAO,CAAC,KACV,CAEA,eAAOC,CAAQC,GAAe,IAAbl3G,EAAG6D,EAAGpD,EAAG05D,GAAE+8C,EAC1B,MAAO,CACL,MACA,EAAIx6G,KAAKC,IAAI,EAAGqD,EAAIm6D,GACpB,EAAIz9D,KAAKC,IAAI,EAAG8D,EAAI05D,GACpB,EAAIz9D,KAAKC,IAAI,EAAGkH,EAAIs2D,GAExB,CAEA,eAAOg9C,CAAQC,GAAe,IAAbp3G,EAAG6D,EAAGpD,EAAG05D,GAAEi9C,EAC1B,MAAO,CACLtB,GAAc,EAAIp5G,KAAKC,IAAI,EAAGqD,EAAIm6D,IAClC27C,GAAc,EAAIp5G,KAAKC,IAAI,EAAG8D,EAAI05D,IAClC27C,GAAc,EAAIp5G,KAAKC,IAAI,EAAGkH,EAAIs2D,IAEtC,CAEA,gBAAOk9C,CAAUC,GACf,MAAM/iG,EAAMzmB,KAAKmpH,SAASK,GAAYn0G,MAAM,GAC5C,OAAOrV,KAAKgpH,SAASviG,EACvB,CAEA,eAAOgjG,CAAQC,GAAY,IAAVtrH,EAAG0T,EAAGC,GAAE23G,EACvB,MAAMx3G,EAAI,EAAI9T,EACRuU,EAAI,EAAIb,EACRiE,EAAI,EAAIhE,EAEd,MAAO,CAAC,OAAQG,EAAGS,EAAGoD,EADZnH,KAAKC,IAAIqD,EAAGS,EAAGoD,GAE3B,ECtFF,MAAM4zG,GAUJ7wG,MAAAA,CAAOkH,EAAOC,GAAgC,IAAxB2pG,EAAczqH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAClC,GAAI6gB,GAAS,GAAKC,GAAU,EAC1B,MAAM,IAAI9U,MAAM,0BAElB,MAAM4hE,EAAM/sE,KAAK6pH,WAAW,WAW5B,OAVA98C,EAAI3yD,aAAa,UAAW,OAEvBwvG,IACH78C,EAAI3yD,aAAa,QAAS,GAAFpP,OAAKgV,EAAK,OAClC+sD,EAAI3yD,aAAa,SAAU,GAAFpP,OAAKiV,EAAM,QAGtC8sD,EAAI3yD,aAAa,sBAAuB,QACxC2yD,EAAI3yD,aAAa,UAAW,OAAFpP,OAASgV,EAAK,KAAAhV,OAAIiV,IAErC8sD,CACT,CAEA/wD,aAAAA,CAAcxb,GACZ,GAAoB,kBAATA,EACT,MAAM,IAAI2K,MAAM,4BAElB,OAAOnL,KAAK6pH,WAAWrpH,EACzB,CAKAqpH,UAAAA,CAAWrpH,GACT0K,GAAY,uCACd,EAGF,MAAM4+G,WAAsBH,GAI1BE,UAAAA,CAAWrpH,GACT,OAAOub,SAASiB,gBAAgBK,GAAQ7c,EAC1C,EChBF,MACMupH,GAAuB,IAAIh8F,QAC3Bi8F,GAAmD,IAAjC,IAAIroG,MAAOsoG,oBAA2B,IAkB9D,MAAMC,GAKJ,aAAOpxG,CAAO4C,GAGZ,OAFgBA,EAAWwM,KAAKmiC,gBAG9B,KAAKtnD,GAAeE,KAClB,OAAO,IAAIknH,GAAsBzuG,GAEnC,KAAK3Y,GAAeC,KAClB,OAAO,IAAIonH,GAAsB1uG,GAEnC,KAAK3Y,GAAee,OAGlB,OAFkB4X,EAAWwM,KAAKmiG,WAGhC,IAAK,KACH,OAAO,IAAIC,GAA4B5uG,GACzC,IAAK,MACH,OAAIA,EAAWwM,KAAKqiG,YACX,IAAIC,GAAmC9uG,GACrCA,EAAWwM,KAAKuiG,SAClB,IAAIC,GAAgChvG,GAEtC,IAAIivG,GAAkCjvG,GAC/C,IAAK,KACH,OAAO,IAAIkvG,GAA8BlvG,GAC3C,IAAK,MACH,OAAO,IAAImvG,GAAiCnvG,GAEhD,OAAO,IAAIovG,GAAwBpvG,GAErC,KAAK3Y,GAAevB,MAClB,OAAO,IAAIupH,GAAuBrvG,GAEpC,KAAK3Y,GAAe3B,SAClB,OAAO,IAAI4pH,GAA0BtvG,GAEvC,KAAK3Y,GAAeG,KAClB,OAAO,IAAI+nH,GAAsBvvG,GAEnC,KAAK3Y,GAAeI,OAClB,OAAO,IAAI+nH,GAAwBxvG,GAErC,KAAK3Y,GAAeK,OAClB,OAAO,IAAI+nH,GAAwBzvG,GAErC,KAAK3Y,GAAeO,SAClB,OAAO,IAAI8nH,GAA0B1vG,GAEvC,KAAK3Y,GAAeW,MAClB,OAAO,IAAI2nH,GAAuB3vG,GAEpC,KAAK3Y,GAAexB,IAClB,OAAO,IAAI+pH,GAAqB5vG,GAElC,KAAK3Y,GAAeM,QAClB,OAAO,IAAIkoH,GAAyB7vG,GAEtC,KAAK3Y,GAAe1B,UAClB,OAAO,IAAImqH,GAA2B9vG,GAExC,KAAK3Y,GAAeQ,UAClB,OAAO,IAAIkoH,GAA2B/vG,GAExC,KAAK3Y,GAAeS,SAClB,OAAO,IAAIkoH,GAA0BhwG,GAEvC,KAAK3Y,GAAeU,UAClB,OAAO,IAAIkoH,GAA2BjwG,GAExC,KAAK3Y,GAAezB,MAClB,OAAO,IAAIsqH,GAAuBlwG,GAEpC,KAAK3Y,GAAeY,eAClB,OAAO,IAAIkoH,GAAgCnwG,GAE7C,QACE,OAAO,IAAIowG,GAAkBpwG,GAEnC,EACF,IAAAqwG,GAAA,IAAAp+F,QAAAq+F,GAAA,IAAAr+F,QAAAs+F,GAAA,IAAAt+F,QAAAu+F,GAAA,IAAAn+F,QAEA,MAAM+9F,GAOJt+G,WAAAA,CACEkO,GAMA,IALA,aACEywG,GAAe,EAAK,aACpBC,GAAe,EAAK,qBACpBC,GAAuB,GACxBltH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAACL,EAAA,KAAAotH,IAZRjtH,EAAA,KAAA8sH,GAAW,MAEX9sH,EAAA,KAAA+sH,IAAa,GAEb/sH,EAAA,KAAAgtH,GAAgB,MAUdjsH,KAAKmsH,aAAeA,EACpBnsH,KAAKkoB,KAAOxM,EAAWwM,KACvBloB,KAAKo/B,MAAQ1jB,EAAW0jB,MACxBp/B,KAAK+a,YAAcW,EAAWX,YAC9B/a,KAAKssH,gBAAkB5wG,EAAW4wG,gBAClCtsH,KAAKusH,mBAAqB7wG,EAAW6wG,mBACrCvsH,KAAKwsH,YAAc9wG,EAAW8wG,YAC9BxsH,KAAKysH,WAAa/wG,EAAW+wG,WAC7BzsH,KAAK2b,kBAAoBD,EAAWC,kBACpC3b,KAAK0sH,cAAgBhxG,EAAWgxG,cAChC1sH,KAAK2sH,gBAAkBjxG,EAAWixG,gBAClC3sH,KAAKg2G,aAAet6F,EAAWs6F,aAC/Bh2G,KAAK4sH,cAAgBlxG,EAAWmxG,aAChC7sH,KAAK2c,OAASjB,EAAWiB,OACzB3c,KAAK8sH,qBAAsB,EAEvBX,IACFnsH,KAAK+sH,eAAiB/sH,KAAKwnB,UACzBxnB,KAAKgtH,iBAAiBZ,IAEtBC,GACFrsH,KAAKitH,uBAET,CAEA,oBAAOC,CAAaC,GAA4B,IAA3B,YAAE3hF,EAAW,SAAEsN,GAAUq0E,EAC5C,SAAqB,OAAX3hF,QAAW,IAAXA,GAAAA,EAAar8B,KAAe,OAAR2pC,QAAQ,IAARA,GAAAA,EAAU3pC,IAC1C,CAEA,eAAIi+G,GACF,OAAOptH,KAAKkoB,KAAKmlG,UACnB,CAEA,gBAAIC,GACF,OACExB,GAAkBoB,cAAcltH,KAAKkoB,OACpCloB,KAAK0sH,iBAAmB1sH,KAAKutH,WAElC,CAEA,eAAIC,GAAc,IAAAC,EAChB,MAAM,KAAEvlG,GAASloB,KACXwoB,EAA+B,QAAzBilG,EAAGztH,KAAK2b,yBAAiB,IAAA8xG,OAAA,EAAtBA,EAAwB9gF,UAAUzkB,EAAKzO,IACtD,OAAI+O,EACKA,EAAOuZ,UAET7Z,CACT,CAEA,oBAAIwlG,GACF,OAAO1tH,KAAK0sH,eAAiB1sH,KAAK2tH,eACpC,CAEA,yBAAIv2E,GAAwB,IAAAw2E,EAC1B,MAAMplG,EAA+B,QAAzBolG,EAAG5tH,KAAK2b,yBAAiB,IAAAiyG,OAAA,EAAtBA,EAAwBjhF,UAAU3sC,KAAKkoB,KAAKzO,IAC3D,GAAI+O,EACF,OAAOA,EAAOyiC,4BAEhB,MAAM,WAAE4iE,EAAU,SAAEC,EAAQ,KAAEn6G,GAAS3T,KAAKkoB,KAC5C,IAAIi6C,GAAQ78C,IACR+8C,GAAQ/8C,IACZ,IAAc,OAAVuoG,QAAU,IAAVA,OAAU,EAAVA,EAAYxvH,SAAU,EAAG,CAC3B,IAAK,IAAIqQ,EAAI,EAAGA,EAAIm/G,EAAWxvH,OAAQqQ,GAAK,EACtCm/G,EAAWn/G,EAAI,GAAK2zD,GACtBA,EAAOwrD,EAAWn/G,EAAI,GACtByzD,EAAO0rD,EAAWn/G,EAAI,IACbm/G,EAAWn/G,EAAI,KAAO2zD,IAC/BF,EAAOvzD,KAAKiG,IAAIstD,EAAM0rD,EAAWn/G,EAAI,KAGzC,MAAO,CAACyzD,EAAME,EAChB,CACA,IAAY,OAARyrD,QAAQ,IAARA,OAAQ,EAARA,EAAUzvH,SAAU,EAAG,CACzB,IAAK,MAAM0vH,KAAWD,EACpB,IAAK,IAAIp/G,EAAI,EAAGuS,EAAK8sG,EAAQ1vH,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC5Cq/G,EAAQr/G,EAAI,GAAK2zD,GACnBA,EAAO0rD,EAAQr/G,EAAI,GACnByzD,EAAO4rD,EAAQr/G,IACNq/G,EAAQr/G,EAAI,KAAO2zD,IAC5BF,EAAOvzD,KAAKiG,IAAIstD,EAAM4rD,EAAQr/G,KAIpC,GAAIyzD,IAAS78C,IACX,MAAO,CAAC68C,EAAME,EAElB,CACA,OAAI1uD,EACK,CAACA,EAAK,GAAIA,EAAK,IAEjB,IACT,CAEAq6G,eAAAA,CAAgBp+D,GACd,MACEkT,MAAM,KAAEhH,GACRz/C,UACE6D,SAAS,UAAEE,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,KAEzCvgB,KAAK2c,OAIT,OAHAizC,EAAM,GAAKkM,EAAK,GAAKlM,EAAM,GAAKkM,EAAK,GACrClM,EAAM,GAAM,KAAOA,EAAM,GAAKtvC,GAAUF,EACxCwvC,EAAM,GAAM,KAAOA,EAAM,GAAKrvC,GAAUF,EACjCuvC,CACT,CAEA,eAAI29D,GAAc,IAAAU,EAAAC,EAChB,MAAM,KAAEhmG,GAASloB,KACjB,OAC2E,QAAzEiuH,EAAAjuH,KAAK2b,kBAAkBsqB,YAAY,GAADj7B,OAAI/J,GAAsB+J,OAAGkd,EAAKzO,YAAK,IAAAw0G,GAChE,QADgEA,EAAzEA,EACItmE,aAAK,IAAAsmE,OAAA,EADTA,EACWrmE,YACK,QADGsmE,EACnBhmG,EAAKsjB,mBAAW,IAAA0iF,OAAA,EAAhBA,EAAkB/+G,MAClB,EAEJ,CAEA,eAAIo+G,CAAYrvG,GACd,MAAM,KAAEgK,GAASloB,KACX2nD,EAAQ,CAAEtc,SAAUntB,EAAM0pC,SAAU1pC,GAAQ,IAC7Cle,KAAK2b,kBAAkBk5C,aAAa3sC,EAAKzO,GAAI,CAAEkuC,WAClD3nD,KAAK2b,kBAAkB1B,SAAS,GAADjP,OAAI/J,GAAsB+J,OAAGkd,EAAKzO,IAAM,CACrEA,GAAIyO,EAAKzO,GACT4wC,eAAgBniC,EAAKmiC,eACrB5oB,UAAWzhC,KAAK2c,OAAOmmD,KAAKwzC,WAC5B3uD,QACApc,SAAUrjB,EAAKqjB,SACfuU,iBAAkB,IAAIn+B,OAGrBzD,GACHle,KAAKmuH,aAET,CAEAA,WAAAA,GAAc,IAAAC,EAAAC,EAC4B,QAAxCD,GAAmB,QAAlBC,EAAAzkG,EAAKqiG,GAALjsH,aAAkB,IAAAquH,OAAA,EAAlBA,EAAoB1mE,QAAS3nD,KAAK2nD,aAAK,IAAAymE,GAAxCA,EAA2CtjG,SAC3C5B,EAAK+iG,GAALjsH,KAAqBA,KAAK2nD,MAAQ,KACpC,CAEAkG,YAAAA,CAAa5f,GAAQ,IAAAqgF,EACnB,IAAKtuH,KAAKwnB,UACR,OAGEymB,EAAOt6B,OACTiW,EAAKmiG,GAAL/rH,OAAAkpB,EAAK6iG,GAAL/rH,KAAkB,CAChB2T,KAAM3T,KAAKkoB,KAAKvU,KAAK0B,MAAM,MAI/B,MAAM,KAAE1B,EAAMg0C,MAAO4mE,GAAatgF,EAE9Bt6B,GACFzU,EAAAgtH,GAAAlsH,KAAKwuH,IAAcn9G,KAAnBrR,KAAoB2T,GAGtB,IAAIg0C,GAA0B,QAAlB2mE,EAAA1kG,EAAKqiG,GAALjsH,aAAkB,IAAAsuH,OAAA,EAAlBA,EAAoB3mE,QAAS3nD,KAAK2nD,OACzCA,GAAiB,OAAR4mE,QAAQ,IAARA,GAAAA,EAAUrwG,OACtBle,KAAKyuH,aAAaF,GAClB5mE,EAAQ/9B,EAAKqiG,GAALjsH,MAAmB2nD,OAExBA,IAGLA,EAAMkG,aAAa5f,GACP,OAARsgF,QAAQ,IAARA,GAAAA,EAAUljF,UACZsc,EAAM78B,SACN5B,EAAK+iG,GAALjsH,KAAqB,MACrBA,KAAK2nD,MAAQ,MAEjB,CAEA+mE,WAAAA,GAAc,IAAAC,EACP/kG,EAAKmiG,GAAL/rH,QAGLd,EAAAgtH,GAAAlsH,KAAKwuH,IAAcn9G,KAAnBrR,KAAoB4pB,EAAKmiG,GAAL/rH,MAAc2T,MAChB,QAAlBg7G,EAAA/kG,EAAKqiG,GAALjsH,aAAkB,IAAA2uH,GAAlBA,EAAoBhnE,MAAM+mE,cAC1BxlG,EAAK6iG,GAAL/rH,KAAgB,MAClB,CA+BAgtH,gBAAAA,CAAiBZ,GACf,MAAM,KACJlkG,EACAvL,QAAQ,KAAEmmD,EAAI,SAAEzmD,IACdrc,KAEEwnB,EAAYzL,SAASC,cAAc,WACzCwL,EAAUpN,aAAa,qBAAsB8N,EAAKzO,IAE9CzZ,gBAAgB8qH,IAChB9qH,gBAAgBmqH,KAElB3iG,EAAU2D,SAAW,GAEvB,MAAM,MAAE9P,GAAUmM,EAmBlB,GAZAnM,EAAM2mC,OAAShiD,KAAK2c,OAAOqlC,OAE3BhiD,KAAK2c,OAAOqlC,QAAU,EAElB95B,EAAK0mG,kBACPpnG,EAAUyF,MAAQ/E,EAAK0mG,iBAGrB1mG,EAAK2mG,UACPrnG,EAAUQ,UAAUhpB,IAAI,aAGrBkpB,EAAKvU,MAAQ3T,gBAAgB+qH,GAAwB,CACxD,MAAM,SAAE3rG,GAAa8I,EAIrB,OAHKA,EAAKmuE,cAA6B,IAAbj3E,GACxBpf,KAAK8uH,YAAY1vG,EAAUoI,GAEtBA,CACT,CACA,MAAM,MAAExH,EAAK,OAAEC,GAAWjgB,KAE1B,IAAKosH,GAAgBlkG,EAAK6mG,YAAY/uG,MAAQ,EAAG,CAC/C3E,EAAM2zG,YAAc,GAAHhkH,OAAMkd,EAAK6mG,YAAY/uG,MAAK,MAE7C,MAAMivG,EAAmB/mG,EAAK6mG,YAAYG,uBACpCC,EAAiBjnG,EAAK6mG,YAAYK,qBACxC,GAAIH,EAAmB,GAAKE,EAAiB,EAAG,CAC9C,MAAME,EAAS,QAAHrkH,OAAWikH,EAAgB,2CAAAjkH,OAA0CmkH,EAAc,mCAC/F9zG,EAAMi0G,aAAeD,CACvB,MAAO,GAAIrvH,gBAAgBwqH,GAAoC,CAC7D,MAAM6E,EAAS,QAAHrkH,OAAWgV,EAAK,2CAAAhV,OAA0CiV,EAAM,mCAC5E5E,EAAMi0G,aAAeD,CACvB,CAEA,OAAQnnG,EAAK6mG,YAAY1zG,OACvB,KAAKhX,GACHgX,EAAM0zG,YAAc,QACpB,MAEF,KAAK1qH,GACHgX,EAAM0zG,YAAc,SACpB,MAEF,KAAK1qH,GACH4G,GAAK,uCACL,MAEF,KAAK5G,GACH4G,GAAK,qCACL,MAEF,KAAK5G,GACHgX,EAAMk0G,kBAAoB,QAO9B,MAAMC,EAActnG,EAAKsnG,aAAe,KACpCA,GACFtmG,EAAK8iG,GAALhsH,MAAkB,GAClBqb,EAAMm0G,YAAc59G,GAAKC,aACN,EAAjB29G,EAAY,GACK,EAAjBA,EAAY,GACK,EAAjBA,EAAY,KAIdn0G,EAAM2zG,YAAc,CAExB,CAIA,MAAMr7G,EAAO/B,GAAKwD,cAAc,CAC9B8S,EAAKvU,KAAK,GACVmvD,EAAKhH,KAAK,GAAK5zC,EAAKvU,KAAK,GAAKmvD,EAAKhH,KAAK,GACxC5zC,EAAKvU,KAAK,GACVmvD,EAAKhH,KAAK,GAAK5zC,EAAKvU,KAAK,GAAKmvD,EAAKhH,KAAK,MAEpC,UAAE17C,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,GAAUlE,EAAS6D,QAEzD7E,EAAMooC,KAAO,GAAHz4C,OAAO,KAAO2I,EAAK,GAAK2M,GAAUF,EAAS,KACrD/E,EAAMkP,IAAM,GAAHvf,OAAO,KAAO2I,EAAK,GAAK4M,GAAUF,EAAU,KAErD,MAAM,SAAEjB,GAAa8I,EAQrB,OAPIA,EAAKmuE,cAA6B,IAAbj3E,GACvB/D,EAAM2E,MAAQ,GAAHhV,OAAO,IAAMgV,EAASI,EAAS,KAC1C/E,EAAM4E,OAAS,GAAHjV,OAAO,IAAMiV,EAAUI,EAAU,MAE7CrgB,KAAK8uH,YAAY1vG,EAAUoI,GAGtBA,CACT,CAEAsnG,WAAAA,CAAY3gE,GAAmC,IAA5B3mC,EAASroB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAKwnB,UAClC,IAAKxnB,KAAKkoB,KAAKvU,KACb,OAEF,MAAM,UAAEyM,EAAS,WAAEC,GAAergB,KAAK2c,OAAON,SAAS6D,QACvD,IAAI,MAAEF,EAAK,OAAEC,GAAWjgB,KAEpBmuD,EAAQ,MAAQ,KACjBnuC,EAAOC,GAAU,CAACA,EAAQD,IAE7BwH,EAAUnM,MAAM2E,MAAQ,GAAHhV,OAAO,IAAMgV,EAASI,EAAS,KACpDoH,EAAUnM,MAAM4E,OAAS,GAAHjV,OAAO,IAAMiV,EAAUI,EAAU,KAEvDmH,EAAUpN,aAAa,sBAAuB,IAAM+zC,GAAS,IAC/D,CAEA,kBAAIshE,GACF,MAAMC,EAAWA,CAACC,EAAQC,EAAW51G,KACnC,MAAM2J,EAAQ3J,EAAMmtG,OAAOwI,GACrB9H,EAAYlkG,EAAM,GAClBksG,EAAalsG,EAAMtO,MAAM,GAC/B2E,EAAME,OAAOmB,MAAMu0G,GACjB3H,GAAgB,GAADj9G,OAAI68G,EAAS,UAASgI,GACvC7vH,KAAK2b,kBAAkB1B,SAASja,KAAKkoB,KAAKzO,GAAI,CAC5C,CAACm2G,GAAY3H,GAAgB,GAADj9G,OAAI68G,EAAS,SAAQgI,MAIrD,OAAO/iH,GAAO9M,KAAM,iBAAkB,CACpC8vH,QAAS91G,IACP,MAAM,QAAE81G,GAAY91G,EAAMmtG,OAGpB/pG,EAAS0yG,EAAU,IAAM,EAC/B9vH,KAAKwnB,UAAUnM,MAAMyb,WAAa1Z,EAAS,SAAW,UACtDpd,KAAK2b,kBAAkB1B,SAASja,KAAKkoB,KAAKzO,GAAI,CAC5Cs2G,OAAQ3yG,EACR4yG,QAAqB,IAAZF,GAA6B,IAAZA,KAG9Bp8D,MAAO15C,IACLha,KAAK2b,kBAAkB1B,SAASja,KAAKkoB,KAAKzO,GAAI,CAC5Cu2G,SAAUh2G,EAAMmtG,OAAOzzD,SAG3Bt2C,OAAQpD,IACN,MAAM,OAAEoD,GAAWpD,EAAMmtG,OACzBnnH,KAAKwnB,UAAUnM,MAAMyb,WAAa1Z,EAAS,SAAW,UACtDpd,KAAK2b,kBAAkB1B,SAASja,KAAKkoB,KAAKzO,GAAI,CAC5Cu2G,QAAS5yG,EACT2yG,OAAQ3yG,KAGZ4mB,MAAOhqB,IACLgzB,WAAW,IAAMhzB,EAAME,OAAO8pB,MAAM,CAAE2oB,eAAe,IAAU,IAEjEsjE,SAAUj2G,IAERA,EAAME,OAAO+S,MAAQjT,EAAMmtG,OAAO8I,UAEpCC,SAAUl2G,IACRA,EAAME,OAAOw7B,SAAW17B,EAAMmtG,OAAO+I,UAEvCC,SAAUn2G,IACRha,KAAKowH,aAAap2G,EAAME,OAAQF,EAAMmtG,OAAOgJ,WAE/CvnD,QAAS5uD,IACP01G,EAAS,UAAW,kBAAmB11G,IAEzC2kE,UAAW3kE,IACT01G,EAAS,YAAa,kBAAmB11G,IAE3C2uD,QAAS3uD,IACP01G,EAAS,UAAW,QAAS11G,IAE/Bq2G,UAAWr2G,IACT01G,EAAS,YAAa,QAAS11G,IAEjCw1G,YAAax1G,IACX01G,EAAS,cAAe,cAAe11G,IAEzC4kE,YAAa5kE,IACX01G,EAAS,cAAe,cAAe11G,IAEzCoF,SAAUpF,IACR,MAAMm0C,EAAQn0C,EAAMmtG,OAAO/nG,SAC3Bpf,KAAK8uH,YAAY3gE,GACjBnuD,KAAK2b,kBAAkB1B,SAASja,KAAKkoB,KAAKzO,GAAI,CAC5C2F,SAAU+uC,MAIlB,CAEAmiE,yBAAAA,CAA0BC,EAASC,GACjC,MAAMC,EAAgBzwH,KAAKyvH,eAC3B,IAAK,MAAMliH,KAAQjP,OAAOmT,KAAK++G,EAAQrJ,QAAS,CAC9C,MAAMl7E,EAASskF,EAAQhjH,IAASkjH,EAAcljH,GACxC,OAAN0+B,QAAM,IAANA,GAAAA,EAASukF,EACX,CACF,CAEAE,2BAAAA,CAA4Bh3G,GAC1B,IAAK1Z,KAAK2sH,gBACR,OAIF,MAAM9yG,EAAa7Z,KAAK2b,kBAAkBsqB,YAAYjmC,KAAKkoB,KAAKzO,IAChE,IAAKI,EACH,OAGF,MAAM42G,EAAgBzwH,KAAKyvH,eAC3B,IAAK,MAAO5qD,EAAYsiD,KAAW7oH,OAAO6c,QAAQtB,GAAa,CAC7D,MAAMoyB,EAASwkF,EAAc5rD,GAC7B,GAAI54B,EAAQ,CAOVA,EANmB,CACjBk7E,OAAQ,CACN,CAACtiD,GAAasiD,GAEhBjtG,OAAQR,WAIHG,EAAWgrD,EACpB,CACF,CACF,CAQAooD,qBAAAA,GACE,IAAKjtH,KAAKwnB,UACR,OAEF,MAAM,WAAEqmG,GAAe7tH,KAAKkoB,KAC5B,IAAK2lG,EACH,OAGF,MAAO8C,EAASC,EAASC,EAASC,GAAW9wH,KAAKkoB,KAAKvU,KAAKkQ,IAAI/N,GAC9DlH,KAAKs1E,OAAOpuE,IAGd,GAA0B,IAAtB+3G,EAAWxvH,OAAc,CAC3B,MAAOqpD,EAAKH,EAAKC,EAAKC,GAAOomE,EAAW9+G,SAAS,EAAG,GACpD,GACE8hH,IAAYnpE,GACZopE,IAAYvpE,GACZopE,IAAYnpE,GACZopE,IAAYnpE,EAIZ,MAEJ,CAEA,MAAM,MAAEpsC,GAAUrb,KAAKwnB,UACvB,IAAIupG,EACJ,GAAInnG,EAAKoiG,GAALhsH,MAAiB,CACnB,MAAM,YAAEwvH,EAAW,YAAER,GAAgB3zG,EACrCA,EAAM2zG,YAAc,EACpB+B,EAAY,CACV,gCAA+B,4HAAA/lH,OAGEwkH,EAAW,oBAAAxkH,OAAmBgkH,EAAW,OAE5EhvH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,YAC/B,CAMA,MAAMghB,EAAQ6wG,EAAUF,EAClB1wG,EAAS6wG,EAAUF,GAEnB,WAAEnE,GAAezsH,KACjB+sE,EAAM0/C,EAAWzwG,cAAc,OACrC+wD,EAAI/kD,UAAUhpB,IAAI,2BAClB+tE,EAAI3yD,aAAa,QAAS,GAC1B2yD,EAAI3yD,aAAa,SAAU,GAC3B2yD,EAAIk6C,KAAO,OACX,MAAM+J,EAAOvE,EAAWzwG,cAAc,QACtC+wD,EAAI3wD,OAAO40G,GACX,MAAMC,EAAWxE,EAAWzwG,cAAc,YACpCvC,EAAK,YAAHzO,OAAehL,KAAKkoB,KAAKzO,IACjCw3G,EAAS72G,aAAa,KAAMX,GAC5Bw3G,EAAS72G,aAAa,gBAAiB,qBACvC42G,EAAK50G,OAAO60G,GAEZ,IAAK,IAAIviH,EAAI,EAAGuS,EAAK4sG,EAAWxvH,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,KAAAwiH,EACtD,MAAMxpE,EAAMmmE,EAAWn/G,GACjB64C,EAAMsmE,EAAWn/G,EAAI,GACrB84C,EAAMqmE,EAAWn/G,EAAI,GACrB+4C,EAAMomE,EAAWn/G,EAAI,GACrBiF,EAAO84G,EAAWzwG,cAAc,QAChClG,GAAK0xC,EAAMmpE,GAAW3wG,EACtBjK,GAAK+6G,EAAUvpE,GAAOtnC,EACtBkxG,GAAazpE,EAAMF,GAAOxnC,EAC1BoxG,GAAc7pE,EAAME,GAAOxnC,EACjCtM,EAAKyG,aAAa,IAAKtE,GACvBnC,EAAKyG,aAAa,IAAKrE,GACvBpC,EAAKyG,aAAa,QAAS+2G,GAC3Bx9G,EAAKyG,aAAa,SAAUg3G,GAC5BH,EAAS70G,OAAOzI,GACP,QAATu9G,EAAAH,SAAS,IAAAG,GAATA,EAAWliH,KAAK,+CAADhE,OACkC8K,EAAC,SAAA9K,OAAQ+K,EAAC,aAAA/K,OAAYmmH,EAAS,cAAAnmH,OAAaomH,EAAU,OAEzG,CAEIxnG,EAAKoiG,GAALhsH,QACF+wH,EAAU/hH,KAAK,gBACfqM,EAAMg2G,gBAAkBN,EAAU9hH,KAAK,KAGzCjP,KAAKwnB,UAAUpL,OAAO2wD,GACtB/sE,KAAKwnB,UAAUnM,MAAM41G,SAAW,QAAHjmH,OAAWyO,EAAE,IAC5C,CAYAg1G,YAAAA,GAA+B,IAAlB6C,EAASnyH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACvB,MAAM,KAAE+oB,GAASloB,KAEjB,IAAIwrC,EAAasU,EACbwxE,GACF9lF,EAAc,CACZr8B,IAAKmiH,EAAUpzG,MAEjB4hC,EAAmBwxE,EAAUv4E,OAE7BvN,EAActjB,EAAKsjB,YACnBsU,EAAmB53B,EAAK43B,kBAE1B52B,EAAK+iG,GAALjsH,KAAqB,IAAI+qH,GAAuB,CAC9C7iG,KAAM,CACJvE,MAAOuE,EAAKvE,MACZ4tG,SAAUrpG,EAAKqpG,SACfzxE,mBACAtU,cACAsN,SAAU5wB,EAAK4wB,SACf04E,WAAYtpG,EAAKvU,KACjBo7G,YAAa,EACbt1G,GAAI,SAAFzO,OAAWkd,EAAKzO,IAClB2F,SAAU8I,EAAK9I,SACfyvG,UAAU,GAEZ9zG,YAAa/a,KAAK+a,YAClB4B,OAAQ3c,KAAK2c,OACb80G,SAAU,CAACzxH,QAEf,CAEA,mBAAI2tH,GACF,SAAU/jG,EAAKqiG,GAALjsH,OAAsBA,KAAK2nD,OAAS3nD,KAAKkoB,KAAKqjB,SAC1D,CAEA,qBAAImmF,GACF,OAAO9nG,EAAKqiG,GAALjsH,KACT,CAQAyb,MAAAA,GACEvQ,GAAY,oDACd,CAMAymH,kBAAAA,CAAmBpkH,GAAqB,IAAfqkH,EAAMzyH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAChC,MAAM0yH,EAAS,GAEf,GAAI7xH,KAAK4sH,cAAe,CACtB,MAAMkF,EAAW9xH,KAAK4sH,cAAcr/G,GACpC,GAAIukH,EACF,IAAK,MAAM,KAAEhvD,EAAI,GAAErpD,EAAE,aAAEs4G,KAAkBD,EAAU,CACjD,IAAc,IAAVhvD,EACF,SAEF,GAAIrpD,IAAOm4G,EACT,SAEF,MAAMI,EACoB,kBAAjBD,EAA4BA,EAAe,KAE9CE,EAAal2G,SAAS+Q,cAAc,qBAAD9hB,OAClByO,EAAE,QAErBw4G,GAAelI,GAAqBnrH,IAAIqzH,GAI5CJ,EAAO7iH,KAAK,CAAEyK,KAAIu4G,cAAaC,eAH7BhnH,GAAK,6CAADD,OAA8CyO,GAItD,CAEF,OAAOo4G,CACT,CAGA,IAAK,MAAMI,KAAcl2G,SAASm2G,kBAAkB3kH,GAAO,CACzD,MAAM,YAAEykH,GAAgBC,EAClBx4G,EAAKw4G,EAAWz3G,aAAa,mBAC/Bf,IAAOm4G,IAGN7H,GAAqBnrH,IAAIqzH,IAG9BJ,EAAO7iH,KAAK,CAAEyK,KAAIu4G,cAAaC,eACjC,CACA,OAAOJ,CACT,CAEAlnG,IAAAA,GAAO,IAAAwnG,EACDnyH,KAAKwnB,YACPxnB,KAAKwnB,UAAUpK,QAAS,GAEhB,QAAV+0G,EAAAnyH,KAAK2nD,aAAK,IAAAwqE,GAAVA,EAAYC,WACd,CAEA5nG,IAAAA,GAAO,IAAA6nG,EACDryH,KAAKwnB,YACPxnB,KAAKwnB,UAAUpK,QAAS,GAEhB,QAAVi1G,EAAAryH,KAAK2nD,aAAK,IAAA0qE,GAAVA,EAAYC,WACd,CAUAC,yBAAAA,GACE,OAAOvyH,KAAKwnB,SACd,CAEAgrG,gBAAAA,GACE,MAAMC,EAAWzyH,KAAKuyH,4BACtB,GAAIhhH,MAAM02B,QAAQwqF,GAChB,IAAK,MAAM/4G,KAAW+4G,EACpB/4G,EAAQsO,UAAUhpB,IAAI,sBAGxByzH,EAASzqG,UAAUhpB,IAAI,gBAE3B,CAEA0zH,kBAAAA,GACE,IAAK1yH,KAAKotH,YACR,OAEF,MACEuF,qBAAsBnvF,EACtBtb,MAAQzO,GAAIuwB,IACVhqC,KACJA,KAAKwnB,UAAUzN,iBAAiB,WAAY,KAAM,IAAA64G,EACvB,QAAzBA,EAAA5yH,KAAK+a,YAAYwhB,gBAAQ,IAAAq2F,GAAzBA,EAA2BlvF,SAAS,6BAA8B,CAChEC,OAAQ3jC,KACRwjC,OACAwG,SACAE,qBAAqB,KAG3B,CAEA,SAAIlqB,GACF,OAAOhgB,KAAKkoB,KAAKvU,KAAK,GAAK3T,KAAKkoB,KAAKvU,KAAK,EAC5C,CAEA,UAAIsM,GACF,OAAOjgB,KAAKkoB,KAAKvU,KAAK,GAAK3T,KAAKkoB,KAAKvU,KAAK,EAC5C,EACF,SAAA66G,GAhiBiB76G,GACb,MACE6T,WAAW,MAAEnM,GACb6M,MAAQvU,KAAMk/G,EAAW,SAAEzzG,GAC3BzC,QACEN,UACE6D,SAAS,UAAEE,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,MAG3CvgB,KACO,OAAX6yH,QAAW,IAAXA,GAAAA,EAAar9F,OAAO,EAAG,KAAM7hB,GAC7B0H,EAAMooC,KAAO,GAAHz4C,OAAO,KAAO2I,EAAK,GAAK2M,GAAUF,EAAS,KACrD/E,EAAMkP,IAAM,GAAHvf,OAAO,KAAOqV,EAAa1M,EAAK,GAAK4M,GAAUF,EAAU,KACjD,IAAbjB,GACF/D,EAAM2E,MAAQ,GAAHhV,OAAO,KAAqB2I,EAAK,GAAKA,EAAK,IAAOyM,EAAS,KACtE/E,EAAM4E,OAAS,GAAHjV,OAAO,KAAsB2I,EAAK,GAAKA,EAAK,IAAO0M,EAAU,MAEzErgB,KAAK8uH,YAAY1vG,EAErB,CA+gBF,MAAM0zG,WAAgChH,GACpCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IACtDpsH,KAAKwoB,OAAS9M,EAAW8M,MAC3B,CAEA/M,MAAAA,GAEE,OADAzb,KAAKwnB,UAAUE,UAAY,mBACpB1nB,KAAKwnB,SACd,CAEAurG,mBAAAA,GACE,MAAM,OAAEvqG,GAAWxoB,KACdwoB,EAAO4iB,YAGZprC,KAAKyuH,aAAajmG,EAAOkD,QAC3B,CAEA,oBAAIgiG,GACF,OAAO1tH,KAAK0sH,eAAiB1sH,KAAKwoB,OAAO4iB,UAC3C,CAEA,yBAAIgM,GACF,OAAOp3C,KAAKwoB,OAAOyiC,2BACrB,CAEA,eAAIsiE,GACF,OAAOvtH,KAAKwoB,OAAOkD,QAAQxN,IAC7B,CAEA,eAAIqvG,CAAYrvG,GACdle,KAAKwoB,OAAOkD,QAAUxN,EACjBA,GACHle,KAAKmuH,aAET,CAEA,eAAIX,GACF,OAAOxtH,KAAKwoB,OAAOuZ,SACrB,CAEAjX,MAAAA,GACE9qB,KAAK2c,OAAOq2G,iBAAiBhzH,KAAKkoB,KAAKzO,IACvCzZ,KAAKwnB,UAAUsD,SACf9qB,KAAKwnB,UAAY,KACjBxnB,KAAKmuH,aACP,EACF,IAAA8E,GAAA,IAAAllG,QAEA,MAAMo8F,WAA8B2B,GAClCt+G,WAAAA,CAAYkO,GAA4B,IAAhBhQ,EAAOvM,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAChCwO,MAAM+N,EAAY,CAChBywG,cAAc,EACdC,eAAuB,OAAP1gH,QAAO,IAAPA,IAAAA,EAAS0gH,cACzBC,sBAAsB,IACtBvtH,EAAA,KAAAm0H,IACFjzH,KAAKkzH,cAAgBx3G,EAAWwM,KAAKgrG,aACvC,CAEAz3G,MAAAA,GACE,MAAM,KAAEyM,EAAI,YAAEnN,GAAgB/a,KACxBmzH,EAAOp3G,SAASC,cAAc,KACpCm3G,EAAK/4G,aAAa,kBAAmB8N,EAAKzO,IAC1C,IAAI25G,GAAU,EAkDd,OAhDIlrG,EAAK3c,KACPwP,EAAYO,kBAAkB63G,EAAMjrG,EAAK3c,IAAK2c,EAAK3M,WACnD63G,GAAU,GACDlrG,EAAK+jB,QACdjsC,KAAKqzH,iBAAiBF,EAAMjrG,EAAK+jB,OAAQ/jB,EAAKorG,cAC9CF,GAAU,GACDlrG,EAAKqrG,YACdr0H,EAAA+zH,GAAAjzH,KAAKwzH,IAAeniH,KAApBrR,KACEmzH,EACAjrG,EAAKqrG,WACLrrG,EAAKorG,aACLprG,EAAKurG,gBAEPL,GAAU,GACDlrG,EAAK+zE,aACd/8F,EAAA+zH,GAAAjzH,KAAK0zH,IAAgBriH,KAArBrR,KAAsBmzH,EAAMjrG,EAAK+zE,YAAa/zE,EAAKorG,cACnDF,GAAU,GACDlrG,EAAK26C,MACd7iE,KAAK2zH,UAAUR,EAAMjrG,EAAK26C,KAAM36C,EAAKorG,cACrCF,GAAU,IAGRlrG,EAAKqoG,UACJroG,EAAKqoG,QAAQqD,QACZ1rG,EAAKqoG,QAAQ,aACbroG,EAAKqoG,QAAQ,gBACfvwH,KAAK2sH,iBACL3sH,KAAKg2G,eAELh2G,KAAK6zH,cAAcV,EAAMjrG,GACzBkrG,GAAU,GAGRlrG,EAAK4rG,WACP9zH,KAAK+zH,qBAAqBZ,EAAMjrG,EAAK4rG,WACrCV,GAAU,GACDpzH,KAAKkzH,gBAAkBE,IAChCpzH,KAAK2zH,UAAUR,EAAM,IACrBC,GAAU,IAIdpzH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,kBACzBo0H,IACFpzH,KAAK+sH,eAAiBoG,EACtBnzH,KAAKwnB,UAAUpL,OAAO+2G,IAGjBnzH,KAAKwnB,SACd,CAeAmsG,SAAAA,CAAUR,EAAMa,GAAgC,IAAnBV,EAAYn0H,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAC1Cg0H,EAAKvmH,KAAO5M,KAAK+a,YAAYk5G,mBAAmBD,GAChDb,EAAKe,QAAU,KACTF,GACFh0H,KAAK+a,YAAYo5G,gBAAgBH,IAE5B,IAELA,GAAqD,KAAtCA,IACjB90H,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,MAEEszH,IACFH,EAAKlmG,MAAQqmG,EAEjB,CAWAD,gBAAAA,CAAiBF,EAAMlnF,GAA2B,IAAnBqnF,EAAYn0H,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAC5Cg0H,EAAKvmH,KAAO5M,KAAK+a,YAAYs5G,aAAa,IAC1ClB,EAAKe,QAAU,KACbl0H,KAAK+a,YAAYu5G,mBAAmBroF,IAC7B,GAELqnF,IACFH,EAAKlmG,MAAQqmG,GAEfp0H,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,KACF,CAqDA6zH,aAAAA,CAAcV,EAAMjrG,GAClBirG,EAAKvmH,KAAO5M,KAAK+a,YAAYs5G,aAAa,IAC1C,MAAMxwG,EAAM,IAAIwD,IAAI,CAClB,CAAC,SAAU,WACX,CAAC,WAAY,aACb,CAAC,aAAc,iBAEjB,IAAK,MAAM9Z,KAAQjP,OAAOmT,KAAKyW,EAAKqoG,SAAU,CAC5C,MAAMZ,EAAS9rG,EAAIvkB,IAAIiO,GAClBoiH,IAGLwD,EAAKxD,GAAU,KAAM,IAAA4E,EAQnB,OAPyB,QAAzBA,EAAAv0H,KAAK+a,YAAYwhB,gBAAQ,IAAAg4F,GAAzBA,EAA2B7wF,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,GAAIyO,EAAKzO,GACTlM,WAGG,GAEX,CACI2a,EAAKorG,eACPH,EAAKlmG,MAAQ/E,EAAKorG,cAGfH,EAAKe,UACRf,EAAKe,QAAU,KAAM,GAEvBh1H,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,KACF,CAEA+zH,oBAAAA,CAAqBZ,EAAMW,GACzB,MAAMU,EAAmBrB,EAAKe,QAM9B,GALKM,IACHrB,EAAKvmH,KAAO5M,KAAK+a,YAAYs5G,aAAa,KAE5Cn1H,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,OAEKA,KAAK4sH,cAQR,OAPA3hH,GACE,uHAGGupH,IACHrB,EAAKe,QAAU,KAAM,IAKzBf,EAAKe,QAAU,KACG,OAAhBM,QAAgB,IAAhBA,GAAAA,IAEA,MACE3C,OAAQ4C,EACRC,KAAMC,EAAa,QACnBC,GACEd,EAEEe,EAAY,GAClB,GAA+B,IAA3BJ,EAAgBp2H,QAAyC,IAAzBs2H,EAAct2H,OAAc,CAC9D,MAAMy2H,EAAW,IAAItlG,IAAImlG,GACzB,IAAK,MAAMI,KAAaN,EAAiB,CACvC,MAAM5C,EAAS7xH,KAAK4sH,cAAcmI,IAAc,GAChD,IAAK,MAAM,GAAEt7G,KAAQo4G,EACnBiD,EAAS91H,IAAIya,EAEjB,CACA,IAAK,MAAMo4G,KAAUvzH,OAAO+gC,OAAOr/B,KAAK4sH,eACtC,IAAK,MAAMoI,KAASnD,EACdiD,EAASl2H,IAAIo2H,EAAMv7G,MAAQm7G,GAC7BC,EAAU7lH,KAAKgmH,EAIvB,MACE,IAAK,MAAMnD,KAAUvzH,OAAO+gC,OAAOr/B,KAAK4sH,eACtCiI,EAAU7lH,QAAQ6iH,GAItB,MAAMl4G,EAAU3Z,KAAK2b,kBACfs5G,EAAS,GACf,IAAK,MAAMD,KAASH,EAAW,CAC7B,MAAM,GAAEp7G,GAAOu7G,EAEf,OADAC,EAAOjmH,KAAKyK,GACJu7G,EAAMx0H,MACZ,IAAK,OAAQ,CACX,MAAMV,EAAQk1H,EAAM5hE,cAAgB,GACpCz5C,EAAQM,SAASR,EAAI,CAAE3Z,UACvB,KACF,CACA,IAAK,WACL,IAAK,cAAe,CAClB,MAAMA,EAAQk1H,EAAM5hE,eAAiB4hE,EAAMjD,aAC3Cp4G,EAAQM,SAASR,EAAI,CAAE3Z,UACvB,KACF,CACA,IAAK,WACL,IAAK,UAAW,CACd,MAAMA,EAAQk1H,EAAM5hE,cAAgB,GACpCz5C,EAAQM,SAASR,EAAI,CAAE3Z,UACvB,KACF,CACA,QACE,SAGJ,MAAMmyH,EAAal2G,SAAS+Q,cAAc,qBAAD9hB,OAAsByO,EAAE,OAC5Dw4G,IAEOlI,GAAqBnrH,IAAIqzH,GAIrCA,EAAWiD,cAAc,IAAIC,MAAM,cAHjClqH,GAAK,+CAADD,OAAgDyO,IAIxD,CAE0B,IAAA27G,EAAtBp1H,KAAK2sH,kBAEkB,QAAzByI,EAAAp1H,KAAK+a,YAAYwhB,gBAAQ,IAAA64F,GAAzBA,EAA2B1xF,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,GAAI,MACJw7C,IAAKggE,EACL1nH,KAAM,gBAKZ,OAAO,EAEX,EACF,SAAA6mH,KA1OIp0H,KAAKwnB,UAAUpN,aAAa,qBAAsB,GACpD,UAAAo5G,GAuDgBL,EAAMI,GAA4C,IAAhCD,EAAYn0H,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAAI0jE,EAAI1jE,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAC1Dg0H,EAAKvmH,KAAO5M,KAAK+a,YAAYs5G,aAAa,IACtCd,EAAWvmG,YACbmmG,EAAKlmG,MAAQsmG,EAAWvmG,YACfsmG,IACTH,EAAKlmG,MAAQqmG,GAEfH,EAAKe,QAAU,KAAM,IAAAmB,EAMnB,OALoB,QAApBA,EAAAr1H,KAAKssH,uBAAe,IAAA+I,GAApBA,EAAsBC,mBACpB/B,EAAWxlE,QACXwlE,EAAWjyG,SACXuhD,IAEK,GAET3jE,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,KACF,UAAA0zH,GAQiBP,EAAMlnF,GAA2B,IAAnBqnF,EAAYn0H,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,GAC5Cg0H,EAAKvmH,KAAO5M,KAAK+a,YAAYs5G,aAAa,IAC1ClB,EAAKe,QAAU,KACbl0H,KAAK+a,YAAYw6G,mBAAmBtpF,IAC7B,GAELqnF,IACFH,EAAKlmG,MAAQqmG,GAEfp0H,EAAA+zH,GAAAjzH,KAAKo0H,IAAgB/iH,KAArBrR,KACF,CAkJF,MAAMoqH,WAA8B0B,GAClCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,GACpC,CAEA1wG,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,kBAE7B,MAAM0yB,EAAQ3V,SAASC,cAAc,OAkBrC,OAjBA0V,EAAME,IACJ5xB,KAAKusH,mBACL,cACAvsH,KAAKkoB,KAAK3a,KAAK6T,cACf,OACFsQ,EAAMtX,aAAa,eAAgB,8BACnCsX,EAAMtX,aACJ,iBACAisB,KAAKC,UAAU,CAAE9lC,KAAMR,KAAKkoB,KAAK3a,SAG9BvN,KAAKkoB,KAAKqjB,UAAYvrC,KAAKstH,eAC9BttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUpL,OAAOsV,GACf1xB,KAAKwnB,SACd,EAGF,MAAMsjG,WAAgCgB,GACpCrwG,MAAAA,GAEE,OAAOzb,KAAKwnB,SACd,CAEAguG,wBAAAA,CAAyB97G,GACK,IAAA+7G,EAAxBz1H,KAAKkoB,KAAKmuE,eAC8B,YAAf,QAAvBo/B,EAAA/7G,EAAQ6sG,uBAAe,IAAAkP,OAAA,EAAvBA,EAAyBpoE,YAC3B3zC,EAAQ6sG,gBAAgBnpG,QAAS,GAEnC1D,EAAQ0D,QAAS,EAErB,CAEAs4G,eAAAA,CAAgB17G,GACd,OAAO1K,GAAYgB,SAASM,MAAQoJ,EAAMyc,QAAUzc,EAAMwc,OAC5D,CAEAm/F,iBAAAA,CAAkBj8G,EAASk8G,EAAaC,EAAUC,EAAWC,GACvDF,EAASnlH,SAAS,SAEpBgJ,EAAQK,iBAAiB87G,EAAU77G,IAAS,IAAAg8G,EACjB,QAAzBA,EAAAh2H,KAAK+a,YAAYwhB,gBAAQ,IAAAy5F,GAAzBA,EAA2BtyF,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,GAAIzZ,KAAKkoB,KAAKzO,GACdlM,KAAMuoH,EACNh2H,MAAOi2H,EAAY/7G,GACnBk+C,MAAOl+C,EAAM0c,SACbu/F,SAAUj2H,KAAK01H,gBAAgB17G,QAMrCN,EAAQK,iBAAiB87G,EAAU77G,IAAS,IAAAk8G,EAC1C,GAAiB,SAAbL,EAAqB,CACvB,IAAKD,EAAYO,UAAYn8G,EAAMwoC,cACjC,OAEFozE,EAAYO,SAAU,CACxB,MAAO,GAAiB,UAAbN,EAAsB,CAC/B,GAAID,EAAYO,QACd,OAEFP,EAAYO,SAAU,CACxB,CAEKJ,IAIoB,QAAzBG,EAAAl2H,KAAK+a,YAAYwhB,gBAAQ,IAAA25F,GAAzBA,EAA2BxyF,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,GAAIzZ,KAAKkoB,KAAKzO,GACdlM,KAAMuoH,EACNh2H,MAAOi2H,EAAY/7G,QAK7B,CAEAo8G,kBAAAA,CAAmB18G,EAASk8G,EAAazmG,EAAOknG,GAC9C,IAAK,MAAOR,EAAUC,KAAc3mG,EAAO,KAAAmnG,EACqBC,EAAAC,EAA9D,GAAkB,WAAdV,GAA2C,QAArBQ,EAAIt2H,KAAKkoB,KAAKqoG,eAAO,IAAA+F,GAAjBA,EAAoBR,GAC9B,UAAdA,GAAuC,SAAdA,GAC3BF,IAAAA,EAAgB,CAAEO,SAAS,IAE7Bn2H,KAAK21H,kBACHj8G,EACAk8G,EACAC,EACAC,EACAO,GAEgB,UAAdP,GAA2C,QAAlBS,EAACv2H,KAAKkoB,KAAKqoG,eAAO,IAAAgG,GAAjBA,EAAmBE,KAGxB,SAAdX,GAA0C,QAAlBU,EAACx2H,KAAKkoB,KAAKqoG,eAAO,IAAAiG,GAAjBA,EAAmBE,OACrD12H,KAAK21H,kBAAkBj8G,EAASk8G,EAAa,QAAS,QAAS,MAF/D51H,KAAK21H,kBAAkBj8G,EAASk8G,EAAa,OAAQ,OAAQ,KAKnE,CACF,CAEAe,mBAAAA,CAAoBj9G,GAClB,MAAMiK,EAAQ3jB,KAAKkoB,KAAKovB,iBAAmB,KAC3C59B,EAAQ2B,MAAMi8B,gBACF,OAAV3zB,EACI,cACA/R,GAAKC,aAAa8R,EAAM,GAAIA,EAAM,GAAIA,EAAM,GACpD,CASAizG,aAAAA,CAAcl9G,GACZ,MAAMm9G,EAAiB,CAAC,OAAQ,SAAU,UACpC,UAAEC,GAAc92H,KAAKkoB,KAAK6uG,sBAC1BvnC,EACJxvF,KAAKkoB,KAAK6uG,sBAAsBvnC,UA3zCZ,EA6zChBn0E,EAAQ3B,EAAQ2B,MAWtB,IAAI27G,EACJ,MACMC,EAAoBnhH,GAAKlH,KAAK21C,MAAM,GAAKzuC,GAAK,GACpD,GAAI9V,KAAKkoB,KAAKgvG,UAAW,CACvB,MAAMj3G,EAASrR,KAAKmI,IAClB/W,KAAKkoB,KAAKvU,KAAK,GAAK3T,KAAKkoB,KAAKvU,KAAK,GAJnB,GAOZ86F,EAAaxuF,GADGrR,KAAK21C,MAAMtkC,GAAUvf,EAAc8uF,KAAc,GAEvEwnC,EAAmBpoH,KAAKC,IACtB2gF,EACAynC,EAAkBxoB,EAAa/tG,GAEnC,KAAO,CACL,MAAMuf,EAASrR,KAAKmI,IAClB/W,KAAKkoB,KAAKvU,KAAK,GAAK3T,KAAKkoB,KAAKvU,KAAK,GAdnB,GAgBlBqjH,EAAmBpoH,KAAKC,IACtB2gF,EACAynC,EAAkBh3G,EAASvf,GAE/B,CACA2a,EAAMm0E,SAAW,QAAHxkF,OAAWgsH,EAAgB,mCAEzC37G,EAAMsI,MAAQ/R,GAAKC,aAAailH,EAAU,GAAIA,EAAU,GAAIA,EAAU,IAEtC,OAA5B92H,KAAKkoB,KAAKivG,gBACZ97G,EAAM+7G,UAAYP,EAAe72H,KAAKkoB,KAAKivG,eAE/C,CAEA/G,YAAAA,CAAa12G,EAAS29G,GAChBA,EACF39G,EAAQU,aAAa,YAAY,GAEjCV,EAAQY,gBAAgB,YAE1BZ,EAAQU,aAAa,gBAAiBi9G,EACxC,EAGF,MAAM/M,WAAoCQ,GACxCt9G,WAAAA,CAAYkO,GAKV/N,MAAM+N,EAAY,CAAEywG,aAHlBzwG,EAAW8wG,aACX9wG,EAAWwM,KAAKmuE,eACd36E,EAAWwM,KAAKovG,iBAAmB57G,EAAWwM,KAAKqvG,YAEzD,CAEAC,qBAAAA,CAAsB/Z,EAAMviG,EAAKpb,EAAO23H,GACtC,MAAM99G,EAAU3Z,KAAK2b,kBACrB,IAAK,MAAMjC,KAAW1Z,KAAK2xH,mBACzBlU,EAAKlwG,KACUkwG,EAAKhkG,IAEhBC,EAAQu4G,aACVv4G,EAAQu4G,WAAW/2G,GAAOpb,GAE5B6Z,EAAQM,SAASP,EAAQD,GAAI,CAAE,CAACg+G,GAAe33H,GAEnD,CAEA2b,MAAAA,GACE,MAAM9B,EAAU3Z,KAAK2b,kBACflC,EAAKzZ,KAAKkoB,KAAKzO,GAErBzZ,KAAKwnB,UAAUQ,UAAUhpB,IAAI,wBAE7B,IAAI0a,EAAU,KACd,GAAI1Z,KAAKwsH,YAAa,KAAAkL,EAIpB,MAAM79G,EAAaF,EAAQG,SAASL,EAAI,CACtC3Z,MAAOE,KAAKkoB,KAAKqvG,aAEnB,IAAI7+G,EAAcmB,EAAW/Z,OAAS,GACtC,MAAM63H,EAASh+G,EAAQG,SAASL,EAAI,CAClCm+G,UAAW53H,KAAKkoB,KAAKyvG,SACpBC,UACCD,GAAUj/G,EAAYra,OAASs5H,IACjCj/G,EAAcA,EAAYrD,MAAM,EAAGsiH,IAGrC,IAAIE,EACFh+G,EAAWi+G,iBAAuC,QAAzBJ,EAAI13H,KAAKkoB,KAAKxP,mBAAW,IAAAg/G,OAAA,EAArBA,EAAuBzoH,KAAK,QAAS,KAChE4oH,GAAwB73H,KAAKkoB,KAAK6vG,OACpCF,EAAuBA,EAAqB90B,WAAW,OAAQ,KAGjE,MAAM6yB,EAAc,CAClBoC,UAAWt/G,EACXo/G,eAAgBD,EAChBI,mBAAoB,KACpBC,UAAW,EACX/B,SAAS,GAGPn2H,KAAKkoB,KAAKgvG,WACZx9G,EAAUqC,SAASC,cAAc,YACjCtC,EAAQhB,YAAkC,OAApBm/G,QAAoB,IAApBA,EAAAA,EAAwBn/G,EAC1C1Y,KAAKkoB,KAAKiwG,cACZz+G,EAAQ2B,MAAM+8G,UAAY,YAG5B1+G,EAAUqC,SAASC,cAAc,SACjCtC,EAAQlZ,KAAOR,KAAKkoB,KAAKwnF,SAAW,WAAa,OACjDh2F,EAAQU,aAAa,QAA6B,OAApBy9G,QAAoB,IAApBA,EAAAA,EAAwBn/G,GAClD1Y,KAAKkoB,KAAKiwG,cACZz+G,EAAQ2B,MAAMg9G,UAAY,WAG1Br4H,KAAKkoB,KAAKmuE,eACZ38E,EAAQ0D,QAAS,GAEnB2sG,GAAqB/qH,IAAI0a,GACzB1Z,KAAK+sH,eAAiBrzG,EACtBA,EAAQU,aAAa,kBAAmBX,GAExCC,EAAQg8B,SAAW11C,KAAKkoB,KAAKowG,SAC7B5+G,EAAQnM,KAAOvN,KAAKkoB,KAAK6sG,UACzBr7G,EAAQyR,SAAW,EACnB,MAAM,eAAEotG,EAAc,aAAEC,EAAY,SAAEC,GAAaz4H,KAAKkoB,KAClDwwG,IAAkBF,GAAgBx4H,KAAK2sH,gBACzC4L,IACF7+G,EAAQuT,MAAQsrG,GAGlBv4H,KAAKowH,aAAa12G,EAAS1Z,KAAKkoB,KAAKioG,UAEjCwH,IACFj+G,EAAQi/G,UAAYhB,GAGtBj+G,EAAQK,iBAAiB,QAASC,IAChCL,EAAQM,SAASR,EAAI,CAAE3Z,MAAOka,EAAME,OAAOpa,QAC3CE,KAAKw3H,sBACH99G,EACA,QACAM,EAAME,OAAOpa,MACb,SAEF81H,EAAYkC,eAAiB,OAG/Bp+G,EAAQK,iBAAiB,YAAaC,IAAS,IAAA4+G,EAC7C,MAAMxlE,EAA0C,QAA9BwlE,EAAG54H,KAAKkoB,KAAK2wG,yBAAiB,IAAAD,EAAAA,EAAI,GACpDl/G,EAAQ5Z,MAAQ81H,EAAYoC,UAAY5kE,EACxCwiE,EAAYkC,eAAiB,OAG/B,IAAIgB,EAAe9+G,IACjB,MAAM,eAAE89G,GAAmBlC,EACJ,OAAnBkC,QAA8CrsH,IAAnBqsH,IAC7B99G,EAAME,OAAOpa,MAAQg4H,GAGvB99G,EAAME,OAAO6+G,WAAa,GAG5B,GAAI/4H,KAAK2sH,iBAAmB3sH,KAAKg2G,aAAc,KAAAgjB,EAC7Ct/G,EAAQK,iBAAiB,QAASC,IAAS,IAAAi/G,EACzC,GAAIrD,EAAYO,QACd,OAEF,MAAM,OAAEj8G,GAAWF,EAQnB,GAPI0+G,IACFx+G,EAAO1Z,KAAOg4H,EACVC,IACFv+G,EAAO+xD,KAAOwsD,IAId7C,EAAYoC,UAAW,CACzB,MAAMl4H,EAAQ81H,EAAYoC,UAC1B,GAAIU,EACF,GAAqB,SAAjBF,EAAyB,CAC3B,MAAMz/E,EAAO,IAAIp3B,KAAK7hB,GAChBuiG,EAAQ,CACZtpD,EAAKmgF,WACLngF,EAAKogF,aACLpgF,EAAKqgF,cAEPl/G,EAAOpa,MAAQuiG,EACZx+E,IAAIjM,GAAKA,EAAElG,WAAWC,SAAS,EAAG,MAClC1C,KAAK,IACV,MACEiL,EAAOpa,MAAQ,IAAI6hB,KAAK7hB,EAAQkqH,IAC7BqP,cACAxsH,MAAuB,SAAjB2rH,EAA0B,IAAM,IAAK,GAAG,QAGnDt+G,EAAOpa,MAAQA,CAEnB,CACA81H,EAAYqC,mBAAqB/9G,EAAOpa,MACxC81H,EAAYsC,UAAY,EACF,QAAlBe,EAACj5H,KAAKkoB,KAAKqoG,eAAO,IAAA0I,GAAjBA,EAAmBvC,QACtBd,EAAYO,SAAU,KAI1Bz8G,EAAQK,iBAAiB,oBAAqBy2G,IAC5CxwH,KAAKw1H,yBAAyBhF,EAAQt2G,QACtC,MAAMq2G,EAAU,CACdzwH,KAAAA,CAAMka,GAAO,IAAAs/G,EACX1D,EAAYoC,UAA8B,QAArBsB,EAAGt/G,EAAMmtG,OAAOrnH,aAAK,IAAAw5H,EAAAA,EAAI,GACzCZ,GACH/+G,EAAQM,SAASR,EAAI,CACnB3Z,MAAO81H,EAAYoC,UAAUtmH,aAGjCsI,EAAME,OAAOpa,MAAQ81H,EAAYoC,SACnC,EACAF,cAAAA,CAAe99G,GACb,MAAM,eAAE89G,GAAmB99G,EAAMmtG,OACjCyO,EAAYkC,eAAiBA,EAER,OAAnBA,QACmBrsH,IAAnBqsH,GACA99G,EAAME,SAAW6B,SAASif,gBAG1BhhB,EAAME,OAAOpa,MAAQg4H,GAEvB,MAAM5vG,EAAO,CACX4vG,kBAEEY,IAIFxwG,EAAKpoB,MAAQg4H,GAEfn+G,EAAQM,SAASR,EAAIyO,EACvB,EACAqxG,QAAAA,CAASv/G,GACPA,EAAME,OAAOs/G,qBAAqBx/G,EAAMmtG,OAAOoS,SACjD,EACA3B,UAAW59G,IAAS,IAAAy/G,EAClB,MAAM,UAAE7B,GAAc59G,EAAMmtG,QACtB,OAAEjtG,GAAWF,EACnB,GAAkB,IAAd49G,EAEF,YADA19G,EAAOI,gBAAgB,aAIzBJ,EAAOE,aAAa,YAAaw9G,GACjC,IAAI93H,EAAQ81H,EAAYoC,WACnBl4H,GAASA,EAAMzB,QAAUu5H,IAG9B93H,EAAQA,EAAMuV,MAAM,EAAGuiH,GACvB19G,EAAOpa,MAAQ81H,EAAYoC,UAAYl4H,EACvC6Z,EAAQM,SAASR,EAAI,CAAE3Z,UAEE,QAAzB25H,EAAAz5H,KAAK+a,YAAYwhB,gBAAQ,IAAAk9F,GAAzBA,EAA2B/1F,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,KACAlM,KAAM,YACNzN,QACA45H,YAAY,EACZxB,UAAW,EACXyB,SAAUz/G,EAAO0/G,eACjBC,OAAQ3/G,EAAO4/G,mBAKvB95H,KAAKswH,0BAA0BC,EAASC,KAK1C92G,EAAQK,iBAAiB,UAAWC,IAAS,IAAA+/G,EAC3CnE,EAAYsC,UAAY,EAGxB,IAAIA,GAAa,EAWjB,GAVkB,WAAdl+G,EAAMkB,IACRg9G,EAAY,EACW,UAAdl+G,EAAMkB,KAAoBlb,KAAKkoB,KAAKgvG,UAKtB,QAAdl9G,EAAMkB,MACf06G,EAAYsC,UAAY,GAFxBA,EAAY,GAIK,IAAfA,EACF,OAEF,MAAM,MAAEp4H,GAAUka,EAAME,OACpB07G,EAAYqC,qBAAuBn4H,IAGvC81H,EAAYqC,mBAAqBn4H,EAEjC81H,EAAYoC,UAAYl4H,EACC,QAAzBi6H,EAAA/5H,KAAK+a,YAAYwhB,gBAAQ,IAAAw9F,GAAzBA,EAA2Br2F,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,KACAlM,KAAM,YACNzN,QACA45H,YAAY,EACZxB,YACAyB,SAAU3/G,EAAME,OAAO0/G,eACvBC,OAAQ7/G,EAAME,OAAO4/G,mBAI3B,MAAME,EAAgBlB,EACtBA,EAAe,KACfp/G,EAAQK,iBAAiB,OAAQC,IAAS,IAAAigH,EACxC,IAAKrE,EAAYO,UAAYn8G,EAAMwoC,cACjC,OAEoB,QAAlBy3E,EAACj6H,KAAKkoB,KAAKqoG,eAAO,IAAA0J,GAAjBA,EAAmBxD,OACtBb,EAAYO,SAAU,GAExB,MAAM,OAAEj8G,GAAWF,EACnB,IAAI,MAAEla,GAAUoa,EAChB,GAAIw+G,EAAe,CACjB,GAAI54H,GAA0B,SAAjB04H,EAAyB,CACpC,MAAMn2B,EAAQviG,EAAM+M,MAAM,KAAKgX,IAAIjM,GAAKqL,SAASrL,EAAG,KACpD9X,EAAQ,IAAI6hB,KACV,IACA,EACA,EACA0gF,EAAM,GACNA,EAAM,GACNA,EAAM,IAAM,GACZ63B,UACFhgH,EAAO+xD,KAAO,EAChB,MAMOnsE,EAAM4Q,SAAS,OAClB5Q,EAAQ,GAAHkL,OAAMlL,EAAK,WAElBA,EAAQ,IAAI6hB,KAAK7hB,GAAOo6H,UAE1BhgH,EAAO1Z,KAAO,MAChB,CAE8C,IAAA25H,GAD9CvE,EAAYoC,UAAYl4H,EACpB81H,EAAYqC,qBAAuBn4H,KACZ,QAAzBq6H,EAAAn6H,KAAK+a,YAAYwhB,gBAAQ,IAAA49F,GAAzBA,EAA2Bz2F,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,KACAlM,KAAM,YACNzN,QACA45H,YAAY,EACZxB,UAAWtC,EAAYsC,UACvByB,SAAU3/G,EAAME,OAAO0/G,eACvBC,OAAQ7/G,EAAME,OAAO4/G,iBAI3BE,EAAchgH,KAGK,QAArBg/G,EAAIh5H,KAAKkoB,KAAKqoG,eAAO,IAAAyI,GAAjBA,EAAmBoB,WACrB1gH,EAAQK,iBAAiB,cAAeC,IAAS,IAAAqgH,EAC/CzE,EAAYqC,mBAAqB,KACjC,MAAM,KAAE/vG,EAAI,OAAEhO,GAAWF,GACnB,MAAEla,EAAK,eAAE85H,EAAc,aAAEE,GAAiB5/G,EAEhD,IAAIy/G,EAAWC,EACbC,EAASC,EAEX,OAAQ9/G,EAAMsgH,WAEZ,IAAK,qBAAsB,CACzB,MAAMxuH,EAAQhM,EACXqhB,UAAU,EAAGy4G,GACb9tH,MAAM,cACLA,IACF6tH,GAAY7tH,EAAM,GAAGzN,QAEvB,KACF,CACA,IAAK,oBAAqB,CACxB,MAAMyN,EAAQhM,EACXqhB,UAAUy4G,GACV9tH,MAAM,cACLA,IACF+tH,GAAU/tH,EAAM,GAAGzN,QAErB,KACF,CACA,IAAK,wBACCu7H,IAAmBE,IACrBH,GAAY,GAEd,MACF,IAAK,uBACCC,IAAmBE,IACrBD,GAAU,GAMhB7/G,EAAMqI,iBACmB,QAAzBg4G,EAAAr6H,KAAK+a,YAAYwhB,gBAAQ,IAAA89F,GAAzBA,EAA2B32F,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,KACAlM,KAAM,YACNzN,QACAy6H,OAAQryG,GAAQ,GAChBwxG,YAAY,EACZC,WACAE,cAMR75H,KAAKo2H,mBACH18G,EACAk8G,EACA,CACE,CAAC,QAAS,SACV,CAAC,OAAQ,QACT,CAAC,YAAa,cACd,CAAC,aAAc,eACf,CAAC,aAAc,cACf,CAAC,UAAW,aAEd57G,GAASA,EAAME,OAAOpa,MAE1B,CAMA,GAJIg5H,GACFp/G,EAAQK,iBAAiB,OAAQ++G,GAG/B94H,KAAKkoB,KAAK6vG,KAAM,CAClB,MACMyC,GADax6H,KAAKkoB,KAAKvU,KAAK,GAAK3T,KAAKkoB,KAAKvU,KAAK,IACvBgkH,EAE/Bj+G,EAAQsO,UAAUhpB,IAAI,QACtB0a,EAAQ2B,MAAMo/G,cAAgB,QAAHzvH,OAAWwvH,EAAS,wCACjD,CACF,MACE9gH,EAAUqC,SAASC,cAAc,OACjCtC,EAAQhB,YAAc1Y,KAAKkoB,KAAKqvG,WAChC79G,EAAQ2B,MAAMq/G,cAAgB,SAC9BhhH,EAAQ2B,MAAMy0G,QAAU,aAEpB9vH,KAAKkoB,KAAKmuE,eACZ38E,EAAQ0D,QAAS,GASrB,OALApd,KAAK42H,cAAcl9G,GACnB1Z,KAAK22H,oBAAoBj9G,GACzB1Z,KAAK0wH,4BAA4Bh3G,GAEjC1Z,KAAKwnB,UAAUpL,OAAO1C,GACf1Z,KAAKwnB,SACd,EAGF,MAAMqjG,WAAyCC,GAC7Ct9G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,eAAgBzwG,EAAWwM,KAAKmuE,cACtD,EAGF,MAAMq0B,WAAwCI,GAC5Ct9G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,aAAczwG,EAAW8wG,aAC/C,CAEA/wG,MAAAA,GACE,MAAM9B,EAAU3Z,KAAK2b,kBACfuM,EAAOloB,KAAKkoB,KACZzO,EAAKyO,EAAKzO,GAChB,IAAI3Z,EAAQ6Z,EAAQG,SAASL,EAAI,CAC/B3Z,MAAOooB,EAAK8pG,cAAgB9pG,EAAKqvG,aAChCz3H,MACkB,kBAAVA,IAETA,EAAkB,QAAVA,EACR6Z,EAAQM,SAASR,EAAI,CAAE3Z,WAGzBE,KAAKwnB,UAAUQ,UAAUhpB,IAAI,yBAA0B,YAEvD,MAAM0a,EAAUqC,SAASC,cAAc,SA+DvC,OA9DA+tG,GAAqB/qH,IAAI0a,GACzBA,EAAQU,aAAa,kBAAmBX,GAExCC,EAAQg8B,SAAWxtB,EAAKowG,SACxBt4H,KAAKowH,aAAa12G,EAAS1Z,KAAKkoB,KAAKioG,UACrCz2G,EAAQlZ,KAAO,WACfkZ,EAAQnM,KAAO2a,EAAK6sG,UAChBj1H,GACF4Z,EAAQU,aAAa,WAAW,GAElCV,EAAQU,aAAa,cAAe8N,EAAK8pG,aACzCt4G,EAAQyR,SAAW,EAEnBzR,EAAQK,iBAAiB,SAAUC,IACjC,MAAM,KAAEzM,EAAI,QAAEgN,GAAYP,EAAME,OAChC,IAAK,MAAMygH,KAAY36H,KAAK2xH,mBAAmBpkH,EAAqBkM,GAAK,CACvE,MAAMmhH,EAAargH,GAAWogH,EAAS3I,cAAgB9pG,EAAK8pG,YACxD2I,EAAS1I,aACX0I,EAAS1I,WAAW13G,QAAUqgH,GAEhCjhH,EAAQM,SAAS0gH,EAASlhH,GAAI,CAAE3Z,MAAO86H,GACzC,CACAjhH,EAAQM,SAASR,EAAI,CAAE3Z,MAAOya,MAGhCb,EAAQK,iBAAiB,YAAaC,IACpC,MAAMo5C,EAAelrC,EAAK2wG,mBAAqB,MAC/C7+G,EAAME,OAAOK,QAAU64C,IAAiBlrC,EAAK8pG,cAG3ChyH,KAAK2sH,iBAAmB3sH,KAAKg2G,eAC/Bt8F,EAAQK,iBAAiB,oBAAqBy2G,IAC5C,MAAMD,EAAU,CACdzwH,KAAAA,CAAMka,GACJA,EAAME,OAAOK,QAAiC,QAAvBP,EAAMmtG,OAAOrnH,MACpC6Z,EAAQM,SAASR,EAAI,CAAE3Z,MAAOka,EAAME,OAAOK,SAC7C,GAEFva,KAAKswH,0BAA0BC,EAASC,KAG1CxwH,KAAKo2H,mBACH18G,EACA,KACA,CACE,CAAC,SAAU,YACX,CAAC,SAAU,UACX,CAAC,QAAS,SACV,CAAC,OAAQ,QACT,CAAC,YAAa,cACd,CAAC,aAAc,eACf,CAAC,aAAc,cACf,CAAC,UAAW,aAEdM,GAASA,EAAME,OAAOK,UAI1Bva,KAAK22H,oBAAoBj9G,GACzB1Z,KAAK0wH,4BAA4Bh3G,GAEjC1Z,KAAKwnB,UAAUpL,OAAO1C,GACf1Z,KAAKwnB,SACd,EAGF,MAAMgjG,WAA2CM,GAC/Ct9G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,aAAczwG,EAAW8wG,aAC/C,CAEA/wG,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,yBAA0B,eACvD,MAAM2a,EAAU3Z,KAAK2b,kBACfuM,EAAOloB,KAAKkoB,KACZzO,EAAKyO,EAAKzO,GAChB,IAAI3Z,EAAQ6Z,EAAQG,SAASL,EAAI,CAC/B3Z,MAAOooB,EAAKqvG,aAAervG,EAAK2yG,cAC/B/6H,MAOH,GANqB,kBAAVA,IAETA,EAAQA,IAAUooB,EAAK2yG,YACvBlhH,EAAQM,SAASR,EAAI,CAAE3Z,WAGrBA,EAOF,IAAK,MAAMg7H,KAAS96H,KAAK2xH,mBACvBzpG,EAAK6sG,UACUt7G,GAEfE,EAAQM,SAAS6gH,EAAMrhH,GAAI,CAAE3Z,OAAO,IAIxC,MAAM4Z,EAAUqC,SAASC,cAAc,SA6BvC,GA5BA+tG,GAAqB/qH,IAAI0a,GACzBA,EAAQU,aAAa,kBAAmBX,GAExCC,EAAQg8B,SAAWxtB,EAAKowG,SACxBt4H,KAAKowH,aAAa12G,EAAS1Z,KAAKkoB,KAAKioG,UACrCz2G,EAAQlZ,KAAO,QACfkZ,EAAQnM,KAAO2a,EAAK6sG,UAChBj1H,GACF4Z,EAAQU,aAAa,WAAW,GAElCV,EAAQyR,SAAW,EAEnBzR,EAAQK,iBAAiB,SAAUC,IACjC,MAAM,KAAEzM,EAAI,QAAEgN,GAAYP,EAAME,OAChC,IAAK,MAAM4gH,KAAS96H,KAAK2xH,mBAAmBpkH,EAAqBkM,GAC/DE,EAAQM,SAAS6gH,EAAMrhH,GAAI,CAAE3Z,OAAO,IAEtC6Z,EAAQM,SAASR,EAAI,CAAE3Z,MAAOya,MAGhCb,EAAQK,iBAAiB,YAAaC,IACpC,MAAMo5C,EAAelrC,EAAK2wG,kBAC1B7+G,EAAME,OAAOK,QACM,OAAjB64C,QACiB3nD,IAAjB2nD,GACAA,IAAiBlrC,EAAK2yG,cAGtB76H,KAAK2sH,iBAAmB3sH,KAAKg2G,aAAc,CAC7C,MAAM+kB,EAAiB7yG,EAAK2yG,YAC5BnhH,EAAQK,iBAAiB,oBAAqBy2G,IAC5C,MAAMD,EAAU,CACdzwH,MAAOka,IACL,MAAMO,EAAUwgH,IAAmB/gH,EAAMmtG,OAAOrnH,MAChD,IAAK,MAAMg7H,KAAS96H,KAAK2xH,mBAAmB33G,EAAME,OAAO3M,MAAO,CAC9D,MAAMqtH,EAAargH,GAAWugH,EAAMrhH,KAAOA,EACvCqhH,EAAM7I,aACR6I,EAAM7I,WAAW13G,QAAUqgH,GAE7BjhH,EAAQM,SAAS6gH,EAAMrhH,GAAI,CAAE3Z,MAAO86H,GACtC,IAGJ56H,KAAKswH,0BAA0BC,EAASC,KAG1CxwH,KAAKo2H,mBACH18G,EACA,KACA,CACE,CAAC,SAAU,YACX,CAAC,SAAU,UACX,CAAC,QAAS,SACV,CAAC,OAAQ,QACT,CAAC,YAAa,cACd,CAAC,aAAc,eACf,CAAC,aAAc,cACf,CAAC,UAAW,aAEdM,GAASA,EAAME,OAAOK,QAE1B,CAMA,OAJAva,KAAK22H,oBAAoBj9G,GACzB1Z,KAAK0wH,4BAA4Bh3G,GAEjC1Z,KAAKwnB,UAAUpL,OAAO1C,GACf1Z,KAAKwnB,SACd,EAGF,MAAMmjG,WAA0CR,GAC9C38G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAE0wG,aAAc1wG,EAAWwM,KAAKovG,eACpD,CAEA77G,MAAAA,GAIE,MAAM+L,EAAY7Z,MAAM8N,SACxB+L,EAAUQ,UAAUhpB,IAAI,yBAA0B,cAElD,MAAMg8H,EAAcxzG,EAAUyzG,UAS9B,OARIj7H,KAAK2sH,iBAAmB3sH,KAAKg2G,cAAgBglB,IAC/Ch7H,KAAK0wH,4BAA4BsK,GAEjCA,EAAYjhH,iBAAiB,oBAAqBy2G,IAChDxwH,KAAKswH,0BAA0B,CAAC,EAAGE,MAIhChpG,CACT,EAGF,MAAMojG,WAAsCE,GAC1Ct9G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,aAAczwG,EAAW8wG,aAC/C,CAEA/wG,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,0BAC7B,MAAM2a,EAAU3Z,KAAK2b,kBACflC,EAAKzZ,KAAKkoB,KAAKzO,GAEfI,EAAaF,EAAQG,SAASL,EAAI,CACtC3Z,MAAOE,KAAKkoB,KAAKqvG,aAGb2D,EAAgBn/G,SAASC,cAAc,UAC7C+tG,GAAqB/qH,IAAIk8H,GACzBA,EAAc9gH,aAAa,kBAAmBX,GAE9CyhH,EAAcxlF,SAAW11C,KAAKkoB,KAAKowG,SACnCt4H,KAAKowH,aAAa8K,EAAel7H,KAAKkoB,KAAKioG,UAC3C+K,EAAc3tH,KAAOvN,KAAKkoB,KAAK6sG,UAC/BmG,EAAc/vG,SAAW,EAEzB,IAAIgwG,EAAkBn7H,KAAKkoB,KAAKkzG,OAASp7H,KAAKkoB,KAAKxc,QAAQrN,OAAS,EAE/D2B,KAAKkoB,KAAKkzG,QAEbF,EAAczqG,KAAOzwB,KAAKkoB,KAAKxc,QAAQrN,OACnC2B,KAAKkoB,KAAKmzG,cACZH,EAAcI,UAAW,IAI7BJ,EAAcnhH,iBAAiB,YAAaC,IAC1C,MAAMo5C,EAAepzD,KAAKkoB,KAAK2wG,kBAC/B,IAAK,MAAMp+G,KAAUygH,EAAcxvH,QACjC+O,EAAOC,SAAWD,EAAO3a,QAAUszD,IAKvC,IAAK,MAAM34C,KAAUza,KAAKkoB,KAAKxc,QAAS,CACtC,MAAM6vH,EAAgBx/G,SAASC,cAAc,UAC7Cu/G,EAAc7iH,YAAc+B,EAAO+gH,aACnCD,EAAcz7H,MAAQ2a,EAAOu3G,YACzBn4G,EAAW/Z,MAAM4Q,SAAS+J,EAAOu3G,eACnCuJ,EAAcnhH,aAAa,YAAY,GACvC+gH,GAAkB,GAEpBD,EAAc9+G,OAAOm/G,EACvB,CAEA,IAAIE,EAAmB,KACvB,GAAIN,EAAiB,CACnB,MAAMO,EAAoB3/G,SAASC,cAAc,UACjD0/G,EAAkB57H,MAAQ,IAC1B47H,EAAkBthH,aAAa,UAAU,GACzCshH,EAAkBthH,aAAa,YAAY,GAC3C8gH,EAAcltE,QAAQ0tE,GAEtBD,EAAmBA,KACjBC,EAAkB5wG,SAClBowG,EAAcx3D,oBAAoB,QAAS+3D,GAC3CA,EAAmB,MAErBP,EAAcnhH,iBAAiB,QAAS0hH,EAC1C,CAEA,MAAM3hH,EAAW6hH,IACf,MAAMpuH,EAAOouH,EAAW,QAAU,eAC5B,QAAEjwH,EAAO,SAAE4vH,GAAaJ,EAC9B,OAAKI,EAKE/pH,MAAMrR,UAAUmqE,OACpBh5D,KAAK3F,EAAS+O,GAAUA,EAAOC,UAC/BmJ,IAAIpJ,GAAUA,EAAOlN,KANY,IAA3B7B,EAAQkP,cACX,KACAlP,EAAQA,EAAQkP,eAAerN,IAOvC,IAAIquH,EAAiB9hH,GAAwB,GAE7C,MAAM+hH,EAAW7hH,IACf,MAAMtO,EAAUsO,EAAME,OAAOxO,QAC7B,OAAO6F,MAAMrR,UAAU2jB,IAAIxS,KAAK3F,EAAS+O,IAAU,CACjD+gH,aAAc/gH,EAAO/B,YACrBs5G,YAAav3G,EAAO3a,UA8JxB,OA1JIE,KAAK2sH,iBAAmB3sH,KAAKg2G,cAC/BklB,EAAcnhH,iBAAiB,oBAAqBy2G,IAClD,MAAMD,EAAU,CACdzwH,KAAAA,CAAMka,GAAO,IAAA8hH,EACK,QAAhBA,EAAAL,SAAgB,IAAAK,GAAhBA,IACA,MAAMh8H,EAAQka,EAAMmtG,OAAOrnH,MACrBu/B,EAAS,IAAI7P,IAAIje,MAAM02B,QAAQnoC,GAASA,EAAQ,CAACA,IACvD,IAAK,MAAM2a,KAAUygH,EAAcxvH,QACjC+O,EAAOC,SAAW2kB,EAAOzgC,IAAI6b,EAAO3a,OAEtC6Z,EAAQM,SAASR,EAAI,CACnB3Z,MAAOga,GAAwB,KAEjC8hH,EAAiB9hH,GAAwB,EAC3C,EACAiiH,iBAAAA,CAAkB/hH,GAChBkhH,EAAcI,UAAW,CAC3B,EACAxwG,MAAAA,CAAO9Q,GACL,MAAMtO,EAAUwvH,EAAcxvH,QACxB6wD,EAAQviD,EAAMmtG,OAAOr8F,OAG3B,GAFApf,EAAQ6wD,GAAO7hD,UAAW,EAC1BwgH,EAAcpwG,OAAOyxC,GACjB7wD,EAAQrN,OAAS,EAAG,EAKX,IAJDkT,MAAMrR,UAAU87H,UAAU3qH,KAClC3F,EACA+O,GAAUA,EAAOC,YAGjBhP,EAAQ,GAAGgP,UAAW,EAE1B,CACAf,EAAQM,SAASR,EAAI,CACnB3Z,MAAOga,GAAwB,GAC/BlB,MAAOijH,EAAS7hH,KAElB4hH,EAAiB9hH,GAAwB,EAC3C,EACAwlB,KAAAA,CAAMtlB,GACJ,KAAgC,IAAzBkhH,EAAc78H,QACnB68H,EAAcpwG,OAAO,GAEvBnR,EAAQM,SAASR,EAAI,CAAE3Z,MAAO,KAAM8Y,MAAO,KAC3CgjH,EAAiB9hH,GAAwB,EAC3C,EACA0+C,MAAAA,CAAOx+C,GACL,MAAM,MAAEuiD,EAAK,aAAEi/D,EAAY,YAAExJ,GAAgBh4G,EAAMmtG,OAAO3uD,OACpDyjE,EAAcf,EAAc9hH,SAASmjD,GACrCg/D,EAAgBx/G,SAASC,cAAc,UAC7Cu/G,EAAc7iH,YAAc8iH,EAC5BD,EAAcz7H,MAAQkyH,EAElBiK,EACFA,EAAYx2E,OAAO81E,GAEnBL,EAAc9+G,OAAOm/G,GAEvB5hH,EAAQM,SAASR,EAAI,CACnB3Z,MAAOga,GAAwB,GAC/BlB,MAAOijH,EAAS7hH,KAElB4hH,EAAiB9hH,GAAwB,EAC3C,EACAlB,KAAAA,CAAMoB,GACJ,MAAM,MAAEpB,GAAUoB,EAAMmtG,OACxB,KAAgC,IAAzB+T,EAAc78H,QACnB68H,EAAcpwG,OAAO,GAEvB,IAAK,MAAMuc,KAAQzuB,EAAO,CACxB,MAAM,aAAE4iH,EAAY,YAAExJ,GAAgB3qF,EAChCk0F,EAAgBx/G,SAASC,cAAc,UAC7Cu/G,EAAc7iH,YAAc8iH,EAC5BD,EAAcz7H,MAAQkyH,EACtBkJ,EAAc9+G,OAAOm/G,EACvB,CACIL,EAAcxvH,QAAQrN,OAAS,IACjC68H,EAAcxvH,QAAQ,GAAGgP,UAAW,GAEtCf,EAAQM,SAASR,EAAI,CACnB3Z,MAAOga,GAAwB,GAC/BlB,MAAOijH,EAAS7hH,KAElB4hH,EAAiB9hH,GAAwB,EAC3C,EACAoiH,OAAAA,CAAQliH,GACN,MAAMkiH,EAAU,IAAI1sG,IAAIxV,EAAMmtG,OAAO+U,SACrC,IAAK,MAAMzhH,KAAUT,EAAME,OAAOxO,QAChC+O,EAAOC,SAAWwhH,EAAQt9H,IAAI6b,EAAO8hD,OAEvC5iD,EAAQM,SAASR,EAAI,CACnB3Z,MAAOga,GAAwB,KAEjC8hH,EAAiB9hH,GAAwB,EAC3C,EACAqiH,QAAAA,CAASniH,GACPA,EAAME,OAAOw7B,UAAY17B,EAAMmtG,OAAOgV,QACxC,GAEFn8H,KAAKswH,0BAA0BC,EAASC,KAG1C0K,EAAcnhH,iBAAiB,QAASC,IAAS,IAAAoiH,EAC/C,MAAMpK,EAAcl4G,GAAwB,GACtCygH,EAASzgH,GAAwB,GACvCH,EAAQM,SAASR,EAAI,CAAE3Z,MAAOkyH,IAE9Bh4G,EAAMqI,iBAEmB,QAAzB+5G,EAAAp8H,KAAK+a,YAAYwhB,gBAAQ,IAAA6/F,GAAzBA,EAA2B14F,SAAS,yBAA0B,CAC5DC,OAAQ3jC,KACRmnH,OAAQ,CACN1tG,KACAlM,KAAM,YACNzN,MAAO87H,EACPrB,SACA8B,SAAUrK,EACV0H,YAAY,EACZxB,UAAW,EACXoE,SAAS,OAKft8H,KAAKo2H,mBACH8E,EACA,KACA,CACE,CAAC,QAAS,SACV,CAAC,OAAQ,QACT,CAAC,YAAa,cACd,CAAC,aAAc,eACf,CAAC,aAAc,cACf,CAAC,UAAW,YACZ,CAAC,QAAS,UACV,CAAC,QAAS,aAEZlhH,GAASA,EAAME,OAAOpa,QAGxBo7H,EAAcnhH,iBAAiB,QAAS,SAAUC,GAChDL,EAAQM,SAASR,EAAI,CAAE3Z,MAAOga,GAAwB,IACxD,GAGE9Z,KAAKkoB,KAAKkzG,OACZp7H,KAAK42H,cAAcsE,GAKrBl7H,KAAK22H,oBAAoBuE,GACzBl7H,KAAK0wH,4BAA4BwK,GAEjCl7H,KAAKwnB,UAAUpL,OAAO8+G,GACfl7H,KAAKwnB,SACd,EACF,IAAA+0G,GAAA,IAAAxuG,QAEA,MAAMg9F,WAA+Be,GACnCt+G,WAAAA,CAAYkO,GACV,MAAM,KAAEwM,EAAI,SAAEupG,EAAQ,OAAE90G,GAAWjB,EAC7B4S,IAAsB3R,EAAOub,gBAKnC,GAJAvqB,MAAM+N,EAAY,CAChBywG,cAAe79F,GAAqBw9F,GAAkBoB,cAAchlG,KACpEppB,EAAA,KAAAy9H,IACFv8H,KAAKyxH,SAAWA,EACZnjG,GAAqBw9F,GAAkBoB,cAAchlG,GAAO,CAC9D,MAAMy/B,EAAS3nD,KAAK2nD,MAAQzoD,EAAAq9H,GAAAv8H,KAAKyuH,IAAYp9G,KAAjBrR,MAC5B,IAAK,MAAM0Z,KAAW+3G,EACpB/3G,EAAQiuC,MAAQA,CAEpB,MACE3nD,KAAK2nD,MAAQ,IAEjB,CAmBAlsC,MAAAA,GACE,MAAM,UAAE+L,GAAcxnB,KACtBwnB,EAAUQ,UAAUhpB,IAAI,mBACxBwoB,EAAUy/F,KAAO,UAEjB,MAAMt/D,EAAS3nD,KAAK2nD,MAAQzoD,EAAAq9H,GAAAv8H,KAAKyuH,IAAYp9G,KAAjBrR,MAEtBirC,EAAa,GACnB,IAAK,MAAMvxB,KAAW1Z,KAAKyxH,SACzB/3G,EAAQiuC,MAAQA,EAChBjuC,EAAQ8N,UAAU4xB,aAAe,SACjCnO,EAAWj8B,KAAK0K,EAAQwO,KAAKzO,IAC7BC,EAAQ84G,mBAQV,OALAxyH,KAAKwnB,UAAUpN,aACb,gBACA6wB,EAAWpnB,IAAIpK,GAAM,GAAJzO,OAAO0M,IAAgB1M,OAAGyO,IAAMxK,KAAK,MAGjDjP,KAAKwnB,SACd,EACF,SAAAinG,KAtCI,OAAO,IAAI+N,GAAa,CACtBh1G,UAAWxnB,KAAKwnB,UAChB7D,MAAO3jB,KAAKkoB,KAAKvE,MACjB4tG,SAAUvxH,KAAKkoB,KAAKqpG,SACpBzxE,iBAAkB9/C,KAAKkoB,KAAK43B,kBAAoB9/C,KAAKkoB,KAAK23B,aAC1DrU,YAAaxrC,KAAKkoB,KAAKsjB,YACvBsN,SAAU94C,KAAKkoB,KAAK4wB,SACpBnlC,KAAM3T,KAAKkoB,KAAKvU,KAChB69G,WAAYxxH,KAAKkoB,KAAKspG,YAAc,KACpC70G,OAAQ3c,KAAK2c,OACb80G,SAAUzxH,KAAKyxH,SACfpzG,KAAMre,KAAKkoB,KAAK7J,KAChBie,eAAgBt8B,KAAK2c,OAAOub,iBAEhC,KAAAukG,GAAA,IAAA9uG,QAAA+uG,GAAA,IAAA/uG,QAAAgvG,GAAA,IAAAhvG,QAAAivG,GAAA,IAAAjvG,QAAAkvG,GAAA,IAAAlvG,QAAAmvG,GAAA,IAAAnvG,QAAAovG,GAAA,IAAApvG,QAAAqvG,GAAA,IAAArvG,QAAAsvG,GAAA,IAAAtvG,QAAAuvG,GAAA,IAAAvvG,QAAAwvG,GAAA,IAAAxvG,QAAAyvG,GAAA,IAAAzvG,QAAA0vG,GAAA,IAAA1vG,QAAA2vG,GAAA,IAAA3vG,QAAA4vG,GAAA,IAAA5vG,QAAA6vG,GAAA,IAAA7vG,QAAA8vG,GAAA,IAAA9vG,QAAA+vG,GAAA,IAAA/vG,QAAAgwG,GAAA,IAAAhwG,QAAAiwG,GAAA,IAAAjwG,QAAAkwG,GAAA,IAAAlwG,QAAAmwG,GAAA,IAAAnwG,QAAAowG,GAAA,IAAApwG,QAAAqwG,GAAA,IAAArwG,QAAAswG,GAAA,IAAAtwG,QAAAuwG,GAAA,IAAAvwG,QAAAwwG,GAAA,IAAApwG,QA0BF,MAAMyuG,GAqDJhvH,WAAAA,CAAW4wH,GAaR,IAbS,UACV52G,EAAS,MACT7D,EAAK,SACL8tG,EAAQ,SACRF,EAAQ,iBACRzxE,EACAtU,YAAAA,EACAsN,SAAAA,EAAQ,OACRn8B,EACAhJ,KAAAA,EAAI,WACJ69G,EAAU,KACVnzG,EAAI,eACJie,EAAiB,MAClB8hG,EAAAt/H,EAAA,KAAAq/H,IAjEDl/H,EAAA,KAAAw9H,GAAkB,MAElBx9H,EAAA,KAAAy9H,GAAgBx9H,EAAAi/H,GAAAn+H,KAAKq+H,IAAS9wG,KAAKvtB,OAEnCf,EAAA,KAAA09H,GAAaz9H,EAAAi/H,GAAAn+H,KAAKs+H,IAAM/wG,KAAKvtB,OAE7Bf,EAAA,KAAA29H,GAAa19H,EAAAi/H,GAAAn+H,KAAKu+H,IAAMhxG,KAAKvtB,OAE7Bf,EAAA,KAAA49H,GAAe39H,EAAAi/H,GAAAn+H,KAAKw+H,IAAQjxG,KAAKvtB,OAEjCf,EAAA,KAAA69H,GAAS,MAET79H,EAAA,KAAA89H,GAAa,MAEb99H,EAAA,KAAA+9H,GAAe,MAEf/9H,EAAA,KAAAg+H,GAAW,MAEXh+H,EAAA,KAAAi+H,GAAY,MAEZj+H,EAAA,KAAAk+H,GAAU,MAEVl+H,EAAA,KAAAm+H,GAAc,MAEdn+H,EAAA,KAAAo+H,IAAU,GAEVp+H,EAAA,KAAAq+H,GAAS,MAETr+H,EAAA,KAAAs+H,GAAwB,MAExBt+H,EAAA,KAAAu+H,GAAY,MAEZv+H,EAAA,KAAAw+H,GAAiB,MAEjBx+H,EAAA,KAAAy+H,GAAyB,MAEzBz+H,EAAA,KAAA0+H,GAAiB,MAEjB1+H,EAAA,KAAA2+H,GAAQ,MAER3+H,EAAA,KAAA4+H,GAAY,MAEZ5+H,EAAA,KAAA6+H,GAAY,MAEZ7+H,EAAA,KAAA8+H,GAAW,MAEX9+H,EAAA,KAAA++H,IAAc,GAEd/+H,EAAA,KAAAg/H,GAAgB,MAEhBh/H,EAAA,KAAAi/H,GAAe,MAgBbh1G,EAAK6zG,GAAL/8H,KAAkBwnB,GAClB0B,EAAK40G,GAAL99H,KAAiBuxH,GACjBroG,EAAK8zG,GAALh9H,KAAoBwrC,GACpBtiB,EAAK20G,GAAL79H,KAAiB84C,GACjB5vB,EAAKi0G,GAALn9H,KAAe2c,GACfuM,EAAK4zG,GAAL98H,KAAc2jB,GACduF,EAAK00G,GAAL59H,KAAa2T,GACbuV,EAAKk0G,GAALp9H,KAAmBwxH,GACnBtoG,EAAKg0G,GAALl9H,KAAiByxH,GACjBvoG,EAAKuzG,GAALz8H,KAAuBs8B,GACvBpT,EAAK+0G,GAALj+H,KAAqByxH,EAAS,IAK9BvoG,EAAK+zG,GAALj9H,KAAgBwiB,GAAcC,aAAaq9B,IAG3C9/C,KAAKy+H,QAAUhN,EAASiN,QAAQxgI,GAAKA,EAAEq0H,6BAElCj2F,IACHp9B,EAAAi/H,GAAAn+H,KAAK2+H,IAAkBttH,KAAvBrR,MAEA4pB,EAAKmzG,GAAL/8H,MAAgBod,QAAS,EACrBiB,GACFnf,EAAAi/H,GAAAn+H,KAAKw+H,IAAOntH,KAAZrR,MAaN,CAmCA4+H,mBAAAA,GACE,GAAIh1G,EAAK6zG,GAALz9H,MAIF,YAHK4pB,EAAK6zG,GAALz9H,MAAoBo2C,YACvBxsB,EAAKq0G,GAALj+H,MAAmBwnB,UAAUq3G,MAAMj1G,EAAK6zG,GAALz9H,QASvC,GAJK4pB,EAAK8zG,GAAL19H,OACHd,EAAAi/H,GAAAn+H,KAAK8+H,IAAyBztH,KAA9BrR,OAGG4pB,EAAK8zG,GAAL19H,MACH,OAGF,MAAM,OAAE2pB,GAAYT,EAAKq0G,GAALv9H,KAA6B,IAAIi9B,iBAC/C8hG,EAAen1G,EAAKq0G,GAALj+H,MAAmB8sH,oBAClCkS,EAAcA,KAClBp1G,EAAK6yG,GAALz8H,MAAqBuiC,mBACnBviC,MACmB,OACAyL,GACCszH,IAGlBE,EAAYA,KAChBr1G,EAAK6yG,GAALz8H,MAAqBuiC,mBACnBviC,MACmB,GACA,GACC++H,IAGlBG,EAAYA,KAChBt1G,EAAK6yG,GAALz8H,MAAqBuiC,mBACnBviC,MACmB,GACA,IAIvB,GAAK++H,EAgBE,CACL71G,EAAKu0G,GAALz9H,KAAsB4pB,EAAKq0G,GAALj+H,MAAmBwnB,WACzC,IAAK,MAAM9N,KAAW1Z,KAAKy+H,QACzB/kH,EAAQ0/B,aAAe,SACvB1/B,EAAQ2/B,aAAe,eACvB3/B,EAAQK,iBAAiB,UAAW6P,EAAK8yG,GAAL18H,MAAoB,CAAE2pB,WAC1DjQ,EAAQK,iBAAiB,QAASilH,EAAa,CAAEr1G,WACjDjQ,EAAQK,iBAAiB,eAAgBklH,EAAW,CAAEt1G,WACtDjQ,EAAQK,iBAAiB,eAAgBmlH,EAAW,CAAEv1G,WACtDjQ,EAAQsO,UAAUhpB,IAAI,mBAE1B,KA3BmB,CACjB,MAAMksB,EAAUhC,EAAKu0G,GAALz9H,KAAsB+b,SAASC,cAAc,WAC7DkP,EAAOxD,UAAY,0BACnB,MAAMy3G,EAAkBv1G,EAAKq0G,GAALj+H,MAAmBwnB,UAC3C0D,EAAO7P,MAAM2mC,OAASm9E,EAAgB9jH,MAAM2mC,OAAS,EACrD92B,EAAOC,SAAW,EAClBD,EAAOkuB,aAAe,SACtBluB,EAAOmuB,aAAe,eACtBnuB,EAAO9Q,aAAa,eAAgB,6BACpClb,EAAAi/H,GAAAn+H,KAAKo/H,IAAY/tH,KAAjBrR,MACAd,EAAAi/H,GAAAn+H,KAAKq/H,IAA4BhuH,KAAjCrR,MACAkrB,EAAOnR,iBAAiB,UAAW6P,EAAK8yG,GAAL18H,MAAoB,CAAE2pB,WACzDuB,EAAOnR,iBAAiB,QAASilH,EAAa,CAAEr1G,WAChDuB,EAAOnR,iBAAiB,eAAgBklH,EAAW,CAAEt1G,WACrDuB,EAAOnR,iBAAiB,eAAgBmlH,EAAW,CAAEv1G,WACrDw1G,EAAgBN,MAAM3zG,EACxB,CAYF,CA2BA,sBAAImsB,GACF,MAAM,MAAE1zB,EAAK,QAAE8e,GAAY7Y,EAAKq0G,GAALj+H,MAAmBwtH,YAC9C,OAAK7pG,EAGEiG,EAAKuzG,GAALn9H,MAAak4B,gBAAgBsK,iBAAiB7e,EAAO8e,GAFnD,IAGX,CAEA+jB,kBAAAA,GACExZ,WAAW,KAAM,IAAAsyF,EACI,QAAnBA,EAAA11G,EAAK6zG,GAALz9H,aAAmB,IAAAs/H,GAAnBA,EAAqBt7F,SACpB,EACL,CAEAjC,OAAAA,GACE,MAAM,SAAE+W,EAAQ,MAAEn1B,EAAK,QAAE8e,EAAO,aAAEod,EAAY,iBAAEC,GAC9Cl2B,EAAKq0G,GAALj+H,MAAmBwtH,YACrB,MAAO,CACLhiF,YAAa,CAAEr8B,IAAKnP,KAAK0rB,SACzBotB,WACAn1B,QACA8e,UACAod,eACAC,mBAEJ,CAEA,sBAAIqL,GACF,OAAOvhC,EAAK6zG,GAALz9H,KACT,CAEA,WAAI0rB,GAEF,OADA9B,EAAKs0G,GAALl+H,OAAAkpB,EAAKg1G,GAALl+H,KAAsB4pB,EAAKq0G,GAALj+H,MAAmButH,aAClC3jG,EAAKs0G,GAALl+H,KACT,CAEA,WAAI0rB,CAAQxN,GACNA,IAASle,KAAK0rB,UAGlB9B,EAAKq0G,GAALj+H,MAAmButH,YAAcrkG,EAAKg1G,GAALl+H,KAAoBke,GACvD,CAEA8lB,KAAAA,GAAQ,IAAAu7F,EACsB,QAA5BA,EAAA31G,EAAKq0G,GAALj+H,MAAmBwnB,iBAAS,IAAA+3G,GAA5BA,EAA8Bv7F,OAChC,CAEA,4BAAI8jB,GACF,OAAOl+B,EAAKq0G,GAALj+H,MAAmBo/B,MAAMgF,uBAClC,CAEAkU,sBAAAA,CAAsBknF,GAAyB,IAAxB,SAAE9kH,EAAQ,SAAE89B,GAAUgnF,EACtC51G,EAAK6zG,GAALz9H,QAGL4pB,EAAK6zG,GAALz9H,MAAoBgoB,UAAUqc,OAAO,WAAY3pB,GACjDkP,EAAK6zG,GAALz9H,MAAoBy4C,aAAeD,EACrC,CAEA2O,wBAAAA,CAAyBzsC,GACvBkP,EAAK6zG,GAALz9H,MAAoBgoB,UAAUqc,OAAO,WAAY3pB,EACnD,CAEA,wBAAIwwC,GACF,GAAIthC,EAAK+zG,GAAL39H,MACF,OAAO4pB,EAAK+zG,GAAL39H,MAET,MAAM,EAAE8V,EAAC,EAAEC,EAAC,OAAEkK,GAAW2J,EAAK6zG,GAALz9H,MAAoBokC,yBAE3CtuB,EAAGkiC,EACHjiC,EAAGkiC,EACHj4B,MAAO0wB,EACPzwB,OAAQ0wB,GACN/mB,EAAKq0G,GAALj+H,MAAmBo/B,MAAMgF,wBAC7B,MAAO,EAAEtuB,EAAIkiC,GAAWtH,GAAc36B,EAAIkK,EAASg4B,GAAWtH,EAChE,CAEA,wBAAIua,CAAqBn4C,GACvBmW,EAAKy0G,GAAL39H,KAAsB+S,EACxB,CAEAmlC,uBAAAA,GACE,OAA+B,OAAxBtuB,EAAK+zG,GAAL39H,KACT,CAEA,yBAAIo3C,GACF,OAAOxtB,EAAK8zG,GAAL19H,KACT,CAEA,sBAAI23C,GACF,OACE/tB,EAAK6zG,GAALz9H,MAAoBokC,wBAAwBpkB,MAC5ChgB,KAAK8nD,yBAAyB9nC,KAElC,CAEAmhB,WAAAA,CAAYz1B,GACV,MAAO01B,EAAMC,GACXzX,EAAK+zG,GAAL39H,OAAuBA,KAAKo3C,sBAAsBvzB,IAAI/N,GAAKA,EAAI,KAC3D6iC,EAAmB34C,KAAK8nD,0BAE5BhyC,EAAGkiC,EACHjiC,EAAGkiC,EACHj4B,MAAO0wB,EACPzwB,OAAQ0wB,GACNgI,EACJ/uB,EAAK6yG,GAALz8H,MAAqBuhC,WACnB,KACAvhC,KACAg4C,EAAU5W,EAAOsP,EACjBuH,EAAU5W,EAAOsP,GAAY3E,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACxBtgC,GAAO,IAAEitC,qBAElB,CAEAl9B,MAAAA,GAAS,IAAAgkH,EAAAC,EACP,GAAI91G,EAAK0zG,GAALt9H,MACF,OAGF,MAAM2nD,EAASz+B,EAAKo0G,GAALt9H,KAAc+b,SAASC,cAAc,QAGpD,GAFA2rC,EAAMjgC,UAAY,QAEdkC,EAAKkzG,GAAL98H,MAAa,CACf,MAAM2/H,EAAah4E,EAAMtsC,MAAMukH,aAAehuH,GAAKC,gBAC9C+X,EAAKkzG,GAAL98H,OAEL2nD,EAAMtsC,MAAMi8B,gBAAkB,sBAAHtsC,OAAyB20H,EAAS,eAC/D,CAEA,MAAME,EAAS9jH,SAASC,cAAc,QAEtC,GADA6jH,EAAOn4G,UAAY,SACD,QAAlB+3G,EAAI71G,EAAKk0G,GAAL99H,aAAc,IAAAy/H,GAAdA,EAAgBtwH,IAAK,CACvB,MAAM8d,EAAQlR,SAASC,cAAc,QACrCiR,EAAMvF,UAAY,QAClBm4G,EAAOzjH,OAAO6Q,KACXxF,IAAKwF,EAAMxF,IAAKtY,IAAK8d,EAAMvU,aAAgBkR,EAAKk0G,GAAL99H,MAChD,CAGA,GAFA2nD,EAAMvrC,OAAOyjH,GAETj2G,EAAKqzG,GAALj9H,MAAe,CACjB,MAAM8/C,EAAmB/jC,SAASC,cAAc,QAChD8jC,EAAiBp4B,UAAY,YAC7Bo4B,EAAiB1lC,aACf,eACA,qCAEF0lC,EAAiB1lC,aACf,iBACAisB,KAAKC,UAAU,CAAEw5F,QAASl2G,EAAKqzG,GAALj9H,MAAck6H,aAE1Cp6E,EAAiBigF,SAAWn2G,EAAKqzG,GAALj9H,MAAcq5H,cAC1CwG,EAAOzjH,OAAO0jC,EAChB,CAEAx4B,GACE,CACE9N,KAAMpa,EAAA++H,GAAAn+H,KAAKggI,KAASp2G,EAAKozG,GAALh9H,MAAkBmP,IACtCsY,IAAsB,QAAnBi4G,EAAE91G,EAAKozG,GAALh9H,aAAiB,IAAA0/H,OAAA,EAAjBA,EAAmBj4G,IACxBC,UAAW,gBAEbigC,GAGF/9B,EAAKmzG,GAAL/8H,MAAgBoc,OAAOurC,EACzB,CAmEAkG,YAAAA,CAAYoyE,GAA2B,IAAAC,EAAA,IAA1B,KAAEvsH,EAAI,MAAEg0C,EAAK,QAAEtc,GAAS40F,EACnC,GAAIr2G,EAAK6yG,GAALz8H,MAiBF,OAhBIqrC,GACFrrC,KAAK8qB,SACL5B,EAAKg1G,GAALl+H,KAAoB,OACX2nD,IACLA,EAAMtc,QACRrrC,KAAK8qB,UAEL5rB,EAAAi/H,GAAAn+H,KAAKo/H,IAAY/tH,KAAjBrR,MACAkpB,EAAKg1G,GAALl+H,KAAoB2nD,EAAMzpC,aAG1BvK,IACFuV,EAAKw0G,GAAL19H,KAA8B,MAC9Bd,EAAAi/H,GAAAn+H,KAAK8+H,IAAyBztH,KAA9BrR,MACAd,EAAAi/H,GAAAn+H,KAAKq/H,IAA4BhuH,KAAjCrR,QAIAqrC,GAAgB,OAALsc,QAAK,IAALA,GAAAA,EAAOtc,QACpBrrC,KAAK8qB,UAGP5rB,EAAAi/H,GAAAn+H,KAAK2+H,IAAkBttH,KAAvBrR,MACA4pB,EAAKm0G,GAAL/9H,OAAAkpB,EAAK60G,GAAL/9H,KAAkB,CAChBwrC,YAAa5hB,EAAKozG,GAALh9H,MACb84C,SAAUlvB,EAAKi0G,GAAL79H,QAER2T,GACFuV,EAAKs0G,GAALx9H,KAAiB,MAEf2nD,GAASA,EAAMzpC,OACjBgL,EAAK20G,GAAL79H,KAAiBd,EAAAi/H,GAAAn+H,KAAKmgI,IAAiB9uH,KAAtBrR,KAAuB2nD,EAAMzpC,OAC9CgL,EAAK+zG,GAALj9H,KAAgBwiB,GAAcC,aAAaklC,EAAM5O,OACjD7vB,EAAK8zG,GAALh9H,KAAoB,OAEX,QAAXkgI,EAAAt2G,EAAK0zG,GAALt9H,aAAW,IAAAkgI,GAAXA,EAAap1G,SACb5B,EAAKo0G,GAALt9H,KAAc,MAChB,CAEA0uH,WAAAA,GAAc,IAAA0R,EACPx2G,EAAKm0G,GAAL/9H,UAGFwrC,YAAWxtC,EAAAkrB,EAAA,CAAO8zG,GAALh9H,OAAI4iB,EAAek2B,SAAQ96C,EAAAkrB,EAAA,CAAO20G,GAAL79H,OAAI4iB,GAC/CgH,EAAKm0G,GAAL/9H,OACFkpB,EAAK60G,GAAL/9H,KAAgB,MACL,QAAXogI,EAAAx2G,EAAK0zG,GAALt9H,aAAW,IAAAogI,GAAXA,EAAat1G,SACb5B,EAAKo0G,GAALt9H,KAAc,MACdkpB,EAAKs0G,GAALx9H,KAAiB,MACnB,CAEA8qB,MAAAA,GAAS,IAAAu1G,EAAAC,EAAAC,EASP,GAR0B,QAA1BF,EAAAz2G,EAAK2zG,GAALv9H,aAA0B,IAAAqgI,GAA1BA,EAA4BlhG,QAC5BjW,EAAKq0G,GAALv9H,KAA6B,MAClB,QAAXsgI,EAAA12G,EAAK0zG,GAALt9H,aAAW,IAAAsgI,GAAXA,EAAax1G,SACb5B,EAAKo0G,GAALt9H,KAAc,MACdkpB,EAAK80G,GAALh+H,MAAmB,GACnBkpB,EAAKm0G,GAALr9H,MAAe,GACI,QAAnBugI,EAAA32G,EAAK6zG,GAALz9H,aAAmB,IAAAugI,GAAnBA,EAAqBz1G,SACrB5B,EAAKu0G,GAALz9H,KAAsB,MAClBA,KAAKy+H,QACP,IAAK,MAAM/kH,KAAW1Z,KAAKy+H,QACzB/kH,EAAQsO,UAAU8C,OAAO,mBAG/B,CAiGAwnG,SAAAA,GACEppG,EAAK80G,GAALh+H,KAAmBA,KAAKg4F,WACnBpuE,EAAKo0G,GAALh+H,QAGL4pB,EAAKmzG,GAAL/8H,MAAgBod,QAAS,EAC3B,CAEAg1G,SAAAA,GACMxoG,EAAK6yG,GAALz8H,QAGJd,EAAAi/H,GAAAn+H,KAAK2+H,IAAkBttH,KAAvBrR,MACK4pB,EAAKo0G,GAALh+H,QAGA4pB,EAAK0zG,GAALt9H,OACHd,EAAAi/H,GAAAn+H,KAAKu+H,IAAKltH,KAAVrR,MAEFkpB,EAAK80G,GAALh+H,MAAmB,GACnB4pB,EAAKmzG,GAAL/8H,MAAgBod,QAAS,GAC3B,CAEA,aAAI46E,GACF,OAAIpuE,EAAK6yG,GAALz8H,QAG8B,IAA3B4pB,EAAKmzG,GAAL/8H,MAAgBod,MACzB,EACF,SAAAuhH,KA1iBI,GAAI/0G,EAAK2zG,GAALv9H,MACF,OAEFkpB,EAAKq0G,GAALv9H,KAA6B,IAAIi9B,iBACjC,MAAM,OAAEtT,GAAWC,EAAK2zG,GAALv9H,MAGnB,IAAK,MAAM0Z,KAAW1Z,KAAKy+H,QACzB/kH,EAAQK,iBAAiB,QAAS6P,EAAKizG,GAAL78H,MAAmB,CAAE2pB,WACvDjQ,EAAQK,iBAAiB,eAAgB6P,EAAKgzG,GAAL58H,MAAiB,CAAE2pB,WAC5DjQ,EAAQK,iBAAiB,eAAgB6P,EAAK+yG,GAAL38H,MAAiB,CAAE2pB,WAC5DjQ,EAAQsO,UAAUhpB,IAAI,oBAIxB,IAAK,MAAM0a,KAAWkQ,EAAKszG,GAALl9H,MAAgB,KAAAwgI,EACnB,QAAjBA,EAAA9mH,EAAQ8N,iBAAS,IAAAg5G,GAAjBA,EAAmBzmH,iBAAiB,UAAW6P,EAAK8yG,GAAL18H,MAAoB,CACjE2pB,UAEJ,CACF,UAAAm1G,KAGE,MAAMplH,EAAUkQ,EAAKszG,GAALl9H,MAAeygI,KAAKviI,GAAKA,EAAEwvH,kBACtCh0G,GAGLwP,EAAKw0G,GAAL19H,KAA8B0Z,EAAQs0G,gBACpCt0G,EAAQ09B,uBAEZ,UAAAioF,KA2EE,GAAIz1G,EAAKq0G,GAALj+H,MAAmB0xH,oBAAsB9nG,EAAKq0G,GAALj+H,MAAmBwoB,OAG9D,OAEGoB,EAAK6zG,GAALz9H,OACHA,KAAK4+H,sBAEP,MAAO9oH,EAAGC,GAAK6T,EAAK8zG,GAAL19H,OACT,MAAEqb,GAAUuO,EAAK6zG,GAALz9H,MAClBqb,EAAMooC,KAAO,QAAHz4C,OAAW8K,EAAC,MACtBuF,EAAMkP,IAAM,QAAHvf,OAAW+K,EAAC,iCACvB,UAAAqpH,KAGMx1G,EAAKq0G,GAALj+H,MAAmB0xH,oBAGlB9nG,EAAK6zG,GAALz9H,OACHA,KAAK4+H,sBAEPh1G,EAAK6zG,GAALz9H,MAAoBqb,MAAMi8B,gBAAkBt3C,KAAKq3C,oBAAsB,GACzE,UAAA2oF,GAAAU,GA0KE,MAAM5nF,EAAWlvB,EAAKi0G,GAAS6C,GACzBl1F,EAAc5hB,EAAKozG,GAAY0D,GACrC,OACU,OAAR5nF,QAAQ,IAARA,IAAAA,EAAU3pC,KACG,OAAXq8B,QAAW,IAAXA,GAAAA,EAAar8B,KAAOq8B,EAAYr8B,MAAQ2pC,EAAS3pC,IAI9C,KAFEya,EAAKi0G,GAAS6C,GAAClnH,MAAQ,IAGlC,UAAAmnH,GAAAC,GAEgB,IAAAC,EACd,OAAiB,QAAVA,EAAAzhI,EAAA++H,GAAAyC,EAAKZ,WAAK,IAAAa,GAAY,QAAZA,EAAVA,EAAY1nH,kBAAU,IAAA0nH,GAAO,QAAPA,EAAtBA,EAAwBxlH,aAAK,IAAAwlH,OAAA,EAA7BA,EAA+BrxC,WAAY,CACpD,UAAAsxC,GAAAC,GAEiB,IAAAC,EACf,OAAiB,QAAVA,EAAA5hI,EAAA++H,GAAA4C,EAAKf,WAAK,IAAAgB,GAAY,QAAZA,EAAVA,EAAY7nH,kBAAU,IAAA6nH,GAAO,QAAPA,EAAtBA,EAAwB3lH,aAAK,IAAA2lH,OAAA,EAA7BA,EAA+Br9G,QAAS,IACjD,UAAAw8G,GAEkBjiH,GAChB,MAAM+iH,EAAa,GACbC,EAAe,CACnB/xH,IAAK+O,EACL1E,KAAM,CACJjM,KAAM,MACN4L,WAAY,CACVsO,IAAK,QAEPrO,SAAU,CACR,CACE7L,KAAM,IACN6L,SAAU6nH,MAKZE,EAAiB,CACrB9lH,MAAO,CACLsI,MAAOvkB,EAAA++H,GAAAn+H,KAAK8gI,IACZtxC,SAAUpwF,EAAA++H,GAAAn+H,KAAK2gI,IAAS,QAAA31H,OACZ5L,EAAA++H,GAAAn+H,KAAK2gI,IAAS,mCACtB,KAGR,IAAK,MAAM74G,KAAQ5J,EAAKrR,MAAM,MAC5Bo0H,EAAWjyH,KAAK,CACdzB,KAAM,OACNzN,MAAOgoB,EACP3O,WAAYgoH,IAGhB,OAAOD,CACT,UAAA7C,GAESrkH,GACHA,EAAMuc,QAAUvc,EAAM0c,UAAY1c,EAAMwc,SAAWxc,EAAMyc,UAI3C,UAAdzc,EAAMkB,KAAkC,WAAdlB,EAAMkB,KAAoB0O,EAAKyzG,GAALr9H,QACtDd,EAAAi/H,GAAAn+H,KAAKw+H,IAAOntH,KAAZrR,KAEJ,UAAAohI,KAwEE,GAAuB,OAAnBx3G,EAAK4zG,GAALx9H,MACF,OAEF,MACE8iE,MAAM,KAAEhH,GACRz/C,UACE6D,SAAS,UAAEE,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,KAEzCqJ,EAAKuzG,GAALn9H,MAEJ,IAAIqhI,IAAkBz3G,EAAKwzG,GAALp9H,MAClB2T,EAAuBiW,EAAhBy3G,EAAqBjE,GAAmBQ,GAAxB59H,MAC3B,IAAK,MAAM0Z,KAAWkQ,EAAKszG,GAALl9H,MACpB,IAAK2T,GAAoD,OAA5C/B,GAAK0D,UAAUoE,EAAQwO,KAAKvU,KAAMA,GAAgB,CAC7DA,EAAO+F,EAAQwO,KAAKvU,KACpB0tH,GAAgB,EAChB,KACF,CAGF,MAAMC,EAAiB1vH,GAAKwD,cAAc,CACxCzB,EAAK,GACLmoD,EAAK,GAAKnoD,EAAK,GAAKmoD,EAAK,GACzBnoD,EAAK,GACLmoD,EAAK,GAAKnoD,EAAK,GAAKmoD,EAAK,KAIrBprB,EAAc2wF,EAChB1tH,EAAK,GAAKA,EAAK,GAFuB,EAGtC,EACE4tH,EAAYD,EAAe,GAAK5wF,EAChC8wF,EAAWF,EAAe,GAChCp4G,EAAKs0G,GAALx9H,KAAiB,CACd,KAAOuhI,EAAYjhH,GAAUF,EAC7B,KAAOohH,EAAWjhH,GAAUF,IAG/B,MAAM,MAAEhF,GAAUuO,EAAKmzG,GAAL/8H,MAClBqb,EAAMooC,KAAO,GAAHz4C,OAAM4e,EAAK4zG,GAALx9H,MAAe,GAAE,KACjCqb,EAAMkP,IAAM,GAAHvf,OAAM4e,EAAK4zG,GAALx9H,MAAe,GAAE,IAClC,UAAAw+H,KAMM50G,EAAK6yG,GAALz8H,MACF4pB,EAAK6yG,GAALz8H,MAAqBuiC,mBAAmBviC,MAAyB,IAInEkpB,EAAKm0G,GAALr9H,MAAgB4pB,EAAKyzG,GAALr9H,OACZ4pB,EAAKyzG,GAALr9H,OACFd,EAAAi/H,GAAAn+H,KAAKu+H,IAAKltH,KAAVrR,MACA4pB,EAAKmzG,GAAL/8H,MAAgB+Z,iBAAiB,QAAS6P,EAAKizG,GAAL78H,OAC1C4pB,EAAKmzG,GAAL/8H,MAAgB+Z,iBAAiB,UAAW6P,EAAK8yG,GAAL18H,SAE5Cd,EAAAi/H,GAAAn+H,KAAKs+H,IAAKjtH,KAAVrR,MACA4pB,EAAKmzG,GAAL/8H,MAAgB0jE,oBAAoB,QAAS95C,EAAKizG,GAAL78H,OAC7C4pB,EAAKmzG,GAAL/8H,MAAgB0jE,oBAAoB,UAAW95C,EAAK8yG,GAAL18H,QAEnD,UAAAu+H,KAMO30G,EAAK0zG,GAALt9H,OACHA,KAAKyb,SAEFzb,KAAKg4F,UAKCpuE,EAAKyzG,GAALr9H,OACT4pB,EAAKmzG,GAAL/8H,MAAgBgoB,UAAUhpB,IAAI,YAL9BE,EAAAi/H,GAAAn+H,KAAKohI,IAAY/vH,KAAjBrR,MACA4pB,EAAKmzG,GAAL/8H,MAAgBod,QAAS,EACzBwM,EAAKmzG,GAAL/8H,MAAgBqb,MAAM2mC,OACpB/+B,SAAS2G,EAAKmzG,GAAL/8H,MAAgBqb,MAAM2mC,QAAU,IAI/C,UAAAs8E,KAME10G,EAAKmzG,GAAL/8H,MAAgBgoB,UAAU8C,OAAO,YAC7BlB,EAAKyzG,GAALr9H,OAAiBA,KAAKg4F,YAG1BpuE,EAAKmzG,GAAL/8H,MAAgBod,QAAS,EACzBwM,EAAKmzG,GAAL/8H,MAAgBqb,MAAM2mC,OACpB/+B,SAAS2G,EAAKmzG,GAAL/8H,MAAgBqb,MAAM2mC,QAAU,IAC7C,CAiCF,MAAMgpE,WAAkCc,GACtCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IACtDpsH,KAAK0Y,YAAcgD,EAAWwM,KAAKxP,YACnC1Y,KAAKyhI,aAAe/lH,EAAWwM,KAAKu5G,aACpCzhI,KAAK2yH,qBAAuBzxH,EAAqBE,QACnD,CAEAqa,MAAAA,GAGE,GAFAzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,sBAEzBgB,KAAK0Y,YAAa,CACpB,MAAMq1C,EAAW/tD,KAAK+sH,eAAiBhxG,SAASC,cAAc,OAC9D+xC,EAAQ/lC,UAAUhpB,IAAI,yBACtB+uD,EAAQ3zC,aAAa,OAAQ,WAC7B,IAAK,MAAM0N,KAAQ9nB,KAAK0Y,YAAa,CACnC,MAAMgpH,EAAW3lH,SAASC,cAAc,QACxC0lH,EAAShpH,YAAcoP,EACvBimC,EAAQ3xC,OAAOslH,EACjB,CACA1hI,KAAKwnB,UAAUpL,OAAO2xC,EACxB,CASA,OAPK/tD,KAAKkoB,KAAKqjB,UAAYvrC,KAAKstH,eAC9BttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAK0yH,qBAEE1yH,KAAKwnB,SACd,EACF,IAAAm6G,GAAA,IAAAh0G,QAEA,MAAMs9F,WAA8Ba,GAGlCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IAHxDntH,EAAA,KAAA0iI,GAAQ,KAIR,CAEAlmH,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,kBAK7B,MAAM,KAAEkpB,EAAI,MAAElI,EAAK,OAAEC,GAAWjgB,KAC1B+sE,EAAM/sE,KAAKysH,WAAW3zG,OAC1BkH,EACAC,GACuB,GAKnB6H,EAAQoB,EAAKy4G,GAAL3hI,KAAaA,KAAKysH,WAAWzwG,cAAc,aAqBzD,OApBA8L,EAAK1N,aAAa,KAAM8N,EAAKvU,KAAK,GAAKuU,EAAK05G,gBAAgB,IAC5D95G,EAAK1N,aAAa,KAAM8N,EAAKvU,KAAK,GAAKuU,EAAK05G,gBAAgB,IAC5D95G,EAAK1N,aAAa,KAAM8N,EAAKvU,KAAK,GAAKuU,EAAK05G,gBAAgB,IAC5D95G,EAAK1N,aAAa,KAAM8N,EAAKvU,KAAK,GAAKuU,EAAK05G,gBAAgB,IAG5D95G,EAAK1N,aAAa,eAAgB8N,EAAK6mG,YAAY/uG,OAAS,GAC5D8H,EAAK1N,aAAa,SAAU,eAC5B0N,EAAK1N,aAAa,OAAQ,eAE1B2yD,EAAI3wD,OAAO0L,GACX9nB,KAAKwnB,UAAUpL,OAAO2wD,IAIjB7kD,EAAKqjB,UAAYvrC,KAAKstH,eACzBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGAzuH,KAAKwnB,SACd,CAEA+qG,yBAAAA,GACE,OAAO3oG,EAAK+3G,GAAL3hI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EACF,IAAA6iI,GAAA,IAAAl0G,QAEA,MAAMu9F,WAAgCY,GAGpCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IAHxDntH,EAAA,KAAA4iI,GAAU,KAIV,CAEApmH,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,oBAK7B,MAAM,KAAEkpB,EAAI,MAAElI,EAAK,OAAEC,GAAWjgB,KAC1B+sE,EAAM/sE,KAAKysH,WAAW3zG,OAC1BkH,EACAC,GACuB,GAMnB+uG,EAAc9mG,EAAK6mG,YAAY/uG,MAC/B8hH,EAAU54G,EAAK24G,GAAL7hI,KAAeA,KAAKysH,WAAWzwG,cAAc,aAqB7D,OApBA8lH,EAAO1nH,aAAa,IAAK40G,EAAc,GACvC8S,EAAO1nH,aAAa,IAAK40G,EAAc,GACvC8S,EAAO1nH,aAAa,QAAS4F,EAAQgvG,GACrC8S,EAAO1nH,aAAa,SAAU6F,EAAS+uG,GAGvC8S,EAAO1nH,aAAa,eAAgB40G,GAAe,GACnD8S,EAAO1nH,aAAa,SAAU,eAC9B0nH,EAAO1nH,aAAa,OAAQ,eAE5B2yD,EAAI3wD,OAAO0lH,GACX9hI,KAAKwnB,UAAUpL,OAAO2wD,IAIjB7kD,EAAKqjB,UAAYvrC,KAAKstH,eACzBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGAzuH,KAAKwnB,SACd,CAEA+qG,yBAAAA,GACE,OAAO3oG,EAAKi4G,GAAL7hI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EACF,IAAA+iI,GAAA,IAAAp0G,QAEA,MAAMw9F,WAAgCW,GAGpCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IAHxDntH,EAAA,KAAA8iI,GAAU,KAIV,CAEAtmH,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,oBAK7B,MAAM,KAAEkpB,EAAI,MAAElI,EAAK,OAAEC,GAAWjgB,KAC1B+sE,EAAM/sE,KAAKysH,WAAW3zG,OAC1BkH,EACAC,GACuB,GAMnB+uG,EAAc9mG,EAAK6mG,YAAY/uG,MAC/BgiH,EAAU94G,EAAK64G,GAAL/hI,KACdA,KAAKysH,WAAWzwG,cAAc,gBAqBhC,OApBAgmH,EAAO5nH,aAAa,KAAM4F,EAAQ,GAClCgiH,EAAO5nH,aAAa,KAAM6F,EAAS,GACnC+hH,EAAO5nH,aAAa,KAAM4F,EAAQ,EAAIgvG,EAAc,GACpDgT,EAAO5nH,aAAa,KAAM6F,EAAS,EAAI+uG,EAAc,GAGrDgT,EAAO5nH,aAAa,eAAgB40G,GAAe,GACnDgT,EAAO5nH,aAAa,SAAU,eAC9B4nH,EAAO5nH,aAAa,OAAQ,eAE5B2yD,EAAI3wD,OAAO4lH,GACXhiI,KAAKwnB,UAAUpL,OAAO2wD,IAIjB7kD,EAAKqjB,UAAYvrC,KAAKstH,eACzBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGAzuH,KAAKwnB,SACd,CAEA+qG,yBAAAA,GACE,OAAO3oG,EAAKm4G,GAAL/hI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EACF,IAAAijI,GAAA,IAAAt0G,QAEA,MAAMy9F,WAAkCU,GAGtCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IAHxDntH,EAAA,KAAAgjI,GAAY,MAKVjiI,KAAKkiI,mBAAqB,qBAC1BliI,KAAKmiI,eAAiB,cACxB,CAEA1mH,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAIgB,KAAKkiI,oBAKlC,MACEh6G,MAAM,KAAEvU,EAAI,SAAEyuH,EAAQ,YAAErT,EAAW,SAAExjF,GAAU,MAC/CvrB,EAAK,OACLC,GACEjgB,KACJ,IAAKoiI,EACH,OAAOpiI,KAAKwnB,UAEd,MAAMulD,EAAM/sE,KAAKysH,WAAW3zG,OAC1BkH,EACAC,GACuB,GAOzB,IAAIoiH,EAAS,GACb,IAAK,IAAI3zH,EAAI,EAAGuS,EAAKmhH,EAAS/jI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CACpD,MAAMoH,EAAIssH,EAAS1zH,GAAKiF,EAAK,GACvBoC,EAAIpC,EAAK,GAAKyuH,EAAS1zH,EAAI,GACjC2zH,EAAOrzH,KAAK,GAADhE,OAAI8K,EAAC,KAAA9K,OAAI+K,GACtB,CACAssH,EAASA,EAAOpzH,KAAK,KAErB,MAAMqzH,EAAYp5G,EAAK+4G,GAALjiI,KAAiBA,KAAKysH,WAAWzwG,cACjDhc,KAAKmiI,iBAmBP,OAjBAG,EAASloH,aAAa,SAAUioH,GAGhCC,EAASloH,aAAa,eAAgB20G,EAAY/uG,OAAS,GAC3DsiH,EAASloH,aAAa,SAAU,eAChCkoH,EAASloH,aAAa,OAAQ,eAE9B2yD,EAAI3wD,OAAOkmH,GACXtiI,KAAKwnB,UAAUpL,OAAO2wD,IAIjBxhC,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGAzuH,KAAKwnB,SACd,CAEA+qG,yBAAAA,GACE,OAAO3oG,EAAKq4G,GAALjiI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EAGF,MAAMusH,WAAiCH,GACrC59G,WAAAA,CAAYkO,GAEV/N,MAAM+N,GAEN1b,KAAKkiI,mBAAqB,oBAC1BliI,KAAKmiI,eAAiB,aACxB,EAGF,MAAM9W,WAA+BS,GACnCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,GACxD,CAEA3wG,MAAAA,GAOE,OANAzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,oBAExBgB,KAAKkoB,KAAKqjB,UAAYvrC,KAAKstH,eAC9BttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAEAzuH,KAAKwnB,SACd,EACF,IAAA+6G,GAAA,IAAA50G,QAAA60G,GAAA,IAAA70G,QAAA80G,GAAA,IAAA10G,QAEA,MAAMu9F,WAA6BQ,GAKjCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IAAOttH,EAAA,KAAA2jI,IAL/DxjI,EAAA,KAAAsjI,GAAyB,MAEzBtjI,EAAA,KAAAujI,GAAa,IAKXxiI,KAAKkiI,mBAAqB,gBAI1BliI,KAAKmiI,eAAiB,eAEtBniI,KAAK2yH,qBACc,iBAAjB3yH,KAAKkoB,KAAKw6G,GACNxhI,EAAqBG,UACrBH,EAAqBK,GAC7B,CAkCAka,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAIgB,KAAKkiI,oBAIlC,MACEh6G,MAAM,KAAEvU,EAAI,SAAEyL,EAAQ,SAAE0uG,EAAQ,YAAEiB,EAAW,SAAExjF,IAC7CvrC,MACE,UAAEsF,EAAS,MAAE0a,EAAK,OAAEC,GAAW/gB,EAAAujI,GAAAziI,KAAK2iI,IAAatxH,KAAlBrR,KAAmBof,EAAUzL,GAE5Do5D,EAAM/sE,KAAKysH,WAAW3zG,OAC1BkH,EACAC,GACuB,GAEnBnO,EAAKoX,EAAKq5G,GAALviI,KACTA,KAAKysH,WAAWzwG,cAAc,UAChC+wD,EAAI3wD,OAAOtK,GAGXA,EAAEsI,aAAa,eAAgB20G,EAAY/uG,OAAS,GACpDlO,EAAEsI,aAAa,iBAAkB,SACjCtI,EAAEsI,aAAa,kBAAmB,SAClCtI,EAAEsI,aAAa,oBAAqB,IACpCtI,EAAEsI,aAAa,SAAU,eACzBtI,EAAEsI,aAAa,OAAQ,eACvBtI,EAAEsI,aAAa,YAAa9U,GAE5B,IAAK,IAAIoJ,EAAI,EAAGuS,EAAK6sG,EAASzvH,OAAQqQ,EAAIuS,EAAIvS,IAAK,CACjD,MAAM4zH,EAAWtiI,KAAKysH,WAAWzwG,cAAchc,KAAKmiI,gBACpDv4G,EAAK44G,GAALxiI,MAAgBgP,KAAKszH,GACrBA,EAASloH,aAAa,SAAU0zG,EAASp/G,GAAGO,KAAK,MACjD6C,EAAEsK,OAAOkmH,EACX,CAUA,OARK/2F,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUpL,OAAO2wD,GACtB/sE,KAAK0yH,qBAEE1yH,KAAKwnB,SACd,CAEAqmC,YAAAA,CAAa5f,GACXtgC,MAAMkgD,aAAa5f,GACnB,MAAM,UAAE20F,EAAS,OAAEP,EAAM,KAAE1uH,GAASs6B,EAC9Bn8B,EAAI8X,EAAK24G,GAALviI,MAIV,GAHI4iI,GAAa,GACf9wH,EAAEsI,aAAa,eAAgBwoH,GAAa,GAE1CP,EACF,IAAK,IAAI3zH,EAAI,EAAGuS,EAAK2I,EAAK44G,GAALxiI,MAAgB3B,OAAQqQ,EAAIuS,EAAIvS,IACnDkb,EAAK44G,GAALxiI,MAAgB0O,GAAG0L,aAAa,SAAUioH,EAAO3zH,GAAGO,KAAK,MAG7D,GAAI0E,EAAM,CACR,MAAM,UAAErO,EAAS,MAAE0a,EAAK,OAAEC,GAAW/gB,EAAAujI,GAAAziI,KAAK2iI,IAAatxH,KAAlBrR,KACnCA,KAAKkoB,KAAK9I,SACVzL,GAEW7B,EAAEigC,cACV33B,aAAa,UAAW,OAAFpP,OAASgV,EAAK,KAAAhV,OAAIiV,IAC7CnO,EAAEsI,aAAa,YAAa9U,EAC9B,CACF,CAEAitH,yBAAAA,GACE,OAAO3oG,EAAK44G,GAALxiI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EACF,SAAA2jI,GA5GgBvjH,EAAUzL,GAItB,OAAQyL,GACN,KAAK,GACH,MAAO,CACL9Z,UAAW,wBAAF0F,QAA2B2I,EAAK,GAAE,KAAA3I,OAAI2I,EAAK,GAAE,iBACtDqM,MAAOrM,EAAK,GAAKA,EAAK,GACtBsM,OAAQtM,EAAK,GAAKA,EAAK,IAE3B,KAAK,IACH,MAAO,CACLrO,UAAW,yBAAF0F,QAA4B2I,EAAK,GAAE,KAAA3I,OAAI2I,EAAK,GAAE,iBACvDqM,MAAOrM,EAAK,GAAKA,EAAK,GACtBsM,OAAQtM,EAAK,GAAKA,EAAK,IAE3B,KAAK,IACH,MAAO,CACLrO,UAAW,yBAAF0F,QAA4B2I,EAAK,GAAE,KAAA3I,OAAI2I,EAAK,GAAE,iBACvDqM,MAAOrM,EAAK,GAAKA,EAAK,GACtBsM,OAAQtM,EAAK,GAAKA,EAAK,IAE3B,QACE,MAAO,CACLrO,UAAW,aAAF0F,QAAgB2I,EAAK,GAAE,KAAA3I,OAAI2I,EAAK,GAAE,iBAC3CqM,MAAOrM,EAAK,GAAKA,EAAK,GACtBsM,OAAQtM,EAAK,GAAKA,EAAK,IAG/B,CAgFF,MAAM63G,WAAmCM,GACvCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAChBywG,cAAc,EACdC,cAAc,EACdC,sBAAsB,IAExBrsH,KAAK2yH,qBAAuBzxH,EAAqBG,SACnD,CAEAoa,MAAAA,GACE,MACEyM,MAAM,aAAEorG,EAAY,SAAE/nF,IACpBvrC,KASJ,IARKurC,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,uBAC7BgB,KAAK0yH,qBAEDY,EAAc,CAChB,MAAMuP,EAAO9mH,SAASC,cAAc,QACpC6mH,EAAK76G,UAAUhpB,IAAI,gBACnB6jI,EAAKnqH,YAAc46G,EACnBtzH,KAAKwnB,UAAUpL,OAAOymH,EACxB,CAEA,OAAO7iI,KAAKwnB,SACd,EAGF,MAAMikG,WAAmCK,GACvCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAChBywG,cAAc,EACdC,cAAc,EACdC,sBAAsB,GAE1B,CAEA5wG,MAAAA,GACE,MACEyM,MAAM,aAAEorG,EAAY,SAAE/nF,IACpBvrC,KAQJ,IAPKurC,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,uBAEzBs0H,EAAc,CAChB,MAAMwP,EAAY/mH,SAASC,cAAc,KACzC8mH,EAAU96G,UAAUhpB,IAAI,gBACxB8jI,EAAUpqH,YAAc46G,EACxBtzH,KAAKwnB,UAAUpL,OAAO0mH,EACxB,CAEA,OAAO9iI,KAAKwnB,SACd,EAGF,MAAMkkG,WAAkCI,GACtCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAChBywG,cAAc,EACdC,cAAc,EACdC,sBAAsB,GAE1B,CAEA5wG,MAAAA,GACE,MACEyM,MAAM,aAAEorG,EAAY,SAAE/nF,IACpBvrC,KAQJ,IAPKurC,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,sBAEzBs0H,EAAc,CAChB,MAAMwP,EAAY/mH,SAASC,cAAc,KACzC8mH,EAAU96G,UAAUhpB,IAAI,gBACxB8jI,EAAUpqH,YAAc46G,EACxBtzH,KAAKwnB,UAAUpL,OAAO0mH,EACxB,CAEA,OAAO9iI,KAAKwnB,SACd,EAGF,MAAMmkG,WAAmCG,GACvCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAChBywG,cAAc,EACdC,cAAc,EACdC,sBAAsB,GAE1B,CAEA5wG,MAAAA,GACE,MACEyM,MAAM,aAAEorG,EAAY,SAAE/nF,IACpBvrC,KAQJ,IAPKurC,GAAYvrC,KAAKstH,eACpBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAGPzuH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,uBAEzBs0H,EAAc,CAChB,MAAMyP,EAAYhnH,SAASC,cAAc,KACzC+mH,EAAU/6G,UAAUhpB,IAAI,gBACxB+jI,EAAUrqH,YAAc46G,EACxBtzH,KAAKwnB,UAAUpL,OAAO2mH,EACxB,CAEA,OAAO/iI,KAAKwnB,SACd,EAGF,MAAMokG,WAA+BE,GACnCt+G,WAAAA,CAAYkO,GACV/N,MAAM+N,EAAY,CAAEywG,cAAc,EAAMC,cAAc,IACtDpsH,KAAK2yH,qBAAuBzxH,EAAqBI,KACnD,CAEAma,MAAAA,GAUE,OATAzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,mBAC7BgB,KAAKwnB,UAAUpN,aAAa,OAAQ,QAE/Bpa,KAAKkoB,KAAKqjB,UAAYvrC,KAAKstH,eAC9BttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAEPzuH,KAAK0yH,qBAEE1yH,KAAKwnB,SACd,EACF,IAAAw7G,GAAA,IAAAr1G,QAAAs1G,GAAA,IAAAl1G,QAEA,MAAM89F,WAAwCC,GAG5Ct+G,WAAAA,CAAYkO,GAAY,IAAAwnH,EACtBv1H,MAAM+N,EAAY,CAAEywG,cAAc,IAAOrtH,EAAA,KAAAmkI,IAH3ChkI,EAAA,KAAA+jI,GAAW,MAKT,MAAM,KAAE/wG,GAASjyB,KAAKkoB,KACtBloB,KAAKshB,SAAW2Q,EAAK3Q,SACrBthB,KAAK+tD,QAAU97B,EAAK87B,QAEK,QAAzBm1E,EAAAljI,KAAK+a,YAAYwhB,gBAAQ,IAAA2mG,GAAzBA,EAA2Bx/F,SAAS,4BAA0BsI,EAAAA,EAAAA,GAAA,CAC5DrI,OAAQ3jC,MACLiyB,GAEP,CAEAxW,MAAAA,GACEzb,KAAKwnB,UAAUQ,UAAUhpB,IAAI,4BAE7B,MAAM,UAAEwoB,EAAS,KAAEU,GAASloB,KAC5B,IAAIy+H,EACAv2G,EAAKovG,eAAoC,IAAnBpvG,EAAKyiE,UAC7B8zC,EAAU1iH,SAASC,cAAc,QAOjCyiH,EAAU1iH,SAASC,cAAc,OACjCyiH,EAAQ7sG,IAAM,GAAH5mB,OAAMhL,KAAKusH,mBAAkB,eAAAvhH,OACtC,aAAauW,KAAK2G,EAAK3a,MAAQ,YAAc,UAAS,QAGpD2a,EAAKyiE,WAAaziE,EAAKyiE,UAAY,IACrC8zC,EAAQpjH,MAAQ,mBAAHrQ,OAAsB4D,KAAK21C,MACrB,IAAjBr8B,EAAKyiE,WACN,SAOL8zC,EAAQ1kH,iBAAiB,WAAY7a,EAAA+jI,GAAAjjI,KAAKmjI,IAAU51G,KAAKvtB,OACzDkpB,EAAK85G,GAALhjI,KAAgBy+H,GAEhB,MAAM,MAAE7tH,GAAUtB,GAAYgB,SAe9B,OAdAkX,EAAUzN,iBAAiB,UAAW8jB,IACpB,UAAZA,EAAI3iB,MAAoBtK,EAAQitB,EAAIpH,QAAUoH,EAAIrH,UACpDt3B,EAAA+jI,GAAAjjI,KAAKmjI,IAAS9xH,KAAdrR,SAICkoB,EAAKqjB,UAAYvrC,KAAKstH,cACzBttH,KAAK8sH,qBAAsB,EAC3B9sH,KAAKyuH,gBAELgQ,EAAQz2G,UAAUhpB,IAAI,oBAGxBwoB,EAAUpL,OAAOqiH,GACVj3G,CACT,CAEA+qG,yBAAAA,GACE,OAAO3oG,EAAKo5G,GAALhjI,KACT,CAEAwyH,gBAAAA,GACExyH,KAAKwnB,UAAUQ,UAAUhpB,IAAI,gBAC/B,EAQF,SAAAmkI,KAHc,IAAAC,EACU,QAApBA,EAAApjI,KAAKssH,uBAAe,IAAA8W,GAApBA,EAAsB9N,mBAAmBt1H,KAAK+tD,QAAS/tD,KAAKshB,SAC9D,KAAA+hH,GAAA,IAAA11G,QAAA21G,GAAA,IAAA31G,QAAA41G,GAAA,IAAA51G,QAAA61G,GAAA,IAAA71G,QAAA81G,GAAA,IAAA91G,QAAA+1G,GAAA,IAAA/1G,QAAAg2G,GAAA,IAAAh2G,QAAAi2G,GAAA,IAAAj2G,QAAAk2G,GAAA,IAAA91G,QA6BF,MAAM+1G,GAiBJt2H,WAAAA,CAAWu2H,GAWR,IAXS,IACV5nH,EAAG,qBACH6nH,EAAoB,oBACpBp/C,EAAmB,0BACnBq/C,EAAyB,KACzBnhE,EAAI,SACJzmD,EAAQ,gBACR6nH,EAAe,eACf5nG,EAAc,YACdvhB,EAAW,kBACXY,GACDooH,EAAAjlI,EAAA,KAAA+kI,IA3BD5kI,EAAA,KAAAokI,GAAwB,MAExBpkI,EAAA,KAAAqkI,GAAuB,MAEvBrkI,EAAA,KAAAskI,GAAqB,MAErBtkI,EAAA,KAAAukI,GAAuB,IAAIn8G,KAE3BpoB,EAAA,KAAAwkI,GAAmB,MAEnBxkI,EAAA,KAAAykI,GAAe,MAEfzkI,EAAA,KAAA0kI,GAAY,IAEZ1kI,EAAA,KAAA2kI,IAAmC,GAcjC5jI,KAAKmc,IAAMA,EACX+M,EAAKm6G,GAALrjI,KAA6BgkI,GAC7B96G,EAAKo6G,GAALtjI,KAA4B4kF,GAC5B17D,EAAKu6G,GAALzjI,KAAwBkkI,GAAmB,MAC3Ch7G,EAAKw6G,GAAL1jI,KAAoB+a,GAAe,MACnCmO,EAAKq6G,GAALvjI,KAA0B2b,GAAqB,IAAIq3C,IACnDhzD,KAAK8iE,KAAOA,EACZ9iE,KAAKqc,SAAWA,EAChBrc,KAAKgiD,OAAS,EACdhiD,KAAKmkI,2BAA6BF,EAClCjkI,KAAKk4B,gBAAkBoE,GAAkB,IAa3C,CAEA8nG,sBAAAA,GACE,OAAOx6G,EAAK45G,GAALxjI,MAA0BywB,KAAO,CAC1C,CAQA,YAAMhV,CAAOwyB,GACX,MAAM,YAAEo2F,GAAgBp2F,EAClB7O,EAAQp/B,KAAKmc,IACnBgI,GAAmBib,EAAOp/B,KAAKqc,UAE/B,MAAMioH,EAAkB,IAAIj9G,IACtBk9G,EAAmB,GACnBC,EAAgB,CACpBt8G,KAAM,KACNkX,QACArkB,YAAa6O,EAAK85G,GAAL1jI,MACbssH,gBAAiBr+E,EAAOq+E,gBACxBC,mBAAoBt+E,EAAOs+E,oBAAsB,GACjDC,aAAoC,IAAvBv+E,EAAOu+E,YACpBC,WAAY,IAAI3C,GAChBnuG,kBAAmBiO,EAAK25G,GAALvjI,MACnB0sH,eAAwC,IAAzBz+E,EAAOy+E,cACtBC,iBAA4C,IAA3B1+E,EAAO0+E,gBACxB3W,aAAc/nE,EAAO+nE,aACrB6W,aAAc5+E,EAAO4+E,aACrBlwG,OAAQ3c,KACRyxH,SAAU,MAGZ,IAAK,MAAMvpG,KAAQm8G,EAAa,CAC9B,GAAIn8G,EAAKu8G,OACP,SAEF,MAAMC,EAAoBx8G,EAAKmiC,iBAAmBtnD,GAAevB,MACjE,GAAKkjI,EAIE,CACL,MAAMjT,EAAW6S,EAAgBhlI,IAAI4oB,EAAKzO,IAC1C,IAAKg4G,EAEH,SAEF,IAAKzxH,KAAKk4B,gBAAiB,CACzBqsG,EAAiBv1H,KAAKkZ,GACtB,QACF,CACAs8G,EAAc/S,SAAWA,CAC3B,MAdE,GAAIvpG,EAAKvU,KAAK,KAAOuU,EAAKvU,KAAK,IAAMuU,EAAKvU,KAAK,KAAOuU,EAAKvU,KAAK,GAC9D,SAcJ6wH,EAAct8G,KAAOA,EACrB,MAAMxO,EAAUwwG,GAAyBpxG,OAAO0rH,GAEhD,IAAK9qH,EAAQyyG,aACX,SAGF,IAAKuY,IACH96G,EAAK+5G,GAAL3jI,MAAegP,KAAK0K,GAEhBwO,EAAKqjB,UAAU,CACjB,MAAMkmF,EAAW6S,EAAgBhlI,IAAI4oB,EAAKqjB,UACrCkmF,EAGHA,EAASziH,KAAK0K,GAFd4qH,EAAgB9lI,IAAI0pB,EAAKqjB,SAAU,CAAC7xB,GAIxC,CAGF,MAAMirH,EAAWjrH,EAAQ+B,SAKA,IAAAmpH,EAAzB,GAJI18G,EAAK9K,SACPunH,EAAStpH,MAAMyb,WAAa,UAG1Bpd,EAAQ0zG,YACVxjG,EAAK45G,GAALxjI,MAA0BxB,IAAIkb,EAAQwO,KAAKzO,GAAIC,GAChB,QAA/BkrH,EAAA5kI,KAAKmkI,kCAA0B,IAAAS,GAA/BA,EAAiCzzF,wBAAwBz3B,EAE7D,OAEMxa,EAAA2kI,GAAA7jI,KAAK6kI,IAAiBxzH,KAAtBrR,MAEN,IAAK,MAAMkoB,KAAQq8G,EAAkB,CACnC,MAAM9S,EAAY+S,EAAc/S,SAAW6S,EAAgBhlI,IAAI4oB,EAAKzO,IACpE+qH,EAAct8G,KAAOA,EACrB,MAAMxO,EAAUwwG,GAAyBpxG,OAAO0rH,GAChD,IAAK9qH,EAAQyyG,aACX,SAEF,MAAMwY,EAAWjrH,EAAQ+B,SACzB/B,EAAQqzG,eAAetzG,GAAK,GAAHzO,OAAM0M,IAAgB1M,OAAGkd,EAAKzO,IACnDyO,EAAK9K,SACPunH,EAAStpH,MAAMyb,WAAa,UAE9B26F,EAAS70G,IAAI,GAAG4K,UAAUq3G,MAAM8F,EAClC,CAEAzlI,EAAA2kI,GAAA7jI,KAAK8kI,IAAuBzzH,KAA5BrR,KACF,CA2GA,wBAAM+kI,CAAmBV,GACvB,MAAMG,EAAgB,CACpBt8G,KAAM,KACNkX,MAAOp/B,KAAKmc,IACZpB,YAAa6O,EAAK85G,GAAL1jI,MACbysH,WAAY,IAAI3C,GAChBntG,OAAQ3c,MAEV,IAAK,MAAMkoB,KAAQm8G,EAAa,CAC9Bn8G,EAAK6mG,cAAL7mG,EAAK6mG,YAAgB+U,GAAgBkB,qBAErCR,EAAct8G,KAAOA,EACrB,MAAMxO,EAAUwwG,GAAyBpxG,OAAO0rH,GAE3C9qH,EAAQyyG,eAGbzyG,EAAQ+B,SACR/B,EAAQqzG,eAAetzG,GAAK,GAAHzO,OAAM0M,IAAgB1M,OAAGkd,EAAKzO,IACvDmQ,EAAK+5G,GAAL3jI,MAAegP,KAAK0K,GACtB,OACMxa,EAAA2kI,GAAA7jI,KAAK6kI,IAAiBxzH,KAAtBrR,KACR,CAQAmd,MAAAA,CAAM8nH,GAAe,IAAd,SAAE5oH,GAAU4oH,EACjB,MAAM7lG,EAAQp/B,KAAKmc,IACnBnc,KAAKqc,SAAWA,EAChB8H,GAAmBib,EAAO,CAAEhgB,SAAU/C,EAAS+C,WAE/ClgB,EAAA2kI,GAAA7jI,KAAK8kI,IAAuBzzH,KAA5BrR,MACAo/B,EAAMhiB,QAAS,CACjB,CA4CA8nH,sBAAAA,GACE,OAAO3zH,MAAMC,KAAKoY,EAAK45G,GAALxjI,MAA0Bq/B,SAC9C,CAEA8lG,qBAAAA,CAAsB1rH,GACpB,OAAOmQ,EAAK45G,GAALxjI,MAA0BV,IAAIma,EACvC,CAEAq0C,iBAAAA,CAAkBtlC,GAChB,MAAM,IAAErM,GAAQnc,MACV,GAAEyZ,EAAE,SAAE2F,GAAaoJ,EACnB9O,EAAU,IAAIo5G,GAAwB,CAC1C5qG,KAAM,CACJzO,KACA9F,KAAM6U,EAAO4gC,aACbhqC,YAEFoJ,SACA4W,MAAOjjB,EACPQ,OAAQ3c,KACR0sH,gBAAiB1sH,KAAKk4B,gBACtBnd,YAAa6O,EAAK85G,GAAL1jI,MACb2b,kBAAmBiO,EAAK25G,GAALvjI,QAMrB,OAJA0Z,EAAQ+B,SACR/B,EAAQqzG,eAAetzG,GAAK,GAAHzO,OAAM0M,IAAgB1M,OAAGyO,GAClDC,EAAQq5G,sBACRnpG,EAAK+5G,GAAL3jI,MAAegP,KAAK0K,GACbA,CACT,CAEAs5G,gBAAAA,CAAiBv5G,GAAI,IAAA2rH,EACnB,MAAM7oE,EAAQ3yC,EAAK+5G,GAAL3jI,MAAeg8H,UAAU/+G,GAAMA,EAAGiL,KAAKzO,KAAOA,GAC5D,GAAI8iD,EAAQ,EACV,OAEF,MAAO7iD,GAAWkQ,EAAK+5G,GAAL3jI,MAAew1B,OAAO+mC,EAAO,GACrB,QAA1B6oE,EAAAx7G,EAAKy5G,GAALrjI,aAA0B,IAAAolI,GAA1BA,EAA4BC,yBAC1B3rH,EAAQqzG,eAEZ,CAEAuY,qBAAAA,CAAsB59F,GACpB,GAAuB,IAAnBA,EAAQrpC,OAAZ,CAGA,IAAK,MAAMmqB,KAAUkf,EACnBlf,EAAOmlC,4BAA4B3tD,MAErCd,EAAA2kI,GAAA7jI,KAAK6kI,IAAiBxzH,KAAtBrR,KAJA,CAKF,CAEAyuD,mBAAAA,GAAqC,IAAjBhZ,EAAOt2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACzBa,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAaoR,EACzC,CAKA,8BAAWuvF,GACT,OAAOl4H,GACL9M,KACA,sBACA1B,OAAO8qB,OAAO,CACZpJ,MAAO,EACPulH,SAAU,EACVlqH,MAAOhX,GACP2lF,UAAW,CAAC,GACZklC,uBAAwB,EACxBE,qBAAsB,IAG5B,EACF,eAAAyV,KAlQI,GAA8B,IAA1Bj7G,EAAK+5G,GAAL3jI,MAAe3B,OACjB,OAIF2B,KAAKmc,IAAIqpH,kBAET,MAAM1yF,EAAW,GACjB,IAAKlpB,EAAKg6G,GAAL5jI,MAAuC,CAC1CkpB,EAAK06G,GAAL5jI,MAAwC,GACxC,IAAK,MAAM,eACT+sH,EACA7kG,MAAM,GAAEzO,MACLmQ,EAAK+5G,GAAL3jI,MAAgB,KAAAylI,EACnB,MAAM1/F,EAAgBgnF,EAAetzG,GAAK,GAAHzO,OAAM0M,IAAgB1M,OAAGyO,GAChEq5B,EAAS9jC,KACc,QADVy2H,EACX77G,EAAK65G,GAALzjI,aAAqB,IAAAylI,OAAA,EAArBA,EACIC,kBAAkB3/F,GACnBhmC,KAAK4lI,IACJ,GAAIA,EACF,IAAK,MAAOzqH,EAAKpb,KAAU6lI,EACzB5Y,EAAe3yG,aAAac,EAAKpb,KAK7C,CACF,CACA8pB,EAAK+5G,GAAL3jI,MAAe4lI,KACb,CAAAC,EAAAC,KAWK,IATD59G,MACEvU,MAAOM,EAAIE,EAAID,EAAIE,KAEtByxH,GAEC39G,MACEvU,MAAOU,EAAIE,EAAID,EAAIE,KAEtBsxH,EAID,GAAI7xH,IAAOC,GAAMC,IAAOC,EACtB,OAAO,EAGT,GAAIC,IAAOC,GAAMC,IAAOC,EACtB,OAAQ,EAGV,MAEMuxH,GAAQ5xH,EAAKC,GAAM,EAInB4xH,GAAQzxH,EAAKC,GAAM,EAEzB,GAAIuxH,GAJSvxH,GAIOwxH,GAPP7xH,EAQX,OAAQ,EAGV,GAAI6xH,GAZS5xH,GAYO2xH,GAPPxxH,EAQX,OAAO,EAMT,OAHkBN,EAAKC,GAAM,GACXG,EAAKC,GAAM,IAMjC,MAAMqT,EAAW5L,SAAS6L,yBAC1B,IAAK,MAAMlO,KAAWkQ,EAAK+5G,GAAL3jI,MAAgB,CAEV,IAAAimI,EAAAC,EAA1B,GADAv+G,EAASvL,OAAO1C,EAAQ8N,WACpBxnB,KAAKk4B,gBAE4C,QADnD+tG,GAC2B,QAAzBC,EAAAxsH,EAAQg4G,yBAAiB,IAAAwU,OAAA,EAAzBA,EAA2Bv+E,QAASjuC,EAAQiuC,aAAK,IAAAs+E,GADnDA,EAEGrH,2BACMllH,EAAQg4G,mBACjB/pG,EAASvL,OAAO1C,EAAQg4G,kBAAkBj2G,SAE9C,CAGA,GAFAzb,KAAKmc,IAAIC,OAAOuL,SACVjoB,QAAQqzC,IAAID,GACdlpB,EAAKy5G,GAALrjI,MACF,IAAK,MAAM0Z,KAAWkQ,EAAK+5G,GAAL3jI,MACpB4pB,EAAKy5G,GAALrjI,MAA2BmmI,sBACzBzsH,EAAQqzG,gBACY,EAI5B,UAAA+X,KAiDE,IAAKl7G,EAAK05G,GAALtjI,MACH,OAEF,MAAMo/B,EAAQp/B,KAAKmc,IACnB,IAAK,MAAO1C,EAAIkZ,KAAW/I,EAAK05G,GAALtjI,MAA2B,CACpD,MAAM0Z,EAAU0lB,EAAMtS,cAAc,wBAAD9hB,OAAyByO,EAAE,OAC9D,IAAKC,EACH,SAGFiZ,EAAOjL,UAAY,oBACnB,MAAM,WAAE0+G,GAAe1sH,EAClB0sH,EAE8B,WAAxBA,EAAW/4E,SACpB+4E,EAAWC,YAAY1zG,GACbyzG,EAAWp+G,UAAU+S,SAAS,qBAGxCqrG,EAAWvH,MAAMlsG,GAFjByzG,EAAW3gF,OAAO9yB,GAJlBjZ,EAAQ0C,OAAOuW,GASjB,MAAM2zG,EAAqB18G,EAAK45G,GAALxjI,MAA0BV,IAAIma,GAIpB,IAAA8sH,EAHrC,GAAKD,EAGL,GAAIA,EAAmBE,aAEU,QAA/BD,EAAAvmI,KAAKmkI,kCAA0B,IAAAoC,GAA/BA,EAAiCh1F,iBAC/B93B,EACAC,EAAQD,GACRkZ,GAEF2zG,EAAmBE,cAAe,OAElCF,EAAmB3zG,OAASA,CAEhC,CACA/I,EAAK05G,GAALtjI,MAA0Bs/B,OAC5B,CCv+HF,MAAMmnG,GAAc,YAAW,IAAAC,GAAA,IAAA/4G,QAAAg5G,GAAA,IAAAh5G,QAAAi5G,GAAA,IAAAj5G,QAAAk5G,GAAA,IAAAl5G,QAAAm5G,GAAA,IAAA/4G,QAK/B,MAAMg5G,WAAuBtpF,GAmB3B,2BAAW7iB,GACT,MAAMC,EAAQksG,GAAe7mI,UAEvB46B,EAAe3E,GAAQA,EAAKgH,UAE5B5B,EAAQZ,GAA0Ba,gBAClCC,EAAMd,GAA0Be,cAEtC,OAAO5uB,GACL9M,KACA,mBACA,IAAI81B,GAAgB,CAClB,CAIE,CAAC,SAAU,aAAc,SAAU,cACnC+E,EAAM6J,eACN,CAAErO,SAAS,IAEb,CACE,CAAC,aAAc,iBAAkB,SAAU,cAC3CwE,EAAM6J,gBAER,CACE,CAAC,YAAa,iBACd7J,EAAMmsG,gBACN,CAAE5uH,KAAM,EAAEmjB,EAAO,GAAIjF,QAASwE,IAEhC,CACE,CAAC,iBAAkB,uBACnBD,EAAMmsG,gBACN,CAAE5uH,KAAM,EAAEqjB,EAAK,GAAInF,QAASwE,IAE9B,CACE,CAAC,aAAc,kBACfD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAACmjB,EAAO,GAAIjF,QAASwE,IAE/B,CACE,CAAC,kBAAmB,wBACpBD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAACqjB,EAAK,GAAInF,QAASwE,IAE7B,CACE,CAAC,UAAW,eACZD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAAC,GAAImjB,GAAQjF,QAASwE,IAEhC,CACE,CAAC,eAAgB,qBACjBD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAAC,GAAIqjB,GAAMnF,QAASwE,IAE9B,CACE,CAAC,YAAa,iBACdD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAAC,EAAGmjB,GAAQjF,QAASwE,IAE/B,CACE,CAAC,iBAAkB,uBACnBD,EAAMmsG,gBACN,CAAE5uH,KAAM,CAAC,EAAGqjB,GAAMnF,QAASwE,MAInC,CAMAttB,WAAAA,CAAYygC,GACVtgC,OAAKq+B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIiC,GAAM,IAAE1gC,KAAM,oBAAmBzO,EAAA,KAAAgoI,IA3F9C7nI,EAAA,KAAAynI,GAAW,IAEXznI,EAAA,KAAA0nI,GAAY,GAAA37H,OAAMhL,KAAKyZ,GAAE,YAEzBxa,EAAA,KAAA2nI,GAAc,MAEd3nI,EAAA,KAAA4nI,QAAS,IAAAhoH,EAAAA,EAAAA,GAAA,oBAEM,MAoFb7e,KAAK2jB,MACHsqB,EAAOtqB,OACPojH,GAAeriB,eACfjnE,GAAiB8C,kBACnBr3B,EAAK29G,GAAL7mI,KAAiBiuC,EAAOuhD,UAAYu3C,GAAeE,kBAC9CjnI,KAAKmrC,qBACRnrC,KAAK6pB,WAAWsc,UAAU,qCAE5BnmC,KAAK+/C,eAAgB,CACvB,CAGA,iBAAO7L,CAAWC,EAAMlmB,GACtBwvB,GAAiBvJ,WAAWC,EAAMlmB,GAClC,MAAM5S,EAAQ6b,iBAAiBnb,SAASulC,iBAYxCthD,KAAKknI,iBAAmB3lF,WACtBlmC,EAAMmmC,iBAAiB,sBAE3B,CAGA,0BAAOtV,CAAoB1rC,EAAMV,GAC/B,OAAQU,GACN,KAAKmB,EAA2BG,cAC9BilI,GAAeE,iBAAmBnnI,EAClC,MACF,KAAK6B,EAA2BI,eAC9BglI,GAAeriB,cAAgB5kH,EAGrC,CAGAg+B,YAAAA,CAAat9B,EAAMV,GACjB,OAAQU,GACN,KAAKmB,EAA2BG,cAC9B5C,EAAA4nI,GAAA9mI,KAAKmnI,IAAe91H,KAApBrR,KAAqBF,GACrB,MACF,KAAK6B,EAA2BI,eAC9B7C,EAAA4nI,GAAA9mI,KAAKonI,IAAY/1H,KAAjBrR,KAAkBF,GAGxB,CAGA,oCAAWupC,GACT,MAAO,CACL,CACE1nC,EAA2BG,cAC3BilI,GAAeE,kBAEjB,CACEtlI,EAA2BI,eAC3BglI,GAAeriB,eAAiBjnE,GAAiB8C,mBAGvD,CAGA,sBAAIhT,GACF,MAAO,CACL,CAAC5rC,EAA2BG,cAAe8nB,EAAKi9G,GAAL7mI,OAC3C,CAAC2B,EAA2BI,eAAgB/B,KAAK2jB,OAErD,CAGA,kBAAIghC,GAEF,OADA3kD,KAAK2oB,eAAL3oB,KAAK2oB,aAAiB,IAAIg/F,GAAiB3nH,OACpC,CAAC,CAAC,cAAeA,KAAK2oB,cAC/B,CAEA,aAAIk/F,GACF,OAAOlmH,EAA2BI,cACpC,CA0BA21C,cAAAA,GAAiB,IAAA2vF,EACfrnI,KAAKsnI,UAAUjsH,MAAMsI,MAAQ3jB,KAAK2jB,MACjB,QAAjB0jH,EAAArnI,KAAK2oB,oBAAY,IAAA0+G,GAAjBA,EAAmBlqH,OAAOnd,KAAK2jB,OAC/BhW,MAAM+pC,gBACR,CA4BAsvF,eAAAA,CAAgBlxH,EAAGC,GACjB/V,KAAK6pB,WAAWqS,yBAAyBpmB,EAAGC,GAAoB,EAClE,CAGAquC,qBAAAA,GAEE,MAAMjlC,EAAQnf,KAAKkkD,YACnB,MAAO,EACJ6iF,GAAeG,iBAAmB/nH,IACjC4nH,GAAeG,iBAAmBt9G,EAAKi9G,GAAL7mI,OAAkBmf,EAE1D,CAGA0wB,OAAAA,GACO7vC,KAAK2c,SAGVhP,MAAMkiC,UACW,OAAb7vC,KAAKmc,MAIJnc,KAAKmgD,iBAGRngD,KAAK2c,OAAO3d,IAAIgB,OAEpB,CAGAupD,cAAAA,GACE,IAAK57C,MAAM47C,iBACT,OAAO,EAGTvpD,KAAKunI,WAAWv/G,UAAU8C,OAAO,WACjC9qB,KAAKsnI,UAAUE,iBAAkB,EACjCxnI,KAAKu/C,cAAe,EACpBv/C,KAAKmc,IAAI7B,gBAAgB,yBAQzB4O,EAAK09G,GAAL5mI,KAAmB,IAAIi9B,iBACvB,MAAMtT,EAAS3pB,KAAK6pB,WAAW2V,eAAe5V,EAAKg9G,GAAL5mI,OAoB9C,OAlBAA,KAAKsnI,UAAUvtH,iBACb,UACA/Z,KAAKynI,iBAAiBl6G,KAAKvtB,MAC3B,CAAE2pB,WAEJ3pB,KAAKsnI,UAAUvtH,iBAAiB,QAAS/Z,KAAK0nI,eAAen6G,KAAKvtB,MAAO,CACvE2pB,WAEF3pB,KAAKsnI,UAAUvtH,iBAAiB,OAAQ/Z,KAAK2nI,cAAcp6G,KAAKvtB,MAAO,CACrE2pB,WAEF3pB,KAAKsnI,UAAUvtH,iBAAiB,QAAS/Z,KAAK4nI,eAAer6G,KAAKvtB,MAAO,CACvE2pB,WAEF3pB,KAAKsnI,UAAUvtH,iBAAiB,QAAS/Z,KAAK6nI,eAAet6G,KAAKvtB,MAAO,CACvE2pB,YAGK,CACT,CAGA6/B,eAAAA,GAAkB,IAAAs+E,EAChB,QAAKn6H,MAAM67C,oBAIXxpD,KAAKunI,WAAWv/G,UAAUhpB,IAAI,WAC9BgB,KAAKsnI,UAAUE,iBAAkB,EACjCxnI,KAAKmc,IAAI/B,aAAa,wBAAyBwP,EAAK+8G,GAAL3mI,OAC/CA,KAAKu/C,cAAe,EAEJ,QAAhBuoF,EAAAl+G,EAAKg9G,GAAL5mI,aAAgB,IAAA8nI,GAAhBA,EAAkB3oG,QAClBjW,EAAK09G,GAAL5mI,KAAmB,MAInBA,KAAKmc,IAAI6nB,MAAM,CACb2oB,eAAe,IAIjB3sD,KAAKk9B,WAAY,EACjBl9B,KAAK2c,OAAOR,IAAI6L,UAAUhpB,IAAI,oBAEvB,EACT,CAGAqjD,OAAAA,CAAQroC,GACDha,KAAKqtB,sBAGV1f,MAAM00C,QAAQroC,GACVA,EAAME,SAAWla,KAAKsnI,WACxBtnI,KAAKsnI,UAAUtjG,QAEnB,CAGAslB,SAAAA,CAAUtlB,GAAO,IAAA+jG,EACX/nI,KAAKggB,QAIThgB,KAAKupD,iBACDvlB,GACFhkC,KAAKsnI,UAAUtjG,QAEO,QAAxB+jG,EAAI/nI,KAAK0/C,uBAAe,IAAAqoF,GAApBA,EAAsBpoF,YACxB3/C,KAAK4hD,SAEP5hD,KAAK0/C,gBAAkB,KACzB,CAGAviB,OAAAA,GACE,OAAQn9B,KAAKsnI,WAAiD,KAApCtnI,KAAKsnI,UAAUU,UAAU9mH,MACrD,CAGA4J,MAAAA,GACE9qB,KAAKk9B,WAAY,EACbl9B,KAAK2c,SACP3c,KAAK2c,OAAOkqB,iBAAgB,GAC5B7mC,KAAK2c,OAAOR,IAAI6L,UAAUhpB,IAAI,oBAEhC2O,MAAMmd,QACR,CA6DA0jB,MAAAA,GACE,IAAKxuC,KAAK0iD,eACR,OAGF/0C,MAAM6gC,SACNxuC,KAAKwpD,kBACL,MAAMy+E,EAAYr+G,EAAK88G,GAAL1mI,MACZkoI,EAAWh/G,EAAKw9G,GAAL1mI,KAAgBd,EAAA4nI,GAAA9mI,KAAKmoI,IAAY92H,KAAjBrR,MAAoBooI,WACrD,GAAIH,IAAcC,EAChB,OAGF,MAAMG,EAAUnqH,IACdgL,EAAKw9G,GAAL1mI,KAAgBke,GACXA,GAILhf,EAAA4nI,GAAA9mI,KAAKsoI,IAAWj3H,KAAhBrR,MACAA,KAAK6pB,WAAWgmB,QAAQ7vC,MACxBd,EAAA4nI,GAAA9mI,KAAKuoI,IAAoBl3H,KAAzBrR,OALEA,KAAK8qB,UAOT9qB,KAAKuoC,YAAY,CACfrT,IAAKA,KACHmzG,EAAQH,IAEV/yG,KAAMA,KACJkzG,EAAQJ,IAEV5yG,UAAU,IAEZn2B,EAAA4nI,GAAA9mI,KAAKuoI,IAAoBl3H,KAAzBrR,KACF,CAGAkwC,uBAAAA,GACE,OAAOlwC,KAAK0iD,cACd,CAGA/W,eAAAA,GACE3rC,KAAKupD,iBACLvpD,KAAKsnI,UAAUtjG,OACjB,CAGAwE,OAAAA,CAAQxuB,GACFA,EAAME,SAAWla,KAAKmc,KAAqB,UAAdnC,EAAMkB,MACrClb,KAAK2rC,kBAEL3xB,EAAMqI,iBAEV,CAEAolH,gBAAAA,CAAiBztH,GACf+sH,GAAensG,iBAAiB7X,KAAK/iB,KAAMga,EAC7C,CAEA0tH,cAAAA,CAAe1tH,GACbha,KAAKk9B,WAAY,CACnB,CAEAyqG,aAAAA,CAAc3tH,GACZha,KAAKk9B,WAAY,CACnB,CAEA0qG,cAAAA,CAAe5tH,GACbha,KAAK2c,OAAOR,IAAI6L,UAAUqc,OAAO,kBAAmBrkC,KAAKm9B,UAC3D,CAGA8vB,cAAAA,GACEjtD,KAAKsnI,UAAUltH,aAAa,OAAQ,WACpCpa,KAAKsnI,UAAUhtH,gBAAgB,iBACjC,CAGA4yC,aAAAA,GACEltD,KAAKsnI,UAAUltH,aAAa,OAAQ,WACpCpa,KAAKsnI,UAAUltH,aAAa,kBAAkB,EAChD,CAGA,oBAAI+yC,GACF,OAAO,CACT,CAGA1xC,MAAAA,GACE,GAAIzb,KAAKmc,IACP,OAAOnc,KAAKmc,IAGd,IAAI2mC,EAAOC,GACP/iD,KAAKwqD,SAAWxqD,KAAKmrC,uBACvB2X,EAAQ9iD,KAAK8V,EACbitC,EAAQ/iD,KAAK+V,GAGfpI,MAAM8N,SACNzb,KAAKsnI,UAAYvrH,SAASC,cAAc,OACxChc,KAAKsnI,UAAU5/G,UAAY,WAE3B1nB,KAAKsnI,UAAUltH,aAAa,KAAMwP,EAAK+8G,GAAL3mI,OAClCA,KAAKsnI,UAAUltH,aAAa,eAAgB,oBAC5Cpa,KAAKsnI,UAAUltH,aAAa,kBAAmB,mBAC/Cpa,KAAKktD,gBAELltD,KAAKsnI,UAAUE,iBAAkB,EAEjC,MAAM,MAAEnsH,GAAUrb,KAAKsnI,UAUvB,GATAjsH,EAAMm0E,SAAW,QAAHxkF,OAAW4e,EAAKi9G,GAAL7mI,MAAc,mCACvCqb,EAAMsI,MAAQ3jB,KAAK2jB,MAEnB3jB,KAAKmc,IAAIC,OAAOpc,KAAKsnI,WAErBtnI,KAAKunI,WAAaxrH,SAASC,cAAc,OACzChc,KAAKunI,WAAWv/G,UAAUhpB,IAAI,UAAW,WACzCgB,KAAKmc,IAAIC,OAAOpc,KAAKunI,YAEjBvnI,KAAKwqD,SAAWxqD,KAAKmrC,oBAAqB,CAE5C,MAAOuF,EAAaC,GAAgB3wC,KAAK24C,iBACzC,GAAI34C,KAAKmrC,oBAAqB,CAU5B,MAAM,SAAEhhB,GAAanqB,KAAKmqD,aAC1B,IAAKza,EAAIC,GAAM3vC,KAAKokD,yBACnB1U,EAAIC,GAAM3vC,KAAKikD,wBAAwBvU,EAAIC,GAC5C,MAAOvvB,EAAWC,GAAcrgB,KAAKigD,gBAC9B3/B,EAAOC,GAASvgB,KAAKkgD,gBAC5B,IAAI9e,EAAMC,EACV,OAAQrhC,KAAKof,UACX,KAAK,EACHgiB,EAAO0hB,GAAS34B,EAAS,GAAK7J,GAASF,EACvCihB,EAAO0hB,EAAQ/iD,KAAKigB,QAAUkK,EAAS,GAAK5J,GAASF,EACrD,MACF,KAAK,GACH+gB,EAAO0hB,GAAS34B,EAAS,GAAK7J,GAASF,EACvCihB,EAAO0hB,GAAS54B,EAAS,GAAK5J,GAASF,GACtCqvB,EAAIC,GAAM,CAACA,GAAKD,GACjB,MACF,KAAK,IACHtO,EAAO0hB,EAAQ9iD,KAAKggB,OAASmK,EAAS,GAAK7J,GAASF,EACpDihB,EAAO0hB,GAAS54B,EAAS,GAAK5J,GAASF,GACtCqvB,EAAIC,GAAM,EAAED,GAAKC,GAClB,MACF,KAAK,IACHvO,EACE0hB,GACC34B,EAAS,GAAK7J,EAAQtgB,KAAKigB,OAASI,GAAcD,EACrDihB,EACE0hB,GACC54B,EAAS,GAAK5J,EAAQvgB,KAAKggB,MAAQI,GAAaC,GAClDqvB,EAAIC,GAAM,EAAEA,EAAID,GAGrB1vC,KAAK2iD,MAAMvhB,EAAOsP,EAAarP,EAAOsP,EAAcjB,EAAIC,EAC1D,MACE3vC,KAAK6iD,gBAAgBC,EAAOC,GAG9B7jD,EAAA4nI,GAAA9mI,KAAKsoI,IAAWj3H,KAAhBrR,MACAA,KAAKu/C,cAAe,EACpBv/C,KAAKsnI,UAAUE,iBAAkB,CACnC,MACExnI,KAAKu/C,cAAe,EACpBv/C,KAAKsnI,UAAUE,iBAAkB,EAOnC,OAAOxnI,KAAKmc,GACd,CAQA0rH,cAAAA,CAAe7tH,GACb,MAAM6tB,EAAgB7tB,EAAM6tB,eAAiB/hB,OAAO+hB,eAC9C,MAAEsB,GAAUtB,EAClB,GAAqB,IAAjBsB,EAAM9qC,QAA6B,eAAb8qC,EAAM,GAC9B,OAGFnvB,EAAMqI,iBACN,MAAMilB,EAAQkhG,GAAkCn3H,KAAlC01H,GACZl/F,EAAc9F,QAAQ,SAAW,IACjCghE,WAAW0jC,GAAa,MAC1B,IAAKn/F,EACH,OAEF,MAAMxC,EAAYhf,OAAOif,eACzB,IAAKD,EAAUyL,WACb,OAEFvwC,KAAKsnI,UAAUmB,YACf3jG,EAAU4jG,qBACV,MAAM73F,EAAQ/L,EAAU0L,WAAW,GACnC,IAAKlJ,EAAM52B,SAAS,MAIlB,OAHAmgC,EAAM83F,WAAW5sH,SAASQ,eAAe+qB,IACzCtnC,KAAKsnI,UAAUmB,iBACf3jG,EAAU8jG,kBAKZ,MAAM,eAAEC,EAAc,YAAEC,GAAgBj4F,EAClCk4F,EAAe,GACfC,EAAc,GACpB,GAAIH,EAAej3F,WAAaC,KAAKC,UAAW,CAC9C,MAAMn1B,EAASksH,EAAe92F,cAI9B,GAHAi3F,EAAYh6H,KACV65H,EAAeI,UAAU5zH,MAAMyzH,GAAa/lC,WAAW0jC,GAAa,KAElE9pH,IAAW3c,KAAKsnI,UAAW,CAC7B,IAAI53H,EAASq5H,EACb,IAAK,MAAM1vH,KAASrZ,KAAKsnI,UAAU4B,WAC7B7vH,IAAUsD,EAIdjN,EAAOV,KAAKm6H,GAA8B93H,KAA9B01H,GAA+B1tH,IAHzC3J,EAASs5H,CAKf,CACAD,EAAa/5H,KACX65H,EAAeI,UACZ5zH,MAAM,EAAGyzH,GACT/lC,WAAW0jC,GAAa,IAE/B,MAAO,GAAIoC,IAAmB7oI,KAAKsnI,UAAW,CAC5C,IAAI53H,EAASq5H,EACTr6H,EAAI,EACR,IAAK,MAAM2K,KAASrZ,KAAKsnI,UAAU4B,WAC7Bx6H,MAAQo6H,IACVp5H,EAASs5H,GAEXt5H,EAAOV,KAAKm6H,GAA8B93H,KAA9B01H,GAA+B1tH,GAE/C,CACA6P,EAAKw9G,GAAL1mI,KAAI,GAAAgL,OAAe+9H,EAAa95H,KAAK,OAAKjE,OAAGs8B,GAAKt8B,OAAGg+H,EAAY/5H,KAAK,QACtE/P,EAAA4nI,GAAA9mI,KAAKsoI,IAAWj3H,KAAhBrR,MAGA,MAAMopI,EAAW,IAAIC,MACrB,IAAIC,EAAe16H,KAAK0J,WAAWywH,EAAallH,IAAIiE,GAAQA,EAAKzpB,SACjE,IAAK,MAAM,WAAE+nI,KAAgBpmI,KAAKsnI,UAAU4B,WAE1C,GAAI9C,EAAWx0F,WAAaC,KAAKC,UAAW,CAC1C,MAAMzzC,EAAS+nI,EAAW6C,UAAU5qI,OACpC,GAAIirI,GAAgBjrI,EAAQ,CAC1B+qI,EAASG,SAASnD,EAAYkD,GAC9BF,EAASI,OAAOpD,EAAYkD,GAC5B,KACF,CACAA,GAAgBjrI,CAClB,CAEFymC,EAAU2kG,kBACV3kG,EAAU4kG,SAASN,EACrB,CAyBA,cAAI97E,GACF,OAAOttD,KAAKsnI,SACd,CAGAl+E,UAAAA,GACE,MAAMugF,EAAU5C,GAAeG,iBAAmBlnI,KAAKkkD,YACvD,OAAOlkD,KAAKgpD,QAAQ2gF,EAASA,EAC/B,CAGA,wBAAavhG,CAAYlgB,EAAMvL,EAAQsR,GACrC,IAAI4uE,EAAc,KAClB,GAAI30E,aAAgB8iG,GAA2B,CAC7C,MACE9iG,MACE6uG,uBAAuB,SAAEvnC,EAAQ,UAAEsnC,GAAW,KAC9CnjH,EAAI,SACJyL,EAAQ,GACR3F,EAAE,SACF8xB,EAAQ,SACRuN,EAAQ,YACRtN,EAAW,aACXqU,EAAY,iBACZC,GACD,YACDpnC,EAAW,aACX+oH,EACA9kH,QACEmmD,MAAM,WAAE//B,KAER7a,EAGJ,IAAKxP,GAAsC,IAAvBA,EAAYra,OAE9B,OAAO,KAETw+F,EAAc30E,EAAO,CACnBmiC,eAAgBnpD,EAAqBE,SACrCuiB,MAAOpS,MAAMC,KAAKslH,GAClBtnC,WACA1vF,MAAO4Y,EAAYzJ,KAAK,MACxBkb,SAAUs3G,EACVhgG,UAAWsB,EAAa,EACxBpvB,KAAMA,EAAK0B,MAAM,GACjB+J,WACA+rB,oBAAqB1xB,EACrBA,KACA4xB,SAAS,EACTE,WACA7f,SAAoB,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAar8B,MAAO,KAC7B2pC,WACA+G,eACAC,mBAEJ,CACA,MAAMt3B,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,GASrD,OARA/E,EAAO29G,GAAPr+G,EAAmBN,EAAKsnE,UACxBhnE,EAAO7E,MAAQ/R,GAAKC,gBAAgBqW,EAAKvE,OACzCuF,EAAOw9G,GAAPl+G,EAAkBggH,GAAkCn3H,KAAlC01H,GAAmC7+G,EAAKpoB,QAC1D0oB,EAAO2hC,aAAe0yC,EAClB30E,EAAKwD,SACPlD,EAAOo+B,eAAe1+B,GAGjBM,CACT,CAGAof,SAAAA,GAAgC,IAAtBwN,EAAYj2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACpB,GAAIa,KAAKm9B,UACP,OAAO,KAGT,GAAIn9B,KAAKqrC,QACP,OAAOrrC,KAAKiqD,mBAGd,MAAMtmC,EAAQ85B,GAAiB+C,cAAcppB,QAC3Cp3B,KAAKmgD,gBAAkBjpB,iBAAiBl3B,KAAKsnI,WAAW3jH,MAAQ3jB,KAAK2jB,OAEjEgkB,EAAarpC,OAAO8c,OAAOzN,MAAMi6B,UAAUwN,GAAe,CAC9DzxB,QACA6rE,SAAU5lE,EAAKi9G,GAAL7mI,MACVF,MAAOZ,EAAA4nI,GAAA9mI,KAAK4pI,IAAiBv4H,KAAtBrR,QAIT,OAFAA,KAAKyrB,WAAWkc,GAEZyN,GAGFzN,EAAW8iB,QAAS,EACb9iB,GAGL3nC,KAAKmrC,sBAAwBjsC,EAAA4nI,GAAA9mI,KAAK6pI,IAAkBx4H,KAAvBrR,KAAwB2nC,GAChD,MAGTA,EAAWluB,GAAKzZ,KAAKmrC,oBAEdxD,EACT,CAgBAwJ,uBAAAA,CAAwB7F,GACtB,MAAMyiB,EAAUpgD,MAAMwjC,wBAAwB7F,GAC9C,IAAKyiB,EACH,OAAO,KAET,MAAM,MAAE1yC,GAAU0yC,EAClB1yC,EAAMm0E,SAAW,QAAHxkF,OAAW4e,EAAKi9G,GAAL7mI,MAAc,mCACvCqb,EAAMsI,MAAQ3jB,KAAK2jB,MAEnBoqC,EAAQy3E,kBACR,IAAK,MAAM19G,KAAQ8B,EAAK88G,GAAL1mI,MAAc6M,MAAM,MAAO,CAC5C,MAAMsP,EAAMJ,SAASC,cAAc,OACnCG,EAAIC,OACF0L,EAAO/L,SAASQ,eAAeuL,GAAQ/L,SAASC,cAAc,OAEhE+xC,EAAQ3xC,OAAOD,EACjB,CAUA,OARAmvB,EAAWuiB,aAAa,CACtBl6C,KAAM3T,KAAKopD,aACXzB,MACE3nD,KAAK6pB,WAAWyE,qBAAuBtuB,KAAK+mD,iBACxC/mD,KAAK0rB,QACL,CAAExN,KAAM0L,EAAK88G,GAAL1mI,SAGT+tD,CACT,CAEAE,sBAAAA,CAAuB3iB,GACrB39B,MAAMsgD,uBAAuB3iB,GAC7BA,EAAWojF,aACb,EAr3BkB,SAAAyY,GAwLF33C,GACd,MAAMs6C,EAAcr5G,IAClBzwB,KAAKsnI,UAAUjsH,MAAMm0E,SAAW,QAAHxkF,OAAWylB,EAAI,mCAC5CzwB,KAAKijD,UAAU,IAAKxyB,EAAO7G,EAAKi9G,GAAL7mI,OAAkBA,KAAKkkD,aAClDh7B,EAAK29G,GAAL7mI,KAAiBywB,GACjBvxB,EAAA4nI,GAAA9mI,KAAKuoI,IAAoBl3H,KAAzBrR,OAEI+pI,EAAgBngH,EAAKi9G,GAAL7mI,MACtBA,KAAKuoC,YAAY,CACfrT,IAAK40G,EAAYv8G,KAAKvtB,KAAMwvF,GAC5Br6D,KAAM20G,EAAYv8G,KAAKvtB,KAAM+pI,GAC7B30G,KAAMp1B,KAAK6pB,WAAW2jB,SAASjgB,KAAKvtB,KAAK6pB,WAAY7pB,MACrDq1B,UAAU,EACV70B,KAAMmB,EAA2BG,cACjCwzB,qBAAqB,EACrBC,UAAU,GAEd,UAAA6xG,GAaazjH,GACX,MAAM+rG,EAAWsa,IACfhqI,KAAK2jB,MAAQqmH,EACbhqI,KAAK03C,kBAEDuyF,EAAajqI,KAAK2jB,MACxB3jB,KAAKuoC,YAAY,CACfrT,IAAKw6F,EAASniG,KAAKvtB,KAAM2jB,GACzBwR,KAAMu6F,EAASniG,KAAKvtB,KAAMiqI,GAC1B70G,KAAMp1B,KAAK6pB,WAAW2jB,SAASjgB,KAAKvtB,KAAK6pB,WAAY7pB,MACrDq1B,UAAU,EACV70B,KAAMmB,EAA2BI,eACjCuzB,qBAAqB,EACrBC,UAAU,GAEd,UAAA4yG,KA0JE,MAAMz4H,EAAS,GACf1P,KAAKsnI,UAAUmB,YACf,IAAIyB,EAAY,KAChB,IAAK,MAAM7wH,KAASrZ,KAAKsnI,UAAU4B,WAAY,KAAAiB,GAChC,QAATA,EAAAD,SAAS,IAAAC,OAAA,EAATA,EAAWv4F,YAAaC,KAAKC,WAAgC,OAAnBz4B,EAAMg0C,WAMpD39C,EAAOV,KAAKm6H,GAA8B93H,KAA9B01H,EAA+B1tH,IAC3C6wH,EAAY7wH,EACd,CACA,OAAO3J,EAAOT,KAAK,KACrB,UAAAs5H,KAGE,MAAO73F,EAAaC,GAAgB3wC,KAAK24C,iBAEzC,IAAIhlC,EACJ,GAAI3T,KAAKmgD,gBACPxsC,EAAO3T,KAAKmc,IAAIioB,4BACX,CAGL,MAAM,aAAEmD,EAAY,IAAEprB,GAAQnc,KACxBoqI,EAAejuH,EAAId,MAAMy0G,QACzBua,EAAkBluH,EAAI6L,UAAU+S,SAAS,UAC/C5e,EAAI6L,UAAU8C,OAAO,UACrB3O,EAAId,MAAMy0G,QAAU,SACpBvoF,EAAaprB,IAAIC,OAAOpc,KAAKmc,KAC7BxI,EAAOwI,EAAIioB,wBACXjoB,EAAI2O,SACJ3O,EAAId,MAAMy0G,QAAUsa,EACpBjuH,EAAI6L,UAAUqc,OAAO,SAAUgmG,EACjC,CAIIrqI,KAAKof,SAAW,MAAQpf,KAAK6hD,eAAiB,KAChD7hD,KAAKggB,MAAQrM,EAAKqM,MAAQ0wB,EAC1B1wC,KAAKigB,OAAStM,EAAKsM,OAAS0wB,IAE5B3wC,KAAKggB,MAAQrM,EAAKsM,OAASywB,EAC3B1wC,KAAKigB,OAAStM,EAAKqM,MAAQ2wB,GAE7B3wC,KAAK8hD,mBACP,UAAAqnF,GA+LuBnwH,GACrB,OACEA,EAAK44B,WAAaC,KAAKC,UAAY94B,EAAKiwH,UAAYjwH,EAAKgvH,WACzDjlC,WAAW0jC,GAAa,GAC5B,UAAA6B,KAwFE,GADAtoI,KAAKsnI,UAAU9B,kBACV57G,EAAK88G,GAAL1mI,MAGL,IAAK,MAAM8nB,KAAQ8B,EAAK88G,GAAL1mI,MAAc6M,MAAM,MAAO,CAC5C,MAAMsP,EAAMJ,SAASC,cAAc,OACnCG,EAAIC,OACF0L,EAAO/L,SAASQ,eAAeuL,GAAQ/L,SAASC,cAAc,OAEhEhc,KAAKsnI,UAAUlrH,OAAOD,EACxB,CACF,UAAAytH,KAGE,OAAOhgH,EAAK88G,GAAL1mI,MAAc+iG,WAAW,OAAQ,IAC1C,UAAAylC,GAE2Bz6E,GACzB,OAAOA,EAAQg1C,WAAW,IAAK,OACjC,UAAA8mC,GA4GmBliG,GACjB,MAAM,MAAE7nC,EAAK,SAAE0vF,EAAQ,MAAE7rE,EAAK,UAAE8d,GAAczhC,KAAKmqD,aAEnD,OACEnqD,KAAK+mD,kBACL/mD,KAAK4jD,eACLjc,EAAW7nC,QAAUA,GACrB6nC,EAAW6nD,WAAaA,GACxB7nD,EAAWhkB,MAAMivB,KAAK,CAAC1gC,EAAGxD,IAAMwD,IAAMyR,EAAMjV,KAC5Ci5B,EAAWlG,YAAcA,CAE7B,CAoCF6oG,EAt3BMvD,IAk1BJloH,EAAAA,EAAAA,GAl1BIkoH,GAAc,0BAWe,KAAEloH,EAAAA,EAAAA,GAX/BkoH,GAAc,mBAaQ,IAACloH,EAAAA,EAAAA,GAbvBkoH,GAAc,gBAeK,OAAIloH,EAAAA,EAAAA,GAfvBkoH,GAAc,mBAiBQ,KAAEloH,EAAAA,EAAAA,GAjBxBkoH,GAAc,QAuFH,aAAUloH,EAAAA,EAAAA,GAvFrBkoH,GAAc,cAyFG7lI,EAAqBE,UC5G5C,MAAMmpI,GAMJC,SAAAA,GACEt/H,GAAY,mDACd,CAMA,OAAI0jB,GACF1jB,GAAY,6CACd,CAEA08B,SAAAA,CAAUmvC,EAAO0zD,GACfv/H,GAAY,mDACd,CAEA,eAAOw/H,CAAS94G,EAAK8d,EAAIC,EAAI9qB,EAAIC,EAAI+9C,GACnCA,IAAAA,EAAS,IAAIzB,aAAaxvC,EAAIvzB,SAC9B,IAAK,IAAIqQ,EAAI,EAAGuS,EAAK2Q,EAAIvzB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC5Cm0D,EAAKn0D,GAAKghC,EAAK9d,EAAIljB,GAAKmW,EACxBg+C,EAAKn0D,EAAI,GAAKihC,EAAK/d,EAAIljB,EAAI,GAAKoW,EAElC,OAAO+9C,CACT,CAEA,sBAAO8nE,CAAgB/4G,EAAK8d,EAAIC,EAAI9qB,EAAIC,EAAI+9C,GAC1CA,IAAAA,EAAS,IAAIzB,aAAaxvC,EAAIvzB,SAC9B,IAAK,IAAIqQ,EAAI,EAAGuS,EAAK2Q,EAAIvzB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC5Cm0D,EAAKn0D,GAAKghC,EAAK9d,EAAIljB,EAAI,GAAKmW,EAC5Bg+C,EAAKn0D,EAAI,GAAKihC,EAAK/d,EAAIljB,GAAKoW,EAE9B,OAAO+9C,CACT,CAEA,iBAAO3f,CAAWtxB,EAAK8d,EAAIC,EAAIkzB,GAC7BA,IAAAA,EAAS,IAAIzB,aAAaxvC,EAAIvzB,SAC9B,IAAK,IAAIqQ,EAAI,EAAGuS,EAAK2Q,EAAIvzB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC5Cm0D,EAAKn0D,GAAKghC,EAAK9d,EAAIljB,GACnBm0D,EAAKn0D,EAAI,GAAKihC,EAAK/d,EAAIljB,EAAI,GAE7B,OAAOm0D,CACT,CAEA,eAAO+nE,CAAS90H,GAKd,OAAOlH,KAAK21C,MAAU,IAAJzuC,EACpB,CAEA,sBAAOk4G,CAAgBl4G,EAAGC,EAAG26B,EAAaC,EAAcvxB,GACtD,OAAQA,GACN,KAAK,GACH,MAAO,CAAC,EAAIrJ,EAAI26B,EAAa56B,EAAI66B,GACnC,KAAK,IACH,MAAO,CAAC,EAAI76B,EAAI46B,EAAa,EAAI36B,EAAI46B,GACvC,KAAK,IACH,MAAO,CAAC56B,EAAI26B,EAAa,EAAI56B,EAAI66B,GACnC,QACE,MAAO,CAAC76B,EAAI46B,EAAa36B,EAAI46B,GAEnC,CAEA,0BAAOk6F,CAAoB/0H,EAAGC,EAAGqJ,GAC/B,OAAQA,GACN,KAAK,GACH,MAAO,CAAC,EAAIrJ,EAAGD,GACjB,KAAK,IACH,MAAO,CAAC,EAAIA,EAAG,EAAIC,GACrB,KAAK,IACH,MAAO,CAACA,EAAG,EAAID,GACjB,QACE,MAAO,CAACA,EAAGC,GAEjB,CAEA,yBAAO+0H,CAAmB30H,EAAIC,EAAIE,EAAIC,EAAIC,EAAIC,GAC5C,MAAO,EACJN,EAAK,EAAIG,GAAM,GACfF,EAAK,EAAIG,GAAM,GACf,EAAID,EAAKE,GAAM,GACf,EAAID,EAAKE,GAAM,GACfH,EAAKE,GAAM,GACXD,EAAKE,GAAM,EAEhB,GACFoI,EAAAA,EAAAA,GA7FM0rH,GAAO,YACQ,M,sNCArB,MAAMQ,GAwCJv9H,WAAAA,CAAWw9H,EAAWp8G,EAAKq8G,EAAarI,EAAWz0G,GAAwB,IAA7DrY,EAAAA,EAAGC,EAAAA,GAAGi1H,EAAsCE,EAAW/rI,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAACL,EAAA,KAAAqsI,IAvCzElsI,EAAA,KAAAmsI,QAAI,GAEJnsI,EAAA,KAAAosI,GAAU,IAEVpsI,EAAA,KAAAqsI,QAAY,GAEZrsI,EAAA,KAAAssI,QAAM,GAENtsI,EAAA,KAAAusI,GAAO,IASPvsI,EAAA,KAAAwsI,GAAQ,IAAIrqE,aAAa,KAEzBniE,EAAA,KAAAysI,QAAM,GAENzsI,EAAA,KAAA0sI,QAAM,GAEN1sI,EAAA,KAAA2sI,QAAI,GAEJ3sI,EAAA,KAAA4sI,QAAS,GAET5sI,EAAA,KAAA6sI,QAAY,GAEZ7sI,EAAA,KAAA8sI,QAAU,GAEV9sI,EAAA,KAAA+sI,GAAU,IASR9iH,EAAKkiH,GAALprI,KAAY4uB,GACZ1F,EAAK6iH,GAAL/rI,KAAkB4iI,EAAYqI,GAC9B/hH,EAAKqiH,GAALvrI,KAAcmuB,GACdvE,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAACoyB,IAAKA,IAAKA,IAAKA,IAAK9a,EAAGC,GAAI,GAC3CmT,EAAKoiH,GAALtrI,KAAoBkrI,GACpBhiH,EAAK2iH,GAAL7rI,KAAkCisI,GAASrpH,EAAGqoH,GAC9C/hH,EAAK0iH,GAAL5rI,KAA6BksI,GAAItpH,EAAGqoH,GACpC/hH,EAAK4iH,GAAL9rI,KAAoBirI,GACpBrhH,EAAKoiH,GAALhsI,MAAagP,KAAK8G,EAAGC,EACvB,CAEAonB,OAAAA,GAIE,OAAOqyE,MAAM5lF,EAAK6hH,GAALzrI,MAAW,GAC1B,CAeAhB,GAAAA,CAAGmtI,GAAW,IAAAC,EAAA,IAAV,EAAEt2H,EAAC,EAAEC,GAAGo2H,EACVjjH,EAAKwiH,GAAL1rI,KAAc8V,GACdoT,EAAKyiH,GAAL3rI,KAAc+V,GACd,MAAOmuB,EAAQC,EAAQ+oD,EAAYC,GAAevjE,EAAKwhH,GAALprI,MAClD,IAAKmW,EAAIC,EAAIE,EAAIC,GAAMqT,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,IAC9C,MAAMs9H,EAAQv2H,EAAIQ,EACZg2H,EAAQv2H,EAAIQ,EACZpE,EAAIvD,KAAKwuC,MAAMivF,EAAOC,GAC5B,GAAIn6H,EAAIyX,EAAKgiH,GAAL5rI,MAIN,OAAO,EAET,MAAMusI,EAAQp6H,EAAIyX,EAAKiiH,GAAL7rI,MACZwsI,EAAID,EAAQp6H,EACZ82C,EAASujF,EAAIH,EACbnjF,EAASsjF,EAAIF,EAGnB,IAAIr2H,EAAKE,EACLD,EAAKE,EACTD,EAAKG,EACLF,EAAKG,EACLD,GAAM2yC,EACN1yC,GAAM2yC,EAIM,QAAZkjF,EAAAxiH,EAAKoiH,GAALhsI,aAAY,IAAAosI,GAAZA,EAAcp9H,KAAK8G,EAAGC,GAItB,MACM02H,EAAKxjF,EAASsjF,EACdG,GAFMxjF,EAASqjF,EAEJ3iH,EAAKmiH,GAAL/rI,MACX2sI,EAAMF,EAAK7iH,EAAKmiH,GAAL/rI,MAMjB,GALA4pB,EAAK6hH,GAALzrI,MAAWxB,IAAIorB,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GAAI,GAC1C6a,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAAC8X,EAAKo2H,EAAKn2H,EAAKo2H,GAAM,GACrC/iH,EAAK6hH,GAALzrI,MAAWxB,IAAIorB,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,IAAK,IAC5C6a,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAAC8X,EAAKo2H,EAAKn2H,EAAKo2H,GAAM,IAEjCn9B,MAAM5lF,EAAK6hH,GAALzrI,MAAW,IAsBnB,OArByB,IAArB4pB,EAAK4hH,GAALxrI,MAAU3B,SACZurB,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAAC2X,EAAKu2H,EAAKt2H,EAAKu2H,GAAM,GACrC/iH,EAAK4hH,GAALxrI,MAAUgP,KACR4hB,IACAA,IACAA,IACAA,KACCza,EAAKu2H,EAAMxoG,GAAUgpD,GACrB92E,EAAKu2H,EAAMxoG,GAAUgpD,GAExBvjE,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAAC2X,EAAKu2H,EAAKt2H,EAAKu2H,GAAM,IACrC/iH,EAAKyhH,GAALrrI,MAAagP,KACX4hB,IACAA,IACAA,IACAA,KACCza,EAAKu2H,EAAMxoG,GAAUgpD,GACrB92E,EAAKu2H,EAAMxoG,GAAUgpD,IAG1BvjE,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAACyX,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,GAAK,IACjCvW,KAAKm9B,UAGfvT,EAAK6hH,GAALzrI,MAAWxB,IAAI,CAACyX,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,GAAK,GAKzC,OAHc3H,KAAKmI,IACjBnI,KAAKu+F,MAAMj3F,EAAKE,EAAIH,EAAKE,GAAMvH,KAAKu+F,MAAMjkD,EAAQD,IAExCr6C,KAAKy+F,GAAK,IAGnBl3F,EAAIC,EAAIE,EAAIC,GAAMqT,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GAC1C6a,EAAK4hH,GAALxrI,MAAUgP,KACR4hB,IACAA,IACAA,IACAA,MACEza,EAAKG,GAAM,EAAI4tB,GAAUgpD,IACzB92E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAE5Bh3E,EAAIC,EAAIH,EAAIC,GAAM0T,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,IAC3C6a,EAAKyhH,GAALrrI,MAAagP,KACX4hB,IACAA,IACAA,IACAA,MACE3a,EAAKE,GAAM,EAAI+tB,GAAUgpD,IACzBh3E,EAAKE,GAAM,EAAI+tB,GAAUgpD,IAEtB,KAIRl3E,EAAIC,EAAIC,EAAIC,EAAIE,EAAIC,GAAMqT,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GAClD6a,EAAK4hH,GAALxrI,MAAUgP,OACNiH,EAAK,EAAIE,GAAM,EAAI+tB,GAAUgpD,IAC7Bh3E,EAAK,EAAIE,GAAM,EAAI+tB,GAAUgpD,IAC7B,EAAIh3E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAC7B,EAAI92E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAC7Bh3E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IACzB92E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAE5B72E,EAAIC,EAAIJ,EAAIC,EAAIH,EAAIC,GAAM0T,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,IACnD6a,EAAKyhH,GAALrrI,MAAagP,OACTiH,EAAK,EAAIE,GAAM,EAAI+tB,GAAUgpD,IAC7Bh3E,EAAK,EAAIE,GAAM,EAAI+tB,GAAUgpD,IAC7B,EAAIh3E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAC7B,EAAI92E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAC7Bh3E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IACzB92E,EAAKG,GAAM,EAAI4tB,GAAUgpD,IAEtB,EACT,CAEAq9C,SAAAA,GACE,GAAIxqI,KAAKm9B,UAEP,MAAO,GAET,MAAM5S,EAAMX,EAAK4hH,GAALxrI,MACN2pD,EAAS//B,EAAKyhH,GAALrrI,MAEf,GAAIwvG,MAAM5lF,EAAK6hH,GAALzrI,MAAW,MAAQA,KAAKm9B,UAEhC,OAAOj+B,EAAAisI,GAAAnrI,KAAK4sI,IAAmBv7H,KAAxBrR,MAGT,MAAM0P,EAAS,GACfA,EAAOV,KAAK,IAADhE,OAAKuf,EAAI,GAAE,KAAAvf,OAAIuf,EAAI,KAC9B,IAAK,IAAI7b,EAAI,EAAGA,EAAI6b,EAAIlsB,OAAQqQ,GAAK,EAC/B8gG,MAAMjlF,EAAI7b,IACZgB,EAAOV,KAAK,IAADhE,OAAKuf,EAAI7b,EAAI,GAAE,KAAA1D,OAAIuf,EAAI7b,EAAI,KAEtCgB,EAAOV,KAAK,IAADhE,OACLuf,EAAI7b,GAAE,KAAA1D,OAAIuf,EAAI7b,EAAI,GAAE,KAAA1D,OAAIuf,EAAI7b,EAAI,GAAE,KAAA1D,OAAIuf,EAAI7b,EAAI,GAAE,KAAA1D,OAAIuf,EAAI7b,EAAI,GAAE,KAAA1D,OAChEuf,EAAI7b,EAAI,KAMhBxP,EAAAisI,GAAAnrI,KAAK6sI,IAAax7H,KAAlBrR,KAAmB0P,GAEnB,IAAK,IAAIhB,EAAIi7C,EAAOtrD,OAAS,EAAGqQ,GAAK,EAAGA,GAAK,EACvC8gG,MAAM7lD,EAAOj7C,IACfgB,EAAOV,KAAK,IAADhE,OAAK2+C,EAAOj7C,EAAI,GAAE,KAAA1D,OAAI2+C,EAAOj7C,EAAI,KAE5CgB,EAAOV,KAAK,IAADhE,OACL2+C,EAAOj7C,GAAE,KAAA1D,OAAI2+C,EAAOj7C,EAAI,GAAE,KAAA1D,OAAI2+C,EAAOj7C,EAAI,GAAE,KAAA1D,OAAI2+C,EAAOj7C,EAAI,GAAE,KAAA1D,OAC9D2+C,EAAOj7C,EAAI,GAAE,KAAA1D,OACX2+C,EAAOj7C,EAAI,KAOrB,OAFAxP,EAAAisI,GAAAnrI,KAAK8sI,IAAez7H,KAApBrR,KAAqB0P,GAEdA,EAAOT,KAAK,IACrB,CAmCA89H,kBAAAA,CAAmBC,EAAS3K,EAAQzzG,EAAKq8G,EAAaC,EAAa/8G,GACjE,OAAO,IAAI8+G,GACTD,EACA3K,EACAzzG,EACAq8G,EACAC,EACA/8G,EAEJ,CAEA++G,WAAAA,GAAc,IAAAC,EAAAC,EACZ,MAAM7iH,EAAMX,EAAK4hH,GAALxrI,MACN2pD,EAAS//B,EAAKyhH,GAALrrI,MACTqtI,EAAOzjH,EAAK6hH,GAALzrI,OACNkkC,EAAQC,EAAQ+oD,EAAYC,GAAevjE,EAAKwhH,GAALprI,MAE5CqiI,EAAS,IAAIjhE,cAAkC,QAArB+rE,EAAa,QAAbC,EAACxjH,EAAKoiH,GAALhsI,aAAY,IAAAotI,OAAA,EAAZA,EAAc/uI,cAAM,IAAA8uI,EAAAA,EAAI,GAAK,GAC9D,IAAK,IAAIz+H,EAAI,EAAGuS,EAAKohH,EAAOhkI,OAAS,EAAGqQ,EAAIuS,EAAIvS,GAAK,EACnD2zH,EAAO3zH,IAAMkb,EAAKoiH,GAALhsI,MAAa0O,GAAKw1B,GAAUgpD,EACzCm1C,EAAO3zH,EAAI,IAAMkb,EAAKoiH,GAALhsI,MAAa0O,EAAI,GAAKy1B,GAAUgpD,EAKnD,GAHAk1C,EAAOA,EAAOhkI,OAAS,IAAMurB,EAAK8hH,GAAL1rI,MAAckkC,GAAUgpD,EACrDm1C,EAAOA,EAAOhkI,OAAS,IAAMurB,EAAK+hH,GAAL3rI,MAAcmkC,GAAUgpD,EAEjDqiB,MAAM69B,EAAK,MAAQrtI,KAAKm9B,UAE1B,OAAOj+B,EAAAisI,GAAAnrI,KAAKstI,IAAoBj8H,KAAzBrR,KAA0BqiI,GAGnC,MAAM2K,EAAU,IAAI5rE,aAClBx3C,EAAK4hH,GAALxrI,MAAU3B,OAAS,GAAKurB,EAAKyhH,GAALrrI,MAAa3B,QAEvC,IAAIkvI,EAAIhjH,EAAIlsB,OACZ,IAAK,IAAIqQ,EAAI,EAAGA,EAAI6+H,EAAG7+H,GAAK,EACtB8gG,MAAMjlF,EAAI7b,IACZs+H,EAAQt+H,GAAKs+H,EAAQt+H,EAAI,GAAKkiB,KAGhCo8G,EAAQt+H,GAAK6b,EAAI7b,GACjBs+H,EAAQt+H,EAAI,GAAK6b,EAAI7b,EAAI,IAG3B6+H,EAAIruI,EAAAisI,GAAAnrI,KAAKwtI,IAAcn8H,KAAnBrR,KAAoBgtI,EAASO,GAEjC,IAAK,IAAI7+H,EAAIi7C,EAAOtrD,OAAS,EAAGqQ,GAAK,EAAGA,GAAK,EAC3C,IAAK,IAAI49D,EAAI,EAAGA,EAAI,EAAGA,GAAK,EACtBkjC,MAAM7lD,EAAOj7C,EAAI49D,KACnB0gE,EAAQO,GAAKP,EAAQO,EAAI,GAAK38G,IAC9B28G,GAAK,IAGPP,EAAQO,GAAK5jF,EAAOj7C,EAAI49D,GACxB0gE,EAAQO,EAAI,GAAK5jF,EAAOj7C,EAAI49D,EAAI,GAChCihE,GAAK,GAMT,OAFAruI,EAAAisI,GAAAnrI,KAAKytI,IAAgBp8H,KAArBrR,KAAsBgtI,EAASO,GAExBvtI,KAAK+sI,mBACVC,EACA3K,EACAz4G,EAAKwhH,GAALprI,MACA4pB,EAAKkiH,GAAL9rI,MACA4pB,EAAK0hH,GAALtrI,MACA4pB,EAAK2hH,GAALvrI,MAEJ,EAsGF,SAAA0tI,KA3XI,MAAMC,EAAU/jH,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GACjC6+H,EAAahkH,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,KACpC+G,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKwhH,GAALprI,MAE9B,MAAO,EACJ4pB,EAAK8hH,GAAL1rI,OAAe2tI,EAAQ,GAAKC,EAAW,IAAM,EAAI93H,GAAKkK,GACtD4J,EAAK+hH,GAAL3rI,OAAe2tI,EAAQ,GAAKC,EAAW,IAAM,EAAI73H,GAAKkK,GACtD2J,EAAK8hH,GAAL1rI,OAAe4tI,EAAW,GAAKD,EAAQ,IAAM,EAAI73H,GAAKkK,GACtD4J,EAAK+hH,GAAL3rI,OAAe4tI,EAAW,GAAKD,EAAQ,IAAM,EAAI53H,GAAKkK,EAE3D,UAAA2sH,KAuKE,MAAO92H,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKwhH,GAALprI,OACvB6tI,EAAUC,EAAUC,EAAaC,GACtC9uI,EAAAisI,GAAAnrI,KAAK0tI,IAAcr8H,KAAnBrR,MAEF,MAAO,IAAPgL,QAAY4e,EAAK6hH,GAALzrI,MAAW,GAAK8V,GAAKkK,EAAK,KAAAhV,QACnC4e,EAAK6hH,GAALzrI,MAAW,GAAK+V,GAAKkK,EAAM,MAAAjV,QACxB4e,EAAK6hH,GAALzrI,MAAW,GAAK8V,GAAKkK,EAAK,KAAAhV,QAAK4e,EAAK6hH,GAALzrI,MAAW,GAAK+V,GAAKkK,EAAM,MAAAjV,OAAK6iI,EAAQ,KAAA7iI,OAAI8iI,EAAQ,MAAA9iI,OAAK+iI,EAAW,KAAA/iI,OAAIgjI,EAAW,MAAAhjI,QACrH4e,EAAK6hH,GAALzrI,MAAW,IAAM8V,GAAKkK,EAAK,KAAAhV,QACzB4e,EAAK6hH,GAALzrI,MAAW,IAAM+V,GAAKkK,EAAM,MAAAjV,QAAM4e,EAAK6hH,GAALzrI,MAAW,IAAM8V,GAAKkK,EAAK,KAAAhV,QAC/D4e,EAAK6hH,GAALzrI,MAAW,IAAM+V,GAAKkK,EAAM,KAEjC,UAAA6sH,GAEgBp9H,GACd,MAAMi6C,EAAS//B,EAAKyhH,GAALrrI,MACf0P,EAAOV,KAAK,IAADhE,OAAK2+C,EAAO,GAAE,KAAA3+C,OAAI2+C,EAAO,GAAE,MACxC,UAAAkjF,GAEcn9H,GACZ,MAAOoG,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKwhH,GAALprI,MACxB2tI,EAAU/jH,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GACjC6+H,EAAahkH,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,KACpC8+H,EAAUC,EAAUC,EAAaC,GACtC9uI,EAAAisI,GAAAnrI,KAAK0tI,IAAcr8H,KAAnBrR,MAEF0P,EAAOV,KAAK,IAADhE,QACJ2iI,EAAQ,GAAK73H,GAAKkK,EAAK,KAAAhV,QAAK2iI,EAAQ,GAAK53H,GAAKkK,EAAM,MAAAjV,OAAK6iI,EAAQ,KAAA7iI,OAAI8iI,EAAQ,MAAA9iI,OAAK+iI,EAAW,KAAA/iI,OAAIgjI,EAAW,MAAAhjI,QAC9G4iI,EAAW,GAAK93H,GAAKkK,EAAK,KAAAhV,QACxB4iI,EAAW,GAAK73H,GAAKkK,GAE9B,UAAAqtH,GAwEqBjL,GACnB,MAAMgL,EAAOzjH,EAAK6hH,GAALzrI,OACNkkC,EAAQC,EAAQ+oD,EAAYC,GAAevjE,EAAKwhH,GAALprI,OAC3C6tI,EAAUC,EAAUC,EAAaC,GACtC9uI,EAAAisI,GAAAnrI,KAAK0tI,IAAcr8H,KAAnBrR,MACIgtI,EAAU,IAAI5rE,aAAa,IA0CjC,OAzCA4rE,EAAQxuI,IACN,CACEoyB,IACAA,IACAA,IACAA,KACCy8G,EAAK,GAAKnpG,GAAUgpD,GACpBmgD,EAAK,GAAKlpG,GAAUgpD,EACrBv8D,IACAA,IACAA,IACAA,KACCy8G,EAAK,GAAKnpG,GAAUgpD,GACpBmgD,EAAK,GAAKlpG,GAAUgpD,EACrBv8D,IACAA,IACAA,IACAA,IACAi9G,EACAC,EACAl9G,IACAA,IACAA,IACAA,IACAm9G,EACAC,EACAp9G,IACAA,IACAA,IACAA,KACCy8G,EAAK,IAAMnpG,GAAUgpD,GACrBmgD,EAAK,IAAMlpG,GAAUgpD,EACtBv8D,IACAA,IACAA,IACAA,KACCy8G,EAAK,IAAMnpG,GAAUgpD,GACrBmgD,EAAK,IAAMlpG,GAAUgpD,GAExB,GAEKntF,KAAK+sI,mBACVC,EACA3K,EACAz4G,EAAKwhH,GAALprI,MACA4pB,EAAKkiH,GAAL9rI,MACA4pB,EAAK0hH,GAALtrI,MACA4pB,EAAK2hH,GAALvrI,MAEJ,UAAAytI,GAEiBT,EAASj6H,GACxB,MAAM42C,EAAS//B,EAAKyhH,GAALrrI,MAEf,OADAgtI,EAAQxuI,IAAI,CAACoyB,IAAKA,IAAKA,IAAKA,IAAK+4B,EAAO,GAAIA,EAAO,IAAK52C,GAChDA,EAAO,CACjB,UAAAy6H,GAEeR,EAASj6H,GACtB,MAAM46H,EAAU/jH,EAAK6hH,GAALzrI,MAAW+O,SAAS,EAAG,GACjC6+H,EAAahkH,EAAK6hH,GAALzrI,MAAW+O,SAAS,GAAI,KACpCm1B,EAAQC,EAAQ+oD,EAAYC,GAAevjE,EAAKwhH,GAALprI,OAC3C6tI,EAAUC,EAAUC,EAAaC,GACtC9uI,EAAAisI,GAAAnrI,KAAK0tI,IAAcr8H,KAAnBrR,MA8BF,OA7BAgtI,EAAQxuI,IACN,CACEoyB,IACAA,IACAA,IACAA,KACC+8G,EAAQ,GAAKzpG,GAAUgpD,GACvBygD,EAAQ,GAAKxpG,GAAUgpD,EACxBv8D,IACAA,IACAA,IACAA,IACAi9G,EACAC,EACAl9G,IACAA,IACAA,IACAA,IACAm9G,EACAC,EACAp9G,IACAA,IACAA,IACAA,KACCg9G,EAAW,GAAK1pG,GAAUgpD,GAC1B0gD,EAAW,GAAKzpG,GAAUgpD,GAE7Bp6E,GAEMA,EAAO,EACjB,KAAAk5H,GAAA,CAAArpH,EApZmB,GAECspH,GAAA,CAAAtpH,EAEWqpH,GAASrpH,EAFrB,GAEkDqrH,GAAA,IAAAtgH,QAAAugH,GAAA,IAAAvgH,QAAAwgH,GAAA,IAAAxgH,QAAAygH,GAAA,IAAAzgH,QAAA0gH,GAAA,IAAA1gH,QAAA2gH,GAAA,IAAA3gH,QAAA4gH,GAAA,IAAA5gH,QAAA6gH,GAAA,IAAAzgH,QAmZvE,MAAMk/G,WAAwB1C,GAe5B/8H,WAAAA,CAAYw/H,EAAS3K,EAAQzzG,EAAKq8G,EAAaC,EAAa/8G,GAC1DxgB,QAAO7O,EAAA,KAAA0vI,IAfTvvI,EAAA,KAAAgvI,QAAI,GAEJhvI,EAAA,KAAAivI,GAAQ,IAAI9sE,aAAa,IAEzBniE,EAAA,KAAAkvI,QAAY,GAEZlvI,EAAA,KAAAmvI,QAAM,GAENnvI,EAAA,KAAAovI,QAAO,GAEPpvI,EAAA,KAAAqvI,QAAY,GAEZrvI,EAAA,KAAAsvI,QAAQ,GAINrlH,EAAKqlH,GAALvuI,KAAgBgtI,GAChB9jH,EAAKmlH,GAALruI,KAAeqiI,GACfn5G,EAAK+kH,GAALjuI,KAAY4uB,GACZ1F,EAAKolH,GAALtuI,KAAoBirI,GACpB/hH,EAAKilH,GAALnuI,KAAoBkrI,GACpBhiH,EAAKklH,GAALpuI,KAAcmuB,GACdnuB,KAAKyuI,WAAa,CAAC79G,IAAKA,KACxB5wB,KAAK0uI,UAAY,CAAC99G,IAAKA,KACvB1xB,EAAAsvI,GAAAxuI,KAAK2uI,IAAct9H,KAAnBrR,KAAoBmuB,GAEpB,MAAOrY,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKskH,GAALluI,MAC9B,IAAK,IAAI0O,EAAI,EAAGuS,EAAK+rH,EAAQ3uI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAChDs+H,EAAQt+H,IAAMs+H,EAAQt+H,GAAKoH,GAAKkK,EAChCgtH,EAAQt+H,EAAI,IAAMs+H,EAAQt+H,EAAI,GAAKqH,GAAKkK,EAE1C,IAAK,IAAIvR,EAAI,EAAGuS,EAAKohH,EAAOhkI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC/C2zH,EAAO3zH,IAAM2zH,EAAO3zH,GAAKoH,GAAKkK,EAC9BqiH,EAAO3zH,EAAI,IAAM2zH,EAAO3zH,EAAI,GAAKqH,GAAKkK,CAE1C,CAEAuqH,SAAAA,GACE,MAAM96H,EAAS,CAAC,IAAD1E,OAAK4e,EAAK2kH,GAALvuI,MAAc,GAAE,KAAAgL,OAAI4e,EAAK2kH,GAALvuI,MAAc,KACtD,IAAK,IAAI0O,EAAI,EAAGuS,EAAK2I,EAAK2kH,GAALvuI,MAAc3B,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAClD8gG,MAAM5lF,EAAK2kH,GAALvuI,MAAc0O,IACtBgB,EAAOV,KAAK,IAADhE,OAAK4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,GAAE,KAAA1D,OAAI4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,KAG5DgB,EAAOV,KAAK,IAADhE,OACL4e,EAAK2kH,GAALvuI,MAAc0O,GAAE,KAAA1D,OAAI4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,GAAE,KAAA1D,OAAI4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,GAAE,KAAA1D,OAClE4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,GAAE,KAAA1D,OAClB4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,GAAE,KAAA1D,OAAI4e,EAAK2kH,GAALvuI,MAAc0O,EAAI,KAIlD,OADAgB,EAAOV,KAAK,KACLU,EAAOT,KAAK,IACrB,CAEA24B,SAAAA,CAASgnG,EAAuBxvH,GAAU,IAA/BooC,EAAKC,EAAKC,EAAKH,GAAIqnF,EAC5B,MAAM5uH,EAAQ0nC,EAAMF,EACdvnC,EAASsnC,EAAME,EACrB,IAAIulF,EACA3K,EACJ,OAAQjjH,GACN,KAAK,EACH4tH,EAAUzC,GAAQG,SAAS9gH,EAAK2kH,GAALvuI,MAAewnD,EAAKD,EAAKvnC,GAAQC,GAC5DoiH,EAASkI,GAAQG,SAAS9gH,EAAKykH,GAALruI,MAAcwnD,EAAKD,EAAKvnC,GAAQC,GAC1D,MACF,KAAK,GACH+sH,EAAUzC,GAAQI,gBAChB/gH,EAAK2kH,GAALvuI,MACAwnD,EACAC,EACAznC,EACAC,GAEFoiH,EAASkI,GAAQI,gBAAgB/gH,EAAKykH,GAALruI,MAAcwnD,EAAKC,EAAKznC,EAAOC,GAChE,MACF,KAAK,IACH+sH,EAAUzC,GAAQG,SAAS9gH,EAAK2kH,GAALvuI,MAAe0nD,EAAKD,GAAMznC,EAAOC,GAC5DoiH,EAASkI,GAAQG,SAAS9gH,EAAKykH,GAALruI,MAAc0nD,EAAKD,GAAMznC,EAAOC,GAC1D,MACF,KAAK,IACH+sH,EAAUzC,GAAQI,gBAChB/gH,EAAK2kH,GAALvuI,MACA0nD,EACAH,GACCvnC,GACAC,GAEHoiH,EAASkI,GAAQI,gBACf/gH,EAAKykH,GAALruI,MACA0nD,EACAH,GACCvnC,GACAC,GAIP,MAAO,CAAE+sH,QAASz7H,MAAMC,KAAKw7H,GAAU3K,OAAQ,CAAC9wH,MAAMC,KAAK6wH,IAC7D,CA6EA,OAAIzzG,GACF,OAAOhF,EAAKskH,GAALluI,KACT,CAEA6uI,WAAAA,CAAYj/E,EAAOhhC,EAAKq8G,EAAarI,EAAWz0G,GAC9C,OAAO,IAAI48G,GACTn7E,EACAhhC,EACAq8G,EACArI,EACAz0G,EAN8DhvB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EASrE,CAEA2vI,aAAAA,CAAclM,EAAWsI,GAEvB,MAAOp1H,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKskH,GAALluI,OACvBkkC,EAAQC,EAAQ+oD,EAAYC,GAAevjE,EAAKqkH,GAALjuI,MAC5C6kB,EAAK7E,EAAQktE,EACbpoE,EAAK7E,EAASktE,EACdz9C,EAAK55B,EAAIo3E,EAAahpD,EACtByL,EAAK55B,EAAIo3E,EAAchpD,EACvB4qG,EAAW/uI,KAAK6uI,YACpB,CACE/4H,EAAG8T,EAAKykH,GAALruI,MAAa,GAAK6kB,EAAK6qB,EAC1B35B,EAAG6T,EAAKykH,GAALruI,MAAa,GAAK8kB,EAAK6qB,GAE5B/lB,EAAKqkH,GAALjuI,MACA4pB,EAAK0kH,GAALtuI,MACA4iI,EACAh5G,EAAKwkH,GAALpuI,MACW,OAAXkrI,QAAW,IAAXA,EAAAA,EAAethH,EAAKukH,GAALnuI,OAEjB,IAAK,IAAI0O,EAAI,EAAGA,EAAIkb,EAAKykH,GAALruI,MAAa3B,OAAQqQ,GAAK,EAC5CqgI,EAAS/vI,IAAI,CACX8W,EAAG8T,EAAKykH,GAALruI,MAAa0O,GAAKmW,EAAK6qB,EAC1B35B,EAAG6T,EAAKykH,GAALruI,MAAa0O,EAAI,GAAKoW,EAAK6qB,IAGlC,OAAOo/F,EAAS7B,aAClB,EACF,SAAAyB,GArHiBxgH,GACb,MAAM6+G,EAAUpjH,EAAK2kH,GAALvuI,MAChB,IAAI2uB,EAAQq+G,EAAQ,GAChBt+G,EAAQs+G,EAAQ,GACpB,MAAM16H,EAAS,CAACqc,EAAOD,EAAOC,EAAOD,GACrC,IAAIsgH,EAAcrgH,EACdsgH,EAAcvgH,EACdwgH,EAAavgH,EACbwgH,EAAazgH,EACjB,MAAM0gH,EAAcjhH,EAAQvf,KAAKiG,IAAMjG,KAAKC,IACtCwgI,EAAa,IAAIjuE,aAAa,GAEpC,IAAK,IAAI1yD,EAAI,EAAGuS,EAAK+rH,EAAQ3uI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CACnD,MAAMoH,EAAIk3H,EAAQt+H,EAAI,GACpBqH,EAAIi3H,EAAQt+H,EAAI,GAEd8gG,MAAMw9B,EAAQt+H,KAChBkD,GAAKiE,iBAAiBC,EAAGC,EAAGzD,GAExB28H,EAAcl5H,GAChBi5H,EAAcl5H,EACdm5H,EAAcl5H,GACLk5H,IAAgBl5H,IACzBi5H,EAAcI,EAAYJ,EAAal5H,IAErCq5H,EAAap5H,GACfm5H,EAAap5H,EACbq5H,EAAap5H,GACJo5H,IAAep5H,IACxBm5H,EAAaE,EAAYF,EAAYp5H,MAGvCu5H,EAAW,GAAKA,EAAW,GAAK/pH,IAChC+pH,EAAW,GAAKA,EAAW,IAAM/pH,IACjC1T,GAAKyE,kBACHsY,EACAD,KACGs+G,EAAQ33H,MAAM3G,EAAGA,EAAI,GACxB2gI,GAGFz9H,GAAKoE,gBACHq5H,EAAW,GACXA,EAAW,GACXA,EAAW,GACXA,EAAW,GACX/8H,GAGE28H,EAAcI,EAAW,IAC3BL,EAAcK,EAAW,GACzBJ,EAAcI,EAAW,IAChBJ,IAAgBI,EAAW,KACpCL,EAAcI,EAAYJ,EAAaK,EAAW,KAEhDF,EAAaE,EAAW,IAC1BH,EAAaG,EAAW,GACxBF,EAAaE,EAAW,IACfF,IAAeE,EAAW,KACnCH,EAAaE,EAAYF,EAAYG,EAAW,MAGpD1gH,EAAQ7Y,EACR4Y,EAAQ3Y,CACV,CAEA,MAAMilD,EAAOpxC,EAAKskH,GAALluI,MACbg7D,EAAK,GAAK1oD,EAAO,GAAKsX,EAAKukH,GAALnuI,MACtBg7D,EAAK,GAAK1oD,EAAO,GAAKsX,EAAKukH,GAALnuI,MACtBg7D,EAAK,GAAK1oD,EAAO,GAAKA,EAAO,GAAK,EAAIsX,EAAKukH,GAALnuI,MACtCg7D,EAAK,GAAK1oD,EAAO,GAAKA,EAAO,GAAK,EAAIsX,EAAKukH,GAALnuI,MACtCA,KAAKyuI,WAAa,CAACO,EAAaC,GAChCjvI,KAAK0uI,UAAY,CAACQ,EAAYC,EAChC,C,8FCpmBF,MAAMG,GAuBJ9hI,WAAAA,CAAY0gB,GAAuD,IAAhD8gG,EAAW7vH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAG+rI,EAAW/rI,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EAAGgvB,IAAKhvB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GAAOL,EAAA,KAAAywI,IAtBjEtwI,EAAA,KAAAuwI,QAAI,GAEJvwI,EAAA,KAAAwwI,QAAW,GAEXxwI,EAAA,KAAAywI,QAAU,GAEVzwI,EAAA,KAAA0wI,GAAiB,IAEjB1wI,EAAA,KAAA2wI,GAAa,IAeX,MAAMt9H,EAAS,CAACgT,IAAUA,KAAWA,KAAWA,KAK1CuqH,EAAU,KADS,EAIzB,IAAK,MAAM,EAAE/5H,EAAC,EAAEC,EAAC,MAAEiK,EAAK,OAAEC,KAAYiO,EAAO,CAC3C,MAAM/X,EAAKvH,KAAKiY,OAAO/Q,EAAIk5G,GAAe6gB,GAAWA,EAC/Cv5H,EAAK1H,KAAKiX,MAAM/P,EAAIkK,EAAQgvG,GAAe6gB,GAAWA,EACtDz5H,EAAKxH,KAAKiY,OAAO9Q,EAAIi5G,GAAe6gB,GAAWA,EAC/Ct5H,EAAK3H,KAAKiX,MAAM9P,EAAIkK,EAAS+uG,GAAe6gB,GAAWA,EACvDpsF,EAAO,CAACttC,EAAIC,EAAIG,GAAI,GACpBqzC,EAAQ,CAACtzC,EAAIF,EAAIG,GAAI,GAC3BqT,EAAK+lH,GAAL3vI,MAAoBgP,KAAKy0C,EAAMmG,GAE/Bh4C,GAAKoE,gBAAgBG,EAAIC,EAAIE,EAAIC,EAAIjE,EACvC,CAEA,MAAMksE,EAAYlsE,EAAO,GAAKA,EAAO,GAAK,EAAI44H,EACxCzsD,EAAansE,EAAO,GAAKA,EAAO,GAAK,EAAI44H,EACzC4E,EAAcx9H,EAAO,GAAK44H,EAC1B6E,EAAcz9H,EAAO,GAAK44H,EAChC,IAAI8D,EAAc7gH,GAAS7I,IAAWA,IAClC2pH,EAAc3pH,IAClB,MAAM0qH,EAAWpmH,EAAK+lH,GAAL3vI,MAAoB4c,GAAGuR,GAAS,GAAK,GAChDugH,EAAY,CAACsB,EAAS,GAAIA,EAAS,IAGzC,IAAK,MAAMC,KAAQrmH,EAAK+lH,GAAL3vI,MAAqB,CACtC,MAAO8V,EAAGM,EAAIG,EAAIktC,GAAQwsF,GACrBxsF,GAAQt1B,EACP/X,EAAK64H,GACPA,EAAc74H,EACd44H,EAAcl5H,GACLM,IAAO64H,IAChBD,EAAcpgI,KAAKiG,IAAIm6H,EAAal5H,IAE7B2tC,IAASt1B,IACd/X,EAAK64H,GACPA,EAAc74H,EACd44H,EAAcl5H,GACLM,IAAO64H,IAChBD,EAAcpgI,KAAKC,IAAImgI,EAAal5H,KAIxCm6H,EAAK,IAAMn6H,EAAIg6H,GAAetxD,EAC9ByxD,EAAK,IAAM75H,EAAK25H,GAAetxD,EAC/BwxD,EAAK,IAAM15H,EAAKw5H,GAAetxD,CACjC,CAEAv1D,EAAKsmH,GAALxvI,KAAY,IAAIohE,aAAa,CAC3B0uE,EACAC,EACAvxD,EACAC,KAEFv1D,EAAKumH,GAALzvI,KAAmB,CAACgvI,EAAaC,IACjC/lH,EAAKwmH,GAAL1vI,KAAkB0uI,EACpB,CAEAxB,WAAAA,GAGEtjH,EAAK+lH,GAAL3vI,MAAoB4lI,KAClB,CAAC7mI,EAAGgT,IAAMhT,EAAE,GAAKgT,EAAE,IAAMhT,EAAE,GAAKgT,EAAE,IAAMhT,EAAE,GAAKgT,EAAE,IAWnD,MAAMm+H,EAAuB,GAC7B,IAAK,MAAMD,KAAQrmH,EAAK+lH,GAAL3vI,MACbiwI,EAAK,IAEPC,EAAqBlhI,QAAQ9P,EAAAqwI,GAAAvvI,KAAKmwI,IAAU9+H,KAAfrR,KAAgBiwI,IAC7C/wI,EAAAqwI,GAAAvvI,KAAKowI,IAAO/+H,KAAZrR,KAAaiwI,KAGb/wI,EAAAqwI,GAAAvvI,KAAKqwI,IAAOh/H,KAAZrR,KAAaiwI,GACbC,EAAqBlhI,QAAQ9P,EAAAqwI,GAAAvvI,KAAKmwI,IAAU9+H,KAAfrR,KAAgBiwI,KAGjD,OAAO/wI,EAAAqwI,GAAAvvI,KAAKswI,IAAYj/H,KAAjBrR,KAAkBkwI,EAC3B,EAuJF,SAAAI,GArJeJ,GACX,MAAMK,EAAQ,GACRC,EAAW,IAAIhhH,IAErB,IAAK,MAAMygH,KAAQC,EAAsB,CACvC,MAAOp6H,EAAGM,EAAIG,GAAM05H,EACpBM,EAAMvhI,KAAK,CAAC8G,EAAGM,EAAI65H,GAAO,CAACn6H,EAAGS,EAAI05H,GACpC,CAOAM,EAAM3K,KAAK,CAAC7mI,EAAGgT,IAAMhT,EAAE,GAAKgT,EAAE,IAAMhT,EAAE,GAAKgT,EAAE,IAC7C,IAAK,IAAIrD,EAAI,EAAGuS,EAAKsvH,EAAMlyI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CACjD,MAAM+hI,EAAQF,EAAM7hI,GAAG,GACjBgiI,EAAQH,EAAM7hI,EAAI,GAAG,GAC3B+hI,EAAMzhI,KAAK0hI,GACXA,EAAM1hI,KAAKyhI,GACXD,EAASxxI,IAAIyxI,GACbD,EAASxxI,IAAI0xI,EACf,CACA,MAAMC,EAAW,GACjB,IAAI3D,EAEJ,KAAOwD,EAAS//G,KAAO,GAAG,CACxB,MAAMw/G,EAAOO,EAASnxG,SAASp/B,OAAOH,MACtC,IAAKgW,EAAGM,EAAIG,EAAIk6H,EAAOC,GAAST,EAChCO,EAASnlH,OAAO4kH,GAChB,IAAIf,EAAap5H,EACbq5H,EAAa/4H,EAKjB,IAHA42H,EAAU,CAACl3H,EAAGS,GACdo6H,EAAS3hI,KAAKg+H,KAED,CACX,IAAI9uI,EACJ,GAAIsyI,EAAS5xI,IAAI6xI,GACfvyI,EAAIuyI,MACC,KAAID,EAAS5xI,IAAI8xI,GAGtB,MAFAxyI,EAAIwyI,CAGN,CAEAF,EAASnlH,OAAOntB,IACf4X,EAAGM,EAAIG,EAAIk6H,EAAOC,GAASxyI,EAExBgxI,IAAep5H,IACjBk3H,EAAQh+H,KAAKkgI,EAAYC,EAAYr5H,EAAGq5H,IAAe/4H,EAAKA,EAAKG,GACjE24H,EAAap5H,GAEfq5H,EAAaA,IAAe/4H,EAAKG,EAAKH,CACxC,CACA42H,EAAQh+H,KAAKkgI,EAAYC,EAC3B,CACA,OAAO,IAAIyB,GACTD,EACA/mH,EAAK4lH,GAALxvI,MACA4pB,EAAK6lH,GAALzvI,MACA4pB,EAAK8lH,GAAL1vI,MAEJ,UAAA6wI,GAEc96H,GACZ,MAAMu5D,EAAQ1lD,EAAKgmH,GAAL5vI,MACd,IAAI+hB,EAAQ,EACRC,EAAMstD,EAAMjxE,OAAS,EAEzB,KAAO0jB,GAASC,GAAK,CACnB,MAAM8uH,EAAU/uH,EAAQC,GAAQ,EAC1B5L,EAAKk5D,EAAMwhE,GAAQ,GACzB,GAAI16H,IAAOL,EACT,OAAO+6H,EAEL16H,EAAKL,EACPgM,EAAQ+uH,EAAS,EAEjB9uH,EAAM8uH,EAAS,CAEnB,CACA,OAAO9uH,EAAM,CACf,UAAAouH,GAAAW,GAEoB,IAAX,CAAE36H,EAAIG,GAAGw6H,EAChB,MAAMx0E,EAAQr9D,EAAAqwI,GAAAvvI,KAAK6wI,IAAax/H,KAAlBrR,KAAmBoW,GACjCwT,EAAKgmH,GAAL5vI,MAAgBw1B,OAAO+mC,EAAO,EAAG,CAACnmD,EAAIG,GACxC,UAAA85H,GAAAW,GAEoB,IAAX,CAAE56H,EAAIG,GAAGy6H,EAChB,MAAMz0E,EAAQr9D,EAAAqwI,GAAAvvI,KAAK6wI,IAAax/H,KAAlBrR,KAAmBoW,GACjC,IAAK,IAAI1H,EAAI6tD,EAAO7tD,EAAIkb,EAAKgmH,GAAL5vI,MAAgB3B,OAAQqQ,IAAK,CACnD,MAAOqT,EAAOC,GAAO4H,EAAKgmH,GAAL5vI,MAAgB0O,GACrC,GAAIqT,IAAU3L,EACZ,MAEF,GAAI2L,IAAU3L,GAAM4L,IAAQzL,EAE1B,YADAqT,EAAKgmH,GAAL5vI,MAAgBw1B,OAAO9mB,EAAG,EAG9B,CACA,IAAK,IAAIA,EAAI6tD,EAAQ,EAAG7tD,GAAK,EAAGA,IAAK,CACnC,MAAOqT,EAAOC,GAAO4H,EAAKgmH,GAAL5vI,MAAgB0O,GACrC,GAAIqT,IAAU3L,EACZ,MAEF,GAAI2L,IAAU3L,GAAM4L,IAAQzL,EAE1B,YADAqT,EAAKgmH,GAAL5vI,MAAgBw1B,OAAO9mB,EAAG,EAG9B,CACF,UAAAyhI,GAEWF,GACT,MAAOn6H,EAAGM,EAAIG,GAAM05H,EACd/uB,EAAU,CAAC,CAACprG,EAAGM,EAAIG,IACnBgmD,EAAQr9D,EAAAqwI,GAAAvvI,KAAK6wI,IAAax/H,KAAlBrR,KAAmBuW,GACjC,IAAK,IAAI7H,EAAI,EAAGA,EAAI6tD,EAAO7tD,IAAK,CAC9B,MAAOqT,EAAOC,GAAO4H,EAAKgmH,GAAL5vI,MAAgB0O,GACrC,IAAK,IAAI49D,EAAI,EAAG+R,EAAK6iC,EAAQ7iH,OAAQiuE,EAAI+R,EAAI/R,IAAK,CAChD,MAAO,CAAE71D,EAAIw6H,GAAM/vB,EAAQ50C,GAC3B,KAAItqD,GAAOvL,GAAMw6H,GAAMlvH,GAKvB,GAAItL,GAAMsL,EACR,GAAIkvH,EAAKjvH,EACPk/F,EAAQ50C,GAAG,GAAKtqD,MACX,CACL,GAAW,IAAPq8D,EACF,MAAO,GAGT6iC,EAAQ1rF,OAAO82C,EAAG,GAClBA,IACA+R,GACF,MAGF6iC,EAAQ50C,GAAG,GAAKvqD,EACZkvH,EAAKjvH,GACPk/F,EAAQlyG,KAAK,CAAC8G,EAAGkM,EAAKivH,GAE1B,CACF,CACA,OAAO/vB,CACT,KAAAgwB,GAAA,IAAAvjH,QAAAwjH,GAAA,IAAAxjH,QAGF,MAAMijH,WAAyBrG,GAK7B/8H,WAAAA,CAAYmjI,EAAU/hH,EAAK6/G,EAAYC,GACrC/gI,QALF1O,EAAA,KAAAiyI,QAAI,GAEJjyI,EAAA,KAAAkyI,QAAS,GAIPjoH,EAAKioH,GAALnxI,KAAiB2wI,GACjBznH,EAAKgoH,GAALlxI,KAAY4uB,GACZ5uB,KAAKyuI,WAAaA,EAClBzuI,KAAK0uI,UAAYA,CACnB,CAEAlE,SAAAA,GACE,MAAM96H,EAAS,GACf,IAAK,MAAM0hI,KAAWxnH,EAAKunH,GAALnxI,MAAgB,CACpC,IAAKqxI,EAAOC,GAASF,EACrB1hI,EAAOV,KAAK,IAADhE,OAAKqmI,EAAK,KAAArmI,OAAIsmI,IACzB,IAAK,IAAI5iI,EAAI,EAAGA,EAAI0iI,EAAQ/yI,OAAQqQ,GAAK,EAAG,CAC1C,MAAMoH,EAAIs7H,EAAQ1iI,GACZqH,EAAIq7H,EAAQ1iI,EAAI,GAClBoH,IAAMu7H,GACR3hI,EAAOV,KAAK,IAADhE,OAAK+K,IAChBu7H,EAAQv7H,GACCA,IAAMu7H,IACf5hI,EAAOV,KAAK,IAADhE,OAAK8K,IAChBu7H,EAAQv7H,EAEZ,CACApG,EAAOV,KAAK,IACd,CACA,OAAOU,EAAOT,KAAK,IACrB,CAQA24B,SAAAA,CAAS2pG,EAAuB9G,GAAW,IAAhCjjF,EAAKC,EAAKC,EAAKH,GAAIgqF,EAC5B,MAAMZ,EAAW,GACX3wH,EAAQ0nC,EAAMF,EACdvnC,EAASsnC,EAAME,EACrB,IAAK,MAAMulF,KAAWpjH,EAAKunH,GAALnxI,MAAgB,CACpC,MAAMqiI,EAAS,IAAI9wH,MAAMy7H,EAAQ3uI,QACjC,IAAK,IAAIqQ,EAAI,EAAGA,EAAIs+H,EAAQ3uI,OAAQqQ,GAAK,EACvC2zH,EAAO3zH,GAAK84C,EAAMwlF,EAAQt+H,GAAKsR,EAC/BqiH,EAAO3zH,EAAI,GAAK64C,EAAMylF,EAAQt+H,EAAI,GAAKuR,EAEzC0wH,EAAS3hI,KAAKqzH,EAChB,CACA,OAAOsO,CACT,CAEA,OAAI/hH,GACF,OAAOhF,EAAKsnH,GAALlxI,KACT,CAEA,0BAAIwxI,GACF,MAAO,CAAC,mBACV,EAGF,MAAMC,WAA8B1G,GAClCgC,kBAAAA,CAAmBC,EAAS3K,EAAQzzG,EAAKq8G,EAAaC,EAAa/8G,GACjE,OAAO,IAAIujH,GACT1E,EACA3K,EACAzzG,EACAq8G,EACAC,EACA/8G,EAEJ,EAGF,MAAMujH,WAA6BzE,GACjC4B,WAAAA,CAAYj/E,EAAOhhC,EAAKq8G,EAAarI,EAAWz0G,GAC9C,OAAO,IAAIsjH,GACT7hF,EACAhhC,EACAq8G,EACArI,EACAz0G,EAN8DhvB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,EASrE,E,iSCjVF,MAAMwyI,WAAwBl0F,GAqD5B,2BAAW7iB,GACT,MAAMC,EAAQ82G,GAAgBzxI,UAC9B,OAAO4M,GACL9M,KACA,mBACA,IAAI81B,GAAgB,CAClB,CAAC,CAAC,YAAa,iBAAkB+E,EAAM+2G,WAAY,CAAEx5H,KAAM,CAAC,KAC5D,CAAC,CAAC,aAAc,kBAAmByiB,EAAM+2G,WAAY,CAAEx5H,KAAM,CAAC,KAC9D,CAAC,CAAC,UAAW,eAAgByiB,EAAM+2G,WAAY,CAAEx5H,KAAM,CAAC,KACxD,CAAC,CAAC,YAAa,iBAAkByiB,EAAM+2G,WAAY,CAAEx5H,KAAM,CAAC,OAGlE,CAEA5K,WAAAA,CAAYygC,GACVtgC,OAAKq+B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIiC,GAAM,IAAE1gC,KAAM,qBAAoBzO,EAAA,KAAA+yI,IAnE/C5yI,EAAA,KAAA6yI,GAAc,MAEd7yI,EAAA,KAAA8yI,GAAgB,GAEhB9yI,EAAA,KAAA+yI,QAAM,GAEN/yI,EAAA,KAAAgzI,GAAc,MAEdhzI,EAAA,KAAAizI,GAAe,MAEfjzI,EAAA,KAAAkzI,GAAiB,MAEjBlzI,EAAA,KAAAmzI,GAAa,MAEbnzI,EAAA,KAAAozI,GAAe,GAEfpzI,EAAA,KAAAqzI,GAAgB,MAEhBrzI,EAAA,KAAAszI,GAAqB,MAErBtzI,EAAA,KAAAuzI,GAAM,MAENvzI,EAAA,KAAAwzI,IAAmB,GAEnBxzI,EAAA,KAAAyzI,GAAc,MAEdzzI,EAAA,KAAA0zI,GAAa,MAEb1zI,EAAA,KAAA2zI,GAAa,MAEb3zI,EAAA,KAAA4zI,GAAQ,IAER5zI,EAAA,KAAA6zI,QAAU,GAEV7zI,EAAA,KAAA8zI,GAAoB,IAkClB/yI,KAAK2jB,MAAQsqB,EAAOtqB,OAASguH,GAAgBjtB,cAC7Cx7F,EAAK4pH,GAAL9yI,KAAkBiuC,EAAO20F,WAAa+O,GAAgBqB,mBACtDhzI,KAAKyiC,QAAUwL,EAAOxL,SAAWkvG,GAAgBsB,gBACjD/pH,EAAK8oH,GAALhyI,KAAciuC,EAAO/f,OAAS,MAC9BhF,EAAK6pH,GAAL/yI,KAAyBiuC,EAAOpJ,kBAAoB,IACpD3b,EAAK2pH,GAAL7yI,KAAaiuC,EAAO/vB,MAAQ,IAC5Ble,KAAKu/C,cAAe,EACpBv/C,KAAKgoD,cAAgB,gCAEjB/Z,EAAOilG,aAAe,GACxBhqH,EAAKupH,GAALzyI,MAAwB,GACxBd,EAAA2yI,GAAA7xI,KAAKmzI,IAAmB9hI,KAAxBrR,KAAyBiuC,GACzB/uC,EAAA2yI,GAAA7xI,KAAKozI,IAAe/hI,KAApBrR,OACS4pB,EAAKooH,GAALhyI,QACTkpB,EAAK4oH,GAAL9xI,KAAmBiuC,EAAOhJ,YAC1B/b,EAAK6oH,GAAL/xI,KAAqBiuC,EAAO/I,cAC5Bhc,EAAKkpH,GAALpyI,KAAkBiuC,EAAO9I,WACzBjc,EAAKmpH,GAALryI,KAAoBiuC,EAAO7I,aAC3BlmC,EAAA2yI,GAAA7xI,KAAKqzI,IAAehiI,KAApBrR,MACAd,EAAA2yI,GAAA7xI,KAAKozI,IAAe/hI,KAApBrR,MACAA,KAAK+pD,OAAO/pD,KAAKof,WAGdpf,KAAKmrC,qBACRnrC,KAAK6pB,WAAWsc,UAAU,qCAE9B,CAGA,wBAAIqnB,GACF,MAAO,CACLvhB,OAAQ,QACRzrC,KAAMopB,EAAK6oH,GAALzyI,MAAwB,iBAAmB,YACjD2jB,MAAO3jB,KAAK6pB,WAAW+W,mBAAmB5gC,KAAK2jB,OAC/Ci/G,UAAWh5G,EAAKkpH,GAAL9yI,MACX6kC,iBAAkBjb,EAAKmpH,GAAL/yI,MAEtB,CAGA,sBAAIytD,GACF,MAAO,CACLjtD,KAAM,YACNmjB,MAAO3jB,KAAK6pB,WAAW+W,mBAAmB5gC,KAAK2jB,OAEnD,CAEA,gCAAOgxC,CAA0BzsC,GAE/B,MAAO,CAAEorH,eAAgBprH,EAAK5oB,IAAI,SAASmxB,KAC7C,CA6HA,iBAAOyjB,CAAWC,EAAMlmB,GAAW,IAAAslH,EACjC91F,GAAiBvJ,WAAWC,EAAMlmB,GAClC0jH,GAAgBjtB,gBAAhBitB,GAAgBjtB,eACW,QAAzB6uB,EAAAtlH,EAAUyO,uBAAe,IAAA62G,OAAA,EAAzBA,EAA2Bl0G,SAASp/B,OAAOH,QAAS,UACxD,CAGA,0BAAOosC,CAAoB1rC,EAAMV,GAC/B,OAAQU,GACN,KAAKmB,EAA2BS,gBAC9BuvI,GAAgBjtB,cAAgB5kH,EAChC,MACF,KAAK6B,EAA2BU,oBAC9BsvI,GAAgBqB,kBAAoBlzI,EAG1C,CAGA8uC,eAAAA,CAAgB94B,EAAGC,GAAI,CAGvB,mBAAIqU,GACF,OAAOR,EAAK+oH,GAAL3yI,KACT,CAGA,yBAAIo3C,GACF,OAAOxtB,EAAK8oH,GAAL1yI,KACT,CAGA89B,YAAAA,CAAat9B,EAAMV,GACjB,OAAQU,GACN,KAAKmB,EAA2BS,gBAC9BlD,EAAA2yI,GAAA7xI,KAAKwzI,IAAYniI,KAAjBrR,KAAkBF,GAClB,MACF,KAAK6B,EAA2BU,oBAC9BnD,EAAA2yI,GAAA7xI,KAAKyzI,IAAgBpiI,KAArBrR,KAAsBF,GAG5B,CAEA,oCAAWupC,GACT,MAAO,CACL,CACE1nC,EAA2BS,gBAC3BuvI,GAAgBjtB,eAElB,CACE/iH,EAA2BU,oBAC3BsvI,GAAgBqB,mBAGtB,CAGA,sBAAIzlG,GACF,MAAO,CACL,CACE5rC,EAA2BS,gBAC3BpC,KAAK2jB,OAASguH,GAAgBjtB,eAEhC,CACE/iH,EAA2BU,oBAC3BunB,EAAKkpH,GAAL9yI,OAAmB2xI,GAAgBqB,mBAErC,CAACrxI,EAA2BW,eAAgBsnB,EAAK6oH,GAALzyI,OAEhD,CAGA03C,cAAAA,GAAiB,IAAAg8F,EAAAC,EACJ,QAAXD,EAAA1zI,KAAK2c,cAAM,IAAA+2H,GAAXA,EAAaE,UAAUC,iBAAiBjqH,EAAK4oH,GAALxyI,MAAU,CAChD4b,KAAM,CACJ5V,KAAMhG,KAAK2jB,MACX,eAAgB3jB,KAAKyiC,WAGR,QAAjBkxG,EAAA/pH,EAAKsoH,GAALlyI,aAAiB,IAAA2zI,GAAjBA,EAAmB9sB,YAAY7mH,KAAK2jB,OACpChW,MAAM+pC,gBACR,CA+DA,kBAAIiN,GACF,GAAI3kD,KAAK6pB,WAAW6S,gBAAiB,CAInC,MAAO,CAAC,CAAC,cAHYxT,EAAKgpH,GAALlyI,KAAoB,IAAI6jH,GAAY,CACvDr7F,OAAQxoB,SAGZ,CACA,OAAO2N,MAAMg3C,cACf,CAGAsI,cAAAA,GACEt/C,MAAMs/C,iBACNjtD,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAY,EACxC,CAGA6oB,aAAAA,GACEv/C,MAAMu/C,gBACNltD,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAY,EACxC,CAGAyd,iBAAAA,GACE,OAAOn0C,MAAMm0C,kBAAkB5iD,EAAA2yI,GAAA7xI,KAAK8zI,IAAYziI,KAAjBrR,MACjC,CAGAwjD,kBAAAA,GAGE,MAAO,CAAC,EAAG,EACb,CAGAwF,OAAAA,CAAQtZ,EAAIC,GACV,OAAOhiC,MAAMq7C,QAAQtZ,EAAIC,EAAIzwC,EAAA2yI,GAAA7xI,KAAK8zI,IAAYziI,KAAjBrR,MAC/B,CAGAspD,SAAAA,CAAUtlB,GACHhkC,KAAKmrC,qBACRnrC,KAAK2c,OAAOo3H,kBAAkB/zI,MAE5BgkC,GACFhkC,KAAKmc,IAAI6nB,OAEb,CAGAlZ,MAAAA,GACE5rB,EAAA2yI,GAAA7xI,KAAKg0I,IAAe3iI,KAApBrR,MACAA,KAAKw0C,iBAAiB,CACpBvI,OAAQ,YAEVt+B,MAAMmd,QACR,CAGA+kB,OAAAA,GACO7vC,KAAK2c,SAGVhP,MAAMkiC,UACW,OAAb7vC,KAAKmc,MAITjd,EAAA2yI,GAAA7xI,KAAKozI,IAAe/hI,KAApBrR,MAEKA,KAAKmgD,iBAGRngD,KAAK2c,OAAO3d,IAAIgB,OAEpB,CAEAkiD,SAAAA,CAAUvlC,GACR,IAAIs3H,GAAiB,EACrB,GAAIj0I,KAAK2c,SAAWA,EAClBzd,EAAA2yI,GAAA7xI,KAAKg0I,IAAe3iI,KAApBrR,WACK,GAAI2c,EAAQ,KAAAu3H,EACjBh1I,EAAA2yI,GAAA7xI,KAAKozI,IAAe/hI,KAApBrR,KAAqB2c,GAGrBs3H,GACGj0I,KAAK2c,SAAkB,QAAZu3H,EAAIl0I,KAAKmc,WAAG,IAAA+3H,OAAA,EAARA,EAAUlsH,UAAU+S,SAAS,kBACjD,CACAptB,MAAMu0C,UAAUvlC,GAChB3c,KAAK2qB,KAAK3qB,KAAKioD,YACXgsF,GAEFj0I,KAAK4tC,QAET,CA8EAmc,MAAAA,CAAOoE,GAEL,MAAM,UAAEylF,GAAc5zI,KAAK2c,OAC3B,IAAIiS,EACAhF,EAAK6oH,GAALzyI,OACFmuD,GAASA,EAAQnuD,KAAKof,SAAW,KAAO,IACxCwP,EAAMulH,GAA2B9iI,KAA3BsgI,GAA4B/nH,EAAK2oH,GAALvyI,MAAwB4uB,IAAKu/B,IAG/Dv/B,EAAMulH,GAA2B9iI,KAA3BsgI,GACJ,CAAC3xI,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,QAClCkuC,GAGJylF,EAAUC,iBAAiBjqH,EAAK4oH,GAALxyI,MAAU,CACnCg7D,KAAMpsC,EACNhT,KAAM,CACJ,qBAAsBuyC,KAG1BylF,EAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CAC1Cg7D,KAAMm5E,GAA2B9iI,KAA3BsgI,GAA4B/nH,EAAKuoH,GAALnyI,MAAoB4uB,IAAKu/B,GAC3DvyC,KAAM,CACJ,qBAAsBuyC,IAG5B,CAGA1yC,MAAAA,GACE,GAAIzb,KAAKmc,IACP,OAAOnc,KAAKmc,IAGd,MAAMA,EAAMxO,MAAM8N,SACdmO,EAAKipH,GAAL7yI,QACFmc,EAAI/B,aAAa,aAAcwP,EAAKipH,GAAL7yI,OAC/Bmc,EAAI/B,aAAa,OAAQ,SAEvBwP,EAAK6oH,GAALzyI,MACFmc,EAAI6L,UAAUhpB,IAAI,QAElBgB,KAAKmc,IAAIpC,iBAAiB,UAAW7a,EAAA2yI,GAAA7xI,KAAKo0I,IAAS7mH,KAAKvtB,MAAO,CAC7D2pB,OAAQ3pB,KAAK6pB,WAAWC,UAG5B,MAAMuqH,EAAgBnrH,EAAKopH,GAALtyI,KAAqB+b,SAASC,cAAc,QAUlE,OATAG,EAAIC,OAAOi4H,GACXA,EAAaj6H,aAAa,cAAe,QACzCi6H,EAAa3sH,UAAY,WACzB2sH,EAAah5H,MAAM41G,SAAWrnG,EAAKqoH,GAALjyI,MAC9BA,KAAKmkD,UAELj1B,GAAWlvB,KAAM4pB,EAAK0oH,GAALtyI,MAAoB,CAAC,cAAe,iBACrDA,KAAKktD,gBAEE/wC,CACT,CAEAm4H,WAAAA,GACwB,IAAAC,EAAjBv0I,KAAKqiC,aACG,QAAXkyG,EAAAv0I,KAAK2c,cAAM,IAAA43H,GAAXA,EAAaX,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACvDw0I,UAAW,CACTC,SAAS,KAIjB,CAEAC,YAAAA,GACwB,IAAAC,EAAjB30I,KAAKqiC,aACG,QAAXsyG,EAAA30I,KAAK2c,cAAM,IAAAg4H,GAAXA,EAAaf,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACvDw0I,UAAW,CACTC,SAAS,KAIjB,CAMA7C,UAAAA,CAAWvnH,GAET,OADArqB,KAAK2c,OAAOivB,SAAS5rC,MACbqqB,GACN,KAAK,EACL,KAAK,EACHnrB,EAAA2yI,GAAA7xI,KAAK40I,IAASvjI,KAAdrR,MAA6B,GAC7B,MACF,KAAK,EACL,KAAK,EACHd,EAAA2yI,GAAA7xI,KAAK40I,IAASvjI,KAAdrR,MAA6B,GAGnC,CAeA4tC,MAAAA,GAAS,IAAAinG,EACPlnI,MAAMigC,SACDhkB,EAAKgpH,GAAL5yI,QAGM,QAAX60I,EAAA70I,KAAK2c,cAAM,IAAAk4H,GAAXA,EAAajB,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACvDw0I,UAAW,CACTC,SAAS,EACT/5H,UAAU,KAGhB,CAGAkxB,QAAAA,GAAW,IAAAkpG,EACTnnI,MAAMi+B,WACDhiB,EAAKgpH,GAAL5yI,QAGM,QAAX80I,EAAA90I,KAAK2c,cAAM,IAAAm4H,GAAXA,EAAalB,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACvDw0I,UAAW,CACT95H,UAAU,KAGTkP,EAAK6oH,GAALzyI,OACHd,EAAA2yI,GAAA7xI,KAAK40I,IAASvjI,KAAdrR,MAA6B,GAEjC,CAGA,oBAAI8jD,GACF,OAAQl6B,EAAK6oH,GAALzyI,KACV,CAGA2qB,IAAAA,GAAgC,IAA3BwhB,EAAOhtC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAKioD,WAClBt6C,MAAMgd,KAAKwhB,GACPnsC,KAAK2c,SACP3c,KAAK2c,OAAOi3H,UAAUC,iBAAiBjqH,EAAK4oH,GAALxyI,MAAU,CAC/Cw0I,UAAW,CACTp3H,QAAS+uB,KAGbnsC,KAAK2c,OAAOi3H,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACtDw0I,UAAW,CACTp3H,QAAS+uB,KAIjB,CAoCA,wBAAO4oG,CAAkBp4H,EAAQwR,EAAK6mH,GAA+B,IAA3B96H,OAAQmrB,EAAS,EAAEvvB,EAAC,EAAEC,GAAGi/H,EACjE,MACEl/H,EAAGouB,EACHnuB,EAAGouB,EACHnkB,MAAO0wB,EACPzwB,OAAQ0wB,GACNtL,EAAUjB,wBAER3E,EAAK,IAAIxC,gBACTtT,EAAShN,EAAO6iB,eAAeC,GAE/BovB,EAAoB3wD,IACxBuhC,EAAGN,QACHjgC,EAhwBAyyI,GAgwBA3xI,KAAKi1I,IAAa5jI,KAAlBrR,KAAmB2c,EAAQze,IAE7B4nB,OAAO/L,iBAAiB,OAAQ80C,EAAmB,CAAEllC,WACrD7D,OAAO/L,iBAAiB,YAAa80C,EAAmB,CAAEllC,WAC1D7D,OAAO/L,iBACL,cACAuI,GACA,CACEkL,SAAS,EACTotB,SAAS,EACTjxB,WAGJ7D,OAAO/L,iBAAiB,cAAeqI,GAAe,CAAEuH,WAExD0b,EAAUtrB,iBACR,cACA7a,EAjxBAyyI,GAixBA3xI,KAAKk1I,IAAe3nH,KAAKvtB,KAAM2c,GAC/B,CAAEgN,WAEJ3pB,KAAKm1I,eAAiB,IAAI1D,GACxB,CAAE37H,IAAGC,KACL,CAACmuB,EAAQC,EAAQuM,EAAaC,GAC9Bh0B,EAAOwC,MACPnf,KAAKgzI,kBAAoB,EACzB7kH,EACoB,QAEnB1U,GAAIzZ,KAAKo1I,iBAAkBC,WAAYr1I,KAAKs1I,sBAC7C34H,EAAOi3H,UAAU2B,KACf,CACEv6E,KAAM,CAAC,EAAG,EAAG,EAAG,GAChBp/C,KAAM,CACJqD,QAAS,UACTjZ,KAAMhG,KAAK0kH,cACX,eAAgB1kH,KAAKizI,iBAEvBuB,UAAW,CACTlrH,WAAW,EACXksH,MAAM,GAERrtH,KAAM,CACJhW,EAAGnS,KAAKm1I,eAAe3K,eAGH,GACR,GAEtB,CA8BA,wBAAapiG,CAAYlgB,EAAMvL,EAAQsR,GACrC,IAAI4uE,EAAc,KAClB,GAAI30E,aAAgBsjG,GAA4B,CAC9C,MACEtjG,MAAM,WACJ2lG,EAAU,KACVl6G,EAAI,SACJyL,EAAQ,GACR3F,EAAE,MACFkK,EAAK,QACL8e,EAAO,SACP8I,EAAQ,SACRuN,EAAQ,YACRtN,EAAW,aACXqU,EAAY,iBACZC,GAEFnjC,QACEmmD,MAAM,WAAE//B,KAER7a,EACJ20E,EAAc30E,EAAO,CACnBmiC,eAAgBnpD,EAAqBG,UACrCsiB,MAAOpS,MAAMC,KAAKmS,GAClB8e,UACAorF,aACA3/F,MAAO,KACPuT,UAAWsB,EAAa,EACxBpvB,KAAMA,EAAK0B,MAAM,GACjB+J,WACA+rB,oBAAqB1xB,EACrBA,KACA4xB,SAAS,EACTE,WACAuN,WACAptB,SAAoB,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAar8B,MAAO,KAC7B0wC,eACAC,mBAEJ,MAAO,GAAI53B,aAAgBojG,GAAsB,CAC/C,MACEpjG,MAAM,SACJ4lG,EAAQ,KACRn6G,EAAI,SACJyL,EAAQ,GACR3F,EAAE,MACFkK,EACAorG,aAAewW,SAAU3C,GAAW,SACpCr3F,EAAQ,SACRuN,EAAQ,YACRtN,EAAW,aACXqU,EAAY,iBACZC,GAEFnjC,QACEmmD,MAAM,WAAE//B,KAER7a,EACJ20E,EAAc30E,EAAO,CACnBmiC,eAAgBnpD,EAAqBG,UACrCsiB,MAAOpS,MAAMC,KAAKmS,GAClBi/G,YACA9U,WACA5/F,MAAO,KACPuT,UAAWsB,EAAa,EACxBpvB,KAAMA,EAAK0B,MAAM,GACjB+J,WACA+rB,oBAAqB1xB,EACrBA,KACA4xB,SAAS,EACTE,WACAuN,WACAptB,SAAoB,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAar8B,MAAO,KAC7B0wC,eACAC,mBAEJ,CAEA,MAAM,MAAEn8B,EAAK,WAAEkqG,EAAU,SAAEC,EAAQ,QAAErrF,GAAYva,EAC3CM,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,GAErDzF,EAAO7E,MAAQ/R,GAAKC,gBAAgB8R,GACpC6E,EAAOia,QAAUA,GAAW,EACxBqrF,GACF5kG,EAAO4pH,GAAPtqH,EAAoBN,EAAK06G,WAE3Bp6G,EAAO2hC,aAAe0yC,EAClB30E,EAAKwD,SACPlD,EAAOo+B,eAAe1+B,GAGxB,MAAO9H,EAAWC,GAAcmI,EAAOy3B,gBAChC3/B,EAAOC,GAASiI,EAAO03B,gBAE9B,GAAI2tE,EAAY,CACd,MAAM3/F,EAAShF,EAAO8oH,GAAPxpH,EAAgB,IAC/B,IAAK,IAAI9Z,EAAI,EAAGA,EAAIm/G,EAAWxvH,OAAQqQ,GAAK,EAC1Cwf,EAAMlf,KAAK,CACT8G,GAAI+3G,EAAWn/G,GAAK4R,GAASF,EAC7BrK,EAAG,GAAK83G,EAAWn/G,EAAI,GAAK6R,GAASF,EACrCL,OAAQ6tG,EAAWn/G,EAAI,GAAKm/G,EAAWn/G,IAAM0R,EAC7CH,QAAS4tG,EAAWn/G,EAAI,GAAKm/G,EAAWn/G,EAAI,IAAM2R,IAGtDnhB,EAAA2yI,GAAArpH,EAAO6qH,IAAehiI,KAAtBmX,GACAtpB,EAAA2yI,GAAArpH,EAAO4qH,IAAe/hI,KAAtBmX,GACAA,EAAOuhC,OAAOvhC,EAAOpJ,SACvB,MAAO,GAAI0uG,EAAU,CACnB5kG,EAAOupH,GAAPjqH,GAA0B,GAC1B,MAAM65G,EAASvU,EAAS,GAClBl+D,EAAQ,CACZ95C,EAAGusH,EAAO,GAAK/hH,EACfvK,EAAGsK,GAAcgiH,EAAO,GAAK9hH,IAEzBwuH,EAAW,IAAI0C,GACnB7hF,EACA,CAAC,EAAG,EAAGxvC,EAAWC,GAClB,EACAuJ,EAAOkpH,GAAPtqH,GAAoB,GACpB,EACA,MAEF,IAAK,IAAI9Z,EAAI,EAAGuS,EAAKohH,EAAOhkI,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC/CkhD,EAAM95C,EAAIusH,EAAO3zH,GAAK4R,EACtBsvC,EAAM75C,EAAIsK,GAAcgiH,EAAO3zH,EAAI,GAAK6R,GACxCwuH,EAAS/vI,IAAI4wD,GAEf,MAAM,GAAEn2C,EAAE,WAAE47H,GAAe14H,EAAOi3H,UAAU2B,KAC1C,CACEv6E,KAAM,CAAC,EAAG,EAAG,EAAG,GAChBp/C,KAAM,CACJqD,QAAS,UACTjZ,KAAMwiB,EAAO7E,MACb,eAAgB6E,EAAOyqH,iBAEzBuB,UAAW,CACTlrH,WAAW,EACXksH,MAAM,GAERrtH,KAAM,CACJhW,EAAG48H,EAASvE,eAGQ,GACR,GAElBtrI,EAAA2yI,GAAArpH,EAAO2qH,IAAmB9hI,KAA1BmX,EAA2B,CACzBitH,kBAAmB1G,EAAS7B,cAC5BgG,YAAaz5H,EACb47H,eAEFn2I,EAAA2yI,GAAArpH,EAAO4qH,IAAe/hI,KAAtBmX,GACAA,EAAOuhC,OAAOvhC,EAAOq5B,eACvB,CAEA,OAAOr5B,CACT,CAGAof,SAAAA,GAAgC,IAAtBwN,EAAYj2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAEpB,GAAIa,KAAKm9B,WAAaiY,EACpB,OAAO,KAGT,GAAIp1C,KAAKqrC,QACP,OAAOrrC,KAAKiqD,mBAGd,MAAMtmC,EAAQ85B,GAAiB+C,cAAcppB,QAC3Cp3B,KAAK6pB,WAAW6W,eAAe1gC,KAAK2jB,QAEhCgkB,EAAah6B,MAAMi6B,UAAUwN,GAUnC,OATA92C,OAAO8c,OAAOusB,EAAY,CACxBhkB,QACA8e,QAASziC,KAAKyiC,QACdmgG,UAAWh5G,EAAKkpH,GAAL9yI,MACX6tH,WAAY3uH,EAAA2yI,GAAA7xI,KAAK01I,IAAerkI,KAApBrR,MACZ2wI,SAAUzxI,EAAA2yI,GAAA7xI,KAAK21I,IAAkBtkI,KAAvBrR,KAAwB2nC,EAAWh0B,QAE/C3T,KAAKyrB,WAAWkc,GAEZ3nC,KAAKmrC,sBAAwBjsC,EAAA2yI,GAAA7xI,KAAK41I,IAAkBvkI,KAAvBrR,KAAwB2nC,GAChD,MAGTA,EAAWluB,GAAKzZ,KAAKmrC,oBACdxD,EACT,CAUAwJ,uBAAAA,CAAwB7F,GACtB,OAAItrC,KAAKqrC,SACPC,EAAW9gB,OACJ,OAET8gB,EAAWuiB,aAAa,CACtBl6C,KAAM3T,KAAKopD,aACXzB,MAAO3nD,KAAK0rB,UAGP,KACT,CAEA,8BAAOmgB,GACL,OAAO,CACT,EAniCmB,SAAAwnG,KA0HjB,MAAMtE,EAAW,IAAIO,GACnB1lH,EAAKooH,GAALhyI,MACoB,MAEtBkpB,EAAKqpH,GAALvyI,KAA0B+uI,EAAS7B,gBAClCltI,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,QAAU2J,EAAK2oH,GAALvyI,MAAwB4uB,IAEpE,MAAMinH,EAAqB,IAAIvG,GAC7B1lH,EAAKooH,GAALhyI,MACoB,MACA,KACU,QAA9BA,KAAK6pB,WAAWQ,WAElBnB,EAAKipH,GAALnyI,KAAsB61I,EAAmB3I,eAEzC,MAAM,WAAEuB,GAAe7kH,EAAK2oH,GAALvyI,MACvBkpB,EAAKwpH,GAAL1yI,KAAmB,EAChByuI,EAAW,GAAKzuI,KAAK8V,GAAK9V,KAAKggB,OAC/ByuH,EAAW,GAAKzuI,KAAK+V,GAAK/V,KAAKigB,SAGlC,MAAM,UAAEyuH,GAAc9kH,EAAKuoH,GAALnyI,MACtBkpB,EAAKypH,GAAL3yI,KAAkB,EACf0uI,EAAU,GAAK1uI,KAAK8V,GAAK9V,KAAKggB,OAC9B0uH,EAAU,GAAK1uI,KAAK+V,GAAK/V,KAAKigB,QAEnC,UAAAkzH,GAAA2C,GAEoE,IAAhD,kBAAEL,EAAiB,YAAEvC,EAAW,WAAEmC,GAAYS,EAChE5sH,EAAKqpH,GAALvyI,KAA0By1I,GAS1B,GAPAvsH,EAAKipH,GAALnyI,KAAsBy1I,EAAkB3G,cAGtCllH,EAAKkpH,GAAL9yI,MAAkB,EAJG,IAKD,QAGlBkzI,GAAe,EACjBhqH,EAAKspH,GAALxyI,KAAWkzI,GACXhqH,EAAK+oH,GAALjyI,KAAmBq1I,GAGnBr1I,KAAK2c,OAAOi3H,UAAUmC,aAAa7C,EAAa,CAC9Cl4E,KAAMy6E,EAAkB7mH,IACxBzG,KAAM,CACJhW,EAAGsjI,EAAkBjL,eAGzBthH,EAAK0pH,GAAL5yI,KAAkBA,KAAK2c,OAAOi3H,UAAUoC,YACtC,CACExB,UAAW,CACTyB,kBAAkB,EAClBT,MAAM,GAERx6E,KAAMpxC,EAAKuoH,GAALnyI,MAAoB4uB,IAC1BzG,KAAM,CACJhW,EAAGyX,EAAKuoH,GAALnyI,MAAoBwqI,eAGS,SAEjC,GAAIxqI,KAAK2c,OAAQ,CACtB,MAAMwxC,EAAQnuD,KAAK2c,OAAON,SAAS+C,SACnCpf,KAAK2c,OAAOi3H,UAAUC,iBAAiBjqH,EAAK4oH,GAALxyI,MAAU,CAC/Cg7D,KAAMm5E,GAA2B9iI,KAA3BsgI,EACJ/nH,EAAK2oH,GAALvyI,MAAwB4uB,KACvBu/B,EAAQnuD,KAAKof,SAAW,KAAO,KAElC+I,KAAM,CACJhW,EAAGsjI,EAAkBjL,eAGzBxqI,KAAK2c,OAAOi3H,UAAUC,iBAAiBjqH,EAAKgpH,GAAL5yI,MAAiB,CACtDg7D,KAAMm5E,GAA2B9iI,KAA3BsgI,EAA4B/nH,EAAKuoH,GAALnyI,MAAoB4uB,IAAKu/B,GAC3DhmC,KAAM,CACJhW,EAAGyX,EAAKuoH,GAALnyI,MAAoBwqI,cAG7B,CACA,MAAO10H,EAAGC,EAAGiK,EAAOC,GAAUw1H,EAAkB7mH,IAChD,OAAQ5uB,KAAKof,UACX,KAAK,EACHpf,KAAK8V,EAAIA,EACT9V,KAAK+V,EAAIA,EACT/V,KAAKggB,MAAQA,EACbhgB,KAAKigB,OAASA,EACd,MACF,KAAK,GAAI,CACP,MAAOG,EAAWC,GAAcrgB,KAAK24C,iBACrC34C,KAAK8V,EAAIC,EACT/V,KAAK+V,EAAI,EAAID,EACb9V,KAAKggB,MAASA,EAAQK,EAAcD,EACpCpgB,KAAKigB,OAAUA,EAASG,EAAaC,EACrC,KACF,CACA,KAAK,IACHrgB,KAAK8V,EAAI,EAAIA,EACb9V,KAAK+V,EAAI,EAAIA,EACb/V,KAAKggB,MAAQA,EACbhgB,KAAKigB,OAASA,EACd,MACF,KAAK,IAAK,CACR,MAAOG,EAAWC,GAAcrgB,KAAK24C,iBACrC34C,KAAK8V,EAAI,EAAIC,EACb/V,KAAK+V,EAAID,EACT9V,KAAKggB,MAASA,EAAQK,EAAcD,EACpCpgB,KAAKigB,OAAUA,EAASG,EAAaC,EACrC,KACF,EAGF,MAAM,WAAEouH,GAAegH,EACvBvsH,EAAKwpH,GAAL1yI,KAAmB,EAChByuI,EAAW,GAAK34H,GAAKkK,GACrByuH,EAAW,GAAK14H,GAAKkK,IAExB,MAAM,UAAEyuH,GAAc9kH,EAAKuoH,GAALnyI,MACtBkpB,EAAKypH,GAAL3yI,KAAkB,EAAE0uI,EAAU,GAAK54H,GAAKkK,GAAQ0uH,EAAU,GAAK34H,GAAKkK,GACtE,UAAAuzH,GA0Fa7vH,GACX,MAAMuyH,EAAqBA,CAAClM,EAAKmM,KAC/Bn2I,KAAK2jB,MAAQqmH,EACbhqI,KAAKyiC,QAAU0zG,EACfn2I,KAAK03C,kBAEDuyF,EAAajqI,KAAK2jB,MAClByyH,EAAep2I,KAAKyiC,QAC1BziC,KAAKuoC,YAAY,CACfrT,IAAKghH,EAAmB3oH,KACtBvtB,KACA2jB,EACAguH,EAAgBsB,iBAElB99G,KAAM+gH,EAAmB3oH,KAAKvtB,KAAMiqI,EAAYmM,GAChDhhH,KAAMp1B,KAAK6pB,WAAW2jB,SAASjgB,KAAKvtB,KAAK6pB,WAAY7pB,MACrDq1B,UAAU,EACV70B,KAAMmB,EAA2BS,gBACjCkzB,qBAAqB,EACrBC,UAAU,IAGZv1B,KAAKw0C,iBACH,CACEvI,OAAQ,gBACRtoB,MAAO3jB,KAAK6pB,WAAW+W,mBAAmBjd,KAE3B,EAErB,UAAA8vH,GAMiB7Q,GACf,MAAMyT,EAAiBzsH,EAAKkpH,GAAL9yI,MACjBs2I,EAAeC,IACnBrtH,EAAK4pH,GAAL9yI,KAAkBu2I,GAClBr3I,EAAA2yI,GAAA7xI,KAAKw2I,IAAgBnlI,KAArBrR,KAAsBu2I,IAExBv2I,KAAKuoC,YAAY,CACfrT,IAAKohH,EAAa/oH,KAAKvtB,KAAM4iI,GAC7BztG,KAAMmhH,EAAa/oH,KAAKvtB,KAAMq2I,GAC9BjhH,KAAMp1B,KAAK6pB,WAAW2jB,SAASjgB,KAAKvtB,KAAK6pB,WAAY7pB,MACrDq1B,UAAU,EACV70B,KAAMmB,EAA2BO,cACjCozB,qBAAqB,EACrBC,UAAU,IAEZv1B,KAAKw0C,iBACH,CAAEvI,OAAQ,oBAAqB22F,cACd,EAErB,UAAA4T,GAmGiB5T,GACVh5G,EAAK6oH,GAALzyI,QAGLd,EAAA2yI,GAAA7xI,KAAKmzI,IAAmB9hI,KAAxBrR,KAAyB,CACvBy1I,kBAAmB7rH,EAAK2oH,GAALvyI,MAAwB8uI,cAAclM,EAAY,KAEvE5iI,KAAK8hD,oBACL9hD,KAAKmkD,UACP,UAAA6vF,KAGmB,OAAbpqH,EAAK4oH,GAALxyI,OAAsBA,KAAK2c,SAG/B3c,KAAK2c,OAAOi3H,UAAU9oH,OAAOlB,EAAK4oH,GAALxyI,OAC7BkpB,EAAKspH,GAALxyI,KAAW,MACXA,KAAK2c,OAAOi3H,UAAU9oH,OAAOlB,EAAKgpH,GAAL5yI,OAC7BkpB,EAAK0pH,GAAL5yI,KAAkB,MACpB,UAAAozI,KAEsC,IAAtBz2H,EAAMxd,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAK2c,OACX,OAAbiN,EAAK4oH,GAALxyI,UAGDyZ,GAAEzb,EAAAkrB,EAAA,CAAOspH,GAALxyI,OAAI4iB,EAAMyyH,WAAUr3I,EAAAkrB,EAAA,CAAO+oH,GAALjyI,OAAI4iB,GAAiBjG,EAAOi3H,UAAU2B,KACjE,CACEv6E,KAAMpxC,EAAK2oH,GAALvyI,MAAwB4uB,IAC9BhT,KAAM,CACJqD,QAAS,UACTjZ,KAAMhG,KAAK2jB,MACX,eAAgB3jB,KAAKyiC,SAEvB+xG,UAAW,CACTlrH,WAAW,EACXksH,KAAM5rH,EAAK6oH,GAALzyI,OAERmoB,KAAM,CACJhW,EAAGyX,EAAK2oH,GAALvyI,MAAwBwqI,eAGP,GACR,IAElBthH,EAAK0pH,GAAL5yI,KAAkB2c,EAAOi3H,UAAUoC,YACjC,CACExB,UAAW,CACTyB,kBAAkB,EAClBT,KAAM5rH,EAAK6oH,GAALzyI,OAERg7D,KAAMpxC,EAAKuoH,GAALnyI,MAAoB4uB,IAC1BzG,KAAM,CACJhW,EAAGyX,EAAKuoH,GAALnyI,MAAoBwqI,cAGS5gH,EAAK6oH,GAALzyI,QAGlC4pB,EAAK0oH,GAALtyI,QACF4pB,EAAK0oH,GAALtyI,MAAmBqb,MAAM41G,SAAWrnG,EAAKqoH,GAALjyI,OAExC,UAAAm0I,GAAAsC,EAE0CtoF,GAAO,IAA7Br4C,EAAGC,EAAGiK,EAAOC,GAAOw2H,EACtC,OAAQtoF,GACN,KAAK,GACH,MAAO,CAAC,EAAIp4C,EAAIkK,EAAQnK,EAAGmK,EAAQD,GACrC,KAAK,IACH,MAAO,CAAC,EAAIlK,EAAIkK,EAAO,EAAIjK,EAAIkK,EAAQD,EAAOC,GAChD,KAAK,IACH,MAAO,CAAClK,EAAG,EAAID,EAAIkK,EAAOC,EAAQD,GAEtC,MAAO,CAAClK,EAAGC,EAAGiK,EAAOC,EACvB,UAAAm0H,GAkFSp6H,GACP23H,EAAgB/2G,iBAAiB7X,KAAK/iB,KAAMga,EAC9C,UAAA46H,GAgBU7yH,GACR,IAAK6H,EAAKkoH,GAAL9xI,MACH,OAEF,MAAM8kC,EAAYhf,OAAOif,eACrBhjB,EACF+iB,EAAU4xG,YAAY9sH,EAAKkoH,GAAL9xI,MAAkB4pB,EAAKmoH,GAAL/xI,OAExC8kC,EAAU4xG,YAAY9sH,EAAKwoH,GAALpyI,MAAiB4pB,EAAKyoH,GAALryI,MAE3C,UAAA8zI,KAyDE,OAAOlqH,EAAK6oH,GAALzyI,MAAwBA,KAAKof,SAAW,CACjD,UAAAs2H,KAGE,GAAI9rH,EAAK6oH,GAALzyI,MACF,OAAO,KAET,MAAOogB,EAAWC,GAAcrgB,KAAKigD,gBAC9B3/B,EAAOC,GAASvgB,KAAKkgD,gBACtBhyB,EAAQtE,EAAKooH,GAALhyI,MACR6tH,EAAa,IAAIzsD,aAA4B,EAAflzC,EAAM7vB,QAC1C,IAAIqQ,EAAI,EACR,IAAK,MAAM,EAAEoH,EAAC,EAAEC,EAAC,MAAEiK,EAAK,OAAEC,KAAYiO,EAAO,CAC3C,MAAMrJ,EAAK/O,EAAIsK,EAAYE,EACrBwE,GAAM,EAAI/O,GAAKsK,EAAaE,EAIlCstG,EAAWn/G,GAAKm/G,EAAWn/G,EAAI,GAAKmW,EACpCgpG,EAAWn/G,EAAI,GAAKm/G,EAAWn/G,EAAI,GAAKoW,EACxC+oG,EAAWn/G,EAAI,GAAKm/G,EAAWn/G,EAAI,GAAKmW,EAAK7E,EAAQI,EACrDytG,EAAWn/G,EAAI,GAAKm/G,EAAWn/G,EAAI,GAAKoW,EAAK7E,EAASI,EACtD3R,GAAK,CACP,CACA,OAAOm/G,CACT,UAAA8nB,GAEmBhiI,GACjB,OAAOiW,EAAK2oH,GAALvyI,MAAwB4nC,UAAUj0B,EAAMzU,EAAA2yI,GAAA7xI,KAAK8zI,IAAYziI,KAAjBrR,MACjD,UAAAk1I,GAiEsBv4H,EAAQ3C,GACxBha,KAAKm1I,eAAen2I,IAAIgb,IAE1B2C,EAAOi3H,UAAUC,iBAAiB7zI,KAAKo1I,iBAAkB,CACvDjtH,KAAM,CACJhW,EAAGnS,KAAKm1I,eAAe3K,cAI/B,UAAAyK,GAEqBt4H,EAAQ3C,GACtBha,KAAKm1I,eAAeh4G,UAQvBxgB,EAAOi3H,UAAU9oH,OAAO9qB,KAAKo1I,kBAP7Bz4H,EAAOipB,sBAAsB5rB,GAAO,EAAO,CACzCk5H,YAAalzI,KAAKo1I,iBAClBK,kBAAmBz1I,KAAKm1I,eAAejI,cACvCmI,WAAYr1I,KAAKs1I,qBACjBzwG,iBAAkB,iBAKtB7kC,KAAKo1I,kBAAoB,EACzBp1I,KAAKm1I,eAAiB,KACtBn1I,KAAKs1I,qBAAuB,EAC9B,UAAAM,GAiMmBjuG,GACjB,MAAM,MAAEhkB,GAAU3jB,KAAKmqD,aACvB,OACEnqD,KAAK+mD,kBAAoBpf,EAAWhkB,MAAMivB,KAAK,CAAC1gC,EAAGxD,IAAMwD,IAAMyR,EAAMjV,GAEzE,CAmBFioI,EApiCMhF,IAihCJ9yH,EAAAA,EAAAA,GAjhCI8yH,GAAe,gBAqCI,OAAI9yH,EAAAA,EAAAA,GArCvB8yH,GAAe,kBAuCM,IAAC9yH,EAAAA,EAAAA,GAvCtB8yH,GAAe,oBAyCQ,KAAE9yH,EAAAA,EAAAA,GAzCzB8yH,GAAe,QA2CJ,cAAW9yH,EAAAA,EAAAA,GA3CtB8yH,GAAe,cA6CEzwI,EAAqBG,YAASwd,EAAAA,EAAAA,GA7C/C8yH,GAAe,oBA+CQ,IAAC9yH,EAAAA,EAAAA,GA/CxB8yH,GAAe,iBAiDK,OAAI9yH,EAAAA,EAAAA,GAjDxB8yH,GAAe,uBAmDW,I,mBCpEhC,MAAMiF,GAAeppI,WAAAA,GACnBvO,EAAA,KAAA43I,GAAiBv4I,OAAOwa,OAAO,MAAK,CAEpCg+H,cAAAA,CAAevpI,EAAMzN,GACnBE,KAAKuN,GAAQzN,EACbE,KAAK+2I,kBAAkBxpI,EAAMzN,EAC/B,CAEA+zI,gBAAAA,CAAiB1wD,GACf,GAAKA,EAGL,IAAK,MAAO51E,EAAMzN,KAAUxB,OAAO6c,QAAQgoE,GACpC51E,EAAK3B,WAAW,MACnB5L,KAAK82I,eAAevpI,EAAMzN,EAGhC,CAEAi3I,iBAAAA,CAAkBxpI,EAAMzN,GACtB8pB,EAAKitH,GAAL72I,MAAoBuN,GAAQzN,CAC9B,CAEAk3I,eAAAA,GACE,MAAMp7H,EAAOgO,EAAKitH,GAAL72I,MAEb,OADAkpB,EAAK2tH,GAAL72I,KAAsB1B,OAAOwa,OAAO,OAC7B,CAAE8C,OACX,CAEAgsD,KAAAA,GACE1+C,EAAK2tH,GAAL72I,KAAsB1B,OAAOwa,OAAO,MACtC,CAEAm+H,SAAAA,GAA0B,IAAhBvrI,EAAOvM,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAClBA,KAAK6zI,iBAAiBnoI,EACxB,CAEA8U,KAAAA,GACEtV,GAAY,kBACd,EACF,IAAAgsI,GAAA,IAAAvpH,QAAAwpH,GAAA,IAAAxpH,QAAAypH,GAAA,IAAArpH,QAKA,MAAMspH,WAAsB55F,GAqB1BjwC,WAAAA,CAAYygC,GACVtgC,MAAMsgC,GAAOnvC,EAAA,KAAAs4I,IArBfn4I,EAAA,KAAAi4I,GAAgB,MAEhBj4I,EAAA,KAAAk4I,QAAgB,IAAAt4H,EAAAA,EAAAA,GAAA,oBAED,OAAIA,EAAAA,EAAAA,GAAA,eAET,MAgBRqK,EAAKiuH,GAALn3I,KAAwBiuC,EAAOqpG,kBAAmB,GAElDt3I,KAAKu3I,aAAatpG,EACpB,CAGAyJ,cAAAA,GAAiB,IAAA8/F,EACE,QAAjBA,EAAAx3I,KAAK2oB,oBAAY,IAAA6uH,GAAjBA,EAAmBr6H,OAAOnd,KAAK2jB,OAC/BhW,MAAM+pC,gBACR,CAEA6/F,YAAAA,CAAatpG,GACPA,EAAOwpG,eACTv4I,EAAAk4I,GAAAp3I,KAAK03I,IAAmBrmI,KAAxBrR,KAAyBiuC,GACzB/uC,EAAAk4I,GAAAp3I,KAAK23I,IAAetmI,KAApBrR,MAEJ,CAqCA,0BAAO43I,CAAoB3kI,EAAI8lE,GAC7B,MAAM8+D,EAAS,IAAIroH,IAAIlxB,OAAOmT,KAAKwB,IAEnC,IAAK,MAAOiI,EAAKpb,KAAUxB,OAAO6c,QAAQ49D,GACpC8+D,EAAOj5I,IAAIsc,GACb5c,OAAO8c,OAAOnI,EAAGiI,GAAMpb,GAEvBmT,EAAGiI,GAAOpb,EAGd,OAAOmT,CACT,CAMA,+BAAO6kI,CAAyBC,GAC9B7sI,GAAY,kBACd,CAOA,mBAAW8sI,GACT9sI,GAAY,kBACd,CAEA,mBAAWo1C,GACT,OAAO,CACT,CAMA,kCAAW23F,GACT,OAAO,CACT,CAGA,0BAAO/rG,CAAoB1rC,EAAMV,GAC/B,MAAMo4I,EAAel4I,KAAKg4I,SAAS14I,IAAIkB,GACnC03I,GACFl4I,KAAKm4I,uBAAuBrB,eAAeoB,EAAcp4I,GAEvDE,KAAKo4I,iBACOC,GAAYz1H,EAACk0H,eAAeoB,EAAcp4I,GACxDE,KAAKo4I,eAAexE,UAAUC,iBAC5B7zI,KAAKs4I,eACLt4I,KAAKm4I,uBAAuBnB,mBAGlC,CAGAl5G,YAAAA,CAAat9B,EAAMV,GACjB,MAAMo4I,EAAel4I,KAAKwN,YAAYwqI,SAAS14I,IAAIkB,GAC/C03I,GACFl4I,KAAKu4I,gBAAgB/3I,EAAM03I,EAAcp4I,EAE7C,CAGA,oCAAWupC,GACT,MAAM85C,EAAa,GACbz3E,EAAU1L,KAAKm4I,uBACrB,IAAK,MAAO33I,EAAM+M,KAASvN,KAAKg4I,SAC9B70D,EAAWn0E,KAAK,CAACxO,EAAMkL,EAAQ6B,KAEjC,OAAO41E,CACT,CAGA,sBAAI51C,GACF,MAAM41C,EAAa,IACb,gBAAEq1D,GAAoBx4I,KAC5B,IAAK,MAAOQ,EAAM+M,KAASvN,KAAKwN,YAAYwqI,SAC1C70D,EAAWn0E,KAAK,CAACxO,EAAMg4I,EAAgBjrI,KAEzC,OAAO41E,CACT,CAMAo1D,eAAAA,CAAgB/3I,EAAM+M,EAAMzN,GAC1B,MAAM4L,EAAU1L,KAAKw4I,gBACfC,EAAa/sI,EAAQ6B,GACrBmrI,EAASllF,IAAO,IAAAmlF,EACpBjtI,EAAQorI,eAAevpI,EAAMimD,GAC7B,MAAMwH,EAAOpxC,EAAKstH,GAALl3I,MAAmB82I,eAAevpI,EAAMimD,GACjDwH,GACF97D,EAAAk4I,GAAAp3I,KAAK44I,IAAWvnI,KAAhBrR,KAAiBg7D,GAER,QAAX29E,EAAA34I,KAAK2c,cAAM,IAAAg8H,GAAXA,EAAa/E,UAAUC,iBACrB7zI,KAAK64I,QACLntI,EAAQsrI,mBAENx2I,IAASR,KAAK6nH,WAChB7nH,KAAK03C,kBAGT13C,KAAKuoC,YAAY,CACfrT,IAAKwjH,EAAOnrH,KAAKvtB,KAAMF,GACvBq1B,KAAMujH,EAAOnrH,KAAKvtB,KAAMy4I,GACxBrjH,KAAMp1B,KAAK6pB,WAAW2jB,SAASjgB,KAAKvtB,KAAK6pB,WAAY7pB,MACrDq1B,UAAU,EACV70B,OACA80B,qBAAqB,EACrBC,UAAU,GAEd,CAGAivB,WAAAA,GAAc,IAAAs0F,EACD,QAAXA,EAAA94I,KAAK2c,cAAM,IAAAm8H,GAAXA,EAAalF,UAAUC,iBACrB7zI,KAAK64I,QACLxB,GAAcO,oBACZhuH,EAAKstH,GAALl3I,MAAmB+4I,6BACjB75I,EAAAk4I,GAAAp3I,KAAKg5I,IAAmB3nI,KAAxBrR,OAEF,CACEg7D,KAAM97D,EAAAk4I,GAAAp3I,KAAKi5I,IAAU5nI,KAAfrR,QAId,CAGAqkD,UAAAA,GAAa,IAAA60F,EACA,QAAXA,EAAAl5I,KAAK2c,cAAM,IAAAu8H,GAAXA,EAAatF,UAAUC,iBACrB7zI,KAAK64I,QACLxB,GAAcO,oBACZhuH,EAAKstH,GAALl3I,MAAmBm5I,4BACjBj6I,EAAAk4I,GAAAp3I,KAAKg5I,IAAmB3nI,KAAxBrR,OAEF,CACEg7D,KAAM97D,EAAAk4I,GAAAp3I,KAAKi5I,IAAU5nI,KAAfrR,QAId,CAGA2jD,cAAAA,CAAey1F,EAAIC,GAAI,IAAAC,EACV,QAAXA,EAAAt5I,KAAK2c,cAAM,IAAA28H,GAAXA,EAAa1F,UAAUC,iBAAiB7zI,KAAK64I,QAAS,CACpD79E,KAAM97D,EAAAk4I,GAAAp3I,KAAKi5I,IAAU5nI,KAAfrR,OAEV,CAGAgjD,aAAAA,GAAgB,IAAAu2F,EACH,QAAXA,EAAAv5I,KAAK2c,cAAM,IAAA48H,GAAXA,EAAa3F,UAAUC,iBACrB7zI,KAAK64I,QACLxB,GAAcO,oBACZhuH,EAAKstH,GAALl3I,MAAmBw5I,+BACjBt6I,EAAAk4I,GAAAp3I,KAAKg5I,IAAmB3nI,KAAxBrR,MACAA,KAAK24C,kBAEP,CACEqiB,KAAM97D,EAAAk4I,GAAAp3I,KAAKi5I,IAAU5nI,KAAfrR,QAId,CAEA4oD,gBAAAA,GAAmB,IAAA6wF,EACN,QAAXA,EAAAz5I,KAAK2c,cAAM,IAAA88H,GAAXA,EAAa7F,UAAUC,iBAAiB7zI,KAAK64I,QAAS,CACpDrE,UAAW,CACTkF,QAAQ,IAGd,CAEA7wF,eAAAA,GAAkB,IAAA8wF,EACL,QAAXA,EAAA35I,KAAK2c,cAAM,IAAAg9H,GAAXA,EAAa/F,UAAUC,iBAAiB7zI,KAAK64I,QAAS,CACpDrE,UAAW,CACTkF,QAAQ,IAGd,CAGAlrG,MAAAA,GACE7gC,MAAM6gC,SAENxuC,KAAKwpD,kBACLxpD,KAAKitD,gBACP,CAGAA,cAAAA,GACEt/C,MAAMs/C,iBACNjtD,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAY,EACxC,CAGA6oB,aAAAA,GACEv/C,MAAMu/C,gBACNltD,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAY,EACxC,CAGAmf,kBAAAA,GAGE,MAAO,CAAC,EAAG,EACb,CAGA,eAAI6E,GACF,OAAO,CACT,CAGAiB,SAAAA,CAAUtlB,GACHhkC,KAAKmrC,qBACRnrC,KAAK2c,OAAOo3H,kBAAkB/zI,MAEhCA,KAAKu/C,cAAe,EAChB31B,EAAKutH,GAALn3I,QACFkpB,EAAKiuH,GAALn3I,MAAwB,GACxBA,KAAKwuC,SACLxuC,KAAK2c,OAAO+uB,YAAY1rC,MACpBgkC,GAAShkC,KAAK0pD,YAChB1pD,KAAKmc,IAAI6nB,QAGf,CAGAlZ,MAAAA,GACE5rB,EAAAk4I,GAAAp3I,KAAK45I,IAAevoI,KAApBrR,MACA2N,MAAMmd,QACR,CAGA+kB,OAAAA,GACO7vC,KAAK2c,SAGVhP,MAAMkiC,UACW,OAAb7vC,KAAKmc,MAITjd,EAAAk4I,GAAAp3I,KAAK23I,IAAetmI,KAApBrR,MACAd,EAAAk4I,GAAAp3I,KAAK44I,IAAWvnI,KAAhBrR,KAAiB4pB,EAAKstH,GAALl3I,MAAmB4uB,KAE/B5uB,KAAKmgD,iBAGRngD,KAAK2c,OAAO3d,IAAIgB,OAEpB,CAEAkiD,SAAAA,CAAUvlC,GACR,IAAIs3H,GAAiB,EACrB,GAAIj0I,KAAK2c,SAAWA,EAClB3c,KAAK6pB,WAAW0a,oBAAoBvkC,MACpCd,EAAAk4I,GAAAp3I,KAAK45I,IAAevoI,KAApBrR,WACK,GAAI2c,EAAQ,KAAAk9H,EACjB75I,KAAK6pB,WAAWya,iBAAiBtkC,MACjCd,EAAAk4I,GAAAp3I,KAAK23I,IAAetmI,KAApBrR,KAAqB2c,GAGrBs3H,GACGj0I,KAAK2c,SAAkB,QAAZk9H,EAAI75I,KAAKmc,WAAG,IAAA09H,OAAA,EAARA,EAAU7xH,UAAU+S,SAAS,kBACjD,CACAptB,MAAMu0C,UAAUvlC,GACZs3H,GAEFj0I,KAAK4tC,QAET,CAoLAmc,MAAAA,GACO/pD,KAAK2c,QAGV3c,KAAK2c,OAAOi3H,UAAUC,iBACpB7zI,KAAK64I,QACLxB,GAAcO,oBACZ,CACE58E,KAAM97D,EAAAk4I,GAAAp3I,KAAKi5I,IAAU5nI,KAAfrR,OAER4pB,EAAKstH,GAALl3I,MAAmB85I,gBAChB95I,KAAK6hD,eAAiB7hD,KAAKof,SAAW,KAAO,MAItD,CAEAse,eAAAA,GACO19B,KAAK2c,QAGVzd,EAAAk4I,GAAAp3I,KAAK44I,IAAWvnI,KAAhBrR,KACE4pB,EAAKstH,GAALl3I,MAAmB+5I,uBACjB/5I,KAAK24C,iBACL34C,KAAK2c,OAAOwC,OAGlB,CAEA,iCAAO66H,GAA8B,CAGrCv+H,MAAAA,GACE,GAAIzb,KAAKmc,IACP,OAAOnc,KAAKmc,IAGd,IAAI2mC,EAAOC,EACP/iD,KAAKwqD,UACP1H,EAAQ9iD,KAAK8V,EACbitC,EAAQ/iD,KAAK+V,GAGf,MAAMoG,EAAMxO,MAAM8N,SAClBU,EAAI6L,UAAUhpB,IAAI,QAElB,MAAMi7I,EAAUl+H,SAASC,cAAc,OAYvC,OAXAG,EAAIC,OAAO69H,GACXA,EAAQ7/H,aAAa,cAAe,QACpC6/H,EAAQvyH,UAAY,WACpB1nB,KAAKmkD,UACLnkD,KAAK6pB,WAAWya,iBAAiBtkC,MACjCA,KAAKitD,iBAEDjtD,KAAKwqD,SACPxqD,KAAK6iD,gBAAgBC,EAAOC,GAGvB5mC,CACT,CAUA,2BAAO+9H,CAAqBd,EAAIC,EAAIc,EAAcC,EAAe3P,GAC/Dv/H,GAAY,kBACd,CAEA,mBAAOmvI,CAAa19H,EAAQsR,EAAWqsH,EAAQtgI,GAAO,IAAAugI,EAQpD,MAAM,OAAErgI,EAAQmF,QAASvJ,EAAGwJ,QAASvJ,EAAC,UAAEuZ,EAAS,YAAEI,GAAgB1V,EACnE,GAAIoV,GAAgBiB,qCAAqCX,GACvD,OAGF,MACErT,UAAU,SAAE+C,IACVzC,GACIqD,MAAO0wB,EAAazwB,OAAQ0wB,GAClCz2B,EAAOkqB,wBAEH3E,EAAoB+6G,GAAiB53H,EAAG,IAAIqa,gBAC5CtT,EAAShN,EAAO6iB,eAAeC,GAErCrQ,GAAgBK,WAAWC,EAAaJ,GAExCxJ,OAAO/L,iBACL,YACA7b,IACMkxB,GAAgBc,wBAAwBhyB,EAAEoxB,YAC5CtvB,KAAKy6I,SAASv8I,IAGlB,CAAEyrB,WAEJ7D,OAAO/L,iBACL,gBACA7b,IACMkxB,GAAgBc,wBAAwBhyB,EAAEoxB,YAC5CtvB,KAAKo4I,eAAe/pG,qBAGxB,CAAE1kB,WAEJ7D,OAAO/L,iBACL,cACA7b,IACOkxB,GAAgBgB,kBAAkBlyB,EAAEwxB,eAOzCN,GAAgBC,0BAA0BnxB,EAAEoxB,WAI1B+oH,GAAYz1H,EAAC83H,kBACfrC,GAAYz1H,EAAC+3H,oBACTtC,GAAYz1H,EAACua,UAC7Bn9B,KAAKo4I,eAAe/pG,mBAAoC,GAExDruC,KAAKy6I,SAAS,SAIpB,CACEjtH,SAAS,EACTotB,SAAS,EACTjxB,WAGJ7D,OAAO/L,iBAAiB,cAAeqI,GAAe,CAAEuH,WACxDzP,EAAOH,iBAAiB,cAAe/Z,KAAK46I,UAAUrtH,KAAKvtB,MAAO,CAChE2pB,WAEFzP,EAAOH,iBACL,YACA7b,IACMkxB,GAAgBkB,gBAAgBpyB,EAAE6xB,YAEpCzN,GAAUpkB,IAGd,CAAEyrB,WAEJhN,EAAO41B,gBACiB,QAAxBgoG,EAAAtsH,EAAUsQ,sBAAc,IAAAg8G,GAAxBA,EAA0B/vH,OAER6tH,GAAYz1H,EAC5BjG,EAAOi3H,UAAUC,iBACf7zI,KAAKs4I,eACSD,GAAYz1H,EAACi4H,SACzB/kI,EACAC,EACA26B,EACAC,EACAvxB,KAMN6O,EAAUyf,6BAA6B1tC,MAEzBq4I,GAAYz1H,EAAG5iB,KAAKk6I,qBAChCpkI,EACAC,EACA26B,EACAC,EACAvxB,GAEY07H,GAAsBl4H,EAAG5iB,KAAK83I,2BAC5C93I,KAAKo4I,eAAiBz7H,IAEnBlD,GAAIzZ,KAAKs4I,gBAAmB37H,EAAOi3H,UAAU2B,KAC9Cv1I,KAAK43I,oBACWkD,GAAsBl4H,EAACo0H,kBACvBqB,GAAYz1H,EAACm4H,uBAEL,GACR,IAEpB,CAEA,gBAAOH,CAAU5gI,GAEf,GADAoV,GAAgBkB,gBAAgBtW,EAAM+V,YACnBsoH,GAAYz1H,EAC7B,OAEF,MAAM,QAAEvD,EAAO,QAAEC,EAAO,UAAEgQ,GAActV,EAEnCoV,GAAgBa,gBAAgBX,KAGjCF,GAAgBmB,0BAElBvwB,KAAKy6I,SAASzgI,IAGhBha,KAAKo4I,eAAexE,UAAUC,iBAC5B7zI,KAAKs4I,eACSD,GAAYz1H,EAAC5jB,IAAIqgB,EAASC,IAG1C8P,GAAgBU,aAAa9V,EAAM+V,WACnCzN,GAAUtI,IACZ,CAEA,eAAOghI,CAASjoG,GACVA,IACF/yC,KAAKs4I,gBAAkB,EACvBt4I,KAAKo4I,eAAiB,KACRC,GAAYz1H,EAAG,KACfk4H,GAAsBl4H,EAAG,KACvCwM,GAAgBsB,mBAChBtB,GAAgByB,kBAGA2pH,GAAiB53H,IACnB43H,GAAiB53H,EAACuc,QAClBq7G,GAAiB53H,EAAG,KAClCwM,GAAgBuB,kBAEpB,CAEA,eAAO8pH,CAASzgI,GACd,MAAM2C,EAAS3c,KAAKo4I,eACpB,GAAKz7H,EAAL,CAaA,GATAA,EAAO41B,eAAc,GACrBvyC,KAAKg7I,UAAS,IAEL,OAALhhI,QAAK,IAALA,OAAK,EAALA,EAAOE,UAAWyC,EAAOR,KAC3BQ,EAAOi3H,UAAUC,iBACf7zI,KAAKs4I,eACSD,GAAYz1H,EAACZ,IAAIhI,EAAMqF,QAASrF,EAAMsF,UAGpDtf,KAAKi4I,wBAAyB,CAChC,MAAM1C,EAAqB8C,GAAYz1H,EACjCq4H,EAASj7I,KAAKs4I,eACd4C,EAAc3F,EAAK4F,iBAezB,YAdAx+H,EAAO4rB,YAAY,CACjBrT,IAAKA,KACHvY,EAAOi3H,UAAUC,iBACfoH,EACA1F,EAAK6F,eAAeF,KAGxB/lH,KAAMA,KACJxY,EAAOi3H,UAAUC,iBAAiBoH,EAAQ1F,EAAKoF,sBAEjDtlH,UAAU,EACV70B,KAAMmB,EAA2Ba,WAIrC,CAEAxC,KAAK89E,YAA6B,EAhClC,CAiCF,CAEA,iBAAOA,CAAWu9D,GAChB,MAAM1+H,EAAS3c,KAAKo4I,eACpB,IAAKz7H,EACH,OAAO,KAKT,GAHAA,EAAO41B,eAAc,GACrB51B,EAAOuxB,eAAevsC,EAA2Ba,YAE9B61I,GAAYz1H,EAACua,UAAW,CACzC,MACE8iB,gBAAiB7/B,EAAWC,GAAW,MACvClB,GACExC,EAEE6L,EAAS7L,EAAOipB,sBACpB,CAAEvmB,QAAS,EAAGC,QAAS,IACvB,EACA,CACE27H,OAAQj7I,KAAKs4I,eACbb,aAA4BY,GAAYz1H,EAACsqH,YACvC9sH,EAAYjB,EACZkB,EAAalB,EACbA,EACAnf,KAAKs7I,eAEPC,eAA8BT,GAAsBl4H,EACpD00H,iBAAkB+D,IAItB,OADAr7I,KAAKg7I,UAAS,GACPxyH,CACT,CAIA,OAFA7L,EAAOi3H,UAAU9oH,OAAO9qB,KAAKs4I,gBAC7Bt4I,KAAKg7I,UAAS,GACP,IACT,CAMAQ,oBAAAA,CAAqBC,GAAQ,CAY7B,sBAAOC,CACLC,EACAC,EACAC,EACAC,EACAC,EACAN,GAEAvwI,GAAY,kBACd,CAGA,wBAAak9B,CAAYlgB,EAAMvL,EAAQsR,GACrC,MACE/N,SAAS,UAAEE,EAAS,WAAEC,EAAU,MAAEC,EAAK,MAAEC,IACvC5D,EAAON,SACLo7H,EAAez3I,KAAK07I,gBACxBp7H,EACAC,EACAH,EACAC,EACArgB,KAAKs7I,cACLpzH,GAEIM,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,GAOrD,OANAzF,EAAOgzH,qBAAqBtzH,GAC5BhpB,EAAAk4I,GAAA5uH,EAAOkvH,IAAmBrmI,KAA1BmX,EAA2B,CAAEivH,iBAC7Bv4I,EAAAk4I,GAAA5uH,EAAOmvH,IAAetmI,KAAtBmX,GACAA,EAAOkV,kBACPlV,EAAOuhC,SAEAvhC,CACT,CAEAwzH,aAAAA,CAAc5mG,GACZ,MAAO90B,EAAOC,GAASvgB,KAAKkgD,iBACrB9/B,EAAWC,GAAcrgB,KAAKigD,eACrC,OAAOr2B,EAAKstH,GAALl3I,MAAmB4nC,UACxB,CAACtnB,EAAOC,EAAOH,EAAWC,GAC1B+0B,EAEJ,CAGAjE,uBAAAA,CAAwB7F,GAKtB,OAJAA,EAAWuiB,aAAa,CACtBl6C,KAAM3T,KAAKopD,eAGN,IACT,CAEA,8BAAOvd,GACL,OAAO,CACT,EAv5BiB,SAAA6rG,GAAAuE,GAyC6C,IAA1C,aAAExE,EAAY,OAAEwD,EAAM,eAAEM,GAAgBU,EAC1D/yH,EAAKguH,GAALl3I,KAAqBy3I,GACrBz3I,KAAKw4I,kBAALx4I,KAAKw4I,gBAAoB+C,GACpBv7I,KAAKmrC,qBACRnrC,KAAK6pB,WAAWsc,UAAU,gBAADn7B,OAAiBhL,KAAKirB,WAAU,iBAGvDgwH,GAAU,GACZj7I,KAAK64I,QAAUoC,EAGfj7I,KAAK2c,OAAOi3H,UAAUmC,aACpBkF,EACAxD,EAAayE,oBAIfl8I,KAAK64I,QAAU35I,EAAAk4I,GAAAp3I,KAAKm8I,IAAc9qI,KAAnBrR,KAAoBy3I,EAAcz3I,KAAK2c,QAGxDzd,EAAAk4I,GAAAp3I,KAAK44I,IAAWvnI,KAAhBrR,KAAiBy3I,EAAa7oH,IAChC,UAAAutH,GAEe1E,EAAc96H,GAC3B,MAAM,GAAElD,GAAOkD,EAAOi3H,UAAU2B,KAC9B8B,EAAcO,oBACZ53I,KAAKw4I,gBAAgBxB,kBACrBS,EAAasD,uBAES,GACR,GAElB,OAAOthI,CACT,UAAAmgI,KA2RuB,OAAjB55I,KAAK64I,SAAqB74I,KAAK2c,SAGnC3c,KAAK2c,OAAOi3H,UAAU9oH,OAAO9qB,KAAK64I,SAClC74I,KAAK64I,QAAU,KAIf74I,KAAKw4I,gBAAgB5wE,QACvB,UAAA+vE,KAEsC,IAAtBh7H,EAAMxd,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGa,KAAK2c,OACP,OAAjB3c,KAAK64I,SAAoB74I,KAAK2c,SAAWA,IAGxB,OAAjB3c,KAAK64I,SAKT74I,KAAKw4I,gBAAgBvB,YACrBj3I,KAAK64I,QAAU35I,EAAAk4I,GAAAp3I,KAAKm8I,IAAc9qI,KAAnBrR,KAAoB4pB,EAAKstH,GAALl3I,MAAoB2c,IAJrD3c,KAAK2c,OAAOi3H,UAAUwI,aAAap8I,KAAK64I,QAASl8H,EAAOi3H,WAK5D,UAAAyI,GAAAC,GAE6C,IAAtBxmI,EAAGC,EAAGiK,EAAOC,GAAOq8H,EACzC,MACE3jG,kBAAmB4jG,EAAIC,GAAG,SAC1Bp9H,GACEpf,KACJ,OAAQof,GACN,KAAK,GACH,MAAO,CAACrJ,EAAG,EAAID,EAAGkK,GAASw8H,EAAKD,GAAKt8H,GAAUs8H,EAAKC,IACtD,KAAK,IACH,MAAO,CAAC,EAAI1mI,EAAG,EAAIC,EAAGiK,EAAOC,GAC/B,KAAK,IACH,MAAO,CAAC,EAAIlK,EAAGD,EAAGkK,GAASw8H,EAAKD,GAAKt8H,GAAUs8H,EAAKC,IACtD,QACE,MAAO,CAAC1mI,EAAGC,EAAGiK,EAAOC,GAE3B,UAAA+4H,KAGE,MAAM,EACJljI,EAAC,EACDC,EAAC,MACDiK,EAAK,OACLC,EACA04B,kBAAmB4jG,EAAIC,GAAG,SAC1Bp9H,GACEpf,KACJ,OAAQof,GACN,KAAK,GACH,MAAO,CAAC,EAAIrJ,EAAGD,EAAGkK,GAASu8H,EAAKC,GAAKv8H,GAAUu8H,EAAKD,IACtD,KAAK,IACH,MAAO,CAAC,EAAIzmI,EAAG,EAAIC,EAAGiK,EAAOC,GAC/B,KAAK,IACH,MAAO,CAAClK,EAAG,EAAID,EAAGkK,GAASu8H,EAAKC,GAAKv8H,GAAUu8H,EAAKD,IACtD,QACE,MAAO,CAACzmI,EAAGC,EAAGiK,EAAOC,GAE3B,UAAA24H,GAEY59E,IACTh7D,KAAK8V,EAAG9V,KAAK+V,EAAG/V,KAAKggB,MAAOhgB,KAAKigB,QAChC/gB,EAAAk4I,GAAAp3I,KAAKq8I,IAAqBhrI,KAA1BrR,KAA2Bg7D,GACzBh7D,KAAKmc,MACPnc,KAAK8hD,oBACL9hD,KAAKmkD,WAEPnkD,KAAKqkD,YACP,UAAA40F,KAeE,MAAM,EACJnjI,EAAC,EACDC,EAAC,MACDiK,EAAK,OACLC,EAAM,SACNb,EAAQ,eACRyiC,EACAlJ,kBAAmB4jG,EAAIC,IACrBx8I,KACJ,QAAoB,EAAXof,EAAeyiC,GAAkB,IACxC,KAAK,EAEH,MAAO,CAAC,EAAI9rC,EAAIkK,EAAQnK,EAAGmK,EAAQD,GACrC,KAAK,EAEH,MAAO,CAAC,EAAIlK,EAAIkK,EAAO,EAAIjK,EAAIkK,EAAQD,EAAOC,GAChD,KAAK,EAEH,MAAO,CAAClK,EAAG,EAAID,EAAIkK,EAAOC,EAAQD,GACpC,KAAK,EAEH,MAAO,CACLlK,EACAC,EAAIiK,GAASu8H,EAAKC,GAClBv8H,GAAUu8H,EAAKD,GACfv8H,GAASu8H,EAAKC,IAElB,KAAK,EAEH,MAAO,CAAC,EAAIzmI,EAAGD,EAAGkK,GAASu8H,EAAKC,GAAKv8H,GAAUu8H,EAAKD,IACtD,KAAK,EAEH,MAAO,CACL,EAAIzmI,EAAImK,GAAUu8H,EAAKD,GACvB,EAAIxmI,EACJkK,GAAUu8H,EAAKD,GACfv8H,GAASu8H,EAAKC,IAElB,KAAK,EAEH,MAAO,CACLzmI,EAAIiK,GAASu8H,EAAKC,GAClB,EAAI1mI,EAAImK,GAAUu8H,EAAKD,GACvBv8H,GAASu8H,EAAKC,GACdv8H,GAAUu8H,EAAKD,IAEnB,KAAK,EAEH,MAAO,CAACzmI,EAAIkK,EAAOjK,EAAIkK,EAAQD,EAAOC,GACxC,KAAK,EAEH,MAAO,CAAC,EAAIlK,EAAGD,EAAIkK,EAAOC,EAAQD,GACpC,KAAK,GAEH,MAAO,CAAC,EAAIlK,EAAG,EAAIC,EAAGiK,EAAOC,GAC/B,KAAK,GAEH,MAAO,CAAClK,EAAIkK,EAAQ,EAAInK,EAAGmK,EAAQD,GACrC,KAAK,GAEH,MAAO,CACLlK,EAAImK,GAAUu8H,EAAKD,GACnBxmI,EACAkK,GAAUu8H,EAAKD,GACfv8H,GAASu8H,EAAKC,IAElB,KAAK,GAEH,MAAO,CACL,EAAIzmI,EAAIiK,GAASu8H,EAAKC,GACtB1mI,EAAImK,GAAUu8H,EAAKD,GACnBv8H,GAASu8H,EAAKC,GACdv8H,GAAUu8H,EAAKD,IAEnB,KAAK,GAEH,MAAO,CACL,EAAIzmI,EACJ,EAAIC,EAAIiK,GAASu8H,EAAKC,GACtBv8H,GAAUu8H,EAAKD,GACfv8H,GAASu8H,EAAKC,IAElB,KAAK,GAEH,MAAO,CAACzmI,EAAG,EAAID,EAAGkK,GAASu8H,EAAKC,GAAKv8H,GAAUu8H,EAAKD,IACtD,QAEE,MAAO,CAACzmI,EAAGC,EAAGiK,EAAOC,GAE3B,CAqYFw8H,EAx5BMpF,IAmhBJx4H,EAAAA,EAAAA,GAnhBIw4H,GAAa,kBASQ,IAACx4H,EAAAA,EAAAA,GATtBw4H,GAAa,iBAWO,MAAI,IAAAgB,GAAA,CAAAz1H,EAEN,MAAI43H,GAAA,CAAA53H,EAEC,MAAIk4H,GAAA,CAAAl4H,EAEC,OAAI/D,EAAAA,EAAAA,GAjBhCw4H,GAAa,gBAmBM,G,wLClEzB,MAAMqF,GAwBJlvI,WAAAA,CAAYsI,EAAGC,EAAG26B,EAAaC,EAAcvxB,EAAUwjH,GAAW9jI,EAAA,KAAA69I,IAtBlE19I,EAAA,KAAA29I,GAAQ,IAAItrE,aAAa,IAEzBryE,EAAA,KAAA49I,QAAK,GAEL59I,EAAA,KAAA69I,QAAM,GAEN79I,EAAA,KAAA89I,QAAS,GAET99I,EAAA,KAAA+9I,QAAU,GAEV/9I,EAAA,KAAAg+I,QAAO,GAEPh+I,EAAA,KAAAi+I,GAAe,IAEfj+I,EAAA,KAAAk+I,GAAa,GAEbl+I,EAAA,KAAAm+I,GAAY,IAAIC,IAEhBp+I,EAAA,KAAAq+I,QAAY,GAEZr+I,EAAA,KAAAs+I,QAAa,GAGXr0H,EAAKo0H,GAALt9I,KAAoB0wC,GACpBxnB,EAAKq0H,GAALv9I,KAAqB2wC,GACrBznB,EAAK6zH,GAAL/8I,KAAiBof,GACjB8J,EAAK8zH,GAALh9I,KAAkB4iI,IAEjB9sH,EAAGC,GAAK7W,EAAAy9I,GAAA38I,KAAKguH,IAAe38G,KAApBrR,KAAqB8V,EAAGC,GAEjC,MAAM+R,EAAQoB,EAAK2zH,GAAL78I,KAAa,CAAC4wB,IAAKA,IAAKA,IAAKA,IAAK9a,EAAGC,IACnDmT,EAAK+zH,GAALj9I,KAAe,CAAC8V,EAAGC,IACnBmT,EAAK4zH,GAAL98I,KAAc,CAAC,CAAE8nB,OAAMu6G,OAAQz4G,EAAKqzH,GAALj9I,SAC/B4pB,EAAKgzH,GAAL58I,MAAWxB,IAAIspB,EAAM,EACvB,CAEAgvH,cAAAA,CAAevpI,EAAMzN,GACN,iBAATyN,GACF2b,EAAK8zH,GAALh9I,KAAkBF,EAEtB,CAYAq9B,OAAAA,GACE,OAAQvT,EAAKkzH,GAAL98I,OAAsC,IAAvB4pB,EAAKkzH,GAAL98I,MAAY3B,MACrC,CAEAq8I,aAAAA,GAGE,OAAO9wH,EAAKqzH,GAALj9I,MAAa3B,QAAU,EAChC,CAEAW,GAAAA,CAAI8W,EAAGC,IAGJD,EAAGC,GAAK7W,EAAAy9I,GAAA38I,KAAKguH,IAAe38G,KAApBrR,KAAqB8V,EAAGC,GACjC,MAAOI,EAAIC,EAAIE,EAAIC,GAAMqT,EAAKgzH,GAAL58I,MAAW+O,SAAS,EAAG,GAC1Cs9H,EAAQv2H,EAAIQ,EACZg2H,EAAQv2H,EAAIQ,EAElB,OADU3H,KAAKwuC,MAAMxzB,EAAK0zH,GAALt9I,MAAoBqsI,EAAOziH,EAAK2zH,GAALv9I,MAAqBssI,IAC5D,EAIA,MAGT1iH,EAAKqzH,GAALj9I,MAAagP,KAAK8G,EAAGC,GAEjBy5F,MAAMr5F,IAERyT,EAAKgzH,GAAL58I,MAAWxB,IAAI,CAAC8X,EAAIC,EAAIT,EAAGC,GAAI,GAC/B6T,EAAKizH,GAAL78I,MAAWgP,KAAK4hB,IAAKA,IAAKA,IAAKA,IAAK9a,EAAGC,GAChC,CACLoS,KAAM,CACJhW,EAAGnS,KAAKwqI,gBAKVh7B,MAAM5lF,EAAKgzH,GAAL58I,MAAW,KAEnB4pB,EAAKizH,GAAL78I,MAAWw1B,OAAO,EAAG,GAGvB5L,EAAKgzH,GAAL58I,MAAWxB,IAAI,CAAC2X,EAAIC,EAAIE,EAAIC,EAAIT,EAAGC,GAAI,GACvC6T,EAAKizH,GAAL78I,MAAWgP,QAAQu7H,GAAQO,mBAAmB30H,EAAIC,EAAIE,EAAIC,EAAIT,EAAGC,IAE1D,CACLoS,KAAM,CACJhW,EAAGnS,KAAKwqI,eAGd,CAEAxoH,GAAAA,CAAIlM,EAAGC,GACL,MAAMwkH,EAASv6H,KAAKhB,IAAI8W,EAAGC,GAC3B,OAAIwkH,IAGwB,IAAxB3wG,EAAKqzH,GAALj9I,MAAa3B,OAER,CACL8pB,KAAM,CACJhW,EAAGnS,KAAKwqI,cAIP,KACT,CAEAqQ,QAAAA,CAAS/kI,EAAGC,EAAG26B,EAAaC,EAAcvxB,GACxC8J,EAAKo0H,GAALt9I,KAAoB0wC,GACpBxnB,EAAKq0H,GAALv9I,KAAqB2wC,GACrBznB,EAAK6zH,GAAL/8I,KAAiBof,IAEhBtJ,EAAGC,GAAK7W,EAAAy9I,GAAA38I,KAAKguH,IAAe38G,KAApBrR,KAAqB8V,EAAGC,GAEjC,MAAM+R,EAAQoB,EAAK2zH,GAAL78I,KAAa,CAAC4wB,IAAKA,IAAKA,IAAKA,IAAK9a,EAAGC,IACnDmT,EAAK+zH,GAALj9I,KAAe,CAAC8V,EAAGC,IACnB,MAAMs3H,EAAOzjH,EAAKkzH,GAAL98I,MAAY4c,IAAI,GAU7B,OATIywH,IACFA,EAAKvlH,KAAO,IAAIs5C,aAAaisE,EAAKvlH,MAClCulH,EAAKhL,OAAS,IAAIjhE,aAAaisE,EAAKhL,SAEtCz4G,EAAKkzH,GAAL98I,MAAYgP,KAAK,CAAE8Y,OAAMu6G,OAAQz4G,EAAKqzH,GAALj9I,QACjC4pB,EAAKgzH,GAAL58I,MAAWxB,IAAIspB,EAAM,GACrBoB,EAAKi0H,GAALn9I,KAAkB,GAClBA,KAAKwqI,YAEE,IACT,CAEA2Q,cAAAA,GACE,OAAOvxH,EAAKkzH,GAAL98I,MAAY4c,IAAI,EACzB,CAEAw+H,cAAAA,CAAe1hI,GACb,OAAKkQ,EAAKkzH,GAAL98I,OAGL4pB,EAAKkzH,GAAL98I,MAAYgP,KAAK0K,GACjBwP,EAAK2zH,GAAL78I,KAAa0Z,EAAQoO,MACrBoB,EAAK+zH,GAALj9I,KAAe0Z,EAAQ2oH,QACvBn5G,EAAKi0H,GAALn9I,KAAkB,GACX,CACLmoB,KAAM,CACJhW,EAAGnS,KAAKwqI,eARH5gH,EAAKwzH,GAALp9I,MAAeo7I,eAAe1hI,EAWzC,CAEAihI,iBAAAA,GACE,IAAK/wH,EAAKkzH,GAAL98I,MACH,OAAO4pB,EAAKwzH,GAALp9I,MAAe26I,oBAExB/wH,EAAKkzH,GAAL98I,MAAY6c,MACZqM,EAAKg0H,GAALl9I,KAAoB,IACpB,IAAK,IAAI0O,EAAI,EAAGuS,EAAK2I,EAAKkzH,GAAL98I,MAAY3B,OAAQqQ,EAAIuS,EAAIvS,IAAK,CACpD,MAAM,KAAEoZ,EAAI,OAAEu6G,GAAWz4G,EAAKkzH,GAAL98I,MAAY0O,GACrCwa,EAAK2zH,GAAL78I,KAAa8nB,GACboB,EAAK+zH,GAALj9I,KAAeqiI,GACfn5G,EAAKi0H,GAALn9I,KAAkB,GAClBA,KAAKwqI,WACP,CAEA,MAAO,CACLriH,KAAM,CACJhW,EAAGyX,EAAKszH,GAALl9I,OAGT,CAEAwqI,SAAAA,GACE,MAAMgT,EAASjT,GAAQK,SAAShhH,EAAKizH,GAAL78I,MAAW,IACrCy9I,EAASlT,GAAQK,SAAShhH,EAAKizH,GAAL78I,MAAW,IAC3C,GAA4B,IAAxB4pB,EAAKqzH,GAALj9I,MAAa3B,OAEf,OADA6qB,EAAKg0H,GAALl9I,KAAI,GAAAgL,OAAmB4e,EAAKszH,GAALl9I,MAAiB,OAAAgL,OAAMwyI,EAAM,KAAAxyI,OAAIyyI,EAAM,OACvD7zH,EAAKszH,GAALl9I,MAGT,GAAI4pB,EAAKqzH,GAALj9I,MAAa3B,QAAU,EAAG,CAE5B,MAAMqQ,EAAIkb,EAAKszH,GAALl9I,MAAkB09I,YAAY,KACxCx0H,EAAKg0H,GAALl9I,KAAI,GAAAgL,OAAmB4e,EAAKszH,GAALl9I,MAAkBqV,MAAM,EAAG3G,GAAE,OAAA1D,OAAMwyI,EAAM,KAAAxyI,OAAIyyI,IACpEv0H,EAAKi0H,GAALn9I,KAAkB,EACpB,CAEA,GAA4B,IAAxB4pB,EAAKqzH,GAALj9I,MAAa3B,OAAc,CAC7B,MAAMs/I,EAAUpT,GAAQK,SAAShhH,EAAKizH,GAAL78I,MAAW,KACtC49I,EAAUrT,GAAQK,SAAShhH,EAAKizH,GAAL78I,MAAW,KAG5C,OAFAkpB,EAAKg0H,GAALl9I,KAAI,GAAAgL,OAAmB4e,EAAKszH,GAALl9I,MAAiB,OAAAgL,OAAM2yI,EAAO,KAAA3yI,OAAI4yI,IACzD10H,EAAKi0H,GAALn9I,KAAkB,IACX4pB,EAAKszH,GAALl9I,KACT,CAEA,MAAM0P,EAAS,GACS,IAApBka,EAAKuzH,GAALn9I,QACF0P,EAAOV,KAAK,KAADhE,OAAMwyI,EAAM,KAAAxyI,OAAIyyI,IAC3Bv0H,EAAKi0H,GAALn9I,KAAkB,IAGpB,IAAK,IAAI0O,EAAIkb,EAAKuzH,GAALn9I,MAAiBihB,EAAK2I,EAAKizH,GAAL78I,MAAW3B,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CACpE,MAAOmvI,EAAKC,EAAKC,EAAKC,EAAKloI,EAAGC,GAAK6T,EAAKizH,GAAL78I,MAChCqV,MAAM3G,EAAGA,EAAI,GACbmV,IAAI0mH,GAAQK,UACfl7H,EAAOV,KAAK,IAADhE,OAAK6yI,EAAG,KAAA7yI,OAAI8yI,EAAG,KAAA9yI,OAAI+yI,EAAG,KAAA/yI,OAAIgzI,EAAG,KAAAhzI,OAAI8K,EAAC,KAAA9K,OAAI+K,GACnD,CAIA,OAHAmT,EAAKg0H,GAALl9I,KAAA4pB,EAAKszH,GAALl9I,MAAqB0P,EAAOT,KAAK,MACjCia,EAAKi0H,GAALn9I,KAAkB4pB,EAAKizH,GAAL78I,MAAW3B,QAEtBurB,EAAKszH,GAALl9I,KACT,CAEAktI,WAAAA,CAAYx8F,EAAaC,EAAcxxB,EAAO+rH,GAC5C,MAAMmC,EAAOzjH,EAAKkzH,GAAL98I,MAAY4c,IAAI,GAoB7B,OAnBAywH,EAAKvlH,KAAO,IAAIs5C,aAAaisE,EAAKvlH,MAClCulH,EAAKhL,OAAS,IAAIjhE,aAAaisE,EAAKhL,QAEpCz4G,EAAKwzH,GAALp9I,MAAei+I,MACbr0H,EAAKkzH,GAAL98I,MACA0wC,EACAC,EACAxxB,EACAyK,EAAKmzH,GAAL/8I,MACA4pB,EAAKozH,GAALh9I,MACAkrI,GAIFhiH,EAAK0zH,GAAL58I,KAAa,MACbkpB,EAAK2zH,GAAL78I,KAAa,MACbkpB,EAAK4zH,GAAL98I,KAAc,MACdkpB,EAAKg0H,GAALl9I,KAAoB,MAEb4pB,EAAKwzH,GAALp9I,KACT,CAEA,wBAAI+6I,GACF,MAAO,CACLn/H,KAAM,CACJqD,QAAS,mBAEXu1H,UAAW,CACTe,MAAM,GAERv6E,KAAM,CAAC,EAAG,EAAG,EAAG,GAEpB,EACF,SAAAgzD,GAzNkBl4G,EAAGC,GACjB,OAAOw0H,GAAQvc,gBACbl4G,EACAC,EACA6T,EAAK0zH,GAALt9I,MACA4pB,EAAK2zH,GAALv9I,MACA4pB,EAAKmzH,GAAL/8I,MAEJ,KAAAk+I,GAAA,IAAAvwH,QAAAwwH,GAAA,IAAAxwH,QAAAywH,GAAA,IAAAzwH,QAAA0wH,GAAA,IAAA1wH,QAAA2wH,GAAA,IAAA3wH,QAAA4wH,GAAA,IAAA5wH,QAAA6wH,GAAA,IAAA7wH,QAAA8wH,GAAA,IAAA9wH,QAAA+wH,GAAA,IAAA/wH,QAAAgxH,GAAA,IAAA5wH,QAmNF,MAAMsvH,WAAuB9S,GAAQ/8H,WAAAA,GAAA,SAAArO,WAAAL,EAAA,KAAA6/I,IACnC1/I,EAAA,KAAAi/I,QAAK,GAELj/I,EAAA,KAAAk/I,GAAmB,GAEnBl/I,EAAA,KAAAm/I,QAAY,GAEZn/I,EAAA,KAAAo/I,QAAM,GAENp/I,EAAA,KAAAq/I,QAAY,GAEZr/I,EAAA,KAAAs/I,QAAa,GAEbt/I,EAAA,KAAAu/I,QAAY,GAEZv/I,EAAA,KAAAw/I,QAAS,GAETx/I,EAAA,KAAAy/I,QAAU,GAEVT,KAAAA,CACEp2H,EACA6oB,EACAC,EACAuT,EACA9kC,EACAwjH,EACAsI,GAEAhiH,EAAKo1H,GAALt+I,KAAoB0wC,GACpBxnB,EAAKq1H,GAALv+I,KAAqB2wC,GACrBznB,EAAKs1H,GAALx+I,KAAoBkkD,GACpBh7B,EAAKu1H,GAALz+I,KAAiBof,GACjB8J,EAAKw1H,GAAL1+I,KAAkB4iI,GAClB15G,EAAKk1H,GAALp+I,KAA+B,OAAXkrI,QAAW,IAAXA,EAAAA,EAAe,GACnChiH,EAAKm1H,GAALr+I,KAAc6nB,GAEd3oB,EAAAy/I,GAAA3+I,KAAK4+I,IAAYvtI,KAAjBrR,KACF,CAEA,aAAI4iI,GACF,OAAOh5G,EAAK80H,GAAL1+I,KACT,CAEAo7I,cAAAA,CAAe1hI,GAEb,OADAkQ,EAAKy0H,GAALr+I,MAAYgP,KAAK0K,GACV,CACLyO,KAAM,CACJhW,EAAGnS,KAAKwqI,aAGd,CAEAmQ,iBAAAA,GAEE,OADA/wH,EAAKy0H,GAALr+I,MAAY6c,MACL,CACLsL,KAAM,CACJhW,EAAGnS,KAAKwqI,aAGd,CAEAA,SAAAA,GACE,MAAM96H,EAAS,GACf,IAAK,MAAM,KAAEoY,KAAU8B,EAAKy0H,GAALr+I,MAErB,GADA0P,EAAOV,KAAK,IAADhE,OAAKu/H,GAAQK,SAAS9iH,EAAK,IAAG,KAAA9c,OAAIu/H,GAAQK,SAAS9iH,EAAK,MAC/C,IAAhBA,EAAKzpB,OAIT,GAAoB,KAAhBypB,EAAKzpB,QAAiBmxG,MAAM1nF,EAAK,IACnCpY,EAAOV,KAAK,IAADhE,OACLu/H,GAAQK,SAAS9iH,EAAK,KAAI,KAAA9c,OAAIu/H,GAAQK,SAAS9iH,EAAK,YAI5D,IAAK,IAAIpZ,EAAI,EAAGuS,EAAK6G,EAAKzpB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CAChD,MAAOmvI,EAAKC,EAAKC,EAAKC,EAAKloI,EAAGC,GAAK+R,EAChC/Y,SAASL,EAAGA,EAAI,GAChBmV,IAAI0mH,GAAQK,UACfl7H,EAAOV,KAAK,IAADhE,OAAK6yI,EAAG,KAAA7yI,OAAI8yI,EAAG,KAAA9yI,OAAI+yI,EAAG,KAAA/yI,OAAIgzI,EAAG,KAAAhzI,OAAI8K,EAAC,KAAA9K,OAAI+K,GACnD,MAdErG,EAAOV,KAAK,KAgBhB,OAAOU,EAAOT,KAAK,GACrB,CAEA24B,SAAAA,CAASi3G,EAAwCzpG,GAAc,IAApD90B,EAAOC,EAAOH,EAAWC,GAAWw+H,EAC7C,MAAMC,EAAkB,GAClBC,EAAmB,IAClBjpI,EAAGC,EAAGiK,EAAOC,GAAU/gB,EAAAy/I,GAAA3+I,KAAKg/I,IAAoB3tI,KAAzBrR,MAC9B,IAAI0vC,EAAIC,EAAI9qB,EAAIC,EAAI3O,EAAIC,EAAIE,EAAIC,EAAI0oI,EAEpC,OAAQr1H,EAAK60H,GAALz+I,OACN,KAAK,EACHi/I,EAAY1U,GAAQG,SACpBh7F,EAAKpvB,EACLqvB,EAAKpvB,EAAQF,EACbwE,EAAKzE,EACL0E,GAAMzE,EACNlK,EAAKmK,EAAQxK,EAAIsK,EACjBhK,EAAKmK,GAAS,EAAIxK,EAAIkK,GAAUI,EAChC/J,EAAKgK,GAASxK,EAAIkK,GAASI,EAC3B7J,EAAKgK,GAAS,EAAIxK,GAAKsK,EACvB,MACF,KAAK,GACH4+H,EAAY1U,GAAQI,gBACpBj7F,EAAKpvB,EACLqvB,EAAKpvB,EACLsE,EAAKzE,EACL0E,EAAKzE,EACLlK,EAAKmK,EAAQvK,EAAIqK,EACjBhK,EAAKmK,EAAQzK,EAAIuK,EACjB/J,EAAKgK,GAASvK,EAAIkK,GAAUG,EAC5B7J,EAAKgK,GAASzK,EAAIkK,GAASK,EAC3B,MACF,KAAK,IACH4+H,EAAY1U,GAAQG,SACpBh7F,EAAKpvB,EAAQF,EACbuvB,EAAKpvB,EACLsE,GAAMzE,EACN0E,EAAKzE,EACLlK,EAAKmK,GAAS,EAAIxK,EAAIkK,GAASI,EAC/BhK,EAAKmK,EAAQxK,EAAIsK,EACjB/J,EAAKgK,GAAS,EAAIxK,GAAKsK,EACvB7J,EAAKgK,GAASxK,EAAIkK,GAAUI,EAC5B,MACF,KAAK,IACH4+H,EAAY1U,GAAQI,gBACpBj7F,EAAKpvB,EAAQF,EACbuvB,EAAKpvB,EAAQF,EACbwE,GAAMzE,EACN0E,GAAMzE,EACNlK,EAAKmK,GAAS,EAAIvK,EAAIkK,GAAUG,EAChChK,EAAKmK,GAAS,EAAIzK,EAAIkK,GAASK,EAC/B/J,EAAKgK,GAAS,EAAIvK,GAAKqK,EACvB7J,EAAKgK,GAAS,EAAIzK,GAAKuK,EAI3B,IAAK,MAAM,KAAEyH,EAAI,OAAEu6G,KAAYz4G,EAAKy0H,GAALr+I,MAC7B8+I,EAAgB9vI,KACdiwI,EACEn3H,EACA4nB,EACAC,EACA9qB,EACAC,EACAswB,EAAe,IAAI7jC,MAAMuW,EAAKzpB,QAAU,OAG5C0gJ,EAAiB/vI,KACfiwI,EACE5c,EACA3yF,EACAC,EACA9qB,EACAC,EACAswB,EAAe,IAAI7jC,MAAM8wH,EAAOhkI,QAAU,OAKhD,MAAO,CACLwpB,MAAOi3H,EACPzc,OAAQ0c,EACRprI,KAAM,CAACwC,EAAIC,EAAIE,EAAIC,GAEvB,CAEA,kBAAO6xB,CACL9nB,EACAC,EACAH,EACAC,EACA6qH,EAAWgU,GAEX,IADE5vD,OAAO,MAAEznE,EAAK,OAAEw6G,GAAQ,SAAEjjH,EAAQ,UAAEwjH,GAAWsc,EAEjD,MAAMC,EAAW,GACjB,IAAIzvG,EAAIC,EAAI9qB,EAAIC,EAAIm6H,EACpB,OAAQ7/H,GACN,KAAK,EACH6/H,EAAY1U,GAAQG,SACpBh7F,GAAMpvB,EAAQF,EACduvB,EAAKpvB,EAAQF,EAAa,EAC1BwE,EAAK,EAAIzE,EACT0E,GAAM,EAAIzE,EACV,MACF,KAAK,GACH4+H,EAAY1U,GAAQI,gBACpBj7F,GAAMnvB,EAAQF,EACdsvB,GAAMrvB,EAAQF,EACdyE,EAAK,EAAIxE,EACTyE,EAAK,EAAI1E,EACT,MACF,KAAK,IACH6+H,EAAY1U,GAAQG,SACpBh7F,EAAKpvB,EAAQF,EAAY,EACzBuvB,GAAMpvB,EAAQF,EACdwE,GAAM,EAAIzE,EACV0E,EAAK,EAAIzE,EACT,MACF,KAAK,IACH4+H,EAAY1U,GAAQI,gBACpBj7F,EAAKnvB,EAAQF,EAAa,EAC1BsvB,EAAKrvB,EAAQF,EAAY,EACzByE,GAAM,EAAIxE,EACVyE,GAAM,EAAI1E,EAId,IAAKyH,EAAO,CACVA,EAAQ,GACR,IAAK,MAAM+nC,KAASyyE,EAAQ,CAC1B,MAAM+c,EAAMxvF,EAAMvxD,OAClB,GAAY,IAAR+gJ,EAAW,CACbv3H,EAAM7Y,KACJ,IAAIoyD,aAAa,CAACxwC,IAAKA,IAAKA,IAAKA,IAAKg/B,EAAM,GAAIA,EAAM,MAExD,QACF,CACA,GAAY,IAARwvF,EAAW,CACbv3H,EAAM7Y,KACJ,IAAIoyD,aAAa,CACfxwC,IACAA,IACAA,IACAA,IACAg/B,EAAM,GACNA,EAAM,GACNh/B,IACAA,IACAA,IACAA,IACAg/B,EAAM,GACNA,EAAM,MAGV,QACF,CACA,MAAM9nC,EAAO,IAAIs5C,aAAa,GAAKg+E,EAAM,IACzCv3H,EAAM7Y,KAAK8Y,GACX,IAAK3R,EAAIC,EAAIE,EAAIC,GAAMq5C,EAAM7gD,SAAS,EAAG,GACzC+Y,EAAKtpB,IAAI,CAACoyB,IAAKA,IAAKA,IAAKA,IAAKza,EAAIC,GAAK,GACvC,IAAK,IAAI1H,EAAI,EAAGA,EAAI0wI,EAAK1wI,GAAK,EAAG,CAC/B,MAAMoH,EAAI85C,EAAMlhD,GACVqH,EAAI65C,EAAMlhD,EAAI,GACpBoZ,EAAKtpB,IACH+rI,GAAQO,mBAAmB30H,EAAIC,EAAIE,EAAIC,EAAIT,EAAGC,GACpC,GAATrH,EAAI,KAENyH,EAAIC,EAAIE,EAAIC,GAAM,CAACD,EAAIC,EAAIT,EAAGC,EACjC,CACF,CACF,CAEA,IAAK,IAAIrH,EAAI,EAAGuS,EAAK4G,EAAMxpB,OAAQqQ,EAAIuS,EAAIvS,IACzCywI,EAASnwI,KAAK,CACZ8Y,KAAMm3H,EACJp3H,EAAMnZ,GAAGmV,IAAI/N,GAAM,OAADA,QAAC,IAADA,EAAAA,EAAK8a,KACvB8e,EACAC,EACA9qB,EACAC,GAEFu9G,OAAQ4c,EACN5c,EAAO3zH,GAAGmV,IAAI/N,GAAM,OAADA,QAAC,IAADA,EAAAA,EAAK8a,KACxB8e,EACAC,EACA9qB,EACAC,KAKN,MAAM6rH,EAAW,IAAI3wI,KAAKE,UAAUsN,YAWpC,OAVAmjI,EAASsN,MACPkB,EACA/+H,EACAC,EACA,EACAjB,EACAwjH,EACAsI,GAGKyF,CACT,CAyDA,OAAI/hH,GACF,OAAOhF,EAAKs0H,GAALl+I,KACT,CAEA82I,cAAAA,CAAevpI,EAAMzN,GACnB,MAAa,iBAATyN,EACKrO,EAAAy/I,GAAA3+I,KAAKq/I,IAAgBhuI,KAArBrR,KAAsBF,GAExB,IACT,CAmBAi6I,sBAAAA,CAAsBuF,EAAkBngI,GAAO,IAAvBa,EAAOC,GAAOq/H,EACpC,MAAOC,EAAYC,GAActgJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,MACjCkpB,EAAKo1H,GAALt+I,KAAoBggB,GACpBkJ,EAAKq1H,GAALv+I,KAAqBigB,GACrBiJ,EAAKs1H,GAALx+I,KAAoBmf,GACpB,MAAOugI,EAAYC,GAAczgJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,MAC3B4/I,EAAcF,EAAaH,EAC3BM,EAAcF,EAAaH,EAE3BxkF,EAAOpxC,EAAKs0H,GAALl+I,MAMb,OALAg7D,EAAK,IAAM4kF,EACX5kF,EAAK,IAAM6kF,EACX7kF,EAAK,IAAM,EAAI4kF,EACf5kF,EAAK,IAAM,EAAI6kF,EAER7kF,CACT,CAEA8+E,cAAAA,CAAe16H,GAEb,OADA8J,EAAKi1H,GAALn+I,KAAwBof,GACjB,CACL+I,KAAM,CACJ7iB,UAAWtF,KAAK8/I,mBAGtB,CAEA,WAAI7gI,GACF,OAAO2K,EAAKs0H,GAALl+I,MAAW6jB,IAAI0mH,GAAQK,UAAU37H,KAAK,IAC/C,CAEA,qBAAIitI,GACF,MAAOpmI,EAAGC,GAAK6T,EAAKs0H,GAALl+I,MACf,MAAO,CACL4b,KAAM,CACJqD,QAASjf,KAAKif,SAEhBkJ,KAAM,CACJ,mBAAoB,GAAFnd,OAAKu/H,GAAQK,SAAS90H,GAAE,KAAA9K,OAAIu/H,GAAQK,SAAS70H,KAGrE,CAEA,qBAAI+pI,GACF,MAAO,CAAC,CAAG9/H,EAAOC,GAAU2J,EAAKs0H,GAALl+I,MAC5B,IAAIjB,EAAI,EACNgT,EAAI,EACJG,EAAI,EACJC,EAAI,EACJjU,EAAI,EACJkU,EAAI,EACN,OAAQwX,EAAKu0H,GAALn+I,OACN,KAAK,GACH+R,EAAIkO,EAASD,EACb9N,GAAK8N,EAAQC,EACb/hB,EAAI8hB,EACJ,MACF,KAAK,IACHjhB,GAAK,EACLoT,GAAK,EACLjU,EAAI8hB,EACJ5N,EAAI6N,EACJ,MACF,KAAK,IACHlO,GAAKkO,EAASD,EACd9N,EAAI8N,EAAQC,EACZ7N,EAAI6N,EACJ,MACF,QACE,MAAO,GAEX,MAAO,UAAPjV,OAAiBjM,EAAC,KAAAiM,OAAI+G,EAAC,KAAA/G,OAAIkH,EAAC,KAAAlH,OAAImH,EAAC,KAAAnH,OAAIu/H,GAAQK,SAAS1sI,GAAE,KAAA8M,OAAIu/H,GAAQK,SAASx4H,GAAE,IACjF,CAEA2mI,4BAAAA,CAA4BgH,GAAoC,IAAlC7wG,EAAMC,EAAM8f,EAAUC,GAAU6wF,EAC5D,MAAOC,EAASC,GAAW/gJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,OACpB8V,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKs0H,GAALl+I,MAE9B,GACE4O,KAAKmI,IAAIiJ,EAAQggI,IAAYzV,GAAQ2V,WACrCtxI,KAAKmI,IAAIkJ,EAASggI,IAAY1V,GAAQ2V,UACtC,CAEA,MAAMxwG,EAAKR,EAAO+f,EAAW,GAAKn5C,EAAIkK,EAAQ,GACxC2vB,EAAKR,EAAO+f,EAAY,GAAKn5C,EAAIkK,EAAS,GAChD,MAAO,CACLkI,KAAM,CACJ,mBAAoB,GAAFnd,OAAKu/H,GAAQK,SAAS17F,GAAK,KAAAlkC,OAAIu/H,GAAQK,SAASz7F,IAClE7pC,UAAW,GAAF0F,OAAKhL,KAAK8/I,kBAAiB,eAAA90I,OAAc0kC,EAAE,KAAA1kC,OAAI2kC,EAAE,MAGhE,CAYA,MAAMwwG,GAAOlxF,EAAW,EAAI+wF,IAAYhgI,EAAQ,EAAIggI,GAC9CI,GAAOlxF,EAAY,EAAI+wF,IAAYhgI,EAAS,EAAIggI,GAChDI,EAAMrgI,EAAQivC,EACdqxF,EAAMrgI,EAASivC,EAErB,MAAO,CACL/mC,KAAM,CACJ,mBAAoB,GAAFnd,OAAKu/H,GAAQK,SAAS90H,GAAE,KAAA9K,OAAIu/H,GAAQK,SAAS70H,IAC/DzQ,UACE,GAAA0F,OAAGhL,KAAK8/I,kBAAiB,WAAA90I,OAAUq1I,EAAG,KAAAr1I,OAAIs1I,EAAG,mBAAAt1I,OAChCu/H,GAAQK,SAASoV,GAAQ,KAAAh1I,OAAIu/H,GAAQK,SAASqV,GAAQ,YAAAj1I,OAAWm1I,EAAG,KAAAn1I,OAAIo1I,EAAG,MAAI,aAAAp1I,OAC/Eu/H,GAAQK,UAAUoV,GAAQ,KAAAh1I,OAAIu/H,GAAQK,UAAUqV,GAAQ,MAG7E,CAEA9G,2BAAAA,CAA2BoH,GAAoC,IAAlCrxG,EAAMC,EAAM8f,EAAUC,GAAUqxF,EAC3D,MAAOP,EAASC,GAAW/gJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,MACrBg7D,EAAOpxC,EAAKs0H,GAALl+I,OACN8V,EAAGC,EAAGiK,EAAOC,GAAU+6C,EAO9B,GALAA,EAAK,GAAK9rB,EACV8rB,EAAK,GAAK7rB,EACV6rB,EAAK,GAAK/L,EACV+L,EAAK,GAAK9L,EAGRtgD,KAAKmI,IAAIiJ,EAAQggI,IAAYzV,GAAQ2V,WACrCtxI,KAAKmI,IAAIkJ,EAASggI,IAAY1V,GAAQ2V,UACtC,CAEA,MAAMxwG,EAAKR,EAAO+f,EAAW,GAAKn5C,EAAIkK,EAAQ,GACxC2vB,EAAKR,EAAO+f,EAAY,GAAKn5C,EAAIkK,EAAS,GAChD,IAAK,MAAM,KAAE6H,EAAI,OAAEu6G,KAAYz4G,EAAKy0H,GAALr+I,MAC7BuqI,GAAQrnF,WAAWp7B,EAAM4nB,EAAIC,EAAI7nB,GACjCyiH,GAAQrnF,WAAWm/E,EAAQ3yF,EAAIC,EAAI0yF,GAErC,MAAO,CACLzmH,KAAM,CACJqD,QAASjf,KAAKif,SAEhBkJ,KAAM,CACJ,mBAAoB,GAAFnd,OAAKu/H,GAAQK,SAAS17F,GAAK,KAAAlkC,OAAIu/H,GAAQK,SAASz7F,IAClE7pC,UAAWtF,KAAK8/I,mBAAqB,KACrC3tI,EAAGnS,KAAKwqI,aAGd,CAUA,MAAM2V,GAAOlxF,EAAW,EAAI+wF,IAAYhgI,EAAQ,EAAIggI,GAC9CI,GAAOlxF,EAAY,EAAI+wF,IAAYhgI,EAAS,EAAIggI,GAChDvwG,GAAMywG,GAAOrqI,EAAIkqI,GAAW9wG,EAAO8wG,EACnCrwG,GAAMywG,GAAOrqI,EAAIkqI,GAAW9wG,EAAO8wG,EAEzC,GAAY,IAARE,GAAqB,IAARC,GAAoB,IAAP1wG,GAAmB,IAAPC,EACxC,IAAK,MAAM,KAAE7nB,EAAI,OAAEu6G,KAAYz4G,EAAKy0H,GAALr+I,MAC7BuqI,GAAQG,SAAS5iH,EAAM4nB,EAAIC,EAAIwwG,EAAKC,EAAKt4H,GACzCyiH,GAAQG,SAASrI,EAAQ3yF,EAAIC,EAAIwwG,EAAKC,EAAK/d,GAI/C,MAAO,CACLzmH,KAAM,CACJqD,QAASjf,KAAKif,SAEhBkJ,KAAM,CACJ,mBAAoB,GAAFnd,OAAKu/H,GAAQK,SAAS17F,GAAK,KAAAlkC,OAAIu/H,GAAQK,SAASz7F,IAClE7pC,UAAWtF,KAAK8/I,mBAAqB,KACrC3tI,EAAGnS,KAAKwqI,aAGd,CAEAgP,8BAAAA,CAA8BgH,EAAe7nG,GAAkB,IAA/BzJ,EAAMC,GAAKqxG,EACzC,MAAOC,EAAgBC,GAAmB/nG,EACpCqiB,EAAOpxC,EAAKs0H,GAALl+I,MACP0vC,EAAKR,EAAO8rB,EAAK,GACjBrrB,EAAKR,EAAO6rB,EAAK,GAEvB,GACEpxC,EAAK00H,GAALt+I,QAAsBygJ,GACtB72H,EAAK20H,GAALv+I,QAAuB0gJ,EAGvB,IAAK,MAAM,KAAE54H,EAAI,OAAEu6G,KAAYz4G,EAAKy0H,GAALr+I,MAC7BuqI,GAAQrnF,WAAWp7B,EAAM4nB,EAAIC,EAAI7nB,GACjCyiH,GAAQrnF,WAAWm/E,EAAQ3yF,EAAIC,EAAI0yF,OAEhC,CACL,MAAMx9G,EAAK+E,EAAK00H,GAALt+I,MAAoBygJ,EACzB37H,EAAK8E,EAAK20H,GAALv+I,MAAqB0gJ,EAChCx3H,EAAKo1H,GAALt+I,KAAoBygJ,GACpBv3H,EAAKq1H,GAALv+I,KAAqB0gJ,GAErB,IAAK,MAAM,KAAE54H,EAAI,OAAEu6G,KAAYz4G,EAAKy0H,GAALr+I,MAC7BuqI,GAAQG,SAAS5iH,EAAM4nB,EAAIC,EAAI9qB,EAAIC,EAAIgD,GACvCyiH,GAAQG,SAASrI,EAAQ3yF,EAAIC,EAAI9qB,EAAIC,EAAIu9G,GAE3CrnE,EAAK,IAAMn2C,EACXm2C,EAAK,IAAMl2C,CACb,CAIA,OAHAk2C,EAAK,GAAK9rB,EACV8rB,EAAK,GAAK7rB,EAEH,CACLvzB,KAAM,CACJqD,QAASjf,KAAKif,SAEhBkJ,KAAM,CACJhW,EAAGnS,KAAKwqI,YACR,mBAAoB,GAAFx/H,OAAKu/H,GAAQK,SAAS17F,GAAK,KAAAlkC,OAAIu/H,GAAQK,SAASz7F,KAGxE,CAEA,wBAAI4rG,GACF,MAAM//E,EAAOpxC,EAAKs0H,GAALl+I,MACb,MAAO,CACL4b,KAAM,CACJqD,QAASjf,KAAKif,SAEhBu1H,UAAW,CACTe,MAAM,GAERptH,KAAM,CACJhW,EAAGnS,KAAKwqI,YACR,mBAAoB,GAAFx/H,OAAKu/H,GAAQK,SAAS5vE,EAAK,IAAG,KAAAhwD,OAAIu/H,GAAQK,SAAS5vE,EAAK,KAC1E11D,UAAWtF,KAAK8/I,mBAAqB,MAEvC9kF,OAEJ,EACF,SAAAykF,KAtUoD,IAA7B7c,EAASzjI,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGyqB,EAAK80H,GAAL1+I,MAC/B,MAAM2gJ,EAAS/2H,EAAKw0H,GAALp+I,MAAqB4iI,EAAY,EAAKh5G,EAAK40H,GAALx+I,MACrD,OAAO4pB,EAAK60H,GAALz+I,MAAiB,MAAQ,EAC5B,CAAC2gJ,EAAS/2H,EAAK00H,GAALt+I,MAAmB2gJ,EAAS/2H,EAAK20H,GAALv+I,OACtC,CAAC2gJ,EAAS/2H,EAAK20H,GAALv+I,MAAoB2gJ,EAAS/2H,EAAK00H,GAALt+I,MAC7C,UAAAg/I,KAGE,MAAOlpI,EAAGC,EAAGiK,EAAOC,GAAU2J,EAAKs0H,GAALl+I,OACvBggJ,EAASC,GAAW/gJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,KAA0B,GAErD,MAAO,CACL8V,EAAIkqI,EACJjqI,EAAIkqI,EACJjgI,EAAQ,EAAIggI,EACZ//H,EAAS,EAAIggI,EAEjB,UAAArB,KAGE,MAAM5jF,EAAQ9xC,EAAKg1H,GAALl+I,KAAa,IAAIohE,aAAa,CAC1C97C,IACAA,KACCA,KACAA,OAGH,IAAK,MAAM,KAAEwC,KAAU8B,EAAKy0H,GAALr+I,MAAa,CAClC,GAAI8nB,EAAKzpB,QAAU,GAAI,CAErB,IAAK,IAAIqQ,EAAI,EAAGuS,EAAK6G,EAAKzpB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAC7CkD,GAAKiE,iBAAiBiS,EAAKpZ,GAAIoZ,EAAKpZ,EAAI,GAAIssD,GAE9C,QACF,CACA,IAAIrsC,EAAQ7G,EAAK,GACf4G,EAAQ5G,EAAK,GACf,IAAK,IAAIpZ,EAAI,EAAGuS,EAAK6G,EAAKzpB,OAAQqQ,EAAIuS,EAAIvS,GAAK,EAAG,CAChD,MAAOmvI,EAAKC,EAAKC,EAAKC,EAAKloI,EAAGC,GAAK+R,EAAK/Y,SAASL,EAAGA,EAAI,GACxDkD,GAAKyE,kBAAkBsY,EAAOD,EAAOmvH,EAAKC,EAAKC,EAAKC,EAAKloI,EAAGC,EAAGilD,GAC/DrsC,EAAQ7Y,EACR4Y,EAAQ3Y,CACV,CACF,CAEA,MAAOiqI,EAASC,GAAW/gJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,MAC3Bg7D,EAAK,GAAKrjD,GAAUqjD,EAAK,GAAKglF,EAAS,EAAG,GAC1ChlF,EAAK,GAAKrjD,GAAUqjD,EAAK,GAAKilF,EAAS,EAAG,GAC1CjlF,EAAK,GAAKrjD,GAAUqjD,EAAK,GAAKglF,EAAS,EAAG,GAC1ChlF,EAAK,GAAKrjD,GAAUqjD,EAAK,GAAKilF,EAAS,EAAG,GAE1CjlF,EAAK,IAAMA,EAAK,GAChBA,EAAK,IAAMA,EAAK,EAClB,UAAAqkF,GAaiBzc,GACf,MAAO2c,EAAYC,GAActgJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,MACjCkpB,EAAKw1H,GAAL1+I,KAAkB4iI,GAClB,MAAO8c,EAAYC,GAAczgJ,EAAAy/I,GAAA3+I,KAAKy/I,IAAoBpuI,KAAzBrR,OAC1B4/I,EAAaC,GAAe,CACjCH,EAAaH,EACbI,EAAaH,GAETxkF,EAAOpxC,EAAKs0H,GAALl+I,MAMb,OALAg7D,EAAK,IAAM4kF,EACX5kF,EAAK,IAAM6kF,EACX7kF,EAAK,IAAM,EAAI4kF,EACf5kF,EAAK,IAAM,EAAI6kF,EAER7kF,CACT,CC9mBF,MAAM4lF,WAA0BhK,GAC9BppI,WAAAA,CAAYqzI,GACVlzI,QACA3N,KAAK8gJ,gBAAkBD,EAEvBlzI,MAAMkmI,iBAAiB,CACrB7tI,KAAM,OACNF,OAAQ23C,GAAiB8C,kBACzB,iBAAkB,EAClB,eAAgB,EAChB,iBAAkB,QAClB,kBAAmB,QACnB,oBAAqB,IAEzB,CAEAw2F,iBAAAA,CAAkBxpI,EAAMzN,GACT,iBAATyN,IACG,OAALzN,QAAK,IAALA,IAAAA,EAAUE,KAAK,iBACfF,GAASE,KAAK8gJ,gBAAgB1iH,WAEhCzwB,MAAMopI,kBAAkBxpI,EAAMzN,EAChC,CAEA0gB,KAAAA,GACE,MAAMA,EAAQ,IAAIogI,GAAkB5gJ,KAAK8gJ,iBAEzC,OADAtgI,EAAMy2H,UAAUj3I,MACTwgB,CACT,EACF,IAAAugI,GAAA,IAAAhzH,QAKA,MAAMizH,WAAkB3J,GAOtB7pI,WAAAA,CAAYygC,GACVtgC,OAAKq+B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIiC,GAAM,IAAE1gC,KAAM,eAAczO,EAAA,KAAAiiJ,IACvC/gJ,KAAKy/C,sBAAuB,EAC5Bz/C,KAAKgoD,cAAgB,yBACvB,CAGA,iBAAO9T,CAAWC,EAAMlmB,GACtBwvB,GAAiBvJ,WAAWC,EAAMlmB,GAClCjuB,KAAKm4I,uBAAyB,IAAIyI,GAChC3yH,EAAUkQ,eAEd,CAGA,+BAAO25G,CAAyBpsI,GAC9B,MAAM8U,EAAQxgB,KAAKm4I,uBAAuB33H,QAE1C,OADAA,EAAMqzH,iBAAiBnoI,GAChB8U,CACT,CAGA,kCAAWy3H,GACT,OAAO,CACT,CAGA,mBAAWD,GACT,OAAOlrI,GACL9M,KACA,WACA,IAAIqnB,IAAI,CACN,CAAC1lB,EAA2BO,cAAe,gBAC3C,CAACP,EAA2BM,UAAW,UACvC,CAACN,EAA2BQ,YAAa,oBAG/C,CAGA,2BAAO+3I,CAAqBpkI,EAAGC,EAAG26B,EAAaC,EAAcvxB,GAC3D,OAAO,IAAIs9H,GACT5mI,EACAC,EACA26B,EACAC,EACAvxB,EACApf,KAAKm4I,uBAAuB,gBAEhC,CAGA,sBAAOuD,CACLp7H,EACAC,EACAH,EACAC,EACA6qH,EACAhjH,GAEA,OAAOm1H,GAAej1G,YACpB9nB,EACAC,EACAH,EACAC,EACA6qH,EACAhjH,EAEJ,CAGA,wBAAakgB,CAAYlgB,EAAMvL,EAAQsR,GACrC,IAAI4uE,EAAc,KAClB,GAAI30E,aAAgBojG,GAAsB,CACxC,MACEpjG,MAAM,SACJ4lG,EAAQ,KACRn6G,EAAI,SACJyL,EAAQ,GACR3F,EAAE,MACFkK,EAAK,QACL8e,EACAssF,aAAewW,SAAU3C,GAAW,SACpCr3F,EAAQ,SACRuN,EAAQ,YACRtN,EAAW,aACXqU,EAAY,iBACZC,GAEFnjC,QACEmmD,MAAM,WAAE//B,KAER7a,EACJ20E,EAAc30E,EAAO,CACnBmiC,eAAgBnpD,EAAqBK,IACrCoiB,MAAOpS,MAAMC,KAAKmS,GAClBi/G,YACAngG,UACA6sD,MAAO,CAAE+yC,OAAQvU,GACjB5/F,MAAO,KACPuT,UAAWsB,EAAa,EACxBpvB,KAAMA,EAAK0B,MAAM,GACjB+J,WACA+rB,oBAAqB1xB,EACrBA,KACA4xB,SAAS,EACTE,WACAuN,WACAptB,SAAoB,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAar8B,MAAO,KAC7B0wC,eACAC,mBAEJ,CAEA,MAAMt3B,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,GAMrD,OALAzF,EAAO2hC,aAAe0yC,EAClB30E,EAAKwD,SACPlD,EAAOo+B,eAAe1+B,GAGjBM,CACT,CAGA,kBAAIm8B,GAEF,OADA3kD,KAAK2oB,eAAL3oB,KAAK2oB,aAAiB,IAAIg/F,GAAiB3nH,OACpC,CAAC,CAAC,cAAeA,KAAK2oB,cAC/B,CAEA,aAAIk/F,GACF,OAAOlmH,EAA2BM,SACpC,CAEA,SAAI0hB,GACF,OAAO3jB,KAAKw4I,gBAAgB1yI,MAC9B,CAEA,WAAI28B,GACF,OAAOziC,KAAKw4I,gBAAgB,iBAC9B,CAGA96G,eAAAA,GACE,IAAK19B,KAAK2c,OACR,OAEFhP,MAAM+vB,kBACN,MAAM,QAAEm7G,EAAO,gBAAEL,EAAe,OAAE77H,GAAW3c,KAC7Cw4I,EAAgBzB,kBAAkB,gBAClCp6H,EAAOi3H,UAAUC,iBACfgF,EACAL,EAAgBxB,kBAEpB,CAEA,iCAAOgD,GACL,MAAMr9H,EAAS3c,KAAKo4I,eACfz7H,IAGLhP,MAAMqsI,6BACNh6I,KAAKm4I,uBAAuBpB,kBAAkB,gBAC9Cp6H,EAAOi3H,UAAUC,iBACf7zI,KAAKs4I,eACLt4I,KAAKm4I,uBAAuBnB,mBAEhC,CAGAwE,oBAAAA,CAAoByF,GAAgC,IAA/B,MAAEt9H,EAAK,UAAEi/G,EAAS,QAAEngG,GAASw+G,EAChDjhJ,KAAKw4I,gBAAkBwI,GAAUlJ,yBAAyB,CACxDhyI,OAAQ8L,GAAKC,gBAAgB8R,GAC7B,eAAgBi/G,EAChB,iBAAkBngG,GAEtB,CAGAmF,SAAAA,GAAgC,IAAtBwN,EAAYj2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACpB,GAAIa,KAAKm9B,UACP,OAAO,KAGT,GAAIn9B,KAAKqrC,QACP,OAAOrrC,KAAKiqD,mBAGd,MAAM,MAAEpiC,EAAK,OAAEw6G,GAAWriI,KAAKg8I,cAAc5mG,IAE3CojG,iBAAiB,OACf1yI,EACA,iBAAkB28B,EAClB,eAAgBmgG,IAEhB5iI,KACE2nC,EAAarpC,OAAO8c,OAAOzN,MAAMi6B,UAAUwN,GAAe,CAC9DzxB,MAAO85B,GAAiB+C,cAAcppB,QAAQtxB,GAC9C28B,UACAmgG,YACAtzC,MAAO,CACLznE,QACAw6G,YAKJ,OAFAriI,KAAKyrB,WAAWkc,GAEZyN,GACFzN,EAAW8iB,QAAS,EACb9iB,GAGL3nC,KAAKmrC,sBAAwBjsC,EAAA6hJ,GAAA/gJ,KAAKkhJ,IAAkB7vI,KAAvBrR,KAAwB2nC,GAChD,MAGTA,EAAWluB,GAAKzZ,KAAKmrC,oBACdxD,EACT,CAgBAwJ,uBAAAA,CAAwB7F,GACtB,GAAItrC,KAAKqrC,QAEP,OADAC,EAAW9gB,OACJ,KAET,MAAM,OAAE63G,EAAM,KAAE1uH,GAAS3T,KAAKg8I,eAAmC,GAQjE,OAPA1wG,EAAWuiB,aAAa,CACtBl6C,OACAivH,UAAW5iI,KAAKw4I,gBAAgB,gBAChCnW,SACA16E,MAAO3nD,KAAK0rB,UAGP,IACT,EACF,SAAAw1H,GA7BqBv5G,GACjB,MAAM,MAAEhkB,EAAK,UAAEi/G,EAAS,QAAEngG,EAAO,UAAEhB,GAAczhC,KAAKmqD,aACtD,OACEnqD,KAAK+mD,kBACL/mD,KAAK4jD,eACL5jD,KAAK6jD,iBACLlc,EAAWhkB,MAAMivB,KAAK,CAAC1gC,EAAGxD,IAAMwD,IAAMyR,EAAMjV,KAC5Ci5B,EAAWi7F,YAAcA,GACzBj7F,EAAWlF,UAAYA,GACvBkF,EAAWlG,YAAcA,CAE7B,EAAA5iB,EAAAA,EAAAA,GA7OImiI,GAAS,QACE,QAAKniI,EAAAA,EAAAA,GADhBmiI,GAAS,cAGQ9/I,EAAqBK,MAAGsd,EAAAA,EAAAA,GAHzCmiI,GAAS,yBAKmB,MCjDlC,MAAMG,WAA2B9D,GAC/B7S,SAAAA,GACE,IAAIriH,EAAOxa,MAAM68H,YAIjB,OAHKriH,EAAKmY,SAAS,OACjBnY,GAAQ,KAEHA,CACT,ECEF,MAAMi5H,GAucJ,8BAAOC,CACLnjI,EAAIojI,EAEJlhI,EACAC,EACAjB,EACA8rH,GACA,IALA,WAAEtyE,EAAU,UAAE2oF,EAAS,WAAE7nF,GAAY4nF,EAMjC3uH,EAAS,IAAI5iB,gBAAgB,EAAG,GAChCgU,EAAM4O,EAAOnB,WAAW,KAAM,CAAE88E,OAAO,IAC3C,MACMj3C,EACHtzC,EAAIszC,KAAO,GAAHrsD,OAAMu2I,EAAS,KAAAv2I,OAAI0uD,EAAU,KAAA1uD,OAFvB,IAEmC,OAAAA,OAAM4tD,IACpD,sBACJib,EAAqB,uBACrBC,EAAsB,wBACtBC,EAAuB,yBACvBC,EAAwB,sBACxB46B,EAAqB,uBACrBC,EAAsB,MACtB7uF,GACE+D,EAAIguE,YAAY7zE,GAGdsjI,EAAQ,IACRzkE,EAAcnuE,KAAKiX,KACvBjX,KAAKiG,IACHjG,KAAKmI,IAAI88D,GAAyBjlE,KAAKmI,IAAI+8D,IAA2B,EACtE9zD,GACEwhI,GAEAxkE,EAAepuE,KAAKiX,KACxBjX,KAAKiG,IACHjG,KAAKmI,IAAIg9D,GACPnlE,KAAKmI,IAAIi9D,IAxBE,IAyBbplE,KAAKmI,IAAI63F,GAAyBhgG,KAAKmI,IAAI83F,IAzB9B,KA2BX2yC,GAEN7uH,EAAS,IAAI5iB,gBAAgBgtE,EAAaC,GAC1Cj5D,EAAM4O,EAAOnB,WAAW,KAAM,CAAE88E,OAAO,EAAM78E,oBAAoB,IACjE1N,EAAIszC,KAAOA,EACXtzC,EAAIsmD,OAAS,eACbtmD,EAAI00D,UAAY,QAChB10D,EAAIyiE,SAAS,EAAG,EAAGzJ,EAAaC,GAChCj5D,EAAI00D,UAAY,QAChB10D,EAAI+0C,SACF56C,EACe,GAAd6+D,EAA6B,EACd,IAAfC,EAA8B,GAGjC,MAAMykE,EAAWviJ,EA3ffkiJ,GA2fephJ,KAAK0hJ,IAAQrwI,KAAbrR,KACf+jB,EAAIgO,aAAa,EAAG,EAAGgrD,EAAaC,GAAc90D,MAE9Cy5H,EAAYziJ,EA9fhBkiJ,GA8fgBphJ,KAAK4hJ,IAAavwI,KAAlBrR,KAAmByhJ,GAC/BI,EAAY3iJ,EA/fhBkiJ,GA+fgBphJ,KAAK8hJ,IAAezwI,KAApBrR,KAAqB2hJ,GAEjCI,EAAc7iJ,EAjgBlBkiJ,GAigBkBphJ,KAAKgiJ,IAAa3wI,KAAlBrR,KAClByhJ,EACA1kE,EACAC,EACA6kE,GAGF,OAAO7hJ,KAAKiiJ,kBAAkB,CAC5Bp6H,MAAO,CAAEq6H,OAAQH,EAAa/hI,MAAO+8D,EAAa98D,OAAQ+8D,GAC1D58D,YACAC,aACAjB,WACA8rH,cACAiX,YAAY,EACZC,aAAa,GAEjB,CAEA,cAAOhiJ,CAAQoyB,EAAQpS,EAAWC,EAAYjB,EAAU8rH,GACtD,MAAOuW,EAAUzhI,EAAOC,GAAU/gB,EAphBhCkiJ,GAohBgCphJ,KAAKqiJ,IAAchxI,KAAnBrR,KAAoBwyB,IAC/C9iB,EAAQiyI,GAAaziJ,EArhB1BkiJ,GAqhB0BphJ,KAAKsiJ,IAAgBjxI,KAArBrR,KAC1ByhJ,EACAzhI,EACAC,EACArR,KAAKwuC,MAAMp9B,EAAOC,GAAU/gB,EAzhB5BkiJ,GAyhB4BphJ,KAAKuiJ,IAAW3/H,EAAC4/H,aAC7CtjJ,EA1hBAkiJ,GA0hBAphJ,KAAKuiJ,IAAW3/H,EAAC6/H,OACjBvjJ,EA3hBAkiJ,GA2hBAphJ,KAAKuiJ,IAAW3/H,EAAC8/H,YAGbb,EAAY3iJ,EA9hBhBkiJ,GA8hBgBphJ,KAAK8hJ,IAAezwI,KAApBrR,KAAqB2hJ,GACjCI,EAAc7iJ,EA/hBlBkiJ,GA+hBkBphJ,KAAKgiJ,IAAa3wI,KAAlBrR,KAAmB0P,EAAQsQ,EAAOC,EAAQ4hI,GAE9D,OAAO7hJ,KAAKiiJ,kBAAkB,CAC5Bp6H,MAAO,CAAEq6H,OAAQH,EAAa/hI,QAAOC,UACrCG,YACAC,aACAjB,WACA8rH,cACAiX,YAAY,EACZC,aAAa,GAEjB,CAEA,wBAAOH,CAAiBU,GAQrB,IAAAC,EAAA,IARsB,MACvB/6H,EAAK,UACLzH,EAAS,WACTC,EAAU,SACVjB,EAAQ,YACR8rH,EAAW,WACXiX,EAAU,YACVC,GACDO,EACKvjI,EAAW,MAAQ,KACpBgB,EAAWC,GAAc,CAACA,EAAYD,IAGzC,MAAM,OAAE8hI,EAAM,MAAEliI,EAAK,OAAEC,GAAW4H,EAC5B+6G,EAA2B,QAAlBggB,EAAG/6H,EAAM+6G,iBAAS,IAAAggB,EAAAA,EAAI,EAC/BC,EAAiB,GACjB/zC,EAAQlgG,KAAKC,IAAIuR,EAAYJ,EAAOK,EAAaJ,GACjD6iI,EAASh0C,EAAQ1uF,EACjB2iI,EAASj0C,EAAQzuF,EACjB2iI,EAAY,GAElB,IAAK,MAAM,OAAE3gB,KAAY6f,EAAQ,CAC/B,MAAMe,EAAgBd,EAAajjJ,EAlkBnCkiJ,GAkkBmCphJ,KAAKkjJ,IAAe7xI,KAApBrR,KAAqBqiI,GAAUA,EAClE,IAAK4gB,EACH,SAEFD,EAAUh0I,KAAKi0I,GAEf,MAAM7D,EAAM6D,EAAc5kJ,OACpB8kJ,EAAY,IAAI/hF,aAAag+E,GAC7Bt3H,EAAO,IAAIs5C,aAAa,GAAa,IAARg+E,EAAY,EAAIA,EAAM,IAGzD,GAFAyD,EAAe7zI,KAAK,CAAE8Y,OAAMu6G,OAAQ8gB,IAExB,IAAR/D,EAAW,CACb+D,EAAU,GAAKF,EAAc,GAAKH,EAClCK,EAAU,GAAKF,EAAc,GAAKF,EAClCj7H,EAAKtpB,IAAI,CAACoyB,IAAKA,IAAKA,IAAKA,IAAKuyH,EAAU,GAAIA,EAAU,IAAK,GAC3D,QACF,CAEA,IAAKhtI,EAAIC,EAAIE,EAAIC,GAAM0sI,EACvB9sI,GAAM2sI,EACN1sI,GAAM2sI,EACNzsI,GAAMwsI,EACNvsI,GAAMwsI,EACNI,EAAU3kJ,IAAI,CAAC2X,EAAIC,EAAIE,EAAIC,GAAK,GAEhCuR,EAAKtpB,IAAI,CAACoyB,IAAKA,IAAKA,IAAKA,IAAKza,EAAIC,GAAK,GACvC,IAAK,IAAI1H,EAAI,EAAGA,EAAI0wI,EAAK1wI,GAAK,EAAG,CAC/B,MAAMoH,EAAKqtI,EAAUz0I,GAAKu0I,EAAcv0I,GAAKo0I,EACvC/sI,EAAKotI,EAAUz0I,EAAI,GAAKu0I,EAAcv0I,EAAI,GAAKq0I,EACrDj7H,EAAKtpB,IAAI+rI,GAAQO,mBAAmB30H,EAAIC,EAAIE,EAAIC,EAAIT,EAAGC,GAAc,GAATrH,EAAI,KAC/DyH,EAAIC,EAAIE,EAAIC,GAAM,CAACD,EAAIC,EAAIT,EAAGC,EACjC,CACF,CAEA,GAA8B,IAA1B8sI,EAAexkJ,OACjB,OAAO,KAGT,MAAM2uI,EAAUoV,EACZ,IAAIjB,GACJ,IAAI9D,GAYR,OAVArQ,EAAQiR,MACN4E,EACAziI,EACAC,EACA,EACAjB,EACAgjI,EAAc,EAAIxf,EAClBsI,GAGK,CAAE8B,UAASgW,YAAWZ,cAAaxf,YAAW5iH,QAAOC,SAC9D,CAEA,8BAAamjI,CAAiBC,GAM3B,IAqCGC,GA3CyB,SAC7B3S,EAAQ,YACRyR,EAAW,UACXxf,EAAS,MACT5iH,EAAK,OACLC,GACDojI,EAyBKE,EAAUj+H,IACVk+H,GAAWl+H,IACXm+H,EAAiB,EACrB,IAAK,MAAMphB,KAAUsO,EAAU,CAC7B8S,GAAkBphB,EAAOhkI,OACzB,IAAK,IAAIqQ,EAAI,EAAGuS,EAAKohH,EAAOhkI,OAAQqQ,EAAIuS,EAAIvS,IAAK,CAC/C,MAAMg1I,EAAKrhB,EAAO3zH,GAAK2zH,EAAO3zH,EAAI,GAClC60I,EAAU30I,KAAKC,IAAI00I,EAASG,GAC5BF,EAAU50I,KAAKiG,IAAI2uI,EAASE,EAC9B,CACF,CAIEJ,EADEC,IAAY,KAAOC,GAAW,IACnBG,UACJJ,IAAY,OAASC,GAAW,MAC5BI,WAEAriF,WAGf,MAAM69E,EAAMzO,EAAStyI,OACfwlJ,EAprBiB,EACM,EAmrBwCzE,EAC/Dvf,EAAS,IAAIpwH,YAAYo0I,GAE/B,IAAIvrF,EAAS,EACbunE,EAAOvnE,KACLurF,EAAep0I,YAAYq0I,mBAC1BL,EAAiB,EAAIrE,GAAOkE,EAAWQ,kBAC1CjkB,EAAOvnE,KAAY,EACnBunE,EAAOvnE,KAAYt4C,EACnB6/G,EAAOvnE,KAAYr4C,EACnB4/G,EAAOvnE,KAAY8pF,EAAc,EAAI,EACrCviB,EAAOvnE,KAAY1pD,KAAKiG,IAAI,EAAGjG,KAAKiY,MAAe,OAAT+7G,QAAS,IAATA,EAAAA,EAAa,IACvD/C,EAAOvnE,KAAY8mF,EACnBvf,EAAOvnE,KAAYgrF,EAAWQ,kBAC9B,IAAK,MAAMzhB,KAAUsO,EACnB9Q,EAAOvnE,KAAY+pE,EAAOhkI,OAAS,EACnCwhI,EAAOvnE,KAAY+pE,EAAO,GAC1BxC,EAAOvnE,KAAY+pE,EAAO,GAG5B,MAAMxnD,EAAK,IAAIkpE,kBAAkB,eAC3BC,EAASnpE,EAAGztE,SAAS62I,kBACrBD,EAAOr9E,MAEbq9E,EAAO1oF,MAAMukE,GACb,MAAMqkB,EAAaZ,EAAWpjJ,UAAUsN,YACxC,IAAK,MAAM60H,KAAUsO,EAAU,CAC7B,MAAMwT,EAAQ,IAAID,EAAW7hB,EAAOhkI,OAAS,GAC7C,IAAK,IAAIqQ,EAAI,EAAGuS,EAAKohH,EAAOhkI,OAAQqQ,EAAIuS,EAAIvS,IAC1Cy1I,EAAMz1I,EAAI,GAAK2zH,EAAO3zH,GAAK2zH,EAAO3zH,EAAI,GAExCs1I,EAAO1oF,MAAM6oF,EACf,CAEAH,EAAOxwH,QAEP,MAAMhc,QAAY,IAAI4sI,SAASvpE,EAAGwpE,UAAUtmI,cAG5C,OAAOlG,GAFO,IAAIzI,WAAWoI,GAG/B,CAEA,gCAAa8sI,CAAoBC,GAC/B,IACE,MAAMl2I,GnDmfYc,EmDnfWo1I,EnDof7Bn1I,WAAWo1I,WACNp1I,WAAWo1I,WAAWr1I,GAExBD,GAAckpD,KAAKjpD,MmDtfhB,SAAEk1I,EAAQ,SAAEj3I,GAAa,IAAIq3I,oBAAoB,eACjDT,EAAS52I,EAAS62I,kBAClBD,EAAOr9E,MAIbq9E,EACG1oF,MAAMjtD,GACNtO,KAAKwd,gBACEymI,EAAOr9E,YACPq9E,EAAOxwH,UAEd80C,MAAM,QAET,IAAIpgD,EAAO,KACPowC,EAAS,EAAC,IAAAosF,EAAAC,GAAA,EAAAC,GAAA,MACd,QAAkCC,EAAlCC,EpDrwBN,SAAwB1mJ,GACtB,IAAID,EACFF,EACAQ,EACAP,EAAI,EACN,IAAK,oBAAsBg3D,SAAWj3D,EAAIi3D,OAAO6vF,cAAetmJ,EAAIy2D,OAAOC,UAAWj3D,KAAM,CAC1F,GAAID,GAAK,OAASE,EAAIC,EAAEH,IAAK,OAAOE,EAAEkT,KAAKjT,GAC3C,GAAIK,GAAK,OAASN,EAAIC,EAAEK,IAAK,OAAO,IAAIe,EAAsBrB,EAAEkT,KAAKjT,IACrEH,EAAI,kBAAmBQ,EAAI,YAC7B,CACA,MAAM,IAAII,UAAU,+BACtB,CoD0vBMmmJ,CAA0BX,GAAQM,IAAAE,QAAAC,EAAA7kJ,QAAAL,KAAA+kJ,GAAA,EAAE,OAAnB71I,EAAK+1I,EAAA/kJ,MACpBooB,IAAAA,EAAS,IAAI9Y,WAAW,IAAIK,YAAYX,EAAMY,OAAQ,EAAG,GAAG,KAC5DwY,EAAK1pB,IAAIsQ,EAAOwpD,GAChBA,GAAUxpD,EAAMzQ,MAClB,QAAAyhH,GAAA8kC,GAAA,EAAAF,EAAA5kC,CAAA,aAAA6kC,GAAA,MAAAG,EAAAG,cAAAH,EAAAG,QAAA,YAAAL,EAAA,MAAAF,CAAA,EAGA,MAAM7kB,EAAS,IAAIpwH,YAAYyY,EAAKxY,OAAQ,EAAGwY,EAAK7pB,QAAU,GACxD6mJ,EAAUrlB,EAAO,GACvB,GAAgB,IAAZqlB,EACF,MAAM,IAAI/5I,MAAM,oBAADH,OAAqBk6I,IAEtC,MAAMllI,EAAQ6/G,EAAO,GACf5/G,EAAS4/G,EAAO,GAChBuiB,EAA4B,IAAdviB,EAAO,GACrB+C,EAAY/C,EAAO,GACnBslB,EAAmBtlB,EAAO,GAC1ByjB,EAAazjB,EAAO,GACpB8Q,EAAW,GACXyU,GApwBe,EACM,EAowBwBD,GACjD11I,YAAYq0I,kBACd,IAAIK,EAEJ,OAAQb,GACN,KAAKK,UAAUG,kBACbK,EAAQ,IAAIR,UAAUz7H,EAAKxY,OAAQ01I,GACnC,MACF,KAAKxB,WAAWE,kBACdK,EAAQ,IAAIP,WAAW17H,EAAKxY,OAAQ01I,GACpC,MACF,KAAK7jF,WAAWuiF,kBACdK,EAAQ,IAAI5iF,WAAWr5C,EAAKxY,OAAQ01I,GAIxC9sF,EAAS,EACT,IAAK,IAAI5pD,EAAI,EAAGA,EAAIy2I,EAAkBz2I,IAAK,CACzC,MAAM0wI,EAAMvf,EAtxBa,EAsxBqBnxH,EAvxB3B,GAwxBb2zH,EAAS,IAAIjhE,aAAag+E,EAAM,GACtCzO,EAAS3hI,KAAKqzH,GAEd,IAAK,IAAI/1D,EAAI,EAAGA,EAAI+4E,EAA8B/4E,IAChD+1D,EAAO/1D,GACLuzD,EA5xBqB,EA4xBanxH,EA7xBnB,EA6xB4C49D,EAAI,GAEnE,IAAK,IAAIA,EAAI,EAAGA,EAAI8yE,EAAK9yE,IACvB+1D,EAAO/1D,EAAI,GAAK+1D,EAAO/1D,GAAK63E,EAAM7rF,IAEtC,CAEA,MAAO,CACL8pF,cACAxf,YACA+N,WACA3wH,QACAC,SAEJ,CAAE,MAAO/hB,GAEP,OADA+M,GAAK,wBAADD,OAAyB9M,IACtB,IACT,CnDqaJ,IAAwBiR,CmDpatB,EAzyBsB,SAAAm2I,GAQIC,EAAIC,EAAI92I,EAAG49D,GAWnC,OAFAA,GAAKk5E,EAEK,KAHV92I,GAAK62I,GAIIj5E,EAAI,EAAI,EAAI,EAGX,IAAN59D,EACK49D,EAAI,EAGN,EAAIA,CACb,UAAAm5E,GAMyBjuI,EAAKwI,EAAOulI,EAAIC,EAAI92I,EAAG49D,EAAGhU,GACjD,MAAM7+C,EAAKva,EAnCTkiJ,EAmCSphJ,KAAKslJ,IAAkBj0I,KAAvBrR,KAAwBulJ,EAAIC,EAAI92I,EAAG49D,GAC9C,IAAK,IAAID,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMq5E,IAAOr5E,EAAI5yD,EAAK6+C,EAAS,IAAM,EAGrC,GAAmD,IAA/C9gD,GAAK+tI,EAFMrmJ,EAtCfkiJ,EAsCephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,IAEnB1lI,GAASwlI,EADlBtmJ,EAvCfkiJ,EAuCephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,EAAK,KAE9C,OAAOA,CAEX,CACA,OAAQ,CACV,UAAAE,GAEgCpuI,EAAKwI,EAAOulI,EAAIC,EAAI92I,EAAG49D,EAAGhU,GACxD,MAAM7+C,EAAKva,EAhDTkiJ,EAgDSphJ,KAAKslJ,IAAkBj0I,KAAvBrR,KAAwBulJ,EAAIC,EAAI92I,EAAG49D,GAC9C,IAAK,IAAID,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMq5E,GAAMr5E,EAAI5yD,EAAK6+C,EAAS,IAAM,EAGpC,GAAmD,IAA/C9gD,GAAK+tI,EAFMrmJ,EAnDfkiJ,EAmDephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,IAEnB1lI,GAASwlI,EADlBtmJ,EApDfkiJ,EAoDephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,EAAK,KAE9C,OAAOA,CAEX,CACA,OAAQ,CACV,UAAA1D,GAEqBxqI,EAAKwI,EAAOC,EAAQ4hI,GAIvC,MAAMtU,EAAI/1H,EAAInZ,OACR8qC,EAAQ,IAAIo4B,WAAWgsE,GAC7B,IAAK,IAAI7+H,EAAI,EAAGA,EAAI6+H,EAAG7+H,IACrBy6B,EAAMz6B,GAAK8I,EAAI9I,IAAMmzI,EAAY,EAAI,EAGvC,IAAK,IAAInzI,EAAI,EAAGA,EAAIuR,EAAS,EAAGvR,IAC9By6B,EAAMz6B,EAAIsR,GAASmpB,EAAMz6B,EAAIsR,EAAQA,EAAQ,GAAK,EAEpD,IAAK,IAAItR,EAAI,EAAGA,EAAIsR,EAAOtR,IACzBy6B,EAAMz6B,GAAKy6B,EAAMnpB,EAAQC,EAAS,EAAIvR,GAAK,EAG7C,IACIm3I,EADAC,EAAM,EAEV,MAAMC,EAAW,GAEjB,IAAK,IAAIr3I,EAAI,EAAGA,EAAIuR,EAAS,EAAGvR,IAAK,CACnCm3I,EAAO,EACP,IAAK,IAAIv5E,EAAI,EAAGA,EAAItsD,EAAQ,EAAGssD,IAAK,CAClC,MAAM05E,EAAKt3I,EAAIsR,EAAQssD,EACjB25E,EAAM98G,EAAM68G,GAClB,GAAY,IAARC,EACF,SAGF,IAAIC,EAAKx3I,EACLy3I,EAAK75E,EAET,GAAY,IAAR25E,GAA+B,IAAlB98G,EAAM68G,EAAK,GAE1BF,GAAO,EACPK,GAAM,MACD,MAAIF,GAAO,GAAuB,IAAlB98G,EAAM68G,EAAK,IAO3B,CACO,IAARC,IACFJ,EAAOj3I,KAAKmI,IAAIkvI,IAElB,QACF,CAVEH,GAAO,EACPK,GAAM,EACFF,EAAM,IACRJ,EAAOI,EAOX,CAEA,MAAM5jB,EAAS,CAAC/1D,EAAG59D,GACb03I,EAASD,IAAO75E,EAAI,EACpB+5E,EAAU,CACdD,SACA/jB,SACA5oH,GAAIqsI,EACJnpI,OAAQ,GAIV,IAAI2pI,EAFJP,EAAS/2I,KAAKq3I,GAGd,IAAK,MAAMn0I,KAAK6zI,EACd,GAAI7zI,EAAEuH,KAAOosI,EAAM,CACjBS,EAAWp0I,EACX,KACF,CAGGo0I,EAEMA,EAASF,OAClBC,EAAQ1pI,OAASypI,EAASE,EAAS3pI,OAASkpI,EAE5CQ,EAAQ1pI,OAASypI,EAASP,EAAOS,EAAS3pI,OAJ1C0pI,EAAQ1pI,OAASypI,EAASP,EAAO,EAOnC,MAAMx5E,EAAIntE,EAzIZkiJ,EAyIYphJ,KAAKylJ,IAAiBp0I,KAAtBrR,KAAuBmpC,EAAOnpB,EAAOtR,EAAG49D,EAAG45E,EAAIC,EAAI,GAC7D,IAAW,IAAP95E,EAAU,CACZljC,EAAM68G,IAAOF,EACK,IAAd38G,EAAM68G,KACRH,EAAOj3I,KAAKmI,IAAIoyB,EAAM68G,KAExB,QACF,CAEA,IAAIO,EAASrnJ,EAlJfkiJ,EAkJephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAIypD,GACrCm6E,EAAStnJ,EAnJfkiJ,EAmJephJ,KAAK2lJ,IAAkB/iI,EAAC,EAAIypD,EAAI,GAC7C,MAAMo6E,EAAK/3I,EAAI63I,EACTG,EAAKp6E,EAAIk6E,EACfN,EAAKO,EACLN,EAAKO,EACL,IAAIC,EAAKj4I,EACLk4I,EAAKt6E,EAET,OAAa,CACX,MAAMo5E,EAAKxmJ,EA5JfkiJ,EA4JephJ,KAAK4lJ,IAAwBv0I,KAA7BrR,KACTmpC,EACAnpB,EACA2mI,EACAC,EACAV,EACAC,EACA,GAEFI,EAASrnJ,EArKbkiJ,EAqKaphJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,GACrCc,EAAStnJ,EAtKbkiJ,EAsKaphJ,KAAK2lJ,IAAkB/iI,EAAC,EAAI8iI,EAAK,GAC1C,MAAMmB,EAAKF,EAAKJ,EACVO,EAAKF,EAAKJ,EAChBnkB,EAAOrzH,KAAK83I,EAAID,GAChB,MAAME,EAAMJ,EAAK3mI,EAAQ4mI,EAOzB,GANuB,IAAnBz9G,EAAM49G,EAAM,GACd59G,EAAM49G,IAAQjB,EACU,IAAf38G,EAAM49G,KACf59G,EAAM49G,GAAOjB,GAGXe,IAAOn4I,GAAKo4I,IAAOx6E,GAAKq6E,IAAOF,GAAMG,IAAOF,EAAI,CAChC,IAAdv9G,EAAM68G,KACRH,EAAOj3I,KAAKmI,IAAIoyB,EAAM68G,KAExB,KACF,CACEE,EAAKS,EACLR,EAAKS,EACLD,EAAKE,EACLD,EAAKE,CAET,CACF,CACF,CACA,OAAOf,CACT,UAAAiB,GAE6B3kB,EAAQtgH,EAAOC,EAAKpO,GAG/C,GAAIoO,EAAMD,GAAS,EAAG,CACpB,IAAK,IAAIrT,EAAIqT,EAAOrT,EAAIsT,EAAM,EAAGtT,GAAK,EACpCkF,EAAO5E,KAAKqzH,EAAO3zH,GAAI2zH,EAAO3zH,EAAI,IAEpC,MACF,CAEA,MAAMu4I,EAAK5kB,EAAOtgH,GACZmlI,EAAK7kB,EAAOtgH,EAAQ,GACpBolI,EAAM9kB,EAAOrgH,EAAM,GAAKilI,EACxBG,EAAM/kB,EAAOrgH,EAAM,GAAKklI,EACxBG,EAAOz4I,KAAKwuC,MAAM+pG,EAAKC,GACvBE,EAAOH,EAAME,EACbE,EAAOH,EAAMC,EACbG,EAAKF,EAAOJ,EAAKK,EAAON,EAKxBt0I,EAAIy0I,EAAMD,EACVM,EAAO,EAAIJ,EACXK,EAAM94I,KAAK+4I,KAAKh1I,GAChBi1I,EAASh5I,KAAK++F,IAAI+5C,GAClBG,EAASj5I,KAAK8+F,IAAIg6C,GAClBI,EAAOL,GAAQ74I,KAAKmI,IAAI6wI,GAAUh5I,KAAKmI,IAAI8wI,IAC3CE,EAAON,GAAQ,EAAIK,EAAOA,GAAQ,GAClCE,EAAap5I,KAAKiG,IACtBjG,KAAK+4I,KAAK/4I,KAAKmI,IAAI8wI,EAASD,GAAUG,GACtCn5I,KAAK+4I,KAAK/4I,KAAKmI,IAAI8wI,EAASD,GAAUG,IAGxC,IAAIE,EAAO,EACP1rF,EAAQx6C,EACZ,IAAK,IAAIrT,EAAIqT,EAAQ,EAAGrT,EAAIsT,EAAM,EAAGtT,GAAK,EAAG,CAC3C,MAAMyD,EAAIvD,KAAKmI,IAAIywI,EAAKF,EAAOjlB,EAAO3zH,EAAI,GAAK64I,EAAOllB,EAAO3zH,IACzDyD,EAAI81I,IACN1rF,EAAQ7tD,EACRu5I,EAAO91I,EAEX,CAEI81I,GAAQZ,EAAOW,IAAe,GAChC9oJ,EA/OAkiJ,EA+OAphJ,KAAKgnJ,IAAqB31I,KAA1BrR,KAA2BqiI,EAAQtgH,EAAOw6C,EAAQ,EAAG3oD,GACrD1U,EAhPAkiJ,EAgPAphJ,KAAKgnJ,IAAqB31I,KAA1BrR,KAA2BqiI,EAAQ9lE,EAAOv6C,EAAKpO,IAE/CA,EAAO5E,KAAKi4I,EAAIC,EAEpB,UAAAhE,GAEuB7gB,GACrB,MAAMzuH,EAAS,GACTwrI,EAAM/c,EAAOhkI,OAGnB,OAFAa,EAzPEkiJ,EAyPFphJ,KAAKgnJ,IAAqB31I,KAA1BrR,KAA2BqiI,EAAQ,EAAG+c,EAAKxrI,GAC3CA,EAAO5E,KAAKqzH,EAAO+c,EAAM,GAAI/c,EAAO+c,EAAM,IACnCxrI,EAAOvV,QAAU,EAAI,KAAOuV,CACrC,UAAA0uI,GAEwB9qI,EAAKwI,EAAOC,EAAQioI,EAAQzF,EAAQC,GAS1D,MAAMyF,EAAS,IAAI/mF,aAAashF,GAAc,GACxC0F,GAAW,EAAIF,GAAU,EACzBG,EAAW3F,GAAc,EAE/B,IAAK,IAAIh0I,EAAI,EAAGA,EAAIg0I,EAAYh0I,IAAK,CACnC,MAAMoH,GAAKpH,EAAI25I,IAAa,EAC5B,IAAK,IAAI/7E,EAAI,EAAGA,EAAIo2E,EAAYp2E,IAC9B67E,EAAOz5I,EAAIg0I,EAAap2E,GAAK19D,KAAK05I,KAC/BxyI,GAAKw2D,EAAI+7E,IAAa,GAAKD,EAGlC,CAIA,MAAMG,EAAc,IAAInnF,aAAa,KAC/BonF,GAAW,EAAI/F,GAAU,EAC/B,IAAK,IAAI/zI,EAAI,EAAGA,EAAI,IAAKA,IACvB65I,EAAY75I,GAAKE,KAAK05I,IAAI55I,GAAK,EAAI85I,GAGrC,MAAMjb,EAAI/1H,EAAInZ,OACRoqJ,EAAM,IAAIr5I,WAAWm+H,GAIrBoU,EAAY,IAAIlyI,YAAY,KAClC,IAAK,IAAIf,EAAI,EAAGA,EAAIuR,EAAQvR,IAC1B,IAAK,IAAI49D,EAAI,EAAGA,EAAItsD,EAAOssD,IAAK,CAC9B,MAAM05E,EAAKt3I,EAAIsR,EAAQssD,EACjB1qB,EAASpqC,EAAIwuI,GACnB,IAAI0C,EAAM,EACNC,EAAO,EAEX,IAAK,IAAIt8E,EAAI,EAAGA,EAAIq2E,EAAYr2E,IAAK,CACnC,MAAMt2D,EAAIrH,EAAI29D,EAAIg8E,EAClB,KAAItyI,EAAI,GAAKA,GAAKkK,GAGlB,IAAK,IAAIyG,EAAI,EAAGA,EAAIg8H,EAAYh8H,IAAK,CACnC,MAAM5Q,EAAIw2D,EAAI5lD,EAAI2hI,EAClB,GAAIvyI,EAAI,GAAKA,GAAKkK,EAChB,SAEF,MAAM4oI,EAAYpxI,EAAIzB,EAAIiK,EAAQlK,GAC5ByO,EACJ4jI,EAAO97E,EAAIq2E,EAAah8H,GACxB6hI,EAAY35I,KAAKmI,IAAI6xI,EAAYhnG,IACnC8mG,GAAOE,EAAYrkI,EACnBokI,GAAQpkI,CACV,CACF,CAGAo9H,EADa8G,EAAIzC,GAAMp3I,KAAK21C,MAAMmkG,EAAMC,KAE1C,CAGF,MAAO,CAACF,EAAK9G,EACf,UAAAC,GAEqBpqI,GACnB,MAAMmqI,EAAY,IAAIlyI,YAAY,KAClC,IAAK,MAAMqC,KAAK0F,EACdmqI,EAAU7vI,KAEZ,OAAO6vI,CACT,UAAAD,GAEgBlqI,GAKd,MAAM+1H,EAAI/1H,EAAInZ,OACRoqJ,EAAM,IAAIhzE,kBAAkB83D,GAAK,GACvC,IAAI14H,GAAOyQ,IACPzW,EAAMyW,IACV,IAAK,IAAI5W,EAAI,EAAGuS,EAAKwnI,EAAIpqJ,OAAQqQ,EAAIuS,EAAIvS,IAAK,CAC5C,MAAMu3I,EAAOwC,EAAI/5I,GAAK8I,EAAI9I,GAAK,GAC/BmG,EAAMjG,KAAKiG,IAAIA,EAAKoxI,GACpBp3I,EAAMD,KAAKC,IAAIA,EAAKo3I,EACtB,CACA,MAAMn3C,EAAQ,KAAOj6F,EAAMhG,GAC3B,IAAK,IAAIH,EAAI,EAAGuS,EAAKwnI,EAAIpqJ,OAAQqQ,EAAIuS,EAAIvS,IACvC+5I,EAAI/5I,IAAM+5I,EAAI/5I,GAAKG,GAAOigG,EAG5B,OAAO25C,CACT,UAAA3G,GAEuBH,GAQrB,IAAIjzI,EACAm6I,GAAKvjI,IACLwjI,GAAKxjI,IACT,MAAMzW,EAAM8yI,EAAU3lB,UAAUpkH,GAAW,IAANA,GACrC,IAAI7E,EAAMlE,EACNk6I,EAAOl6I,EACX,IAAKH,EAAIG,EAAKH,EAAI,IAAKA,IAAK,CAC1B,MAAMkJ,EAAI+pI,EAAUjzI,GAChBkJ,EAAIixI,IACFn6I,EAAIqE,EAAM+1I,IACZA,EAAIp6I,EAAIqE,EACRg2I,EAAOr6I,EAAI,GAEbm6I,EAAIjxI,EACJ7E,EAAMrE,EAEV,CACA,IAAKA,EAAIq6I,EAAO,EAAGr6I,GAAK,KAClBizI,EAAUjzI,GAAKizI,EAAUjzI,EAAI,IADRA,KAM3B,OAAOA,CACT,UAAA2zI,GAEsB7vH,GACpB,MAAMw2H,EAAiBx2H,GACjB,MAAExS,EAAK,OAAEC,GAAWuS,GACpB,OAAErN,GAAWjmB,EAvYjBkiJ,EAuYiBphJ,KAAKuiJ,IAAW3/H,EACnC,IAAIqsC,EAAWjvC,EACXkvC,EAAYjvC,EAEhB,GAAID,EAAQmF,GAAUlF,EAASkF,EAAQ,CACrC,IAAI8jI,EAAYjpI,EACZkpI,EAAajpI,EAEbmnE,EAAQx4E,KAAKu6I,KAAKv6I,KAAKiG,IAAImL,EAAOC,GAAUkF,GAChD,MAAMikI,EAASx6I,KAAKiY,MAAMugE,GAC1BA,EAAQA,IAAUgiE,EAASA,EAAS,EAAIA,EACxC,IAAK,IAAI16I,EAAI,EAAGA,EAAI04E,EAAO14E,IAAK,CAC9BugD,EAAWrgD,KAAKiX,KAAKojI,EAAY,GACjC/5F,EAAYtgD,KAAKiX,KAAKqjI,EAAa,GAEnC,MAAMn2H,EAAY,IAAIhjB,gBAAgBk/C,EAAUC,GACpCn8B,EAAUvB,WAAW,MAC7BM,UACFU,EACA,EACA,EACAy2H,EACAC,EACA,EACA,EACAj6F,EACAC,GAEF+5F,EAAYh6F,EACZi6F,EAAah6F,EAGT18B,IAAWw2H,GACbx2H,EAAOgB,QAEThB,EAASO,EAAUC,uBACrB,CAEA,MAAM87E,EAAQlgG,KAAKC,IAAIsW,EAAS8pC,EAAU9pC,EAAS+pC,GACnDD,EAAWrgD,KAAK21C,MAAM0K,EAAW6/C,GACjC5/C,EAAYtgD,KAAK21C,MAAM2K,EAAY4/C,EACrC,CACA,MACM/qF,EADY,IAAIhU,gBAAgBk/C,EAAUC,GAC1B19B,WAAW,KAAM,CAAEC,oBAAoB,IAC7D1N,EAAI00D,UAAY,QAChB10D,EAAIyiE,SAAS,EAAG,EAAGv3B,EAAUC,GAC7BnrC,EAAIsmD,OAAS,eACbtmD,EAAI+N,UACFU,EACA,EACA,EACAA,EAAOxS,MACPwS,EAAOvS,OACP,EACA,EACAgvC,EACAC,GAEF,MAAMm6F,EAAYtlI,EAAIgO,aAAa,EAAG,EAAGk9B,EAAUC,GAAWhnC,KAG9D,MAAO,CAFUhpB,EAlcfkiJ,EAkcephJ,KAAK0hJ,IAAQrwI,KAAbrR,KAAcqpJ,GAEbp6F,EAAUC,EAC9B,CAqWFo6F,EA1yBMlI,GAqcJ,IAAAmB,GAAA,CAAA3/H,EApcqB,CACnBuC,OAAQ,IACRq9H,aAAc,IACdC,OAAQ,GACRC,WAAY,KACbiD,GAAA,CAAA/iI,EAwB2B,IAAI2+C,WAAW,CACzC,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,KClCvD,MAAMgoF,WAAyB3S,GAC7BppI,WAAAA,GACEG,QAEAA,MAAMkmI,iBAAiB,CACrB7tI,KAAMy3C,GAAiB8C,kBACvB,eAAgB,GAEpB,CAEA//B,KAAAA,GACE,MAAMA,EAAQ,IAAI+oI,GAElB,OADA/oI,EAAMy2H,UAAUj3I,MACTwgB,CACT,EAGF,MAAMgpI,WAA8B5I,GAClCpzI,WAAAA,CAAYqzI,GACVlzI,MAAMkzI,GAENlzI,MAAMkmI,iBAAiB,CACrB/tI,OAAQ23C,GAAiB8C,kBACzB,eAAgB,GAEpB,CAEA//B,KAAAA,GACE,MAAMA,EAAQ,IAAIgpI,GAAsBxpJ,KAAK8gJ,iBAE7C,OADAtgI,EAAMy2H,UAAUj3I,MACTwgB,CACT,EACF,IAAAipI,GAAA,IAAA97H,QAAA+7H,GAAA,IAAA/7H,QAAAg8H,GAAA,IAAAh8H,QAAAi8H,GAAA,IAAAj8H,QAMA,MAAMk8H,WAAwBxS,GAe5B7pI,WAAAA,CAAYygC,GACVtgC,OAAKq+B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIiC,GAAM,IAAEqpG,iBAAiB,EAAM/pI,KAAM,qBAflDtO,EAAA,KAAAwqJ,IAAe,GAEfxqJ,EAAA,KAAAyqJ,GAAe,MAEfzqJ,EAAA,KAAA0qJ,GAAiB,MAEjB1qJ,EAAA,KAAA2qJ,GAAiB,MAUf5pJ,KAAKy/C,sBAAuB,EAC5Bv2B,EAAKygI,GAAL3pJ,KAAsBiuC,EAAOs2G,eAAiB,MAC9Cr7H,EAAKwgI,GAAL1pJ,KAAoB,MACpBA,KAAKgoD,cAAgB,gCACvB,CAGA,iBAAO9T,CAAWC,EAAMlmB,GACtBwvB,GAAiBvJ,WAAWC,EAAMlmB,GAElCjuB,KAAKm4I,uBAAyB,IAAIoR,GAClCvpJ,KAAK8pJ,8BAAgC,IAAIN,GACvCv7H,EAAUkQ,eAEd,CAGA,+BAAO25G,CAAyBpsI,GAC9B,MAAM8U,EAAQxgB,KAAKm4I,uBAAuB33H,QAE1C,OADAA,EAAMqzH,iBAAiBnoI,GAChB8U,CACT,CAGA,kCAAWy3H,GACT,OAAO,CACT,CAEA,mBAAWD,GACT,OAAOlrI,GAAO9M,KAAM,WAAY,IAAIqnB,IACtC,CAEA,mBAAWi5B,GACT,OAAO,CACT,CAGA,sBAAImN,GACF,MAAO,CACLjtD,KAAM,YACNupJ,iBAAkBngI,EAAK8/H,GAAL1pJ,MAEtB,CAEA,gCAAO20D,CAA0BzsC,GAAM,IAAA8hI,EAAAC,EACrC,MAAMC,EAAsBhiI,EAAK5oB,IAAI,kBACrC,MAAO,CACL8mD,WAAyC,QAA/B4jG,EAAEE,EAAoB5qJ,KAAI,UAAK,IAAA0qJ,EAAAA,EAAI,EAC7CG,aAA4C,QAAhCF,EAAEC,EAAoB5qJ,KAAI,UAAM,IAAA2qJ,EAAAA,EAAI,EAEpD,CAGA,eAAI5hG,GACF,OAAO,CACT,CAGA3qB,eAAAA,GACuB,OAAjB19B,KAAK64I,SAGTlrI,MAAM+vB,iBACR,CAGAjiB,MAAAA,GACE,GAAIzb,KAAKmc,IACP,OAAOnc,KAAKmc,IAGd,IAAI2mC,EAAOC,EACX,MAAM,QAAEyH,GAAYxqD,KAUpB,GATIwqD,IAEFxqD,KAAKwqD,SAAU,EACf1H,EAAQ9iD,KAAK8V,EACbitC,EAAQ/iD,KAAK+V,GAGfpI,MAAM8N,SAEe,OAAjBzb,KAAK64I,QACP,GAAIjvH,EAAK+/H,GAAL3pJ,MAAqB,CACvB,MAAM,MACJ6nB,EAAK,WACLs6H,EAAU,YACVC,EAAW,YACXp1H,EAAW,KACXo9H,EAAI,aACJC,GACEzgI,EAAK+/H,GAAL3pJ,OAEFkgB,SAAS,UAAEE,EAAS,WAAEC,GAAY,SAClCjB,GACEpf,KAAK2c,OAAON,SACV2wH,EAAUoU,GAAmBa,kBAAkB,CACnDp6H,QACAzH,YACAC,aACAjB,WACA8rH,YAAa2e,GAAgBvO,cAC7B6G,aACAC,gBAEFpiJ,KAAKsqJ,aAAatd,EAASqd,EAAcr9H,EAAao9H,EACxD,MAGEpqJ,KAAKmc,IAAI/B,aACP,iBACAisB,KAAKC,UAAU,CAAEtZ,YAAa,MAEhChtB,KAAKmc,IAAIiB,QAAS,EAClBpd,KAAK6pB,WAAWwZ,aAAarjC,WAG/BA,KAAKmc,IAAI/B,aACP,iBACAisB,KAAKC,UAAU,CAAEtZ,YAAapD,EAAK8/H,GAAL1pJ,OAAqB,MASvD,OALIwqD,IACFxqD,KAAKwqD,SAAU,EACfxqD,KAAK6iD,gBAAgBC,EAAOC,IAGvB/iD,KAAKmc,GACd,CAEAouI,OAAAA,CAAQH,GACNlhI,EAAK0gI,GAAL5pJ,KAAsBoqJ,GACtBpqJ,KAAK4kD,gBACP,CAEAvtC,OAAAA,GACE,OAAOuS,EAAKggI,GAAL5pJ,KACT,CAEA,eAAIgtB,GACF,OAAOpD,EAAK8/H,GAAL1pJ,KACT,CAEA,eAAIgtB,CAAYA,GACd9D,EAAKwgI,GAAL1pJ,KAAoBgtB,GACfhtB,KAAKmc,MAGVnc,KAAKmc,IAAI/B,aAAa,iBAAkBisB,KAAKC,UAAU,CAAEtZ,iBACzDrf,MAAMi3C,iBAAiB7kD,KAAKgsB,IACnB,OAAPA,QAAO,IAAPA,GAAAA,EAASgB,0BAA0BC,KAEvC,CAEAw9H,mBAAAA,GACE,MAAM,UAAExH,EAAS,YAAEZ,EAAW,UAAExf,EAAS,MAAE5iH,EAAK,OAAEC,GAChD2J,EAAK+/H,GAAL3pJ,MACImlB,EAASvW,KAAKiG,IAAImL,EAAOC,GAe/B,MAAO,CAAEmiI,cAAapV,QAdFoU,GAAmBa,kBAAkB,CACvDp6H,MAAO,CACLq6H,OAAQc,EAAUn/H,IAAIw+G,IAAU,CAAGA,YACnCO,YACA5iH,QACAC,UAEFG,UAAW+E,EACX9E,WAAY8E,EACZ/F,SAAU,EACV8rH,YAAa,EACbiX,YAAY,EACZC,gBAEyCpV,QAC7C,CAGA,kBAAIroF,GACF,OAAI3kD,KAAK6pB,WAAWuC,iBACX,CAAC,CAAC,gBAAiBpsB,KAAK6pB,WAAWuC,mBAErCze,MAAMg3C,cACf,CAEA2lG,YAAAA,CAAapiI,EAAMmiI,EAAcr9H,EAAao9H,GAC5C,MAAQt0I,EAAGi5B,EAAQh5B,EAAGi5B,GAAWhvC,MAC3B,QAAEgtI,GAAa9jH,EAAKygI,GAAL3pJ,KAAsBkoB,GAG3C,IAAIqzH,EAFJryH,EAAKugI,GAALzpJ,KAAoBgtI,aAAmBmU,IACvCnhJ,KAAKgtB,YAAcA,EAEfpD,EAAK6/H,GAALzpJ,MACFu7I,EAAiBsO,GAAgB/R,4BAEjCyD,EAAiBsO,GAAgBC,8BAA8BtpI,QAC/D+6H,EAAe1H,iBAAiB,CAAE,eAAgB7G,EAAQpK,aAE5D5iI,KAAKu3I,aAAa,CAChBE,aAAczK,EACduO,mBAEF,MAAO,CAAEl7H,GAAcrgB,KAAKigD,eAC5B,IAAIiP,EAAYm7F,EAAehqI,EAG/B6uC,EAAYA,GAAa,EAAI,GAAMA,EAEnClvD,KAAKggB,OAASkvC,EAAYlvD,KAAKigB,OAC3BjgB,KAAKggB,OAAS,IAChBkvC,GAAa,GAAMlvD,KAAKggB,MACxBhgB,KAAKggB,MAAQ,IAGfhgB,KAAKigB,OAASivC,EACdlvD,KAAKmkD,UACLnkD,KAAK8V,EAAIi5B,EACT/uC,KAAK+V,EAAIi5B,EACThvC,KAAK4hD,SAEL5hD,KAAKqkD,aACLrkD,KAAK09B,kBACL19B,KAAK+pD,SACL/pD,KAAK6pB,WAAWqc,uBAAuBlmC,MACvCA,KAAKuqJ,QAAQH,GAEbpqJ,KAAKw0C,iBAAiB,CACpBvI,OAAQ,2BACR/jB,KAAM,CACJuiI,eAAgBL,EAChBL,iBAAkB/8H,KAItBhtB,KAAKmc,IAAIiB,QAAS,CACpB,CAEAstI,YAAAA,CAAal4H,GACX,MACEtS,SAAS,UAAEE,EAAS,WAAEC,GAAY,SAClCjB,GACEpf,KAAK2c,OAAON,SAChB,OAAO+kI,GAAmBhhJ,QACxBoyB,EACApS,EACAC,EACAjB,EACAyqI,GAAgBvO,cAEpB,CAEAqP,WAAAA,CAAYzsI,EAAM0sI,GAChB,MACE1qI,SAAS,UAAEE,EAAS,WAAEC,GAAY,SAClCjB,GACEpf,KAAK2c,OAAON,SAChB,OAAO+kI,GAAmBC,wBACxBnjI,EACA0sI,EACAxqI,EACAC,EACAjB,EACAyqI,GAAgBvO,cAEpB,CAEAuP,iBAAAA,CAAkB3I,GAChB,MACEhiI,SAAS,UAAEE,EAAS,WAAEC,GAAY,SAClCjB,GACEpf,KAAK2c,OAAON,SAChB,OAAO+kI,GAAmBa,kBAAkB,CAC1Cp6H,MAAOq6H,EACP9hI,YACAC,aACAjB,WACA8rH,YAAa2e,GAAgBvO,cAC7B6G,YAAY,EACZC,aAAa,GAEjB,CAGA5G,oBAAAA,CAAoBsP,GAA6B,IAA5B,YAAE1I,EAAW,UAAExf,GAAWkoB,EACzC1I,EACFpiJ,KAAKw4I,gBAAkBqR,GAAgB/R,4BAEvC93I,KAAKw4I,gBACHqR,GAAgBC,8BAA8BtpI,QAChDxgB,KAAKw4I,gBAAgB3E,iBAAiB,CAAE,eAAgBjR,IAE5D,CAGAh7F,SAAAA,GAAgC,IAAtBwN,EAAYj2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACpB,GAAIa,KAAKm9B,UACP,OAAO,KAGT,MAAM,MAAEtV,EAAK,OAAEw6G,GAAWriI,KAAKg8I,cAAc5mG,IAE3CojG,iBAAmB,eAAgB5V,IACjC5iI,KACE2nC,EAAarpC,OAAO8c,OAAOzN,MAAMi6B,UAAUwN,GAAe,CAC9D21G,aAAa,EACb3I,YAAax4H,EAAK6/H,GAALzpJ,MACb2jB,MAAO,CAAC,EAAG,EAAG,GACdi/G,UAAWh5G,EAAK6/H,GAALzpJ,MAAoB,EAAI4iI,IAarC,OAXA5iI,KAAKyrB,WAAWkc,GACZyN,GACFzN,EAAW2nD,MAAQ,CAAEznE,QAAOw6G,UAC5B16F,EAAWyiH,KAAOxgI,EAAKggI,GAAL5pJ,MAClB2nC,EAAW8iB,QAAS,GAEpB9iB,EAAW9f,MAAQA,EAEjB+B,EAAK8/H,GAAL1pJ,QACF2nC,EAAW4iB,kBAAoB,CAAE/pD,KAAM,SAAUwqJ,IAAKphI,EAAK8/H,GAAL1pJ,QAEjD2nC,CACT,CAGA,sBAAO+zG,CACLp7H,EACAC,EACAH,EACAC,EACA6qH,EACAhjH,GAEA,OAAIA,EAAKk6H,YACAjB,GAAmB/4G,YACxB9nB,EACAC,EACAH,EACAC,EACA6qH,EACAhjH,GAIGm1H,GAAej1G,YACpB9nB,EACAC,EACAH,EACAC,EACA6qH,EACAhjH,EAEJ,CAGA,wBAAakgB,CAAYlgB,EAAMvL,EAAQsR,GAAW,IAAAg9H,EAChD,MAAMziI,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,GAIrD,OAHA/E,EAAOugI,GAAPjhI,EAAsBN,EAAKk6H,aAC3B55H,EAAOwE,aAAoC,QAAtBi+H,EAAA/iI,EAAKqiC,yBAAiB,IAAA0gG,OAAA,EAAtBA,EAAwBD,MAAO,GACpD9hI,EAAO0gI,GAAPphI,EAAwBN,EAAKkiI,MACtB5hI,CACT,GACF3J,EAAAA,EAAAA,GAxXMgrI,GAAe,QASJ,cAAWhrI,EAAAA,EAAAA,GATtBgrI,GAAe,cAWE3oJ,EAAqBO,YAASod,EAAAA,EAAAA,GAX/CgrI,GAAe,yBAaa,M,wLC9ClC,MAAMqB,WAAoBztG,GA2BxBjwC,WAAAA,CAAYygC,GACVtgC,OAAKq+B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAC,CAAC,EAAIiC,GAAM,IAAE1gC,KAAM,iBAAgBzO,EAAA,KAAAqsJ,IA3B3ClsJ,EAAA,KAAAmsJ,GAAU,MAEVnsJ,EAAA,KAAAosJ,GAAY,MAEZpsJ,EAAA,KAAAqsJ,GAAiB,MAEjBrsJ,EAAA,KAAAssJ,GAAa,MAEbtsJ,EAAA,KAAAusJ,GAAc,MAEdvsJ,EAAA,KAAAwsJ,GAAkB,IAElBxsJ,EAAA,KAAA0jH,GAAU,MAEV1jH,EAAA,KAAAysJ,IAAiB,GAEjBzsJ,EAAA,KAAA0sJ,GAAmB,MAEnB1sJ,EAAA,KAAA2sJ,IAAS,GAET3sJ,EAAA,KAAA4sJ,IAA2B,GAQzB3iI,EAAKqiI,GAALvrJ,KAAkBiuC,EAAO69G,WACzB5iI,EAAKsiI,GAALxrJ,KAAmBiuC,EAAO89G,YAC1B/rJ,KAAKgoD,cAAgB,2BACvB,CAGA,iBAAO9T,CAAWC,EAAMlmB,GACtBwvB,GAAiBvJ,WAAWC,EAAMlmB,EACpC,CAGA,+BAAOiZ,CAAyBwa,GAC9B,OAAOx7B,GAAwBxV,SAASgxC,EAC1C,CAGA,YAAOpa,CAAMD,EAAM1qB,GACjBA,EAAOqvI,YACL,CAAExoH,KAAMtiC,EAAqBI,OAC7B,CAAEyqJ,WAAY1kH,EAAK4kH,aAEvB,CAGAxnG,aAAAA,GACMzkD,KAAK6pB,WAAW8V,oBAClB3/B,KAAKmc,IAAIiB,QAAS,GAEpBzP,MAAM82C,eACR,CAGA,sBAAIgJ,GAAqB,IAAAy+F,EACvB,MAAO,CACL1rJ,KAAM,QACN4lD,aAA8B,QAAjB8lG,EAAClsJ,KAAK4lD,mBAAW,IAAAsmG,IAAhBA,EAAkB3gI,SAEpC,CAEA,gCAAOopC,CAA0BzsC,GAAM,IAAAikI,EAAAC,EACrC,MAAMC,EAAkBnkI,EAAK5oB,IAAI,cACjC,MAAO,CACL8mD,WAAqC,QAA3B+lG,EAAEE,EAAgB/sJ,KAAI,UAAK,IAAA6sJ,EAAAA,EAAI,EACzChC,aAAwC,QAA5BiC,EAAEC,EAAgB/sJ,KAAI,UAAM,IAAA8sJ,EAAAA,EAAI,EAEhD,CAuDA,oBAAME,GAA2D,IAA5C5rC,EAASvhH,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KAAMotJ,IAAiBptJ,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,KAAAA,UAAA,GACtD,GAAIa,KAAKqmD,iBACP,OAAO,KAGT,MAAM,UAAEvpB,GAAc98B,KAAK6pB,WAC3B,IAAKiT,EACH,MAAM,IAAI3xB,MAAM,UAElB,UAAY2xB,EAAU0vH,aAAa,WACjC,MAAM,IAAIrhJ,MAAM,kCAElB,MAAM,KAAE+c,EAAI,MAAElI,EAAK,OAAEC,GACnBygG,GACA1gH,KAAKysJ,WAAW,KAAM,MAA8B,GAAM/rC,UACtD/iG,QAAiBmf,EAAU4vH,MAAM,CACrCn/I,KAAM,UACN4Q,QAAS,CACP+J,OACAlI,QACAC,SACA0sI,SAAUzkI,EAAK7pB,QAAU2hB,EAAQC,MAGrC,IAAKtC,EACH,MAAM,IAAIxS,MAAM,oCAElB,GAAIwS,EAASipD,MACX,MAAM,IAAIz7D,MAAM,8BAElB,GAAIwS,EAAS63B,OACX,OAAO,KAET,IAAK73B,EAAS/J,OACZ,MAAM,IAAIzI,MAAM,0CAElB,MAAMogB,EAAU5N,EAAS/J,OAKzB,aAJM5T,KAAKgmD,kBAAkBz6B,GACzBghI,IAAsBvsJ,KAAKqmD,mBAC7BrmD,KAAK4lD,YAAc,CAAEolG,IAAKz/H,EAAS8pB,YAAY,IAE1C9pB,CACT,CAkFAT,MAAAA,GACsB,IAAA8hI,EAAhBhjI,EAAKyhI,GAALrrJ,QACFkpB,EAAKkiI,GAALprJ,KAAe,MACfA,KAAK6pB,WAAWymB,aAAald,SAASxJ,EAAKyhI,GAALrrJ,OAC1B,QAAZ4sJ,EAAAhjI,EAAK+4F,GAAL3iH,aAAY,IAAA4sJ,GAAZA,EAAc9hI,SACd5B,EAAKy5F,GAAL3iH,KAAe,MACX4pB,EAAK+hI,GAAL3rJ,QACFu/B,aAAa3V,EAAK+hI,GAAL3rJ,OACbkpB,EAAKyiI,GAAL3rJ,KAAwB,QAG5B2N,MAAMmd,QACR,CAGA+kB,OAAAA,GACO7vC,KAAK2c,QAQVhP,MAAMkiC,UACW,OAAb7vC,KAAKmc,MAILyN,EAAKyhI,GAALrrJ,OAAmC,OAAjB4pB,EAAK+4F,GAAL3iH,OACpBd,EAAAisJ,GAAAnrJ,KAAK6sJ,IAAUx7I,KAAfrR,MAGGA,KAAKmgD,iBAGRngD,KAAK2c,OAAO3d,IAAIgB,QAjBZ4pB,EAAKyhI,GAALrrJ,OACFd,EAAAisJ,GAAAnrJ,KAAK6sJ,IAAUx7I,KAAfrR,KAkBN,CAGAspD,SAAAA,CAAUtlB,GACRhkC,KAAKu/C,cAAe,EAChBvb,GACFhkC,KAAKmc,IAAI6nB,OAEb,CAGA7G,OAAAA,GACE,QACEvT,EAAK0hI,GAALtrJ,OACA4pB,EAAKwhI,GAALprJ,OACA4pB,EAAK2hI,GAALvrJ,OACA4pB,EAAK4hI,GAALxrJ,OACA4pB,EAAKyhI,GAALrrJ,OACA4pB,EAAK8hI,GAAL1rJ,MAEJ,CAGA,kBAAI2kD,GACF,MAAO,CAAC,CAAC,UAAW3kD,KAAK2lD,iBAC3B,CAGA,eAAI0C,GACF,OAAO,CACT,CAGA5sC,MAAAA,GACE,GAAIzb,KAAKmc,IACP,OAAOnc,KAAKmc,IAGd,IAAI2mC,EAAOC,EAyBX,OAxBI/iD,KAAKwqD,UACP1H,EAAQ9iD,KAAK8V,EACbitC,EAAQ/iD,KAAK+V,GAGfpI,MAAM8N,SACNzb,KAAKmc,IAAIiB,QAAS,EAElBpd,KAAK2lD,gBAEA/7B,EAAK8hI,GAAL1rJ,QACC4pB,EAAKwhI,GAALprJ,MACFd,EAAAisJ,GAAAnrJ,KAAK2nE,IAAat2D,KAAlBrR,MAEAd,EAAAisJ,GAAAnrJ,KAAK6sJ,IAAUx7I,KAAfrR,OAIAA,KAAKwqD,SACPxqD,KAAK6iD,gBAAgBC,EAAOC,GAG9B/iD,KAAK6pB,WAAWya,iBAAiBtkC,MAE1BA,KAAKmc,GACd,CAEAs1B,SAAAA,CAAUtG,EAAqBxY,GAC7B,MAAQlZ,GAAIqzI,EAAQ,OAAEt6H,GAAWxyB,KAAK6pB,WAAWymB,aAAa5d,cAC5DyY,EACAxY,GAEFA,EAAO7H,SACHgiI,GAAY9sJ,KAAK6pB,WAAWymB,aAAa7c,UAAUq5H,KACrD5jI,EAAKmiI,GAALrrJ,KAAiB8sJ,GACbt6H,GACFtJ,EAAKkiI,GAALprJ,KAAewyB,GAEjBtJ,EAAKwiI,GAAL1rJ,MAAsB,GACtBd,EAAAisJ,GAAAnrJ,KAAK2nE,IAAat2D,KAAlBrR,MAEJ,CAGAqkD,UAAAA,GAGErkD,KAAK09B,iBACP,CAEAA,eAAAA,GACE,IAAK19B,KAAK2c,OACR,OAE4B,OAA1BiN,EAAK+hI,GAAL3rJ,OACFu/B,aAAa3V,EAAK+hI,GAAL3rJ,OAKfkpB,EAAKyiI,GAAL3rJ,KAAwBgtC,WAAW,KACjC9jB,EAAKyiI,GAAL3rJ,KAAwB,MACxBd,EAAAisJ,GAAAnrJ,KAAK+sJ,IAAW17I,KAAhBrR,OAHmB,KAKvB,CAmEAysJ,UAAAA,CAAWO,EAAkBC,GAA8C,IAAzBrxE,EAAez8E,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAC1D6tJ,IAIHA,EAAmB,KAGrB,MAAQhtI,MAAOktI,EAAajtI,OAAQktI,GAAiBvjI,EAAKwhI,GAALprJ,MAC/CotJ,EAAc,IAAIzoI,GAExB,IAAI6N,EAAS5I,EAAKwhI,GAALprJ,MACTggB,EAAQktI,EACVjtI,EAASktI,EACPx6H,EAAS,KAEb,GAAIs6H,EAAqB,CACvB,GACEC,EAAcD,GACdE,EAAeF,EACf,CACA,MAAMn+C,EAAQlgG,KAAKC,IACjBo+I,EAAsBC,EACtBD,EAAsBE,GAExBntI,EAAQpR,KAAKiY,MAAMqmI,EAAcp+C,GACjC7uF,EAASrR,KAAKiY,MAAMsmI,EAAer+C,EACrC,CAEAn8E,EAAS5W,SAASC,cAAc,UAChC,MAAMqxI,EAAe16H,EAAO3S,MAAQpR,KAAKiX,KAAK7F,EAAQotI,EAAYvoI,IAC5DyoI,EAAgB36H,EAAO1S,OAASrR,KAAKiX,KAAK5F,EAASmtI,EAAYtoI,IAEhE8E,EAAKgiI,GAAL5rJ,QACHwyB,EAAStzB,EAAAisJ,GAAAnrJ,KAAKutJ,IAAYl8I,KAAjBrR,KAAkBqtJ,EAAaC,IAG1C,MAAMvpI,EAAM4O,EAAOnB,WAAW,MAC9BzN,EAAIsmD,OAASrqE,KAAK6pB,WAAWgW,UAI7B,IAAI4iD,EAAQ,QACVroB,EAAQ,UACwB,SAA9Bp6D,KAAK6pB,WAAWgW,UAClBu6B,EAAQ,QACCj0C,GAAYC,aACrBq8D,EAAQ,UACRroB,EAAQ,WAEV,MAAMozF,EAAS,GACTC,EAAcD,EAASJ,EAAYvoI,GACnC6oI,EAAeF,EAASJ,EAAYtoI,GACpCgzD,EAAU,IAAI/nE,gBAA8B,EAAd09I,EAAgC,EAAfC,GAC/CC,EAAa71E,EAAQtmD,WAAW,MACtCm8H,EAAWl1E,UAAYgK,EACvBkrE,EAAWnnE,SAAS,EAAG,EAAiB,EAAdinE,EAAgC,EAAfC,GAC3CC,EAAWl1E,UAAYre,EACvBuzF,EAAWnnE,SAAS,EAAG,EAAGinE,EAAaC,GACvCC,EAAWnnE,SAASinE,EAAaC,EAAcD,EAAaC,GAC5D3pI,EAAI00D,UAAY10D,EAAI20D,cAAcZ,EAAS,UAC3C/zD,EAAIyiE,SAAS,EAAG,EAAG6mE,EAAaC,GAChCvpI,EAAI+N,UACFU,EACA,EACA,EACAA,EAAOxS,MACPwS,EAAOvS,OACP,EACA,EACAotI,EACAC,EAEJ,CAEA,IAAI5sC,EAAY,KAChB,GAAI9kC,EAAiB,CACnB,IAAIgyE,EAAWC,EACf,GACET,EAAYpoI,WACZwN,EAAOxS,MAAQgtI,GACfx6H,EAAOvS,OAAS+sI,EAEhBY,EAAYp7H,EAAOxS,MACnB6tI,EAAar7H,EAAOvS,YAGpB,GADAuS,EAAS5I,EAAKwhI,GAALprJ,MACLktJ,EAAcF,GAAoBG,EAAeH,EAAkB,CACrE,MAAMl+C,EAAQlgG,KAAKC,IACjBm+I,EAAmBE,EACnBF,EAAmBG,GAErBS,EAAYh/I,KAAKiY,MAAMqmI,EAAcp+C,GACrC++C,EAAaj/I,KAAKiY,MAAMsmI,EAAer+C,GAElCllF,EAAKgiI,GAAL5rJ,QACHwyB,EAAStzB,EAAAisJ,GAAAnrJ,KAAKutJ,IAAYl8I,KAAjBrR,KAAkB4tJ,EAAWC,GAE1C,CAGF,MACMC,EADY,IAAI/9I,gBAAgB69I,EAAWC,GAClBr8H,WAAW,KAAM,CAC9CC,oBAAoB,IAEtBq8H,EAAah8H,UACXU,EACA,EACA,EACAA,EAAOxS,MACPwS,EAAOvS,OACP,EACA,EACA2tI,EACAC,GAEFntC,EAAY,CACV1gG,MAAO4tI,EACP3tI,OAAQ4tI,EACR3lI,KAAM4lI,EAAa/7H,aAAa,EAAG,EAAG67H,EAAWC,GAAY3lI,KAEjE,CAEA,MAAO,CAAEyK,SAAQ3S,QAAOC,SAAQygG,YAClC,CAoIA,wBAAat4E,CAAYlgB,EAAMvL,EAAQsR,GACrC,IAAI4uE,EAAc,KACdkxD,GAAgB,EACpB,GAAI7lI,aAAgB0jG,GAAwB,KAAAoiC,EAC1C,MACE9lI,MAAM,KACJvU,EAAI,SACJyL,EAAQ,GACR3F,EAAE,aACFw0I,EAAY,SACZ1iH,EAAQ,SACRuN,EAAQ,YACRtN,EAAW,aACXqU,EAAY,iBACZC,GACD,UACDt4B,EACA7K,QACEmmD,MAAM,WAAE//B,IACT,OACDpQ,GACEzK,EACJ,IAAI4kI,EAAUt6H,EACVG,UACKzK,EAAKyK,SACTlZ,GAAIqzI,EAAUt6H,UAAWvE,EAAUqiB,aAAa5d,cACjDlL,EAAU/N,GACVkZ,IAEFA,EAAO7H,WAEPijI,GAAgB,EAChB7lI,EAAKs+G,cAAe,GAKtB,MAAMj7G,GAEoE,QADxEyiI,QACQrxI,EAAOuxI,YAAYxoB,kBAAkB,GAAD16H,OAAI0M,IAAgB1M,OAAGyO,WAAK,IAAAu0I,OAAA,EADxEA,EAEG1uJ,IAAI,gBAAiB,GAE1Bu9F,EAAc30E,EAAO,CACnBmiC,eAAgBnpD,EAAqBI,MACrCwrJ,WACAt6H,SACAiP,UAAWsB,EAAa,EACxBpvB,KAAMA,EAAK0B,MAAM,GACjB+J,WACA+rB,oBAAqB1xB,EACrBA,KACA4xB,SAAS,EACTkf,kBAAmB,CACjBlV,YAAY,EACZ9pB,WAEF0H,OAAO,EACPg7H,eACA1iH,WACAuN,WACAptB,SAAoB,OAAX8f,QAAW,IAAXA,OAAW,EAAXA,EAAar8B,MAAO,KAC7B0wC,eACAC,mBAEJ,CACA,MAAMt3B,QAAe7a,MAAMy6B,YAAYlgB,EAAMvL,EAAQsR,IAC/C,KAAEta,EAAI,OAAE6e,EAAM,UAAEs5H,EAAS,SAAEgB,EAAQ,MAAE75H,EAAK,kBAAEs3B,GAChDriC,EACE6lI,GACF9/H,EAAUyjB,iBAAiBxpB,EAAKzO,GAAI+O,GACpCU,EAAOwiI,GAAPljI,GAAwB,IACfskI,GAAY7+H,EAAUqiB,aAAa7c,UAAUq5H,IACtD5jI,EAAOmiI,GAAP7iI,EAAmBskI,GACft6H,GACFtJ,EAAOkiI,GAAP5iI,EAAiBgK,IAGnBtJ,EAAOqiI,GAAP/iI,EAAoBsjI,GAEtB5iI,EAAO0iI,GAAPpjI,EAAgByK,GAEhB,MAAOyd,EAAaC,GAAgBnoB,EAAOy3B,eAe3C,OAdAz3B,EAAOxI,OAASrM,EAAK,GAAKA,EAAK,IAAM+8B,EACrCloB,EAAOvI,QAAUtM,EAAK,GAAKA,EAAK,IAAMg9B,EAElC4Z,IACF/hC,EAAOo9B,YAAc2E,GAEvB/hC,EAAO2hC,aAAe0yC,EAClB30E,EAAKwD,SACPlD,EAAOo+B,eAAe1+B,GAIxBgB,EAAO2iI,GAAPrjI,IAAoCq0E,GAE7Br0E,CACT,CAGAof,SAAAA,GAAgD,IAAtCwN,EAAYj2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAAU00D,EAAO10D,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,KACxC,GAAIa,KAAKm9B,UACP,OAAO,KAGT,GAAIn9B,KAAKqrC,QACP,OAAOrrC,KAAKiqD,mBAGd,MAAMtiB,EAAarpC,OAAO8c,OAAOzN,MAAMi6B,UAAUwN,GAAe,CAC9D03G,SAAUljI,EAAKyhI,GAALrrJ,MACVizB,MAAOrJ,EAAKgiI,GAAL5rJ,QAIT,GAFAA,KAAKyrB,WAAWkc,GAEZyN,EAOF,OAHAzN,EAAWmkH,UAAY5sJ,EAAAisJ,GAAAnrJ,KAAKmuJ,IAAgB98I,KAArBrR,MAAoC,GAC3D2nC,EAAW4iB,kBAAoBvqD,KAAKkmD,kBAAiB,GACrDve,EAAW8iB,QAAS,EACb9iB,EAGT,MAAM,WAAE0N,EAAU,QAAE9pB,GAAYvrB,KAAKkmD,kBAAiB,GAItD,IAHK7Q,GAAc9pB,IACjBoc,EAAW4iB,kBAAoB,CAAE/pD,KAAM,SAAUwqJ,IAAKz/H,IAEpDvrB,KAAKmrC,oBAAqB,CAC5B,MAAMijH,EAAUlvJ,EAAAisJ,GAAAnrJ,KAAKquJ,IAAkBh9I,KAAvBrR,KAAwB2nC,GACxC,GAAIymH,EAAQE,OAEV,OAAO,KAIF,IAAAC,EAFP,GAAIH,EAAQI,qBACH7mH,EAAW4iB,uBAElB5iB,EAAW4iB,kBAAkB0jG,aACG,QADSM,EACvCvuJ,KAAKmqD,aAAa8jG,oBAAY,IAAAM,EAAAA,GAAK,EAIvC,OAFA5mH,EAAWluB,GAAKzZ,KAAKmrC,2BACdxD,EAAWmlH,SACXnlH,CACT,CAEA,GAAgB,OAAZksB,EACF,OAAOlsB,EAGTksB,EAAQ46F,SAAR56F,EAAQ46F,OAAW,IAAIpnI,KACvB,MAAMqnI,EAAO9kI,EAAKgiI,GAAL5rJ,OACR2nC,EAAWh0B,KAAK,GAAKg0B,EAAWh0B,KAAK,KACrCg0B,EAAWh0B,KAAK,GAAKg0B,EAAWh0B,KAAK,IACtC,KACJ,GAAKkgD,EAAQ46F,OAAO7vJ,IAAIgrB,EAAKyhI,GAALrrJ,QAKjB,GAAI4pB,EAAKgiI,GAAL5rJ,MAAa,CAGtB,MAAM2uJ,EAAW96F,EAAQ46F,OAAOnvJ,IAAIsqB,EAAKyhI,GAALrrJ,OAChC0uJ,EAAOC,EAASD,OAClBC,EAASD,KAAOA,EAChBC,EAAShnH,WAAWnV,OAAOgB,QAC3Bm7H,EAAShnH,WAAWnV,OAAStzB,EAAAisJ,GAAAnrJ,KAAKmuJ,IAAgB98I,KAArBrR,MAAoC,GAErE,OAXE6zD,EAAQ46F,OAAOjwJ,IAAIorB,EAAKyhI,GAALrrJ,MAAgB,CAAE0uJ,OAAM/mH,eAC3CA,EAAWnV,OAAStzB,EAAAisJ,GAAAnrJ,KAAKmuJ,IAAgB98I,KAArBrR,MAAoC,GAW1D,OAAO2nC,CACT,CAuBAwJ,uBAAAA,CAAwB7F,GACtB,OAAItrC,KAAKqrC,SACPC,EAAW9gB,OACJ,OAET8gB,EAAWuiB,aAAa,CACtBl6C,KAAM3T,KAAKopD,aACXzB,MAAO3nD,KAAK0rB,UAGP,KACT,EACF,SAAAkjI,GA/0BoB1mI,GAAsB,IAAhB2mI,EAAM1vJ,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACvB+oB,GAILgB,EAAKkiI,GAALprJ,KAAekoB,EAAKsK,QACfq8H,IACH3lI,EAAKmiI,GAALrrJ,KAAiBkoB,EAAKzO,IACtByP,EAAK0iI,GAAL5rJ,KAAckoB,EAAK+K,QAEjB/K,EAAK+J,MACP/I,EAAKuiI,GAALzrJ,KAAuBkoB,EAAK+J,KAAK1kB,MAEnCrO,EAAAisJ,GAAAnrJ,KAAK2nE,IAAat2D,KAAlBrR,OAXEA,KAAK8qB,QAYT,UAAAgkI,KAKE,GAFA5lI,EAAKoiI,GAALtrJ,KAAsB,MACtBA,KAAK6pB,WAAWyiB,eAAc,GACzB1iB,EAAK+4F,GAAL3iH,MAGL,GACEA,KAAK6pB,WAAW+V,8BAChB5/B,KAAK6pB,WAAW8V,mBAChB/V,EAAKwhI,GAALprJ,MAEAA,KAAK4kD,iBAAiB7kD,KAAK,KACzBC,KAAK6kD,aAAar6B,OAClBxqB,KAAK6pB,WAAWmX,YAAYhhC,MAAwB,SAPxD,CAYA,IACGA,KAAK6pB,WAAW+V,8BACjB5/B,KAAK6pB,WAAW8V,mBAChB/V,EAAKwhI,GAALprJ,MACA,CACAA,KAAKw0C,iBAAiB,CACpBvI,OAAQ,0BACR/jB,KAAM,CAAE6mI,gBAAgB,EAAOC,cAAe,WAEhD,IAGEhvJ,KAAKssJ,gBACP,CAAE,MAAA2C,GAAO,CACX,CAEAjvJ,KAAKmc,IAAI6nB,OAlBT,CAmBF,UAAA6oH,KA+CE,GAAIjjI,EAAKyhI,GAALrrJ,MAMF,OALAA,KAAK6pB,WAAWyiB,eAAc,QAC9BtsC,KAAK6pB,WAAWymB,aACb/d,UAAU3I,EAAKyhI,GAALrrJ,OACVD,KAAKmoB,GAAQhpB,EAAAisJ,GAAAnrJ,KAAK4uJ,IAAiBv9I,KAAtBrR,KAAuBkoB,GAAqB,IACzDujF,QAAQ,IAAMvsG,EAAAisJ,GAAAnrJ,KAAK8uJ,IAAcz9I,KAAnBrR,OAInB,GAAI4pB,EAAK2hI,GAALvrJ,MAAiB,CACnB,MAAMuL,EAAMqe,EAAK2hI,GAALvrJ,MAOZ,OANAkpB,EAAKqiI,GAALvrJ,KAAkB,MAClBA,KAAK6pB,WAAWyiB,eAAc,QAC9BpjB,EAAKoiI,GAALtrJ,KAAsBA,KAAK6pB,WAAWymB,aACnCle,WAAW7mB,GACXxL,KAAKmoB,GAAQhpB,EAAAisJ,GAAAnrJ,KAAK4uJ,IAAiBv9I,KAAtBrR,KAAuBkoB,IACpCujF,QAAQ,IAAMvsG,EAAAisJ,GAAAnrJ,KAAK8uJ,IAAcz9I,KAAnBrR,OAEnB,CAEA,GAAI4pB,EAAK4hI,GAALxrJ,MAAkB,CACpB,MAAMiyB,EAAOrI,EAAK4hI,GAALxrJ,MAOb,OANAkpB,EAAKsiI,GAALxrJ,KAAmB,MACnBA,KAAK6pB,WAAWyiB,eAAc,QAC9BpjB,EAAKoiI,GAALtrJ,KAAsBA,KAAK6pB,WAAWymB,aACnCte,YAAYC,GACZlyB,KAAKmoB,GAAQhpB,EAAAisJ,GAAAnrJ,KAAK4uJ,IAAiBv9I,KAAtBrR,KAAuBkoB,IACpCujF,QAAQ,IAAMvsG,EAAAisJ,GAAAnrJ,KAAK8uJ,IAAcz9I,KAAnBrR,OAEnB,CAEA,MAAM0iB,EAAQ3G,SAASC,cAAc,SAMrC0G,EAAMliB,KAAO,OACbkiB,EAAMwsI,OAAShpI,GAAwBjX,KAAK,KAC5C,MAAM0a,EAAS3pB,KAAK6pB,WAAWC,QAC/BZ,EAAKoiI,GAALtrJ,KAAsB,IAAIN,QAAQG,IAChC6iB,EAAM3I,iBACJ,SACAwD,UACE,GAAKmF,EAAMysI,OAAgC,IAAvBzsI,EAAMysI,MAAM9wJ,OAEzB,CACL2B,KAAK6pB,WAAWyiB,eAAc,GAC9B,MAAMpkB,QAAaloB,KAAK6pB,WAAWymB,aAAate,YAC9CtP,EAAMysI,MAAM,IAEdnvJ,KAAKw0C,iBAAiB,CACpBvI,OAAQ,6BACR/jB,KAAM,CAAE6mI,eAAgB/uJ,KAAK6pB,WAAW8V,qBAE1CzgC,EAAAisJ,GAAAnrJ,KAAK4uJ,IAAiBv9I,KAAtBrR,KAAuBkoB,EACzB,MAXEloB,KAAK8qB,SAePjrB,KAEF,CAAE8pB,WAEJjH,EAAM3I,iBACJ,SACA,KACE/Z,KAAK8qB,SACLjrB,KAEF,CAAE8pB,aAEH8hF,QAAQ,IAAMvsG,EAAAisJ,GAAAnrJ,KAAK8uJ,IAAcz9I,KAAnBrR,QAEf0iB,EAAM0sI,OAEV,UAAAznF,KAkJgB,IAAA0nF,EACd,MAAM,IAAElzI,GAAQnc,KAChB,IAAI,MAAEggB,EAAK,OAAEC,GAAW2J,EAAKwhI,GAALprJ,MACxB,MAAOogB,EAAWC,GAAcrgB,KAAKigD,eAC/BqvG,EAAY,IAClB,GAAItvJ,KAAKggB,MACPA,EAAQhgB,KAAKggB,MAAQI,EACrBH,EAASjgB,KAAKigB,OAASI,OAClB,GACLL,EAAQsvI,EAAYlvI,GACpBH,EAASqvI,EAAYjvI,EACrB,CAGA,MAAMqwC,EAAS9hD,KAAKC,IACjBygJ,EAAYlvI,EAAaJ,EACzBsvI,EAAYjvI,EAAcJ,GAE7BD,GAAS0wC,EACTzwC,GAAUywC,CACZ,CAEA1wD,KAAK6pB,WAAWyiB,eAAc,GAC9B,MAAM3Z,EAAUzJ,EAAKy5F,GAAL3iH,KAAe+b,SAASC,cAAc,WACtD2W,EAAOvY,aAAa,OAAQ,OAC5Bpa,KAAKslD,aAAa3yB,GAElB3yB,KAAKggB,MAAQA,EAAQI,EACrBpgB,KAAKigB,OAASA,EAASI,EACvBrgB,KAAKmkD,UAEmB,QAAxBkrG,EAAIrvJ,KAAK0/C,uBAAe,IAAA2vG,GAApBA,EAAsB1vG,WACxB3/C,KAAK4hD,SAEL5hD,KAAK8hD,oBAEP9hD,KAAK0/C,gBAAkB,KAGpB1/C,KAAK6pB,WAAW+V,8BAChB5/B,KAAK6pB,WAAW8V,oBACjB3/B,KAAKmrC,sBAELhvB,EAAIiB,QAAS,GAEfle,EAAAisJ,GAAAnrJ,KAAK+sJ,IAAW17I,KAAhBrR,MACK4pB,EAAKiiI,GAAL7rJ,QACHA,KAAK2c,OAAOo3H,kBAAkB/zI,MAC9BkpB,EAAK2iI,GAAL7rJ,MAAgC,IAMlCA,KAAKw0C,iBAAiB,CACpBvI,OAAQ,mBAENriB,EAAK6hI,GAALzrJ,OACFA,KAAKmc,IAAI/B,aAAa,mBAAoBwP,EAAK6hI,GAALzrJ,OAEvCA,KAAKmrC,qBACRnrC,KAAK6pB,WAAWsc,UAAU,iCAE9B,UAAAonH,GAgIavtI,EAAOC,GAClB,MAAQD,MAAOktI,EAAajtI,OAAQktI,GAAiBvjI,EAAKwhI,GAALprJ,MAErD,IAAIivD,EAAWi+F,EACXh+F,EAAYi+F,EACZ36H,EAAS5I,EAAKwhI,GAALprJ,MACb,KAAOivD,EAAW,EAAIjvC,GAASkvC,EAAY,EAAIjvC,GAAQ,CACrD,MAAMgpI,EAAYh6F,EACZi6F,EAAah6F,EAEfD,EAAW,EAAIjvC,IAIjBivC,EACEA,GAAY,MACRrgD,KAAKiY,MAAMooC,EAAW,GAAK,EAC3BrgD,KAAKiX,KAAKopC,EAAW,IAEzBC,EAAY,EAAIjvC,IAClBivC,EACEA,GAAa,MACTtgD,KAAKiY,MAAMqoC,EAAY,GAAK,EAC5BtgD,KAAKiX,KAAKqpC,EAAY,IAG9B,MAAMn8B,EAAY,IAAIhjB,gBAAgBk/C,EAAUC,GACpCn8B,EAAUvB,WAAW,MAC7BM,UACFU,EACA,EACA,EACAy2H,EACAC,EACA,EACA,EACAj6F,EACAC,GAEF18B,EAASO,EAAUC,uBACrB,CAEA,OAAOR,CACT,UAAAu6H,KAGE,MAAOr8G,EAAaC,GAAgB3wC,KAAK24C,kBACnC,MAAE34B,EAAK,OAAEC,GAAWjgB,KACpBotJ,EAAc,IAAIzoI,GAClB0oI,EAAcz+I,KAAKiX,KAAK7F,EAAQ0wB,EAAc08G,EAAYvoI,IAC1DyoI,EAAe1+I,KAAKiX,KAAK5F,EAAS0wB,EAAey8G,EAAYtoI,IAC7D6N,EAAS/I,EAAK+4F,GAAL3iH,MAEf,IACG2yB,GACAA,EAAO3S,QAAUqtI,GAAe16H,EAAO1S,SAAWqtI,EAEnD,OAGF36H,EAAO3S,MAAQqtI,EACf16H,EAAO1S,OAASqtI,EAEhB,MAAM96H,EAAS5I,EAAKgiI,GAAL5rJ,MACX4pB,EAAKwhI,GAALprJ,MACAd,EAAAisJ,GAAAnrJ,KAAKutJ,IAAYl8I,KAAjBrR,KAAkBqtJ,EAAaC,GAE7BvpI,EAAM4O,EAAOnB,WAAW,MAC9BzN,EAAIsmD,OAASrqE,KAAK6pB,WAAWgW,UAC7B9b,EAAI+N,UACFU,EACA,EACA,EACAA,EAAOxS,MACPwS,EAAOvS,OACP,EACA,EACAotI,EACAC,EAEJ,UAAAa,GAEiBoB,GACf,GAAIA,EAAO,CACT,GAAI3lI,EAAKgiI,GAAL5rJ,MAAa,CACf,MAAMuL,EAAMvL,KAAK6pB,WAAWymB,aAAapd,UAAUtJ,EAAKyhI,GAALrrJ,OACnD,GAAIuL,EACF,OAAOA,CAEX,CAGA,MAAMonB,EAAS5W,SAASC,cAAc,YACnCgE,MAAO2S,EAAO3S,MAAOC,OAAQ0S,EAAO1S,QAAW2J,EAAKwhI,GAALprJ,OAIlD,OAHY2yB,EAAOnB,WAAW,MAC1BM,UAAUlI,EAAKwhI,GAALprJ,MAAc,EAAG,GAExB2yB,EAAO68H,WAChB,CAEA,GAAI5lI,EAAKgiI,GAAL5rJ,MAAa,CACf,MAAOogB,EAAWC,GAAcrgB,KAAKigD,eAG/BjgC,EAAQpR,KAAK21C,MACjBvkD,KAAKggB,MAAQI,EAAY9C,GAAc+gB,kBAEnCpe,EAASrR,KAAK21C,MAClBvkD,KAAKigB,OAASI,EAAa/C,GAAc+gB,kBAErCtL,EAAY,IAAIhjB,gBAAgBiQ,EAAOC,GAa7C,OAZY8S,EAAUvB,WAAW,MAC7BM,UACFlI,EAAKwhI,GAALprJ,MACA,EACA,EACA4pB,EAAKwhI,GAALprJ,MAAaggB,MACb4J,EAAKwhI,GAALprJ,MAAaigB,OACb,EACA,EACAD,EACAC,GAEK8S,EAAUC,uBACnB,CAEA,OAAOqiC,gBAAgBzrC,EAAKwhI,GAALprJ,MACzB,UAAAquJ,GAgLmB1mH,GAAY,IAAA8nH,EAC7B,MAAM,UACJhuH,EACA8oB,mBAAmB,QAAEh/B,IACnBvrB,KAAKmqD,aAEHulG,EAAkB/nH,EAAWlG,YAAcA,EAC3C+sH,IAA6C,QAA5BiB,EAAA9nH,EAAW4iB,yBAAiB,IAAAklG,OAAA,EAA5BA,EAA8BzE,MAAO,MAAQz/H,EAEpE,MAAO,CACL+iI,QACGtuJ,KAAK+mD,mBACL/mD,KAAK4jD,gBACL5jD,KAAK6jD,iBACN6rG,GACAlB,EACFA,gBAEJ,EAAA3vI,EAAAA,EAAAA,GA54BIqsI,GAAW,QAuBA,UAAOrsI,EAAAA,EAAAA,GAvBlBqsI,GAAW,cAyBMhqJ,EAAqBI,O,mQCW5C,MAAMquJ,GAgDJniJ,WAAAA,CAAWoiJ,GAWR,IAXS,UACV3hI,EAAS,UACTwT,EAAS,IACTtlB,EAAG,gBACH+nH,EAAe,qBACfF,EAAoB,gBACpBp2E,EAAe,UACfgmF,EAAS,UACTvuG,EAAS,SACThpB,EAAQ,KACR83B,GACDy7G,EAAA9wJ,EAAA,KAAA+wJ,IA1DD5wJ,EAAA,KAAA6wJ,QAAqB,GAErB7wJ,EAAA,KAAA8wJ,IAAc,GAEd9wJ,EAAA,KAAA+wJ,GAAmB,MAEnB/wJ,EAAA,KAAAgxJ,GAAW,MAEXhxJ,EAAA,KAAAixJ,GAAwB,MAExBjxJ,EAAA,KAAAkxJ,GAAW,IAAI9oI,KAEfpoB,EAAA,KAAAmxJ,IAAkB,GAElBnxJ,EAAA,KAAAoxJ,IAAe,GAEfpxJ,EAAA,KAAAqxJ,IAAc,GAEdrxJ,EAAA,KAAAsxJ,GAAa,MAEbtxJ,EAAA,KAAAuxJ,GAAkB,MAElBvxJ,EAAA,KAAAwxJ,GAAa,MAEbxxJ,EAAA,KAAAyxJ,GAAmB,MAEnBzxJ,EAAA,KAAA0xJ,GAAuB,MAEvB1xJ,EAAA,KAAA2xJ,IAA6B,GAE7B3xJ,EAAA,KAAA4xJ,QAAU,GA6BR,MAAMC,EAAc,IAA0BC,GAAYnuI,EAACyc,UAC3D,IAAKswH,GAAsBqB,aAAc,CACvCrB,GAAsBqB,cAAe,EACrC,IAAK,MAAM/lI,KAAc6lI,EACvB7lI,EAAWipB,WAAWC,EAAMlmB,EAEhC,CACAA,EAAUib,oBAAoB4nH,GAE9B5nI,EAAK2nI,GAAL7wJ,KAAkBiuB,GAClBjuB,KAAKyhC,UAAYA,EACjBzhC,KAAKmc,IAAMA,EACX+M,EAAK4mI,GAAL9vJ,KAA6BgkI,GAC7B96G,EAAK8mI,GAALhwJ,KAAwB4tD,GACxB5tD,KAAKqc,SAAWA,EAChB6M,EAAKunI,GAALzwJ,KAAkBqlC,GAClBrlC,KAAK4zI,UAAYA,EACjB5zI,KAAKkuJ,YAAchqB,EAEnBt6G,EAAKinI,GAAL7wJ,MAAgBypC,SAASzpC,KAC3B,CAEA,WAAIm9B,GACF,OAA8B,IAAvBvT,EAAKumI,GAALnwJ,MAAcywB,IACvB,CAEA,eAAIwgI,GACF,OACEjxJ,KAAKm9B,SAAWvT,EAAKinI,GAAL7wJ,MAAgBowC,YAAclvC,EAAqBC,IAEvE,CAMA4qC,aAAAA,CAAcrgC,GACZke,EAAKinI,GAAL7wJ,MAAgB+rC,cAAcrgC,EAChC,CAMAm+B,UAAAA,GAA6C,IAAlCrG,EAAIrkC,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAGyqB,EAAKinI,GAAL7wJ,MAAgBowC,UAEhC,OADAlxC,EAAA2wJ,GAAA7vJ,KAAKg7I,IAAQ3pI,KAAbrR,MACQwjC,GACN,KAAKtiC,EAAqBC,KAMxB,OALAnB,KAAKmc,IAAI6L,UAAUqc,OAAO,cAAc,GACxCrkC,KAAKkxJ,uBACLlxJ,KAAKyuD,qBAAoB,GACzBzuD,KAAKmxJ,oCAAmC,QACxCnxJ,KAAKwsC,eAEP,KAAKtrC,EAAqBK,IACxBvB,KAAKkxJ,uBACLlxJ,KAAKyuD,qBAAoB,GACzBzuD,KAAKysC,cACL,MACF,KAAKvrC,EAAqBG,UACxBrB,KAAKoxJ,sBACLpxJ,KAAKyuD,qBAAoB,GACzBzuD,KAAKwsC,eACL,MACF,QACExsC,KAAKkxJ,uBACLlxJ,KAAKyuD,qBAAoB,GACzBzuD,KAAKysC,cAGTzsC,KAAKmxJ,oCAAmC,GACxC,MAAM,UAAEnpI,GAAchoB,KAAKmc,IAE3B,GADA6L,EAAUqc,OAAO,cAAc,GAC3Bb,IAAStiC,EAAqBM,MAChCwmB,EAAUqc,OAAO,kBAAkB,OAC9B,CACLrc,EAAUqc,OAAO,kBAAkB,GACnC,IAAK,MAAMpZ,KAAoC8lI,GAAYnuI,EAACyc,SAC1DrX,EAAUqc,OAAO,GAADr5B,OACXigB,EAAWo1B,MAAK,WACnB7c,IAASvY,EAAW+f,YAG1B,CACAhrC,KAAKmc,IAAIiB,QAAS,CACpB,CAEA40B,YAAAA,CAAa3M,GAAW,IAAAgsH,EACtB,OAAOhsH,KAA6B,QAApBgsH,EAAKznI,EAAK6mI,GAALzwJ,aAAe,IAAAqxJ,OAAA,EAAfA,EAAiBl1I,IACxC,CAMA0qB,eAAAA,CAAgB3J,GACdtT,EAAKinI,GAAL7wJ,MAAgB6mC,gBAAgB3J,EAClC,CAMAqL,WAAAA,CAAY0F,GACVrkB,EAAKinI,GAAL7wJ,MAAgBuoC,YAAY0F,EAC9B,CAEAC,cAAAA,CAAe1tC,GACbopB,EAAKinI,GAAL7wJ,MAAgBkuC,eAAe1tC,EACjC,CAEA+xC,aAAAA,GAA+B,IAAjBkD,EAAOt2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACnBa,KAAKmc,IAAI6L,UAAUqc,OAAO,WAAYoR,EACxC,CAEAgZ,mBAAAA,GAAqC,IAAjBhZ,EAAOt2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACzBa,KAAKmc,IAAI6L,UAAUqc,OAAO,YAAaoR,EACzC,CAEA07G,kCAAAA,GAAoD,IAAAG,EAAA,IAAjB77G,EAAOt2C,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACnB,QAArBmyJ,EAAA1nI,EAAKomI,GAALhwJ,aAAqB,IAAAsxJ,GAArBA,EAAuB7iG,oBAAoBhZ,EAC7C,CAYA,YAAM/L,GAAS,IAAA6nH,EACbroI,EAAKonI,GAALtwJ,MAAmB,GACnBA,KAAKmc,IAAIgP,SAAW,EACpBnrB,KAAKyuD,qBAAoB,GACzBzuD,KAAKmc,IAAI6L,UAAUqc,OAAO,cAAc,GACf,QAAzBktH,EAAA3nI,EAAK+mI,GAAL3wJ,aAAyB,IAAAuxJ,GAAzBA,EAA2BpyH,QAC3BjW,EAAKynI,GAAL3wJ,KAA4B,MAC5B,MAAMwxJ,EAAuB,IAAIhiI,IACjC,IAAK,MAAMhH,KAAUppB,EAAAywJ,GAAA7vJ,KAAKyxJ,IACxBjpI,EAAO0kC,gBACP1kC,EAAOmC,MAAK,GACRnC,EAAO2iB,sBACTvhB,EAAKinI,GAAL7wJ,MAAgBqtC,gCAAgC7kB,GAChDgpI,EAAqBxyJ,IAAIwpB,EAAO2iB,sBAIpC,MAAMyiB,EAAkBhkC,EAAKomI,GAALhwJ,MACxB,GAAI4tD,EACF,IAAK,MAAMuuE,KAAYvuE,EAAgBs3E,yBAA0B,CAG/D,GADA/I,EAAS3xG,OACLZ,EAAKinI,GAAL7wJ,MAAgBmtC,2BAA2BgvF,EAASj0G,KAAKzO,IAC3D,SAEF,GAAI+3I,EAAqB5yJ,IAAIu9H,EAASj0G,KAAKzO,IACzC,SAEF,MAAM+O,QAAexoB,KAAKooC,YAAY+zF,GACjC3zG,IAGLxoB,KAAK+vC,aAAavnB,GAClBA,EAAO0kC,gBACT,CAEFhkC,EAAKonI,GAALtwJ,MAAmB,GACnB4pB,EAAKinI,GAAL7wJ,MAAgBs9B,UAAUoG,SAAS,kBAAmB,CACpDC,OAAQ3jC,KACR+iC,WAAY/iC,KAAKyhC,UAAY,GAEjC,CAKAkI,OAAAA,GAKE,GAJAzgB,EAAKmnI,GAALrwJ,MAAoB,GACpBA,KAAKmc,IAAIgP,UAAY,EACrBnrB,KAAKyuD,qBAAoB,GACzBzuD,KAAKmc,IAAI6L,UAAUqc,OAAO,cAAc,GACpCza,EAAK6mI,GAALzwJ,QAAoB4pB,EAAK+mI,GAAL3wJ,MAA2B,CACjDkpB,EAAKynI,GAAL3wJ,KAA4B,IAAIi9B,iBAChC,MAAMtT,EAASC,EAAKinI,GAAL7wJ,MAAgBw/B,eAAe5V,EAAK+mI,GAAL3wJ,OAC9C4pB,EAAK6mI,GAALzwJ,MAAgBmc,IAAIpC,iBAClB,cACA7b,IAKE,MACM,QAAE8yD,EAAO,QAAEC,EAAO,UAAElhC,GAAc7xB,EAExC,GAAI6xB,EAD6BnG,EAAKgnI,GAAL5wJ,MAFL,IAK1B,YADAkpB,EAAK0nI,GAAL5wJ,KAAiC+vB,GAGnC7G,EAAK0nI,GAAL5wJ,MAAkC,GAClC,MAAM,UAAEgoB,GAAchoB,KAAKmc,IAC3B6L,EAAUqc,OAAO,eAAe,GAChC,MAAMotF,EAAW11G,SAAS21I,kBAAkB1gG,EAASC,GAErD,GADAjpC,EAAUqc,OAAO,eAAe,IAC3BrkC,KAAKmc,IAAI4e,SAAS02F,EAAS,IAC9B,OAEF,IAAIh4G,EACJ,MAAMk4I,EAAQ,IAAI9uI,OAAO,IAAD7X,OAAK/J,EAAsB,YACnD,IAAK,MAAMyY,KAAW+3G,EACpB,GAAIkgC,EAAMpwI,KAAK7H,EAAQD,IAAK,CAC1BA,EAAKC,EAAQD,GACb,KACF,CAEF,IAAKA,EACH,OAEF,MAAM+O,EAASoB,EAAKumI,GAALnwJ,MAAcV,IAAIma,GACG,QAA1B,OAAN+O,QAAM,IAANA,OAAM,EAANA,EAAQ2iB,uBACVjtC,EAAEqkB,kBACFrkB,EAAEmkB,iBACFmG,EAAO4kC,SAASlvD,KAGpB,CAAEyrB,SAAQ6D,SAAS,GAEvB,CAEA,MAAMogC,EAAkBhkC,EAAKomI,GAALhwJ,MAClB4xJ,EAAqB,GAC3B,GAAIhkG,EAAiB,CACnB,MAAMikG,EAAqB,IAAIxqI,IACzByqI,EAAmB,IAAIzqI,IAC7B,IAAK,MAAMmB,KAAUppB,EAAAywJ,GAAA7vJ,KAAKyxJ,IAAqB,KAAAM,EAC7CvpI,EAAOykC,iBACFzkC,EAAO2iB,oBAIe,OAAvB3iB,EAAOof,aAITkqH,EAAiBtzJ,IAAIgqB,EAAO2iB,oBAAqB3iB,GAEG,QAAtDupI,EAAA/xJ,KAAKmlI,sBAAsB38G,EAAO2iB,4BAAoB,IAAA4mH,GAAtDA,EAAwDpnI,OACxDnC,EAAOsC,UANL+mI,EAAmBrzJ,IAAIgqB,EAAO2iB,oBAAqB3iB,GAJnDopI,EAAmB5iJ,KAAKwZ,EAW5B,CAGA,MAAMwpI,EAAYpkG,EAAgBs3E,yBAClC,IAAK,MAAM/I,KAAY61B,EAAW,CAChC,MAAM,GAAEv4I,GAAO0iH,EAASj0G,KACxB,GAAI0B,EAAKinI,GAAL7wJ,MAAgBmtC,2BAA2B1zB,GAAK,CAClD0iH,EAAStuE,aAAa,CAAExiB,SAAS,IACjC,QACF,CACA,IAAI7iB,EAASspI,EAAiBxyJ,IAAIma,GAC9B+O,GACFA,EAAOylC,uBAAuBkuE,GAC9B3zG,EAAOmC,MAAK,GACZwxG,EAASxxG,SAIXnC,EAASqpI,EAAmBvyJ,IAAIma,GAC5B+O,IACFoB,EAAKinI,GAAL7wJ,MAAgBktC,6BAA6B1kB,GACzCA,EAAO2oB,wBAAwBgrF,IAEjC3zG,EAAOmC,MAAK,IAGhBwxG,EAASxxG,OACX,CACF,CAEAzrB,EAAA2wJ,GAAA7vJ,KAAKg7I,IAAQ3pI,KAAbrR,MACIA,KAAKm9B,UACPn9B,KAAKmc,IAAIiB,QAAS,GAEpB,MAAM,UAAE4K,GAAchoB,KAAKmc,IAC3B,IAAK,MAAM8O,KAAoC8lI,GAAYnuI,EAACyc,SAC1DrX,EAAU8C,OAAO,GAAD9f,OAAIigB,EAAWo1B,MAAK,YAEtCrgD,KAAKkxJ,uBACLlxJ,KAAKmxJ,oCAAmC,GACzB,OAAfvjG,QAAe,IAAfA,GAAAA,EAAiB03E,sBAAsBssB,GAEvC1oI,EAAKmnI,GAALrwJ,MAAoB,EACtB,CAEAmlI,qBAAAA,CAAsB1rH,GAAI,IAAAw4I,EACxB,OAA4B,QAArBA,EAAAroI,EAAKomI,GAALhwJ,aAAqB,IAAAiyJ,OAAA,EAArBA,EAAuB9sB,sBAAsB1rH,KAAO,IAC7D,CAMA6zB,eAAAA,CAAgB9kB,GACQoB,EAAKinI,GAAL7wJ,MAAgBiwC,cAChBznB,GAItBoB,EAAKinI,GAAL7wJ,MAAgBstC,gBAAgB9kB,EAClC,CAEA4oI,mBAAAA,GAAsB,IAAAc,EAEpB,GADAlyJ,KAAKmc,IAAIgP,UAAY,EACF,QAAf+mI,EAAAtoI,EAAK6mI,GAALzwJ,aAAe,IAAAkyJ,GAAfA,EAAiB/1I,MAAQyN,EAAK8mI,GAAL1wJ,MAAuB,CAClDkpB,EAAKwnI,GAAL1wJ,KAAwB,IAAIi9B,iBAC5B,MAAMtT,EAASC,EAAKinI,GAAL7wJ,MAAgBw/B,eAAe5V,EAAK8mI,GAAL1wJ,OAE9C4pB,EAAK6mI,GAALzwJ,MAAgBmc,IAAIpC,iBAClB,cACA7a,EAAA2wJ,GAAA7vJ,KAAKmyJ,IAAsB5kI,KAAKvtB,MAChC,CAAE2pB,WAEJC,EAAK6mI,GAALzwJ,MAAgBmc,IAAI6L,UAAUhpB,IAAI,eACpC,CACF,CAEAkyJ,oBAAAA,GAAuB,IAAAkB,EACrBpyJ,KAAKmc,IAAIgP,SAAW,EACD,QAAfinI,EAAAxoI,EAAK6mI,GAALzwJ,aAAe,IAAAoyJ,GAAfA,EAAiBj2I,KAAOyN,EAAK8mI,GAAL1wJ,QAC1B4pB,EAAK8mI,GAAL1wJ,MAAsBm/B,QACtBjW,EAAKwnI,GAAL1wJ,KAAwB,MAExB4pB,EAAK6mI,GAALzwJ,MAAgBmc,IAAI6L,UAAU8C,OAAO,gBAEzC,CA0CA2hB,WAAAA,GACE,GAAI7iB,EAAKqmI,GAALjwJ,MACF,OAEFkpB,EAAK+mI,GAALjwJ,KAAgB,IAAIi9B,iBACpB,MAAMtT,EAASC,EAAKinI,GAAL7wJ,MAAgBw/B,eAAe5V,EAAKqmI,GAALjwJ,OAE9CA,KAAKmc,IAAIpC,iBAAiB,cAAe/Z,KAAKyoD,YAAYl7B,KAAKvtB,MAAO,CACpE2pB,WAEF,MAAM6oB,EAAYxyC,KAAKwyC,UAAUjlB,KAAKvtB,MACtCA,KAAKmc,IAAIpC,iBAAiB,YAAay4B,EAAW,CAAE7oB,WACpD3pB,KAAKmc,IAAIpC,iBAAiB,gBAAiBy4B,EAAW,CAAE7oB,UAC1D,CAEA6iB,YAAAA,GAAe,IAAA6lH,EACA,QAAbA,EAAAzoI,EAAKqmI,GAALjwJ,aAAa,IAAAqyJ,GAAbA,EAAelzH,QACfjW,EAAK+mI,GAALjwJ,KAAgB,KAClB,CAEAsyJ,MAAAA,CAAO9pI,GACLoB,EAAKumI,GAALnwJ,MAAcxB,IAAIgqB,EAAO/O,GAAI+O,GAC7B,MAAM,oBAAE2iB,GAAwB3iB,EAE9B2iB,GACAvhB,EAAKinI,GAAL7wJ,MAAgBmtC,2BAA2BhC,IAE3CvhB,EAAKinI,GAAL7wJ,MAAgBotC,+BAA+B5kB,EAEnD,CAEA+pI,MAAAA,CAAO/pI,GAAQ,IAAAgqI,EACb5oI,EAAKumI,GAALnwJ,MAAcqrB,OAAO7C,EAAO/O,IACF,QAA1B+4I,EAAA5oI,EAAKkmI,GAAL9vJ,aAA0B,IAAAwyJ,GAA1BA,EAA4BntB,yBAAyB78G,EAAO8kC,aAEvD1jC,EAAKymI,GAALrwJ,OAAqBwoB,EAAO2iB,qBAC/BvhB,EAAKinI,GAAL7wJ,MAAgBitC,4BAA4BzkB,EAEhD,CAMAsC,MAAAA,CAAOtC,GACLxoB,KAAKuyJ,OAAO/pI,GACZoB,EAAKinI,GAAL7wJ,MAAgB6sC,aAAarkB,GAC7BA,EAAOrM,IAAI2O,SACXtC,EAAO23B,iBAAkB,CAC3B,CAOArQ,YAAAA,CAAatnB,GAAQ,IAAAiqI,EACfjqI,EAAO7L,SAAW3c,OAIlBwoB,EAAO7L,QAAU6L,EAAO2iB,sBAC1BvhB,EAAKinI,GAAL7wJ,MAAgBitC,4BAA4BzkB,GAC5Ci1B,GAAiBgD,wBAAwBj4B,GACzCA,EAAO2iB,oBAAsB,MAG/BnrC,KAAKsyJ,OAAO9pI,GACC,QAAbiqI,EAAAjqI,EAAO7L,cAAM,IAAA81I,GAAbA,EAAeF,OAAO/pI,GACtBA,EAAO05B,UAAUliD,MACbwoB,EAAOrM,KAAOqM,EAAO23B,kBACvB33B,EAAOrM,IAAI2O,SACX9qB,KAAKmc,IAAIC,OAAOoM,EAAOrM,MAE3B,CAMAnd,GAAAA,CAAIwpB,GACF,GAAIA,EAAO7L,SAAW3c,OAAQwoB,EAAO23B,gBAArC,CAOA,GAJAngD,KAAK8vC,aAAatnB,GAClBoB,EAAKinI,GAAL7wJ,MAAgB4sC,UAAUpkB,GAC1BxoB,KAAKsyJ,OAAO9pI,IAEPA,EAAO23B,gBAAiB,CAC3B,MAAMhkC,EAAMqM,EAAO/M,SACnBzb,KAAKmc,IAAIC,OAAOD,GAChBqM,EAAO23B,iBAAkB,CAC3B,CAGA33B,EAAOs5B,oBACPt5B,EAAO8gC,WAAyB1/B,EAAK0mI,GAALtwJ,OAChC4pB,EAAKinI,GAAL7wJ,MAAgBkmC,uBAAuB1d,GACvCA,EAAOgsB,iBAAiBhsB,EAAOglC,qBAf/B,CAgBF,CAEAzE,eAAAA,CAAgBvgC,GAAQ,IAAAkqI,EACtB,IAAKlqI,EAAO23B,gBACV,OAGF,MAAM,cAAEnlB,GAAkBjf,SACtByM,EAAOrM,IAAI4e,SAASC,KAAmBpR,EAAKsmI,GAALlwJ,QAKzCwoB,EAAO6E,qBAAsB,EAC7BnE,EAAKgnI,GAALlwJ,KAA6BgtC,WAAW,KACtC9jB,EAAKgnI,GAALlwJ,KAA6B,MACxBwoB,EAAOrM,IAAI4e,SAAShf,SAASif,eAUhCxS,EAAO6E,qBAAsB,GAT7B7E,EAAOrM,IAAIpC,iBACT,UACA,KACEyO,EAAO6E,qBAAsB,GAE/B,CAAEoW,MAAM,EAAM9Z,OAAQC,EAAKinI,GAAL7wJ,MAAgB8pB,UAExCkR,EAAcgJ,UAIf,KAGLxb,EAAOo3B,oBAAgD,QAA7B8yG,EAAG9oI,EAAKkmI,GAAL9vJ,aAA0B,IAAA0yJ,OAAA,EAA1BA,EAA4BC,iBACvD3yJ,KAAKmc,IACLqM,EAAOrM,IACPqM,EAAO8kC,YACa,EAExB,CAMAvd,YAAAA,CAAavnB,GACPA,EAAOihC,oBACTjhC,EAAO7L,SAAP6L,EAAO7L,OAAW3c,MAClBwoB,EAAOqnB,UACPrnB,EAAOmC,QAEP3qB,KAAKhB,IAAIwpB,EAEb,CAMAurH,iBAAAA,CAAkBvrH,GAMhBxoB,KAAKuoC,YAAY,CAAErT,IALPA,IAAM1M,EAAOqB,WAAWgmB,QAAQrnB,GAKpB2M,KAJXA,KACX3M,EAAOsC,UAGqBuK,UAAU,GAC1C,CAEAsM,cAAAA,CAAeD,GACb,IAAK,MAAMlZ,KAAUoB,EAAKumI,GAALnwJ,MAAcq/B,SACjC,GAAI7W,EAAOkZ,MAAQA,EACjB,OAAOlZ,EAGX,OAAO,IACT,CAMAo4B,SAAAA,GACE,OAAOh3B,EAAKinI,GAAL7wJ,MAAgBspC,OACzB,CAMA9J,cAAAA,CAAeC,GACb,OAAO7V,EAAKinI,GAAL7wJ,MAAgBw/B,eAAeC,EACxC,CAYAoM,uBAAAA,GAA0B,IAAA+mH,EACxB,OAA8B,QAA9BA,EAAOxzJ,EAAAywJ,GAAA7vJ,KAAK6yJ,WAAkB,IAAAD,OAAA,EAAvBA,EAAyB/mH,yBAClC,CAOA,iBAAMmgH,CAAYtgJ,EAASuiC,GACzBjuC,KAAK+rC,cAAcrgC,SACbke,EAAKinI,GAAL7wJ,MAAgB6pC,WAAWn+B,EAAQ83B,MAEzC,MAAM,QAAEnkB,EAAO,QAAEC,GAAYpgB,EAAA2wJ,GAAA7vJ,KAAK8yJ,IAAezhJ,KAApBrR,MACvByZ,EAAKzZ,KAAK4gD,YACVp4B,EAAStpB,EAAA2wJ,GAAA7vJ,KAAK+yJ,IAAgB1hJ,KAArBrR,MAAIgsC,EAAAA,EAAAA,GAAA,CACjBrvB,OAAQ3c,KACRyZ,KACA3D,EAAGuJ,EACHtJ,EAAGuJ,EACH2O,UAAWrE,EAAKinI,GAAL7wJ,MACX2/C,YAAY,GACT1R,IAEDzlB,GACFxoB,KAAKhB,IAAIwpB,EAEb,CAOA,iBAAM4f,CAAYlgB,GAAM,IAAA8qI,EAAAC,EACtB,aAE0D,QADvDD,EAA4BjC,GAAYnuI,EACtCtjB,IAAuB,QAApB2zJ,EAAC/qI,EAAKmiC,sBAAc,IAAA4oG,EAAAA,EAAI/qI,EAAKyqG,6BAAqB,IAAAqgC,OAAA,EADjDA,EAEH5qH,YAAYlgB,EAAMloB,KAAM4pB,EAAKinI,GAAL7wJ,SAAqB,IAErD,CASA4lC,qBAAAA,CAAsB5rB,EAAO2lC,GAAuB,IAAXz3B,EAAI/oB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC/C,MAAMsa,EAAKzZ,KAAK4gD,YACVp4B,EAAStpB,EAAA2wJ,GAAA7vJ,KAAK+yJ,IAAgB1hJ,KAArBrR,MAAIgsC,EAAAA,EAAAA,GAAA,CACjBrvB,OAAQ3c,KACRyZ,KACA3D,EAAGkE,EAAMqF,QACTtJ,EAAGiE,EAAMsF,QACT2O,UAAWrE,EAAKinI,GAAL7wJ,MACX2/C,cACGz3B,IAML,OAJIM,GACFxoB,KAAKhB,IAAIwpB,GAGJA,CACT,CAEA,sBAAIsvB,GACF,OAAO93C,KAAKmc,IAAIioB,uBAClB,CAqBA0H,YAAAA,GAAwB,IAAX5jB,EAAI/oB,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,CAAC,EACnBa,KAAK4lC,sBACH1mC,EAAA2wJ,GAAA7vJ,KAAK8yJ,IAAezhJ,KAApBrR,OACmB,EACnBkoB,EAEJ,CAMAwjB,WAAAA,CAAYljB,GACVoB,EAAKinI,GAAL7wJ,MAAgB0rC,YAAYljB,EAC9B,CAMAmlB,cAAAA,CAAenlB,GACboB,EAAKinI,GAAL7wJ,MAAgB2tC,eAAenlB,EACjC,CAMAojB,QAAAA,CAASpjB,GACPoB,EAAKinI,GAAL7wJ,MAAgB4rC,SAASpjB,EAC3B,CAMAgqB,SAAAA,CAAUx4B,GAAO,IAAAk5I,EACf,MAAM,MAAEtiJ,GAAUtB,GAAYgB,SAC9B,GAAqB,IAAjB0J,EAAMkR,QAAiBlR,EAAMwc,SAAW5lB,EAE1C,OAGF,GAAIoJ,EAAME,SAAWla,KAAKmc,IACxB,OAGF,IAAKyN,EAAKwmI,GAALpwJ,MAKH,OAIF,GAFAkpB,EAAKknI,GAALpwJ,MAAuB,GAGE,QAAvBkzJ,EAAA9zJ,EAAAywJ,GAAA7vJ,KAAK6yJ,WAAkB,IAAAK,GAAvBA,EAAyB5yG,UACzBlhD,EAAAywJ,GAAA7vJ,KAAK6yJ,IAAmB5a,wBAExB,OAGF,IAAKruH,EAAKmmI,GAAL/vJ,MAEH,YADAkpB,EAAK6mI,GAAL/vJ,MAAmB,GAIrB,MAAMmzJ,EAAcvpI,EAAKinI,GAAL7wJ,MAAgBowC,UAElC+iH,IAAgBjyJ,EAAqBI,OACrC6xJ,IAAgBjyJ,EAAqBO,UAMvCzB,KAAK4lC,sBAAsB5rB,GAA0B,GAJnD4P,EAAKinI,GAAL7wJ,MAAgBi8B,aAKpB,CAMAwsB,WAAAA,CAAYzuC,GAAO,IAAAo5I,EAIjB,GAHIxpI,EAAKinI,GAAL7wJ,MAAgBowC,YAAclvC,EAAqBG,WACrDrB,KAAKoxJ,sBAEHxnI,EAAKwmI,GAALpwJ,MAOF,YADAkpB,EAAKknI,GAALpwJ,MAAuB,GAGzB,MAAM,MAAE4Q,GAAUtB,GAAYgB,SAC9B,GAAqB,IAAjB0J,EAAMkR,QAAiBlR,EAAMwc,SAAW5lB,EAE1C,OAGF,GAAIoJ,EAAME,SAAWla,KAAKmc,IACxB,OAKF,GAFA+M,EAAKknI,GAALpwJ,MAAuB,GAEI,QAA3BozJ,EAAIh0J,EAAAywJ,GAAA7vJ,KAAK6yJ,WAAkB,IAAAO,GAAvBA,EAAyB9yG,SAE3B,YADAtgD,KAAKqzJ,oBAAoBr5I,GAI3B,MAAMwO,EAASoB,EAAKinI,GAAL7wJ,MAAgBiwC,YAC/B/mB,EAAK6mI,GAAL/vJ,MAAoBwoB,GAAUA,EAAO2U,UACvC,CAEAk2H,mBAAAA,CAAoBr5I,GAIlB,GAHAha,KAAKmc,IAAI6nB,MAAM,CACb2oB,eAAe,IAEb/iC,EAAK2mI,GAALvwJ,MAEF,YADAZ,EAAAywJ,GAAA7vJ,KAAK6yJ,IAAmBxY,aAAar6I,KAAM4pB,EAAKinI,GAAL7wJ,OAAiB,EAAOga,GAIrE4P,EAAKinI,GAAL7wJ,MAAgB6gC,yBAAyB7gC,MACzCkpB,EAAKqnI,GAALvwJ,KAAkB,IAAIi9B,iBACtB,MAAMtT,EAASC,EAAKinI,GAAL7wJ,MAAgBw/B,eAAe5V,EAAK2mI,GAALvwJ,OAC9CA,KAAKmc,IAAIpC,iBACP,OACAu5I,IAAuB,IAAtB,cAAE9wG,GAAe8wG,EACZ9wG,IAAkBxiD,KAAKmc,IAAI4e,SAASynB,KACtCt5B,EAAKsnI,GAALxwJ,KAAuB,MACvBA,KAAK0kC,mBAGT,CAAE/a,WAEJvqB,EAAAywJ,GAAA7vJ,KAAK6yJ,IAAmBxY,aAAar6I,KAAM4pB,EAAKinI,GAAL7wJ,OAAiB,EAAOga,EACrE,CAEAu5I,KAAAA,CAAMnwH,GACJ,GAAIA,EAAI,CACN,MAAM,cAAEpI,GAAkBjf,SAI1B,YAHI/b,KAAKmc,IAAI4e,SAASC,IACpB9R,EAAKsnI,GAALxwJ,KAAuBg7B,GAG3B,CACIpR,EAAK4mI,GAALxwJ,OACFgtC,WAAW,KAAM,IAAAwmH,EACK,QAApBA,EAAA5pI,EAAK4mI,GAALxwJ,aAAoB,IAAAwzJ,GAApBA,EAAsBxvH,QACtB9a,EAAKsnI,GAALxwJ,KAAuB,OACtB,EAEP,CAEAquC,iBAAAA,GAAqC,IAAnBgtG,EAASl8I,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GACzB,OAAKyqB,EAAK2mI,GAALvwJ,OAGL4pB,EAAKinI,GAAL7wJ,MAAgB6gC,yBAAyB,MACzCjX,EAAK2mI,GAALvwJ,MAAgBm/B,QAChBjW,EAAKqnI,GAALvwJ,KAAkB,MAClBkpB,EAAKsnI,GAALxwJ,KAAuB,MAChBZ,EAAAywJ,GAAA7vJ,KAAK6yJ,IAAmB/0E,WAAWu9D,IANjC,IAOX,CASAh4F,aAAAA,CAAc76B,EAAQ1S,EAAGC,GACvB,MAAMqpB,EAAQxV,EAAKinI,GAAL7wJ,MAAgBikC,WAAWnuB,EAAGC,GAC5C,OAAc,OAAVqpB,GAAkBA,IAAUp/B,OAGhCo/B,EAAM0Q,aAAatnB,IACZ,EACT,CAEAkc,cAAAA,GACE,QAAI9a,EAAK2mI,GAALvwJ,QACFA,KAAKquC,qBACE,EAGX,CAEA3Q,eAAAA,GACO9T,EAAK2mI,GAALvwJ,OAGLZ,EAAAywJ,GAAA7vJ,KAAK6yJ,IAAmB7Y,2BAA2Bh6I,KACrD,CAKAmtB,OAAAA,GAAU,IAAAsmI,EACRzzJ,KAAK0kC,kBAC0B,QAA3B+uH,EAAA7pI,EAAKinI,GAAL7wJ,MAAgBiwC,mBAAW,IAAAwjH,OAAA,EAA3BA,EAA6B92I,UAAW3c,OAE1C4pB,EAAKinI,GAAL7wJ,MAAgB0kC,iBAChB9a,EAAKinI,GAAL7wJ,MAAgBstC,gBAAgB,OAG9B1jB,EAAKsmI,GAALlwJ,QACFu/B,aAAa3V,EAAKsmI,GAALlwJ,OACbkpB,EAAKgnI,GAALlwJ,KAA6B,OAG/B,IAAK,MAAMwoB,KAAUoB,EAAKumI,GAALnwJ,MAAcq/B,SAAU,KAAAq0H,EACjB,QAA1BA,EAAA9pI,EAAKkmI,GAAL9vJ,aAA0B,IAAA0zJ,GAA1BA,EAA4BruB,yBAAyB78G,EAAO8kC,YAC5D9kC,EAAO05B,UAAU,MACjB15B,EAAO23B,iBAAkB,EACzB33B,EAAOrM,IAAI2O,QACb,CACA9qB,KAAKmc,IAAM,KACXyN,EAAKumI,GAALnwJ,MAAcs/B,QACd1V,EAAKinI,GAAL7wJ,MAAgB4pC,YAAY5pC,KAC9B,CAiBAyb,MAAAA,CAAMk4I,GAAe,IAAd,SAAEt3I,GAAUs3I,EACjB3zJ,KAAKqc,SAAWA,EAChB8H,GAAmBnkB,KAAKmc,IAAKE,GAC7B,IAAK,MAAMmM,KAAUoB,EAAKinI,GAAL7wJ,MAAgB0sC,WAAW1sC,KAAKyhC,WACnDzhC,KAAKhB,IAAIwpB,GACTA,EAAOqnB,UAIT7vC,KAAK6pC,YACP,CAMA1sB,MAAAA,CAAMy2I,GAAe,IAAd,SAAEv3I,GAAUu3I,EAIjBhqI,EAAKinI,GAAL7wJ,MAAgB0kC,iBAChBxlC,EAAA2wJ,GAAA7vJ,KAAKg7I,IAAQ3pI,KAAbrR,MAEA,MAAM6zJ,EAAc7zJ,KAAKqc,SAAS+C,SAC5BA,EAAW/C,EAAS+C,SAI1B,GAFApf,KAAKqc,SAAWA,EAChB8H,GAAmBnkB,KAAKmc,IAAK,CAAEiD,aAC3By0I,IAAgBz0I,EAClB,IAAK,MAAMoJ,KAAUoB,EAAKumI,GAALnwJ,MAAcq/B,SACjC7W,EAAOuhC,OAAO3qC,EAGpB,CAMA,kBAAI6gC,GACF,MAAM,UAAE7/B,EAAS,WAAEC,GAAergB,KAAKqc,SAAS6D,QAChD,MAAO,CAACE,EAAWC,EACrB,CAEA,SAAIlB,GACF,OAAOyK,EAAKinI,GAAL7wJ,MAAgBm+B,eAAeC,SACxC,EACF,SAAAqzH,GAAAqC,GAj0BI,OAA8B,IAAvBlqI,EAAKumI,GAAQ2D,GAACrjI,KACjB7G,EAAKumI,GAAQ2D,GAACz0H,SACdzV,EAAKinI,GAAUiD,GAACpnH,WAAWonH,EAAKryH,UACtC,UAAA0wH,GAkNsBn4I,GAGpB4P,EAAKinI,GAAL7wJ,MAAgBi8B,cAChB,MAAM,OAAE/hB,GAAWF,EACnB,GACEE,IAAW0P,EAAK6mI,GAALzwJ,MAAgBmc,MACO,QAAhCjC,EAAOM,aAAa,SACpBN,EAAO8N,UAAU+S,SAAS,kBAC1BnR,EAAK6mI,GAALzwJ,MAAgBmc,IAAI4e,SAAS7gB,GAC/B,CACA,MAAM,MAAEtJ,GAAUtB,GAAYgB,SAC9B,GAAqB,IAAjB0J,EAAMkR,QAAiBlR,EAAMwc,SAAW5lB,EAE1C,OAEFgZ,EAAKinI,GAAL7wJ,MAAgB6lC,eACd,aACA,GACqB,GAEvBjc,EAAK6mI,GAALzwJ,MAAgBmc,IAAI6L,UAAUhpB,IAAI,QAClCgB,KAAKuyC,gBACLo/F,GAAgBoD,kBACd/0I,KAC8B,QAA9B4pB,EAAKinI,GAAL7wJ,MAAgBqqB,UAChB,CAAEnQ,OAAQ0P,EAAK6mI,GAALzwJ,MAAgBmc,IAAKrG,EAAGkE,EAAMlE,EAAGC,EAAGiE,EAAMjE,IAEtD6T,EAAK6mI,GAALzwJ,MAAgBmc,IAAIpC,iBAClB,YACA,KACE6P,EAAK6mI,GAALzwJ,MAAgBmc,IAAI6L,UAAU8C,OAAO,QACrC9qB,KAAKuyC,eAAc,IAErB,CAAE9O,MAAM,EAAM9Z,OAAQC,EAAKinI,GAAL7wJ,MAAgB8pB,UAExC9P,EAAMqI,gBACR,CACF,UAAAwwI,GAAAkB,GAyLE,OAA6BhD,GAAYnuI,EAACtjB,IAAIsqB,EAAKinI,GAAUkD,GAAC3jH,UAChE,UAAA2iH,GAWiB9kH,GACf,MAAMhjB,EAAa7rB,EAAAywJ,GAAA7vJ,KAAK6yJ,IACxB,OAAO5nI,EAAa,IAAIA,EAAW/qB,UAAUsN,YAAYygC,GAAU,IACrE,UAAA6kH,KA0EE,MAAM,EAAEh9I,EAAC,EAAEC,EAAC,MAAEiK,EAAK,OAAEC,GAAWjgB,KAAK83C,mBAC/B6oC,EAAM/xE,KAAKiG,IAAI,EAAGiB,GAClB+qE,EAAMjyE,KAAKiG,IAAI,EAAGkB,GAGlByJ,GAAWmhE,EAFL/xE,KAAKC,IAAIiX,OAAOgkC,WAAYh0C,EAAIkK,IAEd,EAAIlK,EAC5B2J,GAAWohE,EAFLjyE,KAAKC,IAAIiX,OAAO+jC,YAAa9zC,EAAIkK,IAEf,EAAIlK,GAC3BsJ,EAASC,GACdtf,KAAKqc,SAAS+C,SAAW,MAAQ,EAC7B,CAACI,EAASC,GACV,CAACA,EAASD,GAEhB,MAAO,CAAEH,UAASC,UACpB,UAAA07H,KA6OE,IAAK,MAAMxyH,KAAUoB,EAAKumI,GAALnwJ,MAAcq/B,SAC7B7W,EAAO2U,WACT3U,EAAOsC,QAGb,EAAAjM,EAAAA,EAAAA,GAp8BI8wI,GAAqB,gBAiCH,GAAK,IAAAoB,GAAA,CAAAnuI,EAEL,IAAIyE,IACxB,CACE0/G,GACAia,GACAkK,GACAvZ,GACAkY,IACAhmI,IAAIrjB,GAAQ,CAACA,EAAKwqC,YAAaxqC,M,4DCnFrC,MAAMwzJ,GASJxmJ,WAAAA,CAAWymJ,GAAgB,IAAf,UAAExyH,GAAWwyH,EAAAn1J,EAAA,KAAAo1J,IARzBj1J,EAAA,KAAAk1J,GAAU,MAEVl1J,EAAA,KAAAm1J,GAAW,IAAI/sI,KAEfpoB,EAAA,KAAAo1J,GAAY,IAAIhtI,KAKdrnB,KAAKyhC,UAAYA,CACnB,CAEAygB,SAAAA,CAAUvlC,GACR,GAAKiN,EAAKuqI,GAALn0J,OAKL,GAAI4pB,EAAKuqI,GAALn0J,QAAiB2c,EAAQ,CAC3B,GAAIiN,EAAKwqI,GAALp0J,MAAcywB,KAAO,EACvB,IAAK,MAAM7U,KAAQgO,EAAKwqI,GAALp0J,MAAcq/B,SAC/BzjB,EAAKkP,SACLnO,EAAOP,OAAOR,GAGlBsN,EAAKirI,GAALn0J,KAAe2c,EACjB,OAZEuM,EAAKirI,GAALn0J,KAAe2c,EAanB,CAEA,sBAAW23I,GACT,OAAOxnJ,GAAO9M,KAAM,cAAe,IAAI8pH,GACzC,CA0CAyrB,IAAAA,CAAKpyD,GAAsD,IAAAoxE,EAAAC,EAAA,IAA1CC,EAAet1J,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAAUu1J,EAAOv1J,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,IAAAA,UAAA,GAC/C,MAAMsa,GAAek7I,GAAG/xI,GAAA2xI,EAAHI,GAAG/xI,EAAA4xI,EAAAD,IAAAA,GAAAC,GAClB54I,EAAO1c,EAAAg1J,GAAAl0J,KAAK6pH,IAAUx4G,KAAfrR,MAEPgxH,EAAOgjC,GAAUM,YAAYt4I,cAAc,QACjDJ,EAAKQ,OAAO40G,GACZ,MAAM7oG,EAAO6rI,GAAUM,YAAYt4I,cAAc,QACjDg1G,EAAK50G,OAAO+L,GACZ,MAAMysI,EAAS,SAAH5pJ,OAAYhL,KAAKyhC,UAAS,KAAAz2B,OAAIyO,GAC1C0O,EAAK/N,aAAa,KAAMw6I,GACxBzsI,EAAK/N,aAAa,gBAAiB,sBAE/Bq6I,GACF7qI,EAAKyqI,GAALr0J,MAAexB,IAAIib,EAAI0O,GAIzB,MAAMktH,EAAaqf,EAAUx1J,EAAAg1J,GAAAl0J,KAAK60J,IAAexjJ,KAApBrR,KAAqBgxH,EAAM4jC,GAAU,KAE5DE,EAAMd,GAAUM,YAAYt4I,cAAc,OAOhD,OANAJ,EAAKQ,OAAO04I,GACZA,EAAI16I,aAAa,OAAQ,IAAFpP,OAAM4pJ,IAC7B50J,KAAK6zI,iBAAiBj4H,EAAMunE,GAE5Bv5D,EAAKwqI,GAALp0J,MAAcxB,IAAIib,EAAImC,GAEf,CAAEnC,KAAI47H,WAAY,QAAFrqI,OAAUqqI,EAAU,KAC7C,CAEAW,WAAAA,CAAY7yD,EAAY4xE,GAA6B,IAAAC,EAAAC,EAKnD,MAAMx7I,GAAek7I,GAAG/xI,GAAAoyI,EAAHL,GAAG/xI,EAAAqyI,EAAAD,IAAAA,GAAAC,GAClBr5I,EAAO1c,EAAAg1J,GAAAl0J,KAAK6pH,IAAUx4G,KAAfrR,MACPgxH,EAAOgjC,GAAUM,YAAYt4I,cAAc,QACjDJ,EAAKQ,OAAO40G,GACZ,MAAM7oG,EAAO6rI,GAAUM,YAAYt4I,cAAc,QACjDg1G,EAAK50G,OAAO+L,GACZ,MAAMysI,EAAS,SAAH5pJ,OAAYhL,KAAKyhC,UAAS,KAAAz2B,OAAIyO,GAI1C,IAAIy7I,EACJ,GAJA/sI,EAAK/N,aAAa,KAAMw6I,GACxBzsI,EAAK/N,aAAa,gBAAiB,sBAG/B26I,EAA6B,CAC/B,MAAMlyE,EAAOmxE,GAAUM,YAAYt4I,cAAc,QACjDg1G,EAAK50G,OAAOymE,GACZqyE,EAAS,SAAHlqJ,OAAYhL,KAAKyhC,UAAS,KAAAz2B,OAAIyO,GACpCopE,EAAKzoE,aAAa,KAAM86I,GACxBryE,EAAKzoE,aAAa,YAAa,qBAC/B,MAAMzG,EAAOqgJ,GAAUM,YAAYt4I,cAAc,QACjD6mE,EAAKzmE,OAAOzI,GACZA,EAAKyG,aAAa,QAAS,KAC3BzG,EAAKyG,aAAa,SAAU,KAC5BzG,EAAKyG,aAAa,OAAQ,SAC1B,MAAM06I,EAAMd,GAAUM,YAAYt4I,cAAc,OAChD6mE,EAAKzmE,OAAO04I,GACZA,EAAI16I,aAAa,OAAQ,IAAFpP,OAAM4pJ,IAC7BE,EAAI16I,aAAa,SAAU,QAC3B06I,EAAI16I,aAAa,OAAQ,SACzB06I,EAAI16I,aAAa,YAAa,WAC9B06I,EAAI9sI,UAAUhpB,IAAI,OACpB,CAEA,MAAMm2J,EAAOnB,GAAUM,YAAYt4I,cAAc,OACjDJ,EAAKQ,OAAO+4I,GACZA,EAAK/6I,aAAa,OAAQ,IAAFpP,OAAM4pJ,IAC1BM,GACFC,EAAK/6I,aAAa,OAAQ,QAAFpP,OAAUkqJ,EAAM,MAE1C,MAAME,EAAOD,EAAKE,YASlB,OARAz5I,EAAKQ,OAAOg5I,GACZD,EAAKntI,UAAUhpB,IAAI,eACnBo2J,EAAKptI,UAAUhpB,IAAI,oBAEnBgB,KAAK6zI,iBAAiBj4H,EAAMunE,GAE5Bv5D,EAAKwqI,GAALp0J,MAAcxB,IAAIib,EAAImC,GAEfnC,CACT,CAEAs8H,YAAAA,CAAat8H,EAAI0pE,GACfv5D,EAAKyqI,GAALr0J,MAAeqrB,OAAO5R,GACtBzZ,KAAK6zI,iBAAiBp6H,EAAI0pE,EAC5B,CAEA0wD,gBAAAA,CAAiByhB,EAAanyE,GAC5B,IAAKA,EACH,OAEF,MAAM,KAAEvnE,EAAI,KAAEo/C,EAAI,UAAEw5E,EAAS,KAAErsH,GAASg7D,EAClCzpE,EACmB,kBAAhB47I,EACH1rI,EAAKwqI,GAALp0J,MAAcV,IAAIg2J,GAClBA,EACN,GAAK57I,EAAL,CASA,GANIkC,GACF1c,EAAAg1J,GAAAl0J,KAAKu1J,IAAiBlkJ,KAAtBrR,KAAuB0Z,EAASkC,GAE9Bo/C,GACFw6F,GAAiBnkJ,KAAjB2iJ,GAAkBt6I,EAASshD,GAEzBw5E,EAAW,CACb,MAAM,UAAExsH,GAActO,EACtB,IAAK,MAAOgO,EAAW5nB,KAAUxB,OAAO6c,QAAQq5H,GAC9CxsH,EAAUqc,OAAO3c,EAAW5nB,EAEhC,CACA,GAAIqoB,EAAM,CACR,MACMstI,EADO/7I,EAAQqO,kBACIA,kBACzB7oB,EAAAg1J,GAAAl0J,KAAKu1J,IAAiBlkJ,KAAtBrR,KAAuBy1J,EAAattI,EACtC,CAjBA,CAkBF,CAEAi0H,YAAAA,CAAa3iI,EAAI2lB,GACf,GAAIA,IAAUp/B,KACZ,OAEF,MAAM4b,EAAOgO,EAAKwqI,GAALp0J,MAAcV,IAAIma,GAC1BmC,IAGLgO,EAAMuqI,GAAN/0H,GAAchjB,OAAOR,GACrBgO,EAAKwqI,GAALp0J,MAAcqrB,OAAO5R,GACrBmQ,EAAMwqI,GAANh1H,GAAe5gC,IAAIib,EAAImC,GACzB,CAEAkP,MAAAA,CAAOrR,GACLmQ,EAAKyqI,GAALr0J,MAAeqrB,OAAO5R,GACD,OAAjBmQ,EAAKuqI,GAALn0J,QAGJ4pB,EAAKwqI,GAALp0J,MAAcV,IAAIma,GAAIqR,SACtBlB,EAAKwqI,GAALp0J,MAAcqrB,OAAO5R,GACvB,CAEA0T,OAAAA,GACEjE,EAAKirI,GAALn0J,KAAe,MACf,IAAK,MAAM4b,KAAQgO,EAAKwqI,GAALp0J,MAAcq/B,SAC/BzjB,EAAKkP,SAEPlB,EAAKwqI,GAALp0J,MAAcs/B,QACd1V,EAAKyqI,GAALr0J,MAAes/B,OACjB,EA9Na,SAAAk2H,GAkCE97I,EAAOg8I,GAAyB,IAAtB5/I,EAAGC,EAAGiK,EAAOC,GAAOy1I,EAC3C,MAAM,MAAEr6I,GAAU3B,EAClB2B,EAAMkP,IAAM,GAAHvf,OAAM,IAAM+K,EAAC,KACtBsF,EAAMooC,KAAO,GAAHz4C,OAAM,IAAM8K,EAAC,KACvBuF,EAAM2E,MAAQ,GAAHhV,OAAM,IAAMgV,EAAK,KAC5B3E,EAAM4E,OAAS,GAAHjV,OAAM,IAAMiV,EAAM,IAChC,UAAA4pG,KAGE,MAAM98C,EAAMinF,EAAUM,YAAYx7I,OAAO,EAAG,GAA0B,GAItE,OAHA8Q,EAAKuqI,GAALn0J,MAAaoc,OAAO2wD,GACpBA,EAAI3yD,aAAa,eAAe,GAEzB2yD,CACT,UAAA8nF,GAEgB7jC,EAAM4jC,GACpB,MAAM3jC,EAAW+iC,EAAUM,YAAYt4I,cAAc,YACrDg1G,EAAK50G,OAAO60G,GACZ,MAAMokB,EAAa,QAAHrqI,OAAW4pJ,GAC3B3jC,EAAS72G,aAAa,KAAMi7H,GAC5BpkB,EAAS72G,aAAa,gBAAiB,qBACvC,MAAMu7I,EAAc3B,EAAUM,YAAYt4I,cAAc,OAKxD,OAJAi1G,EAAS70G,OAAOu5I,GAChBA,EAAYv7I,aAAa,OAAQ,IAAFpP,OAAM4pJ,IACrCe,EAAY3tI,UAAUhpB,IAAI,QAEnBq2I,CACT,UAAAkgB,GAEkB77I,EAASypE,GACzB,IAAK,MAAOjoE,EAAKpb,KAAUxB,OAAO6c,QAAQgoE,GAC1B,OAAVrjF,EACF4Z,EAAQY,gBAAgBY,GAExBxB,EAAQU,aAAac,EAAKpb,EAGhC,CAuJF81J,EA/NM5B,GAwEJ,IAAAW,GAAA,CAAA/xI,EAjEa,GC2Db1R,WAAW2kJ,mBAAqB,CAC9BvmB,kBAAiBA,IAIrBp+H,WAAW4kJ,SAAW,CACpB3nJ,eAAcA,GACdwhJ,sBAAqBA,GACrBhuJ,2BAA0BA,EAC1BT,qBAAoBA,EACpBy5B,0BAAyBA,GACzBmpG,gBAAeA,GACfljI,eAAcA,EACdmC,eAAcA,GACdgzJ,arDwrBF,SAAsB33J,EAAG0T,EAAGC,EAAG0wB,GAE7B,MAAMggD,EAAQ,KAAO,GADrBhgD,EAAU7zB,KAAKC,IAAID,KAAKiG,IAAW,OAAP4tB,QAAO,IAAPA,EAAAA,EAAW,EAAG,GAAI,KAK9C,MAAO,CAHPrkC,EAAIwQ,KAAK21C,MAAMnmD,EAAIqkC,EAAUggD,GAC7B3wE,EAAIlD,KAAK21C,MAAMzyC,EAAI2wB,EAAUggD,GAC7B1wE,EAAInD,KAAK21C,MAAMxyC,EAAI0wB,EAAUggD,GAE/B,EqD9rBEw7D,MnB6tGkC,YmB5tGlCp6B,YAAWA,GACXv4G,uBAAsBA,GACtB0qJ,arDqqBF,MACE,iCAAWC,GACT,MAAMv8I,EAAUqC,SAASC,cAAc,QACvCtC,EAAQsO,UAAUhpB,IAAI,UAAW,WACjC,MAAM,MAAEqc,GAAU3B,EAClB2B,EAAM2E,MAAQ3E,EAAM4E,OAAS,IAC7B5E,EAAMy0G,QAAU,OAChBz0G,EAAMsI,MAAQ,0BACd5H,SAASib,KAAK5a,OAAO1C,GACrB,MAAM,MAAEiK,GAAUmC,OAAOoR,iBAAiBxd,GAE1C,OADAA,EAAQoR,SACDhe,GAAO9M,KAAM,yBAA0B0jB,GAAOC,GACvD,GqDhrBAmmG,cAAaA,GACbkqC,UAASA,GACTkC,YAAW5mJ,GACXkO,UAASA,GACT24I,kBrD8xBF,SAA2Bx2B,EAAWy2B,GACpC,MAAMl7I,EACJykH,EAAU,GACK,IAAfA,EAAU,GACK,MAAfA,EAAU,GACM,SAAhBy2B,EAAW,GACK,WAAhBA,EAAW,GACK,cAAhBA,EAAW,GACb,IAAIC,EAAcjvI,GAAc9nB,IAAI4b,GACpC,GAAIm7I,EACF,OAAOA,EAET,MAAM/mF,EAAQ,IAAIlO,aAAa,GACzBxtD,EAAS07D,EAAMvgE,SAAS,EAAG,GAC3BunJ,EAAUhnF,EAAMvgE,SAAS,EAAG,GAClCyX,GAASm5G,EAAW22B,GACpB,MAAMC,EAAWjnF,EAAMvgE,SAAS,EAAG,GACnCyX,GAAS4vI,EAAYG,GACrB,MAAMC,EAAmBD,EAAS,GAAK,GAKjCE,EAAcD,EAAmB,GAAK,IAM5C,GAJAF,EAAQ,GAAKE,EACT5nJ,KAAKuG,KAAKmhJ,EAAQ,IAClB,EAAI1nJ,KAAKuG,KAAK,EAAImhJ,EAAQ,IAE1BvvI,GAAcuvI,EAASC,EAAU3iJ,GAAU6iJ,EAAa,CAC1D,IAAI10I,EAAOC,EACPw0I,GACFz0I,EAAQu0I,EAAQ,GAChBt0I,EAAM,IAEND,EAAQ,EACRC,EAAMs0I,EAAQ,IAEhB,MAAMpW,EAAY,KAClB,KAAOl+H,EAAMD,EAAQm+H,GAAW,CAC9B,MAAMwW,EAAOJ,EAAQ,IAAMv0I,EAAQC,GAAO,EAExCw0I,IACAzvI,GAAcuvI,EAASC,EAAU3iJ,GAAU6iJ,EAE3C10I,EAAQ20I,EAER10I,EAAM00I,CAEV,CACAJ,EAAQ,GAAKE,EAAmBx0I,EAAMD,CACxC,CASA,OAPA4E,GAAS2vI,EAAS1iJ,GAClByiJ,EAAczkJ,GAAKC,aACjBjD,KAAK21C,MAAkB,IAAZ3wC,EAAO,IAClBhF,KAAK21C,MAAkB,IAAZ3wC,EAAO,IAClBhF,KAAK21C,MAAkB,IAAZ3wC,EAAO,KAEpBwT,GAAc5oB,IAAI0c,EAAKm7I,GAChBA,CACT,EqD11BErnD,YAAWA,GACX2nD,mBrDgNF,SAA4BprJ,GAE1B,OADCA,GAAOA,EAAIsB,MAAM,OAAQ,GACnBtB,EAAI4V,UAAU5V,EAAImyI,YAAY,KAAO,EAC9C,EqDlNEkZ,sBrD2NF,SAA+BrrJ,GAAuC,IAAlCsrJ,EAAe13J,UAAAd,OAAA,QAAAoN,IAAAtM,UAAA,GAAAA,UAAA,GAAG,eACpD,GAAmB,kBAARoM,EACT,OAAOsrJ,EAET,GAAI71I,GAAazV,GAEf,OADAN,GAAK,sEACE4rJ,EAGT,MAqBMC,EArBSC,KACb,IACE,OAAO,IAAI3qJ,IAAI2qJ,EACjB,CAAE,MAAAC,GACA,IACE,OAAO,IAAI5qJ,IAAIJ,mBAAmB+qJ,GACpC,CAAE,MAAAE,GACA,IAEE,OAAO,IAAI7qJ,IAAI2qJ,EAAW,kBAC5B,CAAE,MAAAG,GACA,IACE,OAAO,IAAI9qJ,IAAIJ,mBAAmB+qJ,GAAY,kBAChD,CAAE,MAAAI,GACA,OAAO,IACT,CACF,CACF,CACF,GAGaC,CAAO7rJ,GACtB,IAAKurJ,EAEH,OAAOD,EAGT,MAAMhlI,EAAStkB,IACb,IACE,IAAI8pJ,EAAUrrJ,mBAAmBuB,GACjC,OAAI8pJ,EAAQ3mJ,SAAS,MACnB2mJ,EAAUA,EAAQxqJ,MAAM,KAAK+P,IAAI,GAC7By6I,EAAQ91I,KAAK,YACR81I,EAEF9pJ,GAEF8pJ,CACT,CAAE,MAAAC,GACA,OAAO/pJ,CACT,GAGIgqJ,EAAW,UACXj2I,EAAWw1I,EAAOU,SAAS3qJ,MAAM,KAAK+P,IAAI,GAChD,GAAI26I,EAASh2I,KAAKD,GAChB,OAAOuQ,EAAOvQ,GAGhB,GAAIw1I,EAAOW,aAAahnI,KAAO,EAAG,CAChC,MAAM4O,EAAS9tB,MAAMC,KAAKslJ,EAAOW,aAAap4H,UAAUoB,UACxD,IAAK,MAAM3gC,KAASu/B,EAClB,GAAIk4H,EAASh2I,KAAKzhB,GAEhB,OAAO+xB,EAAO/xB,GAGlB,MAAM2R,EAAOF,MAAMC,KAAKslJ,EAAOW,aAAahmJ,QAAQgvB,UACpD,IAAK,MAAMvlB,KAAOzJ,EAChB,GAAI8lJ,EAASh2I,KAAKrG,GAEhB,OAAO2W,EAAO3W,EAGpB,CAEA,GAAI47I,EAAOrqJ,KAAM,CACf,MACMirJ,EADa,gCACa30I,KAAK+zI,EAAOrqJ,MAC5C,GAAIirJ,EACF,OAAO7lI,EAAO6lI,EAAa,GAE/B,CAEA,OAAOb,CACT,EqD9SEnzI,OAAMA,GACNrM,QAAOA,GACPsgJ,mBrDycF,SAA4BC,EAAOC,GAA+B,IAA7B,MAAE14I,EAAQ,EAAC,SAAEC,EAAW,GAAGy4I,EAC9D,MAAM,MAAE73I,EAAK,OAAEC,GAAW23I,EAAQz+I,WAAWkC,MACvC4D,EAAU,CAAC,EAAG,EAAGgE,SAASjD,GAAQiD,SAAShD,IAEjD,OAAO,IAAIlB,GAAa,CACtBE,UACAC,SAAU,EACVC,QACAC,YAEJ,EqDldE65E,oBAAmBA,GACnB6+D,UAASn1J,GACTmL,oBAAmBA,GACnBkT,aAAYA,GACZK,UAASA,GACTqhD,oBAAmBA,GACnB/qD,UAASA,GACTyK,cAAaA,GACb21I,iBxDigCF,SAA0B5oJ,GAYxB,OAXKgI,KAOHA,GACE,kUACFC,GAAmB,IAAIiQ,IAAI,CAAC,CAAC,SAAK,cAE7BlY,EAAI4zF,WAAW5rF,GAAgB,CAACyL,EAAG3P,EAAI8lE,IAC5C9lE,EAAKA,EAAGw1H,UAAU,QAAUrxH,GAAiB9X,IAAIy5E,GAErD,EwD/gCEr0E,IAAGA,GACHigB,YAAWA,GACXqzI,kBxDsOwB,CACxBC,cAAe,EACfC,mBAAoB,GwDvOpBtoD,sBAAqBA,GACrBptF,cAAaA,GACbstF,UAASA,GACTqoD,exDnCqB,CACrBC,MAAO,EACPC,gBAAiB,EACjBC,KAAM,GACNC,mBAAoB,GACpBC,uBAAwB,IACxBC,uBAAwB,IACxBC,SAAU,KACVC,mBAAoB,MwD4BpBr7I,cAAaA,GACbwD,4BAA2BA,GAC3BwG,eAAcA,GACdvZ,kBAAiBA,GACjBoW,mBAAkBA,GAClBrX,OAAMA,GACNs0I,mBAAkBA,GAClB9+H,UAASA,GACT4D,wBAAuBA,GACvBilF,UAASA,GACT5xD,aAAYA,GACZ/sC,cAAaA,GACboF,KAAIA,GACJtN,eAAcA,GACd4gJ,QnB6qGkC,UmB5qGlC5rI,SAAQA,G","sources":["../node_modules/@babel/runtime/helpers/esm/toSetter.js","../node_modules/@babel/runtime/helpers/esm/checkPrivateRedeclaration.js","../node_modules/@babel/runtime/helpers/esm/classPrivateMethodInitSpec.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js","../node_modules/@babel/runtime/helpers/esm/assertClassBrand.js","../node_modules/@babel/runtime/helpers/esm/classPrivateGetter.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js","../node_modules/@babel/runtime/helpers/esm/asyncIterator.js","../pdf.js/src/shared/util.js","../pdf.js/src/display/xfa_text.js","../pdf.js/src/display/xfa_layer.js","../pdf.js/src/display/display_utils.js","../pdf.js/src/display/editor/toolbar.js","../pdf.js/src/display/editor/tools.js","../pdf.js/src/display/editor/alt_text.js","../pdf.js/src/display/editor/comment.js","../pdf.js/src/display/touch_manager.js","../pdf.js/src/display/editor/editor.js","../pdf.js/src/shared/murmurhash3.js","../pdf.js/src/display/annotation_storage.js","../pdf.js/src/display/font_loader.js","../pdf.js/src/shared/obj-bin-transform.js","../pdf.js/src/display/api_utils.js","../pdf.js/src/shared/message_handler.js","../pdf.js/src/display/canvas_factory.js","../pdf.js/src/display/cmap_reader_factory.js","../pdf.js/src/display/filter_factory.js","../pdf.js/src/display/standard_fontdata_factory.js","../pdf.js/src/display/wasm_factory.js","../pdf.js/src/display/node_utils.js","../pdf.js/src/display/canvas_dependency_tracker.js","../pdf.js/src/display/pattern_helper.js","../pdf.js/src/shared/image_utils.js","../pdf.js/src/display/canvas.js","../pdf.js/src/display/worker_options.js","../pdf.js/src/display/metadata.js","../pdf.js/src/display/optional_content_config.js","../pdf.js/src/display/transport_stream.js","../pdf.js/src/display/network_utils.js","../pdf.js/src/display/content_disposition.js","../pdf.js/src/display/fetch_stream.js","../pdf.js/src/display/network.js","../pdf.js/src/display/node_stream.js","../pdf.js/src/display/pdf_objects.js","../pdf.js/src/display/text_layer.js","../pdf.js/src/display/api.js","../pdf.js/src/display/editor/color_picker.js","../pdf.js/src/shared/scripting_utils.js","../pdf.js/src/display/svg_factory.js","../pdf.js/src/display/annotation_layer.js","../pdf.js/src/display/editor/freetext.js","../pdf.js/src/display/editor/drawers/outline.js","../pdf.js/src/display/editor/drawers/freedraw.js","../pdf.js/src/display/editor/drawers/highlight.js","../pdf.js/src/display/editor/highlight.js","../pdf.js/src/display/editor/draw.js","../pdf.js/src/display/editor/drawers/inkdraw.js","../pdf.js/src/display/editor/ink.js","../pdf.js/src/display/editor/drawers/contour.js","../pdf.js/src/display/editor/drawers/signaturedraw.js","../pdf.js/src/display/editor/signature.js","../pdf.js/src/display/editor/stamp.js","../pdf.js/src/display/editor/annotation_editor_layer.js","../pdf.js/src/display/draw_layer.js","../pdf.js/src/pdf.js"],"sourcesContent":["function _toSetter(t, e, n) {\n  e || (e = []);\n  var r = e.length++;\n  return Object.defineProperty({}, \"_\", {\n    set: function set(o) {\n      e[r] = o, t.apply(n, e);\n    }\n  });\n}\nexport { _toSetter as default };","function _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nexport { _checkPrivateRedeclaration as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateMethodInitSpec(e, a) {\n  checkPrivateRedeclaration(e, a), a.add(e);\n}\nexport { _classPrivateMethodInitSpec as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nexport { _classPrivateFieldInitSpec as default };","function _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nexport { _assertClassBrand as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateGetter(s, r, a) {\n  return a(assertClassBrand(s, r));\n}\nexport { _classPrivateGetter as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(assertClassBrand(s, a));\n}\nexport { _classPrivateFieldGet2 as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(assertClassBrand(s, a), r), r;\n}\nexport { _classPrivateFieldSet2 as default };","function _asyncIterator(r) {\n  var n,\n    t,\n    o,\n    e = 2;\n  for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) {\n    if (t && null != (n = r[t])) return n.call(r);\n    if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));\n    t = \"@@asyncIterator\", o = \"@@iterator\";\n  }\n  throw new TypeError(\"Object is not async iterable\");\n}\nfunction AsyncFromSyncIterator(r) {\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\"));\n    var n = r.done;\n    return Promise.resolve(r.value).then(function (r) {\n      return {\n        value: r,\n        done: n\n      };\n    });\n  }\n  return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) {\n    this.s = r, this.n = r.next;\n  }, AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function next() {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    \"return\": function _return(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.resolve({\n        value: r,\n        done: !0\n      }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    },\n    \"throw\": function _throw(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    }\n  }, new AsyncFromSyncIterator(r);\n}\nexport { _asyncIterator as default };","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\n// NW.js / Electron is a browser context, but copies some Node.js objects; see\n// http://docs.nwjs.io/en/latest/For%20Users/Advanced/JavaScript%20Contexts%20in%20NW.js/#access-nodejs-and-nwjs-api-in-browser-context\n// https://www.electronjs.org/docs/api/process#processversionselectron-readonly\n// https://www.electronjs.org/docs/api/process#processtype-readonly\nconst isNodeJS =\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n  typeof process === \"object\" &&\n  process + \"\" === \"[object process]\" &&\n  !process.versions.nw &&\n  !(process.versions.electron && process.type && process.type !== \"browser\");\n\nconst FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\n\n// Represent the percentage of the height of a single-line field over\n// the font size. Acrobat seems to use this value.\nconst LINE_FACTOR = 1.35;\nconst LINE_DESCENT_FACTOR = 0.35;\nconst BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;\n\n/**\n * Refer to the `WorkerTransport.getRenderingIntent`-method in the API, to see\n * how these flags are being used:\n *  - ANY, DISPLAY, and PRINT are the normal rendering intents, note the\n *    `PDFPageProxy.{render, getOperatorList, getAnnotations}`-methods.\n *  - SAVE is used, on the worker-thread, when saving modified annotations.\n *  - ANNOTATIONS_FORMS, ANNOTATIONS_STORAGE, ANNOTATIONS_DISABLE control which\n *    annotations are rendered onto the canvas (i.e. by being included in the\n *    operatorList), note the `PDFPageProxy.{render, getOperatorList}`-methods\n *    and their `annotationMode`-option.\n *  - IS_EDITING is used when editing is active in the viewer.\n *  - OPLIST is used with the `PDFPageProxy.getOperatorList`-method, note the\n *    `OperatorList`-constructor (on the worker-thread).\n */\nconst RenderingIntentFlag = {\n  ANY: 0x01,\n  DISPLAY: 0x02,\n  PRINT: 0x04,\n  SAVE: 0x08,\n  ANNOTATIONS_FORMS: 0x10,\n  ANNOTATIONS_STORAGE: 0x20,\n  ANNOTATIONS_DISABLE: 0x40,\n  IS_EDITING: 0x80,\n  OPLIST: 0x100,\n};\n\nconst AnnotationMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_FORMS: 2,\n  ENABLE_STORAGE: 3,\n};\n\nconst AnnotationEditorPrefix = \"pdfjs_internal_editor_\";\n\nconst AnnotationEditorType = {\n  DISABLE: -1,\n  NONE: 0,\n  FREETEXT: 3,\n  HIGHLIGHT: 9,\n  STAMP: 13,\n  INK: 15,\n  POPUP: 16,\n  SIGNATURE: 101,\n  COMMENT: 102,\n};\n\nconst AnnotationEditorParamsType = {\n  RESIZE: 1,\n  CREATE: 2,\n  FREETEXT_SIZE: 11,\n  FREETEXT_COLOR: 12,\n  FREETEXT_OPACITY: 13,\n  INK_COLOR: 21,\n  INK_THICKNESS: 22,\n  INK_OPACITY: 23,\n  HIGHLIGHT_COLOR: 31,\n  HIGHLIGHT_THICKNESS: 32,\n  HIGHLIGHT_FREE: 33,\n  HIGHLIGHT_SHOW_ALL: 34,\n  DRAW_STEP: 41,\n};\n\n// Permission flags from Table 22, Section 7.6.3.2 of the PDF specification.\nconst PermissionFlag = {\n  PRINT: 0x04,\n  MODIFY_CONTENTS: 0x08,\n  COPY: 0x10,\n  MODIFY_ANNOTATIONS: 0x20,\n  FILL_INTERACTIVE_FORMS: 0x100,\n  COPY_FOR_ACCESSIBILITY: 0x200,\n  ASSEMBLE: 0x400,\n  PRINT_HIGH_QUALITY: 0x800,\n};\n\nconst MeshFigureType = {\n  TRIANGLES: 1,\n  LATTICE: 2,\n  PATCH: 3,\n};\n\nconst TextRenderingMode = {\n  FILL: 0,\n  STROKE: 1,\n  FILL_STROKE: 2,\n  INVISIBLE: 3,\n  FILL_ADD_TO_PATH: 4,\n  STROKE_ADD_TO_PATH: 5,\n  FILL_STROKE_ADD_TO_PATH: 6,\n  ADD_TO_PATH: 7,\n  FILL_STROKE_MASK: 3,\n  ADD_TO_PATH_FLAG: 4,\n};\n\nconst ImageKind = {\n  GRAYSCALE_1BPP: 1,\n  RGB_24BPP: 2,\n  RGBA_32BPP: 3,\n};\n\nconst AnnotationType = {\n  TEXT: 1,\n  LINK: 2,\n  FREETEXT: 3,\n  LINE: 4,\n  SQUARE: 5,\n  CIRCLE: 6,\n  POLYGON: 7,\n  POLYLINE: 8,\n  HIGHLIGHT: 9,\n  UNDERLINE: 10,\n  SQUIGGLY: 11,\n  STRIKEOUT: 12,\n  STAMP: 13,\n  CARET: 14,\n  INK: 15,\n  POPUP: 16,\n  FILEATTACHMENT: 17,\n  SOUND: 18,\n  MOVIE: 19,\n  WIDGET: 20,\n  SCREEN: 21,\n  PRINTERMARK: 22,\n  TRAPNET: 23,\n  WATERMARK: 24,\n  THREED: 25,\n  REDACT: 26,\n};\n\nconst AnnotationReplyType = {\n  GROUP: \"Group\",\n  REPLY: \"R\",\n};\n\nconst AnnotationFlag = {\n  INVISIBLE: 0x01,\n  HIDDEN: 0x02,\n  PRINT: 0x04,\n  NOZOOM: 0x08,\n  NOROTATE: 0x10,\n  NOVIEW: 0x20,\n  READONLY: 0x40,\n  LOCKED: 0x80,\n  TOGGLENOVIEW: 0x100,\n  LOCKEDCONTENTS: 0x200,\n};\n\nconst AnnotationFieldFlag = {\n  READONLY: 0x0000001,\n  REQUIRED: 0x0000002,\n  NOEXPORT: 0x0000004,\n  MULTILINE: 0x0001000,\n  PASSWORD: 0x0002000,\n  NOTOGGLETOOFF: 0x0004000,\n  RADIO: 0x0008000,\n  PUSHBUTTON: 0x0010000,\n  COMBO: 0x0020000,\n  EDIT: 0x0040000,\n  SORT: 0x0080000,\n  FILESELECT: 0x0100000,\n  MULTISELECT: 0x0200000,\n  DONOTSPELLCHECK: 0x0400000,\n  DONOTSCROLL: 0x0800000,\n  COMB: 0x1000000,\n  RICHTEXT: 0x2000000,\n  RADIOSINUNISON: 0x2000000,\n  COMMITONSELCHANGE: 0x4000000,\n};\n\nconst AnnotationBorderStyleType = {\n  SOLID: 1,\n  DASHED: 2,\n  BEVELED: 3,\n  INSET: 4,\n  UNDERLINE: 5,\n};\n\nconst AnnotationActionEventType = {\n  E: \"Mouse Enter\",\n  X: \"Mouse Exit\",\n  D: \"Mouse Down\",\n  U: \"Mouse Up\",\n  Fo: \"Focus\",\n  Bl: \"Blur\",\n  PO: \"PageOpen\",\n  PC: \"PageClose\",\n  PV: \"PageVisible\",\n  PI: \"PageInvisible\",\n  K: \"Keystroke\",\n  F: \"Format\",\n  V: \"Validate\",\n  C: \"Calculate\",\n};\n\nconst DocumentActionEventType = {\n  WC: \"WillClose\",\n  WS: \"WillSave\",\n  DS: \"DidSave\",\n  WP: \"WillPrint\",\n  DP: \"DidPrint\",\n};\n\nconst PageActionEventType = {\n  O: \"PageOpen\",\n  C: \"PageClose\",\n};\n\nconst VerbosityLevel = {\n  ERRORS: 0,\n  WARNINGS: 1,\n  INFOS: 5,\n};\n\n// All the possible operations for an operator list.\nconst OPS = {\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\n  // 0's.\n  // PLEASE NOTE: We purposely keep any removed operators commented out, since\n  //              re-numbering the list would risk breaking third-party users.\n  dependency: 1,\n  setLineWidth: 2,\n  setLineCap: 3,\n  setLineJoin: 4,\n  setMiterLimit: 5,\n  setDash: 6,\n  setRenderingIntent: 7,\n  setFlatness: 8,\n  setGState: 9,\n  save: 10,\n  restore: 11,\n  transform: 12,\n  moveTo: 13,\n  lineTo: 14,\n  curveTo: 15,\n  curveTo2: 16,\n  curveTo3: 17,\n  closePath: 18,\n  rectangle: 19,\n  stroke: 20,\n  closeStroke: 21,\n  fill: 22,\n  eoFill: 23,\n  fillStroke: 24,\n  eoFillStroke: 25,\n  closeFillStroke: 26,\n  closeEOFillStroke: 27,\n  endPath: 28,\n  clip: 29,\n  eoClip: 30,\n  beginText: 31,\n  endText: 32,\n  setCharSpacing: 33,\n  setWordSpacing: 34,\n  setHScale: 35,\n  setLeading: 36,\n  setFont: 37,\n  setTextRenderingMode: 38,\n  setTextRise: 39,\n  moveText: 40,\n  setLeadingMoveText: 41,\n  setTextMatrix: 42,\n  nextLine: 43,\n  showText: 44,\n  showSpacedText: 45,\n  nextLineShowText: 46,\n  nextLineSetSpacingShowText: 47,\n  setCharWidth: 48,\n  setCharWidthAndBounds: 49,\n  setStrokeColorSpace: 50,\n  setFillColorSpace: 51,\n  setStrokeColor: 52,\n  setStrokeColorN: 53,\n  setFillColor: 54,\n  setFillColorN: 55,\n  setStrokeGray: 56,\n  setFillGray: 57,\n  setStrokeRGBColor: 58,\n  setFillRGBColor: 59,\n  setStrokeCMYKColor: 60,\n  setFillCMYKColor: 61,\n  shadingFill: 62,\n  beginInlineImage: 63,\n  beginImageData: 64,\n  endInlineImage: 65,\n  paintXObject: 66,\n  markPoint: 67,\n  markPointProps: 68,\n  beginMarkedContent: 69,\n  beginMarkedContentProps: 70,\n  endMarkedContent: 71,\n  beginCompat: 72,\n  endCompat: 73,\n  paintFormXObjectBegin: 74,\n  paintFormXObjectEnd: 75,\n  beginGroup: 76,\n  endGroup: 77,\n  // beginAnnotations: 78,\n  // endAnnotations: 79,\n  beginAnnotation: 80,\n  endAnnotation: 81,\n  // paintJpegXObject: 82,\n  paintImageMaskXObject: 83,\n  paintImageMaskXObjectGroup: 84,\n  paintImageXObject: 85,\n  paintInlineImageXObject: 86,\n  paintInlineImageXObjectGroup: 87,\n  paintImageXObjectRepeat: 88,\n  paintImageMaskXObjectRepeat: 89,\n  paintSolidColorImageMask: 90,\n  constructPath: 91,\n  setStrokeTransparent: 92,\n  setFillTransparent: 93,\n  rawFillPath: 94,\n};\n\n// In order to have a switch statement that is fast (i.e. which use a jump\n// table), we need to have the OPS in a contiguous range.\nconst DrawOPS = {\n  moveTo: 0,\n  lineTo: 1,\n  curveTo: 2,\n  quadraticCurveTo: 3,\n  closePath: 4,\n};\n\nconst PasswordResponses = {\n  NEED_PASSWORD: 1,\n  INCORRECT_PASSWORD: 2,\n};\n\nlet verbosity = VerbosityLevel.WARNINGS;\n\nfunction setVerbosityLevel(level) {\n  if (Number.isInteger(level)) {\n    verbosity = level;\n  }\n}\n\nfunction getVerbosityLevel() {\n  return verbosity;\n}\n\n// A notice for devs. These are good for things that are helpful to devs, such\n// as warning that Workers were disabled, which is important to devs but not\n// end users.\nfunction info(msg) {\n  if (verbosity >= VerbosityLevel.INFOS) {\n    // eslint-disable-next-line no-console\n    console.info(`Info: ${msg}`);\n  }\n}\n\n// Non-fatal warnings.\nfunction warn(msg) {\n  if (verbosity >= VerbosityLevel.WARNINGS) {\n    // eslint-disable-next-line no-console\n    console.warn(`Warning: ${msg}`);\n  }\n}\n\nfunction unreachable(msg) {\n  throw new Error(msg);\n}\n\nfunction assert(cond, msg) {\n  if (!cond) {\n    unreachable(msg);\n  }\n}\n\n// Checks if URLs use one of the allowed protocols, e.g. to avoid XSS.\nfunction _isValidProtocol(url) {\n  switch (url?.protocol) {\n    case \"http:\":\n    case \"https:\":\n    case \"ftp:\":\n    case \"mailto:\":\n    case \"tel:\":\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Attempts to create a valid absolute URL.\n *\n * @param {URL|string} url - An absolute, or relative, URL.\n * @param {URL|string} [baseUrl] - An absolute URL.\n * @param {Object} [options]\n * @returns Either a valid {URL}, or `null` otherwise.\n */\nfunction createValidAbsoluteUrl(url, baseUrl = null, options = null) {\n  if (!url) {\n    return null;\n  }\n  if (options && typeof url === \"string\") {\n    // Let URLs beginning with \"www.\" default to using the \"http://\" protocol.\n    if (options.addDefaultProtocol && url.startsWith(\"www.\")) {\n      const dots = url.match(/\\./g);\n      // Avoid accidentally matching a *relative* URL pointing to a file named\n      // e.g. \"www.pdf\" or similar.\n      if (dots?.length >= 2) {\n        url = `http://${url}`;\n      }\n    }\n\n    // According to ISO 32000-1:2008, section 12.6.4.7, URIs should be encoded\n    // in 7-bit ASCII. Some bad PDFs use UTF-8 encoding; see bug 1122280.\n    if (options.tryConvertEncoding) {\n      try {\n        url = stringToUTF8String(url);\n      } catch {}\n    }\n  }\n\n  const absoluteUrl = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  return _isValidProtocol(absoluteUrl) ? absoluteUrl : null;\n}\n\n/**\n * Remove, or replace, the hash property of the URL.\n *\n * @param {URL|string} url - The absolute, or relative, URL.\n * @param {string} hash - The hash property (use an empty string to remove it).\n * @param {boolean} [allowRel] - Allow relative URLs.\n * @returns {string} The resulting URL string.\n */\nfunction updateUrlHash(url, hash, allowRel = false) {\n  const res = URL.parse(url);\n  if (res) {\n    res.hash = hash;\n    return res.href;\n  }\n  // Support well-formed relative URLs, necessary for `web/app.js` in GENERIC\n  // builds, by optionally falling back to string parsing.\n  if (allowRel && createValidAbsoluteUrl(url, \"http://example.com\")) {\n    return url.split(\"#\", 1)[0] + `${hash ? `#${hash}` : \"\"}`;\n  }\n  return \"\";\n}\n\nfunction shadow(obj, prop, value, nonSerializable = false) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      prop in obj,\n      `shadow: Property \"${prop && prop.toString()}\" not found in object.`\n    );\n  }\n  Object.defineProperty(obj, prop, {\n    value,\n    enumerable: !nonSerializable,\n    configurable: true,\n    writable: false,\n  });\n  return value;\n}\n\n/**\n * @type {any}\n */\nconst BaseException = (function BaseExceptionClosure() {\n  // eslint-disable-next-line no-shadow\n  function BaseException(message, name) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseException\n    ) {\n      unreachable(\"Cannot initialize BaseException.\");\n    }\n    this.message = message;\n    this.name = name;\n  }\n  BaseException.prototype = new Error();\n  BaseException.constructor = BaseException;\n\n  return BaseException;\n})();\n\nclass PasswordException extends BaseException {\n  constructor(msg, code) {\n    super(msg, \"PasswordException\");\n    this.code = code;\n  }\n}\n\nclass UnknownErrorException extends BaseException {\n  constructor(msg, details) {\n    super(msg, \"UnknownErrorException\");\n    this.details = details;\n  }\n}\n\nclass InvalidPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"InvalidPDFException\");\n  }\n}\n\nclass ResponseException extends BaseException {\n  constructor(msg, status, missing) {\n    super(msg, \"ResponseException\");\n    this.status = status;\n    this.missing = missing;\n  }\n}\n\n/**\n * Error caused during parsing PDF data.\n */\nclass FormatError extends BaseException {\n  constructor(msg) {\n    super(msg, \"FormatError\");\n  }\n}\n\n/**\n * Error used to indicate task cancellation.\n */\nclass AbortException extends BaseException {\n  constructor(msg) {\n    super(msg, \"AbortException\");\n  }\n}\n\nfunction bytesToString(bytes) {\n  if (typeof bytes !== \"object\" || bytes?.length === undefined) {\n    unreachable(\"Invalid argument for bytesToString\");\n  }\n  const length = bytes.length;\n  const MAX_ARGUMENT_COUNT = 8192;\n  if (length < MAX_ARGUMENT_COUNT) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n  const strBuf = [];\n  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\n    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\n    const chunk = bytes.subarray(i, chunkEnd);\n    strBuf.push(String.fromCharCode.apply(null, chunk));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToBytes(str) {\n  if (typeof str !== \"string\") {\n    unreachable(\"Invalid argument for stringToBytes\");\n  }\n  const length = str.length;\n  const bytes = new Uint8Array(length);\n  for (let i = 0; i < length; ++i) {\n    bytes[i] = str.charCodeAt(i) & 0xff;\n  }\n  return bytes;\n}\n\nfunction string32(value) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      typeof value === \"number\" && Math.abs(value) < 2 ** 32,\n      `string32: Unexpected input \"${value}\".`\n    );\n  }\n  return String.fromCharCode(\n    (value >> 24) & 0xff,\n    (value >> 16) & 0xff,\n    (value >> 8) & 0xff,\n    value & 0xff\n  );\n}\n\nfunction objectSize(obj) {\n  return Object.keys(obj).length;\n}\n\n// Checks the endianness of the platform.\nfunction isLittleEndian() {\n  const buffer8 = new Uint8Array(4);\n  buffer8[0] = 1;\n  const view32 = new Uint32Array(buffer8.buffer, 0, 1);\n  return view32[0] === 1;\n}\n\n// Checks if it's possible to eval JS expressions.\nfunction isEvalSupported() {\n  try {\n    new Function(\"\"); // eslint-disable-line no-new, no-new-func\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass FeatureTest {\n  static get isLittleEndian() {\n    return shadow(this, \"isLittleEndian\", isLittleEndian());\n  }\n\n  static get isEvalSupported() {\n    return shadow(this, \"isEvalSupported\", isEvalSupported());\n  }\n\n  static get isOffscreenCanvasSupported() {\n    return shadow(\n      this,\n      \"isOffscreenCanvasSupported\",\n      typeof OffscreenCanvas !== \"undefined\"\n    );\n  }\n\n  static get isImageDecoderSupported() {\n    return shadow(\n      this,\n      \"isImageDecoderSupported\",\n      typeof ImageDecoder !== \"undefined\"\n    );\n  }\n\n  static get isFloat16ArraySupported() {\n    return shadow(\n      this,\n      \"isFloat16ArraySupported\",\n      typeof Float16Array !== \"undefined\"\n    );\n  }\n\n  static get isSanitizerSupported() {\n    return shadow(\n      this,\n      \"isSanitizerSupported\",\n      // eslint-disable-next-line no-undef\n      typeof Sanitizer !== \"undefined\"\n    );\n  }\n\n  static get platform() {\n    const { platform, userAgent } = navigator;\n\n    return shadow(this, \"platform\", {\n      isAndroid: userAgent.includes(\"Android\"),\n      isLinux: platform.includes(\"Linux\"),\n      isMac: platform.includes(\"Mac\"),\n      isWindows: platform.includes(\"Win\"),\n      isFirefox:\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        userAgent.includes(\"Firefox\"),\n    });\n  }\n\n  static get isCSSRoundSupported() {\n    return shadow(\n      this,\n      \"isCSSRoundSupported\",\n      globalThis.CSS?.supports?.(\"width: round(1.5px, 1px)\")\n    );\n  }\n}\n\nconst hexNumbers = Array.from(Array(256).keys(), n =>\n  n.toString(16).padStart(2, \"0\")\n);\n\nclass Util {\n  static makeHexColor(r, g, b) {\n    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;\n  }\n\n  static domMatrixToTransform(dm) {\n    return [dm.a, dm.b, dm.c, dm.d, dm.e, dm.f];\n  }\n\n  // Apply a scaling matrix to some min/max values.\n  // If a scaling factor is negative then min and max must be\n  // swapped.\n  static scaleMinMax(transform, minMax) {\n    let temp;\n    if (transform[0]) {\n      if (transform[0] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[0];\n      minMax[2] *= transform[0];\n\n      if (transform[3] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[3];\n      minMax[3] *= transform[3];\n    } else {\n      temp = minMax[0];\n      minMax[0] = minMax[1];\n      minMax[1] = temp;\n      temp = minMax[2];\n      minMax[2] = minMax[3];\n      minMax[3] = temp;\n\n      if (transform[1] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[1];\n      minMax[3] *= transform[1];\n\n      if (transform[2] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[2];\n      minMax[2] *= transform[2];\n    }\n    minMax[0] += transform[4];\n    minMax[1] += transform[5];\n    minMax[2] += transform[4];\n    minMax[3] += transform[5];\n  }\n\n  // Concatenates two transformation matrices together and returns the result.\n  static transform(m1, m2) {\n    return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5],\n    ];\n  }\n\n  // Multiplies m (an array-based transform) by md (a DOMMatrix transform).\n  static multiplyByDOMMatrix(m, md) {\n    return [\n      m[0] * md.a + m[2] * md.b,\n      m[1] * md.a + m[3] * md.b,\n      m[0] * md.c + m[2] * md.d,\n      m[1] * md.c + m[3] * md.d,\n      m[0] * md.e + m[2] * md.f + m[4],\n      m[1] * md.e + m[3] * md.f + m[5],\n    ];\n  }\n\n  // For 2d affine transforms\n  static applyTransform(p, m, pos = 0) {\n    const p0 = p[pos];\n    const p1 = p[pos + 1];\n    p[pos] = p0 * m[0] + p1 * m[2] + m[4];\n    p[pos + 1] = p0 * m[1] + p1 * m[3] + m[5];\n  }\n\n  static applyTransformToBezier(p, transform, pos = 0) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    for (let i = 0; i < 6; i += 2) {\n      const pI = p[pos + i];\n      const pI1 = p[pos + i + 1];\n      p[pos + i] = pI * m0 + pI1 * m2 + m4;\n      p[pos + i + 1] = pI * m1 + pI1 * m3 + m5;\n    }\n  }\n\n  static applyInverseTransform(p, m) {\n    const p0 = p[0];\n    const p1 = p[1];\n    const d = m[0] * m[3] - m[1] * m[2];\n    p[0] = (p0 * m[3] - p1 * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\n    p[1] = (-p0 * m[1] + p1 * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\n  }\n\n  // Applies the transform to the rectangle and finds the minimum axially\n  // aligned bounding box.\n  static axialAlignedBoundingBox(rect, transform, output) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    const r0 = rect[0];\n    const r1 = rect[1];\n    const r2 = rect[2];\n    const r3 = rect[3];\n\n    let a0 = m0 * r0 + m4;\n    let a2 = a0;\n    let a1 = m0 * r2 + m4;\n    let a3 = a1;\n    let b0 = m3 * r1 + m5;\n    let b2 = b0;\n    let b1 = m3 * r3 + m5;\n    let b3 = b1;\n\n    if (m1 !== 0 || m2 !== 0) {\n      // Non-scaling matrix: shouldn't be frequent.\n      const m1r0 = m1 * r0;\n      const m1r2 = m1 * r2;\n      const m2r1 = m2 * r1;\n      const m2r3 = m2 * r3;\n      a0 += m2r1;\n      a3 += m2r1;\n      a1 += m2r3;\n      a2 += m2r3;\n      b0 += m1r0;\n      b3 += m1r0;\n      b1 += m1r2;\n      b2 += m1r2;\n    }\n\n    output[0] = Math.min(output[0], a0, a1, a2, a3);\n    output[1] = Math.min(output[1], b0, b1, b2, b3);\n    output[2] = Math.max(output[2], a0, a1, a2, a3);\n    output[3] = Math.max(output[3], b0, b1, b2, b3);\n  }\n\n  static inverseTransform(m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    return [\n      m[3] / d,\n      -m[1] / d,\n      -m[2] / d,\n      m[0] / d,\n      (m[2] * m[5] - m[4] * m[3]) / d,\n      (m[4] * m[1] - m[5] * m[0]) / d,\n    ];\n  }\n\n  // This calculation uses Singular Value Decomposition.\n  // The SVD can be represented with formula A = USV. We are interested in the\n  // matrix S here because it represents the scale values.\n  static singularValueDecompose2dScale(matrix, output) {\n    const m0 = matrix[0];\n    const m1 = matrix[1];\n    const m2 = matrix[2];\n    const m3 = matrix[3];\n    // Multiply matrix m with its transpose.\n    const a = m0 ** 2 + m1 ** 2;\n    const b = m0 * m2 + m1 * m3;\n    const c = m2 ** 2 + m3 ** 2;\n\n    // Solve the second degree polynomial to get roots.\n    const first = (a + c) / 2;\n    const second = Math.sqrt(first ** 2 - (a * c - b ** 2));\n    output[0] = Math.sqrt(first + second || 1);\n    output[1] = Math.sqrt(first - second || 1);\n  }\n\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\n  // For coordinate systems whose origin lies in the bottom-left, this\n  // means normalization to (BL,TR) ordering. For systems with origin in the\n  // top-left, this means (TL,BR) ordering.\n  static normalizeRect(rect) {\n    const r = rect.slice(0); // clone rect\n    if (rect[0] > rect[2]) {\n      r[0] = rect[2];\n      r[2] = rect[0];\n    }\n    if (rect[1] > rect[3]) {\n      r[1] = rect[3];\n      r[3] = rect[1];\n    }\n    return r;\n  }\n\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\n  // intersection of rect1 and rect2. If no intersection, returns 'null'\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\n  static intersect(rect1, rect2) {\n    const xLow = Math.max(\n      Math.min(rect1[0], rect1[2]),\n      Math.min(rect2[0], rect2[2])\n    );\n    const xHigh = Math.min(\n      Math.max(rect1[0], rect1[2]),\n      Math.max(rect2[0], rect2[2])\n    );\n    if (xLow > xHigh) {\n      return null;\n    }\n    const yLow = Math.max(\n      Math.min(rect1[1], rect1[3]),\n      Math.min(rect2[1], rect2[3])\n    );\n    const yHigh = Math.min(\n      Math.max(rect1[1], rect1[3]),\n      Math.max(rect2[1], rect2[3])\n    );\n    if (yLow > yHigh) {\n      return null;\n    }\n\n    return [xLow, yLow, xHigh, yHigh];\n  }\n\n  static pointBoundingBox(x, y, minMax) {\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static rectBoundingBox(x0, y0, x1, y1, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x1);\n    minMax[1] = Math.min(minMax[1], y0, y1);\n    minMax[2] = Math.max(minMax[2], x0, x1);\n    minMax[3] = Math.max(minMax[3], y0, y1);\n  }\n\n  static #getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, t, minMax) {\n    if (t <= 0 || t >= 1) {\n      return;\n    }\n    const mt = 1 - t;\n    const tt = t * t;\n    const ttt = tt * t;\n    const x = mt * (mt * (mt * x0 + 3 * t * x1) + 3 * tt * x2) + ttt * x3;\n    const y = mt * (mt * (mt * y0 + 3 * t * y1) + 3 * tt * y2) + ttt * y3;\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static #getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, a, b, c, minMax) {\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) >= 1e-12) {\n        this.#getExtremumOnCurve(\n          x0,\n          x1,\n          x2,\n          x3,\n          y0,\n          y1,\n          y2,\n          y3,\n          -c / b,\n          minMax\n        );\n      }\n      return;\n    }\n\n    const delta = b ** 2 - 4 * c * a;\n    if (delta < 0) {\n      return;\n    }\n    const sqrtDelta = Math.sqrt(delta);\n    const a2 = 2 * a;\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b + sqrtDelta) / a2,\n      minMax\n    );\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b - sqrtDelta) / a2,\n      minMax\n    );\n  }\n\n  // From https://github.com/adobe-webplatform/Snap.svg/blob/b365287722a72526000ac4bfcf0ce4cac2faa015/src/path.js#L852\n  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x3);\n    minMax[1] = Math.min(minMax[1], y0, y3);\n    minMax[2] = Math.max(minMax[2], x0, x3);\n    minMax[3] = Math.max(minMax[3], y0, y3);\n\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-x0 + 3 * (x1 - x2) + x3),\n      6 * (x0 - 2 * x1 + x2),\n      3 * (x1 - x0),\n      minMax\n    );\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-y0 + 3 * (y1 - y2) + y3),\n      6 * (y0 - 2 * y1 + y2),\n      3 * (y1 - y0),\n      minMax\n    );\n  }\n}\n\nconst PDFStringTranslateTable = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8,\n  0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192,\n  0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018,\n  0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d,\n  0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac,\n];\n\nfunction stringToPDFString(str, keepEscapeSequence = false) {\n  // See section 7.9.2.2 Text String Type.\n  // The string can contain some language codes bracketed with 0x1b,\n  // so we must remove them.\n  if (str[0] >= \"\\xEF\") {\n    let encoding;\n    if (str[0] === \"\\xFE\" && str[1] === \"\\xFF\") {\n      encoding = \"utf-16be\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xFF\" && str[1] === \"\\xFE\") {\n      encoding = \"utf-16le\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xEF\" && str[1] === \"\\xBB\" && str[2] === \"\\xBF\") {\n      encoding = \"utf-8\";\n    }\n\n    if (encoding) {\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(str);\n        const decoded = decoder.decode(buffer);\n        if (keepEscapeSequence || !decoded.includes(\"\\x1b\")) {\n          return decoded;\n        }\n        return decoded.replaceAll(/\\x1b[^\\x1b]*(?:\\x1b|$)/g, \"\");\n      } catch (ex) {\n        warn(`stringToPDFString: \"${ex}\".`);\n      }\n    }\n  }\n  // ISO Latin 1\n  const strBuf = [];\n  for (let i = 0, ii = str.length; i < ii; i++) {\n    const charCode = str.charCodeAt(i);\n    if (!keepEscapeSequence && charCode === 0x1b) {\n      // eslint-disable-next-line no-empty\n      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}\n      continue;\n    }\n    const code = PDFStringTranslateTable[charCode];\n    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToUTF8String(str) {\n  return decodeURIComponent(escape(str));\n}\n\nfunction utf8StringToString(str) {\n  return unescape(encodeURIComponent(str));\n}\n\nfunction isArrayEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, ii = arr1.length; i < ii; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getModificationDate(date = new Date()) {\n  if (!(date instanceof Date)) {\n    date = new Date(date);\n  }\n  const buffer = [\n    date.getUTCFullYear().toString(),\n    (date.getUTCMonth() + 1).toString().padStart(2, \"0\"),\n    date.getUTCDate().toString().padStart(2, \"0\"),\n    date.getUTCHours().toString().padStart(2, \"0\"),\n    date.getUTCMinutes().toString().padStart(2, \"0\"),\n    date.getUTCSeconds().toString().padStart(2, \"0\"),\n  ];\n\n  return buffer.join(\"\");\n}\n\nlet NormalizeRegex = null;\nlet NormalizationMap = null;\nfunction normalizeUnicode(str) {\n  if (!NormalizeRegex) {\n    // In order to generate the following regex:\n    //  - create a PDF containing all the chars in the range 0000-FFFF with\n    //    a NFKC which is different of the char.\n    //  - copy and paste all those chars and get the ones where NFKC is\n    //    required.\n    // It appears that most the chars here contain some ligatures.\n    NormalizeRegex =\n      /([\\u00a0\\u00b5\\u037e\\u0eb3\\u2000-\\u200a\\u202f\\u2126\\ufb00-\\ufb04\\ufb06\\ufb20-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufba1\\ufba4-\\ufba9\\ufbae-\\ufbb1\\ufbd3-\\ufbdc\\ufbde-\\ufbe7\\ufbea-\\ufbf8\\ufbfc-\\ufbfd\\ufc00-\\ufc5d\\ufc64-\\ufcf1\\ufcf5-\\ufd3d\\ufd88\\ufdf4\\ufdfa-\\ufdfb\\ufe71\\ufe77\\ufe79\\ufe7b\\ufe7d]+)|(\\ufb05+)/gu;\n    NormalizationMap = new Map([[\"\", \"t\"]]);\n  }\n  return str.replaceAll(NormalizeRegex, (_, p1, p2) =>\n    p1 ? p1.normalize(\"NFKC\") : NormalizationMap.get(p2)\n  );\n}\n\nfunction getUuid() {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    typeof crypto.randomUUID === \"function\"\n  ) {\n    return crypto.randomUUID();\n  }\n  const buf = new Uint8Array(32);\n  crypto.getRandomValues(buf);\n  return bytesToString(buf);\n}\n\nconst AnnotationPrefix = \"pdfjs_internal_id_\";\n\nfunction _isValidExplicitDest(validRef, validName, dest) {\n  if (!Array.isArray(dest) || dest.length < 2) {\n    return false;\n  }\n  const [page, zoom, ...args] = dest;\n  if (!validRef(page) && !Number.isInteger(page)) {\n    return false;\n  }\n  if (!validName(zoom)) {\n    return false;\n  }\n  const argsLen = args.length;\n  let allowNull = true;\n  switch (zoom.name) {\n    case \"XYZ\":\n      if (argsLen < 2 || argsLen > 3) {\n        return false;\n      }\n      break;\n    case \"Fit\":\n    case \"FitB\":\n      return argsLen === 0;\n    case \"FitH\":\n    case \"FitBH\":\n    case \"FitV\":\n    case \"FitBV\":\n      if (argsLen > 1) {\n        return false;\n      }\n      break;\n    case \"FitR\":\n      if (argsLen !== 4) {\n        return false;\n      }\n      allowNull = false;\n      break;\n    default:\n      return false;\n  }\n  for (const arg of args) {\n    if (typeof arg === \"number\" || (allowNull && arg === null)) {\n      continue;\n    }\n    return false;\n  }\n  return true;\n}\n\n// TODO: Replace all occurrences of this function with `Math.clamp` once\n//       https://github.com/tc39/proposal-math-clamp/ is generally available.\nfunction MathClamp(v, min, max) {\n  return Math.min(Math.max(v, min), max);\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toHex` is generally available.\nfunction toHexUtil(arr) {\n  if (Uint8Array.prototype.toHex) {\n    return arr.toHex();\n  }\n  return Array.from(arr, num => hexNumbers[num]).join(\"\");\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toBase64` is generally\n//       available.\nfunction toBase64Util(arr) {\n  if (Uint8Array.prototype.toBase64) {\n    return arr.toBase64();\n  }\n  return btoa(bytesToString(arr));\n}\n\n// TODO: Remove this once `Uint8Array.fromBase64` is generally available.\nfunction fromBase64Util(str) {\n  if (Uint8Array.fromBase64) {\n    return Uint8Array.fromBase64(str);\n  }\n  return stringToBytes(atob(str));\n}\n\n// TODO: Remove this once https://bugzilla.mozilla.org/show_bug.cgi?id=1928493\n//       is fixed.\nif (\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) &&\n  typeof Promise.try !== \"function\"\n) {\n  Promise.try = function (fn, ...args) {\n    return new Promise(resolve => {\n      resolve(fn(...args));\n    });\n  };\n}\n\n// TODO: Remove this once the `javascript.options.experimental.math_sumprecise`\n//       preference is removed from Firefox.\nif (typeof Math.sumPrecise !== \"function\") {\n  // Note that this isn't a \"proper\" polyfill, but since we're only using it to\n  // replace `Array.prototype.reduce()` invocations it should be fine.\n  Math.sumPrecise = function (numbers) {\n    return numbers.reduce((a, b) => a + b, 0);\n  };\n}\n\nif (\n  typeof PDFJSDev !== \"undefined\" &&\n  !PDFJSDev.test(\"SKIP_BABEL\") &&\n  typeof AbortSignal.any !== \"function\"\n) {\n  AbortSignal.any = function (iterable) {\n    const ac = new AbortController();\n    const { signal } = ac;\n\n    // Return immediately if any of the signals are already aborted.\n    for (const s of iterable) {\n      if (s.aborted) {\n        ac.abort(s.reason);\n        return signal;\n      }\n    }\n    // Register \"abort\" listeners for all signals.\n    for (const s of iterable) {\n      s.addEventListener(\n        \"abort\",\n        () => {\n          ac.abort(s.reason);\n        },\n        { signal } // Automatically remove the listener.\n      );\n    }\n\n    return signal;\n  };\n}\n\nexport {\n  _isValidExplicitDest,\n  AbortException,\n  AnnotationActionEventType,\n  AnnotationBorderStyleType,\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationFieldFlag,\n  AnnotationFlag,\n  AnnotationMode,\n  AnnotationPrefix,\n  AnnotationReplyType,\n  AnnotationType,\n  assert,\n  BaseException,\n  BASELINE_FACTOR,\n  bytesToString,\n  createValidAbsoluteUrl,\n  DocumentActionEventType,\n  DrawOPS,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  FormatError,\n  fromBase64Util,\n  getModificationDate,\n  getUuid,\n  getVerbosityLevel,\n  hexNumbers,\n  ImageKind,\n  info,\n  InvalidPDFException,\n  isArrayEqual,\n  isNodeJS,\n  LINE_DESCENT_FACTOR,\n  LINE_FACTOR,\n  MathClamp,\n  MeshFigureType,\n  normalizeUnicode,\n  objectSize,\n  OPS,\n  PageActionEventType,\n  PasswordException,\n  PasswordResponses,\n  PermissionFlag,\n  RenderingIntentFlag,\n  ResponseException,\n  setVerbosityLevel,\n  shadow,\n  string32,\n  stringToBytes,\n  stringToPDFString,\n  stringToUTF8String,\n  TextRenderingMode,\n  toBase64Util,\n  toHexUtil,\n  UnknownErrorException,\n  unreachable,\n  updateUrlHash,\n  utf8StringToString,\n  Util,\n  VerbosityLevel,\n  warn,\n};\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nclass XfaText {\n  /**\n   * Walk an XFA tree and create an array of text nodes that is compatible\n   * with a regular PDFs TextContent. Currently, only TextItem.str is supported,\n   * all other fields and styles haven't been implemented.\n   *\n   * @param {Object} xfa - An XFA fake DOM object.\n   *\n   * @returns {TextContent}\n   */\n  static textContent(xfa) {\n    const items = [];\n    const output = {\n      items,\n      styles: Object.create(null),\n    };\n    function walk(node) {\n      if (!node) {\n        return;\n      }\n      let str = null;\n      const name = node.name;\n      if (name === \"#text\") {\n        str = node.value;\n      } else if (!XfaText.shouldBuildText(name)) {\n        return;\n      } else if (node?.attributes?.textContent) {\n        str = node.attributes.textContent;\n      } else if (node.value) {\n        str = node.value;\n      }\n      if (str !== null) {\n        items.push({\n          str,\n        });\n      }\n      if (!node.children) {\n        return;\n      }\n      for (const child of node.children) {\n        walk(child);\n      }\n    }\n    walk(xfa);\n    return output;\n  }\n\n  /**\n   * @param {string} name - DOM node name. (lower case)\n   *\n   * @returns {boolean} true if the DOM node should have a corresponding text\n   * node.\n   */\n  static shouldBuildText(name) {\n    return !(\n      name === \"textarea\" ||\n      name === \"input\" ||\n      name === \"option\" ||\n      name === \"select\"\n    );\n  }\n}\n\nexport { XfaText };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaText } from \"./xfa_text.js\";\n\n/**\n * @typedef {Object} XfaLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Object} xfaHtml\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {string} [intent] - (default value is 'display').\n */\n\nclass XfaLayer {\n  static setupStorage(html, id, element, storage, intent) {\n    const storedData = storage.getValue(id, { value: null });\n    switch (element.name) {\n      case \"textarea\":\n        if (storedData.value !== null) {\n          html.textContent = storedData.value;\n        }\n        if (intent === \"print\") {\n          break;\n        }\n        html.addEventListener(\"input\", event => {\n          storage.setValue(id, { value: event.target.value });\n        });\n        break;\n      case \"input\":\n        if (\n          element.attributes.type === \"radio\" ||\n          element.attributes.type === \"checkbox\"\n        ) {\n          if (storedData.value === element.attributes.xfaOn) {\n            html.setAttribute(\"checked\", true);\n          } else if (storedData.value === element.attributes.xfaOff) {\n            // The checked attribute may have been set when opening the file,\n            // unset through the UI and we're here because of printing.\n            html.removeAttribute(\"checked\");\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"change\", event => {\n            storage.setValue(id, {\n              value: event.target.checked\n                ? event.target.getAttribute(\"xfaOn\")\n                : event.target.getAttribute(\"xfaOff\"),\n            });\n          });\n        } else {\n          if (storedData.value !== null) {\n            html.setAttribute(\"value\", storedData.value);\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"input\", event => {\n            storage.setValue(id, { value: event.target.value });\n          });\n        }\n        break;\n      case \"select\":\n        if (storedData.value !== null) {\n          html.setAttribute(\"value\", storedData.value);\n          for (const option of element.children) {\n            if (option.attributes.value === storedData.value) {\n              option.attributes.selected = true;\n            } else if (option.attributes.hasOwnProperty(\"selected\")) {\n              delete option.attributes.selected;\n            }\n          }\n        }\n        html.addEventListener(\"input\", event => {\n          const options = event.target.options;\n          const value =\n            options.selectedIndex === -1\n              ? \"\"\n              : options[options.selectedIndex].value;\n          storage.setValue(id, { value });\n        });\n        break;\n    }\n  }\n\n  static setAttributes({ html, element, storage = null, intent, linkService }) {\n    const { attributes } = element;\n    const isHTMLAnchorElement = html instanceof HTMLAnchorElement;\n\n    if (attributes.type === \"radio\") {\n      // Avoid to have a radio group when printing with the same as one\n      // already displayed.\n      attributes.name = `${attributes.name}-${intent}`;\n    }\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value === null || value === undefined) {\n        continue;\n      }\n\n      switch (key) {\n        case \"class\":\n          if (value.length) {\n            html.setAttribute(key, value.join(\" \"));\n          }\n          break;\n        case \"dataId\":\n          // We don't need to add dataId in the html object but it can\n          // be useful to know its value when writing printing tests:\n          // in this case, don't skip dataId to have its value.\n          break;\n        case \"id\":\n          html.setAttribute(\"data-element-id\", value);\n          break;\n        case \"style\":\n          Object.assign(html.style, value);\n          break;\n        case \"textContent\":\n          html.textContent = value;\n          break;\n        default:\n          if (!isHTMLAnchorElement || (key !== \"href\" && key !== \"newWindow\")) {\n            html.setAttribute(key, value);\n          }\n      }\n    }\n\n    if (isHTMLAnchorElement) {\n      linkService.addLinkAttributes(\n        html,\n        attributes.href,\n        attributes.newWindow\n      );\n    }\n\n    // Set the value after the others to be sure to overwrite any other values.\n    if (storage && attributes.dataId) {\n      this.setupStorage(html, attributes.dataId, element, storage);\n    }\n  }\n\n  /**\n   * Render the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static render(parameters) {\n    const storage = parameters.annotationStorage;\n    const linkService = parameters.linkService;\n    const root = parameters.xfaHtml;\n    const intent = parameters.intent || \"display\";\n    const rootHtml = document.createElement(root.name);\n    if (root.attributes) {\n      this.setAttributes({\n        html: rootHtml,\n        element: root,\n        intent,\n        linkService,\n      });\n    }\n\n    const isNotForRichText = intent !== \"richText\";\n    const rootDiv = parameters.div;\n    rootDiv.append(rootHtml);\n\n    if (parameters.viewport) {\n      const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n      rootDiv.style.transform = transform;\n    }\n\n    // Set defaults.\n    if (isNotForRichText) {\n      rootDiv.setAttribute(\"class\", \"xfaLayer xfaFont\");\n    }\n\n    // Text nodes used for the text highlighter.\n    const textDivs = [];\n\n    // In the rich text context, it's possible to just have a text node without\n    // a root element, so we handle this case here (see issue 17215).\n    if (root.children.length === 0) {\n      if (root.value) {\n        const node = document.createTextNode(root.value);\n        rootHtml.append(node);\n        if (isNotForRichText && XfaText.shouldBuildText(root.name)) {\n          textDivs.push(node);\n        }\n      }\n      return { textDivs };\n    }\n\n    const stack = [[root, -1, rootHtml]];\n\n    while (stack.length > 0) {\n      const [parent, i, html] = stack.at(-1);\n      if (i + 1 === parent.children.length) {\n        stack.pop();\n        continue;\n      }\n\n      const child = parent.children[++stack.at(-1)[1]];\n      if (child === null) {\n        continue;\n      }\n\n      const { name } = child;\n      if (name === \"#text\") {\n        const node = document.createTextNode(child.value);\n        textDivs.push(node);\n        html.append(node);\n        continue;\n      }\n\n      const childHtml = child?.attributes?.xmlns\n        ? document.createElementNS(child.attributes.xmlns, name)\n        : document.createElement(name);\n\n      html.append(childHtml);\n      if (child.attributes) {\n        this.setAttributes({\n          html: childHtml,\n          element: child,\n          storage,\n          intent,\n          linkService,\n        });\n      }\n\n      if (child.children?.length > 0) {\n        stack.push([child, -1, childHtml]);\n      } else if (child.value) {\n        const node = document.createTextNode(child.value);\n        if (isNotForRichText && XfaText.shouldBuildText(name)) {\n          textDivs.push(node);\n        }\n        childHtml.append(node);\n      }\n    }\n\n    /**\n     * TODO: re-enable that stuff once we've JS implementation.\n     * See https://bugzilla.mozilla.org/show_bug.cgi?id=1719465.\n     *\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaDisabled input, .xfaDisabled textarea\"\n     * )) {\n     * el.setAttribute(\"disabled\", true);\n     * }\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaReadOnly input, .xfaReadOnly textarea\"\n     * )) {\n     * el.setAttribute(\"readOnly\", true);\n     * }\n     */\n\n    for (const el of rootDiv.querySelectorAll(\n      \".xfaNonInteractive input, .xfaNonInteractive textarea\"\n    )) {\n      el.setAttribute(\"readOnly\", true);\n    }\n\n    return {\n      textDivs,\n    };\n  }\n\n  /**\n   * Update the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static update(parameters) {\n    const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n    parameters.div.style.transform = transform;\n    parameters.div.hidden = false;\n  }\n}\n\nexport { XfaLayer };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseException,\n  DrawOPS,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { XfaLayer } from \"./xfa_layer.js\";\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\nclass PixelsPerInch {\n  static CSS = 96.0;\n\n  static PDF = 72.0;\n\n  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;\n}\n\nasync function fetchData(url, type = \"text\") {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    isValidFetchUrl(url, document.baseURI)\n  ) {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(response.statusText);\n    }\n    switch (type) {\n      case \"arraybuffer\":\n        return response.arrayBuffer();\n      case \"blob\":\n        return response.blob();\n      case \"json\":\n        return response.json();\n    }\n    return response.text();\n  }\n\n  // The Fetch API is not supported.\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    request.open(\"GET\", url, /* async = */ true);\n    request.responseType = type;\n\n    request.onreadystatechange = () => {\n      if (request.readyState !== XMLHttpRequest.DONE) {\n        return;\n      }\n      if (request.status === 200 || request.status === 0) {\n        switch (type) {\n          case \"arraybuffer\":\n          case \"blob\":\n          case \"json\":\n            resolve(request.response);\n            return;\n        }\n        resolve(request.responseText);\n        return;\n      }\n      reject(new Error(request.statusText));\n    };\n\n    request.send(null);\n  });\n}\n\n/**\n * @typedef {Object} PageViewportParameters\n * @property {Array<number>} viewBox - The xMin, yMin, xMax and\n *   yMax coordinates.\n * @property {number} userUnit - The size of units.\n * @property {number} scale - The scale of the viewport.\n * @property {number} rotation - The rotation, in degrees, of the viewport.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset. The\n *   default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset. The\n *   default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * @typedef {Object} PageViewportCloneParameters\n * @property {number} [scale] - The scale, overriding the one in the cloned\n *   viewport. The default value is `this.scale`.\n * @property {number} [rotation] - The rotation, in degrees, overriding the one\n *   in the cloned viewport. The default value is `this.rotation`.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `this.offsetX`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `this.offsetY`.\n * @property {boolean} [dontFlip] - If true, the x-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * PDF page viewport created based on scale, rotation and offset.\n */\nclass PageViewport {\n  /**\n   * @param {PageViewportParameters}\n   */\n  constructor({\n    viewBox,\n    userUnit,\n    scale,\n    rotation,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  }) {\n    this.viewBox = viewBox;\n    this.userUnit = userUnit;\n    this.scale = scale;\n    this.rotation = rotation;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    scale *= userUnit; // Take the userUnit into account.\n\n    // creating transform to convert pdf coordinate system to the normal\n    // canvas like coordinates taking in account scale and rotation\n    const centerX = (viewBox[2] + viewBox[0]) / 2;\n    const centerY = (viewBox[3] + viewBox[1]) / 2;\n    let rotateA, rotateB, rotateC, rotateD;\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    switch (rotation) {\n      case 180:\n        rotateA = -1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = 1;\n        break;\n      case 90:\n        rotateA = 0;\n        rotateB = 1;\n        rotateC = 1;\n        rotateD = 0;\n        break;\n      case 270:\n        rotateA = 0;\n        rotateB = -1;\n        rotateC = -1;\n        rotateD = 0;\n        break;\n      case 0:\n        rotateA = 1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = -1;\n        break;\n      default:\n        throw new Error(\n          \"PageViewport: Invalid rotation, must be a multiple of 90 degrees.\"\n        );\n    }\n\n    if (dontFlip) {\n      rotateC = -rotateC;\n      rotateD = -rotateD;\n    }\n\n    let offsetCanvasX, offsetCanvasY;\n    let width, height;\n    if (rotateA === 0) {\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\n      width = (viewBox[3] - viewBox[1]) * scale;\n      height = (viewBox[2] - viewBox[0]) * scale;\n    } else {\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\n      width = (viewBox[2] - viewBox[0]) * scale;\n      height = (viewBox[3] - viewBox[1]) * scale;\n    }\n    // creating transform for the following operations:\n    // translate(-centerX, -centerY), rotate and flip vertically,\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\n    this.transform = [\n      rotateA * scale,\n      rotateB * scale,\n      rotateC * scale,\n      rotateD * scale,\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,\n    ];\n\n    this.width = width;\n    this.height = height;\n  }\n\n  /**\n   * The original, un-scaled, viewport dimensions.\n   * @type {Object}\n   */\n  get rawDims() {\n    const dims = this.viewBox;\n\n    return shadow(this, \"rawDims\", {\n      pageWidth: dims[2] - dims[0],\n      pageHeight: dims[3] - dims[1],\n      pageX: dims[0],\n      pageY: dims[1],\n    });\n  }\n\n  /**\n   * Clones viewport, with optional additional properties.\n   * @param {PageViewportCloneParameters} [params]\n   * @returns {PageViewport} Cloned viewport.\n   */\n  clone({\n    scale = this.scale,\n    rotation = this.rotation,\n    offsetX = this.offsetX,\n    offsetY = this.offsetY,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.viewBox.slice(),\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * Converts PDF point to the viewport coordinates. For examples, useful for\n   * converting PDF location into canvas pixel coordinates.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the viewport coordinate space.\n   * @see {@link convertToPdfPoint}\n   * @see {@link convertToViewportRectangle}\n   */\n  convertToViewportPoint(x, y) {\n    const p = [x, y];\n    Util.applyTransform(p, this.transform);\n    return p;\n  }\n\n  /**\n   * Converts PDF rectangle to the viewport coordinates.\n   * @param {Array} rect - The xMin, yMin, xMax and yMax coordinates.\n   * @returns {Array} Array containing corresponding coordinates of the\n   *   rectangle in the viewport coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToViewportRectangle(rect) {\n    const topLeft = [rect[0], rect[1]];\n    Util.applyTransform(topLeft, this.transform);\n    const bottomRight = [rect[2], rect[3]];\n    Util.applyTransform(bottomRight, this.transform);\n    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];\n  }\n\n  /**\n   * Converts viewport coordinates to the PDF location. For examples, useful\n   * for converting canvas pixel location into PDF one.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the PDF coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToPdfPoint(x, y) {\n    const p = [x, y];\n    Util.applyInverseTransform(p, this.transform);\n    return p;\n  }\n}\n\nclass RenderingCancelledException extends BaseException {\n  constructor(msg, extraDelay = 0) {\n    super(msg, \"RenderingCancelledException\");\n    this.extraDelay = extraDelay;\n  }\n}\n\nfunction isDataScheme(url) {\n  const ii = url.length;\n  let i = 0;\n  while (i < ii && url[i].trim() === \"\") {\n    i++;\n  }\n  return url.substring(i, i + 5).toLowerCase() === \"data:\";\n}\n\nfunction isPdfFile(filename) {\n  return typeof filename === \"string\" && /\\.pdf$/i.test(filename);\n}\n\n/**\n * Gets the filename from a given URL.\n * @param {string} url\n * @returns {string}\n */\nfunction getFilenameFromUrl(url) {\n  [url] = url.split(/[#?]/, 1);\n  return url.substring(url.lastIndexOf(\"/\") + 1);\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * @param {string} url - The original PDF location.\n * @param {string} defaultFilename - The value returned if the filename is\n *   unknown, or the protocol is unsupported.\n * @returns {string} Guessed PDF filename.\n */\nfunction getPdfFilenameFromUrl(url, defaultFilename = \"document.pdf\") {\n  if (typeof url !== \"string\") {\n    return defaultFilename;\n  }\n  if (isDataScheme(url)) {\n    warn('getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.');\n    return defaultFilename;\n  }\n\n  const getURL = urlString => {\n    try {\n      return new URL(urlString);\n    } catch {\n      try {\n        return new URL(decodeURIComponent(urlString));\n      } catch {\n        try {\n          // Attempt to parse the URL using the document's base URI.\n          return new URL(urlString, \"https://foo.bar\");\n        } catch {\n          try {\n            return new URL(decodeURIComponent(urlString), \"https://foo.bar\");\n          } catch {\n            return null;\n          }\n        }\n      }\n    }\n  };\n\n  const newURL = getURL(url);\n  if (!newURL) {\n    // If the URL is invalid, return the default filename.\n    return defaultFilename;\n  }\n\n  const decode = name => {\n    try {\n      let decoded = decodeURIComponent(name);\n      if (decoded.includes(\"/\")) {\n        decoded = decoded.split(\"/\").at(-1);\n        if (decoded.test(/^\\.pdf$/i)) {\n          return decoded;\n        }\n        return name;\n      }\n      return decoded;\n    } catch {\n      return name;\n    }\n  };\n\n  const pdfRegex = /\\.pdf$/i;\n  const filename = newURL.pathname.split(\"/\").at(-1);\n  if (pdfRegex.test(filename)) {\n    return decode(filename);\n  }\n\n  if (newURL.searchParams.size > 0) {\n    const values = Array.from(newURL.searchParams.values()).reverse();\n    for (const value of values) {\n      if (pdfRegex.test(value)) {\n        // If any of the search parameters ends with \".pdf\", return it.\n        return decode(value);\n      }\n    }\n    const keys = Array.from(newURL.searchParams.keys()).reverse();\n    for (const key of keys) {\n      if (pdfRegex.test(key)) {\n        // If any of the search parameter keys ends with \".pdf\", return it.\n        return decode(key);\n      }\n    }\n  }\n\n  if (newURL.hash) {\n    const reFilename = /[^/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n    const hashFilename = reFilename.exec(newURL.hash);\n    if (hashFilename) {\n      return decode(hashFilename[0]);\n    }\n  }\n\n  return defaultFilename;\n}\n\nclass StatTimer {\n  started = Object.create(null);\n\n  times = [];\n\n  time(name) {\n    if (name in this.started) {\n      warn(`Timer is already running for ${name}`);\n    }\n    this.started[name] = Date.now();\n  }\n\n  timeEnd(name) {\n    if (!(name in this.started)) {\n      warn(`Timer has not been started for ${name}`);\n    }\n    this.times.push({\n      name,\n      start: this.started[name],\n      end: Date.now(),\n    });\n    // Remove timer from started so it can be called again.\n    delete this.started[name];\n  }\n\n  toString() {\n    // Find the longest name for padding purposes.\n    const outBuf = [];\n    let longest = 0;\n    for (const { name } of this.times) {\n      longest = Math.max(name.length, longest);\n    }\n    for (const { name, start, end } of this.times) {\n      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\\n`);\n    }\n    return outBuf.join(\"\");\n  }\n}\n\nfunction isValidFetchUrl(url, baseUrl) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    throw new Error(\"Not implemented: isValidFetchUrl\");\n  }\n  const res = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  // The Fetch API only supports the http/https protocols, and not file/ftp.\n  return res?.protocol === \"http:\" || res?.protocol === \"https:\";\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenu(e) {\n  e.preventDefault();\n}\n\nfunction stopEvent(e) {\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n// Deprecated API function -- display regardless of the `verbosity` setting.\nfunction deprecated(details) {\n  // eslint-disable-next-line no-console\n  console.log(\"Deprecated API usage: \" + details);\n}\n\nclass PDFDateString {\n  static #regex;\n\n  /**\n   * Convert a PDF date string to a JavaScript `Date` object.\n   *\n   * The PDF date string format is described in section 7.9.4 of the official\n   * PDF 32000-1:2008 specification. However, in the PDF 1.7 reference (sixth\n   * edition) Adobe describes the same format including a trailing apostrophe.\n   * This syntax in incorrect, but Adobe Acrobat creates PDF files that contain\n   * them. We ignore all apostrophes as they are not necessary for date parsing.\n   *\n   * Moreover, Adobe Acrobat doesn't handle changing the date to universal time\n   * and doesn't use the user's time zone (effectively ignoring the HH' and mm'\n   * parts of the date string).\n   *\n   * @param {string} input\n   * @returns {Date|null}\n   */\n  static toDateObject(input) {\n    if (input instanceof Date) {\n      return input;\n    }\n    if (!input || typeof input !== \"string\") {\n      return null;\n    }\n\n    // Lazily initialize the regular expression.\n    this.#regex ||= new RegExp(\n      \"^D:\" + // Prefix (required)\n        \"(\\\\d{4})\" + // Year (required)\n        \"(\\\\d{2})?\" + // Month (optional)\n        \"(\\\\d{2})?\" + // Day (optional)\n        \"(\\\\d{2})?\" + // Hour (optional)\n        \"(\\\\d{2})?\" + // Minute (optional)\n        \"(\\\\d{2})?\" + // Second (optional)\n        \"([Z|+|-])?\" + // Universal time relation (optional)\n        \"(\\\\d{2})?\" + // Offset hour (optional)\n        \"'?\" + // Splitting apostrophe (optional)\n        \"(\\\\d{2})?\" + // Offset minute (optional)\n        \"'?\" // Trailing apostrophe (optional)\n    );\n\n    // Optional fields that don't satisfy the requirements from the regular\n    // expression (such as incorrect digit counts or numbers that are out of\n    // range) will fall back the defaults from the specification.\n    const matches = this.#regex.exec(input);\n    if (!matches) {\n      return null;\n    }\n\n    // JavaScript's `Date` object expects the month to be between 0 and 11\n    // instead of 1 and 12, so we have to correct for that.\n    const year = parseInt(matches[1], 10);\n    let month = parseInt(matches[2], 10);\n    month = month >= 1 && month <= 12 ? month - 1 : 0;\n    let day = parseInt(matches[3], 10);\n    day = day >= 1 && day <= 31 ? day : 1;\n    let hour = parseInt(matches[4], 10);\n    hour = hour >= 0 && hour <= 23 ? hour : 0;\n    let minute = parseInt(matches[5], 10);\n    minute = minute >= 0 && minute <= 59 ? minute : 0;\n    let second = parseInt(matches[6], 10);\n    second = second >= 0 && second <= 59 ? second : 0;\n    const universalTimeRelation = matches[7] || \"Z\";\n    let offsetHour = parseInt(matches[8], 10);\n    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;\n    let offsetMinute = parseInt(matches[9], 10) || 0;\n    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;\n\n    // Universal time relation 'Z' means that the local time is equal to the\n    // universal time, whereas the relations '+'/'-' indicate that the local\n    // time is later respectively earlier than the universal time. Every date\n    // is normalized to universal time.\n    if (universalTimeRelation === \"-\") {\n      hour += offsetHour;\n      minute += offsetMinute;\n    } else if (universalTimeRelation === \"+\") {\n      hour -= offsetHour;\n      minute -= offsetMinute;\n    }\n\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n}\n\n/**\n * NOTE: This is (mostly) intended to support printing of XFA forms.\n */\nfunction getXfaPageViewport(xfaPage, { scale = 1, rotation = 0 }) {\n  const { width, height } = xfaPage.attributes.style;\n  const viewBox = [0, 0, parseInt(width), parseInt(height)];\n\n  return new PageViewport({\n    viewBox,\n    userUnit: 1,\n    scale,\n    rotation,\n  });\n}\n\nfunction getRGB(color) {\n  if (color.startsWith(\"#\")) {\n    const colorRGB = parseInt(color.slice(1), 16);\n    return [\n      (colorRGB & 0xff0000) >> 16,\n      (colorRGB & 0x00ff00) >> 8,\n      colorRGB & 0x0000ff,\n    ];\n  }\n\n  if (color.startsWith(\"rgb(\")) {\n    // getComputedStyle(...).color returns a `rgb(R, G, B)` color.\n    return color\n      .slice(/* \"rgb(\".length */ 4, -1) // Strip out \"rgb(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x));\n  }\n\n  if (color.startsWith(\"rgba(\")) {\n    return color\n      .slice(/* \"rgba(\".length */ 5, -1) // Strip out \"rgba(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x))\n      .slice(0, 3);\n  }\n\n  warn(`Not a valid color format: \"${color}\"`);\n  return [0, 0, 0];\n}\n\nfunction getColorValues(colors) {\n  const span = document.createElement(\"span\");\n  span.style.visibility = \"hidden\";\n  // NOTE: The following does *not* affect `forced-colors: active` mode.\n  span.style.colorScheme = \"only light\";\n  document.body.append(span);\n  for (const name of colors.keys()) {\n    span.style.color = name;\n    const computedColor = window.getComputedStyle(span).color;\n    colors.set(name, getRGB(computedColor));\n  }\n  span.remove();\n}\n\nfunction getCurrentTransform(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform();\n  return [a, b, c, d, e, f];\n}\n\nfunction getCurrentTransformInverse(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform().invertSelf();\n  return [a, b, c, d, e, f];\n}\n\n/**\n * @param {HTMLDivElement} div\n * @param {PageViewport} viewport\n * @param {boolean} mustFlip\n * @param {boolean} mustRotate\n */\nfunction setLayerDimensions(\n  div,\n  viewport,\n  mustFlip = false,\n  mustRotate = true\n) {\n  if (viewport instanceof PageViewport) {\n    const { pageWidth, pageHeight } = viewport.rawDims;\n    const { style } = div;\n    const useRound = FeatureTest.isCSSRoundSupported;\n\n    const w = `var(--total-scale-factor) * ${pageWidth}px`,\n      h = `var(--total-scale-factor) * ${pageHeight}px`;\n    const widthStr = useRound\n        ? `round(down, ${w}, var(--scale-round-x))`\n        : `calc(${w})`,\n      heightStr = useRound\n        ? `round(down, ${h}, var(--scale-round-y))`\n        : `calc(${h})`;\n\n    if (!mustFlip || viewport.rotation % 180 === 0) {\n      style.width = widthStr;\n      style.height = heightStr;\n    } else {\n      style.width = heightStr;\n      style.height = widthStr;\n    }\n  }\n\n  if (mustRotate) {\n    div.setAttribute(\"data-main-rotation\", viewport.rotation);\n  }\n}\n\n/**\n * Scale factors for the canvas, necessary with HiDPI displays.\n */\nclass OutputScale {\n  constructor() {\n    const { pixelRatio } = OutputScale;\n\n    /**\n     * @type {number} Horizontal scale.\n     */\n    this.sx = pixelRatio;\n\n    /**\n     * @type {number} Vertical scale.\n     */\n    this.sy = pixelRatio;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is required, `false` otherwise.\n   */\n  get scaled() {\n    return this.sx !== 1 || this.sy !== 1;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is symmetric,\n   *   `false` otherwise.\n   */\n  get symmetric() {\n    return this.sx === this.sy;\n  }\n\n  /**\n   * @returns {boolean} Returns `true` if scaling was limited,\n   *   `false` otherwise.\n   */\n  limitCanvas(width, height, maxPixels, maxDim, capAreaFactor = -1) {\n    let maxAreaScale = Infinity,\n      maxWidthScale = Infinity,\n      maxHeightScale = Infinity;\n\n    maxPixels = OutputScale.capPixels(maxPixels, capAreaFactor);\n    if (maxPixels > 0) {\n      maxAreaScale = Math.sqrt(maxPixels / (width * height));\n    }\n    if (maxDim !== -1) {\n      maxWidthScale = maxDim / width;\n      maxHeightScale = maxDim / height;\n    }\n    const maxScale = Math.min(maxAreaScale, maxWidthScale, maxHeightScale);\n\n    if (this.sx > maxScale || this.sy > maxScale) {\n      this.sx = maxScale;\n      this.sy = maxScale;\n      return true;\n    }\n    return false;\n  }\n\n  static get pixelRatio() {\n    return globalThis.devicePixelRatio || 1;\n  }\n\n  static capPixels(maxPixels, capAreaFactor) {\n    if (capAreaFactor >= 0) {\n      const winPixels = Math.ceil(\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")\n          ? window.innerWidth * window.innerHeight\n          : window.screen.availWidth * window.screen.availHeight) *\n          this.pixelRatio ** 2 *\n          (1 + capAreaFactor / 100)\n      );\n      return maxPixels > 0 ? Math.min(maxPixels, winPixels) : winPixels;\n    }\n    return maxPixels;\n  }\n}\n\n// See https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types\n// to know which types are supported by the browser.\nconst SupportedImageMimeTypes = [\n  \"image/apng\",\n  \"image/avif\",\n  \"image/bmp\",\n  \"image/gif\",\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/svg+xml\",\n  \"image/webp\",\n  \"image/x-icon\",\n];\n\nclass ColorScheme {\n  static get isDarkMode() {\n    return shadow(\n      this,\n      \"isDarkMode\",\n      !!window?.matchMedia?.(\"(prefers-color-scheme: dark)\").matches\n    );\n  }\n}\n\nclass CSSConstants {\n  static get commentForegroundColor() {\n    const element = document.createElement(\"span\");\n    element.classList.add(\"comment\", \"sidebar\");\n    const { style } = element;\n    style.width = style.height = \"0\";\n    style.display = \"none\";\n    style.color = \"var(--comment-fg-color)\";\n    document.body.append(element);\n    const { color } = window.getComputedStyle(element);\n    element.remove();\n    return shadow(this, \"commentForegroundColor\", getRGB(color));\n  }\n}\n\nfunction applyOpacity(r, g, b, opacity) {\n  opacity = Math.min(Math.max(opacity ?? 1, 0), 1);\n  const white = 255 * (1 - opacity);\n  r = Math.round(r * opacity + white);\n  g = Math.round(g * opacity + white);\n  b = Math.round(b * opacity + white);\n  return [r, g, b];\n}\n\nfunction RGBToHSL(rgb, output) {\n  const r = rgb[0] / 255;\n  const g = rgb[1] / 255;\n  const b = rgb[2] / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const l = (max + min) / 2;\n\n  if (max === min) {\n    // achromatic\n    output[0] = output[1] = 0; // hue and saturation are 0\n  } else {\n    const d = max - min;\n    output[1] = l < 0.5 ? d / (max + min) : d / (2 - max - min);\n    // hue\n    switch (max) {\n      case r:\n        output[0] = ((g - b) / d + (g < b ? 6 : 0)) * 60;\n        break;\n      case g:\n        output[0] = ((b - r) / d + 2) * 60;\n        break;\n      case b:\n        output[0] = ((r - g) / d + 4) * 60;\n        break;\n    }\n  }\n  output[2] = l;\n}\n\nfunction HSLToRGB(hsl, output) {\n  const h = hsl[0];\n  const s = hsl[1];\n  const l = hsl[2];\n  const c = (1 - Math.abs(2 * l - 1)) * s; // chroma\n  const x = c * (1 - Math.abs(((h / 60) % 2) - 1));\n  const m = l - c / 2;\n\n  switch (Math.floor(h / 60)) {\n    case 0:\n      output[0] = c + m;\n      output[1] = x + m;\n      output[2] = m;\n      break;\n    case 1:\n      output[0] = x + m;\n      output[1] = c + m;\n      output[2] = m;\n      break;\n    case 2:\n      output[0] = m;\n      output[1] = c + m;\n      output[2] = x + m;\n      break;\n    case 3:\n      output[0] = m;\n      output[1] = x + m;\n      output[2] = c + m;\n      break;\n    case 4:\n      output[0] = x + m;\n      output[1] = m;\n      output[2] = c + m;\n      break;\n    case 5:\n    case 6:\n      output[0] = c + m;\n      output[1] = m;\n      output[2] = x + m;\n      break;\n  }\n}\n\nfunction computeLuminance(x) {\n  return x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n}\n\nfunction contrastRatio(hsl1, hsl2, output) {\n  HSLToRGB(hsl1, output);\n  output.map(computeLuminance);\n  const lum1 = 0.2126 * output[0] + 0.7152 * output[1] + 0.0722 * output[2];\n  HSLToRGB(hsl2, output);\n  output.map(computeLuminance);\n  const lum2 = 0.2126 * output[0] + 0.7152 * output[1] + 0.0722 * output[2];\n  return lum1 > lum2\n    ? (lum1 + 0.05) / (lum2 + 0.05)\n    : (lum2 + 0.05) / (lum1 + 0.05);\n}\n\n// Cache for the findContrastColor function, to improve performance.\nconst contrastCache = new Map();\n\n/**\n * Find a color that has sufficient contrast against a fixed color.\n * The luminance (in HSL color space) of the base color is adjusted\n * until the contrast ratio between the base color and the fixed color\n * is at least the minimum contrast ratio required by WCAG 2.1.\n * @param {Array<number>} baseColor\n * @param {Array<number>} fixedColor\n * @returns {string}\n */\nfunction findContrastColor(baseColor, fixedColor) {\n  const key =\n    baseColor[0] +\n    baseColor[1] * 0x100 +\n    baseColor[2] * 0x10000 +\n    fixedColor[0] * 0x1000000 +\n    fixedColor[1] * 0x100000000 +\n    fixedColor[2] * 0x10000000000;\n  let cachedValue = contrastCache.get(key);\n  if (cachedValue) {\n    return cachedValue;\n  }\n  const array = new Float32Array(9);\n  const output = array.subarray(0, 3);\n  const baseHSL = array.subarray(3, 6);\n  RGBToHSL(baseColor, baseHSL);\n  const fixedHSL = array.subarray(6, 9);\n  RGBToHSL(fixedColor, fixedHSL);\n  const isFixedColorDark = fixedHSL[2] < 0.5;\n\n  // Use the contrast ratio requirements from WCAG 2.1.\n  // https://www.w3.org/TR/WCAG21/#contrast-minimum\n  // https://www.w3.org/TR/WCAG21/#contrast-enhanced\n  const minContrast = isFixedColorDark ? 12 : 4.5;\n\n  baseHSL[2] = isFixedColorDark\n    ? Math.sqrt(baseHSL[2])\n    : 1 - Math.sqrt(1 - baseHSL[2]);\n\n  if (contrastRatio(baseHSL, fixedHSL, output) < minContrast) {\n    let start, end;\n    if (isFixedColorDark) {\n      start = baseHSL[2];\n      end = 1;\n    } else {\n      start = 0;\n      end = baseHSL[2];\n    }\n    const PRECISION = 0.005;\n    while (end - start > PRECISION) {\n      const mid = (baseHSL[2] = (start + end) / 2);\n      if (\n        isFixedColorDark ===\n        contrastRatio(baseHSL, fixedHSL, output) < minContrast\n      ) {\n        start = mid;\n      } else {\n        end = mid;\n      }\n    }\n    baseHSL[2] = isFixedColorDark ? end : start;\n  }\n\n  HSLToRGB(baseHSL, output);\n  cachedValue = Util.makeHexColor(\n    Math.round(output[0] * 255),\n    Math.round(output[1] * 255),\n    Math.round(output[2] * 255)\n  );\n  contrastCache.set(key, cachedValue);\n  return cachedValue;\n}\n\nfunction renderRichText({ html, dir, className }, container) {\n  const fragment = document.createDocumentFragment();\n  if (typeof html === \"string\") {\n    const p = document.createElement(\"p\");\n    p.dir = dir || \"auto\";\n    const lines = html.split(/(?:\\r\\n?|\\n)/);\n    for (let i = 0, ii = lines.length; i < ii; ++i) {\n      const line = lines[i];\n      p.append(document.createTextNode(line));\n      if (i < ii - 1) {\n        p.append(document.createElement(\"br\"));\n      }\n    }\n    fragment.append(p);\n  } else {\n    XfaLayer.render({\n      xfaHtml: html,\n      div: fragment,\n      intent: \"richText\",\n    });\n  }\n  fragment.firstElementChild.classList.add(\"richText\", className);\n  container.append(fragment);\n}\n\nfunction makePathFromDrawOPS(data) {\n  // Using a SVG string is slightly slower than using the following loop.\n  const path = new Path2D();\n  if (!data) {\n    return path;\n  }\n  for (let i = 0, ii = data.length; i < ii; ) {\n    switch (data[i++]) {\n      case DrawOPS.moveTo:\n        path.moveTo(data[i++], data[i++]);\n        break;\n      case DrawOPS.lineTo:\n        path.lineTo(data[i++], data[i++]);\n        break;\n      case DrawOPS.curveTo:\n        path.bezierCurveTo(\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++],\n          data[i++]\n        );\n        break;\n      case DrawOPS.quadraticCurveTo:\n        path.quadraticCurveTo(data[i++], data[i++], data[i++], data[i++]);\n        break;\n      case DrawOPS.closePath:\n        path.closePath();\n        break;\n      default:\n        warn(`Unrecognized drawing path operator: ${data[i - 1]}`);\n        break;\n    }\n  }\n  return path;\n}\n\nexport {\n  applyOpacity,\n  ColorScheme,\n  CSSConstants,\n  deprecated,\n  fetchData,\n  findContrastColor,\n  getColorValues,\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  isValidFetchUrl,\n  makePathFromDrawOPS,\n  noContextMenu,\n  OutputScale,\n  PageViewport,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  setLayerDimensions,\n  StatTimer,\n  stopEvent,\n  SupportedImageMimeTypes,\n  SVG_NS,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\n\nclass EditorToolbar {\n  #toolbar = null;\n\n  #colorPicker = null;\n\n  #editor;\n\n  #buttons = null;\n\n  #altText = null;\n\n  #comment = null;\n\n  #commentButtonDivider = null;\n\n  #signatureDescriptionButton = null;\n\n  static #l10nRemove = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n\n    EditorToolbar.#l10nRemove ||= Object.freeze({\n      freetext: \"pdfjs-editor-remove-freetext-button\",\n      highlight: \"pdfjs-editor-remove-highlight-button\",\n      ink: \"pdfjs-editor-remove-ink-button\",\n      stamp: \"pdfjs-editor-remove-stamp-button\",\n      signature: \"pdfjs-editor-remove-signature-button\",\n    });\n  }\n\n  render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.classList.add(\"editToolbar\", \"hidden\");\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n\n    const signal = this.#editor._uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      editToolbar.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      editToolbar.addEventListener(\"pointerdown\", EditorToolbar.#pointerDown, {\n        signal,\n      });\n    }\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    const position = this.#editor.toolbarPosition;\n    if (position) {\n      const { style } = editToolbar;\n      const x =\n        this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0];\n      style.insetInlineEnd = `${100 * x}%`;\n      style.top = `calc(${\n        100 * position[1]\n      }% + var(--editor-toolbar-vert-offset))`;\n    }\n\n    return editToolbar;\n  }\n\n  get div() {\n    return this.#toolbar;\n  }\n\n  static #pointerDown(e) {\n    e.stopPropagation();\n  }\n\n  #focusIn(e) {\n    this.#editor._focusEventsAllowed = false;\n    stopEvent(e);\n  }\n\n  #focusOut(e) {\n    this.#editor._focusEventsAllowed = true;\n    stopEvent(e);\n  }\n\n  #addListenersToElement(element) {\n    // If we're clicking on a button with the keyboard or with\n    // the mouse, we don't want to trigger any focus events on\n    // the editor.\n    const signal = this.#editor._uiManager._signal;\n    if (!(signal instanceof AbortSignal) || signal.aborted) {\n      return false;\n    }\n    element.addEventListener(\"focusin\", this.#focusIn.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"focusout\", this.#focusOut.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    return true;\n  }\n\n  hide() {\n    this.#toolbar.classList.add(\"hidden\");\n    this.#colorPicker?.hideDropdown();\n  }\n\n  show() {\n    this.#toolbar.classList.remove(\"hidden\");\n    this.#altText?.shown();\n    this.#comment?.shown();\n  }\n\n  addDeleteButton() {\n    const { editorType, _uiManager } = this.#editor;\n\n    const button = document.createElement(\"button\");\n    button.classList.add(\"basic\", \"deleteButton\");\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", EditorToolbar.#l10nRemove[editorType]);\n    if (this.#addListenersToElement(button)) {\n      button.addEventListener(\n        \"click\",\n        e => {\n          _uiManager.delete();\n        },\n        { signal: _uiManager._signal }\n      );\n    }\n    this.#buttons.append(button);\n  }\n\n  get #divider() {\n    const divider = document.createElement(\"div\");\n    divider.className = \"divider\";\n    return divider;\n  }\n\n  async addAltText(altText) {\n    const button = await altText.render();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n    this.#altText = altText;\n  }\n\n  addComment(comment, beforeElement = null) {\n    if (this.#comment) {\n      return;\n    }\n    const button = comment.renderForToolbar();\n    if (!button) {\n      return;\n    }\n    this.#addListenersToElement(button);\n    const divider = (this.#commentButtonDivider = this.#divider);\n    if (!beforeElement) {\n      this.#buttons.append(button, divider);\n    } else {\n      this.#buttons.insertBefore(button, beforeElement);\n      this.#buttons.insertBefore(divider, beforeElement);\n    }\n    this.#comment = comment;\n    comment.toolbar = this;\n  }\n\n  addColorPicker(colorPicker) {\n    if (this.#colorPicker) {\n      return;\n    }\n    this.#colorPicker = colorPicker;\n    const button = colorPicker.renderButton();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  async addEditSignatureButton(signatureManager) {\n    const button = (this.#signatureDescriptionButton =\n      await signatureManager.renderEditButton(this.#editor));\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  removeButton(name) {\n    switch (name) {\n      case \"comment\":\n        this.#comment?.removeToolbarCommentButton();\n        this.#comment = null;\n        this.#commentButtonDivider?.remove();\n        this.#commentButtonDivider = null;\n        break;\n    }\n  }\n\n  async addButton(name, tool) {\n    switch (name) {\n      case \"colorPicker\":\n        if (tool) {\n          this.addColorPicker(tool);\n        }\n        break;\n      case \"altText\":\n        if (tool) {\n          await this.addAltText(tool);\n        }\n        break;\n      case \"editSignature\":\n        if (tool) {\n          await this.addEditSignatureButton(tool);\n        }\n        break;\n      case \"delete\":\n        this.addDeleteButton();\n        break;\n      case \"comment\":\n        if (tool) {\n          this.addComment(tool);\n        }\n        break;\n    }\n  }\n\n  async addButtonBefore(name, tool, beforeSelector) {\n    if (!tool && name === \"comment\") {\n      return;\n    }\n    const beforeElement = this.#buttons.querySelector(beforeSelector);\n    if (!beforeElement) {\n      return;\n    }\n    if (name === \"comment\") {\n      this.addComment(tool, beforeElement);\n    }\n  }\n\n  updateEditSignatureButton(description) {\n    if (this.#signatureDescriptionButton) {\n      this.#signatureDescriptionButton.title = description;\n    }\n  }\n\n  remove() {\n    this.#toolbar.remove();\n    this.#colorPicker?.destroy();\n    this.#colorPicker = null;\n  }\n}\n\nclass FloatingToolbar {\n  #buttons = null;\n\n  #toolbar = null;\n\n  #uiManager;\n\n  constructor(uiManager) {\n    this.#uiManager = uiManager;\n  }\n\n  #render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n\n    const signal = this.#uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      editToolbar.addEventListener(\"contextmenu\", noContextMenu, {\n        signal,\n      });\n    }\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    if (this.#uiManager.hasCommentManager()) {\n      this.#makeButton(\n        \"commentButton\",\n        `pdfjs-comment-floating-button`,\n        \"pdfjs-comment-floating-button-label\",\n        () => {\n          this.#uiManager.commentSelection(\"floating_button\");\n        }\n      );\n    }\n\n    this.#makeButton(\n      \"highlightButton\",\n      `pdfjs-highlight-floating-button1`,\n      \"pdfjs-highlight-floating-button-label\",\n      () => {\n        this.#uiManager.highlightSelection(\"floating_button\");\n      }\n    );\n\n    return editToolbar;\n  }\n\n  #getLastPoint(boxes, isLTR) {\n    let lastY = 0;\n    let lastX = 0;\n    for (const box of boxes) {\n      const y = box.y + box.height;\n      if (y < lastY) {\n        continue;\n      }\n      const x = box.x + (isLTR ? box.width : 0);\n      if (y > lastY) {\n        lastX = x;\n        lastY = y;\n        continue;\n      }\n      if (isLTR) {\n        if (x > lastX) {\n          lastX = x;\n        }\n      } else if (x < lastX) {\n        lastX = x;\n      }\n    }\n    return [isLTR ? 1 - lastX : lastX, lastY];\n  }\n\n  show(parent, boxes, isLTR) {\n    const [x, y] = this.#getLastPoint(boxes, isLTR);\n    const { style } = (this.#toolbar ||= this.#render());\n    parent.append(this.#toolbar);\n    style.insetInlineEnd = `${100 * x}%`;\n    style.top = `calc(${100 * y}% + var(--editor-toolbar-vert-offset))`;\n  }\n\n  hide() {\n    this.#toolbar.remove();\n  }\n\n  #makeButton(buttonClass, l10nId, labelL10nId, clickHandler) {\n    const button = document.createElement(\"button\");\n    button.classList.add(\"basic\", buttonClass);\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", l10nId);\n    const span = document.createElement(\"span\");\n    button.append(span);\n    span.className = \"visuallyHidden\";\n    span.setAttribute(\"data-l10n-id\", labelL10nId);\n    const signal = this.#uiManager._signal;\n    if (signal instanceof AbortSignal && !signal.aborted) {\n      button.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      button.addEventListener(\"click\", clickHandler, { signal });\n    }\n    this.#buttons.append(button);\n  }\n}\n\nexport { EditorToolbar, FloatingToolbar };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./editor.js\").AnnotationEditor} AnnotationEditor */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n  getUuid,\n  shadow,\n  Util,\n  warn,\n} from \"../../shared/util.js\";\nimport {\n  fetchData,\n  getColorValues,\n  getRGB,\n  PixelsPerInch,\n  stopEvent,\n} from \"../display_utils.js\";\nimport { FloatingToolbar } from \"./toolbar.js\";\n\nfunction bindEvents(obj, element, names) {\n  for (const name of names) {\n    element.addEventListener(name, obj[name].bind(obj));\n  }\n}\n\n/**\n * Class to store current pointers used by the editor to be able to handle\n * multiple pointers (e.g. two fingers, a pen, a mouse, ...).\n */\nclass CurrentPointers {\n  // To manage the pointer events.\n\n  // The pointerId  and pointerIds are used to keep track of\n  // the pointers with a same type (e.g. two fingers).\n  static #pointerId = NaN;\n\n  static #pointerIds = null;\n\n  // Track the timestamp to know if the touchmove event is used.\n  static #moveTimestamp = NaN;\n\n  // The pointerType is used to know if we are using a mouse, a pen or a touch.\n  static #pointerType = null;\n\n  static initializeAndAddPointerId(pointerId) {\n    // Store pointer ids. For example, the user is using a second finger.\n    (CurrentPointers.#pointerIds ||= new Set()).add(pointerId);\n  }\n\n  static setPointer(pointerType, pointerId) {\n    CurrentPointers.#pointerId ||= pointerId;\n    CurrentPointers.#pointerType ??= pointerType;\n  }\n\n  static setTimeStamp(timeStamp) {\n    CurrentPointers.#moveTimestamp = timeStamp;\n  }\n\n  static isSamePointerId(pointerId) {\n    return CurrentPointers.#pointerId === pointerId;\n  }\n\n  // Check if it's the same pointer id, otherwise remove it from the set.\n  static isSamePointerIdOrRemove(pointerId) {\n    if (CurrentPointers.#pointerId === pointerId) {\n      return true;\n    }\n\n    CurrentPointers.#pointerIds?.delete(pointerId);\n    return false;\n  }\n\n  static isSamePointerType(pointerType) {\n    return CurrentPointers.#pointerType === pointerType;\n  }\n\n  static isInitializedAndDifferentPointerType(pointerType) {\n    return (\n      CurrentPointers.#pointerType !== null &&\n      !CurrentPointers.isSamePointerType(pointerType)\n    );\n  }\n\n  static isSameTimeStamp(timeStamp) {\n    return CurrentPointers.#moveTimestamp === timeStamp;\n  }\n\n  static isUsingMultiplePointers() {\n    // Check if the user is using multiple fingers\n    return CurrentPointers.#pointerIds?.size >= 1;\n  }\n\n  static clearPointerType() {\n    CurrentPointers.#pointerType = null;\n  }\n\n  static clearPointerIds() {\n    CurrentPointers.#pointerId = NaN;\n    CurrentPointers.#pointerIds = null;\n  }\n\n  static clearTimeStamp() {\n    CurrentPointers.#moveTimestamp = NaN;\n  }\n}\n\n/**\n * Class to create some unique ids for the different editors.\n */\nclass IdManager {\n  #id = 0;\n\n  constructor() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => (this.#id = 0),\n      });\n      Object.defineProperty(this, \"getNextId\", {\n        value: () => this.#id,\n      });\n    }\n  }\n\n  /**\n   * Get a unique id.\n   * @returns {string}\n   */\n  get id() {\n    return `${AnnotationEditorPrefix}${this.#id++}`;\n  }\n}\n\n/**\n * Class to manage the images used by the editors.\n * The main idea is to try to minimize the memory used by the images.\n * The images are cached and reused when possible\n * We use a refCounter to know when an image is not used anymore but we need to\n * be able to restore an image after a remove+undo, so we keep a file reference\n * or an url one.\n */\nclass ImageManager {\n  #baseId = getUuid();\n\n  #id = 0;\n\n  #cache = null;\n\n  static get _isSVGFittingCanvas() {\n    // By default, Firefox doesn't rescale without preserving the aspect ratio\n    // when drawing an SVG image on a canvas, see https://bugzilla.mozilla.org/1547776.\n    // The \"workaround\" is to append \"svgView(preserveAspectRatio(none))\" to the\n    // url, but according to comment #15, it seems that it leads to unexpected\n    // behavior in Safari.\n    const svg = `data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>`;\n    const canvas = new OffscreenCanvas(1, 3);\n    const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });\n    const image = new Image();\n    image.src = svg;\n    const promise = image.decode().then(() => {\n      ctx.drawImage(image, 0, 0, 1, 1, 0, 0, 1, 3);\n      return new Uint32Array(ctx.getImageData(0, 0, 1, 1).data.buffer)[0] === 0;\n    });\n\n    return shadow(this, \"_isSVGFittingCanvas\", promise);\n  }\n\n  async #get(key, rawData) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(key);\n    if (data === null) {\n      // We already tried to load the image but it failed.\n      return null;\n    }\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    try {\n      data ||= {\n        bitmap: null,\n        id: `image_${this.#baseId}_${this.#id++}`,\n        refCounter: 0,\n        isSvg: false,\n      };\n      let image;\n      if (typeof rawData === \"string\") {\n        data.url = rawData;\n        image = await fetchData(rawData, \"blob\");\n      } else if (rawData instanceof File) {\n        image = data.file = rawData;\n      } else if (rawData instanceof Blob) {\n        image = rawData;\n      }\n\n      if (image.type === \"image/svg+xml\") {\n        // Unfortunately, createImageBitmap doesn't work with SVG images.\n        // (see https://bugzilla.mozilla.org/1841972).\n        const mustRemoveAspectRatioPromise = ImageManager._isSVGFittingCanvas;\n        const fileReader = new FileReader();\n        const imageElement = new Image();\n        const imagePromise = new Promise((resolve, reject) => {\n          imageElement.onload = () => {\n            data.bitmap = imageElement;\n            data.isSvg = true;\n            resolve();\n          };\n          fileReader.onload = async () => {\n            const url = (data.svgUrl = fileReader.result);\n            // We need to set the preserveAspectRatio to none in order to let\n            // the image fits the canvas when resizing.\n            imageElement.src = (await mustRemoveAspectRatioPromise)\n              ? `${url}#svgView(preserveAspectRatio(none))`\n              : url;\n          };\n          imageElement.onerror = fileReader.onerror = reject;\n        });\n        fileReader.readAsDataURL(image);\n        await imagePromise;\n      } else {\n        data.bitmap = await createImageBitmap(image);\n      }\n      data.refCounter = 1;\n    } catch (e) {\n      warn(e);\n      data = null;\n    }\n    this.#cache.set(key, data);\n    if (data) {\n      this.#cache.set(data.id, data);\n    }\n    return data;\n  }\n\n  async getFromFile(file) {\n    const { lastModified, name, size, type } = file;\n    return this.#get(`${lastModified}_${name}_${size}_${type}`, file);\n  }\n\n  async getFromUrl(url) {\n    return this.#get(url, url);\n  }\n\n  async getFromBlob(id, blobPromise) {\n    const blob = await blobPromise;\n    return this.#get(id, blob);\n  }\n\n  async getFromId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return null;\n    }\n    if (data.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n\n    if (data.file) {\n      return this.getFromFile(data.file);\n    }\n    if (data.blobPromise) {\n      const { blobPromise } = data;\n      delete data.blobPromise;\n      return this.getFromBlob(data.id, blobPromise);\n    }\n    return this.getFromUrl(data.url);\n  }\n\n  getFromCanvas(id, canvas) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(id);\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    const offscreen = new OffscreenCanvas(canvas.width, canvas.height);\n    const ctx = offscreen.getContext(\"2d\");\n    ctx.drawImage(canvas, 0, 0);\n    data = {\n      bitmap: offscreen.transferToImageBitmap(),\n      id: `image_${this.#baseId}_${this.#id++}`,\n      refCounter: 1,\n      isSvg: false,\n    };\n    this.#cache.set(id, data);\n    this.#cache.set(data.id, data);\n    return data;\n  }\n\n  getSvgUrl(id) {\n    const data = this.#cache.get(id);\n    if (!data?.isSvg) {\n      return null;\n    }\n    return data.svgUrl;\n  }\n\n  deleteId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return;\n    }\n    data.refCounter -= 1;\n    if (data.refCounter !== 0) {\n      return;\n    }\n    const { bitmap } = data;\n    if (!data.url && !data.file) {\n      // The image has no way to be restored (ctrl+z) so we must fix that.\n      const canvas = new OffscreenCanvas(bitmap.width, bitmap.height);\n      const ctx = canvas.getContext(\"bitmaprenderer\");\n      ctx.transferFromImageBitmap(bitmap);\n      data.blobPromise = canvas.convertToBlob();\n    }\n\n    bitmap.close?.();\n    data.bitmap = null;\n  }\n\n  // We can use the id only if it belongs this manager.\n  // We must take care of having the right manager because we can copy/paste\n  // some images from other documents, hence it'd be a pity to use an id from an\n  // other manager.\n  isValidId(id) {\n    return id.startsWith(`image_${this.#baseId}_`);\n  }\n}\n\n/**\n * Class to handle undo/redo.\n * Commands are just saved in a buffer.\n * If we hit some memory issues we could likely use a circular buffer.\n * It has to be used as a singleton.\n */\nclass CommandManager {\n  #commands = [];\n\n  #locked = false;\n\n  #maxSize;\n\n  #position = -1;\n\n  constructor(maxSize = 128) {\n    this.#maxSize = maxSize;\n  }\n\n  /**\n   * @typedef {Object} addOptions\n   * @property {function} cmd\n   * @property {function} undo\n   * @property {function} [post]\n   * @property {boolean} mustExec\n   * @property {number} type\n   * @property {boolean} overwriteIfSameType\n   * @property {boolean} keepUndo\n   */\n\n  /**\n   * Add a new couple of commands to be used in case of redo/undo.\n   * @param {addOptions} options\n   */\n  add({\n    cmd,\n    undo,\n    post,\n    mustExec,\n    type = NaN,\n    overwriteIfSameType = false,\n    keepUndo = false,\n  }) {\n    if (mustExec) {\n      cmd();\n    }\n\n    if (this.#locked) {\n      return;\n    }\n\n    const save = { cmd, undo, post, type };\n    if (this.#position === -1) {\n      if (this.#commands.length > 0) {\n        // All the commands have been undone and then a new one is added\n        // hence we clear the queue.\n        this.#commands.length = 0;\n      }\n      this.#position = 0;\n      this.#commands.push(save);\n      return;\n    }\n\n    if (overwriteIfSameType && this.#commands[this.#position].type === type) {\n      // For example when we change a color we don't want to\n      // be able to undo all the steps, hence we only want to\n      // keep the last undoable action in this sequence of actions.\n      if (keepUndo) {\n        save.undo = this.#commands[this.#position].undo;\n      }\n      this.#commands[this.#position] = save;\n      return;\n    }\n\n    const next = this.#position + 1;\n    if (next === this.#maxSize) {\n      this.#commands.splice(0, 1);\n    } else {\n      this.#position = next;\n      if (next < this.#commands.length) {\n        this.#commands.splice(next);\n      }\n    }\n\n    this.#commands.push(save);\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    if (this.#position === -1) {\n      // Nothing to undo.\n      return;\n    }\n\n    // Avoid to insert something during the undo execution.\n    this.#locked = true;\n    const { undo, post } = this.#commands[this.#position];\n    undo();\n    post?.();\n    this.#locked = false;\n\n    this.#position -= 1;\n  }\n\n  /**\n   * Redo the last command.\n   */\n  redo() {\n    if (this.#position < this.#commands.length - 1) {\n      this.#position += 1;\n\n      // Avoid to insert something during the redo execution.\n      this.#locked = true;\n      const { cmd, post } = this.#commands[this.#position];\n      cmd();\n      post?.();\n      this.#locked = false;\n    }\n  }\n\n  /**\n   * Check if there is something to undo.\n   * @returns {boolean}\n   */\n  hasSomethingToUndo() {\n    return this.#position !== -1;\n  }\n\n  /**\n   * Check if there is something to redo.\n   * @returns {boolean}\n   */\n  hasSomethingToRedo() {\n    return this.#position < this.#commands.length - 1;\n  }\n\n  cleanType(type) {\n    if (this.#position === -1) {\n      return;\n    }\n    for (let i = this.#position; i >= 0; i--) {\n      if (this.#commands[i].type !== type) {\n        this.#commands.splice(i + 1, this.#position - i);\n        this.#position = i;\n        return;\n      }\n    }\n    this.#commands.length = 0;\n    this.#position = -1;\n  }\n\n  destroy() {\n    this.#commands = null;\n  }\n}\n\n/**\n * Class to handle the different keyboards shortcuts we can have on mac or\n * non-mac OSes.\n */\nclass KeyboardManager {\n  /**\n   * Create a new keyboard manager class.\n   * @param {Array<Array>} callbacks - an array containing an array of shortcuts\n   * and a callback to call.\n   * A shortcut is a string like `ctrl+c` or `mac+ctrl+c` for mac OS.\n   */\n  constructor(callbacks) {\n    this.buffer = [];\n    this.callbacks = new Map();\n    this.allKeys = new Set();\n\n    const { isMac } = FeatureTest.platform;\n    for (const [keys, callback, options = {}] of callbacks) {\n      for (const key of keys) {\n        const isMacKey = key.startsWith(\"mac+\");\n        if (isMac && isMacKey) {\n          this.callbacks.set(key.slice(4), { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        } else if (!isMac && !isMacKey) {\n          this.callbacks.set(key, { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Serialize an event into a string in order to match a\n   * potential key for a callback.\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  #serialize(event) {\n    if (event.altKey) {\n      this.buffer.push(\"alt\");\n    }\n    if (event.ctrlKey) {\n      this.buffer.push(\"ctrl\");\n    }\n    if (event.metaKey) {\n      this.buffer.push(\"meta\");\n    }\n    if (event.shiftKey) {\n      this.buffer.push(\"shift\");\n    }\n    this.buffer.push(event.key);\n    const str = this.buffer.join(\"+\");\n    this.buffer.length = 0;\n\n    return str;\n  }\n\n  /**\n   * Execute a callback, if any, for a given keyboard event.\n   * The self is used as `this` in the callback.\n   * @param {Object} self\n   * @param {KeyboardEvent} event\n   * @returns\n   */\n  exec(self, event) {\n    if (!this.allKeys.has(event.key)) {\n      return;\n    }\n    const info = this.callbacks.get(this.#serialize(event));\n    if (!info) {\n      return;\n    }\n    const {\n      callback,\n      options: { bubbles = false, args = [], checker = null },\n    } = info;\n\n    if (checker && !checker(self, event)) {\n      return;\n    }\n    callback.bind(self, ...args, event)();\n\n    // For example, ctrl+s in a FreeText must be handled by the viewer, hence\n    // the event must bubble.\n    if (!bubbles) {\n      stopEvent(event);\n    }\n  }\n}\n\nclass ColorManager {\n  static _colorsMapping = new Map([\n    [\"CanvasText\", [0, 0, 0]],\n    [\"Canvas\", [255, 255, 255]],\n  ]);\n\n  get _colors() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"LIB\") &&\n      typeof document === \"undefined\"\n    ) {\n      return shadow(this, \"_colors\", ColorManager._colorsMapping);\n    }\n\n    const colors = new Map([\n      [\"CanvasText\", null],\n      [\"Canvas\", null],\n    ]);\n    getColorValues(colors);\n    return shadow(this, \"_colors\", colors);\n  }\n\n  /**\n   * In High Contrast Mode, the color on the screen is not always the\n   * real color used in the pdf.\n   * For example in some cases white can appear to be black but when saving\n   * we want to have white.\n   * @param {string} color\n   * @returns {Array<number>}\n   */\n  convert(color) {\n    const rgb = getRGB(color);\n    if (!window.matchMedia(\"(forced-colors: active)\").matches) {\n      return rgb;\n    }\n\n    for (const [name, RGB] of this._colors) {\n      if (RGB.every((x, i) => x === rgb[i])) {\n        return ColorManager._colorsMapping.get(name);\n      }\n    }\n    return rgb;\n  }\n\n  /**\n   * An input element must have its color value as a hex string\n   * and not as color name.\n   * So this function converts a name into an hex string.\n   * @param {string} name\n   * @returns {string}\n   */\n  getHexCode(name) {\n    const rgb = this._colors.get(name);\n    if (!rgb) {\n      return name;\n    }\n    return Util.makeHexColor(...rgb);\n  }\n}\n\n/**\n * A pdf has several pages and each of them when it will rendered\n * will have an AnnotationEditorLayer which will contain the some\n * new Annotations associated to an editor in order to modify them.\n *\n * This class is used to manage all the different layers, editors and\n * some action like copy/paste, undo/redo, ...\n */\nclass AnnotationEditorUIManager {\n  #abortController = new AbortController();\n\n  #activeEditor = null;\n\n  #allEditableAnnotations = null;\n\n  #allEditors = new Map();\n\n  #allLayers = new Map();\n\n  #altTextManager = null;\n\n  #annotationStorage = null;\n\n  #changedExistingAnnotations = null;\n\n  #commandManager = new CommandManager();\n\n  #commentManager = null;\n\n  #copyPasteAC = null;\n\n  #currentDrawingSession = null;\n\n  #currentPageIndex = 0;\n\n  #deletedAnnotationsElementIds = new Set();\n\n  #draggingEditors = null;\n\n  #editorTypes = null;\n\n  #editorsToRescale = new Set();\n\n  _editorUndoBar = null;\n\n  #enableHighlightFloatingButton = false;\n\n  #enableUpdatedAddImage = false;\n\n  #enableNewAltTextWhenAddingImage = false;\n\n  #filterFactory = null;\n\n  #focusMainContainerTimeoutId = null;\n\n  #focusManagerAC = null;\n\n  #highlightColors = null;\n\n  #highlightWhenShiftUp = false;\n\n  #floatingToolbar = null;\n\n  #idManager = new IdManager();\n\n  #isEnabled = false;\n\n  #isPointerDown = false;\n\n  #isWaiting = false;\n\n  #keyboardManagerAC = null;\n\n  #lastActiveElement = null;\n\n  #mainHighlightColorPicker = null;\n\n  #missingCanvases = null;\n\n  #mlManager = null;\n\n  #mode = AnnotationEditorType.NONE;\n\n  #selectedEditors = new Set();\n\n  #selectedTextNode = null;\n\n  #signatureManager = null;\n\n  #pageColors = null;\n\n  #showAllStates = null;\n\n  #pdfDocument = null;\n\n  #previousStates = {\n    isEditing: false,\n    isEmpty: true,\n    hasSomethingToUndo: false,\n    hasSomethingToRedo: false,\n    hasSelectedEditor: false,\n    hasSelectedText: false,\n  };\n\n  #translation = [0, 0];\n\n  #translationTimeoutId = null;\n\n  #container = null;\n\n  #viewer = null;\n\n  #viewerAlert = null;\n\n  #updateModeCapability = null;\n\n  static TRANSLATE_SMALL = 1; // page units.\n\n  static TRANSLATE_BIG = 10; // page units.\n\n  static get _keyboardManager() {\n    const proto = AnnotationEditorUIManager.prototype;\n\n    /**\n     * If the focused element is an input, we don't want to handle the arrow.\n     * For example, sliders can be controlled with the arrow keys.\n     */\n    const arrowChecker = self =>\n      self.#container.contains(document.activeElement) &&\n      document.activeElement.tagName !== \"BUTTON\" &&\n      self.hasSomethingToControl();\n\n    const textInputChecker = (_self, { target: el }) => {\n      if (el instanceof HTMLInputElement) {\n        const { type } = el;\n        return type !== \"text\" && type !== \"number\";\n      }\n      return true;\n    };\n\n    const small = this.TRANSLATE_SMALL;\n    const big = this.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"ctrl+a\", \"mac+meta+a\"],\n          proto.selectAll,\n          { checker: textInputChecker },\n        ],\n        [[\"ctrl+z\", \"mac+meta+z\"], proto.undo, { checker: textInputChecker }],\n        [\n          // On mac, depending of the OS version, the event.key is either \"z\" or\n          // \"Z\" when the user presses \"meta+shift+z\".\n          [\n            \"ctrl+y\",\n            \"ctrl+shift+z\",\n            \"mac+meta+shift+z\",\n            \"ctrl+shift+Z\",\n            \"mac+meta+shift+Z\",\n          ],\n          proto.redo,\n          { checker: textInputChecker },\n        ],\n        [\n          [\n            \"Backspace\",\n            \"alt+Backspace\",\n            \"ctrl+Backspace\",\n            \"shift+Backspace\",\n            \"mac+Backspace\",\n            \"mac+alt+Backspace\",\n            \"mac+ctrl+Backspace\",\n            \"Delete\",\n            \"ctrl+Delete\",\n            \"shift+Delete\",\n            \"mac+Delete\",\n          ],\n          proto.delete,\n          { checker: textInputChecker },\n        ],\n        [\n          [\"Enter\", \"mac+Enter\"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(el) &&\n              !self.isEnterHandled,\n          },\n        ],\n        [\n          [\" \", \"mac+ \"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(document.activeElement),\n          },\n        ],\n        [[\"Escape\", \"mac+Escape\"], proto.unselectAll],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  constructor(\n    container,\n    viewer,\n    viewerAlert,\n    altTextManager,\n    commentManager,\n    signatureManager,\n    eventBus,\n    pdfDocument,\n    pageColors,\n    highlightColors,\n    enableHighlightFloatingButton,\n    enableUpdatedAddImage,\n    enableNewAltTextWhenAddingImage,\n    mlManager,\n    editorUndoBar,\n    supportsPinchToZoom\n  ) {\n    const signal = (this._signal = this.#abortController.signal);\n    this.#container = container;\n    this.#viewer = viewer;\n    this.#viewerAlert = viewerAlert;\n    this.#altTextManager = altTextManager;\n    this.#commentManager = commentManager;\n    this.#signatureManager = signatureManager;\n    this.#pdfDocument = pdfDocument;\n    this._eventBus = eventBus;\n    eventBus._on(\"editingaction\", this.onEditingAction.bind(this), { signal });\n    eventBus._on(\"pagechanging\", this.onPageChanging.bind(this), { signal });\n    eventBus._on(\"scalechanging\", this.onScaleChanging.bind(this), { signal });\n    eventBus._on(\"rotationchanging\", this.onRotationChanging.bind(this), {\n      signal,\n    });\n    eventBus._on(\"setpreference\", this.onSetPreference.bind(this), { signal });\n    eventBus._on(\n      \"switchannotationeditorparams\",\n      evt => this.updateParams(evt.type, evt.value),\n      { signal }\n    );\n    window.addEventListener(\n      \"pointerdown\",\n      () => {\n        this.#isPointerDown = true;\n      },\n      { capture: true, signal }\n    );\n    window.addEventListener(\n      \"pointerup\",\n      () => {\n        this.#isPointerDown = false;\n      },\n      { capture: true, signal }\n    );\n    this.#addSelectionListener();\n    this.#addDragAndDropListeners();\n    this.#addKeyboardManager();\n    this.#annotationStorage = pdfDocument.annotationStorage;\n    this.#filterFactory = pdfDocument.filterFactory;\n    this.#pageColors = pageColors;\n    this.#highlightColors = highlightColors || null;\n    this.#enableHighlightFloatingButton = enableHighlightFloatingButton;\n    this.#enableUpdatedAddImage = enableUpdatedAddImage;\n    this.#enableNewAltTextWhenAddingImage = enableNewAltTextWhenAddingImage;\n    this.#mlManager = mlManager || null;\n    this.viewParameters = {\n      realScale: PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: 0,\n    };\n    this.isShiftKeyDown = false;\n    this._editorUndoBar = editorUndoBar || null;\n    this._supportsPinchToZoom = supportsPinchToZoom !== false;\n    commentManager?.setSidebarUiManager(this);\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => {\n          this.selectAll();\n          this.delete();\n          this.#idManager.reset();\n        },\n      });\n      Object.defineProperty(this, \"getNextEditorId\", {\n        value: () => this.#idManager.getNextId(),\n      });\n    }\n  }\n\n  destroy() {\n    this.#updateModeCapability?.resolve();\n    this.#updateModeCapability = null;\n\n    this.#abortController?.abort();\n    this.#abortController = null;\n    this._signal = null;\n\n    for (const layer of this.#allLayers.values()) {\n      layer.destroy();\n    }\n    this.#allLayers.clear();\n    this.#allEditors.clear();\n    this.#editorsToRescale.clear();\n    this.#missingCanvases?.clear();\n    this.#activeEditor = null;\n    this.#selectedEditors.clear();\n    this.#commandManager.destroy();\n    this.#altTextManager?.destroy();\n    this.#commentManager?.destroy();\n    this.#signatureManager?.destroy();\n    this.#floatingToolbar?.hide();\n    this.#floatingToolbar = null;\n    this.#mainHighlightColorPicker?.destroy();\n    this.#mainHighlightColorPicker = null;\n    this.#allEditableAnnotations = null;\n    if (this.#focusMainContainerTimeoutId) {\n      clearTimeout(this.#focusMainContainerTimeoutId);\n      this.#focusMainContainerTimeoutId = null;\n    }\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n      this.#translationTimeoutId = null;\n    }\n    this._editorUndoBar?.destroy();\n    this.#pdfDocument = null;\n  }\n\n  combinedSignal(ac) {\n    return AbortSignal.any([this._signal, ac.signal]);\n  }\n\n  get mlManager() {\n    return this.#mlManager;\n  }\n\n  get useNewAltTextFlow() {\n    return this.#enableUpdatedAddImage;\n  }\n\n  get useNewAltTextWhenAddingImage() {\n    return this.#enableNewAltTextWhenAddingImage;\n  }\n\n  get hcmFilter() {\n    return shadow(\n      this,\n      \"hcmFilter\",\n      this.#pageColors\n        ? this.#filterFactory.addHCMFilter(\n            this.#pageColors.foreground,\n            this.#pageColors.background\n          )\n        : \"none\"\n    );\n  }\n\n  get direction() {\n    return shadow(\n      this,\n      \"direction\",\n      getComputedStyle(this.#container).direction\n    );\n  }\n\n  get _highlightColors() {\n    return shadow(\n      this,\n      \"_highlightColors\",\n      this.#highlightColors\n        ? new Map(\n            this.#highlightColors.split(\",\").map(pair => {\n              pair = pair.split(\"=\").map(x => x.trim());\n              pair[1] = pair[1].toUpperCase();\n              return pair;\n            })\n          )\n        : null\n    );\n  }\n\n  get highlightColors() {\n    const { _highlightColors } = this;\n    if (!_highlightColors) {\n      return shadow(this, \"highlightColors\", null);\n    }\n    const map = new Map();\n    const hasHCM = !!this.#pageColors;\n    for (const [name, color] of _highlightColors) {\n      const isNameForHCM = name.endsWith(\"_HCM\");\n      if (hasHCM && isNameForHCM) {\n        map.set(name.replace(\"_HCM\", \"\"), color);\n        continue;\n      }\n      if (!hasHCM && !isNameForHCM) {\n        map.set(name, color);\n      }\n    }\n    return shadow(this, \"highlightColors\", map);\n  }\n\n  get highlightColorNames() {\n    return shadow(\n      this,\n      \"highlightColorNames\",\n      this.highlightColors\n        ? new Map(Array.from(this.highlightColors, e => e.reverse()))\n        : null\n    );\n  }\n\n  getNonHCMColor(color) {\n    if (!this._highlightColors) {\n      return color;\n    }\n    const colorName = this.highlightColorNames.get(color);\n    return this._highlightColors.get(colorName) || color;\n  }\n\n  getNonHCMColorName(color) {\n    return this.highlightColorNames.get(color) || color;\n  }\n\n  /**\n   * Set the current drawing session.\n   * @param {AnnotationEditorLayer} layer\n   */\n  setCurrentDrawingSession(layer) {\n    if (layer) {\n      this.unselectAll();\n      this.disableUserSelect(true);\n    } else {\n      this.disableUserSelect(false);\n    }\n    this.#currentDrawingSession = layer;\n  }\n\n  setMainHighlightColorPicker(colorPicker) {\n    this.#mainHighlightColorPicker = colorPicker;\n  }\n\n  editAltText(editor, firstTime = false) {\n    this.#altTextManager?.editAltText(this, editor, firstTime);\n  }\n\n  hasCommentManager() {\n    return !!this.#commentManager;\n  }\n\n  editComment(editor, posX, posY, options) {\n    this.#commentManager?.showDialog(this, editor, posX, posY, options);\n  }\n\n  selectComment(pageIndex, uid) {\n    const layer = this.#allLayers.get(pageIndex);\n    const editor = layer?.getEditorByUID(uid);\n    editor?.toggleComment(/* isSelected */ true, /* visibility */ true);\n  }\n\n  updateComment(editor) {\n    this.#commentManager?.updateComment(editor.getData());\n  }\n\n  updatePopupColor(editor) {\n    this.#commentManager?.updatePopupColor(editor);\n  }\n\n  removeComment(editor) {\n    this.#commentManager?.removeComments([editor.uid]);\n  }\n\n  toggleComment(editor, isSelected, visibility = undefined) {\n    this.#commentManager?.toggleCommentPopup(editor, isSelected, visibility);\n  }\n\n  makeCommentColor(color, opacity) {\n    return (\n      (color && this.#commentManager?.makeCommentColor(color, opacity)) || null\n    );\n  }\n\n  getCommentDialogElement() {\n    return this.#commentManager?.dialogElement || null;\n  }\n\n  async waitForEditorsRendered(pageNumber) {\n    if (this.#allLayers.has(pageNumber - 1)) {\n      return;\n    }\n    const { resolve, promise } = Promise.withResolvers();\n    const onEditorsRendered = evt => {\n      if (evt.pageNumber === pageNumber) {\n        this._eventBus._off(\"editorsrendered\", onEditorsRendered);\n        resolve();\n      }\n    };\n    this._eventBus.on(\"editorsrendered\", onEditorsRendered);\n    await promise;\n  }\n\n  getSignature(editor) {\n    this.#signatureManager?.getSignature({ uiManager: this, editor });\n  }\n\n  get signatureManager() {\n    return this.#signatureManager;\n  }\n\n  switchToMode(mode, callback) {\n    // Switching to a mode can be asynchronous.\n    this._eventBus.on(\"annotationeditormodechanged\", callback, {\n      once: true,\n      signal: this._signal,\n    });\n    this._eventBus.dispatch(\"showannotationeditorui\", {\n      source: this,\n      mode,\n    });\n  }\n\n  setPreference(name, value) {\n    this._eventBus.dispatch(\"setpreference\", {\n      source: this,\n      name,\n      value,\n    });\n  }\n\n  onSetPreference({ name, value }) {\n    switch (name) {\n      case \"enableNewAltTextWhenAddingImage\":\n        this.#enableNewAltTextWhenAddingImage = value;\n        break;\n    }\n  }\n\n  onPageChanging({ pageNumber }) {\n    this.#currentPageIndex = pageNumber - 1;\n  }\n\n  focusMainContainer() {\n    this.#container.focus();\n  }\n\n  findParent(x, y) {\n    for (const layer of this.#allLayers.values()) {\n      const {\n        x: layerX,\n        y: layerY,\n        width,\n        height,\n      } = layer.div.getBoundingClientRect();\n      if (\n        x >= layerX &&\n        x <= layerX + width &&\n        y >= layerY &&\n        y <= layerY + height\n      ) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  disableUserSelect(value = false) {\n    this.#viewer.classList.toggle(\"noUserSelect\", value);\n  }\n\n  addShouldRescale(editor) {\n    this.#editorsToRescale.add(editor);\n  }\n\n  removeShouldRescale(editor) {\n    this.#editorsToRescale.delete(editor);\n  }\n\n  onScaleChanging({ scale }) {\n    this.commitOrRemove();\n    this.viewParameters.realScale = scale * PixelsPerInch.PDF_TO_CSS_UNITS;\n    for (const editor of this.#editorsToRescale) {\n      editor.onScaleChanging();\n    }\n    this.#currentDrawingSession?.onScaleChanging();\n  }\n\n  onRotationChanging({ pagesRotation }) {\n    this.commitOrRemove();\n    this.viewParameters.rotation = pagesRotation;\n  }\n\n  #getAnchorElementForSelection({ anchorNode }) {\n    return anchorNode.nodeType === Node.TEXT_NODE\n      ? anchorNode.parentElement\n      : anchorNode;\n  }\n\n  #getLayerForTextLayer(textLayer) {\n    const { currentLayer } = this;\n    if (currentLayer.hasTextLayer(textLayer)) {\n      return currentLayer;\n    }\n    for (const layer of this.#allLayers.values()) {\n      if (layer.hasTextLayer(textLayer)) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  highlightSelection(methodOfCreation = \"\", comment = false) {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n    const text = selection.toString();\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    selection.empty();\n\n    const layer = this.#getLayerForTextLayer(textLayer);\n    const isNoneMode = this.#mode === AnnotationEditorType.NONE;\n    const callback = () => {\n      const editor = layer?.createAndAddNewEditor({ x: 0, y: 0 }, false, {\n        methodOfCreation,\n        boxes,\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n        text,\n      });\n      if (isNoneMode) {\n        this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n      }\n      if (comment) {\n        editor?.editComment();\n      }\n    };\n    if (isNoneMode) {\n      this.switchToMode(AnnotationEditorType.HIGHLIGHT, callback);\n      return;\n    }\n    callback();\n  }\n\n  commentSelection(methodOfCreation = \"\") {\n    this.highlightSelection(methodOfCreation, /* comment */ true);\n  }\n\n  #displayFloatingToolbar() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    this.#floatingToolbar ||= new FloatingToolbar(this);\n    this.#floatingToolbar.show(textLayer, boxes, this.direction === \"ltr\");\n  }\n\n  /**\n   * Some annotations may have been modified in the annotation layer\n   * (e.g. comments added or modified).\n   * So this function retrieves the data from the storage and removes\n   * them from the storage in order to be able to save them later.\n   * @param {string} annotationId\n   * @returns {Object|null} The data associated to the annotation or null.\n   */\n  getAndRemoveDataFromAnnotationStorage(annotationId) {\n    if (!this.#annotationStorage) {\n      return null;\n    }\n    const key = `${AnnotationEditorPrefix}${annotationId}`;\n    const storedValue = this.#annotationStorage.getRawValue(key);\n    if (storedValue) {\n      this.#annotationStorage.remove(key);\n    }\n    return storedValue;\n  }\n\n  /**\n   * Add an editor in the annotation storage.\n   * @param {AnnotationEditor} editor\n   */\n  addToAnnotationStorage(editor) {\n    if (\n      !editor.isEmpty() &&\n      this.#annotationStorage &&\n      !this.#annotationStorage.has(editor.id)\n    ) {\n      this.#annotationStorage.setValue(editor.id, editor);\n    }\n  }\n\n  a11yAlert(messageId, args = null) {\n    const viewerAlert = this.#viewerAlert;\n    if (!viewerAlert) {\n      return;\n    }\n    viewerAlert.setAttribute(\"data-l10n-id\", messageId);\n    if (args) {\n      viewerAlert.setAttribute(\"data-l10n-args\", JSON.stringify(args));\n    } else {\n      viewerAlert.removeAttribute(\"data-l10n-args\");\n    }\n  }\n\n  #selectionChange() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      if (this.#selectedTextNode) {\n        this.#floatingToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n    const { anchorNode } = selection;\n    if (anchorNode === this.#selectedTextNode) {\n      return;\n    }\n\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    if (!textLayer) {\n      if (this.#selectedTextNode) {\n        this.#floatingToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n\n    this.#floatingToolbar?.hide();\n    this.#selectedTextNode = anchorNode;\n    this.#dispatchUpdateStates({\n      hasSelectedText: true,\n    });\n\n    if (\n      this.#mode !== AnnotationEditorType.HIGHLIGHT &&\n      this.#mode !== AnnotationEditorType.NONE\n    ) {\n      return;\n    }\n\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n    }\n\n    this.#highlightWhenShiftUp = this.isShiftKeyDown;\n    if (!this.isShiftKeyDown) {\n      const activeLayer =\n        this.#mode === AnnotationEditorType.HIGHLIGHT\n          ? this.#getLayerForTextLayer(textLayer)\n          : null;\n      activeLayer?.toggleDrawing();\n\n      if (this.#isPointerDown) {\n        const ac = new AbortController();\n        const signal = this.combinedSignal(ac);\n\n        const pointerup = e => {\n          if (e.type === \"pointerup\" && e.button !== 0) {\n            // Do nothing on right click.\n            return;\n          }\n          ac.abort();\n          activeLayer?.toggleDrawing(true);\n          if (e.type === \"pointerup\") {\n            this.#onSelectEnd(\"main_toolbar\");\n          }\n        };\n        window.addEventListener(\"pointerup\", pointerup, { signal });\n        window.addEventListener(\"blur\", pointerup, { signal });\n      } else {\n        // Here neither the shift key nor the pointer is down and we've\n        // something in the selection: we can be in the case where the user is\n        // using a screen reader (see bug 1976597).\n        activeLayer?.toggleDrawing(true);\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  #onSelectEnd(methodOfCreation = \"\") {\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.highlightSelection(methodOfCreation);\n    } else if (this.#enableHighlightFloatingButton) {\n      this.#displayFloatingToolbar();\n    }\n  }\n\n  #addSelectionListener() {\n    document.addEventListener(\n      \"selectionchange\",\n      this.#selectionChange.bind(this),\n      { signal: this._signal }\n    );\n  }\n\n  #addFocusManager() {\n    if (this.#focusManagerAC) {\n      return;\n    }\n    this.#focusManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#focusManagerAC);\n\n    window.addEventListener(\"focus\", this.focus.bind(this), { signal });\n    window.addEventListener(\"blur\", this.blur.bind(this), { signal });\n  }\n\n  #removeFocusManager() {\n    this.#focusManagerAC?.abort();\n    this.#focusManagerAC = null;\n  }\n\n  blur() {\n    this.isShiftKeyDown = false;\n    if (this.#highlightWhenShiftUp) {\n      this.#highlightWhenShiftUp = false;\n      this.#onSelectEnd(\"main_toolbar\");\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n    // When several editors are selected and the window loses focus, we want to\n    // keep the last active element in order to be able to focus it again when\n    // the window gets the focus back but we don't want to trigger any focus\n    // callbacks else only one editor will be selected.\n    const { activeElement } = document;\n    for (const editor of this.#selectedEditors) {\n      if (editor.div.contains(activeElement)) {\n        this.#lastActiveElement = [editor, activeElement];\n        editor._focusEventsAllowed = false;\n        break;\n      }\n    }\n  }\n\n  focus() {\n    if (!this.#lastActiveElement) {\n      return;\n    }\n    const [lastEditor, lastActiveElement] = this.#lastActiveElement;\n    this.#lastActiveElement = null;\n    lastActiveElement.addEventListener(\n      \"focusin\",\n      () => {\n        lastEditor._focusEventsAllowed = true;\n      },\n      { once: true, signal: this._signal }\n    );\n    lastActiveElement.focus();\n  }\n\n  #addKeyboardManager() {\n    if (this.#keyboardManagerAC) {\n      return;\n    }\n    this.#keyboardManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#keyboardManagerAC);\n\n    // The keyboard events are caught at the container level in order to be able\n    // to execute some callbacks even if the current page doesn't have focus.\n    window.addEventListener(\"keydown\", this.keydown.bind(this), { signal });\n    window.addEventListener(\"keyup\", this.keyup.bind(this), { signal });\n  }\n\n  #removeKeyboardManager() {\n    this.#keyboardManagerAC?.abort();\n    this.#keyboardManagerAC = null;\n  }\n\n  #addCopyPasteListeners() {\n    if (this.#copyPasteAC) {\n      return;\n    }\n    this.#copyPasteAC = new AbortController();\n    const signal = this.combinedSignal(this.#copyPasteAC);\n\n    document.addEventListener(\"copy\", this.copy.bind(this), { signal });\n    document.addEventListener(\"cut\", this.cut.bind(this), { signal });\n    document.addEventListener(\"paste\", this.paste.bind(this), { signal });\n  }\n\n  #removeCopyPasteListeners() {\n    this.#copyPasteAC?.abort();\n    this.#copyPasteAC = null;\n  }\n\n  #addDragAndDropListeners() {\n    const signal = this._signal;\n    document.addEventListener(\"dragover\", this.dragOver.bind(this), { signal });\n    document.addEventListener(\"drop\", this.drop.bind(this), { signal });\n  }\n\n  addEditListeners() {\n    this.#addKeyboardManager();\n    this.setEditingState(true);\n  }\n\n  removeEditListeners() {\n    this.#removeKeyboardManager();\n    this.setEditingState(false);\n  }\n\n  dragOver(event) {\n    for (const { type } of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(type)) {\n          event.dataTransfer.dropEffect = \"copy\";\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Drop callback.\n   * @param {DragEvent} event\n   */\n  drop(event) {\n    for (const item of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy callback.\n   * @param {ClipboardEvent} event\n   */\n  copy(event) {\n    event.preventDefault();\n\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [];\n    for (const editor of this.#selectedEditors) {\n      const serialized = editor.serialize(/* isForCopying = */ true);\n      if (serialized) {\n        editors.push(serialized);\n      }\n    }\n    if (editors.length === 0) {\n      return;\n    }\n\n    event.clipboardData.setData(\"application/pdfjs\", JSON.stringify(editors));\n  }\n\n  /**\n   * Cut callback.\n   * @param {ClipboardEvent} event\n   */\n  cut(event) {\n    this.copy(event);\n    this.delete();\n  }\n\n  /**\n   * Paste callback.\n   * @param {ClipboardEvent} event\n   */\n  async paste(event) {\n    event.preventDefault();\n    const { clipboardData } = event;\n    for (const item of clipboardData.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          return;\n        }\n      }\n    }\n\n    let data = clipboardData.getData(\"application/pdfjs\");\n    if (!data) {\n      return;\n    }\n\n    try {\n      data = JSON.parse(data);\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n      return;\n    }\n\n    if (!Array.isArray(data)) {\n      return;\n    }\n\n    this.unselectAll();\n    const layer = this.currentLayer;\n\n    try {\n      const newEditors = [];\n      for (const editor of data) {\n        const deserializedEditor = await layer.deserialize(editor);\n        if (!deserializedEditor) {\n          return;\n        }\n        newEditors.push(deserializedEditor);\n      }\n\n      const cmd = () => {\n        for (const editor of newEditors) {\n          this.#addEditorToLayer(editor);\n        }\n        this.#selectEditors(newEditors);\n      };\n      const undo = () => {\n        for (const editor of newEditors) {\n          editor.remove();\n        }\n      };\n      this.addCommands({ cmd, undo, mustExec: true });\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n    }\n  }\n\n  /**\n   * Keydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (!this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = true;\n    }\n    if (\n      this.#mode !== AnnotationEditorType.NONE &&\n      !this.isEditorHandlingKeyboard\n    ) {\n      AnnotationEditorUIManager._keyboardManager.exec(this, event);\n    }\n  }\n\n  /**\n   * Keyup callback.\n   * @param {KeyboardEvent} event\n   */\n  keyup(event) {\n    if (this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = false;\n      if (this.#highlightWhenShiftUp) {\n        this.#highlightWhenShiftUp = false;\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  /**\n   * Execute an action for a given name.\n   * For example, the user can click on the \"Undo\" entry in the context menu\n   * and it'll trigger the undo action.\n   */\n  onEditingAction({ name }) {\n    switch (name) {\n      case \"undo\":\n      case \"redo\":\n      case \"delete\":\n      case \"selectAll\":\n        this[name]();\n        break;\n      case \"highlightSelection\":\n        this.highlightSelection(\"context_menu\");\n        break;\n      case \"commentSelection\":\n        this.commentSelection(\"context_menu\");\n        break;\n    }\n  }\n\n  /**\n   * Update the different possible states of this manager, e.g. is there\n   * something to undo, redo, ...\n   * @param {Object} details\n   */\n  #dispatchUpdateStates(details) {\n    const hasChanged = Object.entries(details).some(\n      ([key, value]) => this.#previousStates[key] !== value\n    );\n\n    if (hasChanged) {\n      this._eventBus.dispatch(\"annotationeditorstateschanged\", {\n        source: this,\n        details: Object.assign(this.#previousStates, details),\n      });\n      // We could listen on our own event but it sounds like a bit weird and\n      // it's a way to simpler to handle that stuff here instead of having to\n      // add something in every place where an editor can be unselected.\n      if (\n        this.#mode === AnnotationEditorType.HIGHLIGHT &&\n        details.hasSelectedEditor === false\n      ) {\n        this.#dispatchUpdateUI([\n          [AnnotationEditorParamsType.HIGHLIGHT_FREE, true],\n        ]);\n      }\n    }\n  }\n\n  #dispatchUpdateUI(details) {\n    this._eventBus.dispatch(\"annotationeditorparamschanged\", {\n      source: this,\n      details,\n    });\n  }\n\n  /**\n   * Set the editing state.\n   * It can be useful to temporarily disable it when the user is editing a\n   * FreeText annotation.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    if (isEditing) {\n      this.#addFocusManager();\n      this.#addCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: this.#mode !== AnnotationEditorType.NONE,\n        isEmpty: this.#isEmpty(),\n        hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n        hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n        hasSelectedEditor: false,\n      });\n    } else {\n      this.#removeFocusManager();\n      this.#removeCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: false,\n      });\n      this.disableUserSelect(false);\n    }\n  }\n\n  registerEditorTypes(types) {\n    if (this.#editorTypes) {\n      return;\n    }\n    this.#editorTypes = types;\n    for (const editorType of this.#editorTypes) {\n      this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n    }\n  }\n\n  /**\n   * Get an id.\n   * @returns {string}\n   */\n  getId() {\n    return this.#idManager.id;\n  }\n\n  get currentLayer() {\n    return this.#allLayers.get(this.#currentPageIndex);\n  }\n\n  getLayer(pageIndex) {\n    return this.#allLayers.get(pageIndex);\n  }\n\n  get currentPageIndex() {\n    return this.#currentPageIndex;\n  }\n\n  /**\n   * Add a new layer for a page which will contains the editors.\n   * @param {AnnotationEditorLayer} layer\n   */\n  addLayer(layer) {\n    this.#allLayers.set(layer.pageIndex, layer);\n    if (this.#isEnabled) {\n      layer.enable();\n    } else {\n      layer.disable();\n    }\n  }\n\n  /**\n   * Remove a layer.\n   * @param {AnnotationEditorLayer} layer\n   */\n  removeLayer(layer) {\n    this.#allLayers.delete(layer.pageIndex);\n  }\n\n  /**\n   * Change the editor mode (None, FreeText, Ink, ...)\n   * @param {number} mode\n   * @param {string|null} editId\n   * @param {boolean} [isFromKeyboard] - true if the mode change is due to a\n   *   keyboard action.\n   * @param {boolean} [mustEnterInEditMode] - true if the editor must enter in\n   *   edit mode.\n   * @param {boolean} [editComment] - true if the mode change is due to a\n   *   comment edit.\n   */\n  async updateMode(\n    mode,\n    editId = null,\n    isFromKeyboard = false,\n    mustEnterInEditMode = false,\n    editComment = false\n  ) {\n    if (this.#mode === mode) {\n      return;\n    }\n\n    if (this.#updateModeCapability) {\n      await this.#updateModeCapability.promise;\n      if (!this.#updateModeCapability) {\n        // This ui manager has been destroyed.\n        return;\n      }\n    }\n\n    this.#updateModeCapability = Promise.withResolvers();\n    this.#currentDrawingSession?.commitOrRemove();\n\n    if (this.#mode === AnnotationEditorType.POPUP) {\n      this.#commentManager?.hideSidebar();\n    }\n    this.#commentManager?.destroyPopup();\n\n    this.#mode = mode;\n    if (mode === AnnotationEditorType.NONE) {\n      this.setEditingState(false);\n      this.#disableAll();\n      for (const editor of this.#allEditors.values()) {\n        editor.hideStandaloneCommentButton();\n      }\n\n      this._editorUndoBar?.hide();\n      this.toggleComment(/* editor = */ null);\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n\n    for (const editor of this.#allEditors.values()) {\n      editor.addStandaloneCommentButton();\n    }\n\n    if (mode === AnnotationEditorType.SIGNATURE) {\n      await this.#signatureManager?.loadSignatures();\n    }\n\n    this.setEditingState(true);\n    await this.#enableAll();\n    this.unselectAll();\n    for (const layer of this.#allLayers.values()) {\n      layer.updateMode(mode);\n    }\n\n    if (mode === AnnotationEditorType.POPUP) {\n      this.#allEditableAnnotations ||=\n        await this.#pdfDocument.getAnnotationsByType(\n          new Set(this.#editorTypes.map(editorClass => editorClass._editorType))\n        );\n      const elementIds = new Set();\n      const allComments = [];\n      for (const editor of this.#allEditors.values()) {\n        const { annotationElementId, hasComment, deleted } = editor;\n        if (annotationElementId) {\n          elementIds.add(annotationElementId);\n        }\n        if (hasComment && !deleted) {\n          allComments.push(editor.getData());\n        }\n      }\n      for (const annotation of this.#allEditableAnnotations) {\n        const { id, popupRef, contentsObj } = annotation;\n        if (\n          popupRef &&\n          contentsObj?.str &&\n          !elementIds.has(id) &&\n          !this.#deletedAnnotationsElementIds.has(id)\n        ) {\n          // The annotation exists in the PDF and has a comment but there\n          // is no editor for it (anymore).\n          allComments.push(annotation);\n        }\n      }\n      this.#commentManager?.showSidebar(allComments);\n    }\n\n    if (!editId) {\n      if (isFromKeyboard) {\n        this.addNewEditorFromKeyboard();\n      }\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n\n    for (const editor of this.#allEditors.values()) {\n      if (editor.uid === editId) {\n        this.setSelected(editor);\n        if (editComment) {\n          editor.editComment();\n        } else if (mustEnterInEditMode) {\n          editor.enterInEditMode();\n        } else {\n          editor.focus();\n        }\n      } else {\n        editor.unselect();\n      }\n    }\n\n    this.#updateModeCapability.resolve();\n  }\n\n  addNewEditorFromKeyboard() {\n    if (this.currentLayer.canCreateNewEmptyEditor()) {\n      this.currentLayer.addNewEditor();\n    }\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   * @param {number} mode\n   * @returns {undefined}\n   */\n  updateToolbar(options) {\n    if (options.mode === this.#mode) {\n      return;\n    }\n    this._eventBus.dispatch(\"switchannotationeditormode\", {\n      source: this,\n      ...options,\n    });\n  }\n\n  /**\n   * Update a parameter in the current editor or globally.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {\n    if (!this.#editorTypes) {\n      return;\n    }\n\n    switch (type) {\n      case AnnotationEditorParamsType.CREATE:\n        this.currentLayer.addNewEditor(value);\n        return;\n      case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:\n        this._eventBus.dispatch(\"reporttelemetry\", {\n          source: this,\n          details: {\n            type: \"editing\",\n            data: {\n              type: \"highlight\",\n              action: \"toggle_visibility\",\n            },\n          },\n        });\n        (this.#showAllStates ||= new Map()).set(type, value);\n        this.showAllEditors(\"highlight\", value);\n        break;\n    }\n\n    if (this.hasSelection) {\n      for (const editor of this.#selectedEditors) {\n        editor.updateParams(type, value);\n      }\n    } else {\n      for (const editorType of this.#editorTypes) {\n        editorType.updateDefaultParams(type, value);\n      }\n    }\n  }\n\n  showAllEditors(type, visible, updateButton = false) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.editorType === type) {\n        editor.show(visible);\n      }\n    }\n    const state =\n      this.#showAllStates?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL) ??\n      true;\n    if (state !== visible) {\n      this.#dispatchUpdateUI([\n        [AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL, visible],\n      ]);\n    }\n  }\n\n  enableWaiting(mustWait = false) {\n    if (this.#isWaiting === mustWait) {\n      return;\n    }\n    this.#isWaiting = mustWait;\n    for (const layer of this.#allLayers.values()) {\n      if (mustWait) {\n        layer.disableClick();\n      } else {\n        layer.enableClick();\n      }\n      layer.div.classList.toggle(\"waiting\", mustWait);\n    }\n  }\n\n  /**\n   * Enable all the layers.\n   */\n  async #enableAll() {\n    if (!this.#isEnabled) {\n      this.#isEnabled = true;\n      const promises = [];\n      for (const layer of this.#allLayers.values()) {\n        promises.push(layer.enable());\n      }\n      await Promise.all(promises);\n      for (const editor of this.#allEditors.values()) {\n        editor.enable();\n      }\n    }\n  }\n\n  /**\n   * Disable all the layers.\n   */\n  #disableAll() {\n    this.unselectAll();\n    if (this.#isEnabled) {\n      this.#isEnabled = false;\n      for (const layer of this.#allLayers.values()) {\n        layer.disable();\n      }\n      for (const editor of this.#allEditors.values()) {\n        editor.disable();\n      }\n    }\n  }\n\n  /**\n   * Get all the editors belonging to a given page.\n   * @param {number} pageIndex\n   * @yields {AnnotationEditor}\n   */\n  *getEditors(pageIndex) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.pageIndex === pageIndex) {\n        yield editor;\n      }\n    }\n  }\n\n  /**\n   * Get an editor with the given id.\n   * @param {string} id\n   * @returns {AnnotationEditor}\n   */\n  getEditor(id) {\n    return this.#allEditors.get(id);\n  }\n\n  /**\n   * Add a new editor.\n   * @param {AnnotationEditor} editor\n   */\n  addEditor(editor) {\n    this.#allEditors.set(editor.id, editor);\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  removeEditor(editor) {\n    if (editor.div.contains(document.activeElement)) {\n      if (this.#focusMainContainerTimeoutId) {\n        clearTimeout(this.#focusMainContainerTimeoutId);\n      }\n      this.#focusMainContainerTimeoutId = setTimeout(() => {\n        // When the div is removed from DOM the focus can move on the\n        // document.body, so we need to move it back to the main container.\n        this.focusMainContainer();\n        this.#focusMainContainerTimeoutId = null;\n      }, 0);\n    }\n    this.#allEditors.delete(editor.id);\n    if (editor.annotationElementId) {\n      this.#missingCanvases?.delete(editor.annotationElementId);\n    }\n    this.unselect(editor);\n    if (\n      !editor.annotationElementId ||\n      !this.#deletedAnnotationsElementIds.has(editor.annotationElementId)\n    ) {\n      this.#annotationStorage?.remove(editor.id);\n    }\n  }\n\n  /**\n   * The annotation element with the given id has been deleted.\n   * @param {AnnotationEditor} editor\n   */\n  addDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.add(editor.annotationElementId);\n    this.addChangedExistingAnnotation(editor);\n    editor.deleted = true;\n  }\n\n  /**\n   * Check if the annotation element with the given id has been deleted.\n   * @param {string} annotationElementId\n   * @returns {boolean}\n   */\n  isDeletedAnnotationElement(annotationElementId) {\n    return this.#deletedAnnotationsElementIds.has(annotationElementId);\n  }\n\n  /**\n   * The annotation element with the given id have been restored.\n   * @param {AnnotationEditor} editor\n   */\n  removeDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.delete(editor.annotationElementId);\n    this.removeChangedExistingAnnotation(editor);\n    editor.deleted = false;\n  }\n\n  /**\n   * Add an editor to the layer it belongs to or add it to the global map.\n   * @param {AnnotationEditor} editor\n   */\n  #addEditorToLayer(editor) {\n    const layer = this.#allLayers.get(editor.pageIndex);\n    if (layer) {\n      layer.addOrRebuild(editor);\n    } else {\n      this.addEditor(editor);\n      this.addToAnnotationStorage(editor);\n    }\n  }\n\n  /**\n   * Set the given editor as the active one.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    if (this.#activeEditor === editor) {\n      return;\n    }\n\n    this.#activeEditor = editor;\n    if (editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  get #lastSelectedEditor() {\n    let ed = null;\n    for (ed of this.#selectedEditors) {\n      // Iterate to get the last element.\n    }\n    return ed;\n  }\n\n  /**\n   * Update the UI of the active editor.\n   * @param {AnnotationEditor} editor\n   */\n  updateUI(editor) {\n    if (this.#lastSelectedEditor === editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  updateUIForDefaultProperties(editorType) {\n    this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    if (this.#selectedEditors.has(editor)) {\n      this.#selectedEditors.delete(editor);\n      editor.unselect();\n      this.#dispatchUpdateStates({\n        hasSelectedEditor: this.hasSelection,\n      });\n      return;\n    }\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.updateToolbar({\n      mode: editor.mode,\n      editId: editor.uid,\n    });\n\n    this.#currentDrawingSession?.commitOrRemove();\n    for (const ed of this.#selectedEditors) {\n      if (ed !== editor) {\n        ed.unselect();\n      }\n    }\n    this.#selectedEditors.clear();\n\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#selectedEditors.has(editor);\n  }\n\n  get firstSelectedEditor() {\n    return this.#selectedEditors.values().next().value;\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    editor.unselect();\n    this.#selectedEditors.delete(editor);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: this.hasSelection,\n    });\n  }\n\n  get hasSelection() {\n    return this.#selectedEditors.size !== 0;\n  }\n\n  get isEnterHandled() {\n    return (\n      this.#selectedEditors.size === 1 &&\n      this.firstSelectedEditor.isEnterHandled\n    );\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    this.#commandManager.undo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n      hasSomethingToRedo: true,\n      isEmpty: this.#isEmpty(),\n    });\n    this._editorUndoBar?.hide();\n  }\n\n  /**\n   * Redo the last undoed command.\n   */\n  redo() {\n    this.#commandManager.redo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Add a command to execute (cmd) and another one to undo it.\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#commandManager.add(params);\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: false,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  cleanUndoStack(type) {\n    this.#commandManager.cleanType(type);\n  }\n\n  #isEmpty() {\n    if (this.#allEditors.size === 0) {\n      return true;\n    }\n\n    if (this.#allEditors.size === 1) {\n      for (const editor of this.#allEditors.values()) {\n        return editor.isEmpty();\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete the current editor or all.\n   */\n  delete() {\n    this.commitOrRemove();\n    const drawingEditor = this.currentLayer?.endDrawingSession(\n      /* isAborted = */ true\n    );\n    if (!this.hasSelection && !drawingEditor) {\n      return;\n    }\n\n    const editors = drawingEditor\n      ? [drawingEditor]\n      : [...this.#selectedEditors];\n    const cmd = () => {\n      this._editorUndoBar?.show(\n        undo,\n        editors.length === 1 ? editors[0].editorType : editors.length\n      );\n      for (const editor of editors) {\n        editor.remove();\n      }\n    };\n    const undo = () => {\n      for (const editor of editors) {\n        this.#addEditorToLayer(editor);\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  commitOrRemove() {\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n  }\n\n  hasSomethingToControl() {\n    return this.#activeEditor || this.hasSelection;\n  }\n\n  /**\n   * Select the editors.\n   * @param {Array<AnnotationEditor>} editors\n   */\n  #selectEditors(editors) {\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    for (const editor of editors) {\n      if (editor.isEmpty()) {\n        continue;\n      }\n      this.#selectedEditors.add(editor);\n      editor.select();\n    }\n    this.#dispatchUpdateStates({ hasSelectedEditor: this.hasSelection });\n  }\n\n  /**\n   * Select all the editors.\n   */\n  selectAll() {\n    for (const editor of this.#selectedEditors) {\n      editor.commit();\n    }\n    this.#selectEditors(this.#allEditors.values());\n  }\n\n  /**\n   * Unselect all the selected editors.\n   */\n  unselectAll() {\n    if (this.#activeEditor) {\n      // An editor is being edited so just commit it.\n      this.#activeEditor.commitOrRemove();\n      if (this.#mode !== AnnotationEditorType.NONE) {\n        // If the mode is NONE, we want to really unselect the editor, hence we\n        // mustn't return here.\n        return;\n      }\n    }\n\n    if (this.#currentDrawingSession?.commitOrRemove()) {\n      return;\n    }\n\n    if (!this.hasSelection) {\n      return;\n    }\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: false,\n    });\n  }\n\n  translateSelectedEditors(x, y, noCommit = false) {\n    if (!noCommit) {\n      this.commitOrRemove();\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n\n    this.#translation[0] += x;\n    this.#translation[1] += y;\n    const [totalX, totalY] = this.#translation;\n    const editors = [...this.#selectedEditors];\n\n    // We don't want to have an undo/redo for each translation so we wait a bit\n    // before adding the command to the command manager.\n    const TIME_TO_WAIT = 1000;\n\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n    }\n\n    this.#translationTimeoutId = setTimeout(() => {\n      this.#translationTimeoutId = null;\n      this.#translation[0] = this.#translation[1] = 0;\n\n      this.addCommands({\n        cmd: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(totalX, totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        undo: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(-totalX, -totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        mustExec: false,\n      });\n    }, TIME_TO_WAIT);\n\n    for (const editor of editors) {\n      editor.translateInPage(x, y);\n      editor.translationDone();\n    }\n  }\n\n  /**\n   * Set up the drag session for moving the selected editors.\n   */\n  setUpDragSession() {\n    // Note: don't use any references to the editor's parent which can be null\n    // if the editor belongs to a destroyed page.\n    if (!this.hasSelection) {\n      return;\n    }\n    // Avoid to have spurious text selection in the text layer when dragging.\n    this.disableUserSelect(true);\n    this.#draggingEditors = new Map();\n    for (const editor of this.#selectedEditors) {\n      this.#draggingEditors.set(editor, {\n        savedX: editor.x,\n        savedY: editor.y,\n        savedPageIndex: editor.pageIndex,\n        newX: 0,\n        newY: 0,\n        newPageIndex: -1,\n      });\n    }\n  }\n\n  /**\n   * Ends the drag session.\n   * @returns {boolean} true if at least one editor has been moved.\n   */\n  endDragSession() {\n    if (!this.#draggingEditors) {\n      return false;\n    }\n    this.disableUserSelect(false);\n    const map = this.#draggingEditors;\n    this.#draggingEditors = null;\n    let mustBeAddedInUndoStack = false;\n\n    for (const [{ x, y, pageIndex }, value] of map) {\n      value.newX = x;\n      value.newY = y;\n      value.newPageIndex = pageIndex;\n      mustBeAddedInUndoStack ||=\n        x !== value.savedX ||\n        y !== value.savedY ||\n        pageIndex !== value.savedPageIndex;\n    }\n\n    if (!mustBeAddedInUndoStack) {\n      return false;\n    }\n\n    const move = (editor, x, y, pageIndex) => {\n      if (this.#allEditors.has(editor.id)) {\n        // The editor can be undone/redone on a page which is not visible (and\n        // which potentially has no annotation editor layer), hence we need to\n        // use the pageIndex instead of the parent.\n        const parent = this.#allLayers.get(pageIndex);\n        if (parent) {\n          editor._setParentAndPosition(parent, x, y);\n        } else {\n          editor.pageIndex = pageIndex;\n          editor.x = x;\n          editor.y = y;\n        }\n      }\n    };\n\n    this.addCommands({\n      cmd: () => {\n        for (const [editor, { newX, newY, newPageIndex }] of map) {\n          move(editor, newX, newY, newPageIndex);\n        }\n      },\n      undo: () => {\n        for (const [editor, { savedX, savedY, savedPageIndex }] of map) {\n          move(editor, savedX, savedY, savedPageIndex);\n        }\n      },\n      mustExec: true,\n    });\n\n    return true;\n  }\n\n  /**\n   * Drag the set of selected editors.\n   * @param {number} tx\n   * @param {number} ty\n   */\n  dragSelectedEditors(tx, ty) {\n    if (!this.#draggingEditors) {\n      return;\n    }\n    for (const editor of this.#draggingEditors.keys()) {\n      editor.drag(tx, ty);\n    }\n  }\n\n  /**\n   * Rebuild the editor (usually on undo/redo actions) on a potentially\n   * non-rendered page.\n   * @param {AnnotationEditor} editor\n   */\n  rebuild(editor) {\n    if (editor.parent === null) {\n      const parent = this.getLayer(editor.pageIndex);\n      if (parent) {\n        parent.changeParent(editor);\n        parent.addOrRebuild(editor);\n      } else {\n        this.addEditor(editor);\n        this.addToAnnotationStorage(editor);\n        editor.rebuild();\n      }\n    } else {\n      editor.parent.addOrRebuild(editor);\n    }\n  }\n\n  get isEditorHandlingKeyboard() {\n    return (\n      this.getActive()?.shouldGetKeyboardEvents() ||\n      (this.#selectedEditors.size === 1 &&\n        this.firstSelectedEditor.shouldGetKeyboardEvents())\n    );\n  }\n\n  /**\n   * Is the current editor the one passed as argument?\n   * @param {AnnotationEditor} editor\n   * @returns\n   */\n  isActive(editor) {\n    return this.#activeEditor === editor;\n  }\n\n  /**\n   * Get the current active editor.\n   * @returns {AnnotationEditor|null}\n   */\n  getActive() {\n    return this.#activeEditor;\n  }\n\n  /**\n   * Get the current editor mode.\n   * @returns {number}\n   */\n  getMode() {\n    return this.#mode;\n  }\n\n  isEditingMode() {\n    return this.#mode !== AnnotationEditorType.NONE;\n  }\n\n  get imageManager() {\n    return shadow(this, \"imageManager\", new ImageManager());\n  }\n\n  getSelectionBoxes(textLayer) {\n    if (!textLayer) {\n      return null;\n    }\n    const selection = document.getSelection();\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      if (\n        !textLayer.contains(selection.getRangeAt(i).commonAncestorContainer)\n      ) {\n        return null;\n      }\n    }\n\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    // We must rotate the boxes because we want to have them in the non-rotated\n    // page coordinates.\n    let rotator;\n    switch (textLayer.getAttribute(\"data-main-rotation\")) {\n      case \"90\":\n        rotator = (x, y, w, h) => ({\n          x: (y - layerY) / parentHeight,\n          y: 1 - (x + w - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      case \"180\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (x + w - layerX) / parentWidth,\n          y: 1 - (y + h - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n      case \"270\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (y + h - layerY) / parentHeight,\n          y: (x - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      default:\n        rotator = (x, y, w, h) => ({\n          x: (x - layerX) / parentWidth,\n          y: (y - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n    }\n\n    const boxes = [];\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      const range = selection.getRangeAt(i);\n      if (range.collapsed) {\n        continue;\n      }\n      for (const { x, y, width, height } of range.getClientRects()) {\n        if (width === 0 || height === 0) {\n          continue;\n        }\n        boxes.push(rotator(x, y, width, height));\n      }\n    }\n    return boxes.length === 0 ? null : boxes;\n  }\n\n  addChangedExistingAnnotation({ annotationElementId, id }) {\n    (this.#changedExistingAnnotations ||= new Map()).set(\n      annotationElementId,\n      id\n    );\n  }\n\n  removeChangedExistingAnnotation({ annotationElementId }) {\n    this.#changedExistingAnnotations?.delete(annotationElementId);\n  }\n\n  renderAnnotationElement(annotation) {\n    const editorId = this.#changedExistingAnnotations?.get(annotation.data.id);\n    if (!editorId) {\n      return;\n    }\n    const editor = this.#annotationStorage.getRawValue(editorId);\n    if (!editor) {\n      return;\n    }\n    if (this.#mode === AnnotationEditorType.NONE && !editor.hasBeenModified) {\n      return;\n    }\n    editor.renderAnnotationElement(annotation);\n  }\n\n  setMissingCanvas(annotationId, annotationElementId, canvas) {\n    const editor = this.#missingCanvases?.get(annotationId);\n    if (!editor) {\n      return;\n    }\n    editor.setCanvas(annotationElementId, canvas);\n    this.#missingCanvases.delete(annotationId);\n  }\n\n  addMissingCanvas(annotationId, editor) {\n    (this.#missingCanvases ||= new Map()).set(annotationId, editor);\n  }\n}\n\nexport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  CommandManager,\n  CurrentPointers,\n  KeyboardManager,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass AltText {\n  #altText = null;\n\n  #altTextDecorative = false;\n\n  #altTextButton = null;\n\n  #altTextButtonLabel = null;\n\n  #altTextTooltip = null;\n\n  #altTextTooltipTimeout = null;\n\n  #altTextWasFromKeyBoard = false;\n\n  #badge = null;\n\n  #editor = null;\n\n  #guessedText = null;\n\n  #textWithDisclaimer = null;\n\n  #useNewAltTextFlow = false;\n\n  static #l10nNewButton = null;\n\n  static _l10n = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n    this.#useNewAltTextFlow = editor._uiManager.useNewAltTextFlow;\n\n    AltText.#l10nNewButton ||= Object.freeze({\n      added: \"pdfjs-editor-new-alt-text-added-button\",\n      \"added-label\": \"pdfjs-editor-new-alt-text-added-button-label\",\n      missing: \"pdfjs-editor-new-alt-text-missing-button\",\n      \"missing-label\": \"pdfjs-editor-new-alt-text-missing-button-label\",\n      review: \"pdfjs-editor-new-alt-text-to-review-button\",\n      \"review-label\": \"pdfjs-editor-new-alt-text-to-review-button-label\",\n    });\n  }\n\n  static initialize(l10n) {\n    AltText._l10n ??= l10n;\n  }\n\n  async render() {\n    const altText = (this.#altTextButton = document.createElement(\"button\"));\n    altText.className = \"altText\";\n    altText.tabIndex = \"0\";\n\n    const label = (this.#altTextButtonLabel = document.createElement(\"span\"));\n    altText.append(label);\n\n    if (this.#useNewAltTextFlow) {\n      altText.classList.add(\"new\");\n      altText.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton.missing);\n      label.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[\"missing-label\"]\n      );\n    } else {\n      altText.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button\");\n      label.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button-label\");\n    }\n\n    const signal = this.#editor._uiManager._signal;\n    altText.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    altText.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      this.#editor._uiManager.editAltText(this.#editor);\n      if (this.#useNewAltTextFlow) {\n        this.#editor._reportTelemetry({\n          action: \"pdfjs.image.alt_text.image_status_label_clicked\",\n          data: { label: this.#label },\n        });\n      }\n    };\n    altText.addEventListener(\"click\", onClick, { capture: true, signal });\n    altText.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === altText && event.key === \"Enter\") {\n          this.#altTextWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n    await this.#setState();\n\n    return altText;\n  }\n\n  get #label() {\n    return (\n      (this.#altText && \"added\") ||\n      (this.#altText === null && this.guessedText && \"review\") ||\n      \"missing\"\n    );\n  }\n\n  finish() {\n    if (!this.#altTextButton) {\n      return;\n    }\n    this.#altTextButton.focus({ focusVisible: this.#altTextWasFromKeyBoard });\n    this.#altTextWasFromKeyBoard = false;\n  }\n\n  isEmpty() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText === null;\n    }\n    return !this.#altText && !this.#altTextDecorative;\n  }\n\n  hasData() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText !== null || !!this.#guessedText;\n    }\n    return this.isEmpty();\n  }\n\n  get guessedText() {\n    return this.#guessedText;\n  }\n\n  async setGuessedText(guessedText) {\n    if (this.#altText !== null) {\n      // The user provided their own alt text, so we don't want to overwrite it.\n      return;\n    }\n    this.#guessedText = guessedText;\n    this.#textWithDisclaimer = await AltText._l10n.get(\n      \"pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer\",\n      { generatedAltText: guessedText }\n    );\n    this.#setState();\n  }\n\n  toggleAltTextBadge(visibility = false) {\n    if (!this.#useNewAltTextFlow || this.#altText) {\n      this.#badge?.remove();\n      this.#badge = null;\n      return;\n    }\n    if (!this.#badge) {\n      const badge = (this.#badge = document.createElement(\"div\"));\n      badge.className = \"noAltTextBadge\";\n      this.#editor.div.append(badge);\n    }\n    this.#badge.classList.toggle(\"hidden\", !visibility);\n  }\n\n  serialize(isForCopying) {\n    let altText = this.#altText;\n    if (!isForCopying && this.#guessedText === altText) {\n      altText = this.#textWithDisclaimer;\n    }\n    return {\n      altText,\n      decorative: this.#altTextDecorative,\n      guessedText: this.#guessedText,\n      textWithDisclaimer: this.#textWithDisclaimer,\n    };\n  }\n\n  get data() {\n    return {\n      altText: this.#altText,\n      decorative: this.#altTextDecorative,\n    };\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set data({\n    altText,\n    decorative,\n    guessedText,\n    textWithDisclaimer,\n    cancel = false,\n  }) {\n    if (guessedText) {\n      this.#guessedText = guessedText;\n      this.#textWithDisclaimer = textWithDisclaimer;\n    }\n    if (this.#altText === altText && this.#altTextDecorative === decorative) {\n      return;\n    }\n    if (!cancel) {\n      this.#altText = altText;\n      this.#altTextDecorative = decorative;\n    }\n    this.#setState();\n  }\n\n  toggle(enabled = false) {\n    if (!this.#altTextButton) {\n      return;\n    }\n    if (!enabled && this.#altTextTooltipTimeout) {\n      clearTimeout(this.#altTextTooltipTimeout);\n      this.#altTextTooltipTimeout = null;\n    }\n    this.#altTextButton.disabled = !enabled;\n  }\n\n  shown() {\n    this.#editor._reportTelemetry({\n      action: \"pdfjs.image.alt_text.image_status_label_displayed\",\n      data: { label: this.#label },\n    });\n  }\n\n  destroy() {\n    this.#altTextButton?.remove();\n    this.#altTextButton = null;\n    this.#altTextButtonLabel = null;\n    this.#altTextTooltip = null;\n    this.#badge?.remove();\n    this.#badge = null;\n  }\n\n  async #setState() {\n    const button = this.#altTextButton;\n    if (!button) {\n      return;\n    }\n\n    if (this.#useNewAltTextFlow) {\n      button.classList.toggle(\"done\", !!this.#altText);\n      button.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton[this.#label]);\n\n      this.#altTextButtonLabel?.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[`${this.#label}-label`]\n      );\n      if (!this.#altText) {\n        this.#altTextTooltip?.remove();\n        return;\n      }\n    } else {\n      if (!this.#altText && !this.#altTextDecorative) {\n        button.classList.remove(\"done\");\n        this.#altTextTooltip?.remove();\n        return;\n      }\n      button.classList.add(\"done\");\n      button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-edit-button\");\n    }\n\n    let tooltip = this.#altTextTooltip;\n    if (!tooltip) {\n      this.#altTextTooltip = tooltip = document.createElement(\"span\");\n      tooltip.className = \"tooltip\";\n      tooltip.setAttribute(\"role\", \"tooltip\");\n      tooltip.id = `alt-text-tooltip-${this.#editor.id}`;\n\n      const DELAY_TO_SHOW_TOOLTIP = 100;\n      const signal = this.#editor._uiManager._signal;\n      signal.addEventListener(\n        \"abort\",\n        () => {\n          clearTimeout(this.#altTextTooltipTimeout);\n          this.#altTextTooltipTimeout = null;\n        },\n        { once: true }\n      );\n      button.addEventListener(\n        \"mouseenter\",\n        () => {\n          this.#altTextTooltipTimeout = setTimeout(() => {\n            this.#altTextTooltipTimeout = null;\n            this.#altTextTooltip.classList.add(\"show\");\n            this.#editor._reportTelemetry({\n              action: \"alt_text_tooltip\",\n            });\n          }, DELAY_TO_SHOW_TOOLTIP);\n        },\n        { signal }\n      );\n      button.addEventListener(\n        \"mouseleave\",\n        () => {\n          if (this.#altTextTooltipTimeout) {\n            clearTimeout(this.#altTextTooltipTimeout);\n            this.#altTextTooltipTimeout = null;\n          }\n          this.#altTextTooltip?.classList.remove(\"show\");\n        },\n        { signal }\n      );\n    }\n    if (this.#altTextDecorative) {\n      tooltip.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-editor-alt-text-decorative-tooltip\"\n      );\n    } else {\n      tooltip.removeAttribute(\"data-l10n-id\");\n      tooltip.textContent = this.#altText;\n    }\n\n    if (!tooltip.parentNode) {\n      button.append(tooltip);\n    }\n\n    const element = this.#editor.getElementForAltText();\n    element?.setAttribute(\"aria-describedby\", tooltip.id);\n  }\n}\n\nexport { AltText };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\n\nclass Comment {\n  #commentStandaloneButton = null;\n\n  #commentToolbarButton = null;\n\n  #commentWasFromKeyBoard = false;\n\n  #editor = null;\n\n  #initialText = null;\n\n  #richText = null;\n\n  #text = null;\n\n  #date = null;\n\n  #deleted = false;\n\n  #popupPosition = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  renderForToolbar() {\n    const button = (this.#commentToolbarButton =\n      document.createElement(\"button\"));\n    button.className = \"comment\";\n    return this.#render(button, false);\n  }\n\n  renderForStandalone() {\n    const button = (this.#commentStandaloneButton =\n      document.createElement(\"button\"));\n    button.className = \"annotationCommentButton\";\n\n    const position = this.#editor.commentButtonPosition;\n    if (position) {\n      const { style } = button;\n      style.insetInlineEnd = `calc(${\n        100 *\n        (this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0])\n      }% - var(--comment-button-dim))`;\n      style.top = `calc(${100 * position[1]}% - var(--comment-button-dim))`;\n      const color = this.#editor.commentButtonColor;\n      if (color) {\n        style.backgroundColor = color;\n      }\n    }\n\n    return this.#render(button, true);\n  }\n\n  focusButton() {\n    setTimeout(() => {\n      (this.#commentStandaloneButton ?? this.#commentToolbarButton)?.focus();\n    }, 0);\n  }\n\n  onUpdatedColor() {\n    if (!this.#commentStandaloneButton) {\n      return;\n    }\n    const color = this.#editor.commentButtonColor;\n    if (color) {\n      this.#commentStandaloneButton.style.backgroundColor = color;\n    }\n    this.#editor._uiManager.updatePopupColor(this.#editor);\n  }\n\n  get commentButtonWidth() {\n    return (\n      (this.#commentStandaloneButton?.getBoundingClientRect().width ?? 0) /\n      this.#editor.parent.boundingClientRect.width\n    );\n  }\n\n  get commentPopupPositionInLayer() {\n    if (this.#popupPosition) {\n      return this.#popupPosition;\n    }\n    if (!this.#commentStandaloneButton) {\n      return null;\n    }\n    const { x, y, height } =\n      this.#commentStandaloneButton.getBoundingClientRect();\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = this.#editor.parent.boundingClientRect;\n    return [(x - parentX) / parentWidth, (y + height - parentY) / parentHeight];\n  }\n\n  set commentPopupPositionInLayer(pos) {\n    this.#popupPosition = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#popupPosition === null;\n  }\n\n  removeStandaloneCommentButton() {\n    this.#commentStandaloneButton?.remove();\n    this.#commentStandaloneButton = null;\n  }\n\n  removeToolbarCommentButton() {\n    this.#commentToolbarButton?.remove();\n    this.#commentToolbarButton = null;\n  }\n\n  setCommentButtonStates({ selected, hasPopup }) {\n    if (!this.#commentStandaloneButton) {\n      return;\n    }\n    this.#commentStandaloneButton.classList.toggle(\"selected\", selected);\n    this.#commentStandaloneButton.ariaExpanded = hasPopup;\n  }\n\n  #render(comment, isStandalone) {\n    if (!this.#editor._uiManager.hasCommentManager()) {\n      return null;\n    }\n\n    comment.tabIndex = \"0\";\n    comment.ariaHasPopup = \"dialog\";\n\n    if (isStandalone) {\n      comment.ariaControls = \"commentPopup\";\n      comment.setAttribute(\"data-l10n-id\", \"pdfjs-show-comment-button\");\n    } else {\n      comment.ariaControlsElements = [\n        this.#editor._uiManager.getCommentDialogElement(),\n      ];\n      comment.setAttribute(\"data-l10n-id\", \"pdfjs-editor-add-comment-button\");\n    }\n\n    const signal = this.#editor._uiManager._signal;\n    if (!(signal instanceof AbortSignal) || signal.aborted) {\n      return comment;\n    }\n\n    comment.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    if (isStandalone) {\n      comment.addEventListener(\n        \"focusin\",\n        e => {\n          this.#editor._focusEventsAllowed = false;\n          stopEvent(e);\n        },\n        {\n          capture: true,\n          signal,\n        }\n      );\n      comment.addEventListener(\n        \"focusout\",\n        e => {\n          this.#editor._focusEventsAllowed = true;\n          stopEvent(e);\n        },\n        {\n          capture: true,\n          signal,\n        }\n      );\n    }\n    comment.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      if (comment === this.#commentToolbarButton) {\n        this.edit();\n      } else {\n        this.#editor.toggleComment(/* isSelected = */ true);\n      }\n    };\n    comment.addEventListener(\"click\", onClick, { capture: true, signal });\n    comment.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === comment && event.key === \"Enter\") {\n          this.#commentWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n\n    comment.addEventListener(\n      \"pointerenter\",\n      () => {\n        this.#editor.toggleComment(\n          /* isSelected = */ false,\n          /* visibility = */ true\n        );\n      },\n      { signal }\n    );\n    comment.addEventListener(\n      \"pointerleave\",\n      () => {\n        this.#editor.toggleComment(\n          /* isSelected = */ false,\n          /* visibility = */ false\n        );\n      },\n      { signal }\n    );\n\n    return comment;\n  }\n\n  edit(options) {\n    const position = this.commentPopupPositionInLayer;\n    let posX, posY;\n    if (position) {\n      [posX, posY] = position;\n    } else {\n      // The position is in the editor coordinates.\n      [posX, posY] = this.#editor.commentButtonPosition;\n      const { width, height, x, y } = this.#editor;\n      posX = x + posX * width;\n      posY = y + posY * height;\n    }\n    const parentDimensions = this.#editor.parent.boundingClientRect;\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = parentDimensions;\n    this.#editor._uiManager.editComment(\n      this.#editor,\n      parentX + posX * parentWidth,\n      parentY + posY * parentHeight,\n      { ...options, parentDimensions }\n    );\n  }\n\n  finish() {\n    if (!this.#commentToolbarButton) {\n      return;\n    }\n    this.#commentToolbarButton.focus({\n      focusVisible: this.#commentWasFromKeyBoard,\n    });\n    this.#commentWasFromKeyBoard = false;\n  }\n\n  isDeleted() {\n    return this.#deleted || this.#text === \"\";\n  }\n\n  isEmpty() {\n    return this.#text === null;\n  }\n\n  hasBeenEdited() {\n    return this.isDeleted() || this.#text !== this.#initialText;\n  }\n\n  serialize() {\n    return this.data;\n  }\n\n  get data() {\n    return {\n      text: this.#text,\n      richText: this.#richText,\n      date: this.#date,\n      deleted: this.isDeleted(),\n    };\n  }\n\n  /**\n   * Set the comment data.\n   */\n  set data(text) {\n    if (text !== this.#text) {\n      this.#richText = null;\n    }\n    if (text === null) {\n      this.#text = \"\";\n      this.#deleted = true;\n      return;\n    }\n    this.#text = text;\n    this.#date = new Date();\n    this.#deleted = false;\n  }\n\n  setInitialText(text, richText = null) {\n    this.#initialText = text;\n    this.data = text;\n    this.#date = null;\n    this.#richText = richText;\n  }\n\n  shown() {}\n\n  destroy() {\n    this.#commentToolbarButton?.remove();\n    this.#commentToolbarButton = null;\n    this.#commentStandaloneButton?.remove();\n    this.#commentStandaloneButton = null;\n    this.#text = \"\";\n    this.#richText = null;\n    this.#date = null;\n    this.#editor = null;\n    this.#commentWasFromKeyBoard = false;\n    this.#deleted = false;\n  }\n}\n\nexport { Comment };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OutputScale, stopEvent } from \"./display_utils.js\";\n\nclass TouchManager {\n  #container;\n\n  #isPinching = false;\n\n  #isPinchingStopped = null;\n\n  #isPinchingDisabled;\n\n  #onPinchStart;\n\n  #onPinching;\n\n  #onPinchEnd;\n\n  #pointerDownAC = null;\n\n  #signal;\n\n  #touchInfo = null;\n\n  #touchManagerAC;\n\n  #touchMoveAC = null;\n\n  constructor({\n    container,\n    isPinchingDisabled = null,\n    isPinchingStopped = null,\n    onPinchStart = null,\n    onPinching = null,\n    onPinchEnd = null,\n    signal,\n  }) {\n    this.#container = container;\n    this.#isPinchingStopped = isPinchingStopped;\n    this.#isPinchingDisabled = isPinchingDisabled;\n    this.#onPinchStart = onPinchStart;\n    this.#onPinching = onPinching;\n    this.#onPinchEnd = onPinchEnd;\n    this.#touchManagerAC = new AbortController();\n    this.#signal = AbortSignal.any([signal, this.#touchManagerAC.signal]);\n\n    container.addEventListener(\"touchstart\", this.#onTouchStart.bind(this), {\n      passive: false,\n      signal: this.#signal,\n    });\n  }\n\n  /**\n   * NOTE: Don't shadow this value since `devicePixelRatio` may change if the\n   * window resolution changes, e.g. if the viewer is moved to another monitor.\n   */\n  get MIN_TOUCH_DISTANCE_TO_PINCH() {\n    // The 35 is coming from:\n    //  https://searchfox.org/mozilla-central/source/gfx/layers/apz/src/GestureEventListener.cpp#36\n    //\n    // The properties TouchEvent::screenX/Y are in screen CSS pixels:\n    //  https://developer.mozilla.org/en-US/docs/Web/API/Touch/screenX#examples\n    // MIN_TOUCH_DISTANCE_TO_PINCH is in CSS pixels.\n    return 35 / OutputScale.pixelRatio;\n  }\n\n  #onTouchStart(evt) {\n    if (this.#isPinchingDisabled?.()) {\n      return;\n    }\n\n    if (evt.touches.length === 1) {\n      if (this.#pointerDownAC) {\n        return;\n      }\n      const pointerDownAC = (this.#pointerDownAC = new AbortController());\n      const signal = AbortSignal.any([this.#signal, pointerDownAC.signal]);\n      const container = this.#container;\n\n      // We want to have the events at the capture phase to make sure we can\n      // cancel them.\n      const opts = { capture: true, signal, passive: false };\n      const cancelPointerDown = e => {\n        if (e.pointerType === \"touch\") {\n          this.#pointerDownAC?.abort();\n          this.#pointerDownAC = null;\n        }\n      };\n      container.addEventListener(\n        \"pointerdown\",\n        e => {\n          if (e.pointerType === \"touch\") {\n            // This is the second finger so we don't want it select something\n            // or whatever.\n            stopEvent(e);\n            cancelPointerDown(e);\n          }\n        },\n        opts\n      );\n      container.addEventListener(\"pointerup\", cancelPointerDown, opts);\n      container.addEventListener(\"pointercancel\", cancelPointerDown, opts);\n      return;\n    }\n\n    if (!this.#touchMoveAC) {\n      this.#touchMoveAC = new AbortController();\n      const signal = AbortSignal.any([this.#signal, this.#touchMoveAC.signal]);\n      const container = this.#container;\n\n      const opt = { signal, capture: false, passive: false };\n      container.addEventListener(\n        \"touchmove\",\n        this.#onTouchMove.bind(this),\n        opt\n      );\n      const onTouchEnd = this.#onTouchEnd.bind(this);\n      container.addEventListener(\"touchend\", onTouchEnd, opt);\n      container.addEventListener(\"touchcancel\", onTouchEnd, opt);\n\n      opt.capture = true;\n      container.addEventListener(\"pointerdown\", stopEvent, opt);\n      container.addEventListener(\"pointermove\", stopEvent, opt);\n      container.addEventListener(\"pointercancel\", stopEvent, opt);\n      container.addEventListener(\"pointerup\", stopEvent, opt);\n      this.#onPinchStart?.();\n    }\n\n    stopEvent(evt);\n\n    if (evt.touches.length !== 2 || this.#isPinchingStopped?.()) {\n      this.#touchInfo = null;\n      return;\n    }\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    this.#touchInfo = {\n      touch0X: touch0.screenX,\n      touch0Y: touch0.screenY,\n      touch1X: touch1.screenX,\n      touch1Y: touch1.screenY,\n    };\n  }\n\n  #onTouchMove(evt) {\n    if (!this.#touchInfo || evt.touches.length !== 2) {\n      return;\n    }\n\n    stopEvent(evt);\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    const { screenX: screen0X, screenY: screen0Y } = touch0;\n    const { screenX: screen1X, screenY: screen1Y } = touch1;\n    const touchInfo = this.#touchInfo;\n    const {\n      touch0X: pTouch0X,\n      touch0Y: pTouch0Y,\n      touch1X: pTouch1X,\n      touch1Y: pTouch1Y,\n    } = touchInfo;\n\n    const prevGapX = pTouch1X - pTouch0X;\n    const prevGapY = pTouch1Y - pTouch0Y;\n    const currGapX = screen1X - screen0X;\n    const currGapY = screen1Y - screen0Y;\n\n    const distance = Math.hypot(currGapX, currGapY) || 1;\n    const pDistance = Math.hypot(prevGapX, prevGapY) || 1;\n    if (\n      !this.#isPinching &&\n      Math.abs(pDistance - distance) <= TouchManager.MIN_TOUCH_DISTANCE_TO_PINCH\n    ) {\n      return;\n    }\n\n    touchInfo.touch0X = screen0X;\n    touchInfo.touch0Y = screen0Y;\n    touchInfo.touch1X = screen1X;\n    touchInfo.touch1Y = screen1Y;\n\n    if (!this.#isPinching) {\n      // Start pinching.\n      this.#isPinching = true;\n\n      // We return here else the first pinch is a bit too much\n      return;\n    }\n\n    const origin = [(screen0X + screen1X) / 2, (screen0Y + screen1Y) / 2];\n    this.#onPinching?.(origin, pDistance, distance);\n  }\n\n  #onTouchEnd(evt) {\n    if (evt.touches.length >= 2) {\n      return;\n    }\n    // #touchMoveAC shouldn't be null but it seems that irl it can (see #19793).\n    if (this.#touchMoveAC) {\n      this.#touchMoveAC.abort();\n      this.#touchMoveAC = null;\n      this.#onPinchEnd?.();\n    }\n\n    if (!this.#touchInfo) {\n      return;\n    }\n    stopEvent(evt);\n    this.#touchInfo = null;\n    this.#isPinching = false;\n  }\n\n  destroy() {\n    this.#touchManagerAC?.abort();\n    this.#touchManagerAC = null;\n    this.#pointerDownAC?.abort();\n    this.#pointerDownAC = null;\n  }\n}\n\nexport { TouchManager };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  KeyboardManager,\n} from \"./tools.js\";\nimport {\n  FeatureTest,\n  MathClamp,\n  shadow,\n  unreachable,\n} from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AltText } from \"./alt_text.js\";\nimport { Comment } from \"./comment.js\";\nimport { EditorToolbar } from \"./toolbar.js\";\nimport { TouchManager } from \"../touch_manager.js\";\n\n/**\n * @typedef {Object} AnnotationEditorParameters\n * @property {AnnotationEditorUIManager} uiManager - the global manager\n * @property {AnnotationEditorLayer} parent - the layer containing this editor\n * @property {string} id - editor id\n * @property {number} x - x-coordinate\n * @property {number} y - y-coordinate\n */\n\n/**\n * Base class for editors.\n */\nclass AnnotationEditor {\n  #accessibilityData = null;\n\n  #allResizerDivs = null;\n\n  #altText = null;\n\n  #comment = null;\n\n  #commentStandaloneButton = null;\n\n  #disabled = false;\n\n  #dragPointerId = null;\n\n  #dragPointerType = \"\";\n\n  #resizersDiv = null;\n\n  #lastPointerCoords = null;\n\n  #savedDimensions = null;\n\n  #fakeAnnotation = null;\n\n  #focusAC = null;\n\n  #focusedResizerName = \"\";\n\n  #hasBeenClicked = false;\n\n  #initialRect = null;\n\n  #isEditing = false;\n\n  #isInEditMode = false;\n\n  #isResizerEnabledForKeyboard = false;\n\n  #moveInDOMTimeout = null;\n\n  #prevDragX = 0;\n\n  #prevDragY = 0;\n\n  #telemetryTimeouts = null;\n\n  #touchManager = null;\n\n  isSelected = false;\n\n  _isCopy = false;\n\n  _editToolbar = null;\n\n  _initialOptions = Object.create(null);\n\n  _initialData = null;\n\n  _isVisible = true;\n\n  _uiManager = null;\n\n  _focusEventsAllowed = true;\n\n  static _l10n = null;\n\n  static _l10nResizer = null;\n\n  #isDraggable = false;\n\n  #zIndex = AnnotationEditor._zIndex++;\n\n  static _borderLineWidth = -1;\n\n  static _colorManager = new ColorManager();\n\n  static _zIndex = 1;\n\n  // Time to wait (in ms) before sending the telemetry data.\n  // We wait a bit to avoid sending too many requests when changing something\n  // like the thickness of a line.\n  static _telemetryTimeout = 1000;\n\n  static get _resizerKeyboardManager() {\n    const resize = AnnotationEditor.prototype._resizeWithKeyboard;\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_resizerKeyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], resize, { args: [-small, 0] }],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          resize,\n          { args: [-big, 0] },\n        ],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], resize, { args: [small, 0] }],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          resize,\n          { args: [big, 0] },\n        ],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], resize, { args: [0, -small] }],\n        [[\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"], resize, { args: [0, -big] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], resize, { args: [0, small] }],\n        [[\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"], resize, { args: [0, big] }],\n        [\n          [\"Escape\", \"mac+Escape\"],\n          AnnotationEditor.prototype._stopResizingWithKeyboard,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * @param {AnnotationEditorParameters} parameters\n   */\n  constructor(parameters) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === AnnotationEditor\n    ) {\n      unreachable(\"Cannot initialize AnnotationEditor.\");\n    }\n\n    this.parent = parameters.parent;\n    this.id = parameters.id;\n    this.width = this.height = null;\n    this.pageIndex = parameters.parent.pageIndex;\n    this.name = parameters.name;\n    this.div = null;\n    this._uiManager = parameters.uiManager;\n    this.annotationElementId = null;\n    this._willKeepAspectRatio = false;\n    this._initialOptions.isCentered = parameters.isCentered;\n    this._structTreeParentId = null;\n    this.annotationElementId = parameters.annotationElementId || null;\n    this.creationDate = parameters.creationDate || new Date();\n    this.modificationDate = parameters.modificationDate || null;\n    this.canAddComment = true;\n\n    const {\n      rotation,\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = this.parent.viewport;\n\n    this.rotation = rotation;\n    this.pageRotation =\n      (360 + rotation - this._uiManager.viewParameters.rotation) % 360;\n    this.pageDimensions = [pageWidth, pageHeight];\n    this.pageTranslation = [pageX, pageY];\n\n    const [width, height] = this.parentDimensions;\n    this.x = parameters.x / width;\n    this.y = parameters.y / height;\n\n    this.isAttachedToDOM = false;\n    this.deleted = false;\n  }\n\n  get editorType() {\n    return Object.getPrototypeOf(this).constructor._type;\n  }\n\n  get mode() {\n    return Object.getPrototypeOf(this).constructor._editorType;\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  static get _defaultLineColor() {\n    return shadow(\n      this,\n      \"_defaultLineColor\",\n      this._colorManager.getHexCode(\"CanvasText\")\n    );\n  }\n\n  static deleteAnnotationElement(editor) {\n    const fakeEditor = new FakeEditor({\n      id: editor.parent.getNextId(),\n      parent: editor.parent,\n      uiManager: editor._uiManager,\n    });\n    fakeEditor.annotationElementId = editor.annotationElementId;\n    fakeEditor.deleted = true;\n    fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);\n  }\n\n  /**\n   * Initialize the l10n stuff for this type of editor.\n   * @param {Object} l10n\n   */\n  static initialize(l10n, _uiManager) {\n    AnnotationEditor._l10n ??= l10n;\n\n    AnnotationEditor._l10nResizer ||= Object.freeze({\n      topLeft: \"pdfjs-editor-resizer-top-left\",\n      topMiddle: \"pdfjs-editor-resizer-top-middle\",\n      topRight: \"pdfjs-editor-resizer-top-right\",\n      middleRight: \"pdfjs-editor-resizer-middle-right\",\n      bottomRight: \"pdfjs-editor-resizer-bottom-right\",\n      bottomMiddle: \"pdfjs-editor-resizer-bottom-middle\",\n      bottomLeft: \"pdfjs-editor-resizer-bottom-left\",\n      middleLeft: \"pdfjs-editor-resizer-middle-left\",\n    });\n\n    if (AnnotationEditor._borderLineWidth !== -1) {\n      return;\n    }\n    const style = getComputedStyle(document.documentElement);\n    AnnotationEditor._borderLineWidth =\n      parseFloat(style.getPropertyValue(\"--outline-width\")) || 0;\n  }\n\n  /**\n   * Update the default parameters for this type of editor.\n   * @param {number} _type\n   * @param {*} _value\n   */\n  static updateDefaultParams(_type, _value) {}\n\n  /**\n   * Get the default properties to set in the UI for this type of editor.\n   * @returns {Array}\n   */\n  static get defaultPropertiesToUpdate() {\n    return [];\n  }\n\n  /**\n   * Check if this kind of editor is able to handle the given mime type for\n   * pasting.\n   * @param {string} mime\n   * @returns {boolean}\n   */\n  static isHandlingMimeForPasting(mime) {\n    return false;\n  }\n\n  /**\n   * Extract the data from the clipboard item and delegate the creation of the\n   * editor to the parent.\n   * @param {DataTransferItem} item\n   * @param {AnnotationEditorLayer} parent\n   */\n  static paste(item, parent) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * Get the properties to update in the UI for this editor.\n   * @returns {Array}\n   */\n  get propertiesToUpdate() {\n    return [];\n  }\n\n  get _isDraggable() {\n    return this.#isDraggable;\n  }\n\n  set _isDraggable(value) {\n    this.#isDraggable = value;\n    this.div?.classList.toggle(\"draggable\", value);\n  }\n\n  get uid() {\n    return this.annotationElementId || this.id;\n  }\n\n  /**\n   * @returns {boolean} true if the editor handles the Enter key itself.\n   */\n  get isEnterHandled() {\n    return true;\n  }\n\n  center() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    switch (this.parentRotation) {\n      case 90:\n        this.x -= (this.height * pageHeight) / (pageWidth * 2);\n        this.y += (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      case 180:\n        this.x += this.width / 2;\n        this.y += this.height / 2;\n        break;\n      case 270:\n        this.x += (this.height * pageHeight) / (pageWidth * 2);\n        this.y -= (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      default:\n        this.x -= this.width / 2;\n        this.y -= this.height / 2;\n        break;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this._uiManager.addCommands(params);\n  }\n\n  get currentLayer() {\n    return this._uiManager.currentLayer;\n  }\n\n  /**\n   * This editor will be behind the others.\n   */\n  setInBackground() {\n    this.div.style.zIndex = 0;\n  }\n\n  /**\n   * This editor will be in the foreground.\n   */\n  setInForeground() {\n    this.div.style.zIndex = this.#zIndex;\n  }\n\n  setParent(parent) {\n    if (parent !== null) {\n      this.pageIndex = parent.pageIndex;\n      this.pageDimensions = parent.pageDimensions;\n    } else {\n      // The editor is being removed from the DOM, so we need to stop resizing.\n      this.#stopResizing();\n\n      // Remove the fake annotation in the annotation layer.\n      this.#fakeAnnotation?.remove();\n      this.#fakeAnnotation = null;\n    }\n    this.parent = parent;\n  }\n\n  /**\n   * onfocus callback.\n   */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    if (!this.#hasBeenClicked) {\n      this.parent.setSelected(this);\n    } else {\n      this.#hasBeenClicked = false;\n    }\n  }\n\n  /**\n   * onblur callback.\n   * @param {FocusEvent} event\n   */\n  focusout(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      return;\n    }\n\n    // In case of focusout, the relatedTarget is the element which\n    // is grabbing the focus.\n    // So if the related target is an element under the div for this\n    // editor, then the editor isn't unactive.\n    const target = event.relatedTarget;\n    if (target?.closest(`#${this.id}`)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.parent?.isMultipleSelection) {\n      this.commitOrRemove();\n    }\n  }\n\n  commitOrRemove() {\n    if (this.isEmpty()) {\n      this.remove();\n    } else {\n      this.commit();\n    }\n  }\n\n  /**\n   * Commit the data contained in this editor.\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n    this.addToAnnotationStorage();\n  }\n\n  addToAnnotationStorage() {\n    this._uiManager.addToAnnotationStorage(this);\n  }\n\n  /**\n   * Set the editor position within its parent.\n   * @param {number} x\n   * @param {number} y\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   */\n  setAt(x, y, tx, ty) {\n    const [width, height] = this.parentDimensions;\n    [tx, ty] = this.screenToPageTranslation(tx, ty);\n\n    this.x = (x + tx) / width;\n    this.y = (y + ty) / height;\n\n    this.fixAndSetPosition();\n  }\n\n  _moveAfterPaste(baseX, baseY) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setAt(\n      baseX * parentWidth,\n      baseY * parentHeight,\n      this.width * parentWidth,\n      this.height * parentHeight\n    );\n    this._onTranslated();\n  }\n\n  #translate([width, height], x, y) {\n    [x, y] = this.screenToPageTranslation(x, y);\n\n    this.x += x / width;\n    this.y += y / height;\n\n    this._onTranslating(this.x, this.y);\n\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Translate the editor position within its parent.\n   * @param {number} x - x-translation in screen coordinates.\n   * @param {number} y - y-translation in screen coordinates.\n   */\n  translate(x, y) {\n    // We don't change the initial position because the move here hasn't been\n    // done by the user.\n    this.#translate(this.parentDimensions, x, y);\n  }\n\n  /**\n   * Translate the editor position within its page and adjust the scroll\n   * in order to have the editor in the view.\n   * @param {number} x - x-translation in page coordinates.\n   * @param {number} y - y-translation in page coordinates.\n   */\n  translateInPage(x, y) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.#translate(this.pageDimensions, x, y);\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  translationDone() {\n    this._onTranslated(this.x, this.y);\n  }\n\n  drag(tx, ty) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    const {\n      div,\n      parentDimensions: [parentWidth, parentHeight],\n    } = this;\n    this.x += tx / parentWidth;\n    this.y += ty / parentHeight;\n    if (this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {\n      // It's possible to not have a parent: for example, when the user is\n      // dragging all the selected editors but this one on a page which has been\n      // destroyed.\n      // It's why we need to check for it. In such a situation, it isn't really\n      // a problem to not find a new parent: it's something which is related to\n      // what the user is seeing, hence it depends on how pages are layed out.\n\n      // The element will be outside of its parent so change the parent.\n      const { x, y } = this.div.getBoundingClientRect();\n      if (this.parent.findNewParent(this, x, y)) {\n        this.x -= Math.floor(this.x);\n        this.y -= Math.floor(this.y);\n      }\n    }\n\n    // The editor can be moved wherever the user wants, so we don't need to fix\n    // the position: it'll be done when the user will release the mouse button.\n\n    let { x, y } = this;\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    const { style } = div;\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this._onTranslating(x, y);\n\n    div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  /**\n   * Called when the editor is being translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslating(x, y) {}\n\n  /**\n   * Called when the editor has been translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslated(x, y) {}\n\n  get _hasBeenMoved() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[0] !== this.x || this.#initialRect[1] !== this.y)\n    );\n  }\n\n  get _hasBeenResized() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[2] !== this.width ||\n        this.#initialRect[3] !== this.height)\n    );\n  }\n\n  /**\n   * Get the translation to take into account the editor border.\n   * The CSS engine positions the element by taking the border into account so\n   * we must apply the opposite translation to have the editor in the right\n   * position.\n   * @returns {Array<number>}\n   */\n  getBaseTranslation() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { _borderLineWidth } = AnnotationEditor;\n    const x = _borderLineWidth / parentWidth;\n    const y = _borderLineWidth / parentHeight;\n    switch (this.rotation) {\n      case 90:\n        return [-x, y];\n      case 180:\n        return [x, y];\n      case 270:\n        return [x, -y];\n      default:\n        return [-x, -y];\n    }\n  }\n\n  /**\n   * @returns {boolean} true if position must be fixed (i.e. make the x and y\n   * living in the page).\n   */\n  get _mustFixPosition() {\n    return true;\n  }\n\n  /**\n   * Fix the position of the editor in order to keep it inside its parent page.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  fixAndSetPosition(rotation = this.rotation) {\n    const {\n      div: { style },\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    let { x, y, width, height } = this;\n    width *= pageWidth;\n    height *= pageHeight;\n    x *= pageWidth;\n    y *= pageHeight;\n\n    if (this._mustFixPosition) {\n      switch (rotation) {\n        case 0:\n          x = MathClamp(x, 0, pageWidth - width);\n          y = MathClamp(y, 0, pageHeight - height);\n          break;\n        case 90:\n          x = MathClamp(x, 0, pageWidth - height);\n          y = MathClamp(y, width, pageHeight);\n          break;\n        case 180:\n          x = MathClamp(x, width, pageWidth);\n          y = MathClamp(y, height, pageHeight);\n          break;\n        case 270:\n          x = MathClamp(x, height, pageWidth);\n          y = MathClamp(y, 0, pageHeight - width);\n          break;\n      }\n    }\n\n    this.x = x /= pageWidth;\n    this.y = y /= pageHeight;\n\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this.moveInDOM();\n  }\n\n  static #rotatePoint(x, y, angle) {\n    switch (angle) {\n      case 90:\n        return [y, -x];\n      case 180:\n        return [-x, -y];\n      case 270:\n        return [-y, x];\n      default:\n        return [x, y];\n    }\n  }\n\n  /**\n   * Convert a screen translation into a page one.\n   * @param {number} x\n   * @param {number} y\n   */\n  screenToPageTranslation(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, this.parentRotation);\n  }\n\n  /**\n   * Convert a page translation into a screen one.\n   * @param {number} x\n   * @param {number} y\n   */\n  pageTranslationToScreen(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, 360 - this.parentRotation);\n  }\n\n  #getRotationMatrix(rotation) {\n    switch (rotation) {\n      case 90: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, -pageWidth / pageHeight, pageHeight / pageWidth, 0];\n      }\n      case 180:\n        return [-1, 0, 0, -1];\n      case 270: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, pageWidth / pageHeight, -pageHeight / pageWidth, 0];\n      }\n      default:\n        return [1, 0, 0, 1];\n    }\n  }\n\n  get parentScale() {\n    return this._uiManager.viewParameters.realScale;\n  }\n\n  get parentRotation() {\n    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;\n  }\n\n  get parentDimensions() {\n    const {\n      parentScale,\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    return [pageWidth * parentScale, pageHeight * parentScale];\n  }\n\n  /**\n   * Set the dimensions of this editor.\n   */\n  setDims() {\n    const {\n      div: { style },\n      width,\n      height,\n    } = this;\n    style.width = `${(100 * width).toFixed(2)}%`;\n    style.height = `${(100 * height).toFixed(2)}%`;\n  }\n\n  /**\n   * Get the translation used to position this editor when it's created.\n   * @returns {Array<number>}\n   */\n  getInitialTranslation() {\n    return [0, 0];\n  }\n\n  #createResizers() {\n    if (this.#resizersDiv) {\n      return;\n    }\n    this.#resizersDiv = document.createElement(\"div\");\n    this.#resizersDiv.classList.add(\"resizers\");\n    // When the resizers are used with the keyboard, they're focusable, hence\n    // we want to have them in this order (top left, top middle, top right, ...)\n    // in the DOM to have the focus order correct.\n    const classes = this._willKeepAspectRatio\n      ? [\"topLeft\", \"topRight\", \"bottomRight\", \"bottomLeft\"]\n      : [\n          \"topLeft\",\n          \"topMiddle\",\n          \"topRight\",\n          \"middleRight\",\n          \"bottomRight\",\n          \"bottomMiddle\",\n          \"bottomLeft\",\n          \"middleLeft\",\n        ];\n    const signal = this._uiManager._signal;\n    for (const name of classes) {\n      const div = document.createElement(\"div\");\n      this.#resizersDiv.append(div);\n      div.classList.add(\"resizer\", name);\n      div.setAttribute(\"data-resizer-name\", name);\n      div.addEventListener(\n        \"pointerdown\",\n        this.#resizerPointerdown.bind(this, name),\n        { signal }\n      );\n      div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      div.tabIndex = -1;\n    }\n    this.div.prepend(this.#resizersDiv);\n  }\n\n  #resizerPointerdown(name, event) {\n    event.preventDefault();\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      return;\n    }\n\n    this.#altText?.toggle(false);\n\n    const savedDraggable = this._isDraggable;\n    this._isDraggable = false;\n    this.#lastPointerCoords = [event.screenX, event.screenY];\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n\n    this.parent.togglePointerEvents(false);\n    window.addEventListener(\n      \"pointermove\",\n      this.#resizerPointermove.bind(this, name),\n      { passive: true, capture: true, signal }\n    );\n    window.addEventListener(\n      \"touchmove\",\n      stopEvent /* Prevent the page from scrolling */,\n      { passive: false, signal }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const savedParentCursor = this.parent.div.style.cursor;\n    const savedCursor = this.div.style.cursor;\n    this.div.style.cursor = this.parent.div.style.cursor =\n      window.getComputedStyle(event.target).cursor;\n\n    const pointerUpCallback = () => {\n      ac.abort();\n      this.parent.togglePointerEvents(true);\n      this.#altText?.toggle(true);\n      this._isDraggable = savedDraggable;\n      this.parent.div.style.cursor = savedParentCursor;\n      this.div.style.cursor = savedCursor;\n\n      this.#addResizeToUndoStack();\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user switches to another window (with alt+tab), then we end the\n    // resize session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  #resize(x, y, width, height) {\n    this.width = width;\n    this.height = height;\n    this.x = x;\n    this.y = y;\n    this.setDims();\n    this.fixAndSetPosition();\n    this._onResized();\n  }\n\n  /**\n   * Called when the editor has been resized.\n   */\n  _onResized() {}\n\n  #addResizeToUndoStack() {\n    if (!this.#savedDimensions) {\n      return;\n    }\n    const { savedX, savedY, savedWidth, savedHeight } = this.#savedDimensions;\n    this.#savedDimensions = null;\n\n    const newX = this.x;\n    const newY = this.y;\n    const newWidth = this.width;\n    const newHeight = this.height;\n    if (\n      newX === savedX &&\n      newY === savedY &&\n      newWidth === savedWidth &&\n      newHeight === savedHeight\n    ) {\n      return;\n    }\n\n    this.addCommands({\n      cmd: this.#resize.bind(this, newX, newY, newWidth, newHeight),\n      undo: this.#resize.bind(this, savedX, savedY, savedWidth, savedHeight),\n      mustExec: true,\n    });\n  }\n\n  static _round(x) {\n    // 10000 because we multiply by 100 and use toFixed(2) in fixAndSetPosition.\n    // Without rounding, the positions of the corners other than the top left\n    // one can be slightly wrong.\n    return Math.round(x * 10000) / 10000;\n  }\n\n  #resizerPointermove(name, event) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n    const invRotationMatrix = this.#getRotationMatrix(360 - this.rotation);\n    const invTransf = (x, y) => [\n      invRotationMatrix[0] * x + invRotationMatrix[2] * y,\n      invRotationMatrix[1] * x + invRotationMatrix[3] * y,\n    ];\n    let getPoint;\n    let getOpposite;\n    let isDiagonal = false;\n    let isHorizontal = false;\n\n    switch (name) {\n      case \"topLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, 0];\n        getOpposite = (w, h) => [w, h];\n        break;\n      case \"topMiddle\":\n        getPoint = (w, h) => [w / 2, 0];\n        getOpposite = (w, h) => [w / 2, h];\n        break;\n      case \"topRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, 0];\n        getOpposite = (w, h) => [0, h];\n        break;\n      case \"middleRight\":\n        isHorizontal = true;\n        getPoint = (w, h) => [w, h / 2];\n        getOpposite = (w, h) => [0, h / 2];\n        break;\n      case \"bottomRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, h];\n        getOpposite = (w, h) => [0, 0];\n        break;\n      case \"bottomMiddle\":\n        getPoint = (w, h) => [w / 2, h];\n        getOpposite = (w, h) => [w / 2, 0];\n        break;\n      case \"bottomLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, h];\n        getOpposite = (w, h) => [w, 0];\n        break;\n      case \"middleLeft\":\n        isHorizontal = true;\n        getPoint = (w, h) => [0, h / 2];\n        getOpposite = (w, h) => [w, h / 2];\n        break;\n    }\n\n    const point = getPoint(savedWidth, savedHeight);\n    const oppositePoint = getOpposite(savedWidth, savedHeight);\n    let transfOppositePoint = transf(...oppositePoint);\n    const oppositeX = AnnotationEditor._round(savedX + transfOppositePoint[0]);\n    const oppositeY = AnnotationEditor._round(savedY + transfOppositePoint[1]);\n    let ratioX = 1;\n    let ratioY = 1;\n\n    let deltaX, deltaY;\n\n    if (!event.fromKeyboard) {\n      // We can't use event.movementX/Y because they're not reliable:\n      //  https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/movementX\n      // (it was buggy on a laptop with a touch screen).\n      const { screenX, screenY } = event;\n      const [lastScreenX, lastScreenY] = this.#lastPointerCoords;\n      [deltaX, deltaY] = this.screenToPageTranslation(\n        screenX - lastScreenX,\n        screenY - lastScreenY\n      );\n      this.#lastPointerCoords[0] = screenX;\n      this.#lastPointerCoords[1] = screenY;\n    } else {\n      ({ deltaX, deltaY } = event);\n    }\n    [deltaX, deltaY] = invTransf(deltaX / parentWidth, deltaY / parentHeight);\n\n    if (isDiagonal) {\n      const oldDiag = Math.hypot(savedWidth, savedHeight);\n      ratioX = ratioY = Math.max(\n        Math.min(\n          Math.hypot(\n            oppositePoint[0] - point[0] - deltaX,\n            oppositePoint[1] - point[1] - deltaY\n          ) / oldDiag,\n          // Avoid the editor to be larger than the page.\n          1 / savedWidth,\n          1 / savedHeight\n        ),\n        // Avoid the editor to be smaller than the minimum size.\n        minWidth / savedWidth,\n        minHeight / savedHeight\n      );\n    } else if (isHorizontal) {\n      ratioX =\n        MathClamp(Math.abs(oppositePoint[0] - point[0] - deltaX), minWidth, 1) /\n        savedWidth;\n    } else {\n      ratioY =\n        MathClamp(\n          Math.abs(oppositePoint[1] - point[1] - deltaY),\n          minHeight,\n          1\n        ) / savedHeight;\n    }\n\n    const newWidth = AnnotationEditor._round(savedWidth * ratioX);\n    const newHeight = AnnotationEditor._round(savedHeight * ratioY);\n    transfOppositePoint = transf(...getOpposite(newWidth, newHeight));\n    const newX = oppositeX - transfOppositePoint[0];\n    const newY = oppositeY - transfOppositePoint[1];\n\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.width = newWidth;\n    this.height = newHeight;\n    this.x = newX;\n    this.y = newY;\n\n    this.setDims();\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  /**\n   * Called when the editor is being resized.\n   */\n  _onResizing() {}\n\n  /**\n   * Called when the alt text dialog is closed.\n   */\n  altTextFinish() {\n    this.#altText?.finish();\n  }\n\n  /**\n   * Get the toolbar buttons for this editor.\n   * @returns {Array<Array<string|object|null>>|null}\n   */\n  get toolbarButtons() {\n    return null;\n  }\n\n  /**\n   * Add a toolbar for this editor.\n   * @returns {Promise<EditorToolbar|null>}\n   */\n  async addEditToolbar() {\n    if (this._editToolbar || this.#isInEditMode) {\n      return this._editToolbar;\n    }\n    this._editToolbar = new EditorToolbar(this);\n    this.div.append(this._editToolbar.render());\n    const { toolbarButtons } = this;\n    if (toolbarButtons) {\n      for (const [name, tool] of toolbarButtons) {\n        await this._editToolbar.addButton(name, tool);\n      }\n    }\n    if (!this.hasComment) {\n      this._editToolbar.addButton(\"comment\", this.addCommentButton());\n    }\n    this._editToolbar.addButton(\"delete\");\n\n    return this._editToolbar;\n  }\n\n  addCommentButtonInToolbar() {\n    this._editToolbar?.addButtonBefore(\n      \"comment\",\n      this.addCommentButton(),\n      \".deleteButton\"\n    );\n  }\n\n  removeCommentButtonFromToolbar() {\n    this._editToolbar?.removeButton(\"comment\");\n  }\n\n  removeEditToolbar() {\n    this._editToolbar?.remove();\n    this._editToolbar = null;\n\n    // We destroy the alt text but we don't null it because we want to be able\n    // to restore it in case the user undoes the deletion.\n    this.#altText?.destroy();\n  }\n\n  addContainer(container) {\n    const editToolbarDiv = this._editToolbar?.div;\n    if (editToolbarDiv) {\n      editToolbarDiv.before(container);\n    } else {\n      this.div.append(container);\n    }\n  }\n\n  getClientDimensions() {\n    return this.div.getBoundingClientRect();\n  }\n\n  /**\n   * Create the alt text for this editor.\n   * @returns {object}\n   */\n  createAltText() {\n    if (!this.#altText) {\n      AltText.initialize(AnnotationEditor._l10n);\n      this.#altText = new AltText(this);\n      if (this.#accessibilityData) {\n        this.#altText.data = this.#accessibilityData;\n        this.#accessibilityData = null;\n      }\n    }\n    return this.#altText;\n  }\n\n  get altTextData() {\n    return this.#altText?.data;\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set altTextData(data) {\n    if (!this.#altText) {\n      return;\n    }\n    this.#altText.data = data;\n  }\n\n  get guessedAltText() {\n    return this.#altText?.guessedText;\n  }\n\n  async setGuessedAltText(text) {\n    await this.#altText?.setGuessedText(text);\n  }\n\n  serializeAltText(isForCopying) {\n    return this.#altText?.serialize(isForCopying);\n  }\n\n  hasAltText() {\n    return !!this.#altText && !this.#altText.isEmpty();\n  }\n\n  hasAltTextData() {\n    return this.#altText?.hasData() ?? false;\n  }\n\n  focusCommentButton() {\n    this.#comment?.focusButton();\n  }\n\n  addCommentButton() {\n    return this.canAddComment ? (this.#comment ||= new Comment(this)) : null;\n  }\n\n  addStandaloneCommentButton() {\n    if (!this._uiManager.hasCommentManager()) {\n      return;\n    }\n    if (this.#commentStandaloneButton) {\n      if (this._uiManager.isEditingMode()) {\n        this.#commentStandaloneButton.classList.remove(\"hidden\");\n      }\n      return;\n    }\n    if (!this.hasComment) {\n      return;\n    }\n    this.#commentStandaloneButton = this.#comment.renderForStandalone();\n    this.div.append(this.#commentStandaloneButton);\n  }\n\n  removeStandaloneCommentButton() {\n    this.#comment.removeStandaloneCommentButton();\n    this.#commentStandaloneButton = null;\n  }\n\n  hideStandaloneCommentButton() {\n    this.#commentStandaloneButton?.classList.add(\"hidden\");\n  }\n\n  get comment() {\n    const {\n      data: { richText, text, date, deleted },\n    } = this.#comment;\n    return {\n      text,\n      richText,\n      date,\n      deleted,\n      color: this.getNonHCMColor(),\n      opacity: this.opacity ?? 1,\n    };\n  }\n\n  set comment(text) {\n    this.#comment ||= new Comment(this);\n    this.#comment.data = text;\n    if (this.hasComment) {\n      this.removeCommentButtonFromToolbar();\n      this.addStandaloneCommentButton();\n      this._uiManager.updateComment(this);\n    } else {\n      this.addCommentButtonInToolbar();\n      this.removeStandaloneCommentButton();\n      this._uiManager.removeComment(this);\n    }\n  }\n\n  setCommentData({ comment, popupRef, richText }) {\n    if (!popupRef) {\n      return;\n    }\n    this.#comment ||= new Comment(this);\n    this.#comment.setInitialText(comment, richText);\n\n    if (!this.annotationElementId) {\n      return;\n    }\n    const storedData = this._uiManager.getAndRemoveDataFromAnnotationStorage(\n      this.annotationElementId\n    );\n    if (storedData) {\n      this.updateFromAnnotationLayer(storedData);\n    }\n  }\n\n  get hasEditedComment() {\n    return this.#comment?.hasBeenEdited();\n  }\n\n  get hasDeletedComment() {\n    return this.#comment?.isDeleted();\n  }\n\n  get hasComment() {\n    return (\n      !!this.#comment && !this.#comment.isEmpty() && !this.#comment.isDeleted()\n    );\n  }\n\n  async editComment(options) {\n    this.#comment ||= new Comment(this);\n    this.#comment.edit(options);\n  }\n\n  toggleComment(isSelected, visibility = undefined) {\n    if (this.hasComment) {\n      this._uiManager.toggleComment(this, isSelected, visibility);\n    }\n  }\n\n  setSelectedCommentButton(selected) {\n    this.#comment.setSelectedButton(selected);\n  }\n\n  addComment(serialized) {\n    if (this.hasEditedComment) {\n      const DEFAULT_POPUP_WIDTH = 180;\n      const DEFAULT_POPUP_HEIGHT = 100;\n      const [, , , trY] = serialized.rect;\n      const [pageWidth] = this.pageDimensions;\n      const [pageX] = this.pageTranslation;\n      const blX = pageX + pageWidth + 1;\n      const blY = trY - DEFAULT_POPUP_HEIGHT;\n      const trX = blX + DEFAULT_POPUP_WIDTH;\n      serialized.popup = {\n        contents: this.comment.text,\n        deleted: this.comment.deleted,\n        rect: [blX, blY, trX, trY],\n      };\n    }\n  }\n\n  updateFromAnnotationLayer({ popup: { contents, deleted } }) {\n    this.#comment.data = deleted ? null : contents;\n  }\n\n  get parentBoundingClientRect() {\n    return this.parent.boundingClientRect;\n  }\n\n  /**\n   * Render this editor in a div.\n   * @returns {HTMLDivElement | null}\n   */\n  render() {\n    const div = (this.div = document.createElement(\"div\"));\n    div.setAttribute(\"data-editor-rotation\", (360 - this.rotation) % 360);\n    div.className = this.name;\n    div.setAttribute(\"id\", this.id);\n    div.tabIndex = this.#disabled ? -1 : 0;\n    div.setAttribute(\"role\", \"application\");\n    if (this.defaultL10nId) {\n      div.setAttribute(\"data-l10n-id\", this.defaultL10nId);\n    }\n    if (!this._isVisible) {\n      div.classList.add(\"hidden\");\n    }\n\n    this.setInForeground();\n    this.#addFocusListeners();\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (this.parentRotation % 180 !== 0) {\n      div.style.maxWidth = `${((100 * parentHeight) / parentWidth).toFixed(\n        2\n      )}%`;\n      div.style.maxHeight = `${((100 * parentWidth) / parentHeight).toFixed(\n        2\n      )}%`;\n    }\n\n    const [tx, ty] = this.getInitialTranslation();\n    this.translate(tx, ty);\n\n    bindEvents(this, div, [\"keydown\", \"pointerdown\", \"dblclick\"]);\n\n    if (this.isResizable && this._uiManager._supportsPinchToZoom) {\n      this.#touchManager ||= new TouchManager({\n        container: div,\n        isPinchingDisabled: () => !this.isSelected,\n        onPinchStart: this.#touchPinchStartCallback.bind(this),\n        onPinching: this.#touchPinchCallback.bind(this),\n        onPinchEnd: this.#touchPinchEndCallback.bind(this),\n        signal: this._uiManager._signal,\n      });\n    }\n\n    this.addStandaloneCommentButton();\n    this._uiManager._editorUndoBar?.hide();\n\n    return div;\n  }\n\n  #touchPinchStartCallback() {\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    this.#altText?.toggle(false);\n    this.parent.togglePointerEvents(false);\n  }\n\n  #touchPinchCallback(_origin, prevDistance, distance) {\n    // Slightly slow down the zooming because the editor could be small and the\n    // user could have difficulties to rescale it as they want.\n    const slowDownFactor = 0.7;\n    let factor =\n      slowDownFactor * (distance / prevDistance) + 1 - slowDownFactor;\n    if (factor === 1) {\n      return;\n    }\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n\n    // The center of the editor is the fixed point.\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n    factor = Math.max(\n      Math.min(factor, 1 / savedWidth, 1 / savedHeight),\n      minWidth / savedWidth,\n      minHeight / savedHeight\n    );\n    const newWidth = AnnotationEditor._round(savedWidth * factor);\n    const newHeight = AnnotationEditor._round(savedHeight * factor);\n    if (newWidth === savedWidth && newHeight === savedHeight) {\n      return;\n    }\n\n    this.#initialRect ||= [savedX, savedY, savedWidth, savedHeight];\n    const transfCenterPoint = transf(savedWidth / 2, savedHeight / 2);\n    const centerX = AnnotationEditor._round(savedX + transfCenterPoint[0]);\n    const centerY = AnnotationEditor._round(savedY + transfCenterPoint[1]);\n    const newTransfCenterPoint = transf(newWidth / 2, newHeight / 2);\n\n    this.x = centerX - newTransfCenterPoint[0];\n    this.y = centerY - newTransfCenterPoint[1];\n    this.width = newWidth;\n    this.height = newHeight;\n\n    this.setDims();\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  #touchPinchEndCallback() {\n    this.#altText?.toggle(true);\n    this.parent.togglePointerEvents(true);\n    this.#addResizeToUndoStack();\n  }\n\n  /**\n   * Onpointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Avoid to focus this editor because of a non-left click.\n      event.preventDefault();\n      return;\n    }\n    this.#hasBeenClicked = true;\n\n    if (this._isDraggable) {\n      this.#setUpDragSession(event);\n      return;\n    }\n\n    this.#selectOnPointerEvent(event);\n  }\n\n  #selectOnPointerEvent(event) {\n    const { isMac } = FeatureTest.platform;\n    if (\n      (event.ctrlKey && !isMac) ||\n      event.shiftKey ||\n      (event.metaKey && isMac)\n    ) {\n      this.parent.toggleSelected(this);\n    } else {\n      this.parent.setSelected(this);\n    }\n  }\n\n  #setUpDragSession(event) {\n    const { isSelected } = this;\n    this._uiManager.setUpDragSession();\n    let hasDraggingStarted = false;\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n    const opts = { capture: true, passive: false, signal };\n    const cancelDrag = e => {\n      ac.abort();\n\n      this.#dragPointerId = null;\n      this.#hasBeenClicked = false;\n      if (!this._uiManager.endDragSession()) {\n        this.#selectOnPointerEvent(e);\n      }\n      if (hasDraggingStarted) {\n        this._onStopDragging();\n      }\n    };\n\n    if (isSelected) {\n      this.#prevDragX = event.clientX;\n      this.#prevDragY = event.clientY;\n      this.#dragPointerId = event.pointerId;\n      this.#dragPointerType = event.pointerType;\n      window.addEventListener(\n        \"pointermove\",\n        e => {\n          if (!hasDraggingStarted) {\n            hasDraggingStarted = true;\n            this._uiManager.toggleComment(\n              this,\n              /* isSelected = */ true,\n              /* visibility = */ false\n            );\n            this._onStartDragging();\n          }\n          const { clientX: x, clientY: y, pointerId } = e;\n          if (pointerId !== this.#dragPointerId) {\n            stopEvent(e);\n            return;\n          }\n          const [tx, ty] = this.screenToPageTranslation(\n            x - this.#prevDragX,\n            y - this.#prevDragY\n          );\n          this.#prevDragX = x;\n          this.#prevDragY = y;\n          this._uiManager.dragSelectedEditors(tx, ty);\n        },\n        opts\n      );\n      window.addEventListener(\n        \"touchmove\",\n        stopEvent /* Prevent the page from scrolling */,\n        opts\n      );\n      window.addEventListener(\n        \"pointerdown\",\n        // If the user drags with one finger and then clicks with another.\n        e => {\n          if (e.pointerType === this.#dragPointerType) {\n            // We've a pinch to zoom session.\n            // We cannot have two primaries at the same time.\n            // It's possible to be in this state with Firefox and Gnome when\n            // trying to drag with three fingers (see bug 1933716).\n            if (this.#touchManager || e.isPrimary) {\n              cancelDrag(e);\n            }\n          }\n          stopEvent(e);\n        },\n        opts\n      );\n    }\n\n    const pointerUpCallback = e => {\n      if (!this.#dragPointerId || this.#dragPointerId === e.pointerId) {\n        cancelDrag(e);\n        return;\n      }\n      stopEvent(e);\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user is using alt+tab during the dragging session, the pointerup\n    // event could be not fired, but a blur event is fired so we can use it in\n    // order to interrupt the dragging session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  _onStartDragging() {}\n\n  _onStopDragging() {}\n\n  moveInDOM() {\n    // Moving the editor in the DOM can be expensive, so we wait a bit before.\n    // It's important to not block the UI (for example when changing the font\n    // size in a FreeText).\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n    }\n    this.#moveInDOMTimeout = setTimeout(() => {\n      this.#moveInDOMTimeout = null;\n      this.parent?.moveEditorInDOM(this);\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n        this._uiManager._eventBus.dispatch(\"editormovedindom\", {\n          source: this,\n        });\n      }\n    }, 0);\n  }\n\n  _setParentAndPosition(parent, x, y) {\n    parent.changeParent(this);\n    this.x = x;\n    this.y = y;\n    this.fixAndSetPosition();\n    this._onTranslated();\n  }\n\n  /**\n   * Convert the current rect into a page one.\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  getRect(tx, ty, rotation = this.rotation) {\n    const scale = this.parentScale;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const shiftX = tx / scale;\n    const shiftY = ty / scale;\n    const x = this.x * pageWidth;\n    const y = this.y * pageHeight;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n\n    switch (rotation) {\n      case 0:\n        return [\n          x + shiftX + pageX,\n          pageHeight - y - shiftY - height + pageY,\n          x + shiftX + width + pageX,\n          pageHeight - y - shiftY + pageY,\n        ];\n      case 90:\n        return [\n          x + shiftY + pageX,\n          pageHeight - y + shiftX + pageY,\n          x + shiftY + height + pageX,\n          pageHeight - y + shiftX + width + pageY,\n        ];\n      case 180:\n        return [\n          x - shiftX - width + pageX,\n          pageHeight - y + shiftY + pageY,\n          x - shiftX + pageX,\n          pageHeight - y + shiftY + height + pageY,\n        ];\n      case 270:\n        return [\n          x - shiftY - height + pageX,\n          pageHeight - y - shiftX - width + pageY,\n          x - shiftY + pageX,\n          pageHeight - y - shiftX + pageY,\n        ];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  getRectInCurrentCoords(rect, pageHeight) {\n    const [x1, y1, x2, y2] = rect;\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    switch (this.rotation) {\n      case 0:\n        return [x1, pageHeight - y2, width, height];\n      case 90:\n        return [x1, pageHeight - y1, height, width];\n      case 180:\n        return [x2, pageHeight - y1, width, height];\n      case 270:\n        return [x2, pageHeight - y2, height, width];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  /**\n   * Get the rect in page coordinates without any translation.\n   * It's used when serializing the editor.\n   * @returns {Array<number>}\n   */\n  getPDFRect() {\n    return this.getRect(0, 0);\n  }\n\n  getNonHCMColor() {\n    return (\n      this.color &&\n      AnnotationEditor._colorManager.convert(\n        this._uiManager.getNonHCMColor(this.color)\n      )\n    );\n  }\n\n  /**\n   * The color has been changed.\n   */\n  onUpdatedColor() {\n    this.#comment?.onUpdatedColor();\n  }\n\n  getData() {\n    const {\n      comment: { text: str, color, date, opacity, deleted, richText },\n      uid: id,\n      pageIndex,\n      creationDate,\n      modificationDate,\n    } = this;\n    return {\n      id,\n      pageIndex,\n      rect: this.getPDFRect(),\n      richText,\n      contentsObj: { str },\n      creationDate,\n      modificationDate: date || modificationDate,\n      popupRef: !deleted,\n      color,\n      opacity,\n    };\n  }\n\n  /**\n   * Executed once this editor has been rendered.\n   * @param {boolean} focus - true if the editor should be focused.\n   */\n  onceAdded(focus) {}\n\n  /**\n   * Check if the editor contains something.\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return false;\n  }\n\n  /**\n   * Enable edit mode.\n   * @returns {boolean} - true if the edit mode has been enabled.\n   */\n  enableEditMode() {\n    if (this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(false);\n    this.#isInEditMode = true;\n\n    return true;\n  }\n\n  /**\n   * Disable edit mode.\n   * @returns {boolean} - true if the edit mode has been disabled.\n   */\n  disableEditMode() {\n    if (!this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(true);\n    this.#isInEditMode = false;\n\n    return true;\n  }\n\n  /**\n   * Check if the editor is edited.\n   * @returns {boolean}\n   */\n  isInEditMode() {\n    return this.#isInEditMode;\n  }\n\n  /**\n   * If it returns true, then this editor handles the keyboard\n   * events itself.\n   * @returns {boolean}\n   */\n  shouldGetKeyboardEvents() {\n    return this.#isResizerEnabledForKeyboard;\n  }\n\n  /**\n   * Check if this editor needs to be rebuilt or not.\n   * @returns {boolean}\n   */\n  needsToBeRebuilt() {\n    return this.div && !this.isAttachedToDOM;\n  }\n\n  get isOnScreen() {\n    const { top, left, bottom, right } = this.getClientDimensions();\n    const { innerHeight, innerWidth } = window;\n    return left < innerWidth && right > 0 && top < innerHeight && bottom > 0;\n  }\n\n  #addFocusListeners() {\n    if (this.#focusAC || !this.div) {\n      return;\n    }\n    this.#focusAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#focusAC);\n\n    this.div.addEventListener(\"focusin\", this.focusin.bind(this), { signal });\n    this.div.addEventListener(\"focusout\", this.focusout.bind(this), { signal });\n  }\n\n  /**\n   * Rebuild the editor in case it has been removed on undo.\n   *\n   * To implement in subclasses.\n   */\n  rebuild() {\n    this.#addFocusListeners();\n  }\n\n  /**\n   * Rotate the editor when the page is rotated.\n   * @param {number} angle\n   */\n  rotate(_angle) {}\n\n  /**\n   * Resize the editor when the page is resized.\n   */\n  resize() {}\n\n  /**\n   * Serialize the editor when it has been deleted.\n   * @returns {Object}\n   */\n  serializeDeleted() {\n    return {\n      id: this.annotationElementId,\n      deleted: true,\n      pageIndex: this.pageIndex,\n      popupRef: this._initialData?.popupRef || \"\",\n    };\n  }\n\n  /**\n   * Serialize the editor.\n   * The result of the serialization will be used to construct a\n   * new annotation to add to the pdf document.\n   *\n   * To implement in subclasses.\n   * @param {boolean} [isForCopying]\n   * @param {Object | null} [context]\n   * @returns {Object | null}\n   */\n  serialize(isForCopying = false, context = null) {\n    return {\n      annotationType: this.mode,\n      pageIndex: this.pageIndex,\n      rect: this.getPDFRect(),\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n      popupRef: this._initialData?.popupRef || \"\",\n    };\n  }\n\n  /**\n   * Deserialize the editor.\n   * The result of the deserialization is a new editor.\n   *\n   * @param {Object} data\n   * @param {AnnotationEditorLayer} parent\n   * @param {AnnotationEditorUIManager} uiManager\n   * @returns {Promise<AnnotationEditor | null>}\n   */\n  static async deserialize(data, parent, uiManager) {\n    const editor = new this.prototype.constructor({\n      parent,\n      id: parent.getNextId(),\n      uiManager,\n      annotationElementId: data.annotationElementId,\n      creationDate: data.creationDate,\n      modificationDate: data.modificationDate,\n    });\n    editor.rotation = data.rotation;\n    editor.#accessibilityData = data.accessibilityData;\n    editor._isCopy = data.isCopy || false;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [x, y, width, height] = editor.getRectInCurrentCoords(\n      data.rect,\n      pageHeight\n    );\n\n    editor.x = x / pageWidth;\n    editor.y = y / pageHeight;\n    editor.width = width / pageWidth;\n    editor.height = height / pageHeight;\n\n    return editor;\n  }\n\n  /**\n   * Check if an existing annotation associated with this editor has been\n   * modified.\n   * @returns {boolean}\n   */\n  get hasBeenModified() {\n    return (\n      !!this.annotationElementId && (this.deleted || this.serialize() !== null)\n    );\n  }\n\n  /**\n   * Remove this editor.\n   * It's used on ctrl+backspace action.\n   */\n  remove() {\n    this.#focusAC?.abort();\n    this.#focusAC = null;\n\n    if (!this.isEmpty()) {\n      // The editor is removed but it can be back at some point thanks to\n      // undo/redo so we must commit it before.\n      this.commit();\n    }\n    if (this.parent) {\n      this.parent.remove(this);\n    } else {\n      this._uiManager.removeEditor(this);\n    }\n    this.hideCommentPopup();\n\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n      this.#moveInDOMTimeout = null;\n    }\n    this.#stopResizing();\n    this.removeEditToolbar();\n    if (this.#telemetryTimeouts) {\n      for (const timeout of this.#telemetryTimeouts.values()) {\n        clearTimeout(timeout);\n      }\n      this.#telemetryTimeouts = null;\n    }\n    this.parent = null;\n    this.#touchManager?.destroy();\n    this.#touchManager = null;\n    this.#fakeAnnotation?.remove();\n    this.#fakeAnnotation = null;\n  }\n\n  /**\n   * @returns {boolean} true if this editor can be resized.\n   */\n  get isResizable() {\n    return false;\n  }\n\n  /**\n   * Add the resizers to this editor.\n   */\n  makeResizable() {\n    if (this.isResizable) {\n      this.#createResizers();\n      this.#resizersDiv.classList.remove(\"hidden\");\n    }\n  }\n\n  get toolbarPosition() {\n    return null;\n  }\n\n  /**\n   * Get the position of the comment button.\n   * @returns {Array<number>|null}\n   */\n  get commentButtonPosition() {\n    return this._uiManager.direction === \"ltr\" ? [1, 0] : [0, 0];\n  }\n\n  get commentButtonPositionInPage() {\n    const {\n      commentButtonPosition: [posX, posY],\n    } = this;\n    const [blX, blY, trX, trY] = this.getPDFRect();\n    return [\n      AnnotationEditor._round(blX + (trX - blX) * posX),\n      AnnotationEditor._round(blY + (trY - blY) * (1 - posY)),\n    ];\n  }\n\n  get commentButtonColor() {\n    return this._uiManager.makeCommentColor(\n      this.getNonHCMColor(),\n      this.opacity\n    );\n  }\n\n  get commentPopupPosition() {\n    return this.#comment.commentPopupPositionInLayer;\n  }\n\n  set commentPopupPosition(pos) {\n    this.#comment.commentPopupPositionInLayer = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#comment.hasDefaultPopupPosition();\n  }\n\n  get commentButtonWidth() {\n    return this.#comment.commentButtonWidth;\n  }\n\n  get elementBeforePopup() {\n    return this.div;\n  }\n\n  setCommentButtonStates(options) {\n    this.#comment?.setCommentButtonStates(options);\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (\n      !this.isResizable ||\n      event.target !== this.div ||\n      event.key !== \"Enter\"\n    ) {\n      return;\n    }\n    this._uiManager.setSelected(this);\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const children = this.#resizersDiv.children;\n    if (!this.#allResizerDivs) {\n      this.#allResizerDivs = Array.from(children);\n      const boundResizerKeydown = this.#resizerKeydown.bind(this);\n      const boundResizerBlur = this.#resizerBlur.bind(this);\n      const signal = this._uiManager._signal;\n      for (const div of this.#allResizerDivs) {\n        const name = div.getAttribute(\"data-resizer-name\");\n        div.setAttribute(\"role\", \"spinbutton\");\n        div.addEventListener(\"keydown\", boundResizerKeydown, { signal });\n        div.addEventListener(\"blur\", boundResizerBlur, { signal });\n        div.addEventListener(\"focus\", this.#resizerFocus.bind(this, name), {\n          signal,\n        });\n        div.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    // We want to have the resizers in the visual order, so we move the first\n    // (top-left) to the right place.\n    const first = this.#allResizerDivs[0];\n    let firstPosition = 0;\n    for (const div of children) {\n      if (div === first) {\n        break;\n      }\n      firstPosition++;\n    }\n    const nextFirstPosition =\n      (((360 - this.rotation + this.parentRotation) % 360) / 90) *\n      (this.#allResizerDivs.length / 4);\n\n    if (nextFirstPosition !== firstPosition) {\n      // We need to reorder the resizers in the DOM in order to have the focus\n      // on the top-left one.\n      if (nextFirstPosition < firstPosition) {\n        for (let i = 0; i < firstPosition - nextFirstPosition; i++) {\n          this.#resizersDiv.append(this.#resizersDiv.firstElementChild);\n        }\n      } else if (nextFirstPosition > firstPosition) {\n        for (let i = 0; i < nextFirstPosition - firstPosition; i++) {\n          this.#resizersDiv.firstElementChild.before(\n            this.#resizersDiv.lastElementChild\n          );\n        }\n      }\n\n      let i = 0;\n      for (const child of children) {\n        const div = this.#allResizerDivs[i++];\n        const name = div.getAttribute(\"data-resizer-name\");\n        child.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    this.#setResizerTabIndex(0);\n    this.#isResizerEnabledForKeyboard = true;\n    this.#resizersDiv.firstElementChild.focus({ focusVisible: true });\n    event.preventDefault();\n    event.stopImmediatePropagation();\n  }\n\n  #resizerKeydown(event) {\n    AnnotationEditor._resizerKeyboardManager.exec(this, event);\n  }\n\n  #resizerBlur(event) {\n    if (\n      this.#isResizerEnabledForKeyboard &&\n      event.relatedTarget?.parentNode !== this.#resizersDiv\n    ) {\n      this.#stopResizing();\n    }\n  }\n\n  #resizerFocus(name) {\n    this.#focusedResizerName = this.#isResizerEnabledForKeyboard ? name : \"\";\n  }\n\n  #setResizerTabIndex(value) {\n    if (!this.#allResizerDivs) {\n      return;\n    }\n    for (const div of this.#allResizerDivs) {\n      div.tabIndex = value;\n    }\n  }\n\n  _resizeWithKeyboard(x, y) {\n    if (!this.#isResizerEnabledForKeyboard) {\n      return;\n    }\n    this.#resizerPointermove(this.#focusedResizerName, {\n      deltaX: x,\n      deltaY: y,\n      fromKeyboard: true,\n    });\n  }\n\n  #stopResizing() {\n    this.#isResizerEnabledForKeyboard = false;\n    this.#setResizerTabIndex(-1);\n    this.#addResizeToUndoStack();\n  }\n\n  _stopResizingWithKeyboard() {\n    this.#stopResizing();\n    this.div.focus();\n  }\n\n  /**\n   * Select this editor.\n   */\n  select() {\n    if (this.isSelected && this._editToolbar) {\n      this._editToolbar.show();\n      return;\n    }\n    this.isSelected = true;\n    this.makeResizable();\n    this.div?.classList.add(\"selectedEditor\");\n    if (!this._editToolbar) {\n      this.addEditToolbar().then(() => {\n        if (this.div?.classList.contains(\"selectedEditor\")) {\n          // The editor can have been unselected while we were waiting for the\n          // edit toolbar to be created, hence we want to be sure that this\n          // editor is still selected.\n          this._editToolbar?.show();\n        }\n      });\n      return;\n    }\n    this._editToolbar?.show();\n    this.#altText?.toggleAltTextBadge(false);\n  }\n\n  focus() {\n    if (this.div && !this.div.contains(document.activeElement)) {\n      setTimeout(() => this.div?.focus({ preventScroll: true }), 0);\n    }\n  }\n\n  /**\n   * Unselect this editor.\n   */\n  unselect() {\n    if (!this.isSelected) {\n      return;\n    }\n    this.isSelected = false;\n    this.#resizersDiv?.classList.add(\"hidden\");\n    this.div?.classList.remove(\"selectedEditor\");\n    if (this.div?.contains(document.activeElement)) {\n      // Don't use this.div.blur() because we don't know where the focus will\n      // go.\n      this._uiManager.currentLayer.div.focus({\n        preventScroll: true,\n      });\n    }\n    this._editToolbar?.hide();\n    this.#altText?.toggleAltTextBadge(true);\n    this.hideCommentPopup();\n  }\n\n  hideCommentPopup() {\n    if (this.hasComment) {\n      this._uiManager.toggleComment(null);\n    }\n  }\n\n  /**\n   * Update some parameters which have been changed through the UI.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {}\n\n  /**\n   * When the user disables the editing mode some editors can change some of\n   * their properties.\n   */\n  disableEditing() {}\n\n  /**\n   * When the user enables the editing mode some editors can change some of\n   * their properties.\n   */\n  enableEditing() {}\n\n  /**\n   * Check if the content of this editor can be changed.\n   * For example, a FreeText editor can be changed (the user can change the\n   * text), but a Stamp editor cannot.\n   * @returns {boolean}\n   */\n  get canChangeContent() {\n    return false;\n  }\n\n  /**\n   * The editor is about to be edited.\n   */\n  enterInEditMode() {\n    if (!this.canChangeContent) {\n      return;\n    }\n    this.enableEditMode();\n    this.div.focus();\n  }\n\n  /**\n   * ondblclick callback.\n   * @param {MouseEvent} event\n   */\n  dblclick(event) {\n    if (event.target.nodeName === \"BUTTON\") {\n      // Avoid entering in edit mode when clicking on the comment button.\n      return;\n    }\n    this.enterInEditMode();\n    this.parent.updateToolbar({\n      mode: this.constructor._editorType,\n      editId: this.uid,\n    });\n  }\n\n  /**\n   * @returns {HTMLElement | null} the element requiring an alt text.\n   */\n  getElementForAltText() {\n    return this.div;\n  }\n\n  /**\n   * Get the div which really contains the displayed content.\n   * @returns {HTMLDivElement | undefined}\n   */\n  get contentDiv() {\n    return this.div;\n  }\n\n  /**\n   * If true then the editor is currently edited.\n   * @type {boolean}\n   */\n  get isEditing() {\n    return this.#isEditing;\n  }\n\n  /**\n   * When set to true, it means that this editor is currently edited.\n   * @param {boolean} value\n   */\n  set isEditing(value) {\n    this.#isEditing = value;\n    if (!this.parent) {\n      return;\n    }\n    if (value) {\n      this.parent.setSelected(this);\n      this.parent.setActiveEditor(this);\n    } else {\n      this.parent.setActiveEditor(null);\n    }\n  }\n\n  static get MIN_SIZE() {\n    return 16;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return true;\n  }\n\n  /**\n   * Get the data to report to the telemetry when the editor is added.\n   * @returns {Object}\n   */\n  get telemetryInitialData() {\n    return { action: \"added\" };\n  }\n\n  /**\n   * The telemetry data to use when saving/printing.\n   * @returns {Object|null}\n   */\n  get telemetryFinalData() {\n    return null;\n  }\n\n  _reportTelemetry(data, mustWait = false) {\n    if (mustWait) {\n      this.#telemetryTimeouts ||= new Map();\n      const { action } = data;\n      let timeout = this.#telemetryTimeouts.get(action);\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n      timeout = setTimeout(() => {\n        this._reportTelemetry(data);\n        this.#telemetryTimeouts.delete(action);\n        if (this.#telemetryTimeouts.size === 0) {\n          this.#telemetryTimeouts = null;\n        }\n      }, AnnotationEditor._telemetryTimeout);\n      this.#telemetryTimeouts.set(action, timeout);\n      return;\n    }\n    data.type ||= this.editorType;\n    this._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        data,\n      },\n    });\n  }\n\n  /**\n   * Show or hide this editor.\n   * @param {boolean|undefined} visible\n   */\n  show(visible = this._isVisible) {\n    this.div.classList.toggle(\"hidden\", !visible);\n    this._isVisible = visible;\n  }\n\n  enable() {\n    if (this.div) {\n      this.div.tabIndex = 0;\n    }\n    this.#disabled = false;\n  }\n\n  disable() {\n    if (this.div) {\n      this.div.tabIndex = -1;\n    }\n    this.#disabled = true;\n  }\n\n  updateFakeAnnotationElement(annotationLayer) {\n    if (!this.#fakeAnnotation && !this.deleted) {\n      this.#fakeAnnotation = annotationLayer.addFakeAnnotation(this);\n      return;\n    }\n    if (this.deleted) {\n      this.#fakeAnnotation.remove();\n      this.#fakeAnnotation = null;\n      return;\n    }\n    if (this.hasEditedComment || this._hasBeenMoved || this._hasBeenResized) {\n      this.#fakeAnnotation.updateEdited({\n        rect: this.getPDFRect(),\n        popup: this.comment,\n      });\n    }\n  }\n\n  /**\n   * Render an annotation in the annotation layer.\n   * @param {Object} annotation\n   * @returns {HTMLElement|null}\n   */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    let content = annotation.container.querySelector(\".annotationContent\");\n    if (!content) {\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      annotation.container.prepend(content);\n    } else if (content.nodeName === \"CANVAS\") {\n      const canvas = content;\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      canvas.before(content);\n    }\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    const { firstElementChild } = annotation.container;\n    if (\n      firstElementChild?.nodeName === \"DIV\" &&\n      firstElementChild.classList.contains(\"annotationContent\")\n    ) {\n      firstElementChild.remove();\n    }\n  }\n}\n\n// This class is used to fake an editor which has been deleted.\nclass FakeEditor extends AnnotationEditor {\n  constructor(params) {\n    super(params);\n    this.annotationElementId = params.annotationElementId;\n    this.deleted = true;\n  }\n\n  serialize() {\n    return this.serializeDeleted();\n  }\n}\n\nexport { AnnotationEditor };\n","/* Copyright 2014 Opera Software ASA\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n *\n * Based on https://code.google.com/p/smhasher/wiki/MurmurHash3.\n * Hashes roughly 100 KB per millisecond on i7 3.4 GHz.\n */\n\nconst SEED = 0xc3d2e1f0;\n// Workaround for missing math precision in JS.\nconst MASK_HIGH = 0xffff0000;\nconst MASK_LOW = 0xffff;\n\nclass MurmurHash3_64 {\n  constructor(seed) {\n    this.h1 = seed ? seed & 0xffffffff : SEED;\n    this.h2 = seed ? seed & 0xffffffff : SEED;\n  }\n\n  update(input) {\n    let data, length;\n    if (typeof input === \"string\") {\n      data = new Uint8Array(input.length * 2);\n      length = 0;\n      for (let i = 0, ii = input.length; i < ii; i++) {\n        const code = input.charCodeAt(i);\n        if (code <= 0xff) {\n          data[length++] = code;\n        } else {\n          data[length++] = code >>> 8;\n          data[length++] = code & 0xff;\n        }\n      }\n    } else if (ArrayBuffer.isView(input)) {\n      data = input.slice();\n      length = data.byteLength;\n    } else {\n      throw new Error(\"Invalid data format, must be a string or TypedArray.\");\n    }\n\n    const blockCounts = length >> 2;\n    const tailLength = length - blockCounts * 4;\n    // We don't care about endianness here.\n    const dataUint32 = new Uint32Array(data.buffer, 0, blockCounts);\n    let k1 = 0,\n      k2 = 0;\n    let h1 = this.h1,\n      h2 = this.h2;\n    const C1 = 0xcc9e2d51,\n      C2 = 0x1b873593;\n    const C1_LOW = C1 & MASK_LOW,\n      C2_LOW = C2 & MASK_LOW;\n\n    for (let i = 0; i < blockCounts; i++) {\n      if (i & 1) {\n        k1 = dataUint32[i];\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = h1 * 5 + 0xe6546b64;\n      } else {\n        k2 = dataUint32[i];\n        k2 = ((k2 * C1) & MASK_HIGH) | ((k2 * C1_LOW) & MASK_LOW);\n        k2 = (k2 << 15) | (k2 >>> 17);\n        k2 = ((k2 * C2) & MASK_HIGH) | ((k2 * C2_LOW) & MASK_LOW);\n        h2 ^= k2;\n        h2 = (h2 << 13) | (h2 >>> 19);\n        h2 = h2 * 5 + 0xe6546b64;\n      }\n    }\n\n    k1 = 0;\n\n    switch (tailLength) {\n      case 3:\n        k1 ^= data[blockCounts * 4 + 2] << 16;\n      /* falls through */\n      case 2:\n        k1 ^= data[blockCounts * 4 + 1] << 8;\n      /* falls through */\n      case 1:\n        k1 ^= data[blockCounts * 4];\n        /* falls through */\n\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        if (blockCounts & 1) {\n          h1 ^= k1;\n        } else {\n          h2 ^= k1;\n        }\n    }\n\n    this.h1 = h1;\n    this.h2 = h2;\n  }\n\n  hexdigest() {\n    let h1 = this.h1,\n      h2 = this.h2;\n\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0xed558ccd) & MASK_HIGH) | ((h1 * 0x8ccd) & MASK_LOW);\n    h2 =\n      ((h2 * 0xff51afd7) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xafd7ed55) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0x1a85ec53) & MASK_HIGH) | ((h1 * 0xec53) & MASK_LOW);\n    h2 =\n      ((h2 * 0xc4ceb9fe) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xb9fe1a85) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n\n    return (\n      (h1 >>> 0).toString(16).padStart(8, \"0\") +\n      (h2 >>> 0).toString(16).padStart(8, \"0\")\n    );\n  }\n}\n\nexport { MurmurHash3_64 };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { shadow, unreachable } from \"../shared/util.js\";\nimport { AnnotationEditor } from \"./editor/editor.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst SerializableEmpty = Object.freeze({\n  map: null,\n  hash: \"\",\n  transfer: undefined,\n});\n\n/**\n * Key/value storage for annotation data in forms.\n */\nclass AnnotationStorage {\n  #modified = false;\n\n  #modifiedIds = null;\n\n  #editorsMap = null;\n\n  #storage = new Map();\n\n  constructor() {\n    // Callbacks to signal when the modification state is set or reset.\n    // This is used by the viewer to only bind on `beforeunload` if forms\n    // are actually edited to prevent doing so unconditionally since that\n    // can have undesirable effects.\n    this.onSetModified = null;\n    this.onResetModified = null;\n    this.onAnnotationEditor = null;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_setValues\", {\n        value: obj => {\n          for (const [key, val] of Object.entries(obj)) {\n            this.setValue(key, val);\n          }\n        },\n      });\n    }\n  }\n\n  /**\n   * Get the value for a given key if it exists, or return the default value.\n   * @param {string} key\n   * @param {Object} defaultValue\n   * @returns {Object}\n   */\n  getValue(key, defaultValue) {\n    const value = this.#storage.get(key);\n    if (value === undefined) {\n      return defaultValue;\n    }\n\n    return Object.assign(defaultValue, value);\n  }\n\n  /**\n   * Get the value for a given key.\n   * @param {string} key\n   * @returns {Object}\n   */\n  getRawValue(key) {\n    return this.#storage.get(key);\n  }\n\n  /**\n   * Remove a value from the storage.\n   * @param {string} key\n   */\n  remove(key) {\n    const storedValue = this.#storage.get(key);\n    if (storedValue === undefined) {\n      return;\n    }\n    if (storedValue instanceof AnnotationEditor) {\n      this.#editorsMap.delete(storedValue.annotationElementId);\n    }\n    this.#storage.delete(key);\n\n    if (this.#storage.size === 0) {\n      this.resetModified();\n    }\n\n    if (typeof this.onAnnotationEditor === \"function\") {\n      for (const value of this.#storage.values()) {\n        if (value instanceof AnnotationEditor) {\n          return;\n        }\n      }\n      this.onAnnotationEditor(null);\n    }\n  }\n\n  /**\n   * Set the value for a given key\n   * @param {string} key\n   * @param {Object} value\n   */\n  setValue(key, value) {\n    const obj = this.#storage.get(key);\n    let modified = false;\n    if (obj !== undefined) {\n      for (const [entry, val] of Object.entries(value)) {\n        if (obj[entry] !== val) {\n          modified = true;\n          obj[entry] = val;\n        }\n      }\n    } else {\n      modified = true;\n      this.#storage.set(key, value);\n    }\n    if (modified) {\n      this.#setModified();\n    }\n\n    if (value instanceof AnnotationEditor) {\n      (this.#editorsMap ||= new Map()).set(value.annotationElementId, value);\n      if (typeof this.onAnnotationEditor === \"function\") {\n        this.onAnnotationEditor(value.constructor._type);\n      }\n    }\n  }\n\n  /**\n   * Check if the storage contains the given key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.#storage.has(key);\n  }\n\n  get size() {\n    return this.#storage.size;\n  }\n\n  #setModified() {\n    if (!this.#modified) {\n      this.#modified = true;\n      if (typeof this.onSetModified === \"function\") {\n        this.onSetModified();\n      }\n    }\n  }\n\n  resetModified() {\n    if (this.#modified) {\n      this.#modified = false;\n      if (typeof this.onResetModified === \"function\") {\n        this.onResetModified();\n      }\n    }\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  get print() {\n    return new PrintAnnotationStorage(this);\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    if (this.#storage.size === 0) {\n      return SerializableEmpty;\n    }\n    const map = new Map(),\n      hash = new MurmurHash3_64(),\n      transfer = [];\n    const context = Object.create(null);\n    let hasBitmap = false;\n\n    for (const [key, val] of this.#storage) {\n      const serialized =\n        val instanceof AnnotationEditor\n          ? val.serialize(/* isForCopying = */ false, context)\n          : val;\n      if (serialized) {\n        map.set(key, serialized);\n\n        hash.update(`${key}:${JSON.stringify(serialized)}`);\n        hasBitmap ||= !!serialized.bitmap;\n      }\n    }\n\n    if (hasBitmap) {\n      // We must transfer the bitmap data separately, since it can be changed\n      // during serialization with SVG images.\n      for (const value of map.values()) {\n        if (value.bitmap) {\n          transfer.push(value.bitmap);\n        }\n      }\n    }\n\n    return map.size > 0\n      ? { map, hash: hash.hexdigest(), transfer }\n      : SerializableEmpty;\n  }\n\n  get editorStats() {\n    let stats = null;\n    const typeToEditor = new Map();\n    let numberOfEditedComments = 0;\n    let numberOfDeletedComments = 0;\n    for (const value of this.#storage.values()) {\n      if (!(value instanceof AnnotationEditor)) {\n        if (value.popup) {\n          if (value.popup.deleted) {\n            numberOfDeletedComments += 1;\n          } else {\n            numberOfEditedComments += 1;\n          }\n        }\n        continue;\n      }\n      if (value.isCommentDeleted) {\n        numberOfDeletedComments += 1;\n      } else if (value.hasEditedComment) {\n        numberOfEditedComments += 1;\n      }\n      const editorStats = value.telemetryFinalData;\n      if (!editorStats) {\n        continue;\n      }\n      const { type } = editorStats;\n      if (!typeToEditor.has(type)) {\n        typeToEditor.set(type, Object.getPrototypeOf(value).constructor);\n      }\n      stats ||= Object.create(null);\n      const map = (stats[type] ||= new Map());\n      for (const [key, val] of Object.entries(editorStats)) {\n        if (key === \"type\") {\n          continue;\n        }\n        let counters = map.get(key);\n        if (!counters) {\n          counters = new Map();\n          map.set(key, counters);\n        }\n        const count = counters.get(val) ?? 0;\n        counters.set(val, count + 1);\n      }\n    }\n    if (numberOfDeletedComments > 0 || numberOfEditedComments > 0) {\n      stats ||= Object.create(null);\n      stats.comments = {\n        deleted: numberOfDeletedComments,\n        edited: numberOfEditedComments,\n      };\n    }\n    if (!stats) {\n      return null;\n    }\n    for (const [type, editor] of typeToEditor) {\n      stats[type] = editor.computeTelemetryFinalData(stats[type]);\n    }\n    return stats;\n  }\n\n  resetModifiedIds() {\n    this.#modifiedIds = null;\n  }\n\n  updateEditor(annotationId, data) {\n    const value = this.#editorsMap?.get(annotationId);\n    if (value) {\n      value.updateFromAnnotationLayer(data);\n      return true;\n    }\n    return false;\n  }\n\n  getEditor(annotationId) {\n    return this.#editorsMap?.get(annotationId) || null;\n  }\n\n  /**\n   * @returns {{ids: Set<string>, hash: string}}\n   */\n  get modifiedIds() {\n    if (this.#modifiedIds) {\n      return this.#modifiedIds;\n    }\n    const ids = [];\n    if (this.#editorsMap) {\n      for (const value of this.#editorsMap.values()) {\n        if (!value.serialize()) {\n          continue;\n        }\n        ids.push(value.annotationElementId);\n      }\n    }\n    return (this.#modifiedIds = {\n      ids: new Set(ids),\n      hash: ids.join(\",\"),\n    });\n  }\n\n  [Symbol.iterator]() {\n    return this.#storage.entries();\n  }\n}\n\n/**\n * A special `AnnotationStorage` for use during printing, where the serializable\n * data is *frozen* upon initialization, to prevent scripting from modifying its\n * contents. (Necessary since printing is triggered synchronously in browsers.)\n */\nclass PrintAnnotationStorage extends AnnotationStorage {\n  #serializable;\n\n  constructor(parent) {\n    super();\n    const { map, hash, transfer } = parent.serializable;\n    // Create a *copy* of the data, since Objects are passed by reference in JS.\n    const clone = structuredClone(map, transfer ? { transfer } : null);\n\n    this.#serializable = { map: clone, hash, transfer };\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  // eslint-disable-next-line getter-return\n  get print() {\n    unreachable(\"Should not call PrintAnnotationStorage.print\");\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    return this.#serializable;\n  }\n\n  get modifiedIds() {\n    return shadow(this, \"modifiedIds\", {\n      ids: new Set(),\n      hash: \"\",\n    });\n  }\n}\n\nexport { AnnotationStorage, PrintAnnotationStorage, SerializableEmpty };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  FeatureTest,\n  isNodeJS,\n  shadow,\n  string32,\n  toBase64Util,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { makePathFromDrawOPS } from \"./display_utils.js\";\n\nclass FontLoader {\n  #systemFonts = new Set();\n\n  constructor({\n    ownerDocument = globalThis.document,\n    styleElement = null, // For testing only.\n  }) {\n    this._document = ownerDocument;\n\n    this.nativeFontFaces = new Set();\n    this.styleElement =\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n        ? styleElement\n        : null;\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.loadingRequests = [];\n      this.loadTestFontId = 0;\n    }\n  }\n\n  addNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.add(nativeFontFace);\n    this._document.fonts.add(nativeFontFace);\n  }\n\n  removeNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.delete(nativeFontFace);\n    this._document.fonts.delete(nativeFontFace);\n  }\n\n  insertRule(rule) {\n    if (!this.styleElement) {\n      this.styleElement = this._document.createElement(\"style\");\n      this._document.documentElement\n        .getElementsByTagName(\"head\")[0]\n        .append(this.styleElement);\n    }\n    const styleSheet = this.styleElement.sheet;\n    styleSheet.insertRule(rule, styleSheet.cssRules.length);\n  }\n\n  clear() {\n    for (const nativeFontFace of this.nativeFontFaces) {\n      this._document.fonts.delete(nativeFontFace);\n    }\n    this.nativeFontFaces.clear();\n    this.#systemFonts.clear();\n\n    if (this.styleElement) {\n      // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n      this.styleElement.remove();\n      this.styleElement = null;\n    }\n  }\n\n  async loadSystemFont({\n    systemFontInfo: info,\n    disableFontFace,\n    _inspectFont,\n  }) {\n    if (!info || this.#systemFonts.has(info.loadedName)) {\n      return;\n    }\n    assert(\n      !disableFontFace,\n      \"loadSystemFont shouldn't be called when `disableFontFace` is set.\"\n    );\n\n    if (this.isFontLoadingAPISupported) {\n      const { loadedName, src, style } = info;\n      const fontFace = new FontFace(loadedName, src, style);\n      this.addNativeFontFace(fontFace);\n      try {\n        await fontFace.load();\n        this.#systemFonts.add(loadedName);\n        _inspectFont?.(info);\n      } catch {\n        warn(\n          `Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`\n        );\n\n        this.removeNativeFontFace(fontFace);\n      }\n      return;\n    }\n\n    unreachable(\n      \"Not implemented: loadSystemFont without the Font Loading API.\"\n    );\n  }\n\n  async bind(font) {\n    // Add the font to the DOM only once; skip if the font is already loaded.\n    if (font.attached || (font.missingFile && !font.systemFontInfo)) {\n      return;\n    }\n    font.attached = true;\n\n    if (font.systemFontInfo) {\n      await this.loadSystemFont(font);\n      return;\n    }\n\n    if (this.isFontLoadingAPISupported) {\n      const nativeFontFace = font.createNativeFontFace();\n      if (nativeFontFace) {\n        this.addNativeFontFace(nativeFontFace);\n        try {\n          await nativeFontFace.loaded;\n        } catch (ex) {\n          warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`);\n\n          // When font loading failed, fall back to the built-in font renderer.\n          font.disableFontFace = true;\n          throw ex;\n        }\n      }\n      return; // The font was, asynchronously, loaded.\n    }\n\n    // !this.isFontLoadingAPISupported\n    const rule = font.createFontFaceRule();\n    if (rule) {\n      this.insertRule(rule);\n\n      if (this.isSyncFontLoadingSupported) {\n        return; // The font was, synchronously, loaded.\n      }\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: async font loading\");\n      }\n      await new Promise(resolve => {\n        const request = this._queueLoadingCallback(resolve);\n        this._prepareFontLoadEvent(font, request);\n      });\n      // The font was, asynchronously, loaded.\n    }\n  }\n\n  get isFontLoadingAPISupported() {\n    const hasFonts = !!this._document?.fonts;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      return shadow(\n        this,\n        \"isFontLoadingAPISupported\",\n        hasFonts && !this.styleElement\n      );\n    }\n    return shadow(this, \"isFontLoadingAPISupported\", hasFonts);\n  }\n\n  get isSyncFontLoadingSupported() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return shadow(this, \"isSyncFontLoadingSupported\", true);\n    }\n\n    // Node.js - we can pretend that sync font loading is supported.\n    // Firefox, from version 14, supports synchronous font loading.\n    return shadow(\n      this,\n      \"isSyncFontLoadingSupported\",\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) &&\n        (isNodeJS || FeatureTest.platform.isFirefox)\n    );\n  }\n\n  _queueLoadingCallback(callback) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _queueLoadingCallback\");\n    }\n\n    function completeRequest() {\n      assert(!request.done, \"completeRequest() cannot be called twice.\");\n      request.done = true;\n\n      // Sending all completed requests in order of how they were queued.\n      while (loadingRequests.length > 0 && loadingRequests[0].done) {\n        const otherRequest = loadingRequests.shift();\n        setTimeout(otherRequest.callback, 0);\n      }\n    }\n\n    const { loadingRequests } = this;\n    const request = {\n      done: false,\n      complete: completeRequest,\n      callback,\n    };\n    loadingRequests.push(request);\n    return request;\n  }\n\n  get _loadTestFont() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _loadTestFont\");\n    }\n\n    // This is a CFF font with 1 glyph for '.' that fills its entire width\n    // and height.\n    const testFont = atob(\n      \"T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA\" +\n        \"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA\" +\n        \"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA\" +\n        \"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1\" +\n        \"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD\" +\n        \"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM\" +\n        \"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D\" +\n        \"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA\" +\n        \"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA\" +\n        \"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB\" +\n        \"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY\" +\n        \"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA\" +\n        \"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA\" +\n        \"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC\" +\n        \"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3\" +\n        \"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj\" +\n        \"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==\"\n    );\n    return shadow(this, \"_loadTestFont\", testFont);\n  }\n\n  _prepareFontLoadEvent(font, request) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _prepareFontLoadEvent\");\n    }\n\n    /** Hack begin */\n    // There's currently no event when a font has finished downloading so the\n    // following code is a dirty hack to 'guess' when a font is ready.\n    // It's assumed fonts are loaded in order, so add a known test font after\n    // the desired fonts and then test for the loading of that test font.\n\n    function int32(data, offset) {\n      return (\n        (data.charCodeAt(offset) << 24) |\n        (data.charCodeAt(offset + 1) << 16) |\n        (data.charCodeAt(offset + 2) << 8) |\n        (data.charCodeAt(offset + 3) & 0xff)\n      );\n    }\n    function spliceString(s, offset, remove, insert) {\n      const chunk1 = s.substring(0, offset);\n      const chunk2 = s.substring(offset + remove);\n      return chunk1 + insert + chunk2;\n    }\n    let i, ii;\n\n    // The temporary canvas is used to determine if fonts are loaded.\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext(\"2d\");\n\n    let called = 0;\n    function isFontReady(name, callback) {\n      // With setTimeout clamping this gives the font ~100ms to load.\n      if (++called > 30) {\n        warn(\"Load test font never loaded.\");\n        callback();\n        return;\n      }\n      ctx.font = \"30px \" + name;\n      ctx.fillText(\".\", 0, 20);\n      const imageData = ctx.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] > 0) {\n        callback();\n        return;\n      }\n      setTimeout(isFontReady.bind(null, name, callback));\n    }\n\n    const loadTestFontId = `lt${Date.now()}${this.loadTestFontId++}`;\n    // Chromium seems to cache fonts based on a hash of the actual font data,\n    // so the font must be modified for each load test else it will appear to\n    // be loaded already.\n    // TODO: This could maybe be made faster by avoiding the btoa of the full\n    // font by splitting it in chunks before hand and padding the font id.\n    let data = this._loadTestFont;\n    const COMMENT_OFFSET = 976; // has to be on 4 byte boundary (for checksum)\n    data = spliceString(\n      data,\n      COMMENT_OFFSET,\n      loadTestFontId.length,\n      loadTestFontId\n    );\n    // CFF checksum is important for IE, adjusting it\n    const CFF_CHECKSUM_OFFSET = 16;\n    const XXXX_VALUE = 0x58585858; // the \"comment\" filled with 'X'\n    let checksum = int32(data, CFF_CHECKSUM_OFFSET);\n    for (i = 0, ii = loadTestFontId.length - 3; i < ii; i += 4) {\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId, i)) | 0;\n    }\n    if (i < loadTestFontId.length) {\n      // align to 4 bytes boundary\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId + \"XXX\", i)) | 0;\n    }\n    data = spliceString(data, CFF_CHECKSUM_OFFSET, 4, string32(checksum));\n\n    const url = `url(data:font/opentype;base64,${btoa(data)});`;\n    const rule = `@font-face {font-family:\"${loadTestFontId}\";src:${url}}`;\n    this.insertRule(rule);\n\n    const div = this._document.createElement(\"div\");\n    div.style.visibility = \"hidden\";\n    div.style.width = div.style.height = \"10px\";\n    div.style.position = \"absolute\";\n    div.style.top = div.style.left = \"0px\";\n\n    for (const name of [font.loadedName, loadTestFontId]) {\n      const span = this._document.createElement(\"span\");\n      span.textContent = \"Hi\";\n      span.style.fontFamily = name;\n      div.append(span);\n    }\n    this._document.body.append(div);\n\n    isFontReady(loadTestFontId, () => {\n      div.remove();\n      request.complete();\n    });\n    /** Hack end */\n  }\n}\n\nclass FontFaceObject {\n  #fontData;\n\n  constructor(translatedData, inspectFont = null, extra, charProcOperatorList) {\n    this.compiledGlyphs = Object.create(null);\n    this.#fontData = translatedData;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      if (typeof this.disableFontFace !== \"boolean\") {\n        unreachable(\"disableFontFace must be available.\");\n      }\n      if (typeof this.fontExtraProperties !== \"boolean\") {\n        unreachable(\"fontExtraProperties must be available.\");\n      }\n    }\n    this._inspectFont = inspectFont;\n    if (extra) {\n      Object.assign(this, extra);\n    }\n    if (charProcOperatorList) {\n      this.charProcOperatorList = charProcOperatorList;\n    }\n  }\n\n  createNativeFontFace() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    let nativeFontFace;\n    if (!this.cssFontInfo) {\n      nativeFontFace = new FontFace(this.loadedName, this.data, {});\n    } else {\n      const css = {\n        weight: this.cssFontInfo.fontWeight,\n      };\n      if (this.cssFontInfo.italicAngle) {\n        css.style = `oblique ${this.cssFontInfo.italicAngle}deg`;\n      }\n      nativeFontFace = new FontFace(\n        this.cssFontInfo.fontFamily,\n        this.data,\n        css\n      );\n    }\n\n    this._inspectFont?.(this);\n    return nativeFontFace;\n  }\n\n  createFontFaceRule() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    // Add the @font-face rule to the document.\n    const url = `url(data:${this.mimetype};base64,${toBase64Util(this.data)});`;\n    let rule;\n    if (!this.cssFontInfo) {\n      rule = `@font-face {font-family:\"${this.loadedName}\";src:${url}}`;\n    } else {\n      let css = `font-weight: ${this.cssFontInfo.fontWeight};`;\n      if (this.cssFontInfo.italicAngle) {\n        css += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`;\n      }\n      rule = `@font-face {font-family:\"${this.cssFontInfo.fontFamily}\";${css}src:${url}}`;\n    }\n\n    this._inspectFont?.(this, url);\n    return rule;\n  }\n\n  getPathGenerator(objs, character) {\n    if (this.compiledGlyphs[character] !== undefined) {\n      return this.compiledGlyphs[character];\n    }\n\n    const objId = this.loadedName + \"_path_\" + character;\n    let cmds;\n    try {\n      cmds = objs.get(objId);\n    } catch (ex) {\n      warn(`getPathGenerator - ignoring character: \"${ex}\".`);\n    }\n    const path = makePathFromDrawOPS(cmds);\n\n    if (!this.fontExtraProperties) {\n      // Remove the raw path-string, since we don't need it anymore.\n      objs.delete(objId);\n    }\n    return (this.compiledGlyphs[character] = path);\n  }\n\n  get black() {\n    return this.#fontData.black;\n  }\n\n  get bold() {\n    return this.#fontData.bold;\n  }\n\n  get disableFontFace() {\n    return this.#fontData.disableFontFace ?? false;\n  }\n\n  set disableFontFace(value) {\n    shadow(this, \"disableFontFace\", !!value);\n  }\n\n  get fontExtraProperties() {\n    return this.#fontData.fontExtraProperties ?? false;\n  }\n\n  get isInvalidPDFjsFont() {\n    return this.#fontData.isInvalidPDFjsFont;\n  }\n\n  get isType3Font() {\n    return this.#fontData.isType3Font;\n  }\n\n  get italic() {\n    return this.#fontData.italic;\n  }\n\n  get missingFile() {\n    return this.#fontData.missingFile;\n  }\n\n  get remeasure() {\n    return this.#fontData.remeasure;\n  }\n\n  get vertical() {\n    return this.#fontData.vertical;\n  }\n\n  get ascent() {\n    return this.#fontData.ascent;\n  }\n\n  get defaultWidth() {\n    return this.#fontData.defaultWidth;\n  }\n\n  get descent() {\n    return this.#fontData.descent;\n  }\n\n  get bbox() {\n    return this.#fontData.bbox;\n  }\n\n  set bbox(bbox) {\n    shadow(this, \"bbox\", bbox);\n  }\n\n  get fontMatrix() {\n    return this.#fontData.fontMatrix;\n  }\n\n  get fallbackName() {\n    return this.#fontData.fallbackName;\n  }\n\n  get loadedName() {\n    return this.#fontData.loadedName;\n  }\n\n  get mimetype() {\n    return this.#fontData.mimetype;\n  }\n\n  get name() {\n    return this.#fontData.name;\n  }\n\n  get data() {\n    return this.#fontData.data;\n  }\n\n  clearData() {\n    this.#fontData.clearData();\n  }\n\n  get cssFontInfo() {\n    return this.#fontData.cssFontInfo;\n  }\n\n  get systemFontInfo() {\n    return this.#fontData.systemFontInfo;\n  }\n\n  get defaultVMetrics() {\n    return this.#fontData.defaultVMetrics;\n  }\n}\n\nexport { FontFaceObject, FontLoader };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, MeshFigureType } from \"./util.js\";\n\nclass CssFontInfo {\n  #buffer;\n\n  #view;\n\n  #decoder;\n\n  static strings = [\"fontFamily\", \"fontWeight\", \"italicAngle\"];\n\n  static write(info) {\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of CssFontInfo.strings) {\n      const encoded = encoder.encode(info[prop]);\n      encodedStrings[prop] = encoded;\n      stringsLength += 4 + encoded.length;\n    }\n\n    const buffer = new ArrayBuffer(stringsLength);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    for (const prop of CssFontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    assert(offset === buffer.byteLength, \"CssFontInfo.write: Buffer overflow\");\n    return buffer;\n  }\n\n  constructor(buffer) {\n    this.#buffer = buffer;\n    this.#view = new DataView(this.#buffer);\n    this.#decoder = new TextDecoder();\n  }\n\n  #readString(index) {\n    assert(index < CssFontInfo.strings.length, \"Invalid string index\");\n    let offset = 0;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    return this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, length)\n    );\n  }\n\n  get fontFamily() {\n    return this.#readString(0);\n  }\n\n  get fontWeight() {\n    return this.#readString(1);\n  }\n\n  get italicAngle() {\n    return this.#readString(2);\n  }\n}\n\nclass SystemFontInfo {\n  #buffer;\n\n  #view;\n\n  #decoder;\n\n  static strings = [\"css\", \"loadedName\", \"baseFontName\", \"src\"];\n\n  static write(info) {\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of SystemFontInfo.strings) {\n      const encoded = encoder.encode(info[prop]);\n      encodedStrings[prop] = encoded;\n      stringsLength += 4 + encoded.length;\n    }\n    stringsLength += 4;\n    let encodedStyleStyle,\n      encodedStyleWeight,\n      lengthEstimate = 1 + stringsLength;\n    if (info.style) {\n      encodedStyleStyle = encoder.encode(info.style.style);\n      encodedStyleWeight = encoder.encode(info.style.weight);\n      lengthEstimate +=\n        4 + encodedStyleStyle.length + 4 + encodedStyleWeight.length;\n    }\n\n    const buffer = new ArrayBuffer(lengthEstimate);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    view.setUint8(offset++, info.guessFallback ? 1 : 0);\n    view.setUint32(offset, 0);\n    offset += 4;\n    stringsLength = 0;\n    for (const prop of SystemFontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      stringsLength += 4 + length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    view.setUint32(offset - stringsLength - 4, stringsLength);\n\n    if (info.style) {\n      view.setUint32(offset, encodedStyleStyle.length);\n      data.set(encodedStyleStyle, offset + 4);\n      offset += 4 + encodedStyleStyle.length;\n      view.setUint32(offset, encodedStyleWeight.length);\n      data.set(encodedStyleWeight, offset + 4);\n      offset += 4 + encodedStyleWeight.length;\n    }\n    assert(\n      offset <= buffer.byteLength,\n      \"SubstitionInfo.write: Buffer overflow\"\n    );\n    return buffer.transferToFixedLength(offset);\n  }\n\n  constructor(buffer) {\n    this.#buffer = buffer;\n    this.#view = new DataView(this.#buffer);\n    this.#decoder = new TextDecoder();\n  }\n\n  get guessFallback() {\n    return this.#view.getUint8(0) !== 0;\n  }\n\n  #readString(index) {\n    assert(index < SystemFontInfo.strings.length, \"Invalid string index\");\n    let offset = 5;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    return this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, length)\n    );\n  }\n\n  get css() {\n    return this.#readString(0);\n  }\n\n  get loadedName() {\n    return this.#readString(1);\n  }\n\n  get baseFontName() {\n    return this.#readString(2);\n  }\n\n  get src() {\n    return this.#readString(3);\n  }\n\n  get style() {\n    let offset = 1;\n    offset += 4 + this.#view.getUint32(offset);\n    const styleLength = this.#view.getUint32(offset);\n    const style = this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, styleLength)\n    );\n    offset += 4 + styleLength;\n    const weightLength = this.#view.getUint32(offset);\n    const weight = this.#decoder.decode(\n      new Uint8Array(this.#buffer, offset + 4, weightLength)\n    );\n    return { style, weight };\n  }\n}\n\nclass FontInfo {\n  static bools = [\n    \"black\",\n    \"bold\",\n    \"disableFontFace\",\n    \"fontExtraProperties\",\n    \"isInvalidPDFjsFont\",\n    \"isType3Font\",\n    \"italic\",\n    \"missingFile\",\n    \"remeasure\",\n    \"vertical\",\n  ];\n\n  static numbers = [\"ascent\", \"defaultWidth\", \"descent\"];\n\n  static strings = [\"fallbackName\", \"loadedName\", \"mimetype\", \"name\"];\n\n  static #OFFSET_NUMBERS = Math.ceil((this.bools.length * 2) / 8);\n\n  static #OFFSET_BBOX = this.#OFFSET_NUMBERS + this.numbers.length * 8;\n\n  static #OFFSET_FONT_MATRIX = this.#OFFSET_BBOX + 1 + 2 * 4;\n\n  static #OFFSET_DEFAULT_VMETRICS = this.#OFFSET_FONT_MATRIX + 1 + 8 * 6;\n\n  static #OFFSET_STRINGS = this.#OFFSET_DEFAULT_VMETRICS + 1 + 2 * 3;\n\n  #buffer;\n\n  #decoder;\n\n  #view;\n\n  constructor({ data, extra }) {\n    this.#buffer = data;\n    this.#decoder = new TextDecoder();\n    this.#view = new DataView(this.#buffer);\n    if (extra) {\n      Object.assign(this, extra);\n    }\n  }\n\n  #readBoolean(index) {\n    assert(index < FontInfo.bools.length, \"Invalid boolean index\");\n    const byteOffset = Math.floor(index / 4);\n    const bitOffset = (index * 2) % 8;\n    const value = (this.#view.getUint8(byteOffset) >> bitOffset) & 0x03;\n    return value === 0x00 ? undefined : value === 0x02;\n  }\n\n  get black() {\n    return this.#readBoolean(0);\n  }\n\n  get bold() {\n    return this.#readBoolean(1);\n  }\n\n  get disableFontFace() {\n    return this.#readBoolean(2);\n  }\n\n  get fontExtraProperties() {\n    return this.#readBoolean(3);\n  }\n\n  get isInvalidPDFjsFont() {\n    return this.#readBoolean(4);\n  }\n\n  get isType3Font() {\n    return this.#readBoolean(5);\n  }\n\n  get italic() {\n    return this.#readBoolean(6);\n  }\n\n  get missingFile() {\n    return this.#readBoolean(7);\n  }\n\n  get remeasure() {\n    return this.#readBoolean(8);\n  }\n\n  get vertical() {\n    return this.#readBoolean(9);\n  }\n\n  #readNumber(index) {\n    assert(index < FontInfo.numbers.length, \"Invalid number index\");\n    return this.#view.getFloat64(FontInfo.#OFFSET_NUMBERS + index * 8);\n  }\n\n  get ascent() {\n    return this.#readNumber(0);\n  }\n\n  get defaultWidth() {\n    return this.#readNumber(1);\n  }\n\n  get descent() {\n    return this.#readNumber(2);\n  }\n\n  get bbox() {\n    let offset = FontInfo.#OFFSET_BBOX;\n    const numCoords = this.#view.getUint8(offset);\n    if (numCoords === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const bbox = [];\n    for (let i = 0; i < 4; i++) {\n      bbox.push(this.#view.getInt16(offset, true));\n      offset += 2;\n    }\n    return bbox;\n  }\n\n  get fontMatrix() {\n    let offset = FontInfo.#OFFSET_FONT_MATRIX;\n    const numPoints = this.#view.getUint8(offset);\n    if (numPoints === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const fontMatrix = [];\n    for (let i = 0; i < 6; i++) {\n      fontMatrix.push(this.#view.getFloat64(offset, true));\n      offset += 8;\n    }\n    return fontMatrix;\n  }\n\n  get defaultVMetrics() {\n    let offset = FontInfo.#OFFSET_DEFAULT_VMETRICS;\n    const numMetrics = this.#view.getUint8(offset);\n    if (numMetrics === 0) {\n      return undefined;\n    }\n    offset += 1;\n    const defaultVMetrics = [];\n    for (let i = 0; i < 3; i++) {\n      defaultVMetrics.push(this.#view.getInt16(offset, true));\n      offset += 2;\n    }\n    return defaultVMetrics;\n  }\n\n  #readString(index) {\n    assert(index < FontInfo.strings.length, \"Invalid string index\");\n    let offset = FontInfo.#OFFSET_STRINGS + 4;\n    for (let i = 0; i < index; i++) {\n      offset += this.#view.getUint32(offset) + 4;\n    }\n    const length = this.#view.getUint32(offset);\n    const stringData = new Uint8Array(length);\n    stringData.set(new Uint8Array(this.#buffer, offset + 4, length));\n    return this.#decoder.decode(stringData);\n  }\n\n  get fallbackName() {\n    return this.#readString(0);\n  }\n\n  get loadedName() {\n    return this.#readString(1);\n  }\n\n  get mimetype() {\n    return this.#readString(2);\n  }\n\n  get name() {\n    return this.#readString(3);\n  }\n\n  get data() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + cssFontInfoLength;\n    const length = this.#view.getUint32(offset);\n    if (length === 0) {\n      return undefined;\n    }\n    return new Uint8Array(this.#buffer, offset + 4, length);\n  }\n\n  clearData() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + cssFontInfoLength;\n    const length = this.#view.getUint32(offset);\n    const data = new Uint8Array(this.#buffer, offset + 4, length);\n    data.fill(0);\n    this.#view.setUint32(offset, 0);\n    // this.#buffer.resize(offset);\n  }\n\n  get cssFontInfo() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    offset += 4 + systemFontInfoLength;\n    const cssFontInfoLength = this.#view.getUint32(offset);\n    if (cssFontInfoLength === 0) {\n      return null;\n    }\n    const cssFontInfoData = new Uint8Array(cssFontInfoLength);\n    cssFontInfoData.set(\n      new Uint8Array(this.#buffer, offset + 4, cssFontInfoLength)\n    );\n    return new CssFontInfo(cssFontInfoData.buffer);\n  }\n\n  get systemFontInfo() {\n    let offset = FontInfo.#OFFSET_STRINGS;\n    const stringsLength = this.#view.getUint32(offset);\n    offset += 4 + stringsLength;\n    const systemFontInfoLength = this.#view.getUint32(offset);\n    if (systemFontInfoLength === 0) {\n      return null;\n    }\n    const systemFontInfoData = new Uint8Array(systemFontInfoLength);\n    systemFontInfoData.set(\n      new Uint8Array(this.#buffer, offset + 4, systemFontInfoLength)\n    );\n    return new SystemFontInfo(systemFontInfoData.buffer);\n  }\n\n  static write(font) {\n    const systemFontInfoBuffer = font.systemFontInfo\n      ? SystemFontInfo.write(font.systemFontInfo)\n      : null;\n    const cssFontInfoBuffer = font.cssFontInfo\n      ? CssFontInfo.write(font.cssFontInfo)\n      : null;\n\n    const encoder = new TextEncoder();\n    const encodedStrings = {};\n    let stringsLength = 0;\n    for (const prop of FontInfo.strings) {\n      encodedStrings[prop] = encoder.encode(font[prop]);\n      stringsLength += 4 + encodedStrings[prop].length;\n    }\n\n    const lengthEstimate =\n      FontInfo.#OFFSET_STRINGS +\n      4 +\n      stringsLength +\n      4 +\n      (systemFontInfoBuffer ? systemFontInfoBuffer.byteLength : 0) +\n      4 +\n      (cssFontInfoBuffer ? cssFontInfoBuffer.byteLength : 0) +\n      4 +\n      (font.data ? font.data.length : 0);\n\n    const buffer = new ArrayBuffer(lengthEstimate);\n    const data = new Uint8Array(buffer);\n    const view = new DataView(buffer);\n    let offset = 0;\n\n    const numBools = FontInfo.bools.length;\n    let boolByte = 0,\n      boolBit = 0;\n    for (let i = 0; i < numBools; i++) {\n      const value = font[FontInfo.bools[i]];\n      // eslint-disable-next-line no-nested-ternary\n      const bits = value === undefined ? 0x00 : value ? 0x02 : 0x01;\n      boolByte |= bits << boolBit;\n      boolBit += 2;\n      if (boolBit === 8 || i === numBools - 1) {\n        view.setUint8(offset++, boolByte);\n        boolByte = 0;\n        boolBit = 0;\n      }\n    }\n    assert(\n      offset === FontInfo.#OFFSET_NUMBERS,\n      \"FontInfo.write: Boolean properties offset mismatch\"\n    );\n\n    for (const prop of FontInfo.numbers) {\n      view.setFloat64(offset, font[prop]);\n      offset += 8;\n    }\n    assert(\n      offset === FontInfo.#OFFSET_BBOX,\n      \"FontInfo.write: Number properties offset mismatch\"\n    );\n\n    if (font.bbox) {\n      view.setUint8(offset++, 4);\n      for (const coord of font.bbox) {\n        view.setInt16(offset, coord, true);\n        offset += 2;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 2 * 4; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_FONT_MATRIX,\n      \"FontInfo.write: BBox properties offset mismatch\"\n    );\n\n    if (font.fontMatrix) {\n      view.setUint8(offset++, 6);\n      for (const point of font.fontMatrix) {\n        view.setFloat64(offset, point, true);\n        offset += 8;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 8 * 6; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_DEFAULT_VMETRICS,\n      \"FontInfo.write: FontMatrix properties offset mismatch\"\n    );\n\n    if (font.defaultVMetrics) {\n      view.setUint8(offset++, 1);\n      for (const metric of font.defaultVMetrics) {\n        view.setInt16(offset, metric, true);\n        offset += 2;\n      }\n    } else {\n      view.setUint8(offset++, 0);\n      offset += 3 * 2; // TODO: optimize this padding away\n    }\n\n    assert(\n      offset === FontInfo.#OFFSET_STRINGS,\n      \"FontInfo.write: DefaultVMetrics properties offset mismatch\"\n    );\n\n    view.setUint32(FontInfo.#OFFSET_STRINGS, 0);\n    offset += 4;\n    for (const prop of FontInfo.strings) {\n      const encoded = encodedStrings[prop];\n      const length = encoded.length;\n      view.setUint32(offset, length);\n      data.set(encoded, offset + 4);\n      offset += 4 + length;\n    }\n    view.setUint32(\n      FontInfo.#OFFSET_STRINGS,\n      offset - FontInfo.#OFFSET_STRINGS - 4\n    );\n\n    if (!systemFontInfoBuffer) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      const length = systemFontInfoBuffer.byteLength;\n      view.setUint32(offset, length);\n      assert(\n        offset + 4 + length <= buffer.byteLength,\n        \"FontInfo.write: Buffer overflow at systemFontInfo\"\n      );\n      data.set(new Uint8Array(systemFontInfoBuffer), offset + 4);\n      offset += 4 + length;\n    }\n\n    if (!cssFontInfoBuffer) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      const length = cssFontInfoBuffer.byteLength;\n      view.setUint32(offset, length);\n      assert(\n        offset + 4 + length <= buffer.byteLength,\n        \"FontInfo.write: Buffer overflow at cssFontInfo\"\n      );\n      data.set(new Uint8Array(cssFontInfoBuffer), offset + 4);\n      offset += 4 + length;\n    }\n\n    if (font.data === undefined) {\n      view.setUint32(offset, 0);\n      offset += 4;\n    } else {\n      view.setUint32(offset, font.data.length);\n      data.set(font.data, offset + 4);\n      offset += 4 + font.data.length;\n    }\n\n    assert(offset <= buffer.byteLength, \"FontInfo.write: Buffer overflow\");\n    return buffer.transferToFixedLength(offset);\n  }\n}\n\nclass PatternInfo {\n  static #KIND = 0; // 1=axial, 2=radial, 3=mesh\n\n  static #HAS_BBOX = 1; // 0/1\n\n  static #HAS_BACKGROUND = 2; // 0/1 (background for mesh patterns)\n\n  static #SHADING_TYPE = 3; // shadingType (only for mesh patterns)\n\n  static #N_COORD = 4; // number of coordinate pairs\n\n  static #N_COLOR = 8; // number of rgb triplets\n\n  static #N_STOP = 12; // number of gradient stops\n\n  static #N_FIGURES = 16; // number of figures\n\n  constructor(buffer) {\n    this.buffer = buffer;\n    this.view = new DataView(buffer);\n    this.data = new Uint8Array(buffer);\n  }\n\n  static write(ir) {\n    let kind,\n      bbox = null,\n      coords = [],\n      colors = [],\n      colorStops = [],\n      figures = [],\n      shadingType = null, // only needed for mesh patterns\n      background = null; // background for mesh patterns\n\n    switch (ir[0]) {\n      case \"RadialAxial\":\n        kind = ir[1] === \"axial\" ? 1 : 2;\n        bbox = ir[2];\n        colorStops = ir[3];\n        if (kind === 1) {\n          coords.push(...ir[4], ...ir[5]);\n        } else {\n          coords.push(ir[4][0], ir[4][1], ir[6], ir[5][0], ir[5][1], ir[7]);\n        }\n        break;\n      case \"Mesh\":\n        kind = 3;\n        shadingType = ir[1];\n        coords = ir[2];\n        colors = ir[3];\n        figures = ir[4] || [];\n        bbox = ir[6];\n        background = ir[7];\n        break;\n      default:\n        throw new Error(`Unsupported pattern type: ${ir[0]}`);\n    }\n\n    const nCoord = Math.floor(coords.length / 2);\n    const nColor = Math.floor(colors.length / 3);\n    const nStop = colorStops.length;\n    const nFigures = figures.length;\n\n    let figuresSize = 0;\n    for (const figure of figures) {\n      figuresSize += 1;\n      figuresSize = Math.ceil(figuresSize / 4) * 4; // Ensure 4-byte alignment\n      figuresSize += 4 + figure.coords.length * 4;\n      figuresSize += 4 + figure.colors.length * 4;\n      if (figure.verticesPerRow !== undefined) {\n        figuresSize += 4;\n      }\n    }\n\n    const byteLen =\n      20 +\n      nCoord * 8 +\n      nColor * 3 +\n      nStop * 8 +\n      (bbox ? 16 : 0) +\n      (background ? 3 : 0) +\n      figuresSize;\n    const buffer = new ArrayBuffer(byteLen);\n    const dataView = new DataView(buffer);\n    const u8data = new Uint8Array(buffer);\n\n    dataView.setUint8(PatternInfo.#KIND, kind);\n    dataView.setUint8(PatternInfo.#HAS_BBOX, bbox ? 1 : 0);\n    dataView.setUint8(PatternInfo.#HAS_BACKGROUND, background ? 1 : 0);\n    dataView.setUint8(PatternInfo.#SHADING_TYPE, shadingType); // Only for mesh pattern, null otherwise\n    dataView.setUint32(PatternInfo.#N_COORD, nCoord, true);\n    dataView.setUint32(PatternInfo.#N_COLOR, nColor, true);\n    dataView.setUint32(PatternInfo.#N_STOP, nStop, true);\n    dataView.setUint32(PatternInfo.#N_FIGURES, nFigures, true);\n\n    let offset = 20;\n    const coordsView = new Float32Array(buffer, offset, nCoord * 2);\n    coordsView.set(coords);\n    offset += nCoord * 8;\n\n    u8data.set(colors, offset);\n    offset += nColor * 3;\n\n    for (const [pos, hex] of colorStops) {\n      dataView.setFloat32(offset, pos, true);\n      offset += 4;\n      dataView.setUint32(offset, parseInt(hex.slice(1), 16), true);\n      offset += 4;\n    }\n    if (bbox) {\n      for (const v of bbox) {\n        dataView.setFloat32(offset, v, true);\n        offset += 4;\n      }\n    }\n\n    if (background) {\n      u8data.set(background, offset);\n      offset += 3;\n    }\n\n    for (let i = 0; i < figures.length; i++) {\n      const figure = figures[i];\n      dataView.setUint8(offset, figure.type);\n      offset += 1;\n      // Ensure 4-byte alignment\n      offset = Math.ceil(offset / 4) * 4;\n      dataView.setUint32(offset, figure.coords.length, true);\n      offset += 4;\n      const figureCoordsView = new Int32Array(\n        buffer,\n        offset,\n        figure.coords.length\n      );\n      figureCoordsView.set(figure.coords);\n      offset += figure.coords.length * 4;\n      dataView.setUint32(offset, figure.colors.length, true);\n      offset += 4;\n      const colorsView = new Int32Array(buffer, offset, figure.colors.length);\n      colorsView.set(figure.colors);\n      offset += figure.colors.length * 4;\n\n      if (figure.verticesPerRow !== undefined) {\n        dataView.setUint32(offset, figure.verticesPerRow, true);\n        offset += 4;\n      }\n    }\n    return buffer;\n  }\n\n  getIR() {\n    const dataView = this.view;\n    const kind = this.data[PatternInfo.#KIND];\n    const hasBBox = !!this.data[PatternInfo.#HAS_BBOX];\n    const hasBackground = !!this.data[PatternInfo.#HAS_BACKGROUND];\n    const nCoord = dataView.getUint32(PatternInfo.#N_COORD, true);\n    const nColor = dataView.getUint32(PatternInfo.#N_COLOR, true);\n    const nStop = dataView.getUint32(PatternInfo.#N_STOP, true);\n    const nFigures = dataView.getUint32(PatternInfo.#N_FIGURES, true);\n\n    let offset = 20;\n    const coords = new Float32Array(this.buffer, offset, nCoord * 2);\n    offset += nCoord * 8;\n    const colors = new Uint8Array(this.buffer, offset, nColor * 3);\n    offset += nColor * 3;\n    const stops = [];\n    for (let i = 0; i < nStop; ++i) {\n      const p = dataView.getFloat32(offset, true);\n      offset += 4;\n      const rgb = dataView.getUint32(offset, true);\n      offset += 4;\n      stops.push([p, `#${rgb.toString(16).padStart(6, \"0\")}`]);\n    }\n    let bbox = null;\n    if (hasBBox) {\n      bbox = [];\n      for (let i = 0; i < 4; ++i) {\n        bbox.push(dataView.getFloat32(offset, true));\n        offset += 4;\n      }\n    }\n\n    let background = null;\n    if (hasBackground) {\n      background = new Uint8Array(this.buffer, offset, 3);\n      offset += 3;\n    }\n\n    const figures = [];\n    for (let i = 0; i < nFigures; ++i) {\n      const type = dataView.getUint8(offset);\n      offset += 1;\n      // Ensure 4-byte alignment\n      offset = Math.ceil(offset / 4) * 4;\n\n      const coordsLength = dataView.getUint32(offset, true);\n      offset += 4;\n      const figureCoords = new Int32Array(this.buffer, offset, coordsLength);\n      offset += coordsLength * 4;\n\n      const colorsLength = dataView.getUint32(offset, true);\n      offset += 4;\n      const figureColors = new Int32Array(this.buffer, offset, colorsLength);\n      offset += colorsLength * 4;\n\n      const figure = {\n        type,\n        coords: figureCoords,\n        colors: figureColors,\n      };\n\n      if (type === MeshFigureType.LATTICE) {\n        figure.verticesPerRow = dataView.getUint32(offset, true);\n        offset += 4;\n      }\n\n      figures.push(figure);\n    }\n\n    if (kind === 1) {\n      // axial\n      return [\n        \"RadialAxial\",\n        \"axial\",\n        bbox,\n        stops,\n        Array.from(coords.slice(0, 2)),\n        Array.from(coords.slice(2, 4)),\n        null,\n        null,\n      ];\n    }\n    if (kind === 2) {\n      return [\n        \"RadialAxial\",\n        \"radial\",\n        bbox,\n        stops,\n        [coords[0], coords[1]],\n        [coords[3], coords[4]],\n        coords[2],\n        coords[5],\n      ];\n    }\n    if (kind === 3) {\n      const shadingType = this.data[PatternInfo.#SHADING_TYPE];\n      let bounds = null;\n      if (coords.length > 0) {\n        let minX = coords[0],\n          maxX = coords[0];\n        let minY = coords[1],\n          maxY = coords[1];\n        for (let i = 0; i < coords.length; i += 2) {\n          const x = coords[i],\n            y = coords[i + 1];\n          minX = minX > x ? x : minX;\n          minY = minY > y ? y : minY;\n          maxX = maxX < x ? x : maxX;\n          maxY = maxY < y ? y : maxY;\n        }\n        bounds = [minX, minY, maxX, maxY];\n      }\n      return [\n        \"Mesh\",\n        shadingType,\n        coords,\n        colors,\n        figures,\n        bounds,\n        bbox,\n        background,\n      ];\n    }\n    throw new Error(`Unsupported pattern kind: ${kind}`);\n  }\n}\nexport { CssFontInfo, FontInfo, PatternInfo, SystemFontInfo };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  _isValidExplicitDest,\n  isNodeJS,\n  stringToBytes,\n  warn,\n} from \"../shared/util.js\";\n\nfunction getUrlProp(val) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    return null; // The 'url' is unused with `PDFDataRangeTransport`.\n  }\n  if (val instanceof URL) {\n    return val.href;\n  }\n  if (typeof val === \"string\") {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS\n    ) {\n      return val; // Use the url as-is in Node.js environments.\n    }\n\n    // The full path is required in the 'url' field.\n    const url = URL.parse(val, window.location);\n    if (url) {\n      return url.href;\n    }\n  }\n  throw new Error(\n    \"Invalid PDF url data: \" +\n      \"either string or URL-object is expected in the url property.\"\n  );\n}\n\nfunction getDataProp(val) {\n  // Converting string or array-like data to Uint8Array.\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"GENERIC\") &&\n    isNodeJS &&\n    typeof Buffer !== \"undefined\" && // eslint-disable-line no-undef\n    val instanceof Buffer // eslint-disable-line no-undef\n  ) {\n    throw new Error(\n      \"Please provide binary data as `Uint8Array`, rather than `Buffer`.\"\n    );\n  }\n  if (val instanceof Uint8Array && val.byteLength === val.buffer.byteLength) {\n    // Use the data as-is when it's already a Uint8Array that completely\n    // \"utilizes\" its underlying ArrayBuffer, to prevent any possible\n    // issues when transferring it to the worker-thread.\n    return val;\n  }\n  if (typeof val === \"string\") {\n    return stringToBytes(val);\n  }\n  if (\n    val instanceof ArrayBuffer ||\n    ArrayBuffer.isView(val) ||\n    (typeof val === \"object\" && !isNaN(val?.length))\n  ) {\n    return new Uint8Array(val);\n  }\n  throw new Error(\n    \"Invalid PDF binary data: either TypedArray, \" +\n      \"string, or array-like object is expected in the data property.\"\n  );\n}\n\nfunction getFactoryUrlProp(val) {\n  if (typeof val !== \"string\") {\n    return null;\n  }\n  if (val.endsWith(\"/\")) {\n    return val;\n  }\n  throw new Error(`Invalid factory url: \"${val}\" must include trailing slash.`);\n}\n\nconst isRefProxy = v =>\n  typeof v === \"object\" &&\n  Number.isInteger(v?.num) &&\n  v.num >= 0 &&\n  Number.isInteger(v?.gen) &&\n  v.gen >= 0;\n\nconst isNameProxy = v => typeof v === \"object\" && typeof v?.name === \"string\";\n\nconst isValidExplicitDest = _isValidExplicitDest.bind(\n  null,\n  /* validRef = */ isRefProxy,\n  /* validName = */ isNameProxy\n);\n\nclass LoopbackPort {\n  #listeners = new Map();\n\n  #deferred = Promise.resolve();\n\n  postMessage(obj, transfer) {\n    const event = {\n      data: structuredClone(obj, transfer ? { transfer } : null),\n    };\n\n    this.#deferred.then(() => {\n      for (const [listener] of this.#listeners) {\n        listener.call(this, event);\n      }\n    });\n  }\n\n  addEventListener(name, listener, options = null) {\n    let rmAbort = null;\n    if (options?.signal instanceof AbortSignal) {\n      const { signal } = options;\n      if (signal.aborted) {\n        warn(\"LoopbackPort - cannot use an `aborted` signal.\");\n        return;\n      }\n      const onAbort = () => this.removeEventListener(name, listener);\n      rmAbort = () => signal.removeEventListener(\"abort\", onAbort);\n\n      signal.addEventListener(\"abort\", onAbort);\n    }\n    this.#listeners.set(listener, rmAbort);\n  }\n\n  removeEventListener(name, listener) {\n    const rmAbort = this.#listeners.get(listener);\n    rmAbort?.();\n\n    this.#listeners.delete(listener);\n  }\n\n  terminate() {\n    for (const [, rmAbort] of this.#listeners) {\n      rmAbort?.();\n    }\n    this.#listeners.clear();\n  }\n}\n\nexport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isNameProxy,\n  isRefProxy,\n  isValidExplicitDest,\n  LoopbackPort,\n};\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  InvalidPDFException,\n  PasswordException,\n  ResponseException,\n  UnknownErrorException,\n  unreachable,\n} from \"./util.js\";\n\nconst CallbackKind = {\n  DATA: 1,\n  ERROR: 2,\n};\n\nconst StreamKind = {\n  CANCEL: 1,\n  CANCEL_COMPLETE: 2,\n  CLOSE: 3,\n  ENQUEUE: 4,\n  ERROR: 5,\n  PULL: 6,\n  PULL_COMPLETE: 7,\n  START_COMPLETE: 8,\n};\n\nfunction onFn() {}\n\nfunction wrapReason(ex) {\n  if (\n    ex instanceof AbortException ||\n    ex instanceof InvalidPDFException ||\n    ex instanceof PasswordException ||\n    ex instanceof ResponseException ||\n    ex instanceof UnknownErrorException\n  ) {\n    // Avoid re-creating the exception when its type is already correct.\n    return ex;\n  }\n\n  if (!(ex instanceof Error || (typeof ex === \"object\" && ex !== null))) {\n    unreachable(\n      'wrapReason: Expected \"reason\" to be a (possibly cloned) Error.'\n    );\n  }\n  switch (ex.name) {\n    case \"AbortException\":\n      return new AbortException(ex.message);\n    case \"InvalidPDFException\":\n      return new InvalidPDFException(ex.message);\n    case \"PasswordException\":\n      return new PasswordException(ex.message, ex.code);\n    case \"ResponseException\":\n      return new ResponseException(ex.message, ex.status, ex.missing);\n    case \"UnknownErrorException\":\n      return new UnknownErrorException(ex.message, ex.details);\n  }\n  return new UnknownErrorException(ex.message, ex.toString());\n}\n\nclass MessageHandler {\n  #messageAC = new AbortController();\n\n  constructor(sourceName, targetName, comObj) {\n    this.sourceName = sourceName;\n    this.targetName = targetName;\n    this.comObj = comObj;\n    this.callbackId = 1;\n    this.streamId = 1;\n    this.streamSinks = Object.create(null);\n    this.streamControllers = Object.create(null);\n    this.callbackCapabilities = Object.create(null);\n    this.actionHandler = Object.create(null);\n\n    comObj.addEventListener(\"message\", this.#onMessage.bind(this), {\n      signal: this.#messageAC.signal,\n    });\n  }\n\n  #onMessage({ data }) {\n    if (data.targetName !== this.sourceName) {\n      return;\n    }\n    if (data.stream) {\n      this.#processStreamMessage(data);\n      return;\n    }\n    if (data.callback) {\n      const callbackId = data.callbackId;\n      const capability = this.callbackCapabilities[callbackId];\n      if (!capability) {\n        throw new Error(`Cannot resolve callback ${callbackId}`);\n      }\n      delete this.callbackCapabilities[callbackId];\n\n      if (data.callback === CallbackKind.DATA) {\n        capability.resolve(data.data);\n      } else if (data.callback === CallbackKind.ERROR) {\n        capability.reject(wrapReason(data.reason));\n      } else {\n        throw new Error(\"Unexpected callback case\");\n      }\n      return;\n    }\n    const action = this.actionHandler[data.action];\n    if (!action) {\n      throw new Error(`Unknown action from worker: ${data.action}`);\n    }\n    if (data.callbackId) {\n      const sourceName = this.sourceName,\n        targetName = data.sourceName,\n        comObj = this.comObj;\n\n      Promise.try(action, data.data).then(\n        function (result) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.DATA,\n            callbackId: data.callbackId,\n            data: result,\n          });\n        },\n        function (reason) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.ERROR,\n            callbackId: data.callbackId,\n            reason: wrapReason(reason),\n          });\n        }\n      );\n      return;\n    }\n    if (data.streamId) {\n      this.#createStreamSink(data);\n      return;\n    }\n    action(data.data);\n  }\n\n  on(actionName, handler) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        typeof handler === \"function\",\n        'MessageHandler.on: Expected \"handler\" to be a function.'\n      );\n    }\n    const ah = this.actionHandler;\n    if (ah[actionName]) {\n      throw new Error(`There is already an actionName called \"${actionName}\"`);\n    }\n    ah[actionName] = handler;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   */\n  send(actionName, data, transfers) {\n    this.comObj.postMessage(\n      {\n        sourceName: this.sourceName,\n        targetName: this.targetName,\n        action: actionName,\n        data,\n      },\n      transfers\n    );\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expects that the other side will callback with the response.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {Promise} Promise to be resolved with response data.\n   */\n  sendWithPromise(actionName, data, transfers) {\n    const callbackId = this.callbackId++;\n    const capability = Promise.withResolvers();\n    this.callbackCapabilities[callbackId] = capability;\n    try {\n      this.comObj.postMessage(\n        {\n          sourceName: this.sourceName,\n          targetName: this.targetName,\n          action: actionName,\n          callbackId,\n          data,\n        },\n        transfers\n      );\n    } catch (ex) {\n      capability.reject(ex);\n    }\n    return capability.promise;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expect that the other side will callback to signal 'start_complete'.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Object} queueingStrategy - Strategy to signal backpressure based on\n   *                 internal queue.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {ReadableStream} ReadableStream to read data in chunks.\n   */\n  sendWithStream(actionName, data, queueingStrategy, transfers) {\n    const streamId = this.streamId++,\n      sourceName = this.sourceName,\n      targetName = this.targetName,\n      comObj = this.comObj;\n\n    return new ReadableStream(\n      {\n        start: controller => {\n          const startCapability = Promise.withResolvers();\n          this.streamControllers[streamId] = {\n            controller,\n            startCall: startCapability,\n            pullCall: null,\n            cancelCall: null,\n            isClosed: false,\n          };\n          comObj.postMessage(\n            {\n              sourceName,\n              targetName,\n              action: actionName,\n              streamId,\n              data,\n              desiredSize: controller.desiredSize,\n            },\n            transfers\n          );\n          // Return Promise for Async process, to signal success/failure.\n          return startCapability.promise;\n        },\n\n        pull: controller => {\n          const pullCapability = Promise.withResolvers();\n          this.streamControllers[streamId].pullCall = pullCapability;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL,\n            streamId,\n            desiredSize: controller.desiredSize,\n          });\n          // Returning Promise will not call \"pull\"\n          // again until current pull is resolved.\n          return pullCapability.promise;\n        },\n\n        cancel: reason => {\n          assert(reason instanceof Error, \"cancel must have a valid reason\");\n          const cancelCapability = Promise.withResolvers();\n          this.streamControllers[streamId].cancelCall = cancelCapability;\n          this.streamControllers[streamId].isClosed = true;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.CANCEL,\n            streamId,\n            reason: wrapReason(reason),\n          });\n          // Return Promise to signal success or failure.\n          return cancelCapability.promise;\n        },\n      },\n      queueingStrategy\n    );\n  }\n\n  #createStreamSink(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const self = this,\n      action = this.actionHandler[data.action];\n\n    const streamSink = {\n      enqueue(chunk, size = 1, transfers) {\n        if (this.isCancelled) {\n          return;\n        }\n        const lastDesiredSize = this.desiredSize;\n        this.desiredSize -= size;\n        // Enqueue decreases the desiredSize property of sink,\n        // so when it changes from positive to negative,\n        // set ready as unresolved promise.\n        if (lastDesiredSize > 0 && this.desiredSize <= 0) {\n          this.sinkCapability = Promise.withResolvers();\n          this.ready = this.sinkCapability.promise;\n        }\n        comObj.postMessage(\n          {\n            sourceName,\n            targetName,\n            stream: StreamKind.ENQUEUE,\n            streamId,\n            chunk,\n          },\n          transfers\n        );\n      },\n\n      close() {\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.CLOSE,\n          streamId,\n        });\n        delete self.streamSinks[streamId];\n      },\n\n      error(reason) {\n        assert(reason instanceof Error, \"error must have a valid reason\");\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.ERROR,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      },\n\n      sinkCapability: Promise.withResolvers(),\n      onPull: null,\n      onCancel: null,\n      isCancelled: false,\n      desiredSize: data.desiredSize,\n      ready: null,\n    };\n\n    streamSink.sinkCapability.resolve();\n    streamSink.ready = streamSink.sinkCapability.promise;\n    this.streamSinks[streamId] = streamSink;\n\n    Promise.try(action, data.data, streamSink).then(\n      function () {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          success: true,\n        });\n      },\n      function (reason) {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      }\n    );\n  }\n\n  #processStreamMessage(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const streamController = this.streamControllers[streamId],\n      streamSink = this.streamSinks[streamId];\n\n    switch (data.stream) {\n      case StreamKind.START_COMPLETE:\n        if (data.success) {\n          streamController.startCall.resolve();\n        } else {\n          streamController.startCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL_COMPLETE:\n        if (data.success) {\n          streamController.pullCall.resolve();\n        } else {\n          streamController.pullCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL:\n        // Ignore any pull after close is called.\n        if (!streamSink) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL_COMPLETE,\n            streamId,\n            success: true,\n          });\n          break;\n        }\n        // Pull increases the desiredSize property of sink, so when it changes\n        // from negative to positive, set ready property as resolved promise.\n        if (streamSink.desiredSize <= 0 && data.desiredSize > 0) {\n          streamSink.sinkCapability.resolve();\n        }\n        // Reset desiredSize property of sink on every pull.\n        streamSink.desiredSize = data.desiredSize;\n\n        Promise.try(streamSink.onPull || onFn).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        break;\n      case StreamKind.ENQUEUE:\n        assert(streamController, \"enqueue should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.controller.enqueue(data.chunk);\n        break;\n      case StreamKind.CLOSE:\n        assert(streamController, \"close should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.isClosed = true;\n        streamController.controller.close();\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.ERROR:\n        assert(streamController, \"error should have stream controller\");\n        streamController.controller.error(wrapReason(data.reason));\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL_COMPLETE:\n        if (data.success) {\n          streamController.cancelCall.resolve();\n        } else {\n          streamController.cancelCall.reject(wrapReason(data.reason));\n        }\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL:\n        if (!streamSink) {\n          break;\n        }\n        const dataReason = wrapReason(data.reason);\n\n        Promise.try(streamSink.onCancel || onFn, dataReason).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        streamSink.sinkCapability.reject(dataReason);\n        streamSink.isCancelled = true;\n        delete this.streamSinks[streamId];\n        break;\n      default:\n        throw new Error(\"Unexpected stream case\");\n    }\n  }\n\n  async #deleteStreamController(streamController, streamId) {\n    // Delete the `streamController` only when the start, pull, and cancel\n    // capabilities have settled, to prevent `TypeError`s.\n    await Promise.allSettled([\n      streamController.startCall?.promise,\n      streamController.pullCall?.promise,\n      streamController.cancelCall?.promise,\n    ]);\n    delete this.streamControllers[streamId];\n  }\n\n  destroy() {\n    this.#messageAC?.abort();\n    this.#messageAC = null;\n  }\n}\n\nexport { MessageHandler, wrapReason };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseCanvasFactory {\n  #enableHWA = false;\n\n  constructor({ enableHWA = false }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCanvasFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCanvasFactory.\");\n    }\n    this.#enableHWA = enableHWA;\n  }\n\n  create(width, height) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    const canvas = this._createCanvas(width, height);\n    return {\n      canvas,\n      context: canvas.getContext(\"2d\", {\n        willReadFrequently: !this.#enableHWA,\n      }),\n    };\n  }\n\n  reset(canvasAndContext, width, height) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    canvasAndContext.canvas.width = width;\n    canvasAndContext.canvas.height = height;\n  }\n\n  destroy(canvasAndContext) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    // Zeroing the width and height cause Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    canvasAndContext.canvas.width = 0;\n    canvasAndContext.canvas.height = 0;\n    canvasAndContext.canvas = null;\n    canvasAndContext.context = null;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    unreachable(\"Abstract method `_createCanvas` called.\");\n  }\n}\n\nclass DOMCanvasFactory extends BaseCanvasFactory {\n  constructor({ ownerDocument = globalThis.document, enableHWA = false }) {\n    super({ enableHWA });\n    this._document = ownerDocument;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n\nexport { BaseCanvasFactory, DOMCanvasFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes, unreachable } from \"../shared/util.js\";\nimport { fetchData } from \"./display_utils.js\";\n\nclass BaseCMapReaderFactory {\n  constructor({ baseUrl = null, isCompressed = true }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCMapReaderFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCMapReaderFactory.\");\n    }\n    this.baseUrl = baseUrl;\n    this.isCompressed = isCompressed;\n  }\n\n  async fetch({ name }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.\"\n      );\n    }\n    if (!name) {\n      throw new Error(\"CMap name must be specified.\");\n    }\n    const url = this.baseUrl + name + (this.isCompressed ? \".bcmap\" : \"\");\n\n    return this._fetch(url)\n      .then(cMapData => ({ cMapData, isCompressed: this.isCompressed }))\n      .catch(reason => {\n        throw new Error(\n          `Unable to load ${this.isCompressed ? \"binary \" : \"\"}CMap at: ${url}`\n        );\n      });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(\n      url,\n      /* type = */ this.isCompressed ? \"arraybuffer\" : \"text\"\n    );\n    return data instanceof ArrayBuffer\n      ? new Uint8Array(data)\n      : stringToBytes(data);\n  }\n}\n\nexport { BaseCMapReaderFactory, DOMCMapReaderFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getRGB, isDataScheme, SVG_NS } from \"./display_utils.js\";\nimport { unreachable, updateUrlHash, Util, warn } from \"../shared/util.js\";\n\nclass BaseFilterFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseFilterFactory\n    ) {\n      unreachable(\"Cannot initialize BaseFilterFactory.\");\n    }\n  }\n\n  addFilter(maps) {\n    return \"none\";\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    return \"none\";\n  }\n\n  addAlphaFilter(map) {\n    return \"none\";\n  }\n\n  addLuminosityFilter(map) {\n    return \"none\";\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    return \"none\";\n  }\n\n  destroy(keepHCM = false) {}\n}\n\n/**\n * FilterFactory aims to create some SVG filters we can use when drawing an\n * image (or whatever) on a canvas.\n * Filters aren't applied with ctx.putImageData because it just overwrites the\n * underlying pixels.\n * With these filters, it's possible for example to apply some transfer maps on\n * an image without the need to apply them on the pixel arrays: the renderer\n * does the magic for us.\n */\nclass DOMFilterFactory extends BaseFilterFactory {\n  #baseUrl;\n\n  #_cache;\n\n  #_defs;\n\n  #docId;\n\n  #document;\n\n  #_hcmCache;\n\n  #id = 0;\n\n  constructor({ docId, ownerDocument = globalThis.document }) {\n    super();\n    this.#docId = docId;\n    this.#document = ownerDocument;\n  }\n\n  get #cache() {\n    return (this.#_cache ||= new Map());\n  }\n\n  get #hcmCache() {\n    return (this.#_hcmCache ||= new Map());\n  }\n\n  get #defs() {\n    if (!this.#_defs) {\n      const div = this.#document.createElement(\"div\");\n      const { style } = div;\n      style.visibility = \"hidden\";\n      style.contain = \"strict\";\n      style.width = style.height = 0;\n      style.position = \"absolute\";\n      style.top = style.left = 0;\n      style.zIndex = -1;\n\n      const svg = this.#document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", 0);\n      svg.setAttribute(\"height\", 0);\n      this.#_defs = this.#document.createElementNS(SVG_NS, \"defs\");\n      div.append(svg);\n      svg.append(this.#_defs);\n      this.#document.body.append(div);\n    }\n    return this.#_defs;\n  }\n\n  #createTables(maps) {\n    if (maps.length === 1) {\n      const mapR = maps[0];\n      const buffer = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        buffer[i] = mapR[i] / 255;\n      }\n\n      const table = buffer.join(\",\");\n      return [table, table, table];\n    }\n\n    const [mapR, mapG, mapB] = maps;\n    const bufferR = new Array(256);\n    const bufferG = new Array(256);\n    const bufferB = new Array(256);\n    for (let i = 0; i < 256; i++) {\n      bufferR[i] = mapR[i] / 255;\n      bufferG[i] = mapG[i] / 255;\n      bufferB[i] = mapB[i] / 255;\n    }\n    return [bufferR.join(\",\"), bufferG.join(\",\"), bufferB.join(\",\")];\n  }\n\n  #createUrl(id) {\n    if (this.#baseUrl === undefined) {\n      // Unless a `<base>`-element is present a relative URL should work.\n      this.#baseUrl = \"\";\n\n      const url = this.#document.URL;\n      if (url !== this.#document.baseURI) {\n        if (isDataScheme(url)) {\n          warn('#createUrl: ignore \"data:\"-URL for performance reasons.');\n        } else {\n          this.#baseUrl = updateUrlHash(url, \"\");\n        }\n      }\n    }\n    return `url(${this.#baseUrl}#${id})`;\n  }\n\n  addFilter(maps) {\n    if (!maps) {\n      return \"none\";\n    }\n\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(maps);\n    if (value) {\n      return value;\n    }\n\n    const [tableR, tableG, tableB] = this.#createTables(maps);\n    const key = maps.length === 1 ? tableR : `${tableR}${tableG}${tableB}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(maps, value);\n      return value;\n    }\n\n    // We create a SVG filter: feComponentTransferElement\n    //  https://www.w3.org/TR/SVG11/filters.html#feComponentTransferElement\n\n    const id = `g_${this.#docId}_transfer_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(maps, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapConversion(tableR, tableG, tableB, filter);\n\n    return url;\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    const key = `${fgColor}-${bgColor}`;\n    const filterName = \"base\";\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const fgRGB = this.#getRGB(fgColor);\n    fgColor = Util.makeHexColor(...fgRGB);\n    const bgRGB = this.#getRGB(bgColor);\n    bgColor = Util.makeHexColor(...bgRGB);\n    this.#defs.style.color = \"\";\n\n    if (\n      (fgColor === \"#000000\" && bgColor === \"#ffffff\") ||\n      fgColor === bgColor\n    ) {\n      return info.url;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\n    //\n    // Relative luminance:\n    // https://www.w3.org/TR/WCAG20/#relativeluminancedef\n    //\n    // We compute the rounded luminance of the default background color.\n    // Then for every color in the pdf, if its rounded luminance is the\n    // same as the background one then it's replaced by the new\n    // background color else by the foreground one.\n    const map = new Array(256);\n    for (let i = 0; i <= 255; i++) {\n      const x = i / 255;\n      map[i] = x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n    }\n    const table = map.join(\",\");\n\n    const id = `g_${this.#docId}_hcm_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n    this.#addTransferMapConversion(table, table, table, filter);\n    this.#addGrayConversion(filter);\n\n    const getSteps = (c, n) => {\n      const start = fgRGB[c] / 255;\n      const end = bgRGB[c] / 255;\n      const arr = new Array(n + 1);\n      for (let i = 0; i <= n; i++) {\n        arr[i] = start + (i / n) * (end - start);\n      }\n      return arr.join(\",\");\n    };\n    this.#addTransferMapConversion(\n      getSteps(0, 5),\n      getSteps(1, 5),\n      getSteps(2, 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  addAlphaFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map);\n    if (value) {\n      return value;\n    }\n\n    const [tableA] = this.#createTables([map]);\n    const key = `alpha_${tableA}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_alpha_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapAlphaConversion(tableA, filter);\n\n    return url;\n  }\n\n  addLuminosityFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map || \"luminosity\");\n    if (value) {\n      return value;\n    }\n\n    let tableA, key;\n    if (map) {\n      [tableA] = this.#createTables([map]);\n      key = `luminosity_${tableA}`;\n    } else {\n      key = \"luminosity\";\n    }\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_luminosity_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addLuminosityConversion(filter);\n    if (map) {\n      this.#addTransferMapAlphaConversion(tableA, filter);\n    }\n\n    return url;\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    const key = `${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const [fgRGB, bgRGB] = [fgColor, bgColor].map(this.#getRGB.bind(this));\n    let fgGray = Math.round(\n      0.2126 * fgRGB[0] + 0.7152 * fgRGB[1] + 0.0722 * fgRGB[2]\n    );\n    let bgGray = Math.round(\n      0.2126 * bgRGB[0] + 0.7152 * bgRGB[1] + 0.0722 * bgRGB[2]\n    );\n    let [newFgRGB, newBgRGB] = [newFgColor, newBgColor].map(\n      this.#getRGB.bind(this)\n    );\n    if (bgGray < fgGray) {\n      [fgGray, bgGray, newFgRGB, newBgRGB] = [\n        bgGray,\n        fgGray,\n        newBgRGB,\n        newFgRGB,\n      ];\n    }\n    this.#defs.style.color = \"\";\n\n    // Now we can create the filters to highlight some canvas parts.\n    // The colors in the pdf will almost be Canvas and CanvasText, hence we\n    // want to filter them to finally get Highlight and HighlightText.\n    // Since we're in HCM the background color and the foreground color should\n    // be really different when converted to grayscale (if they're not then it\n    // means that we've a poor contrast). Once the canvas colors are converted\n    // to grayscale we can easily map them on their new colors.\n    // The grayscale step is important because if we've something like:\n    //   fgColor = #FF....\n    //   bgColor = #FF....\n    //   then we are enable to map the red component on the new red components\n    //   which can be different.\n\n    const getSteps = (fg, bg, n) => {\n      const arr = new Array(256);\n      const step = (bgGray - fgGray) / n;\n      const newStart = fg / 255;\n      const newStep = (bg - fg) / (255 * n);\n      let prev = 0;\n      for (let i = 0; i <= n; i++) {\n        const k = Math.round(fgGray + i * step);\n        const value = newStart + i * newStep;\n        for (let j = prev; j <= k; j++) {\n          arr[j] = value;\n        }\n        prev = k + 1;\n      }\n      for (let i = prev; i < 256; i++) {\n        arr[i] = arr[prev - 1];\n      }\n      return arr.join(\",\");\n    };\n\n    const id = `g_${this.#docId}_hcm_${filterName}_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n\n    this.#addGrayConversion(filter);\n    this.#addTransferMapConversion(\n      getSteps(newFgRGB[0], newBgRGB[0], 5),\n      getSteps(newFgRGB[1], newBgRGB[1], 5),\n      getSteps(newFgRGB[2], newBgRGB[2], 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  destroy(keepHCM = false) {\n    if (keepHCM && this.#_hcmCache?.size) {\n      return;\n    }\n    this.#_defs?.parentNode.parentNode.remove();\n    this.#_defs = null;\n\n    this.#_cache?.clear();\n    this.#_cache = null;\n\n    this.#_hcmCache?.clear();\n    this.#_hcmCache = null;\n\n    this.#id = 0;\n  }\n\n  #addLuminosityConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #addGrayConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #createFilter(id) {\n    const filter = this.#document.createElementNS(SVG_NS, \"filter\");\n    filter.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n    filter.setAttribute(\"id\", id);\n    this.#defs.append(filter);\n\n    return filter;\n  }\n\n  #appendFeFunc(feComponentTransfer, func, table) {\n    const feFunc = this.#document.createElementNS(SVG_NS, func);\n    feFunc.setAttribute(\"type\", \"discrete\");\n    feFunc.setAttribute(\"tableValues\", table);\n    feComponentTransfer.append(feFunc);\n  }\n\n  #addTransferMapConversion(rTable, gTable, bTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncR\", rTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncG\", gTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncB\", bTable);\n  }\n\n  #addTransferMapAlphaConversion(aTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncA\", aTable);\n  }\n\n  #getRGB(color) {\n    this.#defs.style.color = color;\n    return getRGB(getComputedStyle(this.#defs).getPropertyValue(\"color\"));\n  }\n}\n\nexport { BaseFilterFactory, DOMFilterFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseStandardFontDataFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseStandardFontDataFactory\n    ) {\n      unreachable(\"Cannot initialize BaseStandardFontDataFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `standardFontDataUrl` API parameter is provided.\"\n      );\n    }\n    if (!filename) {\n      throw new Error(\"Font filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load font data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseStandardFontDataFactory, DOMStandardFontDataFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseWasmFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseWasmFactory\n    ) {\n      unreachable(\"Cannot initialize BaseWasmFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\"Ensure that the `wasmUrl` API parameter is provided.\");\n    }\n    if (!filename) {\n      throw new Error(\"Wasm filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load wasm data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseWasmFactory, DOMWasmFactory };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { isNodeJS, warn } from \"../shared/util.js\";\nimport { BaseCanvasFactory } from \"./canvas_factory.js\";\nimport { BaseCMapReaderFactory } from \"./cmap_reader_factory.js\";\nimport { BaseFilterFactory } from \"./filter_factory.js\";\nimport { BaseStandardFontDataFactory } from \"./standard_fontdata_factory.js\";\nimport { BaseWasmFactory } from \"./wasm_factory.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_utils.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nif (isNodeJS) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) {\n    warn(\"Please use the `legacy` build in Node.js environments.\");\n  } else {\n    let canvas;\n    try {\n      const require = process\n        .getBuiltinModule(\"module\")\n        .createRequire(import.meta.url);\n\n      try {\n        canvas = require(\"@napi-rs/canvas\");\n      } catch (ex) {\n        warn(`Cannot load \"@napi-rs/canvas\" package: \"${ex}\".`);\n      }\n    } catch (ex) {\n      warn(`Cannot access the \\`require\\` function: \"${ex}\".`);\n    }\n\n    if (!globalThis.DOMMatrix) {\n      if (canvas?.DOMMatrix) {\n        globalThis.DOMMatrix = canvas.DOMMatrix;\n      } else {\n        warn(\"Cannot polyfill `DOMMatrix`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.ImageData) {\n      if (canvas?.ImageData) {\n        globalThis.ImageData = canvas.ImageData;\n      } else {\n        warn(\"Cannot polyfill `ImageData`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.Path2D) {\n      if (canvas?.Path2D) {\n        globalThis.Path2D = canvas.Path2D;\n      } else {\n        warn(\"Cannot polyfill `Path2D`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.navigator?.language) {\n      globalThis.navigator = {\n        language: \"en-US\",\n        platform: \"\",\n        userAgent: \"\",\n      };\n    }\n  }\n}\n\nasync function fetchData(url) {\n  const fs = process.getBuiltinModule(\"fs\");\n  const data = await fs.promises.readFile(url);\n  return new Uint8Array(data);\n}\n\nclass NodeFilterFactory extends BaseFilterFactory {}\n\nclass NodeCanvasFactory extends BaseCanvasFactory {\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const require = process\n      .getBuiltinModule(\"module\")\n      .createRequire(import.meta.url);\n    const canvas = require(\"@napi-rs/canvas\");\n    return canvas.createCanvas(width, height);\n  }\n}\n\nclass NodeCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nexport {\n  fetchData,\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n};\n","import { Util } from \"../shared/util.js\";\n\nconst FORCED_DEPENDENCY_LABEL = \"__forcedDependency\";\n\nconst { floor, ceil } = Math;\n\nfunction expandBBox(array, index, minX, minY, maxX, maxY) {\n  array[index * 4 + 0] = Math.min(array[index * 4 + 0], minX);\n  array[index * 4 + 1] = Math.min(array[index * 4 + 1], minY);\n  array[index * 4 + 2] = Math.max(array[index * 4 + 2], maxX);\n  array[index * 4 + 3] = Math.max(array[index * 4 + 3], maxY);\n}\n\n// This is computed rathter than hard-coded to keep into\n// account the platform's endianess.\nconst EMPTY_BBOX = new Uint32Array(new Uint8Array([255, 255, 0, 0]).buffer)[0];\n\nclass BBoxReader {\n  #bboxes;\n\n  #coords;\n\n  constructor(bboxes, coords) {\n    this.#bboxes = bboxes;\n    this.#coords = coords;\n  }\n\n  get length() {\n    return this.#bboxes.length;\n  }\n\n  isEmpty(i) {\n    return this.#bboxes[i] === EMPTY_BBOX;\n  }\n\n  minX(i) {\n    return this.#coords[i * 4 + 0] / 256;\n  }\n\n  minY(i) {\n    return this.#coords[i * 4 + 1] / 256;\n  }\n\n  maxX(i) {\n    return (this.#coords[i * 4 + 2] + 1) / 256;\n  }\n\n  maxY(i) {\n    return (this.#coords[i * 4 + 3] + 1) / 256;\n  }\n}\n\nconst ensureDebugMetadata = (map, key) => {\n  if (!map) {\n    return undefined;\n  }\n  let value = map.get(key);\n  if (!value) {\n    value = { dependencies: new Set(), isRenderingOperation: false };\n    map.set(key, value);\n  }\n  return value;\n};\n\n/**\n * @typedef {\"lineWidth\" | \"lineCap\" | \"lineJoin\" | \"miterLimit\" | \"dash\" |\n * \"strokeAlpha\" | \"fillColor\" | \"fillAlpha\" | \"globalCompositeOperation\" |\n * \"path\" | \"filter\" | \"font\" | \"fontObj\"} SimpleDependency\n */\n\n/**\n * @typedef {\"transform\" | \"moveText\" | \"sameLineText\"} IncrementalDependency\n */\n\n/**\n * @typedef {IncrementalDependency |\n * typeof FORCED_DEPENDENCY_LABEL} InternalIncrementalDependency\n */\nclass CanvasDependencyTracker {\n  /** @type {Record<SimpleDependency, number>} */\n  #simple = { __proto__: null };\n\n  /** @type {Record<InternalIncrementalDependency , number[]>} */\n  #incremental = {\n    __proto__: null,\n    transform: [],\n    moveText: [],\n    sameLineText: [],\n    [FORCED_DEPENDENCY_LABEL]: [],\n  };\n\n  #namedDependencies = new Map();\n\n  #savesStack = [];\n\n  #markedContentStack = [];\n\n  #baseTransformStack = [[1, 0, 0, 1, 0, 0]];\n\n  #clipBox = [-Infinity, -Infinity, Infinity, Infinity];\n\n  // Float32Array<minX, minY, maxX, maxY>\n  #pendingBBox = new Float64Array([Infinity, Infinity, -Infinity, -Infinity]);\n\n  #pendingBBoxIdx = -1;\n\n  #pendingDependencies = new Set();\n\n  #operations = new Map();\n\n  #fontBBoxTrustworthy = new Map();\n\n  #canvasWidth;\n\n  #canvasHeight;\n\n  // Uint8ClampedArray<minX, minY, maxX, maxY>\n  #bboxesCoords;\n\n  #bboxes;\n\n  #debugMetadata;\n\n  constructor(canvas, operationsCount, recordDebugMetadata = false) {\n    this.#canvasWidth = canvas.width;\n    this.#canvasHeight = canvas.height;\n    this.#initializeBBoxes(operationsCount);\n    if (recordDebugMetadata) {\n      this.#debugMetadata = new Map();\n    }\n  }\n\n  growOperationsCount(operationsCount) {\n    if (operationsCount >= this.#bboxes.length) {\n      this.#initializeBBoxes(operationsCount, this.#bboxes);\n    }\n  }\n\n  #initializeBBoxes(operationsCount, oldBBoxes) {\n    const buffer = new ArrayBuffer(operationsCount * 4);\n    this.#bboxesCoords = new Uint8ClampedArray(buffer);\n    this.#bboxes = new Uint32Array(buffer);\n    if (oldBBoxes && oldBBoxes.length > 0) {\n      this.#bboxes.set(oldBBoxes);\n      this.#bboxes.fill(EMPTY_BBOX, oldBBoxes.length);\n    } else {\n      this.#bboxes.fill(EMPTY_BBOX);\n    }\n  }\n\n  save(opIdx) {\n    this.#simple = { __proto__: this.#simple };\n    this.#incremental = {\n      __proto__: this.#incremental,\n      transform: { __proto__: this.#incremental.transform },\n      moveText: { __proto__: this.#incremental.moveText },\n      sameLineText: { __proto__: this.#incremental.sameLineText },\n      [FORCED_DEPENDENCY_LABEL]: {\n        __proto__: this.#incremental[FORCED_DEPENDENCY_LABEL],\n      },\n    };\n    this.#clipBox = { __proto__: this.#clipBox };\n    this.#savesStack.push(opIdx);\n\n    return this;\n  }\n\n  restore(opIdx) {\n    const previous = Object.getPrototypeOf(this.#simple);\n    if (previous === null) {\n      // Sometimes we call more .restore() than .save(), for\n      // example when using CanvasGraphics' #restoreInitialState()\n      return this;\n    }\n    this.#simple = previous;\n    this.#incremental = Object.getPrototypeOf(this.#incremental);\n    this.#clipBox = Object.getPrototypeOf(this.#clipBox);\n\n    const lastSave = this.#savesStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   */\n  recordOpenMarker(idx) {\n    this.#savesStack.push(idx);\n    return this;\n  }\n\n  getOpenMarker() {\n    if (this.#savesStack.length === 0) {\n      return null;\n    }\n    return this.#savesStack.at(-1);\n  }\n\n  recordCloseMarker(opIdx) {\n    const lastSave = this.#savesStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n    return this;\n  }\n\n  // Marked content needs a separate stack from save/restore, because they\n  // form two independent trees.\n  beginMarkedContent(opIdx) {\n    this.#markedContentStack.push(opIdx);\n    return this;\n  }\n\n  endMarkedContent(opIdx) {\n    const lastSave = this.#markedContentStack.pop();\n    if (lastSave !== undefined) {\n      ensureDebugMetadata(this.#debugMetadata, opIdx)?.dependencies.add(\n        lastSave\n      );\n      this.#bboxes[opIdx] = this.#bboxes[lastSave];\n    }\n    return this;\n  }\n\n  pushBaseTransform(ctx) {\n    this.#baseTransformStack.push(\n      Util.multiplyByDOMMatrix(\n        this.#baseTransformStack.at(-1),\n        ctx.getTransform()\n      )\n    );\n    return this;\n  }\n\n  popBaseTransform() {\n    if (this.#baseTransformStack.length > 1) {\n      this.#baseTransformStack.pop();\n    }\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {number} idx\n   */\n  recordSimpleData(name, idx) {\n    this.#simple[name] = idx;\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  recordIncrementalData(name, idx) {\n    this.#incremental[name].push(idx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  resetIncrementalData(name, idx) {\n    this.#incremental[name].length = 0;\n    return this;\n  }\n\n  recordNamedData(name, idx) {\n    this.#namedDependencies.set(name, idx);\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {string} depName\n   * @param {number} fallbackIdx\n   */\n  recordSimpleDataFromNamed(name, depName, fallbackIdx) {\n    this.#simple[name] = this.#namedDependencies.get(depName) ?? fallbackIdx;\n  }\n\n  // All next operations, until the next .restore(), will depend on this\n  recordFutureForcedDependency(name, idx) {\n    this.recordIncrementalData(FORCED_DEPENDENCY_LABEL, idx);\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on all\n  // the already recorded data with the given names.\n  inheritSimpleDataAsFutureForcedDependencies(names) {\n    for (const name of names) {\n      if (name in this.#simple) {\n        this.recordFutureForcedDependency(name, this.#simple[name]);\n      }\n    }\n    return this;\n  }\n\n  inheritPendingDependenciesAsFutureForcedDependencies() {\n    for (const dep of this.#pendingDependencies) {\n      this.recordFutureForcedDependency(FORCED_DEPENDENCY_LABEL, dep);\n    }\n    return this;\n  }\n\n  resetBBox(idx) {\n    if (this.#pendingBBoxIdx !== idx) {\n      this.#pendingBBoxIdx = idx;\n      this.#pendingBBox[0] = Infinity;\n      this.#pendingBBox[1] = Infinity;\n      this.#pendingBBox[2] = -Infinity;\n      this.#pendingBBox[3] = -Infinity;\n    }\n    return this;\n  }\n\n  recordClipBox(idx, ctx, minX, maxX, minY, maxY) {\n    const transform = Util.multiplyByDOMMatrix(\n      this.#baseTransformStack.at(-1),\n      ctx.getTransform()\n    );\n    const clipBox = [Infinity, Infinity, -Infinity, -Infinity];\n    Util.axialAlignedBoundingBox([minX, minY, maxX, maxY], transform, clipBox);\n    const intersection = Util.intersect(this.#clipBox, clipBox);\n    if (intersection) {\n      this.#clipBox[0] = intersection[0];\n      this.#clipBox[1] = intersection[1];\n      this.#clipBox[2] = intersection[2];\n      this.#clipBox[3] = intersection[3];\n    } else {\n      this.#clipBox[0] = this.#clipBox[1] = Infinity;\n      this.#clipBox[2] = this.#clipBox[3] = -Infinity;\n    }\n    return this;\n  }\n\n  recordBBox(idx, ctx, minX, maxX, minY, maxY) {\n    const clipBox = this.#clipBox;\n    if (clipBox[0] === Infinity) {\n      return this;\n    }\n\n    const transform = Util.multiplyByDOMMatrix(\n      this.#baseTransformStack.at(-1),\n      ctx.getTransform()\n    );\n    if (clipBox[0] === -Infinity) {\n      Util.axialAlignedBoundingBox(\n        [minX, minY, maxX, maxY],\n        transform,\n        this.#pendingBBox\n      );\n      return this;\n    }\n\n    const bbox = [Infinity, Infinity, -Infinity, -Infinity];\n    Util.axialAlignedBoundingBox([minX, minY, maxX, maxY], transform, bbox);\n    this.#pendingBBox[0] = Math.min(\n      this.#pendingBBox[0],\n      Math.max(bbox[0], clipBox[0])\n    );\n    this.#pendingBBox[1] = Math.min(\n      this.#pendingBBox[1],\n      Math.max(bbox[1], clipBox[1])\n    );\n    this.#pendingBBox[2] = Math.max(\n      this.#pendingBBox[2],\n      Math.min(bbox[2], clipBox[2])\n    );\n    this.#pendingBBox[3] = Math.max(\n      this.#pendingBBox[3],\n      Math.min(bbox[3], clipBox[3])\n    );\n    return this;\n  }\n\n  recordCharacterBBox(idx, ctx, font, scale = 1, x = 0, y = 0, getMeasure) {\n    const fontBBox = font.bbox;\n    let isBBoxTrustworthy;\n    let computedBBox;\n\n    if (fontBBox) {\n      isBBoxTrustworthy =\n        // Only use the bounding box defined by the font if it\n        // has a non-empty area.\n        fontBBox[2] !== fontBBox[0] &&\n        fontBBox[3] !== fontBBox[1] &&\n        this.#fontBBoxTrustworthy.get(font);\n\n      if (isBBoxTrustworthy !== false) {\n        computedBBox = [0, 0, 0, 0];\n        Util.axialAlignedBoundingBox(fontBBox, font.fontMatrix, computedBBox);\n        if (scale !== 1 || x !== 0 || y !== 0) {\n          Util.scaleMinMax([scale, 0, 0, -scale, x, y], computedBBox);\n        }\n\n        if (isBBoxTrustworthy) {\n          return this.recordBBox(\n            idx,\n            ctx,\n            computedBBox[0],\n            computedBBox[2],\n            computedBBox[1],\n            computedBBox[3]\n          );\n        }\n      }\n    }\n\n    if (!getMeasure) {\n      // We have no way of telling how big this character actually is, record\n      // a full page bounding box.\n      return this.recordFullPageBBox(idx);\n    }\n\n    const measure = getMeasure();\n\n    if (fontBBox && computedBBox && isBBoxTrustworthy === undefined) {\n      // If it's the first time we can compare the font bbox with the actual\n      // bbox measured when drawing it, check if the one recorded in the font\n      // is large enough to cover the actual bbox. If it is, we assume that the\n      // font is well-formed and we can use the declared bbox without having to\n      // measure it again for every character.\n      isBBoxTrustworthy =\n        computedBBox[0] <= x - measure.actualBoundingBoxLeft &&\n        computedBBox[2] >= x + measure.actualBoundingBoxRight &&\n        computedBBox[1] <= y - measure.actualBoundingBoxAscent &&\n        computedBBox[3] >= y + measure.actualBoundingBoxDescent;\n      this.#fontBBoxTrustworthy.set(font, isBBoxTrustworthy);\n      if (isBBoxTrustworthy) {\n        return this.recordBBox(\n          idx,\n          ctx,\n          computedBBox[0],\n          computedBBox[2],\n          computedBBox[1],\n          computedBBox[3]\n        );\n      }\n    }\n\n    // The font has no bbox or it is not trustworthy, so we need to\n    // return the bounding box based on .measureText().\n    return this.recordBBox(\n      idx,\n      ctx,\n      x - measure.actualBoundingBoxLeft,\n      x + measure.actualBoundingBoxRight,\n      y - measure.actualBoundingBoxAscent,\n      y + measure.actualBoundingBoxDescent\n    );\n  }\n\n  recordFullPageBBox(idx) {\n    this.#pendingBBox[0] = Math.max(0, this.#clipBox[0]);\n    this.#pendingBBox[1] = Math.max(0, this.#clipBox[1]);\n    this.#pendingBBox[2] = Math.min(this.#canvasWidth, this.#clipBox[2]);\n    this.#pendingBBox[3] = Math.min(this.#canvasHeight, this.#clipBox[3]);\n\n    return this;\n  }\n\n  getSimpleIndex(dependencyName) {\n    return this.#simple[dependencyName];\n  }\n\n  recordDependencies(idx, dependencyNames) {\n    const pendingDependencies = this.#pendingDependencies;\n    const simple = this.#simple;\n    const incremental = this.#incremental;\n    for (const name of dependencyNames) {\n      if (name in this.#simple) {\n        pendingDependencies.add(simple[name]);\n      } else if (name in incremental) {\n        incremental[name].forEach(pendingDependencies.add, pendingDependencies);\n      }\n    }\n\n    return this;\n  }\n\n  recordNamedDependency(idx, name) {\n    if (this.#namedDependencies.has(name)) {\n      this.#pendingDependencies.add(this.#namedDependencies.get(name));\n    }\n\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   */\n  recordOperation(idx, preserve = false) {\n    this.recordDependencies(idx, [FORCED_DEPENDENCY_LABEL]);\n\n    if (this.#debugMetadata) {\n      const metadata = ensureDebugMetadata(this.#debugMetadata, idx);\n      const { dependencies } = metadata;\n      this.#pendingDependencies.forEach(dependencies.add, dependencies);\n      this.#savesStack.forEach(dependencies.add, dependencies);\n      this.#markedContentStack.forEach(dependencies.add, dependencies);\n      dependencies.delete(idx);\n      metadata.isRenderingOperation = true;\n    }\n\n    if (this.#pendingBBoxIdx === idx) {\n      const minX = floor((this.#pendingBBox[0] * 256) / this.#canvasWidth);\n      const minY = floor((this.#pendingBBox[1] * 256) / this.#canvasHeight);\n      const maxX = ceil((this.#pendingBBox[2] * 256) / this.#canvasWidth);\n      const maxY = ceil((this.#pendingBBox[3] * 256) / this.#canvasHeight);\n\n      expandBBox(this.#bboxesCoords, idx, minX, minY, maxX, maxY);\n      for (const depIdx of this.#pendingDependencies) {\n        if (depIdx !== idx) {\n          expandBBox(this.#bboxesCoords, depIdx, minX, minY, maxX, maxY);\n        }\n      }\n      for (const saveIdx of this.#savesStack) {\n        if (saveIdx !== idx) {\n          expandBBox(this.#bboxesCoords, saveIdx, minX, minY, maxX, maxY);\n        }\n      }\n      for (const saveIdx of this.#markedContentStack) {\n        if (saveIdx !== idx) {\n          expandBBox(this.#bboxesCoords, saveIdx, minX, minY, maxX, maxY);\n        }\n      }\n\n      if (!preserve) {\n        this.#pendingDependencies.clear();\n        this.#pendingBBoxIdx = -1;\n      }\n    }\n\n    return this;\n  }\n\n  recordShowTextOperation(idx, preserve = false) {\n    const deps = Array.from(this.#pendingDependencies);\n    this.recordOperation(idx, preserve);\n    this.recordIncrementalData(\"sameLineText\", idx);\n    for (const dep of deps) {\n      this.recordIncrementalData(\"sameLineText\", dep);\n    }\n    return this;\n  }\n\n  bboxToClipBoxDropOperation(idx, preserve = false) {\n    if (this.#pendingBBoxIdx === idx) {\n      this.#pendingBBoxIdx = -1;\n\n      this.#clipBox[0] = Math.max(this.#clipBox[0], this.#pendingBBox[0]);\n      this.#clipBox[1] = Math.max(this.#clipBox[1], this.#pendingBBox[1]);\n      this.#clipBox[2] = Math.min(this.#clipBox[2], this.#pendingBBox[2]);\n      this.#clipBox[3] = Math.min(this.#clipBox[3], this.#pendingBBox[3]);\n\n      if (!preserve) {\n        this.#pendingDependencies.clear();\n      }\n    }\n    return this;\n  }\n\n  _takePendingDependencies() {\n    const pendingDependencies = this.#pendingDependencies;\n    this.#pendingDependencies = new Set();\n    return pendingDependencies;\n  }\n\n  _extractOperation(idx) {\n    const operation = this.#operations.get(idx);\n    this.#operations.delete(idx);\n    return operation;\n  }\n\n  _pushPendingDependencies(dependencies) {\n    for (const dep of dependencies) {\n      this.#pendingDependencies.add(dep);\n    }\n  }\n\n  take() {\n    this.#fontBBoxTrustworthy.clear();\n    return new BBoxReader(this.#bboxes, this.#bboxesCoords);\n  }\n\n  takeDebugMetadata() {\n    return this.#debugMetadata;\n  }\n}\n\n/**\n * Used to track dependencies of nested operations list, that\n * should actually all map to the index of the operation that\n * contains the nested list.\n *\n * @implements {CanvasDependencyTracker}\n */\nclass CanvasNestedDependencyTracker {\n  /** @type {CanvasDependencyTracker} */\n  #dependencyTracker;\n\n  /** @type {number} */\n  #opIdx;\n\n  #ignoreBBoxes;\n\n  #nestingLevel = 0;\n\n  #savesLevel = 0;\n\n  constructor(dependencyTracker, opIdx, ignoreBBoxes) {\n    if (\n      dependencyTracker instanceof CanvasNestedDependencyTracker &&\n      dependencyTracker.#ignoreBBoxes === !!ignoreBBoxes\n    ) {\n      // The goal of CanvasNestedDependencyTracker is to collapse all operations\n      // into a single one. If we are already in a\n      // CanvasNestedDependencyTracker, that is already happening.\n      return dependencyTracker;\n    }\n\n    this.#dependencyTracker = dependencyTracker;\n    this.#opIdx = opIdx;\n    this.#ignoreBBoxes = !!ignoreBBoxes;\n  }\n\n  growOperationsCount() {\n    throw new Error(\"Unreachable\");\n  }\n\n  save(opIdx) {\n    this.#savesLevel++;\n    this.#dependencyTracker.save(this.#opIdx);\n    return this;\n  }\n\n  restore(opIdx) {\n    if (this.#savesLevel > 0) {\n      this.#dependencyTracker.restore(this.#opIdx);\n      this.#savesLevel--;\n    }\n    return this;\n  }\n\n  recordOpenMarker(idx) {\n    this.#nestingLevel++;\n    return this;\n  }\n\n  getOpenMarker() {\n    return this.#nestingLevel > 0\n      ? this.#opIdx\n      : this.#dependencyTracker.getOpenMarker();\n  }\n\n  recordCloseMarker(idx) {\n    this.#nestingLevel--;\n    return this;\n  }\n\n  beginMarkedContent(opIdx) {\n    return this;\n  }\n\n  endMarkedContent(opIdx) {\n    return this;\n  }\n\n  pushBaseTransform(ctx) {\n    this.#dependencyTracker.pushBaseTransform(ctx);\n    return this;\n  }\n\n  popBaseTransform() {\n    this.#dependencyTracker.popBaseTransform();\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {number} idx\n   */\n  recordSimpleData(name, idx) {\n    this.#dependencyTracker.recordSimpleData(name, this.#opIdx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  recordIncrementalData(name, idx) {\n    this.#dependencyTracker.recordIncrementalData(name, this.#opIdx);\n    return this;\n  }\n\n  /**\n   * @param {IncrementalDependency} name\n   * @param {number} idx\n   */\n  resetIncrementalData(name, idx) {\n    this.#dependencyTracker.resetIncrementalData(name, this.#opIdx);\n    return this;\n  }\n\n  recordNamedData(name, idx) {\n    // Nested dependencies are not visible to the outside.\n    return this;\n  }\n\n  /**\n   * @param {SimpleDependency} name\n   * @param {string} depName\n   * @param {number} fallbackIdx\n   */\n  recordSimpleDataFromNamed(name, depName, fallbackIdx) {\n    this.#dependencyTracker.recordSimpleDataFromNamed(\n      name,\n      depName,\n      this.#opIdx\n    );\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on this\n  recordFutureForcedDependency(name, idx) {\n    this.#dependencyTracker.recordFutureForcedDependency(name, this.#opIdx);\n    return this;\n  }\n\n  // All next operations, until the next .restore(), will depend on all\n  // the already recorded data with the given names.\n  inheritSimpleDataAsFutureForcedDependencies(names) {\n    this.#dependencyTracker.inheritSimpleDataAsFutureForcedDependencies(names);\n    return this;\n  }\n\n  inheritPendingDependenciesAsFutureForcedDependencies() {\n    this.#dependencyTracker.inheritPendingDependenciesAsFutureForcedDependencies();\n    return this;\n  }\n\n  resetBBox(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.resetBBox(this.#opIdx);\n    }\n    return this;\n  }\n\n  recordClipBox(idx, ctx, minX, maxX, minY, maxY) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordClipBox(\n        this.#opIdx,\n        ctx,\n        minX,\n        maxX,\n        minY,\n        maxY\n      );\n    }\n    return this;\n  }\n\n  recordBBox(idx, ctx, minX, maxX, minY, maxY) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordBBox(\n        this.#opIdx,\n        ctx,\n        minX,\n        maxX,\n        minY,\n        maxY\n      );\n    }\n    return this;\n  }\n\n  recordCharacterBBox(idx, ctx, font, scale, x, y, getMeasure) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordCharacterBBox(\n        this.#opIdx,\n        ctx,\n        font,\n        scale,\n        x,\n        y,\n        getMeasure\n      );\n    }\n    return this;\n  }\n\n  recordFullPageBBox(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.recordFullPageBBox(this.#opIdx);\n    }\n    return this;\n  }\n\n  getSimpleIndex(dependencyName) {\n    return this.#dependencyTracker.getSimpleIndex(dependencyName);\n  }\n\n  recordDependencies(idx, dependencyNames) {\n    this.#dependencyTracker.recordDependencies(this.#opIdx, dependencyNames);\n    return this;\n  }\n\n  recordNamedDependency(idx, name) {\n    this.#dependencyTracker.recordNamedDependency(this.#opIdx, name);\n    return this;\n  }\n\n  /**\n   * @param {number} idx\n   * @param {SimpleDependency[]} dependencyNames\n   */\n  recordOperation(idx) {\n    this.#dependencyTracker.recordOperation(this.#opIdx, true);\n    return this;\n  }\n\n  recordShowTextOperation(idx) {\n    this.#dependencyTracker.recordShowTextOperation(this.#opIdx, true);\n    return this;\n  }\n\n  bboxToClipBoxDropOperation(idx) {\n    if (!this.#ignoreBBoxes) {\n      this.#dependencyTracker.bboxToClipBoxDropOperation(this.#opIdx, true);\n    }\n    return this;\n  }\n\n  take() {\n    throw new Error(\"Unreachable\");\n  }\n\n  takeDebugMetadata() {\n    throw new Error(\"Unreachable\");\n  }\n}\n\n/** @satisfies {Record<string, SimpleDependency | IncrementalDependency>} */\nconst Dependencies = {\n  stroke: [\n    \"path\",\n    \"transform\",\n    \"filter\",\n    \"strokeColor\",\n    \"strokeAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"dash\",\n  ],\n  fill: [\n    \"path\",\n    \"transform\",\n    \"filter\",\n    \"fillColor\",\n    \"fillAlpha\",\n    \"globalCompositeOperation\",\n    \"SMask\",\n  ],\n  imageXObject: [\n    \"transform\",\n    \"SMask\",\n    \"filter\",\n    \"fillAlpha\",\n    \"strokeAlpha\",\n    \"globalCompositeOperation\",\n  ],\n  rawFillPath: [\"filter\", \"fillColor\", \"fillAlpha\"],\n  showText: [\n    \"transform\",\n    \"leading\",\n    \"charSpacing\",\n    \"wordSpacing\",\n    \"hScale\",\n    \"textRise\",\n    \"moveText\",\n    \"textMatrix\",\n    \"font\",\n    \"fontObj\",\n    \"filter\",\n    \"fillColor\",\n    \"textRenderingMode\",\n    \"SMask\",\n    \"fillAlpha\",\n    \"strokeAlpha\",\n    \"globalCompositeOperation\",\n\n    \"sameLineText\",\n  ],\n  transform: [\"transform\"],\n  transformAndFill: [\"transform\", \"fillColor\"],\n};\n\nexport { CanvasDependencyTracker, CanvasNestedDependencyTracker, Dependencies };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FormatError,\n  info,\n  MeshFigureType,\n  unreachable,\n  Util,\n} from \"../shared/util.js\";\nimport { getCurrentTransform } from \"./display_utils.js\";\n\nconst PathType = {\n  FILL: \"Fill\",\n  STROKE: \"Stroke\",\n  SHADING: \"Shading\",\n};\n\nfunction applyBoundingBox(ctx, bbox) {\n  if (!bbox) {\n    return;\n  }\n  const width = bbox[2] - bbox[0];\n  const height = bbox[3] - bbox[1];\n  const region = new Path2D();\n  region.rect(bbox[0], bbox[1], width, height);\n  ctx.clip(region);\n}\n\nclass BaseShadingPattern {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseShadingPattern\n    ) {\n      unreachable(\"Cannot initialize BaseShadingPattern.\");\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern() {\n    unreachable(\"Abstract method `getPattern` called.\");\n  }\n}\n\nclass RadialAxialShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._type = IR[1];\n    this._bbox = IR[2];\n    this._colorStops = IR[3];\n    this._p0 = IR[4];\n    this._p1 = IR[5];\n    this._r0 = IR[6];\n    this._r1 = IR[7];\n    this.matrix = null;\n  }\n\n  _createGradient(ctx) {\n    let grad;\n    if (this._type === \"axial\") {\n      grad = ctx.createLinearGradient(\n        this._p0[0],\n        this._p0[1],\n        this._p1[0],\n        this._p1[1]\n      );\n    } else if (this._type === \"radial\") {\n      grad = ctx.createRadialGradient(\n        this._p0[0],\n        this._p0[1],\n        this._r0,\n        this._p1[0],\n        this._p1[1],\n        this._r1\n      );\n    }\n\n    for (const colorStop of this._colorStops) {\n      grad.addColorStop(colorStop[0], colorStop[1]);\n    }\n    return grad;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    let pattern;\n    if (pathType === PathType.STROKE || pathType === PathType.FILL) {\n      const ownerBBox = owner.current.getClippedPathBoundingBox(\n        pathType,\n        getCurrentTransform(ctx)\n      ) || [0, 0, 0, 0];\n      // Create a canvas that is only as big as the current path. This doesn't\n      // allow us to cache the pattern, but it generally creates much smaller\n      // canvases and saves memory use. See bug 1722807 for an example.\n      const width = Math.ceil(ownerBBox[2] - ownerBBox[0]) || 1;\n      const height = Math.ceil(ownerBBox[3] - ownerBBox[1]) || 1;\n\n      const tmpCanvas = owner.cachedCanvases.getCanvas(\n        \"pattern\",\n        width,\n        height\n      );\n\n      const tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      tmpCtx.beginPath();\n      tmpCtx.rect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      // Non shading fill patterns are positioned relative to the base transform\n      // (usually the page's initial transform), but we may have created a\n      // smaller canvas based on the path, so we must account for the shift.\n      tmpCtx.translate(-ownerBBox[0], -ownerBBox[1]);\n      inverse = Util.transform(inverse, [\n        1,\n        0,\n        0,\n        1,\n        ownerBBox[0],\n        ownerBBox[1],\n      ]);\n\n      tmpCtx.transform(...owner.baseTransform);\n      if (this.matrix) {\n        tmpCtx.transform(...this.matrix);\n      }\n      applyBoundingBox(tmpCtx, this._bbox);\n\n      tmpCtx.fillStyle = this._createGradient(tmpCtx);\n      tmpCtx.fill();\n\n      pattern = ctx.createPattern(tmpCanvas.canvas, \"no-repeat\");\n      const domMatrix = new DOMMatrix(inverse);\n      pattern.setTransform(domMatrix);\n    } else {\n      // Shading fills are applied relative to the current matrix which is also\n      // how canvas gradients work, so there's no need to do anything special\n      // here.\n      applyBoundingBox(ctx, this._bbox);\n      pattern = this._createGradient(ctx);\n    }\n    return pattern;\n  }\n}\n\nfunction drawTriangle(data, context, p1, p2, p3, c1, c2, c3) {\n  // Very basic Gouraud-shaded triangle rasterization algorithm.\n  const coords = context.coords,\n    colors = context.colors;\n  const bytes = data.data,\n    rowSize = data.width * 4;\n  let tmp;\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  if (coords[p2 + 1] > coords[p3 + 1]) {\n    tmp = p2;\n    p2 = p3;\n    p3 = tmp;\n    tmp = c2;\n    c2 = c3;\n    c3 = tmp;\n  }\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  const x1 = (coords[p1] + context.offsetX) * context.scaleX;\n  const y1 = (coords[p1 + 1] + context.offsetY) * context.scaleY;\n  const x2 = (coords[p2] + context.offsetX) * context.scaleX;\n  const y2 = (coords[p2 + 1] + context.offsetY) * context.scaleY;\n  const x3 = (coords[p3] + context.offsetX) * context.scaleX;\n  const y3 = (coords[p3 + 1] + context.offsetY) * context.scaleY;\n  if (y1 >= y3) {\n    return;\n  }\n  const c1r = colors[c1],\n    c1g = colors[c1 + 1],\n    c1b = colors[c1 + 2];\n  const c2r = colors[c2],\n    c2g = colors[c2 + 1],\n    c2b = colors[c2 + 2];\n  const c3r = colors[c3],\n    c3g = colors[c3 + 1],\n    c3b = colors[c3 + 2];\n\n  const minY = Math.round(y1),\n    maxY = Math.round(y3);\n  let xa, car, cag, cab;\n  let xb, cbr, cbg, cbb;\n  for (let y = minY; y <= maxY; y++) {\n    if (y < y2) {\n      const k = y < y1 ? 0 : (y1 - y) / (y1 - y2);\n      xa = x1 - (x1 - x2) * k;\n      car = c1r - (c1r - c2r) * k;\n      cag = c1g - (c1g - c2g) * k;\n      cab = c1b - (c1b - c2b) * k;\n    } else {\n      let k;\n      if (y > y3) {\n        k = 1;\n      } else if (y2 === y3) {\n        k = 0;\n      } else {\n        k = (y2 - y) / (y2 - y3);\n      }\n      xa = x2 - (x2 - x3) * k;\n      car = c2r - (c2r - c3r) * k;\n      cag = c2g - (c2g - c3g) * k;\n      cab = c2b - (c2b - c3b) * k;\n    }\n\n    let k;\n    if (y < y1) {\n      k = 0;\n    } else if (y > y3) {\n      k = 1;\n    } else {\n      k = (y1 - y) / (y1 - y3);\n    }\n    xb = x1 - (x1 - x3) * k;\n    cbr = c1r - (c1r - c3r) * k;\n    cbg = c1g - (c1g - c3g) * k;\n    cbb = c1b - (c1b - c3b) * k;\n    const x1_ = Math.round(Math.min(xa, xb));\n    const x2_ = Math.round(Math.max(xa, xb));\n    let j = rowSize * y + x1_ * 4;\n    for (let x = x1_; x <= x2_; x++) {\n      k = (xa - x) / (xa - xb);\n      if (k < 0) {\n        k = 0;\n      } else if (k > 1) {\n        k = 1;\n      }\n      bytes[j++] = (car - (car - cbr) * k) | 0;\n      bytes[j++] = (cag - (cag - cbg) * k) | 0;\n      bytes[j++] = (cab - (cab - cbb) * k) | 0;\n      bytes[j++] = 255;\n    }\n  }\n}\n\nfunction drawFigure(data, figure, context) {\n  const ps = figure.coords;\n  const cs = figure.colors;\n  let i, ii;\n  switch (figure.type) {\n    case MeshFigureType.LATTICE:\n      const verticesPerRow = figure.verticesPerRow;\n      const rows = Math.floor(ps.length / verticesPerRow) - 1;\n      const cols = verticesPerRow - 1;\n      for (i = 0; i < rows; i++) {\n        let q = i * verticesPerRow;\n        for (let j = 0; j < cols; j++, q++) {\n          drawTriangle(\n            data,\n            context,\n            ps[q],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n          drawTriangle(\n            data,\n            context,\n            ps[q + verticesPerRow + 1],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q + verticesPerRow + 1],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n        }\n      }\n      break;\n    case MeshFigureType.TRIANGLES:\n      for (i = 0, ii = ps.length; i < ii; i += 3) {\n        drawTriangle(\n          data,\n          context,\n          ps[i],\n          ps[i + 1],\n          ps[i + 2],\n          cs[i],\n          cs[i + 1],\n          cs[i + 2]\n        );\n      }\n      break;\n    default:\n      throw new Error(\"illegal figure\");\n  }\n}\n\nclass MeshShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._coords = IR[2];\n    this._colors = IR[3];\n    this._figures = IR[4];\n    this._bounds = IR[5];\n    this._bbox = IR[6];\n    this._background = IR[7];\n    this.matrix = null;\n  }\n\n  _createMeshCanvas(combinedScale, backgroundColor, cachedCanvases) {\n    // we will increase scale on some weird factor to let antialiasing take\n    // care of \"rough\" edges\n    const EXPECTED_SCALE = 1.1;\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    const MAX_PATTERN_SIZE = 3000; // 10in @ 300dpi shall be enough\n    // We need to keep transparent border around our pattern for fill():\n    // createPattern with 'no-repeat' will bleed edges across entire area.\n    const BORDER_SIZE = 2;\n\n    const offsetX = Math.floor(this._bounds[0]);\n    const offsetY = Math.floor(this._bounds[1]);\n    const boundsWidth = Math.ceil(this._bounds[2]) - offsetX;\n    const boundsHeight = Math.ceil(this._bounds[3]) - offsetY;\n\n    const width = Math.min(\n      Math.ceil(Math.abs(boundsWidth * combinedScale[0] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const height = Math.min(\n      Math.ceil(Math.abs(boundsHeight * combinedScale[1] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const scaleX = boundsWidth / width;\n    const scaleY = boundsHeight / height;\n\n    const context = {\n      coords: this._coords,\n      colors: this._colors,\n      offsetX: -offsetX,\n      offsetY: -offsetY,\n      scaleX: 1 / scaleX,\n      scaleY: 1 / scaleY,\n    };\n\n    const paddedWidth = width + BORDER_SIZE * 2;\n    const paddedHeight = height + BORDER_SIZE * 2;\n\n    const tmpCanvas = cachedCanvases.getCanvas(\n      \"mesh\",\n      paddedWidth,\n      paddedHeight\n    );\n    const tmpCtx = tmpCanvas.context;\n\n    const data = tmpCtx.createImageData(width, height);\n    if (backgroundColor) {\n      const bytes = data.data;\n      for (let i = 0, ii = bytes.length; i < ii; i += 4) {\n        bytes[i] = backgroundColor[0];\n        bytes[i + 1] = backgroundColor[1];\n        bytes[i + 2] = backgroundColor[2];\n        bytes[i + 3] = 255;\n      }\n    }\n    for (const figure of this._figures) {\n      drawFigure(data, figure, context);\n    }\n    tmpCtx.putImageData(data, BORDER_SIZE, BORDER_SIZE);\n    const canvas = tmpCanvas.canvas;\n\n    return {\n      canvas,\n      offsetX: offsetX - BORDER_SIZE * scaleX,\n      offsetY: offsetY - BORDER_SIZE * scaleY,\n      scaleX,\n      scaleY,\n    };\n  }\n\n  isModifyingCurrentTransform() {\n    return true;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    applyBoundingBox(ctx, this._bbox);\n    const scale = new Float32Array(2);\n    if (pathType === PathType.SHADING) {\n      Util.singularValueDecompose2dScale(getCurrentTransform(ctx), scale);\n    } else if (this.matrix) {\n      // Obtain scale from matrix and current transformation matrix.\n      Util.singularValueDecompose2dScale(this.matrix, scale);\n      const [matrixScaleX, matrixScaleY] = scale;\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n      scale[0] *= matrixScaleX;\n      scale[1] *= matrixScaleY;\n    } else {\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n    }\n\n    // Rasterizing on the main thread since sending/queue large canvases\n    // might cause OOM.\n    const temporaryPatternCanvas = this._createMeshCanvas(\n      scale,\n      pathType === PathType.SHADING ? null : this._background,\n      owner.cachedCanvases\n    );\n\n    if (pathType !== PathType.SHADING) {\n      ctx.setTransform(...owner.baseTransform);\n      if (this.matrix) {\n        ctx.transform(...this.matrix);\n      }\n    }\n\n    ctx.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    ctx.scale(temporaryPatternCanvas.scaleX, temporaryPatternCanvas.scaleY);\n\n    return ctx.createPattern(temporaryPatternCanvas.canvas, \"no-repeat\");\n  }\n}\n\nclass DummyShadingPattern extends BaseShadingPattern {\n  getPattern() {\n    return \"hotpink\";\n  }\n}\n\nfunction getShadingPattern(IR) {\n  switch (IR[0]) {\n    case \"RadialAxial\":\n      return new RadialAxialShadingPattern(IR);\n    case \"Mesh\":\n      return new MeshShadingPattern(IR);\n    case \"Dummy\":\n      return new DummyShadingPattern();\n  }\n  throw new Error(`Unknown IR type: ${IR[0]}`);\n}\n\nconst PaintType = {\n  COLORED: 1,\n  UNCOLORED: 2,\n};\n\nclass TilingPattern {\n  // 10in @ 300dpi shall be enough.\n  static MAX_PATTERN_SIZE = 3000;\n\n  constructor(IR, ctx, canvasGraphicsFactory, baseTransform) {\n    this.color = IR[1];\n    this.operatorList = IR[2];\n    this.matrix = IR[3];\n    this.bbox = IR[4];\n    this.xstep = IR[5];\n    this.ystep = IR[6];\n    this.paintType = IR[7];\n    this.tilingType = IR[8];\n    this.ctx = ctx;\n    this.canvasGraphicsFactory = canvasGraphicsFactory;\n    this.baseTransform = baseTransform;\n  }\n\n  createPatternCanvas(owner, opIdx) {\n    const {\n      bbox,\n      operatorList,\n      paintType,\n      tilingType,\n      color,\n      canvasGraphicsFactory,\n    } = this;\n    let { xstep, ystep } = this;\n    xstep = Math.abs(xstep);\n    ystep = Math.abs(ystep);\n\n    info(\"TilingType: \" + tilingType);\n\n    // A tiling pattern as defined by PDF spec 8.7.2 is a cell whose size is\n    // described by bbox, and may repeat regularly by shifting the cell by\n    // xstep and ystep.\n    // Because the HTML5 canvas API does not support pattern repetition with\n    // gaps in between, we use the xstep/ystep instead of the bbox's size.\n    //\n    // This has the following consequences (similarly for ystep):\n    //\n    // - If xstep is the same as bbox, then there is no observable difference.\n    //\n    // - If xstep is larger than bbox, then the pattern canvas is partially\n    //   empty: the area bounded by bbox is painted, the outside area is void.\n    //\n    // - If xstep is smaller than bbox, then the pixels between xstep and the\n    //   bbox boundary will be missing. This is INCORRECT behavior.\n    //   \"Figures on adjacent tiles should not overlap\" (PDF spec 8.7.3.1),\n    //   but overlapping cells without common pixels are still valid.\n\n    const x0 = bbox[0],\n      y0 = bbox[1],\n      x1 = bbox[2],\n      y1 = bbox[3];\n    const width = x1 - x0;\n    const height = y1 - y0;\n\n    // Obtain scale from matrix and current transformation matrix.\n    const scale = new Float32Array(2);\n    Util.singularValueDecompose2dScale(this.matrix, scale);\n    const [matrixScaleX, matrixScaleY] = scale;\n    Util.singularValueDecompose2dScale(this.baseTransform, scale);\n    const combinedScaleX = matrixScaleX * scale[0];\n    const combinedScaleY = matrixScaleY * scale[1];\n\n    let canvasWidth = width,\n      canvasHeight = height,\n      redrawHorizontally = false,\n      redrawVertically = false;\n\n    const xScaledStep = Math.ceil(xstep * combinedScaleX);\n    const yScaledStep = Math.ceil(ystep * combinedScaleY);\n    const xScaledWidth = Math.ceil(width * combinedScaleX);\n    const yScaledHeight = Math.ceil(height * combinedScaleY);\n\n    if (xScaledStep >= xScaledWidth) {\n      canvasWidth = xstep;\n    } else {\n      redrawHorizontally = true;\n    }\n    if (yScaledStep >= yScaledHeight) {\n      canvasHeight = ystep;\n    } else {\n      redrawVertically = true;\n    }\n\n    // Use width and height values that are as close as possible to the end\n    // result when the pattern is used. Too low value makes the pattern look\n    // blurry. Too large value makes it look too crispy.\n    const dimx = this.getSizeAndScale(\n      canvasWidth,\n      this.ctx.canvas.width,\n      combinedScaleX\n    );\n    const dimy = this.getSizeAndScale(\n      canvasHeight,\n      this.ctx.canvas.height,\n      combinedScaleY\n    );\n\n    const tmpCanvas = owner.cachedCanvases.getCanvas(\n      \"pattern\",\n      dimx.size,\n      dimy.size\n    );\n    const tmpCtx = tmpCanvas.context;\n    const graphics = canvasGraphicsFactory.createCanvasGraphics(tmpCtx, opIdx);\n    graphics.groupLevel = owner.groupLevel;\n\n    this.setFillAndStrokeStyleToContext(graphics, paintType, color);\n\n    tmpCtx.translate(-dimx.scale * x0, -dimy.scale * y0);\n    graphics.transform(\n      // We pass 0 as the 'opIdx' argument, but the value is irrelevant.\n      // We know that we are in a 'CanvasNestedDependencyTracker' that captures\n      // all the sub-operations needed to create this pattern canvas and uses\n      // the top-level operation index as their index.\n      0,\n      dimx.scale,\n      0,\n      0,\n      dimy.scale,\n      0,\n      0\n    );\n\n    // To match CanvasGraphics beginDrawing we must save the context here or\n    // else we end up with unbalanced save/restores.\n    tmpCtx.save();\n    graphics.dependencyTracker?.save();\n\n    this.clipBbox(graphics, x0, y0, x1, y1);\n\n    graphics.baseTransform = getCurrentTransform(graphics.ctx);\n\n    graphics.executeOperatorList(operatorList);\n\n    graphics.endDrawing();\n\n    graphics.dependencyTracker?.restore();\n    tmpCtx.restore();\n\n    if (redrawHorizontally || redrawVertically) {\n      // The tile is overlapping itself, so we create a new tile with\n      // dimensions xstep * ystep.\n      // Then we draw the overlapping parts of the original tile on the new\n      // tile.\n      // Just as a side note, the code here works correctly even if we don't\n      // have to redraw the tile horizontally or vertically. In that case, the\n      // original tile is drawn on the new tile only once, but it's useless.\n      const image = tmpCanvas.canvas;\n      if (redrawHorizontally) {\n        canvasWidth = xstep;\n      }\n      if (redrawVertically) {\n        canvasHeight = ystep;\n      }\n\n      const dimx2 = this.getSizeAndScale(\n        canvasWidth,\n        this.ctx.canvas.width,\n        combinedScaleX\n      );\n      const dimy2 = this.getSizeAndScale(\n        canvasHeight,\n        this.ctx.canvas.height,\n        combinedScaleY\n      );\n\n      const xSize = dimx2.size;\n      const ySize = dimy2.size;\n      const tmpCanvas2 = owner.cachedCanvases.getCanvas(\n        \"pattern-workaround\",\n        xSize,\n        ySize\n      );\n      const tmpCtx2 = tmpCanvas2.context;\n      const ii = redrawHorizontally ? Math.floor(width / xstep) : 0;\n      const jj = redrawVertically ? Math.floor(height / ystep) : 0;\n\n      // Draw the overlapping parts of the original tile on the new tile.\n      for (let i = 0; i <= ii; i++) {\n        for (let j = 0; j <= jj; j++) {\n          tmpCtx2.drawImage(\n            image,\n            xSize * i,\n            ySize * j,\n            xSize,\n            ySize,\n            0,\n            0,\n            xSize,\n            ySize\n          );\n        }\n      }\n      return {\n        canvas: tmpCanvas2.canvas,\n        scaleX: dimx2.scale,\n        scaleY: dimy2.scale,\n        offsetX: x0,\n        offsetY: y0,\n      };\n    }\n\n    return {\n      canvas: tmpCanvas.canvas,\n      scaleX: dimx.scale,\n      scaleY: dimy.scale,\n      offsetX: x0,\n      offsetY: y0,\n    };\n  }\n\n  getSizeAndScale(step, realOutputSize, scale) {\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    // Use the destination canvas's size if it is bigger than the hard-coded\n    // limit of MAX_PATTERN_SIZE to avoid clipping patterns that cover the\n    // whole canvas.\n    const maxSize = Math.max(TilingPattern.MAX_PATTERN_SIZE, realOutputSize);\n    let size = Math.ceil(step * scale);\n    if (size >= maxSize) {\n      size = maxSize;\n    } else {\n      scale = size / step;\n    }\n    return { scale, size };\n  }\n\n  clipBbox(graphics, x0, y0, x1, y1) {\n    const bboxWidth = x1 - x0;\n    const bboxHeight = y1 - y0;\n    graphics.ctx.rect(x0, y0, bboxWidth, bboxHeight);\n    Util.axialAlignedBoundingBox(\n      [x0, y0, x1, y1],\n      getCurrentTransform(graphics.ctx),\n      graphics.current.minMax\n    );\n    graphics.clip();\n    graphics.endPath();\n  }\n\n  setFillAndStrokeStyleToContext(graphics, paintType, color) {\n    const context = graphics.ctx,\n      current = graphics.current;\n    switch (paintType) {\n      case PaintType.COLORED:\n        const { fillStyle, strokeStyle } = this.ctx;\n        context.fillStyle = current.fillColor = fillStyle;\n        context.strokeStyle = current.strokeColor = strokeStyle;\n        break;\n      case PaintType.UNCOLORED:\n        context.fillStyle = context.strokeStyle = color;\n        // Set color needed by image masks (fixes issues 3226 and 8741).\n        current.fillColor = current.strokeColor = color;\n        break;\n      default:\n        throw new FormatError(`Unsupported paint type: ${paintType}`);\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern(ctx, owner, inverse, pathType, opIdx) {\n    // PDF spec 8.7.2 NOTE 1: pattern's matrix is relative to initial matrix.\n    let matrix = inverse;\n    if (pathType !== PathType.SHADING) {\n      matrix = Util.transform(matrix, owner.baseTransform);\n      if (this.matrix) {\n        matrix = Util.transform(matrix, this.matrix);\n      }\n    }\n\n    const temporaryPatternCanvas = this.createPatternCanvas(owner, opIdx);\n\n    let domMatrix = new DOMMatrix(matrix);\n    // Rescale and so that the ctx.createPattern call generates a pattern with\n    // the desired size.\n    domMatrix = domMatrix.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    domMatrix = domMatrix.scale(\n      1 / temporaryPatternCanvas.scaleX,\n      1 / temporaryPatternCanvas.scaleY\n    );\n\n    const pattern = ctx.createPattern(temporaryPatternCanvas.canvas, \"repeat\");\n    pattern.setTransform(domMatrix);\n\n    return pattern;\n  }\n}\n\nexport { getShadingPattern, PathType, TilingPattern };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FeatureTest, ImageKind } from \"./util.js\";\n\nfunction convertToRGBA(params) {\n  switch (params.kind) {\n    case ImageKind.GRAYSCALE_1BPP:\n      return convertBlackAndWhiteToRGBA(params);\n    case ImageKind.RGB_24BPP:\n      return convertRGBToRGBA(params);\n  }\n\n  return null;\n}\n\nfunction convertBlackAndWhiteToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  width,\n  height,\n  nonBlackColor = 0xffffffff,\n  inverseDecode = false,\n}) {\n  const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n  const [zeroMapping, oneMapping] = inverseDecode\n    ? [nonBlackColor, black]\n    : [black, nonBlackColor];\n  const widthInSource = width >> 3;\n  const widthRemainder = width & 7;\n  const srcLength = src.length;\n  dest = new Uint32Array(dest.buffer);\n  let destPos = 0;\n\n  for (let i = 0; i < height; i++) {\n    for (const max = srcPos + widthInSource; srcPos < max; srcPos++) {\n      const elem = srcPos < srcLength ? src[srcPos] : 255;\n      dest[destPos++] = elem & 0b10000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1 ? oneMapping : zeroMapping;\n    }\n    if (widthRemainder === 0) {\n      continue;\n    }\n    const elem = srcPos < srcLength ? src[srcPos++] : 255;\n    for (let j = 0; j < widthRemainder; j++) {\n      dest[destPos++] = elem & (1 << (7 - j)) ? oneMapping : zeroMapping;\n    }\n  }\n  return { srcPos, destPos };\n}\n\nfunction convertRGBToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  destPos = 0,\n  width,\n  height,\n}) {\n  let i = 0;\n  const len = width * height * 3;\n  const len32 = len >> 2;\n  const src32 = new Uint32Array(src.buffer, srcPos, len32);\n\n  if (FeatureTest.isLittleEndian) {\n    // It's a way faster to do the shuffle manually instead of working\n    // component by component with some Uint8 arrays.\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R2B1G1R1\n      const s2 = src32[i + 1]; // G3R3B2G2\n      const s3 = src32[i + 2]; // B4G4R4B3\n\n      dest[destPos] = s1 | 0xff000000;\n      dest[destPos + 1] = (s1 >>> 24) | (s2 << 8) | 0xff000000;\n      dest[destPos + 2] = (s2 >>> 16) | (s3 << 16) | 0xff000000;\n      dest[destPos + 3] = (s3 >>> 8) | 0xff000000;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        src[j] | (src[j + 1] << 8) | (src[j + 2] << 16) | 0xff000000;\n    }\n  } else {\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R1G1B1R2\n      const s2 = src32[i + 1]; // G2B2R3G3\n      const s3 = src32[i + 2]; // B3R4G4B4\n\n      dest[destPos] = s1 | 0xff;\n      dest[destPos + 1] = (s1 << 24) | (s2 >>> 8) | 0xff;\n      dest[destPos + 2] = (s2 << 16) | (s3 >>> 16) | 0xff;\n      dest[destPos + 3] = (s3 << 8) | 0xff;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        (src[j] << 24) | (src[j + 1] << 16) | (src[j + 2] << 8) | 0xff;\n    }\n  }\n\n  return { srcPos: srcPos + len, destPos };\n}\n\nfunction grayToRGBA(src, dest) {\n  if (FeatureTest.isLittleEndian) {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x10101) | 0xff000000;\n    }\n  } else {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x1010100) | 0x000000ff;\n    }\n  }\n}\n\nexport { convertBlackAndWhiteToRGBA, convertToRGBA, grayToRGBA };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CanvasNestedDependencyTracker,\n  Dependencies,\n} from \"./canvas_dependency_tracker.js\";\nimport {\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  OPS,\n  shadow,\n  TextRenderingMode,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  makePathFromDrawOPS,\n  OutputScale,\n  PixelsPerInch,\n} from \"./display_utils.js\";\nimport {\n  getShadingPattern,\n  PathType,\n  TilingPattern,\n} from \"./pattern_helper.js\";\nimport { convertBlackAndWhiteToRGBA } from \"../shared/image_utils.js\";\n\n// <canvas> contexts store most of the state we need natively.\n// However, PDF needs a bit more state, which we store here.\n// Minimal font size that would be used during canvas fillText operations.\nconst MIN_FONT_SIZE = 16;\n// Maximum font size that would be used during canvas fillText operations.\nconst MAX_FONT_SIZE = 100;\n\n// Defines the time the `executeOperatorList`-method is going to be executing\n// before it stops and schedules a continue of execution.\nconst EXECUTION_TIME = 15; // ms\n// Defines the number of steps before checking the execution time.\nconst EXECUTION_STEPS = 10;\n\nconst FULL_CHUNK_HEIGHT = 16;\n\n// Only used in rescaleAndStroke. The goal is to avoid\n// creating a new DOMMatrix object each time we need it.\nconst SCALE_MATRIX = new DOMMatrix();\n\n// Used to get some coordinates.\nconst XY = new Float32Array(2);\n\n// Initial rectangle values for the minMax array.\nconst MIN_MAX_INIT = new Float32Array([\n  Infinity,\n  Infinity,\n  -Infinity,\n  -Infinity,\n]);\n\n/**\n * Overrides certain methods on a 2d ctx so that when they are called they\n * will also call the same method on the destCtx. The methods that are\n * overridden are all the transformation state modifiers, path creation, and\n * save/restore. We only forward these specific methods because they are the\n * only state modifiers that we cannot copy over when we switch contexts.\n *\n * To remove mirroring call `ctx._removeMirroring()`.\n *\n * @param {Object} ctx - The 2d canvas context that will duplicate its calls on\n *   the destCtx.\n * @param {Object} destCtx - The 2d canvas context that will receive the\n *   forwarded calls.\n */\nfunction mirrorContextOperations(ctx, destCtx) {\n  if (ctx._removeMirroring) {\n    throw new Error(\"Context is already forwarding operations.\");\n  }\n  ctx.__originalSave = ctx.save;\n  ctx.__originalRestore = ctx.restore;\n  ctx.__originalRotate = ctx.rotate;\n  ctx.__originalScale = ctx.scale;\n  ctx.__originalTranslate = ctx.translate;\n  ctx.__originalTransform = ctx.transform;\n  ctx.__originalSetTransform = ctx.setTransform;\n  ctx.__originalResetTransform = ctx.resetTransform;\n  ctx.__originalClip = ctx.clip;\n  ctx.__originalMoveTo = ctx.moveTo;\n  ctx.__originalLineTo = ctx.lineTo;\n  ctx.__originalBezierCurveTo = ctx.bezierCurveTo;\n  ctx.__originalRect = ctx.rect;\n  ctx.__originalClosePath = ctx.closePath;\n  ctx.__originalBeginPath = ctx.beginPath;\n\n  ctx._removeMirroring = () => {\n    ctx.save = ctx.__originalSave;\n    ctx.restore = ctx.__originalRestore;\n    ctx.rotate = ctx.__originalRotate;\n    ctx.scale = ctx.__originalScale;\n    ctx.translate = ctx.__originalTranslate;\n    ctx.transform = ctx.__originalTransform;\n    ctx.setTransform = ctx.__originalSetTransform;\n    ctx.resetTransform = ctx.__originalResetTransform;\n\n    ctx.clip = ctx.__originalClip;\n    ctx.moveTo = ctx.__originalMoveTo;\n    ctx.lineTo = ctx.__originalLineTo;\n    ctx.bezierCurveTo = ctx.__originalBezierCurveTo;\n    ctx.rect = ctx.__originalRect;\n    ctx.closePath = ctx.__originalClosePath;\n    ctx.beginPath = ctx.__originalBeginPath;\n    delete ctx._removeMirroring;\n  };\n\n  ctx.save = function () {\n    destCtx.save();\n    this.__originalSave();\n  };\n\n  ctx.restore = function () {\n    destCtx.restore();\n    this.__originalRestore();\n  };\n\n  ctx.translate = function (x, y) {\n    destCtx.translate(x, y);\n    this.__originalTranslate(x, y);\n  };\n\n  ctx.scale = function (x, y) {\n    destCtx.scale(x, y);\n    this.__originalScale(x, y);\n  };\n\n  ctx.transform = function (a, b, c, d, e, f) {\n    destCtx.transform(a, b, c, d, e, f);\n    this.__originalTransform(a, b, c, d, e, f);\n  };\n\n  ctx.setTransform = function (a, b, c, d, e, f) {\n    destCtx.setTransform(a, b, c, d, e, f);\n    this.__originalSetTransform(a, b, c, d, e, f);\n  };\n\n  ctx.resetTransform = function () {\n    destCtx.resetTransform();\n    this.__originalResetTransform();\n  };\n\n  ctx.rotate = function (angle) {\n    destCtx.rotate(angle);\n    this.__originalRotate(angle);\n  };\n\n  ctx.clip = function (rule) {\n    destCtx.clip(rule);\n    this.__originalClip(rule);\n  };\n\n  ctx.moveTo = function (x, y) {\n    destCtx.moveTo(x, y);\n    this.__originalMoveTo(x, y);\n  };\n\n  ctx.lineTo = function (x, y) {\n    destCtx.lineTo(x, y);\n    this.__originalLineTo(x, y);\n  };\n\n  ctx.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n    destCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    this.__originalBezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  };\n\n  ctx.rect = function (x, y, width, height) {\n    destCtx.rect(x, y, width, height);\n    this.__originalRect(x, y, width, height);\n  };\n\n  ctx.closePath = function () {\n    destCtx.closePath();\n    this.__originalClosePath();\n  };\n\n  ctx.beginPath = function () {\n    destCtx.beginPath();\n    this.__originalBeginPath();\n  };\n}\n\nclass CachedCanvases {\n  constructor(canvasFactory) {\n    this.canvasFactory = canvasFactory;\n    this.cache = Object.create(null);\n  }\n\n  getCanvas(id, width, height) {\n    let canvasEntry;\n    if (this.cache[id] !== undefined) {\n      canvasEntry = this.cache[id];\n      this.canvasFactory.reset(canvasEntry, width, height);\n    } else {\n      canvasEntry = this.canvasFactory.create(width, height);\n      this.cache[id] = canvasEntry;\n    }\n    return canvasEntry;\n  }\n\n  delete(id) {\n    delete this.cache[id];\n  }\n\n  clear() {\n    for (const id in this.cache) {\n      const canvasEntry = this.cache[id];\n      this.canvasFactory.destroy(canvasEntry);\n      delete this.cache[id];\n    }\n  }\n}\n\nfunction drawImageAtIntegerCoords(\n  ctx,\n  srcImg,\n  srcX,\n  srcY,\n  srcW,\n  srcH,\n  destX,\n  destY,\n  destW,\n  destH\n) {\n  const [a, b, c, d, tx, ty] = getCurrentTransform(ctx);\n  if (b === 0 && c === 0) {\n    // top-left corner is at (X, Y) and\n    // bottom-right one is at (X + width, Y + height).\n\n    // If leftX is 4.321 then it's rounded to 4.\n    // If width is 10.432 then it's rounded to 11 because\n    // rightX = leftX + width = 14.753 which is rounded to 15\n    // so after rounding the total width is 11 (15 - 4).\n    // It's why we can't just floor/ceil uniformly, it just depends\n    // on the values we've.\n\n    const tlX = destX * a + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destY * d + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destX + destW) * a + tx;\n\n    // Some pdf contains images with 1x1 images so in case of 0-width after\n    // scaling we must fallback on 1 to be sure there is something.\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destY + destH) * d + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    // We must apply a transformation in order to apply it on the image itself.\n    // For example if a == 1 && d == -1, it means that the image itself is\n    // mirrored w.r.t. the x-axis.\n    ctx.setTransform(Math.sign(a), 0, 0, Math.sign(d), rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rWidth, rHeight);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rWidth, rHeight];\n  }\n\n  if (a === 0 && d === 0) {\n    // This path is taken in issue9462.pdf (page 3).\n    const tlX = destY * c + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destX * b + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destY + destH) * c + tx;\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destX + destW) * b + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    ctx.setTransform(0, Math.sign(b), Math.sign(c), 0, rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rHeight, rWidth);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rHeight, rWidth];\n  }\n\n  // Not a scale matrix so let the render handle the case without rounding.\n  ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\n  const scaleX = Math.hypot(a, b);\n  const scaleY = Math.hypot(c, d);\n  return [scaleX * destW, scaleY * destH];\n}\n\nclass CanvasExtraState {\n  // Are soft masks and alpha values shapes or opacities?\n  alphaIsShape = false;\n\n  fontSize = 0;\n\n  fontSizeScale = 1;\n\n  textMatrix = null;\n\n  textMatrixScale = 1;\n\n  fontMatrix = FONT_IDENTITY_MATRIX;\n\n  leading = 0;\n\n  // Current point (in user coordinates)\n  x = 0;\n\n  y = 0;\n\n  // Start of text line (in text coordinates)\n  lineX = 0;\n\n  lineY = 0;\n\n  // Character and word spacing\n  charSpacing = 0;\n\n  wordSpacing = 0;\n\n  textHScale = 1;\n\n  textRenderingMode = TextRenderingMode.FILL;\n\n  textRise = 0;\n\n  // Default fore and background colors\n  fillColor = \"#000000\";\n\n  strokeColor = \"#000000\";\n\n  patternFill = false;\n\n  patternStroke = false;\n\n  // Note: fill alpha applies to all non-stroking operations\n  fillAlpha = 1;\n\n  strokeAlpha = 1;\n\n  lineWidth = 1;\n\n  activeSMask = null;\n\n  transferMaps = \"none\";\n\n  constructor(width, height, preInit) {\n    preInit?.(this);\n\n    this.clipBox = new Float32Array([0, 0, width, height]);\n    this.minMax = MIN_MAX_INIT.slice();\n  }\n\n  clone() {\n    const clone = Object.create(this);\n    clone.clipBox = this.clipBox.slice();\n    clone.minMax = this.minMax.slice();\n    return clone;\n  }\n\n  getPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    const box = this.minMax.slice();\n    if (pathType === PathType.STROKE) {\n      if (!transform) {\n        unreachable(\"Stroke bounding box must include transform.\");\n      }\n      // Stroked paths can be outside of the path bounding box by 1/2 the line\n      // width.\n      Util.singularValueDecompose2dScale(transform, XY);\n      const xStrokePad = (XY[0] * this.lineWidth) / 2;\n      const yStrokePad = (XY[1] * this.lineWidth) / 2;\n      box[0] -= xStrokePad;\n      box[1] -= yStrokePad;\n      box[2] += xStrokePad;\n      box[3] += yStrokePad;\n    }\n    return box;\n  }\n\n  updateClipFromPath() {\n    const intersect = Util.intersect(this.clipBox, this.getPathBoundingBox());\n    this.startNewPathAndClipBox(intersect || [0, 0, 0, 0]);\n  }\n\n  isEmptyClip() {\n    return this.minMax[0] === Infinity;\n  }\n\n  startNewPathAndClipBox(box) {\n    this.clipBox.set(box, 0);\n    this.minMax.set(MIN_MAX_INIT, 0);\n  }\n\n  getClippedPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    return Util.intersect(\n      this.clipBox,\n      this.getPathBoundingBox(pathType, transform)\n    );\n  }\n}\n\nfunction putBinaryImageData(ctx, imgData) {\n  if (imgData instanceof ImageData) {\n    ctx.putImageData(imgData, 0, 0);\n    return;\n  }\n\n  // Put the image data to the canvas in chunks, rather than putting the\n  // whole image at once.  This saves JS memory, because the ImageData object\n  // is smaller. It also possibly saves C++ memory within the implementation\n  // of putImageData(). (E.g. in Firefox we make two short-lived copies of\n  // the data passed to putImageData()). |n| shouldn't be too small, however,\n  // because too many putImageData() calls will slow things down.\n  //\n  // Note: as written, if the last chunk is partial, the putImageData() call\n  // will (conceptually) put pixels past the bounds of the canvas.  But\n  // that's ok; any such pixels are ignored.\n\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0,\n    destPos;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n  let i, j, thisChunkHeight, elemsInThisChunk;\n\n  // There are multiple forms in which the pixel data can be passed, and\n  // imgData.kind tells us which one this is.\n  if (imgData.kind === ImageKind.GRAYSCALE_1BPP) {\n    // Grayscale, 1 bit per pixel (i.e. black-and-white).\n    const srcLength = src.byteLength;\n    const dest32 = new Uint32Array(dest.buffer, 0, dest.byteLength >> 2);\n    const dest32DataLength = dest32.length;\n    const fullSrcDiff = (width + 7) >> 3;\n    const white = 0xffffffff;\n    const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n\n    for (i = 0; i < totalChunks; i++) {\n      thisChunkHeight = i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n      destPos = 0;\n      for (j = 0; j < thisChunkHeight; j++) {\n        const srcDiff = srcLength - srcPos;\n        let k = 0;\n        const kEnd = srcDiff > fullSrcDiff ? width : srcDiff * 8 - 7;\n        const kEndUnrolled = kEnd & ~7;\n        let mask = 0;\n        let srcByte = 0;\n        for (; k < kEndUnrolled; k += 8) {\n          srcByte = src[srcPos++];\n          dest32[destPos++] = srcByte & 128 ? white : black;\n          dest32[destPos++] = srcByte & 64 ? white : black;\n          dest32[destPos++] = srcByte & 32 ? white : black;\n          dest32[destPos++] = srcByte & 16 ? white : black;\n          dest32[destPos++] = srcByte & 8 ? white : black;\n          dest32[destPos++] = srcByte & 4 ? white : black;\n          dest32[destPos++] = srcByte & 2 ? white : black;\n          dest32[destPos++] = srcByte & 1 ? white : black;\n        }\n        for (; k < kEnd; k++) {\n          if (mask === 0) {\n            srcByte = src[srcPos++];\n            mask = 128;\n          }\n\n          dest32[destPos++] = srcByte & mask ? white : black;\n          mask >>= 1;\n        }\n      }\n      // We ran out of input. Make all remaining pixels transparent.\n      while (destPos < dest32DataLength) {\n        dest32[destPos++] = 0;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else if (imgData.kind === ImageKind.RGBA_32BPP) {\n    // RGBA, 32-bits per pixel.\n    j = 0;\n    elemsInThisChunk = width * FULL_CHUNK_HEIGHT * 4;\n    for (i = 0; i < fullChunks; i++) {\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n      srcPos += elemsInThisChunk;\n\n      ctx.putImageData(chunkImgData, 0, j);\n      j += FULL_CHUNK_HEIGHT;\n    }\n    if (i < totalChunks) {\n      elemsInThisChunk = width * partialChunkHeight * 4;\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n\n      ctx.putImageData(chunkImgData, 0, j);\n    }\n  } else if (imgData.kind === ImageKind.RGB_24BPP) {\n    // RGB, 24-bits per pixel.\n    thisChunkHeight = FULL_CHUNK_HEIGHT;\n    elemsInThisChunk = width * thisChunkHeight;\n    for (i = 0; i < totalChunks; i++) {\n      if (i >= fullChunks) {\n        thisChunkHeight = partialChunkHeight;\n        elemsInThisChunk = width * thisChunkHeight;\n      }\n\n      destPos = 0;\n      for (j = elemsInThisChunk; j--; ) {\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = 255;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else {\n    throw new Error(`bad image kind: ${imgData.kind}`);\n  }\n}\n\nfunction putBinaryImageMask(ctx, imgData) {\n  if (imgData.bitmap) {\n    // The bitmap has been created in the worker.\n    ctx.drawImage(imgData.bitmap, 0, 0);\n    return;\n  }\n\n  // Slow path: OffscreenCanvas isn't available in the worker.\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n\n  for (let i = 0; i < totalChunks; i++) {\n    const thisChunkHeight =\n      i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n\n    // Expand the mask so it can be used by the canvas.  Any required\n    // inversion has already been handled.\n\n    ({ srcPos } = convertBlackAndWhiteToRGBA({\n      src,\n      srcPos,\n      dest,\n      width,\n      height: thisChunkHeight,\n      nonBlackColor: 0,\n    }));\n\n    ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n  }\n}\n\nfunction copyCtxState(sourceCtx, destCtx) {\n  const properties = [\n    \"strokeStyle\",\n    \"fillStyle\",\n    \"fillRule\",\n    \"globalAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"globalCompositeOperation\",\n    \"font\",\n    \"filter\",\n  ];\n  for (const property of properties) {\n    if (sourceCtx[property] !== undefined) {\n      destCtx[property] = sourceCtx[property];\n    }\n  }\n  if (sourceCtx.setLineDash !== undefined) {\n    destCtx.setLineDash(sourceCtx.getLineDash());\n    destCtx.lineDashOffset = sourceCtx.lineDashOffset;\n  }\n}\n\nfunction resetCtxToDefault(ctx) {\n  ctx.strokeStyle = ctx.fillStyle = \"#000000\";\n  ctx.fillRule = \"nonzero\";\n  ctx.globalAlpha = 1;\n  ctx.lineWidth = 1;\n  ctx.lineCap = \"butt\";\n  ctx.lineJoin = \"miter\";\n  ctx.miterLimit = 10;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.font = \"10px sans-serif\";\n  if (ctx.setLineDash !== undefined) {\n    ctx.setLineDash([]);\n    ctx.lineDashOffset = 0;\n  }\n  const { filter } = ctx;\n  if (filter !== \"none\" && filter !== \"\") {\n    ctx.filter = \"none\";\n  }\n}\n\nfunction getImageSmoothingEnabled(transform, interpolate) {\n  // In section 8.9.5.3 of the PDF spec, it's mentioned that the interpolate\n  // flag should be used when the image is upscaled.\n  // In Firefox, smoothing is always used when downscaling images (bug 1360415).\n\n  if (interpolate) {\n    return true;\n  }\n\n  Util.singularValueDecompose2dScale(transform, XY);\n  // Round to a 32bit float so that `<=` check below will pass for numbers that\n  // are very close, but not exactly the same 64bit floats.\n  const actualScale = Math.fround(\n    OutputScale.pixelRatio * PixelsPerInch.PDF_TO_CSS_UNITS\n  );\n  // `XY` is a Float32Array.\n  return XY[0] <= actualScale && XY[1] <= actualScale;\n}\n\nconst LINE_CAP_STYLES = [\"butt\", \"round\", \"square\"];\nconst LINE_JOIN_STYLES = [\"miter\", \"round\", \"bevel\"];\nconst NORMAL_CLIP = {};\nconst EO_CLIP = {};\n\nclass CanvasGraphics {\n  constructor(\n    canvasCtx,\n    commonObjs,\n    objs,\n    canvasFactory,\n    filterFactory,\n    { optionalContentConfig, markedContentStack = null },\n    annotationCanvasMap,\n    pageColors,\n    dependencyTracker\n  ) {\n    this.ctx = canvasCtx;\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n    this.stateStack = [];\n    this.pendingClip = null;\n    this.pendingEOFill = false;\n    this.res = null;\n    this.xobjs = null;\n    this.commonObjs = commonObjs;\n    this.objs = objs;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this.groupStack = [];\n    // Patterns are painted relative to the initial page/form transform, see\n    // PDF spec 8.7.2 NOTE 1.\n    this.baseTransform = null;\n    this.baseTransformStack = [];\n    this.groupLevel = 0;\n    this.smaskStack = [];\n    this.smaskCounter = 0;\n    this.tempSMask = null;\n    this.suspendedCtx = null;\n    this.contentVisible = true;\n    this.markedContentStack = markedContentStack || [];\n    this.optionalContentConfig = optionalContentConfig;\n    this.cachedCanvases = new CachedCanvases(this.canvasFactory);\n    this.cachedPatterns = new Map();\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.viewportScale = 1;\n    this.outputScaleX = 1;\n    this.outputScaleY = 1;\n    this.pageColors = pageColors;\n\n    this._cachedScaleForStroking = [-1, 0];\n    this._cachedGetSinglePixelWidth = null;\n    this._cachedBitmapsMap = new Map();\n\n    this.dependencyTracker = dependencyTracker ?? null;\n  }\n\n  getObject(opIdx, data, fallback = null) {\n    if (typeof data === \"string\") {\n      this.dependencyTracker?.recordNamedDependency(opIdx, data);\n      return data.startsWith(\"g_\")\n        ? this.commonObjs.get(data)\n        : this.objs.get(data);\n    }\n    return fallback;\n  }\n\n  beginDrawing({\n    transform,\n    viewport,\n    transparency = false,\n    background = null,\n  }) {\n    // For pdfs that use blend modes we have to clear the canvas else certain\n    // blend modes can look wrong since we'd be blending with a white\n    // backdrop. The problem with a transparent backdrop though is we then\n    // don't get sub pixel anti aliasing on text, creating temporary\n    // transparent canvas when we have blend modes.\n    const width = this.ctx.canvas.width;\n    const height = this.ctx.canvas.height;\n\n    const savedFillStyle = this.ctx.fillStyle;\n    this.ctx.fillStyle = background || \"#ffffff\";\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.fillStyle = savedFillStyle;\n\n    if (transparency) {\n      const transparentCanvas = this.cachedCanvases.getCanvas(\n        \"transparent\",\n        width,\n        height\n      );\n      this.compositeCtx = this.ctx;\n      this.transparentCanvas = transparentCanvas.canvas;\n      this.ctx = transparentCanvas.context;\n      this.ctx.save();\n      // The transform can be applied before rendering, transferring it to\n      // the new canvas.\n      this.ctx.transform(...getCurrentTransform(this.compositeCtx));\n    }\n\n    this.ctx.save();\n    resetCtxToDefault(this.ctx);\n    if (transform) {\n      this.ctx.transform(...transform);\n      this.outputScaleX = transform[0];\n      this.outputScaleY = transform[0];\n    }\n    this.ctx.transform(...viewport.transform);\n    this.viewportScale = viewport.scale;\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n  }\n\n  executeOperatorList(\n    operatorList,\n    executionStartIdx,\n    continueCallback,\n    stepper,\n    operationsFilter\n  ) {\n    const argsArray = operatorList.argsArray;\n    const fnArray = operatorList.fnArray;\n    let i = executionStartIdx || 0;\n    const argsArrayLen = argsArray.length;\n\n    // Sometimes the OperatorList to execute is empty.\n    if (argsArrayLen === i) {\n      return i;\n    }\n\n    const chunkOperations =\n      argsArrayLen - i > EXECUTION_STEPS &&\n      typeof continueCallback === \"function\";\n    const endTime = chunkOperations ? Date.now() + EXECUTION_TIME : 0;\n    let steps = 0;\n\n    const commonObjs = this.commonObjs;\n    const objs = this.objs;\n    let fnId, fnArgs;\n\n    while (true) {\n      if (stepper !== undefined && i === stepper.nextBreakPoint) {\n        stepper.breakIt(i, continueCallback);\n        return i;\n      }\n\n      if (!operationsFilter || operationsFilter(i)) {\n        fnId = fnArray[i];\n        // TODO: There is a `undefined` coming from somewhere.\n        fnArgs = argsArray[i] ?? null;\n\n        if (fnId !== OPS.dependency) {\n          if (fnArgs === null) {\n            this[fnId](i);\n          } else {\n            this[fnId](i, ...fnArgs);\n          }\n        } else {\n          for (const depObjId of fnArgs) {\n            this.dependencyTracker?.recordNamedData(depObjId, i);\n            const objsPool = depObjId.startsWith(\"g_\") ? commonObjs : objs;\n\n            // If the promise isn't resolved yet, add the continueCallback\n            // to the promise and bail out.\n            if (!objsPool.has(depObjId)) {\n              objsPool.get(depObjId, continueCallback);\n              return i;\n            }\n          }\n        }\n      }\n\n      i++;\n\n      // If the entire operatorList was executed, stop as were done.\n      if (i === argsArrayLen) {\n        return i;\n      }\n\n      // If the execution took longer then a certain amount of time and\n      // `continueCallback` is specified, interrupt the execution.\n      if (chunkOperations && ++steps > EXECUTION_STEPS) {\n        if (Date.now() > endTime) {\n          continueCallback();\n          return i;\n        }\n        steps = 0;\n      }\n\n      // If the operatorList isn't executed completely yet OR the execution\n      // time was short enough, do another execution round.\n    }\n  }\n\n  #restoreInitialState() {\n    // Finishing all opened operations such as SMask group painting.\n    while (this.stateStack.length || this.inSMaskMode) {\n      this.restore();\n    }\n\n    this.current.activeSMask = null;\n    this.ctx.restore();\n\n    if (this.transparentCanvas) {\n      this.ctx = this.compositeCtx;\n      this.ctx.save();\n      this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Avoid apply transform twice\n      this.ctx.drawImage(this.transparentCanvas, 0, 0);\n      this.ctx.restore();\n      this.transparentCanvas = null;\n    }\n  }\n\n  endDrawing() {\n    this.#restoreInitialState();\n\n    this.cachedCanvases.clear();\n    this.cachedPatterns.clear();\n\n    for (const cache of this._cachedBitmapsMap.values()) {\n      for (const canvas of cache.values()) {\n        if (\n          typeof HTMLCanvasElement !== \"undefined\" &&\n          canvas instanceof HTMLCanvasElement\n        ) {\n          canvas.width = canvas.height = 0;\n        }\n      }\n      cache.clear();\n    }\n    this._cachedBitmapsMap.clear();\n    this.#drawFilter();\n  }\n\n  #drawFilter() {\n    if (this.pageColors) {\n      const hcmFilterId = this.filterFactory.addHCMFilter(\n        this.pageColors.foreground,\n        this.pageColors.background\n      );\n      if (hcmFilterId !== \"none\") {\n        const savedFilter = this.ctx.filter;\n        this.ctx.filter = hcmFilterId;\n        this.ctx.drawImage(this.ctx.canvas, 0, 0);\n        this.ctx.filter = savedFilter;\n      }\n    }\n  }\n\n  _scaleImage(img, inverseTransform) {\n    // Vertical or horizontal scaling shall not be more than 2 to not lose the\n    // pixels during drawImage operation, painting on the temporary canvas(es)\n    // that are twice smaller in size.\n\n    // displayWidth and displayHeight are used for VideoFrame.\n    const width = img.width ?? img.displayWidth;\n    const height = img.height ?? img.displayHeight;\n    let widthScale = Math.max(\n      Math.hypot(inverseTransform[0], inverseTransform[1]),\n      1\n    );\n    let heightScale = Math.max(\n      Math.hypot(inverseTransform[2], inverseTransform[3]),\n      1\n    );\n\n    let paintWidth = width,\n      paintHeight = height;\n    let tmpCanvasId = \"prescale1\";\n    let tmpCanvas, tmpCtx;\n    while (\n      (widthScale > 2 && paintWidth > 1) ||\n      (heightScale > 2 && paintHeight > 1)\n    ) {\n      let newWidth = paintWidth,\n        newHeight = paintHeight;\n      if (widthScale > 2 && paintWidth > 1) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(paintWidth / 2);\n        newWidth =\n          paintWidth >= 16384\n            ? Math.floor(paintWidth / 2) - 1 || 1\n            : Math.ceil(paintWidth / 2);\n        widthScale /= paintWidth / newWidth;\n      }\n      if (heightScale > 2 && paintHeight > 1) {\n        // TODO: see the comment above.\n        newHeight =\n          paintHeight >= 16384\n            ? Math.floor(paintHeight / 2) - 1 || 1\n            : Math.ceil(paintHeight) / 2;\n        heightScale /= paintHeight / newHeight;\n      }\n      tmpCanvas = this.cachedCanvases.getCanvas(\n        tmpCanvasId,\n        newWidth,\n        newHeight\n      );\n      tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, newWidth, newHeight);\n      tmpCtx.drawImage(\n        img,\n        0,\n        0,\n        paintWidth,\n        paintHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      img = tmpCanvas.canvas;\n      paintWidth = newWidth;\n      paintHeight = newHeight;\n      tmpCanvasId = tmpCanvasId === \"prescale1\" ? \"prescale2\" : \"prescale1\";\n    }\n    return {\n      img,\n      paintWidth,\n      paintHeight,\n    };\n  }\n\n  _createMaskCanvas(opIdx, img) {\n    const ctx = this.ctx;\n    const { width, height } = img;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    const currentTransform = getCurrentTransform(ctx);\n\n    let cache, cacheKey, scaled, maskCanvas;\n    if ((img.bitmap || img.data) && img.count > 1) {\n      const mainKey = img.bitmap || img.data.buffer;\n      // We're reusing the same image several times, so we can cache it.\n      // In case we've a pattern fill we just keep the scaled version of\n      // the image.\n      // Only the scaling part matters, the translation part is just used\n      // to compute offsets (but not when filling patterns see #15573).\n      // TODO: handle the case of a pattern fill if it's possible.\n      cacheKey = JSON.stringify(\n        isPatternFill\n          ? currentTransform\n          : [currentTransform.slice(0, 4), fillColor]\n      );\n\n      cache = this._cachedBitmapsMap.get(mainKey);\n      if (!cache) {\n        cache = new Map();\n        this._cachedBitmapsMap.set(mainKey, cache);\n      }\n      const cachedImage = cache.get(cacheKey);\n      if (cachedImage && !isPatternFill) {\n        const offsetX = Math.round(\n          Math.min(currentTransform[0], currentTransform[2]) +\n            currentTransform[4]\n        );\n        const offsetY = Math.round(\n          Math.min(currentTransform[1], currentTransform[3]) +\n            currentTransform[5]\n        );\n\n        this.dependencyTracker?.recordDependencies(\n          opIdx,\n          Dependencies.transformAndFill\n        );\n        return {\n          canvas: cachedImage,\n          offsetX,\n          offsetY,\n        };\n      }\n      scaled = cachedImage;\n    }\n\n    if (!scaled) {\n      maskCanvas = this.cachedCanvases.getCanvas(\"maskCanvas\", width, height);\n      putBinaryImageMask(maskCanvas.context, img);\n    }\n\n    // Create the mask canvas at the size it will be drawn at and also set\n    // its transform to match the current transform so if there are any\n    // patterns applied they will be applied relative to the correct\n    // transform.\n\n    let maskToCanvas = Util.transform(currentTransform, [\n      1 / width,\n      0,\n      0,\n      -1 / height,\n      0,\n      0,\n    ]);\n    maskToCanvas = Util.transform(maskToCanvas, [1, 0, 0, 1, 0, -height]);\n    const minMax = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox([0, 0, width, height], maskToCanvas, minMax);\n    const [minX, minY, maxX, maxY] = minMax;\n    const drawnWidth = Math.round(maxX - minX) || 1;\n    const drawnHeight = Math.round(maxY - minY) || 1;\n    const fillCanvas = this.cachedCanvases.getCanvas(\n      \"fillCanvas\",\n      drawnWidth,\n      drawnHeight\n    );\n    const fillCtx = fillCanvas.context;\n\n    // The offset will be the top-left coordinate mask.\n    // If objToCanvas is [a,b,c,d,e,f] then:\n    //   - offsetX = min(a, c) + e\n    //   - offsetY = min(b, d) + f\n    const offsetX = minX;\n    const offsetY = minY;\n    fillCtx.translate(-offsetX, -offsetY);\n    fillCtx.transform(...maskToCanvas);\n\n    if (!scaled) {\n      // Pre-scale if needed to improve image smoothing.\n      scaled = this._scaleImage(\n        maskCanvas.canvas,\n        getCurrentTransformInverse(fillCtx)\n      );\n      scaled = scaled.img;\n      if (cache && isPatternFill) {\n        cache.set(cacheKey, scaled);\n      }\n    }\n\n    fillCtx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(fillCtx),\n      img.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      fillCtx,\n      scaled,\n      0,\n      0,\n      scaled.width,\n      scaled.height,\n      0,\n      0,\n      width,\n      height\n    );\n    fillCtx.globalCompositeOperation = \"source-in\";\n\n    const inverse = Util.transform(getCurrentTransformInverse(fillCtx), [\n      1,\n      0,\n      0,\n      1,\n      -offsetX,\n      -offsetY,\n    ]);\n    fillCtx.fillStyle = isPatternFill\n      ? fillColor.getPattern(ctx, this, inverse, PathType.FILL, opIdx)\n      : fillColor;\n\n    fillCtx.fillRect(0, 0, width, height);\n\n    if (cache && !isPatternFill) {\n      // The fill canvas is put in the cache associated to the mask image\n      // so we must remove from the cached canvas: it mustn't be used again.\n      this.cachedCanvases.delete(\"fillCanvas\");\n      cache.set(cacheKey, fillCanvas.canvas);\n    }\n\n    this.dependencyTracker?.recordDependencies(\n      opIdx,\n      Dependencies.transformAndFill\n    );\n\n    // Round the offsets to avoid drawing fractional pixels.\n    return {\n      canvas: fillCanvas.canvas,\n      offsetX: Math.round(offsetX),\n      offsetY: Math.round(offsetY),\n    };\n  }\n\n  // Graphics state\n  setLineWidth(opIdx, width) {\n    this.dependencyTracker?.recordSimpleData(\"lineWidth\", opIdx);\n    if (width !== this.current.lineWidth) {\n      this._cachedScaleForStroking[0] = -1;\n    }\n    this.current.lineWidth = width;\n    this.ctx.lineWidth = width;\n  }\n\n  setLineCap(opIdx, style) {\n    this.dependencyTracker?.recordSimpleData(\"lineCap\", opIdx);\n    this.ctx.lineCap = LINE_CAP_STYLES[style];\n  }\n\n  setLineJoin(opIdx, style) {\n    this.dependencyTracker?.recordSimpleData(\"lineJoin\", opIdx);\n    this.ctx.lineJoin = LINE_JOIN_STYLES[style];\n  }\n\n  setMiterLimit(opIdx, limit) {\n    this.dependencyTracker?.recordSimpleData(\"miterLimit\", opIdx);\n    this.ctx.miterLimit = limit;\n  }\n\n  setDash(opIdx, dashArray, dashPhase) {\n    this.dependencyTracker?.recordSimpleData(\"dash\", opIdx);\n    const ctx = this.ctx;\n    if (ctx.setLineDash !== undefined) {\n      ctx.setLineDash(dashArray);\n      ctx.lineDashOffset = dashPhase;\n    }\n  }\n\n  setRenderingIntent(opIdx, intent) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setFlatness(opIdx, flatness) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setGState(opIdx, states) {\n    for (const [key, value] of states) {\n      switch (key) {\n        case \"LW\":\n          this.setLineWidth(opIdx, value);\n          break;\n        case \"LC\":\n          this.setLineCap(opIdx, value);\n          break;\n        case \"LJ\":\n          this.setLineJoin(opIdx, value);\n          break;\n        case \"ML\":\n          this.setMiterLimit(opIdx, value);\n          break;\n        case \"D\":\n          this.setDash(opIdx, value[0], value[1]);\n          break;\n        case \"RI\":\n          this.setRenderingIntent(opIdx, value);\n          break;\n        case \"FL\":\n          this.setFlatness(opIdx, value);\n          break;\n        case \"Font\":\n          this.setFont(opIdx, value[0], value[1]);\n          break;\n        case \"CA\":\n          this.dependencyTracker?.recordSimpleData(\"strokeAlpha\", opIdx);\n          this.current.strokeAlpha = value;\n          break;\n        case \"ca\":\n          this.dependencyTracker?.recordSimpleData(\"fillAlpha\", opIdx);\n          this.ctx.globalAlpha = this.current.fillAlpha = value;\n          break;\n        case \"BM\":\n          this.dependencyTracker?.recordSimpleData(\n            \"globalCompositeOperation\",\n            opIdx\n          );\n          this.ctx.globalCompositeOperation = value;\n          break;\n        case \"SMask\":\n          this.dependencyTracker?.recordSimpleData(\"SMask\", opIdx);\n          this.current.activeSMask = value ? this.tempSMask : null;\n          this.tempSMask = null;\n          this.checkSMaskState();\n          break;\n        case \"TR\":\n          this.dependencyTracker?.recordSimpleData(\"filter\", opIdx);\n          this.ctx.filter = this.current.transferMaps =\n            this.filterFactory.addFilter(value);\n          break;\n      }\n    }\n  }\n\n  get inSMaskMode() {\n    return !!this.suspendedCtx;\n  }\n\n  checkSMaskState() {\n    const inSMaskMode = this.inSMaskMode;\n    if (this.current.activeSMask && !inSMaskMode) {\n      this.beginSMaskMode();\n    } else if (!this.current.activeSMask && inSMaskMode) {\n      this.endSMaskMode();\n    }\n    // Else, the state is okay and nothing needs to be done.\n  }\n\n  /**\n   * Soft mask mode takes the current main drawing canvas and replaces it with\n   * a temporary canvas. Any drawing operations that happen on the temporary\n   * canvas need to be composed with the main canvas that was suspended (see\n   * `compose()`). The temporary canvas also duplicates many of its operations\n   * on the suspended canvas to keep them in sync, so that when the soft mask\n   * mode ends any clipping paths or transformations will still be active and in\n   * the right order on the canvas' graphics state stack.\n   */\n  beginSMaskMode(opIdx) {\n    if (this.inSMaskMode) {\n      throw new Error(\"beginSMaskMode called while already in smask mode\");\n    }\n    const drawnWidth = this.ctx.canvas.width;\n    const drawnHeight = this.ctx.canvas.height;\n    const cacheId = \"smaskGroupAt\" + this.groupLevel;\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    this.suspendedCtx = this.ctx;\n    const ctx = (this.ctx = scratchCanvas.context);\n    ctx.setTransform(this.suspendedCtx.getTransform());\n    copyCtxState(this.suspendedCtx, ctx);\n    mirrorContextOperations(ctx, this.suspendedCtx);\n\n    this.setGState(opIdx, [[\"BM\", \"source-over\"]]);\n  }\n\n  endSMaskMode() {\n    if (!this.inSMaskMode) {\n      throw new Error(\"endSMaskMode called while not in smask mode\");\n    }\n    // The soft mask is done, now restore the suspended canvas as the main\n    // drawing canvas.\n    this.ctx._removeMirroring();\n    copyCtxState(this.ctx, this.suspendedCtx);\n    this.ctx = this.suspendedCtx;\n\n    this.suspendedCtx = null;\n  }\n\n  compose(dirtyBox) {\n    if (!this.current.activeSMask) {\n      return;\n    }\n\n    if (!dirtyBox) {\n      dirtyBox = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];\n    } else {\n      dirtyBox[0] = Math.floor(dirtyBox[0]);\n      dirtyBox[1] = Math.floor(dirtyBox[1]);\n      dirtyBox[2] = Math.ceil(dirtyBox[2]);\n      dirtyBox[3] = Math.ceil(dirtyBox[3]);\n    }\n    const smask = this.current.activeSMask;\n    const suspendedCtx = this.suspendedCtx;\n\n    this.composeSMask(suspendedCtx, smask, this.ctx, dirtyBox);\n    // Whatever was drawn has been moved to the suspended canvas, now clear it\n    // out of the current canvas.\n    this.ctx.save();\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.ctx.restore();\n  }\n\n  composeSMask(ctx, smask, layerCtx, layerBox) {\n    const layerOffsetX = layerBox[0];\n    const layerOffsetY = layerBox[1];\n    const layerWidth = layerBox[2] - layerOffsetX;\n    const layerHeight = layerBox[3] - layerOffsetY;\n    if (layerWidth === 0 || layerHeight === 0) {\n      return;\n    }\n    this.genericComposeSMask(\n      smask.context,\n      layerCtx,\n      layerWidth,\n      layerHeight,\n      smask.subtype,\n      smask.backdrop,\n      smask.transferMap,\n      layerOffsetX,\n      layerOffsetY,\n      smask.offsetX,\n      smask.offsetY\n    );\n    ctx.save();\n    ctx.globalAlpha = 1;\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(layerCtx.canvas, 0, 0);\n    ctx.restore();\n  }\n\n  genericComposeSMask(\n    maskCtx,\n    layerCtx,\n    width,\n    height,\n    subtype,\n    backdrop,\n    transferMap,\n    layerOffsetX,\n    layerOffsetY,\n    maskOffsetX,\n    maskOffsetY\n  ) {\n    let maskCanvas = maskCtx.canvas;\n    let maskX = layerOffsetX - maskOffsetX;\n    let maskY = layerOffsetY - maskOffsetY;\n\n    if (backdrop) {\n      if (\n        maskX < 0 ||\n        maskY < 0 ||\n        maskX + width > maskCanvas.width ||\n        maskY + height > maskCanvas.height\n      ) {\n        const canvas = this.cachedCanvases.getCanvas(\n          \"maskExtension\",\n          width,\n          height\n        );\n        const ctx = canvas.context;\n        ctx.drawImage(maskCanvas, -maskX, -maskY);\n        ctx.globalCompositeOperation = \"destination-atop\";\n        ctx.fillStyle = backdrop;\n        ctx.fillRect(0, 0, width, height);\n        ctx.globalCompositeOperation = \"source-over\";\n\n        maskCanvas = canvas.canvas;\n        maskX = maskY = 0;\n      } else {\n        maskCtx.save();\n        maskCtx.globalAlpha = 1;\n        maskCtx.setTransform(1, 0, 0, 1, 0, 0);\n        const clip = new Path2D();\n        clip.rect(maskX, maskY, width, height);\n        maskCtx.clip(clip);\n        maskCtx.globalCompositeOperation = \"destination-atop\";\n        maskCtx.fillStyle = backdrop;\n        maskCtx.fillRect(maskX, maskY, width, height);\n        maskCtx.restore();\n      }\n    }\n\n    layerCtx.save();\n    layerCtx.globalAlpha = 1;\n    layerCtx.setTransform(1, 0, 0, 1, 0, 0);\n\n    if (subtype === \"Alpha\" && transferMap) {\n      layerCtx.filter = this.filterFactory.addAlphaFilter(transferMap);\n    } else if (subtype === \"Luminosity\") {\n      layerCtx.filter = this.filterFactory.addLuminosityFilter(transferMap);\n    }\n\n    const clip = new Path2D();\n    clip.rect(layerOffsetX, layerOffsetY, width, height);\n    layerCtx.clip(clip);\n    layerCtx.globalCompositeOperation = \"destination-in\";\n    layerCtx.drawImage(\n      maskCanvas,\n      maskX,\n      maskY,\n      width,\n      height,\n      layerOffsetX,\n      layerOffsetY,\n      width,\n      height\n    );\n    layerCtx.restore();\n  }\n\n  save(opIdx) {\n    if (this.inSMaskMode) {\n      // SMask mode may be turned on/off causing us to lose graphics state.\n      // Copy the temporary canvas state to the main(suspended) canvas to keep\n      // it in sync.\n      copyCtxState(this.ctx, this.suspendedCtx);\n    }\n    this.ctx.save();\n    const old = this.current;\n    this.stateStack.push(old);\n    this.current = old.clone();\n    this.dependencyTracker?.save(opIdx);\n  }\n\n  restore(opIdx) {\n    this.dependencyTracker?.restore(opIdx);\n\n    if (this.stateStack.length === 0) {\n      if (this.inSMaskMode) {\n        this.endSMaskMode();\n      }\n      return;\n    }\n\n    this.current = this.stateStack.pop();\n    this.ctx.restore();\n    if (this.inSMaskMode) {\n      // Graphics state is stored on the main(suspended) canvas. Restore its\n      // state then copy it over to the temporary canvas.\n      copyCtxState(this.suspendedCtx, this.ctx);\n    }\n    this.checkSMaskState();\n\n    // Ensure that the clipping path is reset (fixes issue6413.pdf).\n    this.pendingClip = null;\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  transform(opIdx, a, b, c, d, e, f) {\n    this.dependencyTracker?.recordIncrementalData(\"transform\", opIdx);\n    this.ctx.transform(a, b, c, d, e, f);\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  // Path\n  constructPath(opIdx, op, data, minMax) {\n    let [path] = data;\n    if (!minMax) {\n      // The path is empty, so no need to update the current minMax.\n      path ||= data[0] = new Path2D();\n      this[op](opIdx, path);\n      return;\n    }\n\n    if (this.dependencyTracker !== null) {\n      const outerExtraSize = op === OPS.stroke ? this.current.lineWidth / 2 : 0;\n      this.dependencyTracker\n        .resetBBox(opIdx)\n        .recordBBox(\n          opIdx,\n          this.ctx,\n          minMax[0] - outerExtraSize,\n          minMax[2] + outerExtraSize,\n          minMax[1] - outerExtraSize,\n          minMax[3] + outerExtraSize\n        )\n        .recordDependencies(opIdx, [\"transform\"]);\n    }\n\n    if (!(path instanceof Path2D)) {\n      path = data[0] = makePathFromDrawOPS(path);\n    }\n    Util.axialAlignedBoundingBox(\n      minMax,\n      getCurrentTransform(this.ctx),\n      this.current.minMax\n    );\n    this[op](opIdx, path);\n\n    this._pathStartIdx = opIdx;\n  }\n\n  closePath(opIdx) {\n    this.ctx.closePath();\n  }\n\n  stroke(opIdx, path, consumePath = true) {\n    const ctx = this.ctx;\n    const strokeColor = this.current.strokeColor;\n    // For stroke we want to temporarily change the global alpha to the\n    // stroking alpha.\n    ctx.globalAlpha = this.current.strokeAlpha;\n    if (this.contentVisible) {\n      if (typeof strokeColor === \"object\" && strokeColor?.getPattern) {\n        const baseTransform = strokeColor.isModifyingCurrentTransform()\n          ? ctx.getTransform()\n          : null;\n        ctx.save();\n        ctx.strokeStyle = strokeColor.getPattern(\n          ctx,\n          this,\n          getCurrentTransformInverse(ctx),\n          PathType.STROKE,\n          opIdx\n        );\n        if (baseTransform) {\n          const newPath = new Path2D();\n          newPath.addPath(\n            path,\n            ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n          );\n          path = newPath;\n        }\n        this.rescaleAndStroke(path, /* saveRestore */ false);\n        ctx.restore();\n      } else {\n        this.rescaleAndStroke(path, /* saveRestore */ true);\n      }\n    }\n\n    this.dependencyTracker?.recordDependencies(opIdx, Dependencies.stroke);\n\n    if (consumePath) {\n      this.consumePath(\n        opIdx,\n        path,\n        this.current.getClippedPathBoundingBox(\n          PathType.STROKE,\n          getCurrentTransform(this.ctx)\n        )\n      );\n    }\n\n    // Restore the global alpha to the fill alpha\n    ctx.globalAlpha = this.current.fillAlpha;\n  }\n\n  closeStroke(opIdx, path) {\n    this.stroke(opIdx, path);\n  }\n\n  fill(opIdx, path, consumePath = true) {\n    const ctx = this.ctx;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    let needRestore = false;\n\n    if (isPatternFill) {\n      const baseTransform = fillColor.isModifyingCurrentTransform()\n        ? ctx.getTransform()\n        : null;\n      this.dependencyTracker?.save(opIdx);\n      ctx.save();\n      ctx.fillStyle = fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL,\n        opIdx\n      );\n      if (baseTransform) {\n        const newPath = new Path2D();\n        newPath.addPath(\n          path,\n          ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n        );\n        path = newPath;\n      }\n      needRestore = true;\n    }\n\n    const intersect = this.current.getClippedPathBoundingBox();\n    if (this.contentVisible && intersect !== null) {\n      if (this.pendingEOFill) {\n        ctx.fill(path, \"evenodd\");\n        this.pendingEOFill = false;\n      } else {\n        ctx.fill(path);\n      }\n    }\n\n    this.dependencyTracker?.recordDependencies(opIdx, Dependencies.fill);\n\n    if (needRestore) {\n      ctx.restore();\n      this.dependencyTracker?.restore(opIdx);\n    }\n    if (consumePath) {\n      this.consumePath(opIdx, path, intersect);\n    }\n  }\n\n  eoFill(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fill(opIdx, path);\n  }\n\n  fillStroke(opIdx, path) {\n    this.fill(opIdx, path, false);\n    this.stroke(opIdx, path, false);\n\n    this.consumePath(opIdx, path);\n  }\n\n  eoFillStroke(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fillStroke(opIdx, path);\n  }\n\n  closeFillStroke(opIdx, path) {\n    this.fillStroke(opIdx, path);\n  }\n\n  closeEOFillStroke(opIdx, path) {\n    this.pendingEOFill = true;\n    this.fillStroke(opIdx, path);\n  }\n\n  endPath(opIdx, path) {\n    this.consumePath(opIdx, path);\n  }\n\n  rawFillPath(opIdx, path) {\n    this.ctx.fill(path);\n    this.dependencyTracker\n      ?.recordDependencies(opIdx, Dependencies.rawFillPath)\n      .recordOperation(opIdx);\n  }\n\n  // Clipping\n  clip(opIdx) {\n    this.dependencyTracker?.recordFutureForcedDependency(\"clipMode\", opIdx);\n    this.pendingClip = NORMAL_CLIP;\n  }\n\n  eoClip(opIdx) {\n    this.dependencyTracker?.recordFutureForcedDependency(\"clipMode\", opIdx);\n    this.pendingClip = EO_CLIP;\n  }\n\n  // Text\n  beginText(opIdx) {\n    this.current.textMatrix = null;\n    this.current.textMatrixScale = 1;\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n\n    this.dependencyTracker\n      ?.recordOpenMarker(opIdx)\n      .resetIncrementalData(\"sameLineText\")\n      .resetIncrementalData(\"moveText\", opIdx);\n  }\n\n  endText(opIdx) {\n    const paths = this.pendingTextPaths;\n    const ctx = this.ctx;\n\n    if (this.dependencyTracker) {\n      const { dependencyTracker } = this;\n      if (paths !== undefined) {\n        dependencyTracker\n          .recordFutureForcedDependency(\n            \"textClip\",\n            dependencyTracker.getOpenMarker()\n          )\n          .recordFutureForcedDependency(\"textClip\", opIdx);\n      }\n      dependencyTracker.recordCloseMarker(opIdx);\n    }\n\n    if (paths !== undefined) {\n      const newPath = new Path2D();\n      const invTransf = ctx.getTransform().invertSelf();\n      for (const { transform, x, y, fontSize, path } of paths) {\n        if (!path) {\n          continue; // Skip empty paths.\n        }\n        newPath.addPath(\n          path,\n          new DOMMatrix(transform)\n            .preMultiplySelf(invTransf)\n            .translate(x, y)\n            .scale(fontSize, -fontSize)\n        );\n      }\n\n      ctx.clip(newPath);\n    }\n    delete this.pendingTextPaths;\n  }\n\n  setCharSpacing(opIdx, spacing) {\n    this.dependencyTracker?.recordSimpleData(\"charSpacing\", opIdx);\n    this.current.charSpacing = spacing;\n  }\n\n  setWordSpacing(opIdx, spacing) {\n    this.dependencyTracker?.recordSimpleData(\"wordSpacing\", opIdx);\n    this.current.wordSpacing = spacing;\n  }\n\n  setHScale(opIdx, scale) {\n    this.dependencyTracker?.recordSimpleData(\"hScale\", opIdx);\n    this.current.textHScale = scale / 100;\n  }\n\n  setLeading(opIdx, leading) {\n    this.dependencyTracker?.recordSimpleData(\"leading\", opIdx);\n    this.current.leading = -leading;\n  }\n\n  setFont(opIdx, fontRefName, size) {\n    this.dependencyTracker\n      ?.recordSimpleData(\"font\", opIdx)\n      .recordSimpleDataFromNamed(\"fontObj\", fontRefName, opIdx);\n    const fontObj = this.commonObjs.get(fontRefName);\n    const current = this.current;\n\n    if (!fontObj) {\n      throw new Error(`Can't find font for ${fontRefName}`);\n    }\n    current.fontMatrix = fontObj.fontMatrix || FONT_IDENTITY_MATRIX;\n\n    // A valid matrix needs all main diagonal elements to be non-zero\n    // This also ensures we bypass FF bugzilla bug #719844.\n    if (current.fontMatrix[0] === 0 || current.fontMatrix[3] === 0) {\n      warn(\"Invalid font matrix for font \" + fontRefName);\n    }\n\n    // The spec for Tf (setFont) says that 'size' specifies the font 'scale',\n    // and in some docs this can be negative (inverted x-y axes).\n    if (size < 0) {\n      size = -size;\n      current.fontDirection = -1;\n    } else {\n      current.fontDirection = 1;\n    }\n\n    this.current.font = fontObj;\n    this.current.fontSize = size;\n\n    if (fontObj.isType3Font) {\n      return; // we don't need ctx.font for Type3 fonts\n    }\n\n    const name = fontObj.loadedName || \"sans-serif\";\n    const typeface =\n      fontObj.systemFontInfo?.css || `\"${name}\", ${fontObj.fallbackName}`;\n\n    let bold = \"normal\";\n    if (fontObj.black) {\n      bold = \"900\";\n    } else if (fontObj.bold) {\n      bold = \"bold\";\n    }\n    const italic = fontObj.italic ? \"italic\" : \"normal\";\n\n    // Some font backends cannot handle fonts below certain size.\n    // Keeping the font at minimal size and using the fontSizeScale to change\n    // the current transformation matrix before the fillText/strokeText.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=726227\n    let browserFontSize = size;\n    if (size < MIN_FONT_SIZE) {\n      browserFontSize = MIN_FONT_SIZE;\n    } else if (size > MAX_FONT_SIZE) {\n      browserFontSize = MAX_FONT_SIZE;\n    }\n    this.current.fontSizeScale = size / browserFontSize;\n\n    this.ctx.font = `${italic} ${bold} ${browserFontSize}px ${typeface}`;\n  }\n\n  setTextRenderingMode(opIdx, mode) {\n    this.dependencyTracker?.recordSimpleData(\"textRenderingMode\", opIdx);\n    this.current.textRenderingMode = mode;\n  }\n\n  setTextRise(opIdx, rise) {\n    this.dependencyTracker?.recordSimpleData(\"textRise\", opIdx);\n    this.current.textRise = rise;\n  }\n\n  moveText(opIdx, x, y) {\n    this.dependencyTracker\n      ?.resetIncrementalData(\"sameLineText\")\n      .recordIncrementalData(\"moveText\", opIdx);\n    this.current.x = this.current.lineX += x;\n    this.current.y = this.current.lineY += y;\n  }\n\n  setLeadingMoveText(opIdx, x, y) {\n    this.setLeading(opIdx, -y);\n    this.moveText(opIdx, x, y);\n  }\n\n  setTextMatrix(opIdx, matrix) {\n    this.dependencyTracker\n      ?.resetIncrementalData(\"sameLineText\")\n      .recordSimpleData(\"textMatrix\", opIdx);\n    const { current } = this;\n    current.textMatrix = matrix;\n    current.textMatrixScale = Math.hypot(matrix[0], matrix[1]);\n\n    current.x = current.lineX = 0;\n    current.y = current.lineY = 0;\n  }\n\n  nextLine(opIdx) {\n    this.moveText(opIdx, 0, this.current.leading);\n\n    this.dependencyTracker?.recordIncrementalData(\n      \"moveText\",\n      // 'leading' affects 'nextLine' operations. Rather than dealing\n      // with transitive dependencies, just mark everything that depends on\n      // the 'moveText' operation as depending on the 'leading' value.\n      this.dependencyTracker.getSimpleIndex(\"leading\") ?? opIdx\n    );\n  }\n\n  #getScaledPath(path, currentTransform, transform) {\n    const newPath = new Path2D();\n    newPath.addPath(\n      path,\n      new DOMMatrix(transform).invertSelf().multiplySelf(currentTransform)\n    );\n    return newPath;\n  }\n\n  paintChar(\n    opIdx,\n    character,\n    x,\n    y,\n    patternFillTransform,\n    patternStrokeTransform\n  ) {\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const textRenderingMode = current.textRenderingMode;\n    const fontSize = current.fontSize / current.fontSizeScale;\n    const fillStrokeMode =\n      textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const isAddToPathSet = !!(\n      textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG\n    );\n    const patternFill = current.patternFill && !font.missingFile;\n    const patternStroke = current.patternStroke && !font.missingFile;\n\n    let path;\n    if (\n      (font.disableFontFace ||\n        isAddToPathSet ||\n        patternFill ||\n        patternStroke) &&\n      !font.missingFile\n    ) {\n      path = font.getPathGenerator(this.commonObjs, character);\n    }\n\n    if (path && (font.disableFontFace || patternFill || patternStroke)) {\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.scale(fontSize, -fontSize);\n\n      this.dependencyTracker?.recordCharacterBBox(opIdx, ctx, font);\n\n      let currentTransform;\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternFillTransform) {\n          currentTransform = ctx.getTransform();\n          ctx.setTransform(...patternFillTransform);\n          const scaledPath = this.#getScaledPath(\n            path,\n            currentTransform,\n            patternFillTransform\n          );\n          ctx.fill(scaledPath);\n        } else {\n          ctx.fill(path);\n        }\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternStrokeTransform) {\n          currentTransform ||= ctx.getTransform();\n          ctx.setTransform(...patternStrokeTransform);\n          const { a, b, c, d } = currentTransform;\n          const invPatternTransform = Util.inverseTransform(\n            patternStrokeTransform\n          );\n          const transf = Util.transform(\n            [a, b, c, d, 0, 0],\n            invPatternTransform\n          );\n          Util.singularValueDecompose2dScale(transf, XY);\n\n          // Cancel the pattern scaling of the line width.\n          // If sx and sy are different, unfortunately we can't do anything and\n          // we'll have a rendering bug.\n          ctx.lineWidth *= Math.max(XY[0], XY[1]) / fontSize;\n          ctx.stroke(\n            this.#getScaledPath(path, currentTransform, patternStrokeTransform)\n          );\n        } else {\n          ctx.lineWidth /= fontSize;\n          ctx.stroke(path);\n        }\n      }\n      ctx.restore();\n    } else {\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fillText(character, x, y);\n        this.dependencyTracker?.recordCharacterBBox(\n          opIdx,\n          ctx,\n          font,\n          fontSize,\n          x,\n          y,\n          () => ctx.measureText(character)\n        );\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (this.dependencyTracker) {\n          this.dependencyTracker\n            ?.recordCharacterBBox(opIdx, ctx, font, fontSize, x, y, () =>\n              ctx.measureText(character)\n            )\n            .recordDependencies(opIdx, Dependencies.stroke);\n        }\n        ctx.strokeText(character, x, y);\n      }\n    }\n\n    if (isAddToPathSet) {\n      const paths = (this.pendingTextPaths ||= []);\n      paths.push({\n        transform: getCurrentTransform(ctx),\n        x,\n        y,\n        fontSize,\n        path,\n      });\n      this.dependencyTracker?.recordCharacterBBox(\n        opIdx,\n        ctx,\n        font,\n        fontSize,\n        x,\n        y\n      );\n    }\n  }\n\n  get isFontSubpixelAAEnabled() {\n    // Checks if anti-aliasing is enabled when scaled text is painted.\n    // On Windows GDI scaled fonts looks bad.\n    const { context: ctx } = this.cachedCanvases.getCanvas(\n      \"isFontSubpixelAAEnabled\",\n      10,\n      10\n    );\n    ctx.scale(1.5, 1);\n    ctx.fillText(\"I\", 0, 10);\n    const data = ctx.getImageData(0, 0, 10, 10).data;\n    let enabled = false;\n    for (let i = 3; i < data.length; i += 4) {\n      if (data[i] > 0 && data[i] < 255) {\n        enabled = true;\n        break;\n      }\n    }\n    return shadow(this, \"isFontSubpixelAAEnabled\", enabled);\n  }\n\n  showText(opIdx, glyphs) {\n    if (this.dependencyTracker) {\n      this.dependencyTracker\n        .recordDependencies(opIdx, Dependencies.showText)\n        .resetBBox(opIdx);\n      if (this.current.textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG) {\n        this.dependencyTracker\n          .recordFutureForcedDependency(\"textClip\", opIdx)\n          .inheritPendingDependenciesAsFutureForcedDependencies();\n      }\n    }\n\n    const current = this.current;\n    const font = current.font;\n    if (font.isType3Font) {\n      this.showType3Text(opIdx, glyphs);\n      this.dependencyTracker?.recordShowTextOperation(opIdx);\n      return undefined;\n    }\n\n    const fontSize = current.fontSize;\n    if (fontSize === 0) {\n      this.dependencyTracker?.recordOperation(opIdx);\n      return undefined;\n    }\n\n    const ctx = this.ctx;\n    const fontSizeScale = current.fontSizeScale;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const fontDirection = current.fontDirection;\n    const textHScale = current.textHScale * fontDirection;\n    const glyphsLength = glyphs.length;\n    const vertical = font.vertical;\n    const spacingDir = vertical ? 1 : -1;\n    const defaultVMetrics = font.defaultVMetrics;\n    const widthAdvanceScale = fontSize * current.fontMatrix[0];\n\n    const simpleFillText =\n      current.textRenderingMode === TextRenderingMode.FILL &&\n      !font.disableFontFace &&\n      !current.patternFill;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    if (fontDirection > 0) {\n      ctx.scale(textHScale, -1);\n    } else {\n      ctx.scale(textHScale, 1);\n    }\n\n    let patternFillTransform, patternStrokeTransform;\n    if (current.patternFill) {\n      ctx.save();\n      const pattern = current.fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL,\n        opIdx\n      );\n      patternFillTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.fillStyle = pattern;\n    }\n\n    if (current.patternStroke) {\n      ctx.save();\n      const pattern = current.strokeColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.STROKE,\n        opIdx\n      );\n      patternStrokeTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.strokeStyle = pattern;\n    }\n\n    let lineWidth = current.lineWidth;\n    const scale = current.textMatrixScale;\n    if (scale === 0 || lineWidth === 0) {\n      const fillStrokeMode =\n        current.textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        lineWidth = this.getSinglePixelWidth();\n      }\n    } else {\n      lineWidth /= scale;\n    }\n\n    if (fontSizeScale !== 1.0) {\n      ctx.scale(fontSizeScale, fontSizeScale);\n      lineWidth /= fontSizeScale;\n    }\n\n    ctx.lineWidth = lineWidth;\n\n    if (font.isInvalidPDFjsFont) {\n      const chars = [];\n      let width = 0;\n      for (const glyph of glyphs) {\n        chars.push(glyph.unicode);\n        width += glyph.width;\n      }\n      const joinedChars = chars.join(\"\");\n      ctx.fillText(joinedChars, 0, 0);\n      if (this.dependencyTracker !== null) {\n        const measure = ctx.measureText(joinedChars);\n        this.dependencyTracker\n          .recordBBox(\n            opIdx,\n            this.ctx,\n            -measure.actualBoundingBoxLeft,\n            measure.actualBoundingBoxRight,\n            -measure.actualBoundingBoxAscent,\n            measure.actualBoundingBoxDescent\n          )\n          .recordShowTextOperation(opIdx);\n      }\n      current.x += width * widthAdvanceScale * textHScale;\n      ctx.restore();\n      this.compose();\n      return undefined;\n    }\n\n    let x = 0,\n      i;\n    for (i = 0; i < glyphsLength; ++i) {\n      const glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        x += (spacingDir * glyph * fontSize) / 1000;\n        continue;\n      }\n\n      let restoreNeeded = false;\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const character = glyph.fontChar;\n      const accent = glyph.accent;\n      let scaledX, scaledY;\n      let width = glyph.width;\n      if (vertical) {\n        const vmetric = glyph.vmetric || defaultVMetrics;\n        const vx =\n          -(glyph.vmetric ? vmetric[1] : width * 0.5) * widthAdvanceScale;\n        const vy = vmetric[2] * widthAdvanceScale;\n\n        width = vmetric ? -vmetric[0] : width;\n        scaledX = vx / fontSizeScale;\n        scaledY = (x + vy) / fontSizeScale;\n      } else {\n        scaledX = x / fontSizeScale;\n        scaledY = 0;\n      }\n\n      let measure;\n\n      if (font.remeasure && width > 0) {\n        measure = ctx.measureText(character);\n\n        // Some standard fonts may not have the exact width: rescale per\n        // character if measured width is greater than expected glyph width\n        // and subpixel-aa is enabled, otherwise just center the glyph.\n        const measuredWidth =\n          ((measure.width * 1000) / fontSize) * fontSizeScale;\n        if (width < measuredWidth && this.isFontSubpixelAAEnabled) {\n          const characterScaleX = width / measuredWidth;\n          restoreNeeded = true;\n          ctx.save();\n          ctx.scale(characterScaleX, 1);\n          scaledX /= characterScaleX;\n        } else if (width !== measuredWidth) {\n          scaledX +=\n            (((width - measuredWidth) / 2000) * fontSize) / fontSizeScale;\n        }\n      }\n\n      // Only attempt to draw the glyph if it is actually in the embedded font\n      // file or if there isn't a font file so the fallback font is shown.\n      if (this.contentVisible && (glyph.isInFont || font.missingFile)) {\n        if (simpleFillText && !accent) {\n          // common case\n          ctx.fillText(character, scaledX, scaledY);\n\n          this.dependencyTracker?.recordCharacterBBox(\n            opIdx,\n            ctx,\n            // If we already measured the character, force usage of that\n            measure ? { bbox: null } : font,\n            fontSize / fontSizeScale,\n            scaledX,\n            scaledY,\n            () => measure ?? ctx.measureText(character)\n          );\n        } else {\n          this.paintChar(\n            opIdx,\n            character,\n            scaledX,\n            scaledY,\n            patternFillTransform,\n            patternStrokeTransform\n          );\n          if (accent) {\n            const scaledAccentX =\n              scaledX + (fontSize * accent.offset.x) / fontSizeScale;\n            const scaledAccentY =\n              scaledY - (fontSize * accent.offset.y) / fontSizeScale;\n            this.paintChar(\n              opIdx,\n              accent.fontChar,\n              scaledAccentX,\n              scaledAccentY,\n              patternFillTransform,\n              patternStrokeTransform\n            );\n          }\n        }\n      }\n\n      const charWidth = vertical\n        ? width * widthAdvanceScale - spacing * fontDirection\n        : width * widthAdvanceScale + spacing * fontDirection;\n      x += charWidth;\n\n      if (restoreNeeded) {\n        ctx.restore();\n      }\n    }\n    if (vertical) {\n      current.y -= x;\n    } else {\n      current.x += x * textHScale;\n    }\n    ctx.restore();\n    this.compose();\n\n    this.dependencyTracker?.recordShowTextOperation(opIdx);\n    return undefined;\n  }\n\n  showType3Text(opIdx, glyphs) {\n    // Type3 fonts - each glyph is a \"mini-PDF\"\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const fontSize = current.fontSize;\n    const fontDirection = current.fontDirection;\n    const spacingDir = font.vertical ? 1 : -1;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const textHScale = current.textHScale * fontDirection;\n    const fontMatrix = current.fontMatrix || FONT_IDENTITY_MATRIX;\n    const glyphsLength = glyphs.length;\n    const isTextInvisible =\n      current.textRenderingMode === TextRenderingMode.INVISIBLE;\n    let i, glyph, width, spacingLength;\n\n    if (isTextInvisible || fontSize === 0) {\n      return;\n    }\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    ctx.scale(textHScale, fontDirection);\n\n    // Type3 fonts have their own operator list. Avoid mixing it up with the\n    // dependency tracker of the main operator list.\n    const dependencyTracker = this.dependencyTracker;\n    this.dependencyTracker = dependencyTracker\n      ? new CanvasNestedDependencyTracker(dependencyTracker, opIdx)\n      : null;\n\n    for (i = 0; i < glyphsLength; ++i) {\n      glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        spacingLength = (spacingDir * glyph * fontSize) / 1000;\n        this.ctx.translate(spacingLength, 0);\n        current.x += spacingLength * textHScale;\n        continue;\n      }\n\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const operatorList = font.charProcOperatorList[glyph.operatorListId];\n      if (!operatorList) {\n        warn(`Type3 character \"${glyph.operatorListId}\" is not available.`);\n      } else if (this.contentVisible) {\n        this.save();\n        ctx.scale(fontSize, fontSize);\n        ctx.transform(...fontMatrix);\n        this.executeOperatorList(operatorList);\n        this.restore();\n      }\n\n      const p = [glyph.width, 0];\n      Util.applyTransform(p, fontMatrix);\n      width = p[0] * fontSize + spacing;\n\n      ctx.translate(width, 0);\n      current.x += width * textHScale;\n    }\n    ctx.restore();\n    if (dependencyTracker) {\n      this.dependencyTracker = dependencyTracker;\n    }\n  }\n\n  // Type3 fonts\n  setCharWidth(opIdx, xWidth, yWidth) {\n    // We can safely ignore this since the width should be the same\n    // as the width in the Widths array.\n  }\n\n  setCharWidthAndBounds(opIdx, xWidth, yWidth, llx, lly, urx, ury) {\n    const clip = new Path2D();\n    clip.rect(llx, lly, urx - llx, ury - lly);\n    this.ctx.clip(clip);\n    this.dependencyTracker\n      ?.recordBBox(opIdx, this.ctx, llx, urx, lly, ury)\n      .recordClipBox(opIdx, this.ctx, llx, urx, lly, ury);\n    this.endPath(opIdx);\n  }\n\n  // Color\n  getColorN_Pattern(opIdx, IR) {\n    let pattern;\n    if (IR[0] === \"TilingPattern\") {\n      const baseTransform = this.baseTransform || getCurrentTransform(this.ctx);\n      const canvasGraphicsFactory = {\n        createCanvasGraphics: (ctx, renderingOpIdx) =>\n          new CanvasGraphics(\n            ctx,\n            this.commonObjs,\n            this.objs,\n            this.canvasFactory,\n            this.filterFactory,\n            {\n              optionalContentConfig: this.optionalContentConfig,\n              markedContentStack: this.markedContentStack,\n            },\n            undefined,\n            undefined,\n            this.dependencyTracker\n              ? new CanvasNestedDependencyTracker(\n                  this.dependencyTracker,\n                  renderingOpIdx,\n                  /* ignoreBBoxes */ true\n                )\n              : null\n          ),\n      };\n      pattern = new TilingPattern(\n        IR,\n        this.ctx,\n        canvasGraphicsFactory,\n        baseTransform\n      );\n    } else {\n      pattern = this._getPattern(opIdx, IR[1], IR[2]);\n    }\n    return pattern;\n  }\n\n  setStrokeColorN(opIdx, ...args) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.current.strokeColor = this.getColorN_Pattern(opIdx, args);\n    this.current.patternStroke = true;\n  }\n\n  setFillColorN(opIdx, ...args) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.current.fillColor = this.getColorN_Pattern(opIdx, args);\n    this.current.patternFill = true;\n  }\n\n  setStrokeRGBColor(opIdx, color) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.ctx.strokeStyle = this.current.strokeColor = color;\n    this.current.patternStroke = false;\n  }\n\n  setStrokeTransparent(opIdx) {\n    this.dependencyTracker?.recordSimpleData(\"strokeColor\", opIdx);\n    this.ctx.strokeStyle = this.current.strokeColor = \"transparent\";\n    this.current.patternStroke = false;\n  }\n\n  setFillRGBColor(opIdx, color) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.ctx.fillStyle = this.current.fillColor = color;\n    this.current.patternFill = false;\n  }\n\n  setFillTransparent(opIdx) {\n    this.dependencyTracker?.recordSimpleData(\"fillColor\", opIdx);\n    this.ctx.fillStyle = this.current.fillColor = \"transparent\";\n    this.current.patternFill = false;\n  }\n\n  _getPattern(opIdx, objId, matrix = null) {\n    let pattern;\n    if (this.cachedPatterns.has(objId)) {\n      pattern = this.cachedPatterns.get(objId);\n    } else {\n      pattern = getShadingPattern(this.getObject(opIdx, objId));\n      this.cachedPatterns.set(objId, pattern);\n    }\n    if (matrix) {\n      pattern.matrix = matrix;\n    }\n    return pattern;\n  }\n\n  shadingFill(opIdx, objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    this.save(opIdx);\n    const pattern = this._getPattern(opIdx, objId);\n    ctx.fillStyle = pattern.getPattern(\n      ctx,\n      this,\n      getCurrentTransformInverse(ctx),\n      PathType.SHADING,\n      opIdx\n    );\n\n    const inv = getCurrentTransformInverse(ctx);\n    if (inv) {\n      const { width, height } = ctx.canvas;\n      const minMax = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox([0, 0, width, height], inv, minMax);\n      const [x0, y0, x1, y1] = minMax;\n\n      this.ctx.fillRect(x0, y0, x1 - x0, y1 - y0);\n    } else {\n      // HACK to draw the gradient onto an infinite rectangle.\n      // PDF gradients are drawn across the entire image while\n      // Canvas only allows gradients to be drawn in a rectangle\n      // The following bug should allow us to remove this.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=664884\n\n      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);\n    }\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      // TODO: Track proper bbox\n      .recordFullPageBBox(opIdx)\n      .recordDependencies(opIdx, Dependencies.transform)\n      .recordDependencies(opIdx, Dependencies.fill)\n      .recordOperation(opIdx);\n\n    this.compose(this.current.getClippedPathBoundingBox());\n    this.restore(opIdx);\n  }\n\n  // Images\n  beginInlineImage() {\n    unreachable(\"Should not call beginInlineImage\");\n  }\n\n  beginImageData() {\n    unreachable(\"Should not call beginImageData\");\n  }\n\n  paintFormXObjectBegin(opIdx, matrix, bbox) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.save(opIdx);\n    this.baseTransformStack.push(this.baseTransform);\n\n    if (matrix) {\n      this.transform(opIdx, ...matrix);\n    }\n    this.baseTransform = getCurrentTransform(this.ctx);\n\n    if (bbox) {\n      Util.axialAlignedBoundingBox(\n        bbox,\n        this.baseTransform,\n        this.current.minMax\n      );\n      const [x0, y0, x1, y1] = bbox;\n      const clip = new Path2D();\n      clip.rect(x0, y0, x1 - x0, y1 - y0);\n      this.ctx.clip(clip);\n      this.dependencyTracker?.recordClipBox(opIdx, this.ctx, x0, x1, y0, y1);\n      this.endPath(opIdx);\n    }\n  }\n\n  paintFormXObjectEnd(opIdx) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.restore(opIdx);\n    this.baseTransform = this.baseTransformStack.pop();\n  }\n\n  beginGroup(opIdx, group) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    this.save(opIdx);\n    // If there's an active soft mask we don't want it enabled for the group, so\n    // clear it out. The mask and suspended canvas will be restored in endGroup.\n    if (this.inSMaskMode) {\n      this.endSMaskMode();\n      this.current.activeSMask = null;\n    }\n\n    const currentCtx = this.ctx;\n    // TODO non-isolated groups - according to Rik at adobe non-isolated\n    // group results aren't usually that different and they even have tools\n    // that ignore this setting. Notes from Rik on implementing:\n    // - When you encounter an transparency group, create a new canvas with\n    // the dimensions of the bbox\n    // - copy the content from the previous canvas to the new canvas\n    // - draw as usual\n    // - remove the backdrop alpha:\n    // alphaNew = 1 - (1 - alpha)/(1 - alphaBackdrop) with 'alpha' the alpha\n    // value of your transparency group and 'alphaBackdrop' the alpha of the\n    // backdrop\n    // - remove background color:\n    // colorNew = color - alphaNew *colorBackdrop /(1 - alphaNew)\n    if (!group.isolated) {\n      info(\"TODO: Support non-isolated groups.\");\n    }\n\n    // TODO knockout - supposedly possible with the clever use of compositing\n    // modes.\n    if (group.knockout) {\n      warn(\"Knockout groups not supported.\");\n    }\n\n    const currentTransform = getCurrentTransform(currentCtx);\n    if (group.matrix) {\n      currentCtx.transform(...group.matrix);\n    }\n    if (!group.bbox) {\n      throw new Error(\"Bounding box is required.\");\n    }\n\n    // Based on the current transform figure out how big the bounding box\n    // will actually be.\n    let bounds = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox(\n      group.bbox,\n      getCurrentTransform(currentCtx),\n      bounds\n    );\n\n    // Clip the bounding box to the current canvas.\n    const canvasBounds = [\n      0,\n      0,\n      currentCtx.canvas.width,\n      currentCtx.canvas.height,\n    ];\n    bounds = Util.intersect(bounds, canvasBounds) || [0, 0, 0, 0];\n    // Use ceil in case we're between sizes so we don't create canvas that is\n    // too small and make the canvas at least 1x1 pixels.\n    const offsetX = Math.floor(bounds[0]);\n    const offsetY = Math.floor(bounds[1]);\n    const drawnWidth = Math.max(Math.ceil(bounds[2]) - offsetX, 1);\n    const drawnHeight = Math.max(Math.ceil(bounds[3]) - offsetY, 1);\n\n    this.current.startNewPathAndClipBox([0, 0, drawnWidth, drawnHeight]);\n\n    let cacheId = \"groupAt\" + this.groupLevel;\n    if (group.smask) {\n      // Using two cache entries is case if masks are used one after another.\n      cacheId += \"_smask_\" + (this.smaskCounter++ % 2);\n    }\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    const groupCtx = scratchCanvas.context;\n\n    // Since we created a new canvas that is just the size of the bounding box\n    // we have to translate the group ctx.\n    groupCtx.translate(-offsetX, -offsetY);\n    groupCtx.transform(...currentTransform);\n\n    // Apply the bbox to the group context.\n    let clip = new Path2D();\n    const [x0, y0, x1, y1] = group.bbox;\n    clip.rect(x0, y0, x1 - x0, y1 - y0);\n    if (group.matrix) {\n      const path = new Path2D();\n      path.addPath(clip, new DOMMatrix(group.matrix));\n      clip = path;\n    }\n    groupCtx.clip(clip);\n\n    if (group.smask) {\n      // Saving state and cached mask to be used in setGState.\n      this.smaskStack.push({\n        canvas: scratchCanvas.canvas,\n        context: groupCtx,\n        offsetX,\n        offsetY,\n        subtype: group.smask.subtype,\n        backdrop: group.smask.backdrop,\n        transferMap: group.smask.transferMap || null,\n        startTransformInverse: null, // used during suspend operation\n      });\n    }\n    if (\n      !group.smask ||\n      // When this is not an SMask group, we only need to update the current\n      // transform if recording operations bboxes, so they the bboxes have the\n      // correct transform applied.\n      this.dependencyTracker\n    ) {\n      // Setup the current ctx so when the group is popped we draw it at the\n      // right location.\n      currentCtx.setTransform(1, 0, 0, 1, 0, 0);\n      currentCtx.translate(offsetX, offsetY);\n      currentCtx.save();\n    }\n    // The transparency group inherits all off the current graphics state\n    // except the blend mode, soft mask, and alpha constants.\n    copyCtxState(currentCtx, groupCtx);\n    this.ctx = groupCtx;\n    this.dependencyTracker\n      ?.inheritSimpleDataAsFutureForcedDependencies([\n        \"fillAlpha\",\n        \"strokeAlpha\",\n        \"globalCompositeOperation\",\n      ])\n      .pushBaseTransform(currentCtx);\n    this.setGState(opIdx, [\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n    this.groupStack.push(currentCtx);\n    this.groupLevel++;\n  }\n\n  endGroup(opIdx, group) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.groupLevel--;\n    const groupCtx = this.ctx;\n    const ctx = this.groupStack.pop();\n    this.ctx = ctx;\n    // Turn off image smoothing to avoid sub pixel interpolation which can\n    // look kind of blurry for some pdfs.\n    this.ctx.imageSmoothingEnabled = false;\n\n    this.dependencyTracker?.popBaseTransform();\n\n    if (group.smask) {\n      this.tempSMask = this.smaskStack.pop();\n      this.restore(opIdx);\n      if (this.dependencyTracker) {\n        this.ctx.restore();\n      }\n    } else {\n      this.ctx.restore();\n      const currentMtx = getCurrentTransform(this.ctx);\n      this.restore(opIdx);\n      this.ctx.save();\n      this.ctx.setTransform(...currentMtx);\n      const dirtyBox = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox(\n        [0, 0, groupCtx.canvas.width, groupCtx.canvas.height],\n        currentMtx,\n        dirtyBox\n      );\n      this.ctx.drawImage(groupCtx.canvas, 0, 0);\n      this.ctx.restore();\n      this.compose(dirtyBox);\n    }\n  }\n\n  beginAnnotation(opIdx, id, rect, transform, matrix, hasOwnCanvas) {\n    // The annotations are drawn just after the page content.\n    // The page content drawing can potentially have set a transform,\n    // a clipping path, whatever...\n    // So in order to have something clean, we restore the initial state.\n    this.#restoreInitialState();\n    resetCtxToDefault(this.ctx);\n\n    this.ctx.save();\n    this.save(opIdx);\n\n    if (this.baseTransform) {\n      this.ctx.setTransform(...this.baseTransform);\n    }\n\n    if (rect) {\n      const width = rect[2] - rect[0];\n      const height = rect[3] - rect[1];\n\n      if (hasOwnCanvas && this.annotationCanvasMap) {\n        transform = transform.slice();\n        transform[4] -= rect[0];\n        transform[5] -= rect[1];\n\n        rect = rect.slice();\n        rect[0] = rect[1] = 0;\n        rect[2] = width;\n        rect[3] = height;\n\n        Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx), XY);\n        const { viewportScale } = this;\n        const canvasWidth = Math.ceil(\n          width * this.outputScaleX * viewportScale\n        );\n        const canvasHeight = Math.ceil(\n          height * this.outputScaleY * viewportScale\n        );\n\n        this.annotationCanvas = this.canvasFactory.create(\n          canvasWidth,\n          canvasHeight\n        );\n        const { canvas, context } = this.annotationCanvas;\n        this.annotationCanvasMap.set(id, canvas);\n        this.annotationCanvas.savedCtx = this.ctx;\n        this.ctx = context;\n        this.ctx.save();\n        this.ctx.setTransform(XY[0], 0, 0, -XY[1], 0, height * XY[1]);\n\n        resetCtxToDefault(this.ctx);\n      } else {\n        resetCtxToDefault(this.ctx);\n\n        // Consume a potential path before clipping.\n        this.endPath(opIdx);\n\n        const clip = new Path2D();\n        clip.rect(rect[0], rect[1], width, height);\n        this.ctx.clip(clip);\n      }\n    }\n\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n\n    this.transform(opIdx, ...transform);\n    this.transform(opIdx, ...matrix);\n  }\n\n  endAnnotation(opIdx) {\n    if (this.annotationCanvas) {\n      this.ctx.restore();\n      this.#drawFilter();\n\n      this.ctx = this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas;\n    }\n  }\n\n  paintImageMaskXObject(opIdx, img) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    const count = img.count;\n    img = this.getObject(opIdx, img.data, img);\n    img.count = count;\n\n    const ctx = this.ctx;\n    const mask = this._createMaskCanvas(opIdx, img);\n    const maskCanvas = mask.canvas;\n\n    ctx.save();\n    // The mask is drawn with the transform applied. Reset the current\n    // transform to draw to the identity.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(maskCanvas, mask.offsetX, mask.offsetY);\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(\n        opIdx,\n        this.ctx,\n        mask.offsetX,\n        mask.offsetX + maskCanvas.width,\n        mask.offsetY,\n        mask.offsetY + maskCanvas.height\n      )\n      .recordOperation(opIdx);\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectRepeat(\n    opIdx,\n    img,\n    scaleX,\n    skewX = 0,\n    skewY = 0,\n    scaleY,\n    positions\n  ) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    img = this.getObject(opIdx, img.data, img);\n\n    const ctx = this.ctx;\n    ctx.save();\n    const currentTransform = getCurrentTransform(ctx);\n    ctx.transform(scaleX, skewX, skewY, scaleY, 0, 0);\n    const mask = this._createMaskCanvas(opIdx, img);\n\n    ctx.setTransform(\n      1,\n      0,\n      0,\n      1,\n      mask.offsetX - currentTransform[4],\n      mask.offsetY - currentTransform[5]\n    );\n    this.dependencyTracker?.resetBBox(opIdx);\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      const trans = Util.transform(currentTransform, [\n        scaleX,\n        skewX,\n        skewY,\n        scaleY,\n        positions[i],\n        positions[i + 1],\n      ]);\n\n      // Here we want to apply the transform at the origin,\n      // hence no additional computation is necessary.\n      ctx.drawImage(mask.canvas, trans[4], trans[5]);\n      this.dependencyTracker?.recordBBox(\n        opIdx,\n        this.ctx,\n        trans[4],\n        trans[4] + mask.canvas.width,\n        trans[5],\n        trans[5] + mask.canvas.height\n      );\n    }\n    ctx.restore();\n    this.compose();\n\n    this.dependencyTracker?.recordOperation(opIdx);\n  }\n\n  paintImageMaskXObjectGroup(opIdx, images) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordDependencies(opIdx, Dependencies.transformAndFill);\n\n    for (const image of images) {\n      const { data, width, height, transform } = image;\n\n      const maskCanvas = this.cachedCanvases.getCanvas(\n        \"maskCanvas\",\n        width,\n        height\n      );\n      const maskCtx = maskCanvas.context;\n      maskCtx.save();\n\n      const img = this.getObject(opIdx, data, image);\n      putBinaryImageMask(maskCtx, img);\n\n      maskCtx.globalCompositeOperation = \"source-in\";\n\n      maskCtx.fillStyle = isPatternFill\n        ? fillColor.getPattern(\n            maskCtx,\n            this,\n            getCurrentTransformInverse(ctx),\n            PathType.FILL,\n            opIdx\n          )\n        : fillColor;\n      maskCtx.fillRect(0, 0, width, height);\n\n      maskCtx.restore();\n\n      ctx.save();\n      ctx.transform(...transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        maskCanvas.canvas,\n        0,\n        0,\n        width,\n        height,\n        0,\n        -1,\n        1,\n        1\n      );\n\n      this.dependencyTracker?.recordBBox(opIdx, ctx, 0, width, 0, height);\n      ctx.restore();\n    }\n    this.compose();\n    this.dependencyTracker?.recordOperation(opIdx);\n  }\n\n  paintImageXObject(opIdx, objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(opIdx, objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    this.paintInlineImageXObject(opIdx, imgData);\n  }\n\n  paintImageXObjectRepeat(opIdx, objId, scaleX, scaleY, positions) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(opIdx, objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    const width = imgData.width;\n    const height = imgData.height;\n    const map = [];\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      map.push({\n        transform: [scaleX, 0, 0, scaleY, positions[i], positions[i + 1]],\n        x: 0,\n        y: 0,\n        w: width,\n        h: height,\n      });\n    }\n    this.paintInlineImageXObjectGroup(opIdx, imgData, map);\n  }\n\n  applyTransferMapsToCanvas(ctx) {\n    if (this.current.transferMaps !== \"none\") {\n      ctx.filter = this.current.transferMaps;\n      ctx.drawImage(ctx.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    return ctx.canvas;\n  }\n\n  applyTransferMapsToBitmap(imgData) {\n    if (this.current.transferMaps === \"none\") {\n      return imgData.bitmap;\n    }\n    const { bitmap, width, height } = imgData;\n    const tmpCanvas = this.cachedCanvases.getCanvas(\n      \"inlineImage\",\n      width,\n      height\n    );\n    const tmpCtx = tmpCanvas.context;\n    tmpCtx.filter = this.current.transferMaps;\n    tmpCtx.drawImage(bitmap, 0, 0);\n    tmpCtx.filter = \"none\";\n\n    return tmpCanvas.canvas;\n  }\n\n  paintInlineImageXObject(opIdx, imgData) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const width = imgData.width;\n    const height = imgData.height;\n    const ctx = this.ctx;\n\n    this.save(opIdx);\n\n    // The filter, if any, will be applied in applyTransferMapsToBitmap.\n    // It must be applied to the image before rescaling else some artifacts\n    // could appear.\n    // The final restore will reset it to its value.\n    const { filter } = ctx;\n    if (filter !== \"none\" && filter !== \"\") {\n      ctx.filter = \"none\";\n    }\n\n    // scale the image to the unit square\n    ctx.scale(1 / width, -1 / height);\n\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = this.applyTransferMapsToBitmap(imgData);\n    } else if (\n      (typeof HTMLElement === \"function\" && imgData instanceof HTMLElement) ||\n      !imgData.data\n    ) {\n      // typeof check is needed due to node.js support, see issue #8489\n      imgToPaint = imgData;\n    } else {\n      const tmpCanvas = this.cachedCanvases.getCanvas(\n        \"inlineImage\",\n        width,\n        height\n      );\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    const scaled = this._scaleImage(\n      imgToPaint,\n      getCurrentTransformInverse(ctx)\n    );\n    ctx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(ctx),\n      imgData.interpolate\n    );\n\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(opIdx, ctx, 0, width, -height, 0)\n      .recordDependencies(opIdx, Dependencies.imageXObject)\n      .recordOperation(opIdx);\n\n    drawImageAtIntegerCoords(\n      ctx,\n      scaled.img,\n      0,\n      0,\n      scaled.paintWidth,\n      scaled.paintHeight,\n      0,\n      -height,\n      width,\n      height\n    );\n    this.compose();\n    this.restore(opIdx);\n  }\n\n  paintInlineImageXObjectGroup(opIdx, imgData, map) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = imgData.bitmap;\n    } else {\n      const w = imgData.width;\n      const h = imgData.height;\n\n      const tmpCanvas = this.cachedCanvases.getCanvas(\"inlineImage\", w, h);\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    this.dependencyTracker?.resetBBox(opIdx);\n\n    for (const entry of map) {\n      ctx.save();\n      ctx.transform(...entry.transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        imgToPaint,\n        entry.x,\n        entry.y,\n        entry.w,\n        entry.h,\n        0,\n        -1,\n        1,\n        1\n      );\n      this.dependencyTracker?.recordBBox(opIdx, ctx, 0, 1, -1, 0);\n      ctx.restore();\n    }\n    this.dependencyTracker?.recordOperation(opIdx);\n    this.compose();\n  }\n\n  paintSolidColorImageMask(opIdx) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.dependencyTracker\n      ?.resetBBox(opIdx)\n      .recordBBox(opIdx, this.ctx, 0, 1, 0, 1)\n      .recordDependencies(opIdx, Dependencies.fill)\n      .recordOperation(opIdx);\n    this.ctx.fillRect(0, 0, 1, 1);\n    this.compose();\n  }\n\n  // Marked content\n\n  markPoint(opIdx, tag) {\n    // TODO Marked content.\n  }\n\n  markPointProps(opIdx, tag, properties) {\n    // TODO Marked content.\n  }\n\n  beginMarkedContent(opIdx, tag) {\n    this.dependencyTracker?.beginMarkedContent(opIdx);\n    this.markedContentStack.push({\n      visible: true,\n    });\n  }\n\n  beginMarkedContentProps(opIdx, tag, properties) {\n    this.dependencyTracker?.beginMarkedContent(opIdx);\n    if (tag === \"OC\") {\n      this.markedContentStack.push({\n        visible: this.optionalContentConfig.isVisible(properties),\n      });\n    } else {\n      this.markedContentStack.push({\n        visible: true,\n      });\n    }\n    this.contentVisible = this.isContentVisible();\n  }\n\n  endMarkedContent(opIdx) {\n    this.dependencyTracker?.endMarkedContent(opIdx);\n    this.markedContentStack.pop();\n    this.contentVisible = this.isContentVisible();\n  }\n\n  // Compatibility\n\n  beginCompat(opIdx) {\n    // TODO ignore undefined operators (should we do that anyway?)\n  }\n\n  endCompat(opIdx) {\n    // TODO stop ignoring undefined operators\n  }\n\n  // Helper functions\n\n  consumePath(opIdx, path, clipBox) {\n    const isEmpty = this.current.isEmptyClip();\n    if (this.pendingClip) {\n      this.current.updateClipFromPath();\n    }\n    if (!this.pendingClip) {\n      this.compose(clipBox);\n    }\n    const ctx = this.ctx;\n    if (this.pendingClip) {\n      if (!isEmpty) {\n        if (this.pendingClip === EO_CLIP) {\n          ctx.clip(path, \"evenodd\");\n        } else {\n          ctx.clip(path);\n        }\n      }\n      this.pendingClip = null;\n      this.dependencyTracker\n        ?.bboxToClipBoxDropOperation(opIdx)\n        .recordFutureForcedDependency(\"clipPath\", opIdx);\n    } else {\n      this.dependencyTracker?.recordOperation(opIdx);\n    }\n\n    this.current.startNewPathAndClipBox(this.current.clipBox);\n  }\n\n  getSinglePixelWidth() {\n    if (!this._cachedGetSinglePixelWidth) {\n      const m = getCurrentTransform(this.ctx);\n      if (m[1] === 0 && m[2] === 0) {\n        // Fast path\n        this._cachedGetSinglePixelWidth =\n          1 / Math.min(Math.abs(m[0]), Math.abs(m[3]));\n      } else {\n        const absDet = Math.abs(m[0] * m[3] - m[2] * m[1]);\n        const normX = Math.hypot(m[0], m[2]);\n        const normY = Math.hypot(m[1], m[3]);\n        this._cachedGetSinglePixelWidth = Math.max(normX, normY) / absDet;\n      }\n    }\n    return this._cachedGetSinglePixelWidth;\n  }\n\n  getScaleForStroking() {\n    // A pixel has thicknessX = thicknessY = 1;\n    // A transformed pixel is a parallelogram and the thicknesses\n    // corresponds to the heights.\n    // The goal of this function is to rescale before setting the\n    // lineWidth in order to have both thicknesses greater or equal\n    // to 1 after transform.\n    if (this._cachedScaleForStroking[0] === -1) {\n      const { lineWidth } = this.current;\n      const { a, b, c, d } = this.ctx.getTransform();\n      let scaleX, scaleY;\n\n      if (b === 0 && c === 0) {\n        // Fast path\n        const normX = Math.abs(a);\n        const normY = Math.abs(d);\n        if (normX === normY) {\n          if (lineWidth === 0) {\n            scaleX = scaleY = 1 / normX;\n          } else {\n            const scaledLineWidth = normX * lineWidth;\n            scaleX = scaleY = scaledLineWidth < 1 ? 1 / scaledLineWidth : 1;\n          }\n        } else if (lineWidth === 0) {\n          scaleX = 1 / normX;\n          scaleY = 1 / normY;\n        } else {\n          const scaledXLineWidth = normX * lineWidth;\n          const scaledYLineWidth = normY * lineWidth;\n          scaleX = scaledXLineWidth < 1 ? 1 / scaledXLineWidth : 1;\n          scaleY = scaledYLineWidth < 1 ? 1 / scaledYLineWidth : 1;\n        }\n      } else {\n        // A pixel (base (x, y)) is transformed by M into a parallelogram:\n        //  - its area is |det(M)|;\n        //  - heightY (orthogonal to Mx) has a length: |det(M)| / norm(Mx);\n        //  - heightX (orthogonal to My) has a length: |det(M)| / norm(My).\n        // heightX and heightY are the thicknesses of the transformed pixel\n        // and they must be both greater or equal to 1.\n        const absDet = Math.abs(a * d - b * c);\n        const normX = Math.hypot(a, b);\n        const normY = Math.hypot(c, d);\n        if (lineWidth === 0) {\n          scaleX = normY / absDet;\n          scaleY = normX / absDet;\n        } else {\n          const baseArea = lineWidth * absDet;\n          scaleX = normY > baseArea ? normY / baseArea : 1;\n          scaleY = normX > baseArea ? normX / baseArea : 1;\n        }\n      }\n      this._cachedScaleForStroking[0] = scaleX;\n      this._cachedScaleForStroking[1] = scaleY;\n    }\n    return this._cachedScaleForStroking;\n  }\n\n  // Rescale before stroking in order to have a final lineWidth\n  // with both thicknesses greater or equal to 1.\n  rescaleAndStroke(path, saveRestore) {\n    const {\n      ctx,\n      current: { lineWidth },\n    } = this;\n    const [scaleX, scaleY] = this.getScaleForStroking();\n\n    if (scaleX === scaleY) {\n      ctx.lineWidth = (lineWidth || 1) * scaleX;\n      ctx.stroke(path);\n      return;\n    }\n\n    const dashes = ctx.getLineDash();\n    if (saveRestore) {\n      ctx.save();\n    }\n\n    ctx.scale(scaleX, scaleY);\n    SCALE_MATRIX.a = 1 / scaleX;\n    SCALE_MATRIX.d = 1 / scaleY;\n    const newPath = new Path2D();\n    newPath.addPath(path, SCALE_MATRIX);\n\n    // How the dashed line is rendered depends on the current transform...\n    // so we added a rescale to handle too thin lines and consequently\n    // the way the line is dashed will be modified.\n    // If scaleX === scaleY, the dashed lines will be rendered correctly\n    // else we'll have some bugs (but only with too thin lines).\n    // Here we take the max... why not taking the min... or something else.\n    // Anyway, as said it's buggy when scaleX !== scaleY.\n    if (dashes.length > 0) {\n      const scale = Math.max(scaleX, scaleY);\n      ctx.setLineDash(dashes.map(x => x / scale));\n      ctx.lineDashOffset /= scale;\n    }\n\n    ctx.lineWidth = lineWidth || 1;\n    ctx.stroke(newPath);\n\n    if (saveRestore) {\n      ctx.restore();\n    }\n  }\n\n  isContentVisible() {\n    for (let i = this.markedContentStack.length - 1; i >= 0; i--) {\n      if (!this.markedContentStack[i].visible) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfor (const op in OPS) {\n  if (CanvasGraphics.prototype[op] !== undefined) {\n    CanvasGraphics.prototype[OPS[op]] = CanvasGraphics.prototype[op];\n  }\n}\n\nexport { CanvasGraphics };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass GlobalWorkerOptions {\n  static #port = null;\n\n  static #src = \"\";\n\n  /**\n   * @type {Worker | null}\n   */\n  static get workerPort() {\n    return this.#port;\n  }\n\n  /**\n   * @param {Worker | null} workerPort - Defines global port for worker process.\n   *   Overrides the `workerSrc` option.\n   */\n  static set workerPort(val) {\n    if (\n      !(typeof Worker !== \"undefined\" && val instanceof Worker) &&\n      val !== null\n    ) {\n      throw new Error(\"Invalid `workerPort` type.\");\n    }\n    this.#port = val;\n  }\n\n  /**\n   * @type {string}\n   */\n  static get workerSrc() {\n    return this.#src;\n  }\n\n  /**\n   * @param {string} workerSrc - A string containing the path and filename of\n   *   the worker file.\n   *\n   *   NOTE: The `workerSrc` option should always be set, in order to prevent\n   *         any issues when using the PDF.js library.\n   */\n  static set workerSrc(val) {\n    if (typeof val !== \"string\") {\n      throw new Error(\"Invalid `workerSrc` type.\");\n    }\n    this.#src = val;\n  }\n}\n\nexport { GlobalWorkerOptions };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass Metadata {\n  #map;\n\n  #data;\n\n  constructor({ parsedData, rawData }) {\n    this.#map = parsedData;\n    this.#data = rawData;\n  }\n\n  getRaw() {\n    return this.#data;\n  }\n\n  get(name) {\n    return this.#map.get(name) ?? null;\n  }\n\n  [Symbol.iterator]() {\n    return this.#map.entries();\n  }\n}\n\nexport { Metadata };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  info,\n  RenderingIntentFlag,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst INTERNAL = Symbol(\"INTERNAL\");\n\nclass OptionalContentGroup {\n  #isDisplay = false;\n\n  #isPrint = false;\n\n  #userSet = false;\n\n  #visible = true;\n\n  constructor(renderingIntent, { name, intent, usage, rbGroups }) {\n    this.#isDisplay = !!(renderingIntent & RenderingIntentFlag.DISPLAY);\n    this.#isPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    this.name = name;\n    this.intent = intent;\n    this.usage = usage;\n    this.rbGroups = rbGroups;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get visible() {\n    if (this.#userSet) {\n      return this.#visible;\n    }\n    if (!this.#visible) {\n      return false;\n    }\n    const { print, view } = this.usage;\n\n    if (this.#isDisplay) {\n      return view?.viewState !== \"OFF\";\n    } else if (this.#isPrint) {\n      return print?.printState !== \"OFF\";\n    }\n    return true;\n  }\n\n  /**\n   * @ignore\n   */\n  _setVisible(internal, visible, userSet = false) {\n    if (internal !== INTERNAL) {\n      unreachable(\"Internal method `_setVisible` called.\");\n    }\n    this.#userSet = userSet;\n    this.#visible = visible;\n  }\n}\n\nclass OptionalContentConfig {\n  #cachedGetHash = null;\n\n  #groups = new Map();\n\n  #initialHash = null;\n\n  #order = null;\n\n  constructor(data, renderingIntent = RenderingIntentFlag.DISPLAY) {\n    this.renderingIntent = renderingIntent;\n\n    this.name = null;\n    this.creator = null;\n\n    if (data === null) {\n      return;\n    }\n    this.name = data.name;\n    this.creator = data.creator;\n    this.#order = data.order;\n    for (const group of data.groups) {\n      this.#groups.set(\n        group.id,\n        new OptionalContentGroup(renderingIntent, group)\n      );\n    }\n\n    if (data.baseState === \"OFF\") {\n      for (const group of this.#groups.values()) {\n        group._setVisible(INTERNAL, false);\n      }\n    }\n\n    for (const on of data.on) {\n      this.#groups.get(on)._setVisible(INTERNAL, true);\n    }\n\n    for (const off of data.off) {\n      this.#groups.get(off)._setVisible(INTERNAL, false);\n    }\n\n    // The following code must always run *last* in the constructor.\n    this.#initialHash = this.getHash();\n  }\n\n  #evaluateVisibilityExpression(array) {\n    const length = array.length;\n    if (length < 2) {\n      return true;\n    }\n    const operator = array[0];\n    for (let i = 1; i < length; i++) {\n      const element = array[i];\n      let state;\n      if (Array.isArray(element)) {\n        state = this.#evaluateVisibilityExpression(element);\n      } else if (this.#groups.has(element)) {\n        state = this.#groups.get(element).visible;\n      } else {\n        warn(`Optional content group not found: ${element}`);\n        return true;\n      }\n      switch (operator) {\n        case \"And\":\n          if (!state) {\n            return false;\n          }\n          break;\n        case \"Or\":\n          if (state) {\n            return true;\n          }\n          break;\n        case \"Not\":\n          return !state;\n        default:\n          return true;\n      }\n    }\n    return operator === \"And\";\n  }\n\n  isVisible(group) {\n    if (this.#groups.size === 0) {\n      return true;\n    }\n    if (!group) {\n      info(\"Optional content group not defined.\");\n      return true;\n    }\n    if (group.type === \"OCG\") {\n      if (!this.#groups.has(group.id)) {\n        warn(`Optional content group not found: ${group.id}`);\n        return true;\n      }\n      return this.#groups.get(group.id).visible;\n    } else if (group.type === \"OCMD\") {\n      // Per the spec, the expression should be preferred if available.\n      if (group.expression) {\n        return this.#evaluateVisibilityExpression(group.expression);\n      }\n      if (!group.policy || group.policy === \"AnyOn\") {\n        // Default\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOn\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      } else if (group.policy === \"AnyOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      }\n      warn(`Unknown optional content policy ${group.policy}.`);\n      return true;\n    }\n    warn(`Unknown group type ${group.type}.`);\n    return true;\n  }\n\n  setVisibility(id, visible = true, preserveRB = true) {\n    const group = this.#groups.get(id);\n    if (!group) {\n      warn(`Optional content group not found: ${id}`);\n      return;\n    }\n\n    // If the visibility is about to be set to `true` and the group belongs to\n    // any radiobutton groups, hide all other OCGs in these radiobutton groups,\n    // provided that radiobutton state relationships are to be preserved.\n    if (preserveRB && visible && group.rbGroups.length) {\n      for (const rbGroup of group.rbGroups) {\n        for (const otherId of rbGroup) {\n          if (otherId !== id) {\n            this.#groups.get(otherId)?._setVisible(INTERNAL, false, true);\n          }\n        }\n      }\n    }\n\n    group._setVisible(INTERNAL, !!visible, /* userSet = */ true);\n\n    this.#cachedGetHash = null;\n  }\n\n  setOCGState({ state, preserveRB }) {\n    let operator;\n\n    for (const elem of state) {\n      switch (elem) {\n        case \"ON\":\n        case \"OFF\":\n        case \"Toggle\":\n          operator = elem;\n          continue;\n      }\n\n      const group = this.#groups.get(elem);\n      if (!group) {\n        continue;\n      }\n      switch (operator) {\n        case \"ON\":\n          this.setVisibility(elem, true, preserveRB);\n          break;\n        case \"OFF\":\n          this.setVisibility(elem, false, preserveRB);\n          break;\n        case \"Toggle\":\n          this.setVisibility(elem, !group.visible, preserveRB);\n          break;\n      }\n    }\n\n    this.#cachedGetHash = null;\n  }\n\n  get hasInitialVisibility() {\n    return this.#initialHash === null || this.getHash() === this.#initialHash;\n  }\n\n  getOrder() {\n    if (!this.#groups.size) {\n      return null;\n    }\n    if (this.#order) {\n      return this.#order.slice();\n    }\n    return [...this.#groups.keys()];\n  }\n\n  getGroup(id) {\n    return this.#groups.get(id) || null;\n  }\n\n  getHash() {\n    if (this.#cachedGetHash !== null) {\n      return this.#cachedGetHash;\n    }\n    const hash = new MurmurHash3_64();\n\n    for (const [id, group] of this.#groups) {\n      hash.update(`${id}:${group.visible}`);\n    }\n    return (this.#cachedGetHash = hash.hexdigest());\n  }\n\n  [Symbol.iterator]() {\n    return this.#groups.entries();\n  }\n}\n\nexport { OptionalContentConfig };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../interfaces\").IPDFStream} IPDFStream */\n/** @typedef {import(\"../interfaces\").IPDFStreamReader} IPDFStreamReader */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../interfaces\").IPDFStreamRangeReader} IPDFStreamRangeReader */\n\nimport { assert } from \"../shared/util.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\n/** @implements {IPDFStream} */\nclass PDFDataTransportStream {\n  constructor(\n    pdfDataRangeTransport,\n    { disableRange = false, disableStream = false }\n  ) {\n    assert(\n      pdfDataRangeTransport,\n      'PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.'\n    );\n    const { length, initialData, progressiveDone, contentDispositionFilename } =\n      pdfDataRangeTransport;\n\n    this._queuedChunks = [];\n    this._progressiveDone = progressiveDone;\n    this._contentDispositionFilename = contentDispositionFilename;\n\n    if (initialData?.length > 0) {\n      // Prevent any possible issues by only transferring a Uint8Array that\n      // completely \"utilizes\" its underlying ArrayBuffer.\n      const buffer =\n        initialData instanceof Uint8Array &&\n        initialData.byteLength === initialData.buffer.byteLength\n          ? initialData.buffer\n          : new Uint8Array(initialData).buffer;\n      this._queuedChunks.push(buffer);\n    }\n\n    this._pdfDataRangeTransport = pdfDataRangeTransport;\n    this._isStreamingSupported = !disableStream;\n    this._isRangeSupported = !disableRange;\n    this._contentLength = length;\n\n    this._fullRequestReader = null;\n    this._rangeReaders = [];\n\n    pdfDataRangeTransport.addRangeListener((begin, chunk) => {\n      this._onReceiveData({ begin, chunk });\n    });\n\n    pdfDataRangeTransport.addProgressListener((loaded, total) => {\n      this._onProgress({ loaded, total });\n    });\n\n    pdfDataRangeTransport.addProgressiveReadListener(chunk => {\n      this._onReceiveData({ chunk });\n    });\n\n    pdfDataRangeTransport.addProgressiveDoneListener(() => {\n      this._onProgressiveDone();\n    });\n\n    pdfDataRangeTransport.transportReady();\n  }\n\n  _onReceiveData({ begin, chunk }) {\n    // Prevent any possible issues by only transferring a Uint8Array that\n    // completely \"utilizes\" its underlying ArrayBuffer.\n    const buffer =\n      chunk instanceof Uint8Array &&\n      chunk.byteLength === chunk.buffer.byteLength\n        ? chunk.buffer\n        : new Uint8Array(chunk).buffer;\n\n    if (begin === undefined) {\n      if (this._fullRequestReader) {\n        this._fullRequestReader._enqueue(buffer);\n      } else {\n        this._queuedChunks.push(buffer);\n      }\n    } else {\n      const found = this._rangeReaders.some(function (rangeReader) {\n        if (rangeReader._begin !== begin) {\n          return false;\n        }\n        rangeReader._enqueue(buffer);\n        return true;\n      });\n      assert(\n        found,\n        \"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.\"\n      );\n    }\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  _onProgress(evt) {\n    if (evt.total === undefined) {\n      // Reporting to first range reader, if it exists.\n      this._rangeReaders[0]?.onProgress?.({ loaded: evt.loaded });\n    } else {\n      this._fullRequestReader?.onProgress?.({\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    }\n  }\n\n  _onProgressiveDone() {\n    this._fullRequestReader?.progressiveDone();\n    this._progressiveDone = true;\n  }\n\n  _removeRangeReader(reader) {\n    const i = this._rangeReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFDataTransportStream.getFullReader can only be called once.\"\n    );\n    const queuedChunks = this._queuedChunks;\n    this._queuedChunks = null;\n    return new PDFDataTransportStreamReader(\n      this,\n      queuedChunks,\n      this._progressiveDone,\n      this._contentDispositionFilename\n    );\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFDataTransportStreamRangeReader(this, begin, end);\n    this._pdfDataRangeTransport.requestDataRange(begin, end);\n    this._rangeReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n    this._pdfDataRangeTransport.abort();\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFDataTransportStreamReader {\n  constructor(\n    stream,\n    queuedChunks,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this._stream = stream;\n    this._done = progressiveDone || false;\n    this._filename = isPdfFile(contentDispositionFilename)\n      ? contentDispositionFilename\n      : null;\n    this._queuedChunks = queuedChunks || [];\n    this._loaded = 0;\n    for (const chunk of this._queuedChunks) {\n      this._loaded += chunk.byteLength;\n    }\n    this._requests = [];\n    this._headersReady = Promise.resolve();\n    stream._fullRequestReader = this;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // Ignore new data.\n    }\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunks.push(chunk);\n    }\n    this._loaded += chunk.byteLength;\n  }\n\n  get headersReady() {\n    return this._headersReady;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._stream._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._stream._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._stream._contentLength;\n  }\n\n  async read() {\n    if (this._queuedChunks.length > 0) {\n      const chunk = this._queuedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  progressiveDone() {\n    if (this._done) {\n      return;\n    }\n    this._done = true;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFDataTransportStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._begin = begin;\n    this._end = end;\n    this._queuedChunk = null;\n    this._requests = [];\n    this._done = false;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // ignore new data\n    }\n    if (this._requests.length === 0) {\n      this._queuedChunk = chunk;\n    } else {\n      const requestsCapability = this._requests.shift();\n      requestsCapability.resolve({ value: chunk, done: false });\n      for (const requestCapability of this._requests) {\n        requestCapability.resolve({ value: undefined, done: true });\n      }\n      this._requests.length = 0;\n    }\n    this._done = true;\n    this._stream._removeRangeReader(this);\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._queuedChunk) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._stream._removeRangeReader(this);\n  }\n}\n\nexport { PDFDataTransportStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, ResponseException } from \"../shared/util.js\";\nimport { getFilenameFromContentDispositionHeader } from \"./content_disposition.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\nfunction createHeaders(isHttp, httpHeaders) {\n  const headers = new Headers();\n\n  if (!isHttp || !httpHeaders || typeof httpHeaders !== \"object\") {\n    return headers;\n  }\n  for (const key in httpHeaders) {\n    const val = httpHeaders[key];\n    if (val !== undefined) {\n      headers.append(key, val);\n    }\n  }\n  return headers;\n}\n\nfunction getResponseOrigin(url) {\n  // Notably, null is distinct from \"null\" string (e.g. from file:-URLs).\n  return URL.parse(url)?.origin ?? null;\n}\n\nfunction validateRangeRequestCapabilities({\n  responseHeaders,\n  isHttp,\n  rangeChunkSize,\n  disableRange,\n}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      Number.isInteger(rangeChunkSize) && rangeChunkSize > 0,\n      \"rangeChunkSize must be an integer larger than zero.\"\n    );\n  }\n  const returnValues = {\n    allowRangeRequests: false,\n    suggestedLength: undefined,\n  };\n\n  const length = parseInt(responseHeaders.get(\"Content-Length\"), 10);\n  if (!Number.isInteger(length)) {\n    return returnValues;\n  }\n\n  returnValues.suggestedLength = length;\n\n  if (length <= 2 * rangeChunkSize) {\n    // The file size is smaller than the size of two chunks, so it does not\n    // make any sense to abort the request and retry with a range request.\n    return returnValues;\n  }\n\n  if (disableRange || !isHttp) {\n    return returnValues;\n  }\n  if (responseHeaders.get(\"Accept-Ranges\") !== \"bytes\") {\n    return returnValues;\n  }\n\n  const contentEncoding = responseHeaders.get(\"Content-Encoding\") || \"identity\";\n  if (contentEncoding !== \"identity\") {\n    return returnValues;\n  }\n\n  returnValues.allowRangeRequests = true;\n  return returnValues;\n}\n\nfunction extractFilenameFromHeader(responseHeaders) {\n  const contentDisposition = responseHeaders.get(\"Content-Disposition\");\n  if (contentDisposition) {\n    let filename = getFilenameFromContentDispositionHeader(contentDisposition);\n    if (filename.includes(\"%\")) {\n      try {\n        filename = decodeURIComponent(filename);\n      } catch {}\n    }\n    if (isPdfFile(filename)) {\n      return filename;\n    }\n  }\n  return null;\n}\n\nfunction createResponseError(status, url) {\n  return new ResponseException(\n    `Unexpected server response (${status}) while retrieving PDF \"${url}\".`,\n    status,\n    /* missing = */ status === 404 || (status === 0 && url.startsWith(\"file:\"))\n  );\n}\n\nfunction validateResponseStatus(status) {\n  return status === 200 || status === 206;\n}\n\nexport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n};\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes } from \"../shared/util.js\";\n\n// This getFilenameFromContentDispositionHeader function is adapted from\n// https://github.com/Rob--W/open-in-browser/blob/7e2e35a38b8b4e981b11da7b2f01df0149049e92/extension/content-disposition.js\n// with the following changes:\n// - Modified to conform to PDF.js's coding style.\n// - Move return to the end of the function to prevent Babel from dropping the\n//   function declarations.\n\n/**\n * Extract file name from the Content-Disposition HTTP response header.\n *\n * @param {string} contentDisposition\n * @returns {string} Filename, if found in the Content-Disposition header.\n */\nfunction getFilenameFromContentDispositionHeader(contentDisposition) {\n  let needsEncodingFixup = true;\n\n  // filename*=ext-value (\"ext-value\" from RFC 5987, referenced by RFC 6266).\n  let tmp = toParamRegExp(\"filename\\\\*\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = unescape(filename);\n    filename = rfc5987decode(filename);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // Continuations (RFC 2231 section 3, referenced by RFC 5987 section 3.1).\n  // filename*n*=part\n  // filename*n=part\n  tmp = rfc2231getparam(contentDisposition);\n  if (tmp) {\n    // RFC 2047, section\n    const filename = rfc2047decode(tmp);\n    return fixupEncoding(filename);\n  }\n\n  // filename=value (RFC 5987, section 4.1).\n  tmp = toParamRegExp(\"filename\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // After this line there are only function declarations. We cannot put\n  // \"return\" here for readability because babel would then drop the function\n  // declarations...\n  function toParamRegExp(attributePattern, flags) {\n    return new RegExp(\n      \"(?:^|;)\\\\s*\" +\n        attributePattern +\n        \"\\\\s*=\\\\s*\" +\n        // Captures: value = token | quoted-string\n        // (RFC 2616, section 3.6 and referenced by RFC 6266 4.1)\n        \"(\" +\n        '[^\";\\\\s][^;\\\\s]*' +\n        \"|\" +\n        '\"(?:[^\"\\\\\\\\]|\\\\\\\\\"?)+\"?' +\n        \")\",\n      flags\n    );\n  }\n  function textdecode(encoding, value) {\n    if (encoding) {\n      if (!/^[\\x00-\\xFF]+$/.test(value)) {\n        return value;\n      }\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(value);\n        value = decoder.decode(buffer);\n        needsEncodingFixup = false;\n      } catch {\n        // TextDecoder constructor threw - unrecognized encoding.\n      }\n    }\n    return value;\n  }\n  function fixupEncoding(value) {\n    if (needsEncodingFixup && /[\\x80-\\xff]/.test(value)) {\n      // Maybe multi-byte UTF-8.\n      value = textdecode(\"utf-8\", value);\n      if (needsEncodingFixup) {\n        // Try iso-8859-1 encoding.\n        value = textdecode(\"iso-8859-1\", value);\n      }\n    }\n    return value;\n  }\n  function rfc2231getparam(contentDispositionStr) {\n    const matches = [];\n    let match;\n    // Iterate over all filename*n= and filename*n*= with n being an integer\n    // of at least zero. Any non-zero number must not start with '0'.\n    const iter = toParamRegExp(\"filename\\\\*((?!0\\\\d)\\\\d+)(\\\\*?)\", \"ig\");\n    while ((match = iter.exec(contentDispositionStr)) !== null) {\n      let [, n, quot, part] = match; // eslint-disable-line prefer-const\n      n = parseInt(n, 10);\n      if (n in matches) {\n        // Ignore anything after the invalid second filename*0.\n        if (n === 0) {\n          break;\n        }\n        continue;\n      }\n      matches[n] = [quot, part];\n    }\n    const parts = [];\n    for (let n = 0; n < matches.length; ++n) {\n      if (!(n in matches)) {\n        // Numbers must be consecutive. Truncate when there is a hole.\n        break;\n      }\n      let [quot, part] = matches[n]; // eslint-disable-line prefer-const\n      part = rfc2616unquote(part);\n      if (quot) {\n        part = unescape(part);\n        if (n === 0) {\n          part = rfc5987decode(part);\n        }\n      }\n      parts.push(part);\n    }\n    return parts.join(\"\");\n  }\n  function rfc2616unquote(value) {\n    if (value.startsWith('\"')) {\n      const parts = value.slice(1).split('\\\\\"');\n      // Find the first unescaped \" and terminate there.\n      for (let i = 0; i < parts.length; ++i) {\n        const quotindex = parts[i].indexOf('\"');\n        if (quotindex !== -1) {\n          parts[i] = parts[i].slice(0, quotindex);\n          parts.length = i + 1; // Truncates and stop the iteration.\n        }\n        parts[i] = parts[i].replaceAll(/\\\\(.)/g, \"$1\");\n      }\n      value = parts.join('\"');\n    }\n    return value;\n  }\n  function rfc5987decode(extvalue) {\n    // Decodes \"ext-value\" from RFC 5987.\n    const encodingend = extvalue.indexOf(\"'\");\n    if (encodingend === -1) {\n      // Some servers send \"filename*=\" without encoding 'language' prefix,\n      // e.g. in https://github.com/Rob--W/open-in-browser/issues/26\n      // Let's accept the value like Firefox (57) (Chrome 62 rejects it).\n      return extvalue;\n    }\n    const encoding = extvalue.slice(0, encodingend);\n    const langvalue = extvalue.slice(encodingend + 1);\n    // Ignore language (RFC 5987 section 3.2.1, and RFC 6266 section 4.1 ).\n    const value = langvalue.replace(/^[^']*'/, \"\");\n    return textdecode(encoding, value);\n  }\n  function rfc2047decode(value) {\n    // RFC 2047-decode the result. Firefox tried to drop support for it, but\n    // backed out because some servers use it - https://bugzil.la/875615\n    // Firefox's condition for decoding is here: https://searchfox.org/mozilla-central/rev/4a590a5a15e35d88a3b23dd6ac3c471cf85b04a8/netwerk/mime/nsMIMEHeaderParamImpl.cpp#742-748\n\n    // We are more strict and only recognize RFC 2047-encoding if the value\n    // starts with \"=?\", since then it is likely that the full value is\n    // RFC 2047-encoded.\n\n    // Firefox also decodes words even where RFC 2047 section 5 states:\n    // \"An 'encoded-word' MUST NOT appear within a 'quoted-string'.\"\n    if (!value.startsWith(\"=?\") || /[\\x00-\\x19\\x80-\\xff]/.test(value)) {\n      return value;\n    }\n    // RFC 2047, section 2.4\n    // encoded-word = \"=?\" charset \"?\" encoding \"?\" encoded-text \"?=\"\n    // charset = token (but let's restrict to characters that denote a\n    //       possibly valid encoding).\n    // encoding = q or b\n    // encoded-text = any printable ASCII character other than ? or space.\n    //        ... but Firefox permits ? and space.\n    return value.replaceAll(\n      /=\\?([\\w-]*)\\?([QqBb])\\?((?:[^?]|\\?(?!=))*)\\?=/g,\n      function (matches, charset, encoding, text) {\n        if (encoding === \"q\" || encoding === \"Q\") {\n          // RFC 2047 section 4.2.\n          text = text.replaceAll(\"_\", \" \");\n          text = text.replaceAll(/=([0-9a-fA-F]{2})/g, function (match, hex) {\n            return String.fromCharCode(parseInt(hex, 16));\n          });\n          return textdecode(charset, text);\n        } // else encoding is b or B - base64 (RFC 2047 section 4.1)\n        try {\n          text = atob(text);\n        } catch {}\n        return textdecode(charset, text);\n      }\n    );\n  }\n\n  return \"\";\n}\n\nexport { getFilenameFromContentDispositionHeader };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AbortException, assert, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./fetch_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nfunction createFetchOptions(headers, withCredentials, abortController) {\n  return {\n    method: \"GET\",\n    headers,\n    signal: abortController.signal,\n    mode: \"cors\",\n    credentials: withCredentials ? \"include\" : \"same-origin\",\n    redirect: \"follow\",\n  };\n}\n\nfunction getArrayBuffer(val) {\n  if (val instanceof Uint8Array) {\n    return val.buffer;\n  }\n  if (val instanceof ArrayBuffer) {\n    return val;\n  }\n  warn(`getArrayBuffer - unexpected data format: ${val}`);\n  return new Uint8Array(val).buffer;\n}\n\n/** @implements {IPDFStream} */\nclass PDFFetchStream {\n  _responseOrigin = null;\n\n  constructor(source) {\n    this.source = source;\n    this.isHttp = /^https?:/i.test(source.url);\n    this.headers = createHeaders(this.isHttp, source.httpHeaders);\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFFetchStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFFetchStreamReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFFetchStreamRangeReader(this, begin, end);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFFetchStreamReader {\n  constructor(stream) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    this._filename = null;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._contentLength = source.length;\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._abortController = new AbortController();\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        stream._responseOrigin = getResponseOrigin(response.url);\n\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._reader = response.body.getReader();\n        this._headersCapability.resolve();\n\n        const responseHeaders = response.headers;\n\n        const { allowRangeRequests, suggestedLength } =\n          validateRangeRequestCapabilities({\n            responseHeaders,\n            isHttp: stream.isHttp,\n            rangeChunkSize: this._rangeChunkSize,\n            disableRange: this._disableRange,\n          });\n\n        this._isRangeSupported = allowRangeRequests;\n        // Setting right content length.\n        this._contentLength = suggestedLength || this._contentLength;\n\n        this._filename = extractFilenameFromHeader(responseHeaders);\n\n        // We need to stop reading when range is supported and streaming is\n        // disabled.\n        if (!this._isStreamingSupported && this._isRangeSupported) {\n          this.cancel(new AbortException(\"Streaming is disabled.\"));\n        }\n      })\n      .catch(this._headersCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFFetchStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._readCapability = Promise.withResolvers();\n    this._isStreamingSupported = !source.disableStream;\n\n    this._abortController = new AbortController();\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n    headers.append(\"Range\", `bytes=${begin}-${end - 1}`);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        const responseOrigin = getResponseOrigin(response.url);\n\n        if (responseOrigin !== stream._responseOrigin) {\n          throw new Error(\n            `Expected range response-origin \"${responseOrigin}\" to match \"${stream._responseOrigin}\".`\n          );\n        }\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._readCapability.resolve();\n        this._reader = response.body.getReader();\n      })\n      .catch(this._readCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({ loaded: this._loaded });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\nexport { PDFFetchStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, stringToBytes, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./network.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst OK_RESPONSE = 200;\nconst PARTIAL_CONTENT_RESPONSE = 206;\n\nfunction getArrayBuffer(xhr) {\n  const data = xhr.response;\n  if (typeof data !== \"string\") {\n    return data;\n  }\n  return stringToBytes(data).buffer;\n}\n\nclass NetworkManager {\n  _responseOrigin = null;\n\n  constructor({ url, httpHeaders, withCredentials }) {\n    this.url = url;\n    this.isHttp = /^https?:/i.test(url);\n    this.headers = createHeaders(this.isHttp, httpHeaders);\n    this.withCredentials = withCredentials || false;\n\n    this.currXhrId = 0;\n    this.pendingRequests = Object.create(null);\n  }\n\n  request(args) {\n    const xhr = new XMLHttpRequest();\n    const xhrId = this.currXhrId++;\n    const pendingRequest = (this.pendingRequests[xhrId] = { xhr });\n\n    xhr.open(\"GET\", this.url);\n    xhr.withCredentials = this.withCredentials;\n    for (const [key, val] of this.headers) {\n      xhr.setRequestHeader(key, val);\n    }\n    if (this.isHttp && \"begin\" in args && \"end\" in args) {\n      xhr.setRequestHeader(\"Range\", `bytes=${args.begin}-${args.end - 1}`);\n      pendingRequest.expectedStatus = PARTIAL_CONTENT_RESPONSE;\n    } else {\n      pendingRequest.expectedStatus = OK_RESPONSE;\n    }\n    xhr.responseType = \"arraybuffer\";\n\n    assert(args.onError, \"Expected `onError` callback to be provided.\");\n    xhr.onerror = () => {\n      args.onError(xhr.status);\n    };\n    xhr.onreadystatechange = this.onStateChange.bind(this, xhrId);\n    xhr.onprogress = this.onProgress.bind(this, xhrId);\n\n    pendingRequest.onHeadersReceived = args.onHeadersReceived;\n    pendingRequest.onDone = args.onDone;\n    pendingRequest.onError = args.onError;\n    pendingRequest.onProgress = args.onProgress;\n\n    xhr.send(null);\n\n    return xhrId;\n  }\n\n  onProgress(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n    pendingRequest.onProgress?.(evt);\n  }\n\n  onStateChange(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n\n    const xhr = pendingRequest.xhr;\n    if (xhr.readyState >= 2 && pendingRequest.onHeadersReceived) {\n      pendingRequest.onHeadersReceived();\n      delete pendingRequest.onHeadersReceived;\n    }\n\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    if (!(xhrId in this.pendingRequests)) {\n      // The XHR request might have been aborted in onHeadersReceived()\n      // callback, in which case we should abort request.\n      return;\n    }\n\n    delete this.pendingRequests[xhrId];\n\n    // Success status == 0 can be on ftp, file and other protocols.\n    if (xhr.status === 0 && this.isHttp) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n    const xhrStatus = xhr.status || OK_RESPONSE;\n\n    // From http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2:\n    // \"A server MAY ignore the Range header\". This means it's possible to\n    // get a 200 rather than a 206 response from a range request.\n    const ok_response_on_range_request =\n      xhrStatus === OK_RESPONSE &&\n      pendingRequest.expectedStatus === PARTIAL_CONTENT_RESPONSE;\n\n    if (\n      !ok_response_on_range_request &&\n      xhrStatus !== pendingRequest.expectedStatus\n    ) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n\n    const chunk = getArrayBuffer(xhr);\n    if (xhrStatus === PARTIAL_CONTENT_RESPONSE) {\n      const rangeHeader = xhr.getResponseHeader(\"Content-Range\");\n      const matches = /bytes (\\d+)-(\\d+)\\/(\\d+)/.exec(rangeHeader);\n      if (matches) {\n        pendingRequest.onDone({\n          begin: parseInt(matches[1], 10),\n          chunk,\n        });\n      } else {\n        warn(`Missing or invalid \"Content-Range\" header.`);\n        pendingRequest.onError(0);\n      }\n    } else if (chunk) {\n      pendingRequest.onDone({\n        begin: 0,\n        chunk,\n      });\n    } else {\n      pendingRequest.onError(xhr.status);\n    }\n  }\n\n  getRequestXhr(xhrId) {\n    return this.pendingRequests[xhrId].xhr;\n  }\n\n  isPendingRequest(xhrId) {\n    return xhrId in this.pendingRequests;\n  }\n\n  abortRequest(xhrId) {\n    const xhr = this.pendingRequests[xhrId].xhr;\n    delete this.pendingRequests[xhrId];\n    xhr.abort();\n  }\n}\n\n/** @implements {IPDFStream} */\nclass PDFNetworkStream {\n  constructor(source) {\n    this._source = source;\n    this._manager = new NetworkManager(source);\n    this._rangeChunkSize = source.rangeChunkSize;\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  _onRangeRequestReaderClosed(reader) {\n    const i = this._rangeRequestReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeRequestReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNetworkStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNetworkStreamFullRequestReader(\n      this._manager,\n      this._source\n    );\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    const reader = new PDFNetworkStreamRangeRequestReader(\n      this._manager,\n      begin,\n      end\n    );\n    reader.onClosed = this._onRangeRequestReaderClosed.bind(this);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFNetworkStreamFullRequestReader {\n  constructor(manager, source) {\n    this._manager = manager;\n\n    this._url = source.url;\n    this._fullRequestId = manager.request({\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._contentLength = source.length; // Optional\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = false;\n    this._isRangeSupported = false;\n\n    this._cachedChunks = [];\n    this._requests = [];\n    this._done = false;\n    this._storedError = undefined;\n    this._filename = null;\n\n    this.onProgress = null;\n  }\n\n  _onHeadersReceived() {\n    const fullRequestXhrId = this._fullRequestId;\n    const fullRequestXhr = this._manager.getRequestXhr(fullRequestXhrId);\n\n    this._manager._responseOrigin = getResponseOrigin(\n      fullRequestXhr.responseURL\n    );\n\n    const rawResponseHeaders = fullRequestXhr.getAllResponseHeaders();\n    const responseHeaders = new Headers(\n      rawResponseHeaders\n        ? rawResponseHeaders\n            .trimStart()\n            .replace(/[^\\S ]+$/, \"\") // Not `trimEnd`, to keep regular spaces.\n            .split(/[\\r\\n]+/)\n            .map(x => {\n              const [key, ...val] = x.split(\": \");\n              return [key, val.join(\": \")];\n            })\n        : []\n    );\n\n    const { allowRangeRequests, suggestedLength } =\n      validateRangeRequestCapabilities({\n        responseHeaders,\n        isHttp: this._manager.isHttp,\n        rangeChunkSize: this._rangeChunkSize,\n        disableRange: this._disableRange,\n      });\n\n    if (allowRangeRequests) {\n      this._isRangeSupported = true;\n    }\n    // Setting right content length.\n    this._contentLength = suggestedLength || this._contentLength;\n\n    this._filename = extractFilenameFromHeader(responseHeaders);\n\n    if (this._isRangeSupported) {\n      // NOTE: by cancelling the full request, and then issuing range\n      // requests, there will be an issue for sites where you can only\n      // request the pdf once. However, if this is the case, then the\n      // server should not be returning that it can support range requests.\n      this._manager.abortRequest(fullRequestXhrId);\n    }\n\n    this._headersCapability.resolve();\n  }\n\n  _onDone(data) {\n    if (data) {\n      if (this._requests.length > 0) {\n        const requestCapability = this._requests.shift();\n        requestCapability.resolve({ value: data.chunk, done: false });\n      } else {\n        this._cachedChunks.push(data.chunk);\n      }\n    }\n    this._done = true;\n    if (this._cachedChunks.length > 0) {\n      return;\n    }\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  _onError(status) {\n    this._storedError = createResponseError(status, this._url);\n    this._headersCapability.reject(this._storedError);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._cachedChunks.length = 0;\n  }\n\n  _onProgress(evt) {\n    this.onProgress?.({\n      loaded: evt.loaded,\n      total: evt.lengthComputable ? evt.total : this._contentLength,\n    });\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._cachedChunks.length > 0) {\n      const chunk = this._cachedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    this._headersCapability.reject(reason);\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._fullRequestId)) {\n      this._manager.abortRequest(this._fullRequestId);\n    }\n    this._fullRequestReader = null;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFNetworkStreamRangeRequestReader {\n  constructor(manager, begin, end) {\n    this._manager = manager;\n\n    this._url = manager.url;\n    this._requestId = manager.request({\n      begin,\n      end,\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._requests = [];\n    this._queuedChunk = null;\n    this._done = false;\n    this._storedError = undefined;\n\n    this.onProgress = null;\n    this.onClosed = null;\n  }\n\n  _onHeadersReceived() {\n    const responseOrigin = getResponseOrigin(\n      this._manager.getRequestXhr(this._requestId)?.responseURL\n    );\n\n    if (responseOrigin !== this._manager._responseOrigin) {\n      this._storedError = new Error(\n        `Expected range response-origin \"${responseOrigin}\" to match \"${this._manager._responseOrigin}\".`\n      );\n      this._onError(0);\n    }\n  }\n\n  _close() {\n    this.onClosed?.(this);\n  }\n\n  _onDone(data) {\n    const chunk = data.chunk;\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunk = chunk;\n    }\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._close();\n  }\n\n  _onError(status) {\n    this._storedError ??= createResponseError(status, this._url);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._queuedChunk = null;\n  }\n\n  _onProgress(evt) {\n    if (!this.isStreamingSupported) {\n      this.onProgress?.({ loaded: evt.loaded });\n    }\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._queuedChunk !== null) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._requestId)) {\n      this._manager.abortRequest(this._requestId);\n    }\n    this._close();\n  }\n}\n\nexport { PDFNetworkStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { AbortException, assert } from \"../shared/util.js\";\nimport { createResponseError } from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst urlRegex = /^[a-z][a-z0-9\\-+.]+:/i;\n\nfunction parseUrlOrPath(sourceUrl) {\n  if (urlRegex.test(sourceUrl)) {\n    return new URL(sourceUrl);\n  }\n  const url = process.getBuiltinModule(\"url\");\n  return new URL(url.pathToFileURL(sourceUrl));\n}\n\nclass PDFNodeStream {\n  constructor(source) {\n    this.source = source;\n    this.url = parseUrlOrPath(source.url);\n    assert(\n      this.url.protocol === \"file:\",\n      \"PDFNodeStream only supports file:// URLs.\"\n    );\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNodeStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNodeStreamFsFullReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(start, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const rangeReader = new PDFNodeStreamFsRangeReader(this, start, end);\n    this._rangeRequestReaders.push(rangeReader);\n    return rangeReader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\nclass PDFNodeStreamFsFullReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    const source = stream.source;\n    this._contentLength = source.length; // optional\n    this._loaded = 0;\n    this._filename = null;\n\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    this._headersCapability = Promise.withResolvers();\n\n    const fs = process.getBuiltinModule(\"fs\");\n    fs.promises.lstat(this._url).then(\n      stat => {\n        // Setting right content length.\n        this._contentLength = stat.size;\n\n        this._setReadableStream(fs.createReadStream(this._url));\n        this._headersCapability.resolve();\n      },\n      error => {\n        if (error.code === \"ENOENT\") {\n          error = createResponseError(/* status = */ 0, this._url.href);\n        }\n        this._storedError = error;\n        this._headersCapability.reject(error);\n      }\n    );\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readable to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // We need to stop reading when range is supported and streaming is\n    // disabled.\n    if (!this._isStreamingSupported && this._isRangeSupported) {\n      this._error(new AbortException(\"streaming is disabled\"));\n    }\n\n    // Destroy ReadableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nclass PDFNodeStreamFsRangeReader {\n  constructor(stream, start, end) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    this._loaded = 0;\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    const source = stream.source;\n    this._isStreamingSupported = !source.disableStream;\n\n    const fs = process.getBuiltinModule(\"fs\");\n    this._setReadableStream(\n      fs.createReadStream(this._url, { start, end: end - 1 })\n    );\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({ loaded: this._loaded });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readableStream to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // Destroy readableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nexport { PDFNodeStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst INITIAL_DATA = Symbol(\"INITIAL_DATA\");\n\n/**\n * A PDF document and page is built of many objects. E.g. there are objects for\n * fonts, images, rendering code, etc. These objects may get processed inside of\n * a worker. This class implements some basic methods to manage these objects.\n */\nclass PDFObjects {\n  #objs = Object.create(null);\n\n  /**\n   * Ensures there is an object defined for `objId`.\n   *\n   * @param {string} objId\n   * @returns {Object}\n   */\n  #ensureObj(objId) {\n    return (this.#objs[objId] ||= {\n      ...Promise.withResolvers(),\n      data: INITIAL_DATA,\n    });\n  }\n\n  /**\n   * If called *without* callback, this returns the data of `objId` but the\n   * object needs to be resolved. If it isn't, this method throws.\n   *\n   * If called *with* a callback, the callback is called with the data of the\n   * object once the object is resolved. That means, if you call this method\n   * and the object is already resolved, the callback gets called right away.\n   *\n   * @param {string} objId\n   * @param {function} [callback]\n   * @returns {any}\n   */\n  get(objId, callback = null) {\n    // If there is a callback, then the get can be async and the object is\n    // not required to be resolved right now.\n    if (callback) {\n      const obj = this.#ensureObj(objId);\n      obj.promise.then(() => callback(obj.data));\n      return null;\n    }\n    // If there isn't a callback, the user expects to get the resolved data\n    // directly.\n    const obj = this.#objs[objId];\n    // If there isn't an object yet or the object isn't resolved, then the\n    // data isn't ready yet!\n    if (!obj || obj.data === INITIAL_DATA) {\n      throw new Error(`Requesting object that isn't resolved yet ${objId}.`);\n    }\n    return obj.data;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  has(objId) {\n    const obj = this.#objs[objId];\n    return !!obj && obj.data !== INITIAL_DATA;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  delete(objId) {\n    const obj = this.#objs[objId];\n    if (!obj || obj.data === INITIAL_DATA) {\n      // Only allow removing the object *after* it's been resolved.\n      return false;\n    }\n    delete this.#objs[objId];\n    return true;\n  }\n\n  /**\n   * Resolves the object `objId` with optional `data`.\n   *\n   * @param {string} objId\n   * @param {any} [data]\n   */\n  resolve(objId, data = null) {\n    const obj = this.#ensureObj(objId);\n    obj.data = data;\n    obj.resolve();\n  }\n\n  clear() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n      data?.bitmap?.close(); // Release any `ImageBitmap` data.\n    }\n    this.#objs = Object.create(null);\n  }\n\n  *[Symbol.iterator]() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n\n      if (data === INITIAL_DATA) {\n        continue;\n      }\n      yield [objId, data];\n    }\n  }\n}\n\nexport { PDFObjects };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nimport {\n  AbortException,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { OutputScale, setLayerDimensions } from \"./display_utils.js\";\n\n/**\n * @typedef {Object} TextLayerParameters\n * @property {ReadableStream | TextContent} textContentSource - Text content to\n *   render, i.e. the value returned by the page's `streamTextContent` or\n *   `getTextContent` method.\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n */\n\n/**\n * @typedef {Object} TextLayerUpdateParameters\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {function} [onBefore] - Callback invoked before the textLayer is\n *   updated in the DOM.\n */\n\nconst MAX_TEXT_DIVS_TO_RENDER = 100000;\nconst DEFAULT_FONT_SIZE = 30;\n\nclass TextLayer {\n  #capability = Promise.withResolvers();\n\n  #container = null;\n\n  #disableProcessItems = false;\n\n  #fontInspectorEnabled = !!globalThis.FontInspector?.enabled;\n\n  #lang = null;\n\n  #layoutTextParams = null;\n\n  #pageHeight = 0;\n\n  #pageWidth = 0;\n\n  #reader = null;\n\n  #rootContainer = null;\n\n  #rotation = 0;\n\n  #scale = 0;\n\n  #styleCache = Object.create(null);\n\n  #textContentItemsStr = [];\n\n  #textContentSource = null;\n\n  #textDivs = [];\n\n  #textDivProperties = new WeakMap();\n\n  #transform = null;\n\n  static #ascentCache = new Map();\n\n  static #canvasContexts = new Map();\n\n  static #canvasCtxFonts = new WeakMap();\n\n  static #minFontSize = null;\n\n  static #pendingTextLayers = new Set();\n\n  /**\n   * @param {TextLayerParameters} options\n   */\n  constructor({ textContentSource, container, viewport }) {\n    if (textContentSource instanceof ReadableStream) {\n      this.#textContentSource = textContentSource;\n    } else if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      typeof textContentSource === \"object\"\n    ) {\n      this.#textContentSource = new ReadableStream({\n        start(controller) {\n          controller.enqueue(textContentSource);\n          controller.close();\n        },\n      });\n    } else {\n      throw new Error('No \"textContentSource\" parameter specified.');\n    }\n    this.#container = this.#rootContainer = container;\n\n    this.#scale = viewport.scale * OutputScale.pixelRatio;\n    this.#rotation = viewport.rotation;\n    this.#layoutTextParams = {\n      div: null,\n      properties: null,\n      ctx: null,\n    };\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n    this.#transform = [1, 0, 0, -1, -pageX, pageY + pageHeight];\n    this.#pageWidth = pageWidth;\n    this.#pageHeight = pageHeight;\n\n    TextLayer.#ensureMinFontSizeComputed();\n\n    setLayerDimensions(container, viewport);\n\n    // Always clean-up the temporary canvas once rendering is no longer pending.\n    this.#capability.promise\n      .finally(() => {\n        TextLayer.#pendingTextLayers.delete(this);\n        this.#layoutTextParams = null;\n        this.#styleCache = null;\n      })\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"pageWidth\", {\n        get() {\n          return this.#pageWidth;\n        },\n      });\n      Object.defineProperty(this, \"pageHeight\", {\n        get() {\n          return this.#pageHeight;\n        },\n      });\n    }\n  }\n\n  static get fontFamilyMap() {\n    const { isWindows, isFirefox } = FeatureTest.platform;\n    return shadow(\n      this,\n      \"fontFamilyMap\",\n      new Map([\n        [\n          \"sans-serif\",\n          `${isWindows && isFirefox ? \"Calibri, \" : \"\"}sans-serif`,\n        ],\n        [\n          \"monospace\",\n          `${isWindows && isFirefox ? \"Lucida Console, \" : \"\"}monospace`,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * Render the textLayer.\n   * @returns {Promise}\n   */\n  render() {\n    const pump = () => {\n      this.#reader.read().then(({ value, done }) => {\n        if (done) {\n          this.#capability.resolve();\n          return;\n        }\n        this.#lang ??= value.lang;\n        Object.assign(this.#styleCache, value.styles);\n        this.#processItems(value.items);\n        pump();\n      }, this.#capability.reject);\n    };\n    this.#reader = this.#textContentSource.getReader();\n    TextLayer.#pendingTextLayers.add(this);\n    pump();\n\n    return this.#capability.promise;\n  }\n\n  /**\n   * Update a previously rendered textLayer, if necessary.\n   * @param {TextLayerUpdateParameters} options\n   * @returns {undefined}\n   */\n  update({ viewport, onBefore = null }) {\n    const scale = viewport.scale * OutputScale.pixelRatio;\n    const rotation = viewport.rotation;\n\n    if (rotation !== this.#rotation) {\n      onBefore?.();\n      this.#rotation = rotation;\n      setLayerDimensions(this.#rootContainer, { rotation });\n    }\n\n    if (scale !== this.#scale) {\n      onBefore?.();\n      this.#scale = scale;\n      const params = {\n        div: null,\n        properties: null,\n        ctx: TextLayer.#getCtx(this.#lang),\n      };\n      for (const div of this.#textDivs) {\n        params.properties = this.#textDivProperties.get(div);\n        params.div = div;\n        this.#layout(params);\n      }\n    }\n  }\n\n  /**\n   * Cancel rendering of the textLayer.\n   * @returns {undefined}\n   */\n  cancel() {\n    const abortEx = new AbortException(\"TextLayer task cancelled.\");\n\n    this.#reader?.cancel(abortEx).catch(() => {\n      // Avoid \"Uncaught promise\" messages in the console.\n    });\n    this.#reader = null;\n\n    this.#capability.reject(abortEx);\n  }\n\n  /**\n   * @type {Array<HTMLElement>} HTML elements that correspond to the text items\n   *   of the textContent input.\n   *   This is output and will initially be set to an empty array.\n   */\n  get textDivs() {\n    return this.#textDivs;\n  }\n\n  /**\n   * @type {Array<string>} Strings that correspond to the `str` property of\n   *   the text items of the textContent input.\n   *   This is output and will initially be set to an empty array\n   */\n  get textContentItemsStr() {\n    return this.#textContentItemsStr;\n  }\n\n  #processItems(items) {\n    if (this.#disableProcessItems) {\n      return;\n    }\n    this.#layoutTextParams.ctx ??= TextLayer.#getCtx(this.#lang);\n\n    const textDivs = this.#textDivs,\n      textContentItemsStr = this.#textContentItemsStr;\n\n    for (const item of items) {\n      // No point in rendering many divs as it would make the browser\n      // unusable even after the divs are rendered.\n      if (textDivs.length > MAX_TEXT_DIVS_TO_RENDER) {\n        warn(\"Ignoring additional textDivs for performance reasons.\");\n\n        this.#disableProcessItems = true; // Avoid multiple warnings for one page.\n        return;\n      }\n\n      if (item.str === undefined) {\n        if (\n          item.type === \"beginMarkedContentProps\" ||\n          item.type === \"beginMarkedContent\"\n        ) {\n          const parent = this.#container;\n          this.#container = document.createElement(\"span\");\n          this.#container.classList.add(\"markedContent\");\n          if (item.id) {\n            this.#container.setAttribute(\"id\", `${item.id}`);\n          }\n          parent.append(this.#container);\n        } else if (item.type === \"endMarkedContent\") {\n          this.#container = this.#container.parentNode;\n        }\n        continue;\n      }\n      textContentItemsStr.push(item.str);\n      this.#appendText(item);\n    }\n  }\n\n  #appendText(geom) {\n    // Initialize all used properties to keep the caches monomorphic.\n    const textDiv = document.createElement(\"span\");\n    const textDivProperties = {\n      angle: 0,\n      canvasWidth: 0,\n      hasText: geom.str !== \"\",\n      hasEOL: geom.hasEOL,\n      fontSize: 0,\n    };\n    this.#textDivs.push(textDiv);\n\n    const tx = Util.transform(this.#transform, geom.transform);\n    let angle = Math.atan2(tx[1], tx[0]);\n    const style = this.#styleCache[geom.fontName];\n    if (style.vertical) {\n      angle += Math.PI / 2;\n    }\n\n    let fontFamily =\n      (this.#fontInspectorEnabled && style.fontSubstitution) ||\n      style.fontFamily;\n\n    // Workaround for bug 1922063.\n    fontFamily = TextLayer.fontFamilyMap.get(fontFamily) || fontFamily;\n    const fontHeight = Math.hypot(tx[2], tx[3]);\n    const fontAscent =\n      fontHeight * TextLayer.#getAscent(fontFamily, style, this.#lang);\n\n    let left, top;\n    if (angle === 0) {\n      left = tx[4];\n      top = tx[5] - fontAscent;\n    } else {\n      left = tx[4] + fontAscent * Math.sin(angle);\n      top = tx[5] - fontAscent * Math.cos(angle);\n    }\n\n    const scaleFactorStr = \"calc(var(--total-scale-factor) *\";\n    const divStyle = textDiv.style;\n    // Setting the style properties individually, rather than all at once,\n    // should be OK since the `textDiv` isn't appended to the document yet.\n    if (this.#container === this.#rootContainer) {\n      divStyle.left = `${((100 * left) / this.#pageWidth).toFixed(2)}%`;\n      divStyle.top = `${((100 * top) / this.#pageHeight).toFixed(2)}%`;\n    } else {\n      // We're in a marked content span, hence we can't use percents.\n      divStyle.left = `${scaleFactorStr}${left.toFixed(2)}px)`;\n      divStyle.top = `${scaleFactorStr}${top.toFixed(2)}px)`;\n    }\n    // We multiply the font size by #minFontSize, and then #layout will\n    // scale the element by 1/#minFontSize. This allows us to effectively\n    // ignore the minimum font size enforced by the browser, so that the text\n    // layer <span>s can always match the size of the text in the canvas.\n    divStyle.fontSize = `${scaleFactorStr}${(TextLayer.#minFontSize * fontHeight).toFixed(2)}px)`;\n    divStyle.fontFamily = fontFamily;\n\n    textDivProperties.fontSize = fontHeight;\n\n    // Keeps screen readers from pausing on every new text span.\n    textDiv.setAttribute(\"role\", \"presentation\");\n\n    textDiv.textContent = geom.str;\n    // geom.dir may be 'ttb' for vertical texts.\n    textDiv.dir = geom.dir;\n\n    // `fontName` is only used by the FontInspector, and we only use `dataset`\n    // here to make the font name available in the debugger.\n    if (this.#fontInspectorEnabled) {\n      textDiv.dataset.fontName =\n        style.fontSubstitutionLoadedName || geom.fontName;\n    }\n    if (angle !== 0) {\n      textDivProperties.angle = angle * (180 / Math.PI);\n    }\n    // We don't bother scaling single-char text divs, because it has very\n    // little effect on text highlighting. This makes scrolling on docs with\n    // lots of such divs a lot faster.\n    let shouldScaleText = false;\n    if (geom.str.length > 1) {\n      shouldScaleText = true;\n    } else if (geom.str !== \" \" && geom.transform[0] !== geom.transform[3]) {\n      const absScaleX = Math.abs(geom.transform[0]),\n        absScaleY = Math.abs(geom.transform[3]);\n      // When the horizontal/vertical scaling differs significantly, also scale\n      // even single-char text to improve highlighting (fixes issue11713.pdf).\n      if (\n        absScaleX !== absScaleY &&\n        Math.max(absScaleX, absScaleY) / Math.min(absScaleX, absScaleY) > 1.5\n      ) {\n        shouldScaleText = true;\n      }\n    }\n    if (shouldScaleText) {\n      textDivProperties.canvasWidth = style.vertical ? geom.height : geom.width;\n    }\n    this.#textDivProperties.set(textDiv, textDivProperties);\n\n    // Finally, layout and append the text to the DOM.\n    this.#layoutTextParams.div = textDiv;\n    this.#layoutTextParams.properties = textDivProperties;\n    this.#layout(this.#layoutTextParams);\n\n    if (textDivProperties.hasText) {\n      this.#container.append(textDiv);\n    }\n    if (textDivProperties.hasEOL) {\n      const br = document.createElement(\"br\");\n      br.setAttribute(\"role\", \"presentation\");\n      this.#container.append(br);\n    }\n  }\n\n  #layout(params) {\n    const { div, properties, ctx } = params;\n    const { style } = div;\n\n    let transform = \"\";\n    if (TextLayer.#minFontSize > 1) {\n      transform = `scale(${1 / TextLayer.#minFontSize})`;\n    }\n\n    if (properties.canvasWidth !== 0 && properties.hasText) {\n      const { fontFamily } = style;\n      const { canvasWidth, fontSize } = properties;\n\n      TextLayer.#ensureCtxFont(ctx, fontSize * this.#scale, fontFamily);\n      // Only measure the width for multi-char text divs, see `appendText`.\n      const { width } = ctx.measureText(div.textContent);\n\n      if (width > 0) {\n        transform = `scaleX(${(canvasWidth * this.#scale) / width}) ${transform}`;\n      }\n    }\n    if (properties.angle !== 0) {\n      transform = `rotate(${properties.angle}deg) ${transform}`;\n    }\n    if (transform.length > 0) {\n      style.transform = transform;\n    }\n  }\n\n  /**\n   * Clean-up global textLayer data.\n   * @returns {undefined}\n   */\n  static cleanup() {\n    if (this.#pendingTextLayers.size > 0) {\n      return;\n    }\n    this.#ascentCache.clear();\n\n    for (const { canvas } of this.#canvasContexts.values()) {\n      canvas.remove();\n    }\n    this.#canvasContexts.clear();\n  }\n\n  static #getCtx(lang = null) {\n    let ctx = this.#canvasContexts.get((lang ||= \"\"));\n    if (!ctx) {\n      // We don't use an OffscreenCanvas here because we use serif/sans serif\n      // fonts with it and they depends on the locale.\n      // In Firefox, the <html> element get a lang attribute that depends on\n      // what Fluent returns for the locale and the OffscreenCanvas uses\n      // the OS locale.\n      // Those two locales can be different and consequently the used fonts will\n      // be different (see bug 1869001).\n      // Ideally, we should use in the text layer the fonts we've in the pdf (or\n      // their replacements when they aren't embedded) and then we can use an\n      // OffscreenCanvas.\n      const canvas = document.createElement(\"canvas\");\n      canvas.className = \"hiddenCanvasElement\";\n      canvas.lang = lang;\n      document.body.append(canvas);\n      ctx = canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: true,\n      });\n      this.#canvasContexts.set(lang, ctx);\n\n      // Also, initialize state for the `#ensureCtxFont` method.\n      this.#canvasCtxFonts.set(ctx, { size: 0, family: \"\" });\n    }\n    return ctx;\n  }\n\n  static #ensureCtxFont(ctx, size, family) {\n    const cached = this.#canvasCtxFonts.get(ctx);\n    if (size === cached.size && family === cached.family) {\n      return; // The font is already set.\n    }\n    ctx.font = `${size}px ${family}`;\n    cached.size = size;\n    cached.family = family;\n  }\n\n  /**\n   * Compute the minimum font size enforced by the browser.\n   */\n  static #ensureMinFontSizeComputed() {\n    if (this.#minFontSize !== null) {\n      return;\n    }\n    const div = document.createElement(\"div\");\n    div.style.opacity = 0;\n    div.style.lineHeight = 1;\n    div.style.fontSize = \"1px\";\n    div.style.position = \"absolute\";\n    div.textContent = \"X\";\n    document.body.append(div);\n    // In `display:block` elements contain a single line of text,\n    // the height matches the line height (which, when set to 1,\n    // matches the actual font size).\n    this.#minFontSize = div.getBoundingClientRect().height;\n    div.remove();\n  }\n\n  static #getAscent(fontFamily, style, lang) {\n    const cachedAscent = this.#ascentCache.get(fontFamily);\n    if (cachedAscent) {\n      return cachedAscent;\n    }\n    const ctx = this.#getCtx(lang);\n\n    ctx.canvas.width = ctx.canvas.height = DEFAULT_FONT_SIZE;\n    this.#ensureCtxFont(ctx, DEFAULT_FONT_SIZE, fontFamily);\n    const metrics = ctx.measureText(\"\");\n\n    const ascent = metrics.fontBoundingBoxAscent;\n    const descent = Math.abs(metrics.fontBoundingBoxDescent);\n\n    ctx.canvas.width = ctx.canvas.height = 0;\n    let ratio = 0.8; // DEFAULT_FONT_ASCENT\n\n    if (ascent) {\n      ratio = ascent / (ascent + descent);\n    } else {\n      if (\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        FeatureTest.platform.isFirefox\n      ) {\n        warn(\n          \"Enable the `dom.textMetrics.fontBoundingBox.enabled` preference \" +\n            \"in `about:config` to improve TextLayer rendering.\"\n        );\n      }\n      if (style.ascent) {\n        ratio = style.ascent;\n      } else if (style.descent) {\n        ratio = 1 + style.descent;\n      }\n    }\n\n    this.#ascentCache.set(fontFamily, ratio);\n    return ratio;\n  }\n}\n\nexport { TextLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module pdfjsLib\n */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  assert,\n  FeatureTest,\n  getVerbosityLevel,\n  info,\n  isNodeJS,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  AnnotationStorage,\n  PrintAnnotationStorage,\n  SerializableEmpty,\n} from \"./annotation_storage.js\";\nimport {\n  deprecated,\n  isDataScheme,\n  isValidFetchUrl,\n  PageViewport,\n  RenderingCancelledException,\n  StatTimer,\n} from \"./display_utils.js\";\nimport { FontFaceObject, FontLoader } from \"./font_loader.js\";\nimport { FontInfo, PatternInfo } from \"../shared/obj-bin-transform.js\";\nimport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isRefProxy,\n  LoopbackPort,\n} from \"./api_utils.js\";\nimport { MessageHandler, wrapReason } from \"../shared/message_handler.js\";\nimport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n} from \"display-node_utils\";\nimport { CanvasDependencyTracker } from \"./canvas_dependency_tracker.js\";\nimport { CanvasGraphics } from \"./canvas.js\";\nimport { DOMCanvasFactory } from \"./canvas_factory.js\";\nimport { DOMCMapReaderFactory } from \"display-cmap_reader_factory\";\nimport { DOMFilterFactory } from \"./filter_factory.js\";\nimport { DOMStandardFontDataFactory } from \"display-standard_fontdata_factory\";\nimport { DOMWasmFactory } from \"display-wasm_factory\";\nimport { GlobalWorkerOptions } from \"./worker_options.js\";\nimport { Metadata } from \"./metadata.js\";\nimport { OptionalContentConfig } from \"./optional_content_config.js\";\nimport { PDFDataTransportStream } from \"./transport_stream.js\";\nimport { PDFFetchStream } from \"display-fetch_stream\";\nimport { PDFNetworkStream } from \"display-network\";\nimport { PDFNodeStream } from \"display-node_stream\";\nimport { PDFObjects } from \"./pdf_objects.js\";\nimport { TextLayer } from \"./text_layer.js\";\nimport { XfaText } from \"./xfa_text.js\";\n\nconst RENDERING_CANCELLED_TIMEOUT = 100; // ms\n\n/**\n * @typedef { Int8Array | Uint8Array | Uint8ClampedArray |\n *            Int16Array | Uint16Array |\n *            Int32Array | Uint32Array | Float32Array |\n *            Float64Array\n * } TypedArray\n */\n\n/**\n * @typedef {Object} RefProxy\n * @property {number} num\n * @property {number} gen\n */\n\n/**\n * Document initialization / loading parameters object.\n *\n * @typedef {Object} DocumentInitParameters\n * @property {string | URL} [url] - The URL of the PDF.\n * @property {TypedArray | ArrayBuffer | Array<number> | string} [data] -\n *   Binary PDF data.\n *   Use TypedArrays (Uint8Array) to improve the memory usage. If PDF data is\n *   BASE64-encoded, use `atob()` to convert it to a binary string first.\n *\n *   NOTE: If TypedArrays are used they will generally be transferred to the\n *   worker-thread. This will help reduce main-thread memory usage, however\n *   it will take ownership of the TypedArrays.\n * @property {Object} [httpHeaders] - Basic authentication headers.\n * @property {boolean} [withCredentials] - Indicates whether or not\n *   cross-site Access-Control requests should be made using credentials such\n *   as cookies or authorization headers. The default is `false`.\n * @property {string} [password] - For decrypting password-protected PDFs.\n * @property {number} [length] - The PDF file length. It's used for progress\n *   reports and range requests operations.\n * @property {PDFDataRangeTransport} [range] - Allows for using a custom range\n *   transport implementation.\n * @property {number} [rangeChunkSize] - Specify maximum number of bytes fetched\n *   per range request. The default value is 65536 (= 2^16).\n * @property {PDFWorker} [worker] - The worker that will be used for loading and\n *   parsing the PDF data.\n * @property {number} [verbosity] - Controls the logging level; the constants\n *   from {@link VerbosityLevel} should be used.\n * @property {string} [docBaseUrl] - The base URL of the document, used when\n *   attempting to recover valid absolute URLs for annotations, and outline\n *   items, that (incorrectly) only specify relative URLs.\n * @property {string} [cMapUrl] - The URL where the predefined Adobe CMaps are\n *   located. Include the trailing slash.\n * @property {boolean} [cMapPacked] - Specifies if the Adobe CMaps are binary\n *   packed or not. The default value is `true`.\n * @property {Object} [CMapReaderFactory] - The factory that will be used when\n *   reading built-in CMap files.\n *   The default value is {DOMCMapReaderFactory}.\n * @property {string} [iccUrl] - The URL where the predefined ICC profiles are\n *   located. Include the trailing slash.\n * @property {boolean} [useSystemFonts] - When `true`, fonts that aren't\n *   embedded in the PDF document will fallback to a system font.\n *   The default value is `true` in web environments and `false` in Node.js;\n *   unless `disableFontFace === true` in which case this defaults to `false`\n *   regardless of the environment (to prevent completely broken fonts).\n * @property {string} [standardFontDataUrl] - The URL where the standard font\n *   files are located. Include the trailing slash.\n * @property {Object} [StandardFontDataFactory] - The factory that will be used\n *   when reading the standard font files.\n *   The default value is {DOMStandardFontDataFactory}.\n * @property {string} [wasmUrl] - The URL where the wasm files are located.\n *   Include the trailing slash.\n * @property {Object} [WasmFactory] - The factory that will be used\n *   when reading the wasm files.\n *   The default value is {DOMWasmFactory}.\n * @property {boolean} [useWorkerFetch] - Enable using the Fetch API in the\n *   worker-thread when reading CMap and standard font files. When `true`,\n *   the `CMapReaderFactory`, `StandardFontDataFactory`, and `WasmFactory`\n *   options are ignored.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [useWasm] - Attempt to use WebAssembly in order to\n *    improve e.g. image decoding performance.\n *    The default value is `true`.\n * @property {boolean} [stopAtErrors] - Reject certain promises, e.g.\n *   `getOperatorList`, `getTextContent`, and `RenderTask`, when the associated\n *   PDF data cannot be successfully parsed, instead of attempting to recover\n *   whatever possible of the data. The default value is `false`.\n * @property {number} [maxImageSize] - The maximum allowed image size in total\n *   pixels, i.e. width * height. Images above this value will not be rendered.\n *   Use -1 for no limit, which is also the default value.\n * @property {boolean} [isEvalSupported] - Determines if we can evaluate strings\n *   as JavaScript. Primarily used to improve performance of PDF functions.\n *   The default value is `true`.\n * @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use\n *   `OffscreenCanvas` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [isImageDecoderSupported] - Determines if we can use\n *   `ImageDecoder` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n *\n *   NOTE: Also temporarily disabled in Chromium browsers, until we no longer\n *   support the affected browser versions, because of various bugs:\n *\n *    - Crashes when using the BMP decoder with huge images, e.g. issue6741.pdf;\n *      see https://issues.chromium.org/issues/374807001\n *\n *    - Broken images when using the JPEG decoder with images that have custom\n *      colour profiles, e.g. GitHub discussion 19030;\n *      see https://issues.chromium.org/issues/378869810\n *\n * @property {number} [canvasMaxAreaInBytes] - The integer value is used to\n *   know when an image must be resized (uses `OffscreenCanvas` in the worker).\n *   If it's -1 then a possibly slow algorithm is used to guess the max value.\n * @property {boolean} [disableFontFace] - By default fonts are converted to\n *   OpenType fonts and loaded via the Font Loading API or `@font-face` rules.\n *   If disabled, fonts will be rendered using a built-in font renderer that\n *   constructs the glyphs with primitive path commands.\n *   The default value is `false` in web environments and `true` in Node.js.\n * @property {boolean} [fontExtraProperties] - Include additional properties,\n *   which are unused during rendering of PDF documents, when exporting the\n *   parsed font data from the worker-thread. This may be useful for debugging\n *   purposes (and backwards compatibility), but note that it will lead to\n *   increased memory usage. The default value is `false`.\n * @property {boolean} [enableXfa] - Render Xfa forms if any.\n *   The default value is `false`.\n * @property {HTMLDocument} [ownerDocument] - Specify an explicit document\n *   context to create elements with and to load resources, such as fonts,\n *   into. Defaults to the current document.\n * @property {boolean} [disableRange] - Disable range request loading of PDF\n *   files. When enabled, and if the server supports partial content requests,\n *   then the PDF will be fetched in chunks. The default value is `false`.\n * @property {boolean} [disableStream] - Disable streaming of PDF file data.\n *   By default PDF.js attempts to load PDF files in chunks. The default value\n *   is `false`.\n * @property {boolean} [disableAutoFetch] - Disable pre-fetching of PDF file\n *   data. When range requests are enabled PDF.js will automatically keep\n *   fetching more data even if it isn't needed to display the current page.\n *   The default value is `false`.\n *\n *   NOTE: It is also necessary to disable streaming, see above, in order for\n *   disabling of pre-fetching to work correctly.\n * @property {boolean} [pdfBug] - Enables special hooks for debugging PDF.js\n *   (see `web/debugger.js`). The default value is `false`.\n * @property {Object} [CanvasFactory] - The factory that will be used when\n *    creating canvases. The default value is {DOMCanvasFactory}.\n * @property {Object} [FilterFactory] - The factory that will be used to\n *    create SVG filters when rendering some images on the main canvas.\n *    The default value is {DOMFilterFactory}.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\n/**\n * This is the main entry point for loading a PDF and interacting with it.\n *\n * NOTE: If a URL is used to fetch the PDF data a standard Fetch API call (or\n * XHR as fallback) is used, which means it must follow same origin rules,\n * e.g. no cross-domain requests without CORS.\n *\n * @param {string | URL | TypedArray | ArrayBuffer | DocumentInitParameters}\n *   src - Can be a URL where a PDF file is located, a typed array (Uint8Array)\n *         already populated with data, or a parameter object.\n * @returns {PDFDocumentLoadingTask}\n */\nfunction getDocument(src = {}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n    if (typeof src === \"string\" || src instanceof URL) {\n      src = { url: src };\n    } else if (src instanceof ArrayBuffer || ArrayBuffer.isView(src)) {\n      src = { data: src };\n    }\n  }\n  const task = new PDFDocumentLoadingTask();\n  const { docId } = task;\n\n  const url = src.url ? getUrlProp(src.url) : null;\n  const data = src.data ? getDataProp(src.data) : null;\n  const httpHeaders = src.httpHeaders || null;\n  const withCredentials = src.withCredentials === true;\n  const password = src.password ?? null;\n  const rangeTransport =\n    src.range instanceof PDFDataRangeTransport ? src.range : null;\n  const rangeChunkSize =\n    Number.isInteger(src.rangeChunkSize) && src.rangeChunkSize > 0\n      ? src.rangeChunkSize\n      : 2 ** 16;\n  let worker = src.worker instanceof PDFWorker ? src.worker : null;\n  const verbosity = src.verbosity;\n  // Ignore \"data:\"-URLs, since they can't be used to recover valid absolute\n  // URLs anyway. We want to avoid sending them to the worker-thread, since\n  // they contain the *entire* PDF document and can thus be arbitrarily long.\n  const docBaseUrl =\n    typeof src.docBaseUrl === \"string\" && !isDataScheme(src.docBaseUrl)\n      ? src.docBaseUrl\n      : null;\n  const cMapUrl = getFactoryUrlProp(src.cMapUrl);\n  const cMapPacked = src.cMapPacked !== false;\n  const CMapReaderFactory =\n    src.CMapReaderFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCMapReaderFactory\n      : DOMCMapReaderFactory);\n  const iccUrl = getFactoryUrlProp(src.iccUrl);\n  const standardFontDataUrl = getFactoryUrlProp(src.standardFontDataUrl);\n  const StandardFontDataFactory =\n    src.StandardFontDataFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeStandardFontDataFactory\n      : DOMStandardFontDataFactory);\n  const wasmUrl = getFactoryUrlProp(src.wasmUrl);\n  const WasmFactory =\n    src.WasmFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeWasmFactory\n      : DOMWasmFactory);\n  const ignoreErrors = src.stopAtErrors !== true;\n  const maxImageSize =\n    Number.isInteger(src.maxImageSize) && src.maxImageSize > -1\n      ? src.maxImageSize\n      : -1;\n  const isEvalSupported = src.isEvalSupported !== false;\n  const isOffscreenCanvasSupported =\n    typeof src.isOffscreenCanvasSupported === \"boolean\"\n      ? src.isOffscreenCanvasSupported\n      : !isNodeJS;\n  const isImageDecoderSupported =\n    // eslint-disable-next-line no-nested-ternary\n    typeof src.isImageDecoderSupported === \"boolean\"\n      ? src.isImageDecoderSupported\n      : // eslint-disable-next-line no-nested-ternary\n        typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? true\n        : typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")\n          ? false\n          : !isNodeJS && (FeatureTest.platform.isFirefox || !globalThis.chrome);\n  const canvasMaxAreaInBytes = Number.isInteger(src.canvasMaxAreaInBytes)\n    ? src.canvasMaxAreaInBytes\n    : -1;\n  const disableFontFace =\n    typeof src.disableFontFace === \"boolean\" ? src.disableFontFace : isNodeJS;\n  const fontExtraProperties = src.fontExtraProperties === true;\n  const enableXfa = src.enableXfa === true;\n  const ownerDocument = src.ownerDocument || globalThis.document;\n  const disableRange = src.disableRange === true;\n  const disableStream = src.disableStream === true;\n  const disableAutoFetch = src.disableAutoFetch === true;\n  const pdfBug = src.pdfBug === true;\n  const CanvasFactory =\n    src.CanvasFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCanvasFactory\n      : DOMCanvasFactory);\n  const FilterFactory =\n    src.FilterFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeFilterFactory\n      : DOMFilterFactory);\n  const enableHWA = src.enableHWA === true;\n  const useWasm = src.useWasm !== false;\n\n  // Parameters whose default values depend on other parameters.\n  const length = rangeTransport ? rangeTransport.length : (src.length ?? NaN);\n  const useSystemFonts =\n    typeof src.useSystemFonts === \"boolean\"\n      ? src.useSystemFonts\n      : !isNodeJS && !disableFontFace;\n  const useWorkerFetch =\n    typeof src.useWorkerFetch === \"boolean\"\n      ? src.useWorkerFetch\n      : (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        !!(\n          CMapReaderFactory === DOMCMapReaderFactory &&\n          StandardFontDataFactory === DOMStandardFontDataFactory &&\n          WasmFactory === DOMWasmFactory &&\n          cMapUrl &&\n          standardFontDataUrl &&\n          wasmUrl &&\n          isValidFetchUrl(cMapUrl, document.baseURI) &&\n          isValidFetchUrl(standardFontDataUrl, document.baseURI) &&\n          isValidFetchUrl(wasmUrl, document.baseURI)\n        );\n\n  // Parameters only intended for development/testing purposes.\n  const styleElement =\n    typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n      ? src.styleElement\n      : null;\n\n  // Set the main-thread verbosity level.\n  setVerbosityLevel(verbosity);\n\n  // Ensure that the various factories can be initialized, when necessary,\n  // since the user may provide *custom* ones.\n  const transportFactory = {\n    canvasFactory: new CanvasFactory({ ownerDocument, enableHWA }),\n    filterFactory: new FilterFactory({ docId, ownerDocument }),\n    cMapReaderFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new CMapReaderFactory({ baseUrl: cMapUrl, isCompressed: cMapPacked }),\n    standardFontDataFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new StandardFontDataFactory({ baseUrl: standardFontDataUrl }),\n    wasmFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new WasmFactory({ baseUrl: wasmUrl }),\n  };\n\n  if (!worker) {\n    // Worker was not provided -- creating and owning our own. If message port\n    // is specified in global worker options, using it.\n    worker = PDFWorker.create({\n      verbosity,\n      port: GlobalWorkerOptions.workerPort,\n    });\n    task._worker = worker;\n  }\n\n  const docParams = {\n    docId,\n    apiVersion:\n      typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"TESTING\")\n        ? PDFJSDev.eval(\"BUNDLE_VERSION\")\n        : null,\n    data,\n    password,\n    disableAutoFetch,\n    rangeChunkSize,\n    length,\n    docBaseUrl,\n    enableXfa,\n    evaluatorOptions: {\n      maxImageSize,\n      disableFontFace,\n      ignoreErrors,\n      isEvalSupported,\n      isOffscreenCanvasSupported,\n      isImageDecoderSupported,\n      canvasMaxAreaInBytes,\n      fontExtraProperties,\n      useSystemFonts,\n      useWasm,\n      useWorkerFetch,\n      cMapUrl,\n      iccUrl,\n      standardFontDataUrl,\n      wasmUrl,\n    },\n  };\n  const transportParams = {\n    ownerDocument,\n    pdfBug,\n    styleElement,\n    loadingParams: {\n      disableAutoFetch,\n      enableXfa,\n    },\n  };\n\n  worker.promise\n    .then(function () {\n      if (task.destroyed) {\n        throw new Error(\"Loading aborted\");\n      }\n      if (worker.destroyed) {\n        throw new Error(\"Worker was destroyed\");\n      }\n\n      const workerIdPromise = worker.messageHandler.sendWithPromise(\n        \"GetDocRequest\",\n        docParams,\n        data ? [data.buffer] : null\n      );\n\n      let networkStream;\n      if (rangeTransport) {\n        networkStream = new PDFDataTransportStream(rangeTransport, {\n          disableRange,\n          disableStream,\n        });\n      } else if (!data) {\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n          throw new Error(\"Not implemented: NetworkStream\");\n        }\n        if (!url) {\n          throw new Error(\"getDocument - no `url` parameter provided.\");\n        }\n        // eslint-disable-next-line no-nested-ternary\n        const NetworkStream = isValidFetchUrl(url)\n          ? PDFFetchStream\n          : typeof PDFJSDev !== \"undefined\" &&\n              PDFJSDev.test(\"GENERIC\") &&\n              isNodeJS\n            ? PDFNodeStream\n            : PDFNetworkStream;\n\n        networkStream = new NetworkStream({\n          url,\n          length,\n          httpHeaders,\n          withCredentials,\n          rangeChunkSize,\n          disableRange,\n          disableStream,\n        });\n      }\n\n      return workerIdPromise.then(workerId => {\n        if (task.destroyed) {\n          throw new Error(\"Loading aborted\");\n        }\n        if (worker.destroyed) {\n          throw new Error(\"Worker was destroyed\");\n        }\n\n        const messageHandler = new MessageHandler(docId, workerId, worker.port);\n        const transport = new WorkerTransport(\n          messageHandler,\n          task,\n          networkStream,\n          transportParams,\n          transportFactory,\n          enableHWA\n        );\n        task._transport = transport;\n        messageHandler.send(\"Ready\", null);\n      });\n    })\n    .catch(task._capability.reject);\n\n  return task;\n}\n\n/**\n * @typedef {Object} OnProgressParameters\n * @property {number} loaded - Currently loaded number of bytes.\n * @property {number} total - Total number of bytes in the PDF file.\n */\n\n/**\n * The loading task controls the operations required to load a PDF document\n * (such as network requests) and provides a way to listen for completion,\n * after which individual pages can be rendered.\n */\nclass PDFDocumentLoadingTask {\n  static #docId = 0;\n\n  /**\n   * @private\n   */\n  _capability = Promise.withResolvers();\n\n  /**\n   * @private\n   */\n  _transport = null;\n\n  /**\n   * @private\n   */\n  _worker = null;\n\n  /**\n   * Unique identifier for the document loading task.\n   * @type {string}\n   */\n  docId = `d${PDFDocumentLoadingTask.#docId++}`;\n\n  /**\n   * Whether the loading task is destroyed or not.\n   * @type {boolean}\n   */\n  destroyed = false;\n\n  /**\n   * Callback to request a password if a wrong or no password was provided.\n   * The callback receives two parameters: a function that should be called\n   * with the new password, and a reason (see {@link PasswordResponses}).\n   * @type {function}\n   */\n  onPassword = null;\n\n  /**\n   * Callback to be able to monitor the loading progress of the PDF file\n   * (necessary to implement e.g. a loading bar).\n   * The callback receives an {@link OnProgressParameters} argument.\n   * @type {function}\n   */\n  onProgress = null;\n\n  /**\n   * Promise for document loading task completion.\n   * @type {Promise<PDFDocumentProxy>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Abort all network requests and destroy the worker.\n   * @returns {Promise<void>} A promise that is resolved when destruction is\n   *   completed.\n   */\n  async destroy() {\n    this.destroyed = true;\n\n    try {\n      if (this._worker?.port) {\n        this._worker._pendingDestroy = true;\n      }\n      await this._transport?.destroy();\n    } catch (ex) {\n      if (this._worker?.port) {\n        delete this._worker._pendingDestroy;\n      }\n      throw ex;\n    }\n    this._transport = null;\n\n    this._worker?.destroy();\n    this._worker = null;\n  }\n\n  /**\n   * Attempt to fetch the raw data of the PDF document, when e.g.\n   *  - An exception was thrown during document initialization.\n   *  - An `onPassword` callback is delaying initialization.\n   * @returns {Promise<Uint8Array>}\n   */\n  async getData() {\n    return this._transport.getData();\n  }\n}\n\n/**\n * Abstract class to support range requests file loading.\n *\n * NOTE: The TypedArrays passed to the constructor and relevant methods below\n * will generally be transferred to the worker-thread. This will help reduce\n * main-thread memory usage, however it will take ownership of the TypedArrays.\n */\nclass PDFDataRangeTransport {\n  #capability = Promise.withResolvers();\n\n  #progressiveDoneListeners = [];\n\n  #progressiveReadListeners = [];\n\n  #progressListeners = [];\n\n  #rangeListeners = [];\n\n  /**\n   * @param {number} length\n   * @param {Uint8Array|null} initialData\n   * @param {boolean} [progressiveDone]\n   * @param {string} [contentDispositionFilename]\n   */\n  constructor(\n    length,\n    initialData,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this.length = length;\n    this.initialData = initialData;\n    this.progressiveDone = progressiveDone;\n    this.contentDispositionFilename = contentDispositionFilename;\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addRangeListener(listener) {\n    this.#rangeListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressListener(listener) {\n    this.#progressListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveReadListener(listener) {\n    this.#progressiveReadListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveDoneListener(listener) {\n    this.#progressiveDoneListeners.push(listener);\n  }\n\n  /**\n   * @param {number} begin\n   * @param {Uint8Array|null} chunk\n   */\n  onDataRange(begin, chunk) {\n    for (const listener of this.#rangeListeners) {\n      listener(begin, chunk);\n    }\n  }\n\n  /**\n   * @param {number} loaded\n   * @param {number|undefined} total\n   */\n  onDataProgress(loaded, total) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressListeners) {\n        listener(loaded, total);\n      }\n    });\n  }\n\n  /**\n   * @param {Uint8Array|null} chunk\n   */\n  onDataProgressiveRead(chunk) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveReadListeners) {\n        listener(chunk);\n      }\n    });\n  }\n\n  onDataProgressiveDone() {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveDoneListeners) {\n        listener();\n      }\n    });\n  }\n\n  transportReady() {\n    this.#capability.resolve();\n  }\n\n  /**\n   * @param {number} begin\n   * @param {number} end\n   */\n  requestDataRange(begin, end) {\n    unreachable(\"Abstract method PDFDataRangeTransport.requestDataRange\");\n  }\n\n  abort() {}\n}\n\n/**\n * Proxy to a `PDFDocument` in the worker thread.\n */\nclass PDFDocumentProxy {\n  constructor(pdfInfo, transport) {\n    this._pdfInfo = pdfInfo;\n    this._transport = transport;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => this._transport.getNetworkStreamName(),\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => this._transport.getXFADatasets(),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () => this._transport.getStartXRefPos(),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => this._transport.getAnnotArray(pageIndex),\n      });\n    }\n  }\n\n  /**\n   * @type {AnnotationStorage} Storage for annotation data in forms.\n   */\n  get annotationStorage() {\n    return this._transport.annotationStorage;\n  }\n\n  /**\n   * @type {Object} The canvas factory instance.\n   */\n  get canvasFactory() {\n    return this._transport.canvasFactory;\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {number} Total number of pages in the PDF file.\n   */\n  get numPages() {\n    return this._pdfInfo.numPages;\n  }\n\n  /**\n   * @type {Array<string | null>} A (not guaranteed to be) unique ID to identify\n   *   the PDF document.\n   *   NOTE: The first element will always be defined for all PDF documents,\n   *   whereas the second element is only defined for *modified* PDF documents.\n   */\n  get fingerprints() {\n    return this._pdfInfo.fingerprints;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * NOTE: This is (mostly) intended to support printing of XFA forms.\n   *\n   * @type {Object | null} An object representing a HTML tree structure\n   *   to render the XFA, or `null` when no XFA form exists.\n   */\n  get allXfaHtml() {\n    return this._transport._htmlForXfa;\n  }\n\n  /**\n   * @param {number} pageNumber - The page number to get. The first page is 1.\n   * @returns {Promise<PDFPageProxy>} A promise that is resolved with\n   *   a {@link PDFPageProxy} object.\n   */\n  getPage(pageNumber) {\n    return this._transport.getPage(pageNumber);\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {Promise<number>} A promise that is resolved with the page index,\n   *   starting from zero, that is associated with the reference.\n   */\n  getPageIndex(ref) {\n    return this._transport.getPageIndex(ref);\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<any>>>} A promise that is resolved\n   *   with a mapping from named destinations to references.\n   *\n   * This can be slow for large documents. Use `getDestination` instead.\n   */\n  getDestinations() {\n    return this._transport.getDestinations();\n  }\n\n  /**\n   * @param {string} id - The named destination to get.\n   * @returns {Promise<Array<any> | null>} A promise that is resolved with all\n   *   information of the given named destination, or `null` when the named\n   *   destination is not present in the PDF file.\n   */\n  getDestination(id) {\n    return this._transport.getDestination(id);\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with\n   *   an {Array} containing the page labels that correspond to the page\n   *   indexes, or `null` when no page labels are present in the PDF file.\n   */\n  getPageLabels() {\n    return this._transport.getPageLabels();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page layout name.\n   */\n  getPageLayout() {\n    return this._transport.getPageLayout();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page mode name.\n   */\n  getPageMode() {\n    return this._transport.getPageMode();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with an\n   *   {Object} containing the viewer preferences, or `null` when no viewer\n   *   preferences are present in the PDF file.\n   */\n  getViewerPreferences() {\n    return this._transport.getViewerPreferences();\n  }\n\n  /**\n   * @returns {Promise<any | null>} A promise that is resolved with an {Array}\n   *   containing the destination, or `null` when no open action is present\n   *   in the PDF.\n   */\n  getOpenAction() {\n    return this._transport.getOpenAction();\n  }\n\n  /**\n   * @returns {Promise<any>} A promise that is resolved with a lookup table\n   *   for mapping named attachments to their content.\n   */\n  getAttachments() {\n    return this._transport.getAttachments();\n  }\n\n  /**\n   * @param {Set<number>} types - The annotation types to retrieve.\n   * @param {Set<number>} pageIndexesToSkip\n   * @returns {Promise<Array<Object>>} A promise that is resolved with a list of\n   *   annotations data.\n   */\n  getAnnotationsByType(types, pageIndexesToSkip) {\n    return this._transport.getAnnotationsByType(types, pageIndexesToSkip);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with the JavaScript actions:\n   *     - from the name tree.\n   *     - from A or AA entries in the catalog dictionary.\n   *   , or `null` if no JavaScript exists.\n   */\n  getJSActions() {\n    return this._transport.getDocJSActions();\n  }\n\n  /**\n   * @typedef {Object} OutlineNode\n   * @property {string} title\n   * @property {boolean} bold\n   * @property {boolean} italic\n   * @property {Uint8ClampedArray} color - The color in RGB format to use for\n   *   display purposes.\n   * @property {string | Array<any> | null} dest\n   * @property {string | null} url\n   * @property {string | undefined} unsafeUrl\n   * @property {boolean | undefined} newWindow\n   * @property {number | undefined} count\n   * @property {Array<OutlineNode>} items\n   */\n\n  /**\n   * @returns {Promise<Array<OutlineNode>>} A promise that is resolved with an\n   *   {Array} that is a tree outline (if it has one) of the PDF file.\n   */\n  getOutline() {\n    return this._transport.getOutline();\n  }\n\n  /**\n   * @typedef {Object} GetOptionalContentConfigParameters\n   * @property {string} [intent] - Determines the optional content groups that\n   *   are visible by default; valid values are:\n   *    - 'display' (viewable groups).\n   *    - 'print' (printable groups).\n   *    - 'any' (all groups).\n   *   The default value is 'display'.\n   */\n\n  /**\n   * @param {GetOptionalContentConfigParameters} [params] - Optional content\n   *   config parameters.\n   * @returns {Promise<OptionalContentConfig>} A promise that is resolved with\n   *   an {@link OptionalContentConfig} that contains all the optional content\n   *   groups (assuming that the document has any).\n   */\n  getOptionalContentConfig({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getOptionalContentConfig(renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Array<number> | null>} A promise that is resolved with\n   *   an {Array} that contains the permission flags for the PDF document, or\n   *   `null` when no permissions are present in the PDF file.\n   */\n  getPermissions() {\n    return this._transport.getPermissions();\n  }\n\n  /**\n   * @returns {Promise<{ info: Object, metadata: Metadata }>} A promise that is\n   *   resolved with an {Object} that has `info` and `metadata` properties.\n   *   `info` is an {Object} filled with anything available in the information\n   *   dictionary and similarly `metadata` is a {Metadata} object with\n   *   information from the metadata section of the PDF.\n   */\n  getMetadata() {\n    return this._transport.getMetadata();\n  }\n\n  /**\n   * @typedef {Object} MarkInfo\n   * Properties correspond to Table 321 of the PDF 32000-1:2008 spec.\n   * @property {boolean} Marked\n   * @property {boolean} UserProperties\n   * @property {boolean} Suspects\n   */\n\n  /**\n   * @returns {Promise<MarkInfo | null>} A promise that is resolved with\n   *   a {MarkInfo} object that contains the MarkInfo flags for the PDF\n   *   document, or `null` when no MarkInfo values are present in the PDF file.\n   */\n  getMarkInfo() {\n    return this._transport.getMarkInfo();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the raw data of the PDF document.\n   */\n  getData() {\n    return this._transport.getData();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  saveDocument() {\n    return this._transport.saveDocument();\n  }\n\n  /**\n   * @typedef {Object} PageInfo\n   * @property {null|Uint8Array} document\n   * @property {Array<Array<number>|number>} [includePages]\n   *  included ranges or indices.\n   * @property {Array<Array<number>|number>} [excludePages]\n   *  excluded ranges or indices.\n   */\n\n  /**\n   * @param {Array<PageInfo>} pageInfos - The pages to extract.\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  extractPages(pageInfos) {\n    return this._transport.extractPages(pageInfos);\n  }\n\n  /**\n   * @returns {Promise<{ length: number }>} A promise that is resolved when the\n   *   document's data is loaded. It is resolved with an {Object} that contains\n   *   the `length` property that indicates size of the PDF data in bytes.\n   */\n  getDownloadInfo() {\n    return this._transport.downloadInfoCapability.promise;\n  }\n\n  /**\n   * Cleans up resources allocated by the document on both the main and worker\n   * threads.\n   *\n   * NOTE: Do not, under any circumstances, call this method when rendering is\n   * currently ongoing since that may lead to rendering errors.\n   *\n   * @param {boolean} [keepLoadedFonts] - Let fonts remain attached to the DOM.\n   *   NOTE: This will increase persistent memory usage, hence don't use this\n   *   option unless absolutely necessary. The default value is `false`.\n   * @returns {Promise} A promise that is resolved when clean-up has finished.\n   */\n  cleanup(keepLoadedFonts = false) {\n    return this._transport.startCleanup(keepLoadedFonts || this.isPureXfa);\n  }\n\n  /**\n   * Destroys the current document instance and terminates the worker.\n   */\n  destroy() {\n    return this.loadingTask.destroy();\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {number | null} The page number, if it's cached.\n   */\n  cachedPageNumber(ref) {\n    return this._transport.cachedPageNumber(ref);\n  }\n\n  /**\n   * @type {DocumentInitParameters} A subset of the current\n   *   {DocumentInitParameters}, which are needed in the viewer.\n   */\n  get loadingParams() {\n    return this._transport.loadingParams;\n  }\n\n  /**\n   * @type {PDFDocumentLoadingTask} The loadingTask for the current document.\n   */\n  get loadingTask() {\n    return this._transport.loadingTask;\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<Object>> | null>} A promise that is\n   *   resolved with an {Object} containing /AcroForm field data for the JS\n   *   sandbox, or `null` when no field data is present in the PDF file.\n   */\n  getFieldObjects() {\n    return this._transport.getFieldObjects();\n  }\n\n  /**\n   * @returns {Promise<boolean>} A promise that is resolved with `true`\n   *   if some /AcroForm fields have JavaScript actions.\n   */\n  hasJSActions() {\n    return this._transport.hasJSActions();\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with an\n   *   {Array<string>} containing IDs of annotations that have a calculation\n   *   action, or `null` when no such annotations are present in the PDF file.\n   */\n  getCalculationOrderIds() {\n    return this._transport.getCalculationOrderIds();\n  }\n}\n\n/**\n * Page getViewport parameters.\n *\n * @typedef {Object} GetViewportParameters\n * @property {number} scale - The desired scale of the viewport.\n * @property {number} [rotation] - The desired rotation, in degrees, of\n *   the viewport. If omitted it defaults to the page rotation.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be\n *   flipped. The default value is `false`.\n */\n\n/**\n * Page getTextContent parameters.\n *\n * @typedef {Object} getTextContentParameters\n * @property {boolean} [includeMarkedContent] - When true include marked\n *   content items in the items array of TextContent. The default is `false`.\n * @property {boolean} [disableNormalization] - When true the text is *not*\n *   normalized in the worker-thread. The default is `false`.\n */\n\n/**\n * Page text content.\n *\n * @typedef {Object} TextContent\n * @property {Array<TextItem | TextMarkedContent>} items - Array of\n *   {@link TextItem} and {@link TextMarkedContent} objects. TextMarkedContent\n *   items are included when includeMarkedContent is true.\n * @property {Object<string, TextStyle>} styles - {@link TextStyle} objects,\n *   indexed by font name.\n * @property {string | null} lang - The document /Lang attribute.\n */\n\n/**\n * Page text content part.\n *\n * @typedef {Object} TextItem\n * @property {string} str - Text content.\n * @property {string} dir - Text direction: 'ttb', 'ltr' or 'rtl'.\n * @property {Array<any>} transform - Transformation matrix.\n * @property {number} width - Width in device space.\n * @property {number} height - Height in device space.\n * @property {string} fontName - Font name used by PDF.js for converted font.\n * @property {boolean} hasEOL - Indicating if the text content is followed by a\n *   line-break.\n */\n\n/**\n * Page text marked content part.\n *\n * @typedef {Object} TextMarkedContent\n * @property {string} type - Either 'beginMarkedContent',\n *   'beginMarkedContentProps', or 'endMarkedContent'.\n * @property {string} id - The marked content identifier. Only used for type\n *   'beginMarkedContentProps'.\n */\n\n/**\n * Text style.\n *\n * @typedef {Object} TextStyle\n * @property {number} ascent - Font ascent.\n * @property {number} descent - Font descent.\n * @property {boolean} vertical - Whether or not the text is in vertical mode.\n * @property {string} fontFamily - The possible font family.\n */\n\n/**\n * Page annotation parameters.\n *\n * @typedef {Object} GetAnnotationsParameters\n * @property {string} [intent] - Determines the annotations that are fetched,\n *   can be 'display' (viewable annotations), 'print' (printable annotations),\n *   or 'any' (all annotations). The default value is 'display'.\n */\n\n/**\n * Page render parameters.\n *\n * @typedef {Object} RenderParameters\n * @property {HTMLCanvasElement|null} canvas - A DOM Canvas object. The default\n *   value is the canvas associated with the `canvasContext` parameter if no\n *   value is provided explicitly.\n * @property {PageViewport} viewport - Rendering viewport obtained by calling\n *   the `PDFPageProxy.getViewport` method.\n * @property {CanvasRenderingContext2D} [canvasContext] - 2D context of a DOM\n *   Canvas object for backwards compatibility; it is recommended to use the\n *   `canvas` parameter instead.\n *   If the context must absolutely be used to render the page, the canvas must\n *   be null.\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are rendered\n *   onto the canvas, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {Array<any>} [transform] - Additional transform, applied just\n *   before viewport transform.\n * @property {CanvasGradient | CanvasPattern | string} [background] - Background\n *   to use for the canvas.\n *   Any valid `canvas.fillStyle` can be used: a `DOMString` parsed as CSS\n *   <color> value, a `CanvasGradient` object (a linear or radial gradient) or\n *   a `CanvasPattern` object (a repetitive image). The default value is\n *   'rgb(255,255,255)'.\n *\n *   NOTE: This option may be partially, or completely, ignored when the\n *   `pageColors`-option is used.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that should resolve with an {@link OptionalContentConfig}\n *   created from `PDFDocumentProxy.getOptionalContentConfig`. If `null`,\n *   the configuration will be fetched automatically with the default visibility\n *   states set.\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap] - Map some\n *   annotation ids with canvases used to render them.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n * @property {boolean} [recordOperations] - Record the dependencies and bounding\n *   boxes of all PDF operations that render onto the canvas.\n * @property {OperationsFilter} [operationsFilter] - If provided, only\n *   run for which this function returns `true`.\n */\n\n/**\n * @callback OperationsFilter\n * @param {number} index - The index of the operation.\n * @returns {boolean} If false, the operation is ignored.\n */\n\n/**\n * Page getOperatorList parameters.\n *\n * @typedef {Object} GetOperatorListParameters\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are included\n *   in the operatorList, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Structure tree node. The root node will have a role \"Root\".\n *\n * @typedef {Object} StructTreeNode\n * @property {Array<StructTreeNode | StructTreeContent>} children - Array of\n *   {@link StructTreeNode} and {@link StructTreeContent} objects.\n * @property {string} role - element's role, already mapped if a role map exists\n * in the PDF.\n */\n\n/**\n * Structure tree content.\n *\n * @typedef {Object} StructTreeContent\n * @property {string} type - either \"content\" for page and stream structure\n *   elements or \"object\" for object references.\n * @property {string} id - unique id that will map to the text layer.\n */\n\n/**\n * PDF page operator list.\n *\n * @typedef {Object} PDFOperatorList\n * @property {Array<number>} fnArray - Array containing the operator functions.\n * @property {Array<any>} argsArray - Array containing the arguments of the\n *   functions.\n */\n\n/**\n * Proxy to a `PDFPage` in the worker thread.\n */\nclass PDFPageProxy {\n  #pendingCleanup = false;\n\n  constructor(pageIndex, pageInfo, transport, pdfBug = false) {\n    this._pageIndex = pageIndex;\n    this._pageInfo = pageInfo;\n    this._transport = transport;\n    this._stats = pdfBug ? new StatTimer() : null;\n    this._pdfBug = pdfBug;\n    /** @type {PDFObjects} */\n    this.commonObjs = transport.commonObjs;\n    this.objs = new PDFObjects();\n\n    this._intentStates = new Map();\n    this.destroyed = false;\n    this.recordedBBoxes = null;\n  }\n\n  /**\n   * @type {number} Page number of the page. First page is 1.\n   */\n  get pageNumber() {\n    return this._pageIndex + 1;\n  }\n\n  /**\n   * @type {number} The number of degrees the page is rotated clockwise.\n   */\n  get rotate() {\n    return this._pageInfo.rotate;\n  }\n\n  /**\n   * @type {RefProxy | null} The reference that points to this page.\n   */\n  get ref() {\n    return this._pageInfo.ref;\n  }\n\n  /**\n   * @type {number} The default size of units in 1/72nds of an inch.\n   */\n  get userUnit() {\n    return this._pageInfo.userUnit;\n  }\n\n  /**\n   * @type {Array<number>} An array of the visible portion of the PDF page in\n   *   user space units [x1, y1, x2, y2].\n   */\n  get view() {\n    return this._pageInfo.view;\n  }\n\n  /**\n   * @param {GetViewportParameters} params - Viewport parameters.\n   * @returns {PageViewport} Contains 'width' and 'height' properties\n   *   along with transforms required for rendering.\n   */\n  getViewport({\n    scale,\n    rotation = this.rotate,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.view,\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * @param {GetAnnotationsParameters} [params] - Annotation parameters.\n   * @returns {Promise<Array<any>>} A promise that is resolved with an\n   *   {Array} of the annotation objects.\n   */\n  getAnnotations({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getAnnotations(this._pageIndex, renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Object>} A promise that is resolved with an\n   *   {Object} with JS actions.\n   */\n  getJSActions() {\n    return this._transport.getPageJSActions(this._pageIndex);\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with a fake DOM object (a tree structure where elements\n   *   are {Object} with a name, attributes (class, style, ...), value and\n   *   children, very similar to a HTML DOM tree), or `null` if no XFA exists.\n   */\n  async getXfa() {\n    return this._transport._htmlForXfa?.children[this._pageIndex] || null;\n  }\n\n  /**\n   * Begins the process of rendering a page to the desired context.\n   *\n   * @param {RenderParameters} params - Page render parameters.\n   * @returns {RenderTask} An object that contains a promise that is\n   *   resolved when the page finishes rendering.\n   */\n  render({\n    canvasContext,\n    canvas = canvasContext.canvas,\n    viewport,\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    transform = null,\n    background = null,\n    optionalContentConfigPromise = null,\n    annotationCanvasMap = null,\n    pageColors = null,\n    printAnnotationStorage = null,\n    isEditing = false,\n    recordOperations = false,\n    operationsFilter = null,\n  }) {\n    this._stats?.time(\"Overall\");\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing\n    );\n    const { renderingIntent, cacheKey } = intentArgs;\n    // If there was a pending destroy, cancel it so no cleanup happens during\n    // this call to render.\n    this.#pendingCleanup = false;\n\n    optionalContentConfigPromise ||=\n      this._transport.getOptionalContentConfig(renderingIntent);\n\n    let intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(cacheKey, intentState);\n    }\n\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    const intentPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    // If there's no displayReadyCapability yet, then the operatorList\n    // was never requested before. Make the request and create the promise.\n    if (!intentState.displayReadyCapability) {\n      intentState.displayReadyCapability = Promise.withResolvers();\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n\n    const recordForDebugger = Boolean(\n      this._pdfBug && globalThis.StepperManager?.enabled\n    );\n\n    const shouldRecordOperations =\n      !this.recordedBBoxes && (recordOperations || recordForDebugger);\n\n    const complete = error => {\n      intentState.renderTasks.delete(internalRenderTask);\n\n      if (shouldRecordOperations) {\n        const recordedBBoxes = internalRenderTask.gfx?.dependencyTracker.take();\n        if (recordedBBoxes) {\n          if (internalRenderTask.stepper) {\n            internalRenderTask.stepper.setOperatorBBoxes(\n              recordedBBoxes,\n              internalRenderTask.gfx.dependencyTracker.takeDebugMetadata()\n            );\n          }\n          if (recordOperations) {\n            this.recordedBBoxes = recordedBBoxes;\n          }\n        }\n      }\n\n      // Attempt to reduce memory usage during *printing*, by always running\n      // cleanup immediately once rendering has finished.\n      if (intentPrint) {\n        this.#pendingCleanup = true;\n      }\n      this.#tryCleanup();\n\n      if (error) {\n        internalRenderTask.capability.reject(error);\n\n        this._abortOperatorList({\n          intentState,\n          reason: error instanceof Error ? error : new Error(error),\n        });\n      } else {\n        internalRenderTask.capability.resolve();\n      }\n\n      if (this._stats) {\n        this._stats.timeEnd(\"Rendering\");\n        this._stats.timeEnd(\"Overall\");\n\n        if (globalThis.Stats?.enabled) {\n          globalThis.Stats.add(this.pageNumber, this._stats);\n        }\n      }\n    };\n\n    const internalRenderTask = new InternalRenderTask({\n      callback: complete,\n      // Only include the required properties, and *not* the entire object.\n      params: {\n        canvas,\n        canvasContext,\n        dependencyTracker: shouldRecordOperations\n          ? new CanvasDependencyTracker(\n              canvas,\n              intentState.operatorList.length,\n              recordForDebugger\n            )\n          : null,\n        viewport,\n        transform,\n        background,\n      },\n      objs: this.objs,\n      commonObjs: this.commonObjs,\n      annotationCanvasMap,\n      operatorList: intentState.operatorList,\n      pageIndex: this._pageIndex,\n      canvasFactory: this._transport.canvasFactory,\n      filterFactory: this._transport.filterFactory,\n      useRequestAnimationFrame: !intentPrint,\n      pdfBug: this._pdfBug,\n      pageColors,\n      enableHWA: this._transport.enableHWA,\n      operationsFilter,\n    });\n\n    (intentState.renderTasks ||= new Set()).add(internalRenderTask);\n    const renderTask = internalRenderTask.task;\n\n    Promise.all([\n      intentState.displayReadyCapability.promise,\n      optionalContentConfigPromise,\n    ])\n      .then(([transparency, optionalContentConfig]) => {\n        if (this.destroyed) {\n          complete();\n          return;\n        }\n        this._stats?.time(\"Rendering\");\n\n        if (!(optionalContentConfig.renderingIntent & renderingIntent)) {\n          throw new Error(\n            \"Must use the same `intent`-argument when calling the `PDFPageProxy.render` \" +\n              \"and `PDFDocumentProxy.getOptionalContentConfig` methods.\"\n          );\n        }\n        internalRenderTask.initializeGraphics({\n          transparency,\n          optionalContentConfig,\n        });\n        internalRenderTask.operatorListChanged();\n      })\n      .catch(complete);\n\n    return renderTask;\n  }\n\n  /**\n   * @param {GetOperatorListParameters} params - Page getOperatorList\n   *   parameters.\n   * @returns {Promise<PDFOperatorList>} A promise resolved with an\n   *   {@link PDFOperatorList} object that represents the page's operator list.\n   */\n  getOperatorList({\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n  } = {}) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n      throw new Error(\"Not implemented: getOperatorList\");\n    }\n    function operatorListChanged() {\n      if (intentState.operatorList.lastChunk) {\n        intentState.opListReadCapability.resolve(intentState.operatorList);\n\n        intentState.renderTasks.delete(opListTask);\n      }\n    }\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing,\n      /* isOpList = */ true\n    );\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n    let opListTask;\n\n    if (!intentState.opListReadCapability) {\n      opListTask = Object.create(null);\n      opListTask.operatorListChanged = operatorListChanged;\n      intentState.opListReadCapability = Promise.withResolvers();\n      (intentState.renderTasks ||= new Set()).add(opListTask);\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n    return intentState.opListReadCapability.promise;\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {ReadableStream} Stream for reading text content chunks.\n   */\n  streamTextContent({\n    includeMarkedContent = false,\n    disableNormalization = false,\n  } = {}) {\n    const TEXT_CONTENT_CHUNK_SIZE = 100;\n\n    return this._transport.messageHandler.sendWithStream(\n      \"GetTextContent\",\n      {\n        pageIndex: this._pageIndex,\n        includeMarkedContent: includeMarkedContent === true,\n        disableNormalization: disableNormalization === true,\n      },\n      {\n        highWaterMark: TEXT_CONTENT_CHUNK_SIZE,\n        size(textContent) {\n          return textContent.items.length;\n        },\n      }\n    );\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {Promise<TextContent>} A promise that is resolved with a\n   *   {@link TextContent} object that represents the page's text content.\n   */\n  getTextContent(params = {}) {\n    if (this._transport._htmlForXfa) {\n      // TODO: We need to revisit this once the XFA foreground patch lands and\n      // only do this for non-foreground XFA.\n      return this.getXfa().then(xfa => XfaText.textContent(xfa));\n    }\n    const readableStream = this.streamTextContent(params);\n\n    return new Promise(function (resolve, reject) {\n      function pump() {\n        reader.read().then(function ({ value, done }) {\n          if (done) {\n            resolve(textContent);\n            return;\n          }\n          textContent.lang ??= value.lang;\n          Object.assign(textContent.styles, value.styles);\n          textContent.items.push(...value.items);\n          pump();\n        }, reject);\n      }\n\n      const reader = readableStream.getReader();\n      const textContent = {\n        items: [],\n        styles: Object.create(null),\n        lang: null,\n      };\n      pump();\n    });\n  }\n\n  /**\n   * @returns {Promise<StructTreeNode>} A promise that is resolved with a\n   *   {@link StructTreeNode} object that represents the page's structure tree,\n   *   or `null` when no structure tree is present for the current page.\n   */\n  getStructTree() {\n    return this._transport.getStructTree(this._pageIndex);\n  }\n\n  /**\n   * Destroys the page object.\n   * @private\n   */\n  _destroy() {\n    this.destroyed = true;\n\n    const waitOn = [];\n    for (const intentState of this._intentStates.values()) {\n      this._abortOperatorList({\n        intentState,\n        reason: new Error(\"Page was destroyed.\"),\n        force: true,\n      });\n\n      if (intentState.opListReadCapability) {\n        // Avoid errors below, since the renderTasks are just stubs.\n        continue;\n      }\n      for (const internalRenderTask of intentState.renderTasks) {\n        waitOn.push(internalRenderTask.completed);\n        internalRenderTask.cancel();\n      }\n    }\n    this.objs.clear();\n    this.#pendingCleanup = false;\n\n    return Promise.all(waitOn);\n  }\n\n  /**\n   * Cleans up resources allocated by the page.\n   *\n   * @param {boolean} [resetStats] - Reset page stats, if enabled.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  cleanup(resetStats = false) {\n    this.#pendingCleanup = true;\n    const success = this.#tryCleanup();\n\n    if (resetStats && success) {\n      this._stats &&= new StatTimer();\n    }\n    return success;\n  }\n\n  /**\n   * Attempts to clean up if rendering is in a state where that's possible.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  #tryCleanup() {\n    if (!this.#pendingCleanup || this.destroyed) {\n      return false;\n    }\n    for (const { renderTasks, operatorList } of this._intentStates.values()) {\n      if (renderTasks.size > 0 || !operatorList.lastChunk) {\n        return false;\n      }\n    }\n    this._intentStates.clear();\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    return true;\n  }\n\n  /**\n   * @private\n   */\n  _startRenderPage(transparency, cacheKey) {\n    const intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      return; // Rendering was cancelled.\n    }\n    this._stats?.timeEnd(\"Page Request\");\n\n    // TODO Refactor RenderPageRequest to separate rendering\n    // and operator list logic\n    intentState.displayReadyCapability?.resolve(transparency);\n  }\n\n  /**\n   * @private\n   */\n  _renderPageChunk(operatorListChunk, intentState) {\n    // Add the new chunk to the current operator list.\n    for (let i = 0, ii = operatorListChunk.length; i < ii; i++) {\n      intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);\n      intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);\n    }\n    intentState.operatorList.lastChunk = operatorListChunk.lastChunk;\n    intentState.operatorList.separateAnnots = operatorListChunk.separateAnnots;\n\n    // Notify all the rendering tasks there are more operators to be consumed.\n    for (const internalRenderTask of intentState.renderTasks) {\n      internalRenderTask.operatorListChanged();\n    }\n\n    if (operatorListChunk.lastChunk) {\n      this.#tryCleanup();\n    }\n  }\n\n  /**\n   * @private\n   */\n  _pumpOperatorList({\n    renderingIntent,\n    cacheKey,\n    annotationStorageSerializable,\n    modifiedIds,\n  }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        Number.isInteger(renderingIntent) && renderingIntent > 0,\n        '_pumpOperatorList: Expected valid \"renderingIntent\" argument.'\n      );\n    }\n    const { map, transfer } = annotationStorageSerializable;\n\n    const readableStream = this._transport.messageHandler.sendWithStream(\n      \"GetOperatorList\",\n      {\n        pageIndex: this._pageIndex,\n        intent: renderingIntent,\n        cacheKey,\n        annotationStorage: map,\n        modifiedIds,\n      },\n      transfer\n    );\n    const reader = readableStream.getReader();\n\n    const intentState = this._intentStates.get(cacheKey);\n    intentState.streamReader = reader;\n\n    const pump = () => {\n      reader.read().then(\n        ({ value, done }) => {\n          if (done) {\n            intentState.streamReader = null;\n            return;\n          }\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          this._renderPageChunk(value, intentState);\n          pump();\n        },\n        reason => {\n          intentState.streamReader = null;\n\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          if (intentState.operatorList) {\n            // Mark operator list as complete.\n            intentState.operatorList.lastChunk = true;\n\n            for (const internalRenderTask of intentState.renderTasks) {\n              internalRenderTask.operatorListChanged();\n            }\n            this.#tryCleanup();\n          }\n\n          if (intentState.displayReadyCapability) {\n            intentState.displayReadyCapability.reject(reason);\n          } else if (intentState.opListReadCapability) {\n            intentState.opListReadCapability.reject(reason);\n          } else {\n            throw reason;\n          }\n        }\n      );\n    };\n    pump();\n  }\n\n  /**\n   * @private\n   */\n  _abortOperatorList({ intentState, reason, force = false }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        reason instanceof Error,\n        '_abortOperatorList: Expected valid \"reason\" argument.'\n      );\n    }\n\n    if (!intentState.streamReader) {\n      return;\n    }\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    if (!force) {\n      // Ensure that an Error occurring in *only* one `InternalRenderTask`, e.g.\n      // multiple render() calls on the same canvas, won't break all rendering.\n      if (intentState.renderTasks.size > 0) {\n        return;\n      }\n      // Don't immediately abort parsing on the worker-thread when rendering is\n      // cancelled, since that will unnecessarily delay re-rendering when (for\n      // partially parsed pages) e.g. zooming/rotation occurs in the viewer.\n      if (reason instanceof RenderingCancelledException) {\n        let delay = RENDERING_CANCELLED_TIMEOUT;\n        if (reason.extraDelay > 0 && reason.extraDelay < /* ms = */ 1000) {\n          // Above, we prevent the total delay from becoming arbitrarily large.\n          delay += reason.extraDelay;\n        }\n\n        intentState.streamReaderCancelTimeout = setTimeout(() => {\n          intentState.streamReaderCancelTimeout = null;\n          this._abortOperatorList({ intentState, reason, force: true });\n        }, delay);\n        return;\n      }\n    }\n    intentState.streamReader\n      .cancel(new AbortException(reason.message))\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n    intentState.streamReader = null;\n\n    if (this._transport.destroyed) {\n      return; // Ignore any pending requests if the worker was terminated.\n    }\n    // Remove the current `intentState`, since a cancelled `getOperatorList`\n    // call on the worker-thread cannot be re-started...\n    for (const [curCacheKey, curIntentState] of this._intentStates) {\n      if (curIntentState === intentState) {\n        this._intentStates.delete(curCacheKey);\n        break;\n      }\n    }\n    // ... and force clean-up to ensure that any old state is always removed.\n    this.cleanup();\n  }\n\n  /**\n   * @type {StatTimer | null} Returns page stats, if enabled; returns `null`\n   *   otherwise.\n   */\n  get stats() {\n    return this._stats;\n  }\n}\n\n/**\n * @typedef {Object} PDFWorkerParameters\n * @property {string} [name] - The name of the worker.\n * @property {Worker} [port] - The `workerPort` object.\n * @property {number} [verbosity] - Controls the logging level;\n *   the constants from {@link VerbosityLevel} should be used.\n */\n\n/**\n * PDF.js web worker abstraction that controls the instantiation of PDF\n * documents. Message handlers are used to pass information from the main\n * thread to the worker thread and vice versa. If the creation of a web\n * worker is not possible, a \"fake\" worker will be used instead.\n *\n * @param {PDFWorkerParameters} params - The worker initialization parameters.\n */\nclass PDFWorker {\n  #capability = Promise.withResolvers();\n\n  #messageHandler = null;\n\n  #port = null;\n\n  #webWorker = null;\n\n  static #fakeWorkerId = 0;\n\n  static #isWorkerDisabled = false;\n\n  static #workerPorts = new WeakMap();\n\n  static {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      if (isNodeJS) {\n        // Workers aren't supported in Node.js, force-disabling them there.\n        this.#isWorkerDisabled = true;\n\n        GlobalWorkerOptions.workerSrc ||= PDFJSDev.test(\"LIB\")\n          ? \"../pdf.worker.js\"\n          : \"./pdf.worker.mjs\";\n      }\n\n      // Check if URLs have the same origin. For non-HTTP based URLs, returns\n      // false.\n      this._isSameOrigin = (baseUrl, otherUrl) => {\n        const base = URL.parse(baseUrl);\n        if (!base?.origin || base.origin === \"null\") {\n          return false; // non-HTTP url\n        }\n        const other = new URL(otherUrl, base);\n        return base.origin === other.origin;\n      };\n\n      this._createCDNWrapper = url => {\n        // We will rely on blob URL's property to specify origin.\n        // We want this function to fail in case if createObjectURL or Blob do\n        // not exist or fail for some reason -- our Worker creation will fail\n        // anyway.\n        const wrapper = `await import(\"${url}\");`;\n        return URL.createObjectURL(\n          new Blob([wrapper], { type: \"text/javascript\" })\n        );\n      };\n\n      this.fromPort = params => {\n        deprecated(\n          \"`PDFWorker.fromPort` - please use `PDFWorker.create` instead.\"\n        );\n        if (!params?.port) {\n          throw new Error(\"PDFWorker.fromPort - invalid method signature.\");\n        }\n        return this.create(params);\n      };\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      this._resetGlobalState = () => {\n        this.#isWorkerDisabled = false;\n        delete globalThis.pdfjsWorker;\n      };\n    }\n  }\n\n  constructor({\n    name = null,\n    port = null,\n    verbosity = getVerbosityLevel(),\n  } = {}) {\n    this.name = name;\n    this.destroyed = false;\n    this.verbosity = verbosity;\n\n    if (port) {\n      if (PDFWorker.#workerPorts.has(port)) {\n        throw new Error(\"Cannot use more than one PDFWorker per port.\");\n      }\n      PDFWorker.#workerPorts.set(port, this);\n      this.#initializeFromPort(port);\n    } else {\n      this.#initialize();\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_webWorker\", {\n        get() {\n          return this.#webWorker;\n        },\n      });\n    }\n  }\n\n  /**\n   * Promise for worker initialization completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#capability.promise;\n  }\n\n  #resolve() {\n    this.#capability.resolve();\n    // Send global setting, e.g. verbosity level.\n    this.#messageHandler.send(\"configure\", {\n      verbosity: this.verbosity,\n    });\n  }\n\n  /**\n   * The current `workerPort`, when it exists.\n   * @type {Worker}\n   */\n  get port() {\n    return this.#port;\n  }\n\n  /**\n   * The current MessageHandler-instance.\n   * @type {MessageHandler}\n   */\n  get messageHandler() {\n    return this.#messageHandler;\n  }\n\n  #initializeFromPort(port) {\n    this.#port = port;\n    this.#messageHandler = new MessageHandler(\"main\", \"worker\", port);\n    this.#messageHandler.on(\"ready\", () => {\n      // Ignoring \"ready\" event -- MessageHandler should already be initialized\n      // and ready to accept messages.\n    });\n    this.#resolve();\n  }\n\n  #initialize() {\n    // If worker support isn't disabled explicit and the browser has worker\n    // support, create a new web worker and test if it/the browser fulfills\n    // all requirements to run parts of pdf.js in a web worker.\n    // Right now, the requirement is, that an Uint8Array is still an\n    // Uint8Array as it arrives on the worker.\n    if (\n      PDFWorker.#isWorkerDisabled ||\n      PDFWorker.#mainThreadWorkerMessageHandler\n    ) {\n      this.#setupFakeWorker();\n      return;\n    }\n    let { workerSrc } = PDFWorker;\n\n    try {\n      // Wraps workerSrc path into blob URL, if the former does not belong\n      // to the same origin.\n      if (\n        typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"GENERIC\") &&\n        !PDFWorker._isSameOrigin(window.location, workerSrc)\n      ) {\n        workerSrc = PDFWorker._createCDNWrapper(\n          new URL(workerSrc, window.location).href\n        );\n      }\n\n      const worker = new Worker(workerSrc, { type: \"module\" });\n      const messageHandler = new MessageHandler(\"main\", \"worker\", worker);\n      const terminateEarly = () => {\n        ac.abort();\n        messageHandler.destroy();\n        worker.terminate();\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n        } else {\n          // Fall back to fake worker if the termination is caused by an\n          // error (e.g. NetworkError / SecurityError).\n          this.#setupFakeWorker();\n        }\n      };\n\n      const ac = new AbortController();\n      worker.addEventListener(\n        \"error\",\n        () => {\n          if (!this.#webWorker) {\n            // Worker failed to initialize due to an error. Clean up and fall\n            // back to the fake worker.\n            terminateEarly();\n          }\n        },\n        { signal: ac.signal }\n      );\n\n      messageHandler.on(\"test\", data => {\n        ac.abort();\n        if (this.destroyed || !data) {\n          terminateEarly();\n          return;\n        }\n        this.#messageHandler = messageHandler;\n        this.#port = worker;\n        this.#webWorker = worker;\n\n        this.#resolve();\n      });\n\n      messageHandler.on(\"ready\", data => {\n        ac.abort();\n        if (this.destroyed) {\n          terminateEarly();\n          return;\n        }\n        try {\n          sendTest();\n        } catch {\n          // We need fallback to a faked worker.\n          this.#setupFakeWorker();\n        }\n      });\n\n      const sendTest = () => {\n        const testObj = new Uint8Array();\n        // Ensure that we can use `postMessage` transfers.\n        messageHandler.send(\"test\", testObj, [testObj.buffer]);\n      };\n\n      // It might take time for the worker to initialize. We will try to send\n      // the \"test\" message immediately, and once the \"ready\" message arrives.\n      // The worker shall process only the first received \"test\" message.\n      sendTest();\n      return;\n    } catch {\n      info(\"The worker has been disabled.\");\n    }\n    // Either workers are not supported or have thrown an exception.\n    // Thus, we fallback to a faked worker.\n    this.#setupFakeWorker();\n  }\n\n  #setupFakeWorker() {\n    if (!PDFWorker.#isWorkerDisabled) {\n      warn(\"Setting up fake worker.\");\n      PDFWorker.#isWorkerDisabled = true;\n    }\n\n    PDFWorker._setupFakeWorkerGlobal\n      .then(WorkerMessageHandler => {\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n          return;\n        }\n        const port = new LoopbackPort();\n        this.#port = port;\n\n        // All fake workers use the same port, making id unique.\n        const id = `fake${PDFWorker.#fakeWorkerId++}`;\n\n        // If the main thread is our worker, setup the handling for the\n        // messages -- the main thread sends to it self.\n        const workerHandler = new MessageHandler(id + \"_worker\", id, port);\n        WorkerMessageHandler.setup(workerHandler, port);\n\n        this.#messageHandler = new MessageHandler(id, id + \"_worker\", port);\n        this.#resolve();\n      })\n      .catch(reason => {\n        this.#capability.reject(\n          new Error(`Setting up fake worker failed: \"${reason.message}\".`)\n        );\n      });\n  }\n\n  /**\n   * Destroys the worker instance.\n   */\n  destroy() {\n    this.destroyed = true;\n\n    // We need to terminate only web worker created resource.\n    this.#webWorker?.terminate();\n    this.#webWorker = null;\n\n    PDFWorker.#workerPorts.delete(this.#port);\n    this.#port = null;\n\n    this.#messageHandler?.destroy();\n    this.#messageHandler = null;\n  }\n\n  /**\n   * @param {PDFWorkerParameters} params - The worker initialization parameters.\n   * @returns {PDFWorker}\n   */\n  static create(params) {\n    const cachedPort = this.#workerPorts.get(params?.port);\n    if (cachedPort) {\n      if (cachedPort._pendingDestroy) {\n        throw new Error(\n          \"PDFWorker.create - the worker is being destroyed.\\n\" +\n            \"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.\"\n        );\n      }\n      return cachedPort;\n    }\n    return new PDFWorker(params);\n  }\n\n  /**\n   * The current `workerSrc`, when it exists.\n   * @type {string}\n   */\n  static get workerSrc() {\n    if (GlobalWorkerOptions.workerSrc) {\n      return GlobalWorkerOptions.workerSrc;\n    }\n    throw new Error('No \"GlobalWorkerOptions.workerSrc\" specified.');\n  }\n\n  static get #mainThreadWorkerMessageHandler() {\n    try {\n      return globalThis.pdfjsWorker?.WorkerMessageHandler || null;\n    } catch {\n      return null;\n    }\n  }\n\n  // Loads worker code into the main-thread.\n  static get _setupFakeWorkerGlobal() {\n    const loader = async () => {\n      if (this.#mainThreadWorkerMessageHandler) {\n        // The worker was already loaded using e.g. a `<script>` tag.\n        return this.#mainThreadWorkerMessageHandler;\n      }\n      const worker =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(\"pdfjs/pdf.worker.js\")\n          : await __raw_import__(this.workerSrc);\n      return worker.WorkerMessageHandler;\n    };\n\n    return shadow(this, \"_setupFakeWorkerGlobal\", loader());\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass WorkerTransport {\n  #methodPromises = new Map();\n\n  #pageCache = new Map();\n\n  #pagePromises = new Map();\n\n  #pageRefCache = new Map();\n\n  #passwordCapability = null;\n\n  constructor(\n    messageHandler,\n    loadingTask,\n    networkStream,\n    params,\n    factory,\n    enableHWA\n  ) {\n    this.messageHandler = messageHandler;\n    this.loadingTask = loadingTask;\n    this.commonObjs = new PDFObjects();\n    this.fontLoader = new FontLoader({\n      ownerDocument: params.ownerDocument,\n      styleElement: params.styleElement,\n    });\n    this.loadingParams = params.loadingParams;\n    this._params = params;\n\n    this.canvasFactory = factory.canvasFactory;\n    this.filterFactory = factory.filterFactory;\n    this.cMapReaderFactory = factory.cMapReaderFactory;\n    this.standardFontDataFactory = factory.standardFontDataFactory;\n    this.wasmFactory = factory.wasmFactory;\n\n    this.destroyed = false;\n    this.destroyCapability = null;\n\n    this._networkStream = networkStream;\n    this._fullReader = null;\n    this._lastProgress = null;\n    this.downloadInfoCapability = Promise.withResolvers();\n    this.enableHWA = enableHWA;\n\n    this.setupMessageHandler();\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => networkStream?.constructor?.name || null,\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXFADatasets\", null),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXRefPrevValue\", null),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetStartXRefPos\", null),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex =>\n          this.messageHandler.sendWithPromise(\"GetAnnotArray\", { pageIndex }),\n      });\n    }\n  }\n\n  #cacheSimpleMethod(name, data = null) {\n    const cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler.sendWithPromise(name, data);\n\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  get annotationStorage() {\n    return shadow(this, \"annotationStorage\", new AnnotationStorage());\n  }\n\n  getRenderingIntent(\n    intent,\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n    isOpList = false\n  ) {\n    let renderingIntent = RenderingIntentFlag.DISPLAY; // Default value.\n    let annotationStorageSerializable = SerializableEmpty;\n\n    switch (intent) {\n      case \"any\":\n        renderingIntent = RenderingIntentFlag.ANY;\n        break;\n      case \"display\":\n        break;\n      case \"print\":\n        renderingIntent = RenderingIntentFlag.PRINT;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid intent: ${intent}`);\n    }\n\n    const annotationStorage =\n      renderingIntent & RenderingIntentFlag.PRINT &&\n      printAnnotationStorage instanceof PrintAnnotationStorage\n        ? printAnnotationStorage\n        : this.annotationStorage;\n\n    switch (annotationMode) {\n      case AnnotationMode.DISABLE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_DISABLE;\n        break;\n      case AnnotationMode.ENABLE:\n        break;\n      case AnnotationMode.ENABLE_FORMS:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_FORMS;\n        break;\n      case AnnotationMode.ENABLE_STORAGE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_STORAGE;\n\n        annotationStorageSerializable = annotationStorage.serializable;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`);\n    }\n\n    if (isEditing) {\n      renderingIntent += RenderingIntentFlag.IS_EDITING;\n    }\n    if (isOpList) {\n      renderingIntent += RenderingIntentFlag.OPLIST;\n    }\n\n    const { ids: modifiedIds, hash: modifiedIdsHash } =\n      annotationStorage.modifiedIds;\n\n    const cacheKeyBuf = [\n      renderingIntent,\n      annotationStorageSerializable.hash,\n      modifiedIdsHash,\n    ];\n\n    return {\n      renderingIntent,\n      cacheKey: cacheKeyBuf.join(\"_\"),\n      annotationStorageSerializable,\n      modifiedIds,\n    };\n  }\n\n  destroy() {\n    if (this.destroyCapability) {\n      return this.destroyCapability.promise;\n    }\n\n    this.destroyed = true;\n    this.destroyCapability = Promise.withResolvers();\n\n    this.#passwordCapability?.reject(\n      new Error(\"Worker was destroyed during onPassword callback\")\n    );\n\n    const waitOn = [];\n    // We need to wait for all renderings to be completed, e.g.\n    // timeout/rAF can take a long time.\n    for (const page of this.#pageCache.values()) {\n      waitOn.push(page._destroy());\n    }\n    this.#pageCache.clear();\n    this.#pagePromises.clear();\n    this.#pageRefCache.clear();\n    // Allow `AnnotationStorage`-related clean-up when destroying the document.\n    if (this.hasOwnProperty(\"annotationStorage\")) {\n      this.annotationStorage.resetModified();\n    }\n    // We also need to wait for the worker to finish its long running tasks.\n    const terminated = this.messageHandler.sendWithPromise(\"Terminate\", null);\n    waitOn.push(terminated);\n\n    Promise.all(waitOn).then(() => {\n      this.commonObjs.clear();\n      this.fontLoader.clear();\n      this.#methodPromises.clear();\n      this.filterFactory.destroy();\n      TextLayer.cleanup();\n\n      this._networkStream?.cancelAllRequests(\n        new AbortException(\"Worker was terminated.\")\n      );\n\n      this.messageHandler?.destroy();\n      this.messageHandler = null;\n\n      this.destroyCapability.resolve();\n    }, this.destroyCapability.reject);\n    return this.destroyCapability.promise;\n  }\n\n  setupMessageHandler() {\n    const { messageHandler, loadingTask } = this;\n\n    messageHandler.on(\"GetReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetReader - no `IPDFStream` instance available.\"\n      );\n      this._fullReader = this._networkStream.getFullReader();\n      this._fullReader.onProgress = evt => {\n        this._lastProgress = {\n          loaded: evt.loaded,\n          total: evt.total,\n        };\n      };\n      sink.onPull = () => {\n        this._fullReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetReader - expected an ArrayBuffer.\"\n            );\n            // Enqueue data chunk into sink, and transfer it\n            // to other side as `Transferable` object.\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        this._fullReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"ReaderHeadersReady\", async data => {\n      await this._fullReader.headersReady;\n\n      const { isStreamingSupported, isRangeSupported, contentLength } =\n        this._fullReader;\n\n      // If stream or range are disabled, it's our only way to report\n      // loading progress.\n      if (!isStreamingSupported || !isRangeSupported) {\n        if (this._lastProgress) {\n          loadingTask.onProgress?.(this._lastProgress);\n        }\n        this._fullReader.onProgress = evt => {\n          loadingTask.onProgress?.({\n            loaded: evt.loaded,\n            total: evt.total,\n          });\n        };\n      }\n\n      return { isStreamingSupported, isRangeSupported, contentLength };\n    });\n\n    messageHandler.on(\"GetRangeReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetRangeReader - no `IPDFStream` instance available.\"\n      );\n      const rangeReader = this._networkStream.getRangeReader(\n        data.begin,\n        data.end\n      );\n\n      // When streaming is enabled, it's possible that the data requested here\n      // has already been fetched via the `_fullRequestReader` implementation.\n      // However, given that the PDF data is loaded asynchronously on the\n      // main-thread and then sent via `postMessage` to the worker-thread,\n      // it may not have been available during parsing (hence the attempt to\n      // use range requests here).\n      //\n      // To avoid wasting time and resources here, we'll thus *not* dispatch\n      // range requests if the data was already loaded but has not been sent to\n      // the worker-thread yet (which will happen via the `_fullRequestReader`).\n      if (!rangeReader) {\n        sink.close();\n        return;\n      }\n\n      sink.onPull = () => {\n        rangeReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetRangeReader - expected an ArrayBuffer.\"\n            );\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        rangeReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"GetDoc\", ({ pdfInfo }) => {\n      this._numPages = pdfInfo.numPages;\n      this._htmlForXfa = pdfInfo.htmlForXfa;\n      delete pdfInfo.htmlForXfa;\n      loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo, this));\n    });\n\n    messageHandler.on(\"DocException\", ex => {\n      loadingTask._capability.reject(wrapReason(ex));\n    });\n\n    messageHandler.on(\"PasswordRequest\", ex => {\n      this.#passwordCapability = Promise.withResolvers();\n\n      try {\n        if (!loadingTask.onPassword) {\n          throw wrapReason(ex);\n        }\n\n        const updatePassword = password => {\n          if (password instanceof Error) {\n            this.#passwordCapability.reject(password);\n          } else {\n            this.#passwordCapability.resolve({ password });\n          }\n        };\n        loadingTask.onPassword(updatePassword, ex.code);\n      } catch (err) {\n        this.#passwordCapability.reject(err);\n      }\n      return this.#passwordCapability.promise;\n    });\n\n    messageHandler.on(\"DataLoaded\", data => {\n      // For consistency: Ensure that progress is always reported when the\n      // entire PDF file has been loaded, regardless of how it was fetched.\n      loadingTask.onProgress?.({\n        loaded: data.length,\n        total: data.length,\n      });\n\n      this.downloadInfoCapability.resolve(data);\n    });\n\n    messageHandler.on(\"StartRenderPage\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n\n      const page = this.#pageCache.get(data.pageIndex);\n      page._startRenderPage(data.transparency, data.cacheKey);\n    });\n\n    messageHandler.on(\"commonobj\", ([id, type, exportedData]) => {\n      if (this.destroyed) {\n        return null; // Ignore any pending requests if the worker was terminated.\n      }\n\n      if (this.commonObjs.has(id)) {\n        return null;\n      }\n\n      switch (type) {\n        case \"Font\":\n          if (\"error\" in exportedData) {\n            const exportedError = exportedData.error;\n            warn(`Error during font loading: ${exportedError}`);\n            this.commonObjs.resolve(id, exportedError);\n            break;\n          }\n\n          const fontData = new FontInfo(exportedData);\n          const inspectFont =\n            this._params.pdfBug && globalThis.FontInspector?.enabled\n              ? (font, url) => globalThis.FontInspector.fontAdded(font, url)\n              : null;\n          const font = new FontFaceObject(\n            fontData,\n            inspectFont,\n            exportedData.extra,\n            exportedData.charProcOperatorList\n          );\n\n          this.fontLoader\n            .bind(font)\n            .catch(() => messageHandler.sendWithPromise(\"FontFallback\", { id }))\n            .finally(() => {\n              if (!font.fontExtraProperties && font.data) {\n                // Immediately release the `font.data` property once the font\n                // has been attached to the DOM, since it's no longer needed,\n                // rather than waiting for a `PDFDocumentProxy.cleanup` call.\n                // Since `font.data` could be very large, e.g. in some cases\n                // multiple megabytes, this will help reduce memory usage.\n                font.clearData();\n              }\n              this.commonObjs.resolve(id, font);\n            });\n          break;\n        case \"CopyLocalImage\":\n          const { imageRef } = exportedData;\n          assert(imageRef, \"The imageRef must be defined.\");\n\n          for (const pageProxy of this.#pageCache.values()) {\n            for (const [, data] of pageProxy.objs) {\n              if (data?.ref !== imageRef) {\n                continue;\n              }\n              if (!data.dataLen) {\n                return null;\n              }\n              this.commonObjs.resolve(id, structuredClone(data));\n              return data.dataLen;\n            }\n          }\n          break;\n        case \"FontPath\":\n        case \"Image\":\n          this.commonObjs.resolve(id, exportedData);\n          break;\n        case \"Pattern\":\n          const pattern = new PatternInfo(exportedData);\n          this.commonObjs.resolve(id, pattern.getIR());\n          break;\n        default:\n          throw new Error(`Got unknown common object type ${type}`);\n      }\n\n      return null;\n    });\n\n    messageHandler.on(\"obj\", ([id, pageIndex, type, imageData]) => {\n      if (this.destroyed) {\n        // Ignore any pending requests if the worker was terminated.\n        return;\n      }\n\n      const pageProxy = this.#pageCache.get(pageIndex);\n      if (pageProxy.objs.has(id)) {\n        return;\n      }\n      // Don't store data *after* cleanup has successfully run, see bug 1854145.\n      if (pageProxy._intentStates.size === 0) {\n        imageData?.bitmap?.close(); // Release any `ImageBitmap` data.\n        return;\n      }\n\n      switch (type) {\n        case \"Image\":\n        case \"Pattern\":\n          pageProxy.objs.resolve(id, imageData);\n          break;\n        default:\n          throw new Error(`Got unknown object type ${type}`);\n      }\n    });\n\n    messageHandler.on(\"DocProgress\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n      loadingTask.onProgress?.({\n        loaded: data.loaded,\n        total: data.total,\n      });\n    });\n\n    messageHandler.on(\"FetchBinaryData\", async data => {\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: FetchBinaryData\");\n      }\n      if (this.destroyed) {\n        throw new Error(\"Worker was destroyed.\");\n      }\n      const factory = this[data.type];\n\n      if (!factory) {\n        throw new Error(\n          `${data.type} not initialized, see the \\`useWorkerFetch\\` parameter.`\n        );\n      }\n      return factory.fetch(data);\n    });\n  }\n\n  getData() {\n    return this.messageHandler.sendWithPromise(\"GetData\", null);\n  }\n\n  saveDocument() {\n    if (this.annotationStorage.size <= 0) {\n      warn(\n        \"saveDocument called while `annotationStorage` is empty, \" +\n          \"please use the getData-method instead.\"\n      );\n    }\n    const { map, transfer } = this.annotationStorage.serializable;\n\n    return this.messageHandler\n      .sendWithPromise(\n        \"SaveDocument\",\n        {\n          isPureXfa: !!this._htmlForXfa,\n          numPages: this._numPages,\n          annotationStorage: map,\n          filename: this._fullReader?.filename ?? null,\n        },\n        transfer\n      )\n      .finally(() => {\n        this.annotationStorage.resetModified();\n      });\n  }\n\n  extractPages(pageInfos) {\n    return this.messageHandler.sendWithPromise(\"ExtractPages\", { pageInfos });\n  }\n\n  getPage(pageNumber) {\n    if (\n      !Number.isInteger(pageNumber) ||\n      pageNumber <= 0 ||\n      pageNumber > this._numPages\n    ) {\n      return Promise.reject(new Error(\"Invalid page request.\"));\n    }\n\n    const pageIndex = pageNumber - 1,\n      cachedPromise = this.#pagePromises.get(pageIndex);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(\"GetPage\", {\n        pageIndex,\n      })\n      .then(pageInfo => {\n        if (this.destroyed) {\n          throw new Error(\"Transport destroyed\");\n        }\n        if (pageInfo.refStr) {\n          this.#pageRefCache.set(pageInfo.refStr, pageNumber);\n        }\n\n        const page = new PDFPageProxy(\n          pageIndex,\n          pageInfo,\n          this,\n          this._params.pdfBug\n        );\n        this.#pageCache.set(pageIndex, page);\n        return page;\n      });\n    this.#pagePromises.set(pageIndex, promise);\n    return promise;\n  }\n\n  getPageIndex(ref) {\n    if (!isRefProxy(ref)) {\n      return Promise.reject(new Error(\"Invalid pageIndex request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetPageIndex\", {\n      num: ref.num,\n      gen: ref.gen,\n    });\n  }\n\n  getAnnotations(pageIndex, intent) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotations\", {\n      pageIndex,\n      intent,\n    });\n  }\n\n  getFieldObjects() {\n    return this.#cacheSimpleMethod(\"GetFieldObjects\");\n  }\n\n  hasJSActions() {\n    return this.#cacheSimpleMethod(\"HasJSActions\");\n  }\n\n  getCalculationOrderIds() {\n    return this.messageHandler.sendWithPromise(\"GetCalculationOrderIds\", null);\n  }\n\n  getDestinations() {\n    return this.messageHandler.sendWithPromise(\"GetDestinations\", null);\n  }\n\n  getDestination(id) {\n    if (typeof id !== \"string\") {\n      return Promise.reject(new Error(\"Invalid destination request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetDestination\", {\n      id,\n    });\n  }\n\n  getPageLabels() {\n    return this.messageHandler.sendWithPromise(\"GetPageLabels\", null);\n  }\n\n  getPageLayout() {\n    return this.messageHandler.sendWithPromise(\"GetPageLayout\", null);\n  }\n\n  getPageMode() {\n    return this.messageHandler.sendWithPromise(\"GetPageMode\", null);\n  }\n\n  getViewerPreferences() {\n    return this.messageHandler.sendWithPromise(\"GetViewerPreferences\", null);\n  }\n\n  getOpenAction() {\n    return this.messageHandler.sendWithPromise(\"GetOpenAction\", null);\n  }\n\n  getAttachments() {\n    return this.messageHandler.sendWithPromise(\"GetAttachments\", null);\n  }\n\n  getAnnotationsByType(types, pageIndexesToSkip) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotationsByType\", {\n      types,\n      pageIndexesToSkip,\n    });\n  }\n\n  getDocJSActions() {\n    return this.#cacheSimpleMethod(\"GetDocJSActions\");\n  }\n\n  getPageJSActions(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetPageJSActions\", {\n      pageIndex,\n    });\n  }\n\n  getStructTree(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetStructTree\", {\n      pageIndex,\n    });\n  }\n\n  getOutline() {\n    return this.messageHandler.sendWithPromise(\"GetOutline\", null);\n  }\n\n  getOptionalContentConfig(renderingIntent) {\n    return this.#cacheSimpleMethod(\"GetOptionalContentConfig\").then(\n      data => new OptionalContentConfig(data, renderingIntent)\n    );\n  }\n\n  getPermissions() {\n    return this.messageHandler.sendWithPromise(\"GetPermissions\", null);\n  }\n\n  getMetadata() {\n    const name = \"GetMetadata\",\n      cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(name, null)\n      .then(results => ({\n        info: results[0],\n        metadata: results[1] ? new Metadata(results[1]) : null,\n        contentDispositionFilename: this._fullReader?.filename ?? null,\n        contentLength: this._fullReader?.contentLength ?? null,\n        hasStructTree: results[2],\n      }));\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  getMarkInfo() {\n    return this.messageHandler.sendWithPromise(\"GetMarkInfo\", null);\n  }\n\n  async startCleanup(keepLoadedFonts = false) {\n    if (this.destroyed) {\n      return; // No need to manually clean-up when destruction has started.\n    }\n    await this.messageHandler.sendWithPromise(\"Cleanup\", null);\n\n    for (const page of this.#pageCache.values()) {\n      const cleanupSuccessful = page.cleanup();\n\n      if (!cleanupSuccessful) {\n        throw new Error(\n          `startCleanup: Page ${page.pageNumber} is currently rendering.`\n        );\n      }\n    }\n    this.commonObjs.clear();\n    if (!keepLoadedFonts) {\n      this.fontLoader.clear();\n    }\n    this.#methodPromises.clear();\n    this.filterFactory.destroy(/* keepHCM = */ true);\n    TextLayer.cleanup();\n  }\n\n  cachedPageNumber(ref) {\n    if (!isRefProxy(ref)) {\n      return null;\n    }\n    const refStr = ref.gen === 0 ? `${ref.num}R` : `${ref.num}R${ref.gen}`;\n    return this.#pageRefCache.get(refStr) ?? null;\n  }\n}\n\n/**\n * Allows controlling of the rendering tasks.\n */\nclass RenderTask {\n  #internalRenderTask = null;\n\n  /**\n   * Callback for incremental rendering -- a function that will be called\n   * each time the rendering is paused.  To continue rendering call the\n   * function that is the first argument to the callback.\n   * @type {function}\n   */\n  onContinue = null;\n\n  /**\n   * A function that will be synchronously called when the rendering tasks\n   * finishes with an error (either because of an actual error, or because the\n   * rendering is cancelled).\n   *\n   * @type {function}\n   * @param {Error} error\n   */\n  onError = null;\n\n  constructor(internalRenderTask) {\n    this.#internalRenderTask = internalRenderTask;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getOperatorList\", {\n        value: () => this.#internalRenderTask.operatorList,\n      });\n    }\n  }\n\n  /**\n   * Promise for rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#internalRenderTask.capability.promise;\n  }\n\n  /**\n   * Cancels the rendering task. If the task is currently rendering it will\n   * not be cancelled until graphics pauses with a timeout. The promise that\n   * this object extends will be rejected when cancelled.\n   *\n   * @param {number} [extraDelay]\n   */\n  cancel(extraDelay = 0) {\n    this.#internalRenderTask.cancel(/* error = */ null, extraDelay);\n  }\n\n  /**\n   * Whether form fields are rendered separately from the main operatorList.\n   * @type {boolean}\n   */\n  get separateAnnots() {\n    const { separateAnnots } = this.#internalRenderTask.operatorList;\n    if (!separateAnnots) {\n      return false;\n    }\n    const { annotationCanvasMap } = this.#internalRenderTask;\n    return (\n      separateAnnots.form ||\n      (separateAnnots.canvas && annotationCanvasMap?.size > 0)\n    );\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass InternalRenderTask {\n  #rAF = null;\n\n  static #canvasInUse = new WeakSet();\n\n  constructor({\n    callback,\n    params,\n    objs,\n    commonObjs,\n    annotationCanvasMap,\n    operatorList,\n    pageIndex,\n    canvasFactory,\n    filterFactory,\n    useRequestAnimationFrame = false,\n    pdfBug = false,\n    pageColors = null,\n    enableHWA = false,\n    operationsFilter = null,\n  }) {\n    this.callback = callback;\n    this.params = params;\n    this.objs = objs;\n    this.commonObjs = commonObjs;\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.operatorListIdx = null;\n    this.operatorList = operatorList;\n    this._pageIndex = pageIndex;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this._pdfBug = pdfBug;\n    this.pageColors = pageColors;\n\n    this.running = false;\n    this.graphicsReadyCallback = null;\n    this.graphicsReady = false;\n    this._useRequestAnimationFrame =\n      useRequestAnimationFrame === true && typeof window !== \"undefined\";\n    this.cancelled = false;\n    this.capability = Promise.withResolvers();\n    this.task = new RenderTask(this);\n    // caching this-bound methods\n    this._cancelBound = this.cancel.bind(this);\n    this._continueBound = this._continue.bind(this);\n    this._scheduleNextBound = this._scheduleNext.bind(this);\n    this._nextBound = this._next.bind(this);\n    this._canvas = params.canvas;\n    this._canvasContext = params.canvas ? null : params.canvasContext;\n    this._enableHWA = enableHWA;\n    this._dependencyTracker = params.dependencyTracker;\n    this._operationsFilter = operationsFilter;\n  }\n\n  get completed() {\n    return this.capability.promise.catch(function () {\n      // Ignoring errors, since we only want to know when rendering is\n      // no longer pending.\n    });\n  }\n\n  initializeGraphics({ transparency = false, optionalContentConfig }) {\n    if (this.cancelled) {\n      return;\n    }\n    if (this._canvas) {\n      if (InternalRenderTask.#canvasInUse.has(this._canvas)) {\n        throw new Error(\n          \"Cannot use the same canvas during multiple render() operations. \" +\n            \"Use different canvas or ensure previous operations were \" +\n            \"cancelled or completed.\"\n        );\n      }\n      InternalRenderTask.#canvasInUse.add(this._canvas);\n    }\n\n    if (this._pdfBug && globalThis.StepperManager?.enabled) {\n      this.stepper = globalThis.StepperManager.create(this._pageIndex);\n      this.stepper.init(this.operatorList);\n      this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();\n    }\n    const { viewport, transform, background, dependencyTracker } = this.params;\n\n    // When printing in Firefox, we get a specific context in mozPrintCallback\n    // which cannot be created from the canvas itself.\n    const canvasContext =\n      this._canvasContext ||\n      this._canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: !this._enableHWA,\n      });\n\n    this.gfx = new CanvasGraphics(\n      canvasContext,\n      this.commonObjs,\n      this.objs,\n      this.canvasFactory,\n      this.filterFactory,\n      { optionalContentConfig },\n      this.annotationCanvasMap,\n      this.pageColors,\n      dependencyTracker\n    );\n    this.gfx.beginDrawing({\n      transform,\n      viewport,\n      transparency,\n      background,\n    });\n    this.operatorListIdx = 0;\n    this.graphicsReady = true;\n    this.graphicsReadyCallback?.();\n  }\n\n  cancel(error = null, extraDelay = 0) {\n    this.running = false;\n    this.cancelled = true;\n    this.gfx?.endDrawing();\n    if (this.#rAF) {\n      window.cancelAnimationFrame(this.#rAF);\n      this.#rAF = null;\n    }\n    InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n    error ||= new RenderingCancelledException(\n      `Rendering cancelled, page ${this._pageIndex + 1}`,\n      extraDelay\n    );\n    this.callback(error);\n\n    this.task.onError?.(error);\n  }\n\n  operatorListChanged() {\n    if (!this.graphicsReady) {\n      this.graphicsReadyCallback ||= this._continueBound;\n      return;\n    }\n    this.gfx.dependencyTracker?.growOperationsCount(\n      this.operatorList.fnArray.length\n    );\n    this.stepper?.updateOperatorList(this.operatorList);\n\n    if (this.running) {\n      return;\n    }\n    this._continue();\n  }\n\n  _continue() {\n    this.running = true;\n    if (this.cancelled) {\n      return;\n    }\n    if (this.task.onContinue) {\n      this.task.onContinue(this._scheduleNextBound);\n    } else {\n      this._scheduleNext();\n    }\n  }\n\n  _scheduleNext() {\n    if (this._useRequestAnimationFrame) {\n      this.#rAF = window.requestAnimationFrame(() => {\n        this.#rAF = null;\n        this._nextBound().catch(this._cancelBound);\n      });\n    } else {\n      Promise.resolve().then(this._nextBound).catch(this._cancelBound);\n    }\n  }\n\n  async _next() {\n    if (this.cancelled) {\n      return;\n    }\n    this.operatorListIdx = this.gfx.executeOperatorList(\n      this.operatorList,\n      this.operatorListIdx,\n      this._continueBound,\n      this.stepper,\n      this._operationsFilter\n    );\n    if (this.operatorListIdx === this.operatorList.argsArray.length) {\n      this.running = false;\n      if (this.operatorList.lastChunk) {\n        this.gfx.endDrawing();\n        InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n        this.callback();\n      }\n    }\n  }\n}\n\n/** @type {string} */\nconst version =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n/** @type {string} */\nconst build =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : null;\n\nexport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFDocumentLoadingTask,\n  PDFDocumentProxy,\n  PDFPageProxy,\n  PDFWorker,\n  RenderTask,\n  version,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, shadow } from \"../../shared/util.js\";\nimport { KeyboardManager } from \"./tools.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\n/**\n * ColorPicker class provides a color picker for the annotation editor.\n * It displays a dropdown with some predefined colors and allows the user\n * to select a color for the annotation.\n */\nclass ColorPicker {\n  #button = null;\n\n  #buttonSwatch = null;\n\n  #defaultColor;\n\n  #dropdown = null;\n\n  #dropdownWasFromKeyboard = false;\n\n  #isMainColorPicker = false;\n\n  #editor = null;\n\n  #eventBus;\n\n  #openDropdownAC = null;\n\n  #uiManager = null;\n\n  static #l10nColor = null;\n\n  static get _keyboardManager() {\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"Escape\", \"mac+Escape\"],\n          ColorPicker.prototype._hideDropdownFromKeyboard,\n        ],\n        [[\" \", \"mac+ \"], ColorPicker.prototype._colorSelectFromKeyboard],\n        [\n          [\"ArrowDown\", \"ArrowRight\", \"mac+ArrowDown\", \"mac+ArrowRight\"],\n          ColorPicker.prototype._moveToNext,\n        ],\n        [\n          [\"ArrowUp\", \"ArrowLeft\", \"mac+ArrowUp\", \"mac+ArrowLeft\"],\n          ColorPicker.prototype._moveToPrevious,\n        ],\n        [[\"Home\", \"mac+Home\"], ColorPicker.prototype._moveToBeginning],\n        [[\"End\", \"mac+End\"], ColorPicker.prototype._moveToEnd],\n      ])\n    );\n  }\n\n  constructor({ editor = null, uiManager = null }) {\n    if (editor) {\n      this.#isMainColorPicker = false;\n      this.#editor = editor;\n    } else {\n      this.#isMainColorPicker = true;\n    }\n    this.#uiManager = editor?._uiManager || uiManager;\n    this.#eventBus = this.#uiManager._eventBus;\n    this.#defaultColor =\n      editor?.color?.toUpperCase() ||\n      this.#uiManager?.highlightColors.values().next().value ||\n      \"#FFFF98\";\n\n    ColorPicker.#l10nColor ||= Object.freeze({\n      blue: \"pdfjs-editor-colorpicker-blue\",\n      green: \"pdfjs-editor-colorpicker-green\",\n      pink: \"pdfjs-editor-colorpicker-pink\",\n      red: \"pdfjs-editor-colorpicker-red\",\n      yellow: \"pdfjs-editor-colorpicker-yellow\",\n    });\n  }\n\n  renderButton() {\n    const button = (this.#button = document.createElement(\"button\"));\n    button.className = \"colorPicker\";\n    button.tabIndex = \"0\";\n    button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-button\");\n    button.ariaHasPopup = \"true\";\n    if (this.#editor) {\n      button.ariaControls = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"click\", this.#openDropdown.bind(this), { signal });\n    button.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n    const swatch = (this.#buttonSwatch = document.createElement(\"span\"));\n    swatch.className = \"swatch\";\n    swatch.ariaHidden = \"true\";\n    swatch.style.backgroundColor = this.#defaultColor;\n    button.append(swatch);\n    return button;\n  }\n\n  renderMainDropdown() {\n    const dropdown = (this.#dropdown = this.#getDropdownRoot());\n    dropdown.ariaOrientation = \"horizontal\";\n    dropdown.ariaLabelledBy = \"highlightColorPickerLabel\";\n\n    return dropdown;\n  }\n\n  #getDropdownRoot() {\n    const div = document.createElement(\"div\");\n    const signal = this.#uiManager._signal;\n    div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    div.className = \"dropdown\";\n    div.role = \"listbox\";\n    div.ariaMultiSelectable = \"false\";\n    div.ariaOrientation = \"vertical\";\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-dropdown\");\n    if (this.#editor) {\n      div.id = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    for (const [name, color] of this.#uiManager.highlightColors) {\n      const button = document.createElement(\"button\");\n      button.tabIndex = \"0\";\n      button.role = \"option\";\n      button.setAttribute(\"data-color\", color);\n      button.title = name;\n      button.setAttribute(\"data-l10n-id\", ColorPicker.#l10nColor[name]);\n      const swatch = document.createElement(\"span\");\n      button.append(swatch);\n      swatch.className = \"swatch\";\n      swatch.style.backgroundColor = color;\n      button.ariaSelected = color === this.#defaultColor;\n      button.addEventListener(\"click\", this.#colorSelect.bind(this, color), {\n        signal,\n      });\n      div.append(button);\n    }\n\n    div.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n\n    return div;\n  }\n\n  #colorSelect(color, event) {\n    event.stopPropagation();\n    this.#eventBus.dispatch(\"switchannotationeditorparams\", {\n      source: this,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      value: color,\n    });\n    this.updateColor(color);\n  }\n\n  _colorSelectFromKeyboard(event) {\n    if (event.target === this.#button) {\n      this.#openDropdown(event);\n      return;\n    }\n    const color = event.target.getAttribute(\"data-color\");\n    if (!color) {\n      return;\n    }\n    this.#colorSelect(color, event);\n  }\n\n  _moveToNext(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    if (event.target === this.#button) {\n      this.#dropdown.firstElementChild?.focus();\n      return;\n    }\n    event.target.nextSibling?.focus();\n  }\n\n  _moveToPrevious(event) {\n    if (\n      event.target === this.#dropdown?.firstElementChild ||\n      event.target === this.#button\n    ) {\n      if (this.#isDropdownVisible) {\n        this._hideDropdownFromKeyboard();\n      }\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n    }\n    event.target.previousSibling?.focus();\n  }\n\n  _moveToBeginning(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.firstElementChild?.focus();\n  }\n\n  _moveToEnd(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.lastElementChild?.focus();\n  }\n\n  #keyDown(event) {\n    ColorPicker._keyboardManager.exec(this, event);\n  }\n\n  #openDropdown(event) {\n    if (this.#isDropdownVisible) {\n      this.hideDropdown();\n      return;\n    }\n    this.#dropdownWasFromKeyboard = event.detail === 0;\n\n    if (!this.#openDropdownAC) {\n      this.#openDropdownAC = new AbortController();\n\n      window.addEventListener(\"pointerdown\", this.#pointerDown.bind(this), {\n        signal: this.#uiManager.combinedSignal(this.#openDropdownAC),\n      });\n    }\n    this.#button.ariaExpanded = \"true\";\n    if (this.#dropdown) {\n      this.#dropdown.classList.remove(\"hidden\");\n      return;\n    }\n    const root = (this.#dropdown = this.#getDropdownRoot());\n    this.#button.append(root);\n  }\n\n  #pointerDown(event) {\n    if (this.#dropdown?.contains(event.target)) {\n      return;\n    }\n    this.hideDropdown();\n  }\n\n  hideDropdown() {\n    this.#dropdown?.classList.add(\"hidden\");\n    this.#button.ariaExpanded = \"false\";\n    this.#openDropdownAC?.abort();\n    this.#openDropdownAC = null;\n  }\n\n  get #isDropdownVisible() {\n    return this.#dropdown && !this.#dropdown.classList.contains(\"hidden\");\n  }\n\n  _hideDropdownFromKeyboard() {\n    if (this.#isMainColorPicker) {\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      // The user pressed Escape with no dropdown visible, so we must\n      // unselect it.\n      this.#editor?.unselect();\n      return;\n    }\n    this.hideDropdown();\n    this.#button.focus({\n      preventScroll: true,\n      focusVisible: this.#dropdownWasFromKeyboard,\n    });\n  }\n\n  updateColor(color) {\n    if (this.#buttonSwatch) {\n      this.#buttonSwatch.style.backgroundColor = color;\n    }\n    if (!this.#dropdown) {\n      return;\n    }\n\n    const i = this.#uiManager.highlightColors.values();\n    for (const child of this.#dropdown.children) {\n      child.ariaSelected = i.next().value === color.toUpperCase();\n    }\n  }\n\n  destroy() {\n    this.#button?.remove();\n    this.#button = null;\n    this.#buttonSwatch = null;\n    this.#dropdown?.remove();\n    this.#dropdown = null;\n  }\n}\n\n/**\n * BasicColorPicker class provides a simple color picker.\n * It displays an input element (with type=\"color\") that allows the user\n * to select a color for the annotation.\n */\nclass BasicColorPicker {\n  #input = null;\n\n  #editor = null;\n\n  #uiManager = null;\n\n  static #l10nColor = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n    this.#uiManager = editor._uiManager;\n\n    BasicColorPicker.#l10nColor ||= Object.freeze({\n      freetext: \"pdfjs-editor-color-picker-free-text-input\",\n      ink: \"pdfjs-editor-color-picker-ink-input\",\n    });\n  }\n\n  renderButton() {\n    if (this.#input) {\n      return this.#input;\n    }\n    const { editorType, colorType, color } = this.#editor;\n    const input = (this.#input = document.createElement(\"input\"));\n    input.type = \"color\";\n    input.value = color || \"#000000\";\n    input.className = \"basicColorPicker\";\n    input.tabIndex = 0;\n    input.setAttribute(\"data-l10n-id\", BasicColorPicker.#l10nColor[editorType]);\n    input.addEventListener(\n      \"input\",\n      () => {\n        this.#uiManager.updateParams(colorType, input.value);\n      },\n      { signal: this.#uiManager._signal }\n    );\n    return input;\n  }\n\n  update(value) {\n    if (!this.#input) {\n      return;\n    }\n    this.#input.value = value;\n  }\n\n  destroy() {\n    this.#input?.remove();\n    this.#input = null;\n  }\n\n  hideDropdown() {}\n}\n\nexport { BasicColorPicker, ColorPicker };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * PLEASE NOTE: This file is currently imported in both the `../display/` and\n *              `../scripting_api/` folders, hence be EXTREMELY careful about\n *              introducing any dependencies here since that can lead to an\n *              unexpected/unnecessary size increase of the *built* files.\n */\n\nfunction makeColorComp(n) {\n  return Math.floor(Math.max(0, Math.min(1, n)) * 255)\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\nfunction scaleAndClamp(x) {\n  return Math.max(0, Math.min(255, 255 * x));\n}\n\n// PDF specifications section 10.3\nclass ColorConverters {\n  static CMYK_G([c, y, m, k]) {\n    return [\"G\", 1 - Math.min(1, 0.3 * c + 0.59 * m + 0.11 * y + k)];\n  }\n\n  static G_CMYK([g]) {\n    return [\"CMYK\", 0, 0, 0, 1 - g];\n  }\n\n  static G_RGB([g]) {\n    return [\"RGB\", g, g, g];\n  }\n\n  static G_rgb([g]) {\n    g = scaleAndClamp(g);\n    return [g, g, g];\n  }\n\n  static G_HTML([g]) {\n    const G = makeColorComp(g);\n    return `#${G}${G}${G}`;\n  }\n\n  static RGB_G([r, g, b]) {\n    return [\"G\", 0.3 * r + 0.59 * g + 0.11 * b];\n  }\n\n  static RGB_rgb(color) {\n    return color.map(scaleAndClamp);\n  }\n\n  static RGB_HTML(color) {\n    return `#${color.map(makeColorComp).join(\"\")}`;\n  }\n\n  static T_HTML() {\n    return \"#00000000\";\n  }\n\n  static T_rgb() {\n    return [null];\n  }\n\n  static CMYK_RGB([c, y, m, k]) {\n    return [\n      \"RGB\",\n      1 - Math.min(1, c + k),\n      1 - Math.min(1, m + k),\n      1 - Math.min(1, y + k),\n    ];\n  }\n\n  static CMYK_rgb([c, y, m, k]) {\n    return [\n      scaleAndClamp(1 - Math.min(1, c + k)),\n      scaleAndClamp(1 - Math.min(1, m + k)),\n      scaleAndClamp(1 - Math.min(1, y + k)),\n    ];\n  }\n\n  static CMYK_HTML(components) {\n    const rgb = this.CMYK_RGB(components).slice(1);\n    return this.RGB_HTML(rgb);\n  }\n\n  static RGB_CMYK([r, g, b]) {\n    const c = 1 - r;\n    const m = 1 - g;\n    const y = 1 - b;\n    const k = Math.min(c, m, y);\n    return [\"CMYK\", c, m, y, k];\n  }\n}\n\nconst DateFormats = [\n  \"m/d\",\n  \"m/d/yy\",\n  \"mm/dd/yy\",\n  \"mm/yy\",\n  \"d-mmm\",\n  \"d-mmm-yy\",\n  \"dd-mmm-yy\",\n  \"yy-mm-dd\",\n  \"mmm-yy\",\n  \"mmmm-yy\",\n  \"mmm d, yyyy\",\n  \"mmmm d, yyyy\",\n  \"m/d/yy h:MM tt\",\n  \"m/d/yy HH:MM\",\n];\nconst TimeFormats = [\"HH:MM\", \"h:MM tt\", \"HH:MM:ss\", \"h:MM:ss tt\"];\n\nexport { ColorConverters, DateFormats, TimeFormats };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SVG_NS } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseSVGFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseSVGFactory\n    ) {\n      unreachable(\"Cannot initialize BaseSVGFactory.\");\n    }\n  }\n\n  create(width, height, skipDimensions = false) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid SVG dimensions\");\n    }\n    const svg = this._createSVG(\"svg:svg\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    if (!skipDimensions) {\n      svg.setAttribute(\"width\", `${width}px`);\n      svg.setAttribute(\"height\", `${height}px`);\n    }\n\n    svg.setAttribute(\"preserveAspectRatio\", \"none\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n\n    return svg;\n  }\n\n  createElement(type) {\n    if (typeof type !== \"string\") {\n      throw new Error(\"Invalid SVG element type\");\n    }\n    return this._createSVG(type);\n  }\n\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    unreachable(\"Abstract method `_createSVG` called.\");\n  }\n}\n\nclass DOMSVGFactory extends BaseSVGFactory {\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    return document.createElementNS(SVG_NS, type);\n  }\n}\n\nexport { BaseSVGFactory, DOMSVGFactory };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/comment_manager.js\").CommentManager} CommentManager */\n\nimport {\n  AnnotationBorderStyleType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationPrefix,\n  AnnotationType,\n  FeatureTest,\n  LINE_FACTOR,\n  shadow,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  PDFDateString,\n  renderRichText,\n  setLayerDimensions,\n} from \"./display_utils.js\";\nimport { AnnotationStorage } from \"./annotation_storage.js\";\nimport { ColorConverters } from \"../shared/scripting_utils.js\";\nimport { DOMSVGFactory } from \"./svg_factory.js\";\n\nconst DEFAULT_FONT_SIZE = 9;\nconst GetElementsByNameSet = new WeakSet();\nconst TIMEZONE_OFFSET = new Date().getTimezoneOffset() * 60 * 1000;\n\n/**\n * @typedef {Object} AnnotationElementParameters\n * @property {Object} data\n * @property {HTMLDivElement} layer\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {Object} svgFactory\n * @property {boolean} [enableScripting]\n * @property {boolean} [hasJSActions]\n * @property {Object} [fieldObjects]\n */\n\nclass AnnotationElementFactory {\n  /**\n   * @param {AnnotationElementParameters} parameters\n   * @returns {AnnotationElement}\n   */\n  static create(parameters) {\n    const subtype = parameters.data.annotationType;\n\n    switch (subtype) {\n      case AnnotationType.LINK:\n        return new LinkAnnotationElement(parameters);\n\n      case AnnotationType.TEXT:\n        return new TextAnnotationElement(parameters);\n\n      case AnnotationType.WIDGET:\n        const fieldType = parameters.data.fieldType;\n\n        switch (fieldType) {\n          case \"Tx\":\n            return new TextWidgetAnnotationElement(parameters);\n          case \"Btn\":\n            if (parameters.data.radioButton) {\n              return new RadioButtonWidgetAnnotationElement(parameters);\n            } else if (parameters.data.checkBox) {\n              return new CheckboxWidgetAnnotationElement(parameters);\n            }\n            return new PushButtonWidgetAnnotationElement(parameters);\n          case \"Ch\":\n            return new ChoiceWidgetAnnotationElement(parameters);\n          case \"Sig\":\n            return new SignatureWidgetAnnotationElement(parameters);\n        }\n        return new WidgetAnnotationElement(parameters);\n\n      case AnnotationType.POPUP:\n        return new PopupAnnotationElement(parameters);\n\n      case AnnotationType.FREETEXT:\n        return new FreeTextAnnotationElement(parameters);\n\n      case AnnotationType.LINE:\n        return new LineAnnotationElement(parameters);\n\n      case AnnotationType.SQUARE:\n        return new SquareAnnotationElement(parameters);\n\n      case AnnotationType.CIRCLE:\n        return new CircleAnnotationElement(parameters);\n\n      case AnnotationType.POLYLINE:\n        return new PolylineAnnotationElement(parameters);\n\n      case AnnotationType.CARET:\n        return new CaretAnnotationElement(parameters);\n\n      case AnnotationType.INK:\n        return new InkAnnotationElement(parameters);\n\n      case AnnotationType.POLYGON:\n        return new PolygonAnnotationElement(parameters);\n\n      case AnnotationType.HIGHLIGHT:\n        return new HighlightAnnotationElement(parameters);\n\n      case AnnotationType.UNDERLINE:\n        return new UnderlineAnnotationElement(parameters);\n\n      case AnnotationType.SQUIGGLY:\n        return new SquigglyAnnotationElement(parameters);\n\n      case AnnotationType.STRIKEOUT:\n        return new StrikeOutAnnotationElement(parameters);\n\n      case AnnotationType.STAMP:\n        return new StampAnnotationElement(parameters);\n\n      case AnnotationType.FILEATTACHMENT:\n        return new FileAttachmentAnnotationElement(parameters);\n\n      default:\n        return new AnnotationElement(parameters);\n    }\n  }\n}\n\nclass AnnotationElement {\n  #updates = null;\n\n  #hasBorder = false;\n\n  #popupElement = null;\n\n  constructor(\n    parameters,\n    {\n      isRenderable = false,\n      ignoreBorder = false,\n      createQuadrilaterals = false,\n    } = {}\n  ) {\n    this.isRenderable = isRenderable;\n    this.data = parameters.data;\n    this.layer = parameters.layer;\n    this.linkService = parameters.linkService;\n    this.downloadManager = parameters.downloadManager;\n    this.imageResourcesPath = parameters.imageResourcesPath;\n    this.renderForms = parameters.renderForms;\n    this.svgFactory = parameters.svgFactory;\n    this.annotationStorage = parameters.annotationStorage;\n    this.enableComment = parameters.enableComment;\n    this.enableScripting = parameters.enableScripting;\n    this.hasJSActions = parameters.hasJSActions;\n    this._fieldObjects = parameters.fieldObjects;\n    this.parent = parameters.parent;\n    this.hasOwnCommentButton = false;\n\n    if (isRenderable) {\n      this.contentElement = this.container =\n        this._createContainer(ignoreBorder);\n    }\n    if (createQuadrilaterals) {\n      this._createQuadrilaterals();\n    }\n  }\n\n  static _hasPopupData({ contentsObj, richText }) {\n    return !!(contentsObj?.str || richText?.str);\n  }\n\n  get _isEditable() {\n    return this.data.isEditable;\n  }\n\n  get hasPopupData() {\n    return (\n      AnnotationElement._hasPopupData(this.data) ||\n      (this.enableComment && !!this.commentText)\n    );\n  }\n\n  get commentData() {\n    const { data } = this;\n    const editor = this.annotationStorage?.getEditor(data.id);\n    if (editor) {\n      return editor.getData();\n    }\n    return data;\n  }\n\n  get hasCommentButton() {\n    return this.enableComment && this.hasPopupElement;\n  }\n\n  get commentButtonPosition() {\n    const editor = this.annotationStorage?.getEditor(this.data.id);\n    if (editor) {\n      return editor.commentButtonPositionInPage;\n    }\n    const { quadPoints, inkLists, rect } = this.data;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    if (quadPoints?.length >= 8) {\n      for (let i = 0; i < quadPoints.length; i += 8) {\n        if (quadPoints[i + 1] > maxY) {\n          maxY = quadPoints[i + 1];\n          maxX = quadPoints[i + 2];\n        } else if (quadPoints[i + 1] === maxY) {\n          maxX = Math.max(maxX, quadPoints[i + 2]);\n        }\n      }\n      return [maxX, maxY];\n    }\n    if (inkLists?.length >= 1) {\n      for (const inkList of inkLists) {\n        for (let i = 0, ii = inkList.length; i < ii; i += 2) {\n          if (inkList[i + 1] > maxY) {\n            maxY = inkList[i + 1];\n            maxX = inkList[i];\n          } else if (inkList[i + 1] === maxY) {\n            maxX = Math.max(maxX, inkList[i]);\n          }\n        }\n      }\n      if (maxX !== Infinity) {\n        return [maxX, maxY];\n      }\n    }\n    if (rect) {\n      return [rect[2], rect[3]];\n    }\n    return null;\n  }\n\n  _normalizePoint(point) {\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.parent;\n    point[1] = view[3] - point[1] + view[1];\n    point[0] = (100 * (point[0] - pageX)) / pageWidth;\n    point[1] = (100 * (point[1] - pageY)) / pageHeight;\n    return point;\n  }\n\n  get commentText() {\n    const { data } = this;\n    return (\n      this.annotationStorage.getRawValue(`${AnnotationEditorPrefix}${data.id}`)\n        ?.popup?.contents ||\n      data.contentsObj?.str ||\n      \"\"\n    );\n  }\n\n  set commentText(text) {\n    const { data } = this;\n    const popup = { deleted: !text, contents: text || \"\" };\n    if (!this.annotationStorage.updateEditor(data.id, { popup })) {\n      this.annotationStorage.setValue(`${AnnotationEditorPrefix}${data.id}`, {\n        id: data.id,\n        annotationType: data.annotationType,\n        pageIndex: this.parent.page._pageIndex,\n        popup,\n        popupRef: data.popupRef,\n        modificationDate: new Date(),\n      });\n    }\n    if (!text) {\n      this.removePopup();\n    }\n  }\n\n  removePopup() {\n    (this.#popupElement?.popup || this.popup)?.remove();\n    this.#popupElement = this.popup = null;\n  }\n\n  updateEdited(params) {\n    if (!this.container) {\n      return;\n    }\n\n    if (params.rect) {\n      this.#updates ||= {\n        rect: this.data.rect.slice(0),\n      };\n    }\n\n    const { rect, popup: newPopup } = params;\n\n    if (rect) {\n      this.#setRectEdited(rect);\n    }\n\n    let popup = this.#popupElement?.popup || this.popup;\n    if (!popup && newPopup?.text) {\n      this._createPopup(newPopup);\n      popup = this.#popupElement.popup;\n    }\n    if (!popup) {\n      return;\n    }\n    popup.updateEdited(params);\n    if (newPopup?.deleted) {\n      popup.remove();\n      this.#popupElement = null;\n      this.popup = null;\n    }\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    this.#setRectEdited(this.#updates.rect);\n    this.#popupElement?.popup.resetEdited();\n    this.#updates = null;\n  }\n\n  #setRectEdited(rect) {\n    const {\n      container: { style },\n      data: { rect: currentRect, rotation },\n      parent: {\n        viewport: {\n          rawDims: { pageWidth, pageHeight, pageX, pageY },\n        },\n      },\n    } = this;\n    currentRect?.splice(0, 4, ...rect);\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (pageHeight - rect[3] + pageY)) / pageHeight}%`;\n    if (rotation === 0) {\n      style.width = `${(100 * /* width = */ (rect[2] - rect[0])) / pageWidth}%`;\n      style.height = `${(100 * /* height = */ (rect[3] - rect[1])) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation);\n    }\n  }\n\n  /**\n   * Create an empty container for the annotation's HTML element.\n   *\n   * @private\n   * @param {boolean} ignoreBorder\n   * @memberof AnnotationElement\n   * @returns {HTMLElement} A section element.\n   */\n  _createContainer(ignoreBorder) {\n    const {\n      data,\n      parent: { page, viewport },\n    } = this;\n\n    const container = document.createElement(\"section\");\n    container.setAttribute(\"data-annotation-id\", data.id);\n    if (\n      !(this instanceof WidgetAnnotationElement) &&\n      !(this instanceof LinkAnnotationElement)\n    ) {\n      container.tabIndex = 0;\n    }\n    const { style } = container;\n\n    // The accessibility manager will move the annotation in the DOM in\n    // order to match the visual ordering.\n    // But if an annotation is above an other one, then we must draw it\n    // after the other one whatever the order is in the DOM, hence the\n    // use of the z-index.\n    style.zIndex = this.parent.zIndex;\n    // Keep zIndex + 1 for stuff we want to add on top of this annotation.\n    this.parent.zIndex += 2;\n\n    if (data.alternativeText) {\n      container.title = data.alternativeText;\n    }\n\n    if (data.noRotate) {\n      container.classList.add(\"norotate\");\n    }\n\n    if (!data.rect || this instanceof PopupAnnotationElement) {\n      const { rotation } = data;\n      if (!data.hasOwnCanvas && rotation !== 0) {\n        this.setRotation(rotation, container);\n      }\n      return container;\n    }\n    const { width, height } = this;\n\n    if (!ignoreBorder && data.borderStyle.width > 0) {\n      style.borderWidth = `${data.borderStyle.width}px`;\n\n      const horizontalRadius = data.borderStyle.horizontalCornerRadius;\n      const verticalRadius = data.borderStyle.verticalCornerRadius;\n      if (horizontalRadius > 0 || verticalRadius > 0) {\n        const radius = `calc(${horizontalRadius}px * var(--total-scale-factor)) / calc(${verticalRadius}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      } else if (this instanceof RadioButtonWidgetAnnotationElement) {\n        const radius = `calc(${width}px * var(--total-scale-factor)) / calc(${height}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      }\n\n      switch (data.borderStyle.style) {\n        case AnnotationBorderStyleType.SOLID:\n          style.borderStyle = \"solid\";\n          break;\n\n        case AnnotationBorderStyleType.DASHED:\n          style.borderStyle = \"dashed\";\n          break;\n\n        case AnnotationBorderStyleType.BEVELED:\n          warn(\"Unimplemented border style: beveled\");\n          break;\n\n        case AnnotationBorderStyleType.INSET:\n          warn(\"Unimplemented border style: inset\");\n          break;\n\n        case AnnotationBorderStyleType.UNDERLINE:\n          style.borderBottomStyle = \"solid\";\n          break;\n\n        default:\n          break;\n      }\n\n      const borderColor = data.borderColor || null;\n      if (borderColor) {\n        this.#hasBorder = true;\n        style.borderColor = Util.makeHexColor(\n          borderColor[0] | 0,\n          borderColor[1] | 0,\n          borderColor[2] | 0\n        );\n      } else {\n        // Transparent (invisible) border, so do not draw it at all.\n        style.borderWidth = 0;\n      }\n    }\n\n    // Do *not* modify `data.rect`, since that will corrupt the annotation\n    // position on subsequent calls to `_createContainer` (see issue 6804).\n    const rect = Util.normalizeRect([\n      data.rect[0],\n      page.view[3] - data.rect[1] + page.view[1],\n      data.rect[2],\n      page.view[3] - data.rect[3] + page.view[1],\n    ]);\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (rect[1] - pageY)) / pageHeight}%`;\n\n    const { rotation } = data;\n    if (data.hasOwnCanvas || rotation === 0) {\n      style.width = `${(100 * width) / pageWidth}%`;\n      style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation, container);\n    }\n\n    return container;\n  }\n\n  setRotation(angle, container = this.container) {\n    if (!this.data.rect) {\n      return;\n    }\n    const { pageWidth, pageHeight } = this.parent.viewport.rawDims;\n    let { width, height } = this;\n\n    if (angle % 180 !== 0) {\n      [width, height] = [height, width];\n    }\n    container.style.width = `${(100 * width) / pageWidth}%`;\n    container.style.height = `${(100 * height) / pageHeight}%`;\n\n    container.setAttribute(\"data-main-rotation\", (360 - angle) % 360);\n  }\n\n  get _commonActions() {\n    const setColor = (jsName, styleName, event) => {\n      const color = event.detail[jsName];\n      const colorType = color[0];\n      const colorArray = color.slice(1);\n      event.target.style[styleName] =\n        ColorConverters[`${colorType}_HTML`](colorArray);\n      this.annotationStorage.setValue(this.data.id, {\n        [styleName]: ColorConverters[`${colorType}_rgb`](colorArray),\n      });\n    };\n\n    return shadow(this, \"_commonActions\", {\n      display: event => {\n        const { display } = event.detail;\n        // See scripting/constants.js for the values of `Display`.\n        // 0 = visible, 1 = hidden, 2 = noPrint and 3 = noView.\n        const hidden = display % 2 === 1;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noView: hidden,\n          noPrint: display === 1 || display === 2,\n        });\n      },\n      print: event => {\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: !event.detail.print,\n        });\n      },\n      hidden: event => {\n        const { hidden } = event.detail;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: hidden,\n          noView: hidden,\n        });\n      },\n      focus: event => {\n        setTimeout(() => event.target.focus({ preventScroll: false }), 0);\n      },\n      userName: event => {\n        // tooltip\n        event.target.title = event.detail.userName;\n      },\n      readonly: event => {\n        event.target.disabled = event.detail.readonly;\n      },\n      required: event => {\n        this._setRequired(event.target, event.detail.required);\n      },\n      bgColor: event => {\n        setColor(\"bgColor\", \"backgroundColor\", event);\n      },\n      fillColor: event => {\n        setColor(\"fillColor\", \"backgroundColor\", event);\n      },\n      fgColor: event => {\n        setColor(\"fgColor\", \"color\", event);\n      },\n      textColor: event => {\n        setColor(\"textColor\", \"color\", event);\n      },\n      borderColor: event => {\n        setColor(\"borderColor\", \"borderColor\", event);\n      },\n      strokeColor: event => {\n        setColor(\"strokeColor\", \"borderColor\", event);\n      },\n      rotation: event => {\n        const angle = event.detail.rotation;\n        this.setRotation(angle);\n        this.annotationStorage.setValue(this.data.id, {\n          rotation: angle,\n        });\n      },\n    });\n  }\n\n  _dispatchEventFromSandbox(actions, jsEvent) {\n    const commonActions = this._commonActions;\n    for (const name of Object.keys(jsEvent.detail)) {\n      const action = actions[name] || commonActions[name];\n      action?.(jsEvent);\n    }\n  }\n\n  _setDefaultPropertiesFromJS(element) {\n    if (!this.enableScripting) {\n      return;\n    }\n\n    // Some properties may have been updated thanks to JS.\n    const storedData = this.annotationStorage.getRawValue(this.data.id);\n    if (!storedData) {\n      return;\n    }\n\n    const commonActions = this._commonActions;\n    for (const [actionName, detail] of Object.entries(storedData)) {\n      const action = commonActions[actionName];\n      if (action) {\n        const eventProxy = {\n          detail: {\n            [actionName]: detail,\n          },\n          target: element,\n        };\n        action(eventProxy);\n        // The action has been consumed: no need to keep it.\n        delete storedData[actionName];\n      }\n    }\n  }\n\n  /**\n   * Create quadrilaterals from the annotation's quadpoints.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createQuadrilaterals() {\n    if (!this.container) {\n      return;\n    }\n    const { quadPoints } = this.data;\n    if (!quadPoints) {\n      return;\n    }\n\n    const [rectBlX, rectBlY, rectTrX, rectTrY] = this.data.rect.map(x =>\n      Math.fround(x)\n    );\n\n    if (quadPoints.length === 8) {\n      const [trX, trY, blX, blY] = quadPoints.subarray(2, 6);\n      if (\n        rectTrX === trX &&\n        rectTrY === trY &&\n        rectBlX === blX &&\n        rectBlY === blY\n      ) {\n        // The quadpoints cover the whole annotation rectangle, so no need to\n        // create a quadrilateral.\n        return;\n      }\n    }\n\n    const { style } = this.container;\n    let svgBuffer;\n    if (this.#hasBorder) {\n      const { borderColor, borderWidth } = style;\n      style.borderWidth = 0;\n      svgBuffer = [\n        \"url('data:image/svg+xml;utf8,\",\n        `<svg xmlns=\"http://www.w3.org/2000/svg\"`,\n        ` preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">`,\n        `<g fill=\"transparent\" stroke=\"${borderColor}\" stroke-width=\"${borderWidth}\">`,\n      ];\n      this.container.classList.add(\"hasBorder\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.container.classList.add(\"hasClipPath\");\n    }\n\n    const width = rectTrX - rectBlX;\n    const height = rectTrY - rectBlY;\n\n    const { svgFactory } = this;\n    const svg = svgFactory.createElement(\"svg\");\n    svg.classList.add(\"quadrilateralsContainer\");\n    svg.setAttribute(\"width\", 0);\n    svg.setAttribute(\"height\", 0);\n    svg.role = \"none\";\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const clipPath = svgFactory.createElement(\"clipPath\");\n    const id = `clippath_${this.data.id}`;\n    clipPath.setAttribute(\"id\", id);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    defs.append(clipPath);\n\n    for (let i = 2, ii = quadPoints.length; i < ii; i += 8) {\n      const trX = quadPoints[i];\n      const trY = quadPoints[i + 1];\n      const blX = quadPoints[i + 2];\n      const blY = quadPoints[i + 3];\n      const rect = svgFactory.createElement(\"rect\");\n      const x = (blX - rectBlX) / width;\n      const y = (rectTrY - trY) / height;\n      const rectWidth = (trX - blX) / width;\n      const rectHeight = (trY - blY) / height;\n      rect.setAttribute(\"x\", x);\n      rect.setAttribute(\"y\", y);\n      rect.setAttribute(\"width\", rectWidth);\n      rect.setAttribute(\"height\", rectHeight);\n      clipPath.append(rect);\n      svgBuffer?.push(\n        `<rect vector-effect=\"non-scaling-stroke\" x=\"${x}\" y=\"${y}\" width=\"${rectWidth}\" height=\"${rectHeight}\"/>`\n      );\n    }\n\n    if (this.#hasBorder) {\n      svgBuffer.push(`</g></svg>')`);\n      style.backgroundImage = svgBuffer.join(\"\");\n    }\n\n    this.container.append(svg);\n    this.container.style.clipPath = `url(#${id})`;\n  }\n\n  /**\n   * Create a popup for the annotation's HTML element. This is used for\n   * annotations that do not have a Popup entry in the dictionary, but\n   * are of a type that works with popups (such as Highlight annotations).\n   *\n   * @param {Object} [popupData] - The data for the popup, if any.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createPopup(popupData = null) {\n    const { data } = this;\n\n    let contentsObj, modificationDate;\n    if (popupData) {\n      contentsObj = {\n        str: popupData.text,\n      };\n      modificationDate = popupData.date;\n    } else {\n      contentsObj = data.contentsObj;\n      modificationDate = data.modificationDate;\n    }\n    this.#popupElement = new PopupAnnotationElement({\n      data: {\n        color: data.color,\n        titleObj: data.titleObj,\n        modificationDate,\n        contentsObj,\n        richText: data.richText,\n        parentRect: data.rect,\n        borderStyle: 0,\n        id: `popup_${data.id}`,\n        rotation: data.rotation,\n        noRotate: true,\n      },\n      linkService: this.linkService,\n      parent: this.parent,\n      elements: [this],\n    });\n  }\n\n  get hasPopupElement() {\n    return !!(this.#popupElement || this.popup || this.data.popupRef);\n  }\n\n  get extraPopupElement() {\n    return this.#popupElement;\n  }\n\n  /**\n   * Render the annotation's HTML element(s).\n   *\n   * @public\n   * @memberof AnnotationElement\n   */\n  render() {\n    unreachable(\"Abstract method `AnnotationElement.render` called\");\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  _getElementsByName(name, skipId = null) {\n    const fields = [];\n\n    if (this._fieldObjects) {\n      const fieldObj = this._fieldObjects[name];\n      if (fieldObj) {\n        for (const { page, id, exportValues } of fieldObj) {\n          if (page === -1) {\n            continue;\n          }\n          if (id === skipId) {\n            continue;\n          }\n          const exportValue =\n            typeof exportValues === \"string\" ? exportValues : null;\n\n          const domElement = document.querySelector(\n            `[data-element-id=\"${id}\"]`\n          );\n          if (domElement && !GetElementsByNameSet.has(domElement)) {\n            warn(`_getElementsByName - element not allowed: ${id}`);\n            continue;\n          }\n          fields.push({ id, exportValue, domElement });\n        }\n      }\n      return fields;\n    }\n    // Fallback to a regular DOM lookup, to ensure that the standalone\n    // viewer components won't break.\n    for (const domElement of document.getElementsByName(name)) {\n      const { exportValue } = domElement;\n      const id = domElement.getAttribute(\"data-element-id\");\n      if (id === skipId) {\n        continue;\n      }\n      if (!GetElementsByNameSet.has(domElement)) {\n        continue;\n      }\n      fields.push({ id, exportValue, domElement });\n    }\n    return fields;\n  }\n\n  show() {\n    if (this.container) {\n      this.container.hidden = false;\n    }\n    this.popup?.maybeShow();\n  }\n\n  hide() {\n    if (this.container) {\n      this.container.hidden = true;\n    }\n    this.popup?.forceHide();\n  }\n\n  /**\n   * Get the HTML element(s) which can trigger a popup when clicked or hovered.\n   *\n   * @public\n   * @memberof AnnotationElement\n   * @returns {Array<HTMLElement>|HTMLElement} An array of elements or an\n   *          element.\n   */\n  getElementsToTriggerPopup() {\n    return this.container;\n  }\n\n  addHighlightArea() {\n    const triggers = this.getElementsToTriggerPopup();\n    if (Array.isArray(triggers)) {\n      for (const element of triggers) {\n        element.classList.add(\"highlightArea\");\n      }\n    } else {\n      triggers.classList.add(\"highlightArea\");\n    }\n  }\n\n  _editOnDoubleClick() {\n    if (!this._isEditable) {\n      return;\n    }\n    const {\n      annotationEditorType: mode,\n      data: { id: editId },\n    } = this;\n    this.container.addEventListener(\"dblclick\", () => {\n      this.linkService.eventBus?.dispatch(\"switchannotationeditormode\", {\n        source: this,\n        mode,\n        editId,\n        mustEnterInEditMode: true,\n      });\n    });\n  }\n\n  get width() {\n    return this.data.rect[2] - this.data.rect[0];\n  }\n\n  get height() {\n    return this.data.rect[3] - this.data.rect[1];\n  }\n}\n\nclass EditorAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.editor = parameters.editor;\n  }\n\n  render() {\n    this.container.className = \"editorAnnotation\";\n    return this.container;\n  }\n\n  createOrUpdatePopup() {\n    const { editor } = this;\n    if (!editor.hasComment) {\n      return;\n    }\n    this._createPopup(editor.comment);\n  }\n\n  get hasCommentButton() {\n    return this.enableComment && this.editor.hasComment;\n  }\n\n  get commentButtonPosition() {\n    return this.editor.commentButtonPositionInPage;\n  }\n\n  get commentText() {\n    return this.editor.comment.text;\n  }\n\n  set commentText(text) {\n    this.editor.comment = text;\n    if (!text) {\n      this.removePopup();\n    }\n  }\n\n  get commentData() {\n    return this.editor.getData();\n  }\n\n  remove() {\n    this.parent.removeAnnotation(this.data.id);\n    this.container.remove();\n    this.container = null;\n    this.removePopup();\n  }\n}\n\nclass LinkAnnotationElement extends AnnotationElement {\n  constructor(parameters, options = null) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: !!options?.ignoreBorder,\n      createQuadrilaterals: true,\n    });\n    this.isTooltipOnly = parameters.data.isTooltipOnly;\n  }\n\n  render() {\n    const { data, linkService } = this;\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"data-element-id\", data.id);\n    let isBound = false;\n\n    if (data.url) {\n      linkService.addLinkAttributes(link, data.url, data.newWindow);\n      isBound = true;\n    } else if (data.action) {\n      this._bindNamedAction(link, data.action, data.overlaidText);\n      isBound = true;\n    } else if (data.attachment) {\n      this.#bindAttachment(\n        link,\n        data.attachment,\n        data.overlaidText,\n        data.attachmentDest\n      );\n      isBound = true;\n    } else if (data.setOCGState) {\n      this.#bindSetOCGState(link, data.setOCGState, data.overlaidText);\n      isBound = true;\n    } else if (data.dest) {\n      this._bindLink(link, data.dest, data.overlaidText);\n      isBound = true;\n    } else {\n      if (\n        data.actions &&\n        (data.actions.Action ||\n          data.actions[\"Mouse Up\"] ||\n          data.actions[\"Mouse Down\"]) &&\n        this.enableScripting &&\n        this.hasJSActions\n      ) {\n        this._bindJSAction(link, data);\n        isBound = true;\n      }\n\n      if (data.resetForm) {\n        this._bindResetFormAction(link, data.resetForm);\n        isBound = true;\n      } else if (this.isTooltipOnly && !isBound) {\n        this._bindLink(link, \"\");\n        isBound = true;\n      }\n    }\n\n    this.container.classList.add(\"linkAnnotation\");\n    if (isBound) {\n      this.contentElement = link;\n      this.container.append(link);\n    }\n\n    return this.container;\n  }\n\n  #setInternalLink() {\n    this.container.setAttribute(\"data-internal-link\", \"\");\n  }\n\n  /**\n   * Bind internal links to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} destination\n   * @param {string} [overlaidText]\n   * @memberof LinkAnnotationElement\n   */\n  _bindLink(link, destination, overlaidText = \"\") {\n    link.href = this.linkService.getDestinationHash(destination);\n    link.onclick = () => {\n      if (destination) {\n        this.linkService.goToDestination(destination);\n      }\n      return false;\n    };\n    if (destination || destination === /* isTooltipOnly = */ \"\") {\n      this.#setInternalLink();\n    }\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n  }\n\n  /**\n   * Bind named actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} action\n   * @param {string} [overlaidText]\n   * @memberof LinkAnnotationElement\n   */\n  _bindNamedAction(link, action, overlaidText = \"\") {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeNamedAction(action);\n      return false;\n    };\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind attachments to the link element.\n   * @param {Object} link\n   * @param {Object} attachment\n   * @param {string} [overlaidText]\n   * @param {string} [dest]\n   */\n  #bindAttachment(link, attachment, overlaidText = \"\", dest = null) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    if (attachment.description) {\n      link.title = attachment.description;\n    } else if (overlaidText) {\n      link.title = overlaidText;\n    }\n    link.onclick = () => {\n      this.downloadManager?.openOrDownloadData(\n        attachment.content,\n        attachment.filename,\n        dest\n      );\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind SetOCGState actions to the link element.\n   * @param {Object} link\n   * @param {Object} action\n   * @param {string} [overlaidText]\n   */\n  #bindSetOCGState(link, action, overlaidText = \"\") {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeSetOCGState(action);\n      return false;\n    };\n    if (overlaidText) {\n      link.title = overlaidText;\n    }\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind JS actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} data\n   * @memberof LinkAnnotationElement\n   */\n  _bindJSAction(link, data) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    const map = new Map([\n      [\"Action\", \"onclick\"],\n      [\"Mouse Up\", \"onmouseup\"],\n      [\"Mouse Down\", \"onmousedown\"],\n    ]);\n    for (const name of Object.keys(data.actions)) {\n      const jsName = map.get(name);\n      if (!jsName) {\n        continue;\n      }\n      link[jsName] = () => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: data.id,\n            name,\n          },\n        });\n        return false;\n      };\n    }\n    if (data.overlaidText) {\n      link.title = data.overlaidText;\n    }\n\n    if (!link.onclick) {\n      link.onclick = () => false;\n    }\n    this.#setInternalLink();\n  }\n\n  _bindResetFormAction(link, resetForm) {\n    const otherClickAction = link.onclick;\n    if (!otherClickAction) {\n      link.href = this.linkService.getAnchorUrl(\"\");\n    }\n    this.#setInternalLink();\n\n    if (!this._fieldObjects) {\n      warn(\n        `_bindResetFormAction - \"resetForm\" action not supported, ` +\n          \"ensure that the `fieldObjects` parameter is provided.\"\n      );\n      if (!otherClickAction) {\n        link.onclick = () => false;\n      }\n      return;\n    }\n\n    link.onclick = () => {\n      otherClickAction?.();\n\n      const {\n        fields: resetFormFields,\n        refs: resetFormRefs,\n        include,\n      } = resetForm;\n\n      const allFields = [];\n      if (resetFormFields.length !== 0 || resetFormRefs.length !== 0) {\n        const fieldIds = new Set(resetFormRefs);\n        for (const fieldName of resetFormFields) {\n          const fields = this._fieldObjects[fieldName] || [];\n          for (const { id } of fields) {\n            fieldIds.add(id);\n          }\n        }\n        for (const fields of Object.values(this._fieldObjects)) {\n          for (const field of fields) {\n            if (fieldIds.has(field.id) === include) {\n              allFields.push(field);\n            }\n          }\n        }\n      } else {\n        for (const fields of Object.values(this._fieldObjects)) {\n          allFields.push(...fields);\n        }\n      }\n\n      const storage = this.annotationStorage;\n      const allIds = [];\n      for (const field of allFields) {\n        const { id } = field;\n        allIds.push(id);\n        switch (field.type) {\n          case \"text\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"checkbox\":\n          case \"radiobutton\": {\n            const value = field.defaultValue === field.exportValues;\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"combobox\":\n          case \"listbox\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          default:\n            continue;\n        }\n\n        const domElement = document.querySelector(`[data-element-id=\"${id}\"]`);\n        if (!domElement) {\n          continue;\n        } else if (!GetElementsByNameSet.has(domElement)) {\n          warn(`_bindResetFormAction - element not allowed: ${id}`);\n          continue;\n        }\n        domElement.dispatchEvent(new Event(\"resetform\"));\n      }\n\n      if (this.enableScripting) {\n        // Update the values in the sandbox.\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: \"app\",\n            ids: allIds,\n            name: \"ResetForm\",\n          },\n        });\n      }\n\n      return false;\n    };\n  }\n}\n\nclass TextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n  }\n\n  render() {\n    this.container.classList.add(\"textAnnotation\");\n\n    const image = document.createElement(\"img\");\n    image.src =\n      this.imageResourcesPath +\n      \"annotation-\" +\n      this.data.name.toLowerCase() +\n      \".svg\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-text-annotation-type\");\n    image.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ type: this.data.name })\n    );\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.append(image);\n    return this.container;\n  }\n}\n\nclass WidgetAnnotationElement extends AnnotationElement {\n  render() {\n    // Show only the container for unsupported field types.\n    return this.container;\n  }\n\n  showElementAndHideCanvas(element) {\n    if (this.data.hasOwnCanvas) {\n      if (element.previousSibling?.nodeName === \"CANVAS\") {\n        element.previousSibling.hidden = true;\n      }\n      element.hidden = false;\n    }\n  }\n\n  _getKeyModifier(event) {\n    return FeatureTest.platform.isMac ? event.metaKey : event.ctrlKey;\n  }\n\n  _setEventListener(element, elementData, baseName, eventName, valueGetter) {\n    if (baseName.includes(\"mouse\")) {\n      // Mouse events\n      element.addEventListener(baseName, event => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n            shift: event.shiftKey,\n            modifier: this._getKeyModifier(event),\n          },\n        });\n      });\n    } else {\n      // Non-mouse events\n      element.addEventListener(baseName, event => {\n        if (baseName === \"blur\") {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          elementData.focused = false;\n        } else if (baseName === \"focus\") {\n          if (elementData.focused) {\n            return;\n          }\n          elementData.focused = true;\n        }\n\n        if (!valueGetter) {\n          return;\n        }\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n          },\n        });\n      });\n    }\n  }\n\n  _setEventListeners(element, elementData, names, getter) {\n    for (const [baseName, eventName] of names) {\n      if (eventName === \"Action\" || this.data.actions?.[eventName]) {\n        if (eventName === \"Focus\" || eventName === \"Blur\") {\n          elementData ||= { focused: false };\n        }\n        this._setEventListener(\n          element,\n          elementData,\n          baseName,\n          eventName,\n          getter\n        );\n        if (eventName === \"Focus\" && !this.data.actions?.Blur) {\n          // Ensure that elementData will have the correct value.\n          this._setEventListener(element, elementData, \"blur\", \"Blur\", null);\n        } else if (eventName === \"Blur\" && !this.data.actions?.Focus) {\n          this._setEventListener(element, elementData, \"focus\", \"Focus\", null);\n        }\n      }\n    }\n  }\n\n  _setBackgroundColor(element) {\n    const color = this.data.backgroundColor || null;\n    element.style.backgroundColor =\n      color === null\n        ? \"transparent\"\n        : Util.makeHexColor(color[0], color[1], color[2]);\n  }\n\n  /**\n   * Apply text styles to the text in the element.\n   *\n   * @private\n   * @param {HTMLDivElement} element\n   * @memberof TextWidgetAnnotationElement\n   */\n  _setTextStyle(element) {\n    const TEXT_ALIGNMENT = [\"left\", \"center\", \"right\"];\n    const { fontColor } = this.data.defaultAppearanceData;\n    const fontSize =\n      this.data.defaultAppearanceData.fontSize || DEFAULT_FONT_SIZE;\n\n    const style = element.style;\n\n    // TODO: If the font-size is zero, calculate it based on the height and\n    //       width of the element.\n    // Not setting `style.fontSize` will use the default font-size for now.\n\n    // We don't use the font, as specified in the PDF document, for the <input>\n    // element. Hence using the original `fontSize` could look bad, which is why\n    // it's instead based on the field height.\n    // If the height is \"big\" then it could lead to a too big font size\n    // so in this case use the one we've in the pdf (hence the min).\n    let computedFontSize;\n    const BORDER_SIZE = 2;\n    const roundToOneDecimal = x => Math.round(10 * x) / 10;\n    if (this.data.multiLine) {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      const numberOfLines = Math.round(height / (LINE_FACTOR * fontSize)) || 1;\n      const lineHeight = height / numberOfLines;\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(lineHeight / LINE_FACTOR)\n      );\n    } else {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(height / LINE_FACTOR)\n      );\n    }\n    style.fontSize = `calc(${computedFontSize}px * var(--total-scale-factor))`;\n\n    style.color = Util.makeHexColor(fontColor[0], fontColor[1], fontColor[2]);\n\n    if (this.data.textAlignment !== null) {\n      style.textAlign = TEXT_ALIGNMENT[this.data.textAlignment];\n    }\n  }\n\n  _setRequired(element, isRequired) {\n    if (isRequired) {\n      element.setAttribute(\"required\", true);\n    } else {\n      element.removeAttribute(\"required\");\n    }\n    element.setAttribute(\"aria-required\", isRequired);\n  }\n}\n\nclass TextWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    const isRenderable =\n      parameters.renderForms ||\n      parameters.data.hasOwnCanvas ||\n      (!parameters.data.hasAppearance && !!parameters.data.fieldValue);\n    super(parameters, { isRenderable });\n  }\n\n  setPropertyOnSiblings(base, key, value, keyInStorage) {\n    const storage = this.annotationStorage;\n    for (const element of this._getElementsByName(\n      base.name,\n      /* skipId = */ base.id\n    )) {\n      if (element.domElement) {\n        element.domElement[key] = value;\n      }\n      storage.setValue(element.id, { [keyInStorage]: value });\n    }\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    this.container.classList.add(\"textWidgetAnnotation\");\n\n    let element = null;\n    if (this.renderForms) {\n      // NOTE: We cannot set the values using `element.value` below, since it\n      //       prevents the AnnotationLayer rasterizer in `test/driver.js`\n      //       from parsing the elements correctly for the reference tests.\n      const storedData = storage.getValue(id, {\n        value: this.data.fieldValue,\n      });\n      let textContent = storedData.value || \"\";\n      const maxLen = storage.getValue(id, {\n        charLimit: this.data.maxLen,\n      }).charLimit;\n      if (maxLen && textContent.length > maxLen) {\n        textContent = textContent.slice(0, maxLen);\n      }\n\n      let fieldFormattedValues =\n        storedData.formattedValue || this.data.textContent?.join(\"\\n\") || null;\n      if (fieldFormattedValues && this.data.comb) {\n        fieldFormattedValues = fieldFormattedValues.replaceAll(/\\s+/g, \"\");\n      }\n\n      const elementData = {\n        userValue: textContent,\n        formattedValue: fieldFormattedValues,\n        lastCommittedValue: null,\n        commitKey: 1,\n        focused: false,\n      };\n\n      if (this.data.multiLine) {\n        element = document.createElement(\"textarea\");\n        element.textContent = fieldFormattedValues ?? textContent;\n        if (this.data.doNotScroll) {\n          element.style.overflowY = \"hidden\";\n        }\n      } else {\n        element = document.createElement(\"input\");\n        element.type = this.data.password ? \"password\" : \"text\";\n        element.setAttribute(\"value\", fieldFormattedValues ?? textContent);\n        if (this.data.doNotScroll) {\n          element.style.overflowX = \"hidden\";\n        }\n      }\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n      GetElementsByNameSet.add(element);\n      this.contentElement = element;\n      element.setAttribute(\"data-element-id\", id);\n\n      element.disabled = this.data.readOnly;\n      element.name = this.data.fieldName;\n      element.tabIndex = 0;\n      const { datetimeFormat, datetimeType, timeStep } = this.data;\n      const hasDateOrTime = !!datetimeType && this.enableScripting;\n      if (datetimeFormat) {\n        element.title = datetimeFormat;\n      }\n\n      this._setRequired(element, this.data.required);\n\n      if (maxLen) {\n        element.maxLength = maxLen;\n      }\n\n      element.addEventListener(\"input\", event => {\n        storage.setValue(id, { value: event.target.value });\n        this.setPropertyOnSiblings(\n          element,\n          \"value\",\n          event.target.value,\n          \"value\"\n        );\n        elementData.formattedValue = null;\n      });\n\n      element.addEventListener(\"resetform\", event => {\n        const defaultValue = this.data.defaultFieldValue ?? \"\";\n        element.value = elementData.userValue = defaultValue;\n        elementData.formattedValue = null;\n      });\n\n      let blurListener = event => {\n        const { formattedValue } = elementData;\n        if (formattedValue !== null && formattedValue !== undefined) {\n          event.target.value = formattedValue;\n        }\n        // Reset the cursor position to the start of the field (issue 12359).\n        event.target.scrollLeft = 0;\n      };\n\n      if (this.enableScripting && this.hasJSActions) {\n        element.addEventListener(\"focus\", event => {\n          if (elementData.focused) {\n            return;\n          }\n          const { target } = event;\n          if (hasDateOrTime) {\n            target.type = datetimeType;\n            if (timeStep) {\n              target.step = timeStep;\n            }\n          }\n\n          if (elementData.userValue) {\n            const value = elementData.userValue;\n            if (hasDateOrTime) {\n              if (datetimeType === \"time\") {\n                const date = new Date(value);\n                const parts = [\n                  date.getHours(),\n                  date.getMinutes(),\n                  date.getSeconds(),\n                ];\n                target.value = parts\n                  .map(v => v.toString().padStart(2, \"0\"))\n                  .join(\":\");\n              } else {\n                target.value = new Date(value - TIMEZONE_OFFSET)\n                  .toISOString()\n                  .split(datetimeType === \"date\" ? \"T\" : \".\", 1)[0];\n              }\n            } else {\n              target.value = value;\n            }\n          }\n          elementData.lastCommittedValue = target.value;\n          elementData.commitKey = 1;\n          if (!this.data.actions?.Focus) {\n            elementData.focused = true;\n          }\n        });\n\n        element.addEventListener(\"updatefromsandbox\", jsEvent => {\n          this.showElementAndHideCanvas(jsEvent.target);\n          const actions = {\n            value(event) {\n              elementData.userValue = event.detail.value ?? \"\";\n              if (!hasDateOrTime) {\n                storage.setValue(id, {\n                  value: elementData.userValue.toString(),\n                });\n              }\n              event.target.value = elementData.userValue;\n            },\n            formattedValue(event) {\n              const { formattedValue } = event.detail;\n              elementData.formattedValue = formattedValue;\n              if (\n                formattedValue !== null &&\n                formattedValue !== undefined &&\n                event.target !== document.activeElement\n              ) {\n                // Input hasn't the focus so display formatted string\n                event.target.value = formattedValue;\n              }\n              const data = {\n                formattedValue,\n              };\n              if (hasDateOrTime) {\n                // If the field is a date or time, we store the formatted value\n                // in the `value` property, so that it can be used by the\n                // `Keystroke` action.\n                data.value = formattedValue;\n              }\n              storage.setValue(id, data);\n            },\n            selRange(event) {\n              event.target.setSelectionRange(...event.detail.selRange);\n            },\n            charLimit: event => {\n              const { charLimit } = event.detail;\n              const { target } = event;\n              if (charLimit === 0) {\n                target.removeAttribute(\"maxLength\");\n                return;\n              }\n\n              target.setAttribute(\"maxLength\", charLimit);\n              let value = elementData.userValue;\n              if (!value || value.length <= charLimit) {\n                return;\n              }\n              value = value.slice(0, charLimit);\n              target.value = elementData.userValue = value;\n              storage.setValue(id, { value });\n\n              this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n                source: this,\n                detail: {\n                  id,\n                  name: \"Keystroke\",\n                  value,\n                  willCommit: true,\n                  commitKey: 1,\n                  selStart: target.selectionStart,\n                  selEnd: target.selectionEnd,\n                },\n              });\n            },\n          };\n          this._dispatchEventFromSandbox(actions, jsEvent);\n        });\n\n        // Even if the field hasn't any actions\n        // leaving it can still trigger some actions with Calculate\n        element.addEventListener(\"keydown\", event => {\n          elementData.commitKey = 1;\n          // If the key is one of Escape, Enter then the data are committed.\n          // If we've a Tab then data will be committed on blur.\n          let commitKey = -1;\n          if (event.key === \"Escape\") {\n            commitKey = 0;\n          } else if (event.key === \"Enter\" && !this.data.multiLine) {\n            // When we've a multiline field, \"Enter\" key is a key as the other\n            // hence we don't commit the data (Acrobat behaves the same way)\n            // (see issue #15627).\n            commitKey = 2;\n          } else if (event.key === \"Tab\") {\n            elementData.commitKey = 3;\n          }\n          if (commitKey === -1) {\n            return;\n          }\n          const { value } = event.target;\n          if (elementData.lastCommittedValue === value) {\n            return;\n          }\n          elementData.lastCommittedValue = value;\n          // Save the entered value\n          elementData.userValue = value;\n          this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n            source: this,\n            detail: {\n              id,\n              name: \"Keystroke\",\n              value,\n              willCommit: true,\n              commitKey,\n              selStart: event.target.selectionStart,\n              selEnd: event.target.selectionEnd,\n            },\n          });\n        });\n        const _blurListener = blurListener;\n        blurListener = null;\n        element.addEventListener(\"blur\", event => {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          if (!this.data.actions?.Blur) {\n            elementData.focused = false;\n          }\n          const { target } = event;\n          let { value } = target;\n          if (hasDateOrTime) {\n            if (value && datetimeType === \"time\") {\n              const parts = value.split(\":\").map(v => parseInt(v, 10));\n              value = new Date(\n                2000,\n                0,\n                1,\n                parts[0],\n                parts[1],\n                parts[2] || 0\n              ).valueOf();\n              target.step = \"\";\n            } else {\n              // Unfortunately, when the date is \"2025-09-23\", the parser\n              // converts it to UTC time which may lead to the date being off by\n              // one day depending on the timezone. To workaround this, we\n              // append \"T00:00\" to the date so that it's parsed as local\n              // time (bug 1989874).\n              if (!value.includes(\"T\")) {\n                value = `${value}T00:00`;\n              }\n              value = new Date(value).valueOf();\n            }\n            target.type = \"text\";\n          }\n          elementData.userValue = value;\n          if (elementData.lastCommittedValue !== value) {\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                willCommit: true,\n                commitKey: elementData.commitKey,\n                selStart: event.target.selectionStart,\n                selEnd: event.target.selectionEnd,\n              },\n            });\n          }\n          _blurListener(event);\n        });\n\n        if (this.data.actions?.Keystroke) {\n          element.addEventListener(\"beforeinput\", event => {\n            elementData.lastCommittedValue = null;\n            const { data, target } = event;\n            const { value, selectionStart, selectionEnd } = target;\n\n            let selStart = selectionStart,\n              selEnd = selectionEnd;\n\n            switch (event.inputType) {\n              // https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n              case \"deleteWordBackward\": {\n                const match = value\n                  .substring(0, selectionStart)\n                  .match(/\\w*[^\\w]*$/);\n                if (match) {\n                  selStart -= match[0].length;\n                }\n                break;\n              }\n              case \"deleteWordForward\": {\n                const match = value\n                  .substring(selectionStart)\n                  .match(/^[^\\w]*\\w*/);\n                if (match) {\n                  selEnd += match[0].length;\n                }\n                break;\n              }\n              case \"deleteContentBackward\":\n                if (selectionStart === selectionEnd) {\n                  selStart -= 1;\n                }\n                break;\n              case \"deleteContentForward\":\n                if (selectionStart === selectionEnd) {\n                  selEnd += 1;\n                }\n                break;\n            }\n\n            // We handle the event ourselves.\n            event.preventDefault();\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                change: data || \"\",\n                willCommit: false,\n                selStart,\n                selEnd,\n              },\n            });\n          });\n        }\n\n        this._setEventListeners(\n          element,\n          elementData,\n          [\n            [\"focus\", \"Focus\"],\n            [\"blur\", \"Blur\"],\n            [\"mousedown\", \"Mouse Down\"],\n            [\"mouseenter\", \"Mouse Enter\"],\n            [\"mouseleave\", \"Mouse Exit\"],\n            [\"mouseup\", \"Mouse Up\"],\n          ],\n          event => event.target.value\n        );\n      }\n\n      if (blurListener) {\n        element.addEventListener(\"blur\", blurListener);\n      }\n\n      if (this.data.comb) {\n        const fieldWidth = this.data.rect[2] - this.data.rect[0];\n        const combWidth = fieldWidth / maxLen;\n\n        element.classList.add(\"comb\");\n        element.style.letterSpacing = `calc(${combWidth}px * var(--total-scale-factor) - 1ch)`;\n      }\n    } else {\n      element = document.createElement(\"div\");\n      element.textContent = this.data.fieldValue;\n      element.style.verticalAlign = \"middle\";\n      element.style.display = \"table-cell\";\n\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n    }\n\n    this._setTextStyle(element);\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass SignatureWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: !!parameters.data.hasOwnCanvas });\n  }\n}\n\nclass CheckboxWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.exportValue === data.fieldValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== \"Off\";\n      storage.setValue(id, { value });\n    }\n\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"checkBox\");\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"checkbox\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.setAttribute(\"exportValue\", data.exportValue);\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const checkbox of this._getElementsByName(name, /* skipId = */ id)) {\n        const curChecked = checked && checkbox.exportValue === data.exportValue;\n        if (checkbox.domElement) {\n          checkbox.domElement.checked = curChecked;\n        }\n        storage.setValue(checkbox.id, { value: curChecked });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue || \"Off\";\n      event.target.checked = defaultValue === data.exportValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            event.target.checked = event.detail.value !== \"Off\";\n            storage.setValue(id, { value: event.target.checked });\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"radioButton\");\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.fieldValue === data.buttonValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== data.buttonValue;\n      storage.setValue(id, { value });\n    }\n\n    if (value) {\n      // It's possible that multiple radio buttons are checked.\n      // So if this one is checked we just reset the other ones.\n      // (see bug 1864136). Then when the other ones will be rendered they will\n      // unchecked (because of their value in the storage).\n      // Consequently, the first checked radio button will be the only checked\n      // one.\n      for (const radio of this._getElementsByName(\n        data.fieldName,\n        /* skipId = */ id\n      )) {\n        storage.setValue(radio.id, { value: false });\n      }\n    }\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"radio\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const radio of this._getElementsByName(name, /* skipId = */ id)) {\n        storage.setValue(radio.id, { value: false });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue;\n      event.target.checked =\n        defaultValue !== null &&\n        defaultValue !== undefined &&\n        defaultValue === data.buttonValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      const pdfButtonValue = data.buttonValue;\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value: event => {\n            const checked = pdfButtonValue === event.detail.value;\n            for (const radio of this._getElementsByName(event.target.name)) {\n              const curChecked = checked && radio.id === id;\n              if (radio.domElement) {\n                radio.domElement.checked = curChecked;\n              }\n              storage.setValue(radio.id, { value: curChecked });\n            }\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass PushButtonWidgetAnnotationElement extends LinkAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { ignoreBorder: parameters.data.hasAppearance });\n  }\n\n  render() {\n    // The rendering and functionality of a push button widget annotation is\n    // equal to that of a link annotation, but may have more functionality, such\n    // as performing actions on form fields (resetting, submitting, et cetera).\n    const container = super.render();\n    container.classList.add(\"buttonWidgetAnnotation\", \"pushButton\");\n\n    const linkElement = container.lastChild;\n    if (this.enableScripting && this.hasJSActions && linkElement) {\n      this._setDefaultPropertiesFromJS(linkElement);\n\n      linkElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        this._dispatchEventFromSandbox({}, jsEvent);\n      });\n    }\n\n    return container;\n  }\n}\n\nclass ChoiceWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"choiceWidgetAnnotation\");\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    const storedData = storage.getValue(id, {\n      value: this.data.fieldValue,\n    });\n\n    const selectElement = document.createElement(\"select\");\n    GetElementsByNameSet.add(selectElement);\n    selectElement.setAttribute(\"data-element-id\", id);\n\n    selectElement.disabled = this.data.readOnly;\n    this._setRequired(selectElement, this.data.required);\n    selectElement.name = this.data.fieldName;\n    selectElement.tabIndex = 0;\n\n    let addAnEmptyEntry = this.data.combo && this.data.options.length > 0;\n\n    if (!this.data.combo) {\n      // List boxes have a size and (optionally) multiple selection.\n      selectElement.size = this.data.options.length;\n      if (this.data.multiSelect) {\n        selectElement.multiple = true;\n      }\n    }\n\n    selectElement.addEventListener(\"resetform\", event => {\n      const defaultValue = this.data.defaultFieldValue;\n      for (const option of selectElement.options) {\n        option.selected = option.value === defaultValue;\n      }\n    });\n\n    // Insert the options into the choice field.\n    for (const option of this.data.options) {\n      const optionElement = document.createElement(\"option\");\n      optionElement.textContent = option.displayValue;\n      optionElement.value = option.exportValue;\n      if (storedData.value.includes(option.exportValue)) {\n        optionElement.setAttribute(\"selected\", true);\n        addAnEmptyEntry = false;\n      }\n      selectElement.append(optionElement);\n    }\n\n    let removeEmptyEntry = null;\n    if (addAnEmptyEntry) {\n      const noneOptionElement = document.createElement(\"option\");\n      noneOptionElement.value = \" \";\n      noneOptionElement.setAttribute(\"hidden\", true);\n      noneOptionElement.setAttribute(\"selected\", true);\n      selectElement.prepend(noneOptionElement);\n\n      removeEmptyEntry = () => {\n        noneOptionElement.remove();\n        selectElement.removeEventListener(\"input\", removeEmptyEntry);\n        removeEmptyEntry = null;\n      };\n      selectElement.addEventListener(\"input\", removeEmptyEntry);\n    }\n\n    const getValue = isExport => {\n      const name = isExport ? \"value\" : \"textContent\";\n      const { options, multiple } = selectElement;\n      if (!multiple) {\n        return options.selectedIndex === -1\n          ? null\n          : options[options.selectedIndex][name];\n      }\n      return Array.prototype.filter\n        .call(options, option => option.selected)\n        .map(option => option[name]);\n    };\n\n    let selectedValues = getValue(/* isExport */ false);\n\n    const getItems = event => {\n      const options = event.target.options;\n      return Array.prototype.map.call(options, option => ({\n        displayValue: option.textContent,\n        exportValue: option.value,\n      }));\n    };\n\n    if (this.enableScripting && this.hasJSActions) {\n      selectElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            removeEmptyEntry?.();\n            const value = event.detail.value;\n            const values = new Set(Array.isArray(value) ? value : [value]);\n            for (const option of selectElement.options) {\n              option.selected = values.has(option.value);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          multipleSelection(event) {\n            selectElement.multiple = true;\n          },\n          remove(event) {\n            const options = selectElement.options;\n            const index = event.detail.remove;\n            options[index].selected = false;\n            selectElement.remove(index);\n            if (options.length > 0) {\n              const i = Array.prototype.findIndex.call(\n                options,\n                option => option.selected\n              );\n              if (i === -1) {\n                options[0].selected = true;\n              }\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          clear(event) {\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            storage.setValue(id, { value: null, items: [] });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          insert(event) {\n            const { index, displayValue, exportValue } = event.detail.insert;\n            const selectChild = selectElement.children[index];\n            const optionElement = document.createElement(\"option\");\n            optionElement.textContent = displayValue;\n            optionElement.value = exportValue;\n\n            if (selectChild) {\n              selectChild.before(optionElement);\n            } else {\n              selectElement.append(optionElement);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          items(event) {\n            const { items } = event.detail;\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            for (const item of items) {\n              const { displayValue, exportValue } = item;\n              const optionElement = document.createElement(\"option\");\n              optionElement.textContent = displayValue;\n              optionElement.value = exportValue;\n              selectElement.append(optionElement);\n            }\n            if (selectElement.options.length > 0) {\n              selectElement.options[0].selected = true;\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          indices(event) {\n            const indices = new Set(event.detail.indices);\n            for (const option of event.target.options) {\n              option.selected = indices.has(option.index);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          editable(event) {\n            event.target.disabled = !event.detail.editable;\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      selectElement.addEventListener(\"input\", event => {\n        const exportValue = getValue(/* isExport */ true);\n        const change = getValue(/* isExport */ false);\n        storage.setValue(id, { value: exportValue });\n\n        event.preventDefault();\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id,\n            name: \"Keystroke\",\n            value: selectedValues,\n            change,\n            changeEx: exportValue,\n            willCommit: false,\n            commitKey: 1,\n            keyDown: false,\n          },\n        });\n      });\n\n      this._setEventListeners(\n        selectElement,\n        null,\n        [\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n          [\"input\", \"Action\"],\n          [\"input\", \"Validate\"],\n        ],\n        event => event.target.value\n      );\n    } else {\n      selectElement.addEventListener(\"input\", function (event) {\n        storage.setValue(id, { value: getValue(/* isExport */ true) });\n      });\n    }\n\n    if (this.data.combo) {\n      this._setTextStyle(selectElement);\n    } else {\n      // Just use the default font size...\n      // it's a bit hard to guess what is a good size.\n    }\n    this._setBackgroundColor(selectElement);\n    this._setDefaultPropertiesFromJS(selectElement);\n\n    this.container.append(selectElement);\n    return this.container;\n  }\n}\n\nclass PopupAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    const { data, elements, parent } = parameters;\n    const hasCommentManager = !!parent._commentManager;\n    super(parameters, {\n      isRenderable: !hasCommentManager && AnnotationElement._hasPopupData(data),\n    });\n    this.elements = elements;\n    if (hasCommentManager && AnnotationElement._hasPopupData(data)) {\n      const popup = (this.popup = this.#createPopup());\n      for (const element of elements) {\n        element.popup = popup;\n      }\n    } else {\n      this.popup = null;\n    }\n  }\n\n  #createPopup() {\n    return new PopupElement({\n      container: this.container,\n      color: this.data.color,\n      titleObj: this.data.titleObj,\n      modificationDate: this.data.modificationDate || this.data.creationDate,\n      contentsObj: this.data.contentsObj,\n      richText: this.data.richText,\n      rect: this.data.rect,\n      parentRect: this.data.parentRect || null,\n      parent: this.parent,\n      elements: this.elements,\n      open: this.data.open,\n      commentManager: this.parent._commentManager,\n    });\n  }\n\n  render() {\n    const { container } = this;\n    container.classList.add(\"popupAnnotation\");\n    container.role = \"comment\";\n\n    const popup = (this.popup = this.#createPopup());\n\n    const elementIds = [];\n    for (const element of this.elements) {\n      element.popup = popup;\n      element.container.ariaHasPopup = \"dialog\";\n      elementIds.push(element.data.id);\n      element.addHighlightArea();\n    }\n\n    this.container.setAttribute(\n      \"aria-controls\",\n      elementIds.map(id => `${AnnotationPrefix}${id}`).join(\",\")\n    );\n\n    return this.container;\n  }\n}\n\nclass PopupElement {\n  #commentManager = null;\n\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundHide = this.#hide.bind(this);\n\n  #boundShow = this.#show.bind(this);\n\n  #boundToggle = this.#toggle.bind(this);\n\n  #color = null;\n\n  #container = null;\n\n  #contentsObj = null;\n\n  #dateObj = null;\n\n  #elements = null;\n\n  #parent = null;\n\n  #parentRect = null;\n\n  #pinned = false;\n\n  #popup = null;\n\n  #popupAbortController = null;\n\n  #position = null;\n\n  #commentButton = null;\n\n  #commentButtonPosition = null;\n\n  #popupPosition = null;\n\n  #rect = null;\n\n  #richText = null;\n\n  #titleObj = null;\n\n  #updates = null;\n\n  #wasVisible = false;\n\n  #firstElement = null;\n\n  #commentText = null;\n\n  constructor({\n    container,\n    color,\n    elements,\n    titleObj,\n    modificationDate,\n    contentsObj,\n    richText,\n    parent,\n    rect,\n    parentRect,\n    open,\n    commentManager = null,\n  }) {\n    this.#container = container;\n    this.#titleObj = titleObj;\n    this.#contentsObj = contentsObj;\n    this.#richText = richText;\n    this.#parent = parent;\n    this.#color = color;\n    this.#rect = rect;\n    this.#parentRect = parentRect;\n    this.#elements = elements;\n    this.#commentManager = commentManager;\n    this.#firstElement = elements[0];\n\n    // The modification date is shown in the popup instead of the creation\n    // date if it is available and can be parsed correctly, which is\n    // consistent with other viewers such as Adobe Acrobat.\n    this.#dateObj = PDFDateString.toDateObject(modificationDate);\n\n    // The elements that will trigger the popup.\n    this.trigger = elements.flatMap(e => e.getElementsToTriggerPopup());\n\n    if (!commentManager) {\n      this.#addEventListeners();\n\n      this.#container.hidden = true;\n      if (open) {\n        this.#toggle();\n      }\n\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n        // Since the popup is lazily created, we need to ensure that it'll be\n        // created and displayed during reference tests.\n        this.#parent.popupShow.push(async () => {\n          if (this.#container.hidden) {\n            this.#show();\n          }\n        });\n      }\n    }\n  }\n\n  #addEventListeners() {\n    if (this.#popupAbortController) {\n      return;\n    }\n    this.#popupAbortController = new AbortController();\n    const { signal } = this.#popupAbortController;\n\n    // Attach the event listeners to the trigger element.\n    for (const element of this.trigger) {\n      element.addEventListener(\"click\", this.#boundToggle, { signal });\n      element.addEventListener(\"pointerenter\", this.#boundShow, { signal });\n      element.addEventListener(\"pointerleave\", this.#boundHide, { signal });\n      element.classList.add(\"popupTriggerArea\");\n    }\n\n    // Attach the event listener to toggle the popup with the keyboard.\n    for (const element of this.#elements) {\n      element.container?.addEventListener(\"keydown\", this.#boundKeyDown, {\n        signal,\n      });\n    }\n  }\n\n  #setCommentButtonPosition() {\n    const element = this.#elements.find(e => e.hasCommentButton);\n    if (!element) {\n      return;\n    }\n    this.#commentButtonPosition = element._normalizePoint(\n      element.commentButtonPosition\n    );\n  }\n\n  renderCommentButton() {\n    if (this.#commentButton) {\n      if (!this.#commentButton.parentNode) {\n        this.#firstElement.container.after(this.#commentButton);\n      }\n      return;\n    }\n\n    if (!this.#commentButtonPosition) {\n      this.#setCommentButtonPosition();\n    }\n\n    if (!this.#commentButtonPosition) {\n      return;\n    }\n\n    const { signal } = (this.#popupAbortController = new AbortController());\n    const hasOwnButton = this.#firstElement.hasOwnCommentButton;\n    const togglePopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ true,\n        /* visibility = */ undefined,\n        /* isEditable = */ !hasOwnButton\n      );\n    };\n    const showPopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ false,\n        /* visibility = */ true,\n        /* isEditable = */ !hasOwnButton\n      );\n    };\n    const hidePopup = () => {\n      this.#commentManager.toggleCommentPopup(\n        this,\n        /* isSelected = */ false,\n        /* visibility = */ false\n      );\n    };\n\n    if (!hasOwnButton) {\n      const button = (this.#commentButton = document.createElement(\"button\"));\n      button.className = \"annotationCommentButton\";\n      const parentContainer = this.#firstElement.container;\n      button.style.zIndex = parentContainer.style.zIndex + 1;\n      button.tabIndex = 0;\n      button.ariaHasPopup = \"dialog\";\n      button.ariaControls = \"commentPopup\";\n      button.setAttribute(\"data-l10n-id\", \"pdfjs-show-comment-button\");\n      this.#updateColor();\n      this.#updateCommentButtonPosition();\n      button.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n      button.addEventListener(\"click\", togglePopup, { signal });\n      button.addEventListener(\"pointerenter\", showPopup, { signal });\n      button.addEventListener(\"pointerleave\", hidePopup, { signal });\n      parentContainer.after(button);\n    } else {\n      this.#commentButton = this.#firstElement.container;\n      for (const element of this.trigger) {\n        element.ariaHasPopup = \"dialog\";\n        element.ariaControls = \"commentPopup\";\n        element.addEventListener(\"keydown\", this.#boundKeyDown, { signal });\n        element.addEventListener(\"click\", togglePopup, { signal });\n        element.addEventListener(\"pointerenter\", showPopup, { signal });\n        element.addEventListener(\"pointerleave\", hidePopup, { signal });\n        element.classList.add(\"popupTriggerArea\");\n      }\n    }\n  }\n\n  #updateCommentButtonPosition() {\n    if (this.#firstElement.extraPopupElement && !this.#firstElement.editor) {\n      // If there's no editor associated with the annotation then the comment\n      // button position can't be changed.\n      return;\n    }\n    if (!this.#commentButton) {\n      this.renderCommentButton();\n    }\n    const [x, y] = this.#commentButtonPosition;\n    const { style } = this.#commentButton;\n    style.left = `calc(${x}%)`;\n    style.top = `calc(${y}% - var(--comment-button-dim))`;\n  }\n\n  #updateColor() {\n    if (this.#firstElement.extraPopupElement) {\n      return;\n    }\n    if (!this.#commentButton) {\n      this.renderCommentButton();\n    }\n    this.#commentButton.style.backgroundColor = this.commentButtonColor || \"\";\n  }\n\n  get commentButtonColor() {\n    const { color, opacity } = this.#firstElement.commentData;\n    if (!color) {\n      return null;\n    }\n    return this.#parent._commentManager.makeCommentColor(color, opacity);\n  }\n\n  focusCommentButton() {\n    setTimeout(() => {\n      this.#commentButton?.focus();\n    }, 0);\n  }\n\n  getData() {\n    const { richText, color, opacity, creationDate, modificationDate } =\n      this.#firstElement.commentData;\n    return {\n      contentsObj: { str: this.comment },\n      richText,\n      color,\n      opacity,\n      creationDate,\n      modificationDate,\n    };\n  }\n\n  get elementBeforePopup() {\n    return this.#commentButton;\n  }\n\n  get comment() {\n    this.#commentText ||= this.#firstElement.commentText;\n    return this.#commentText;\n  }\n\n  set comment(text) {\n    if (text === this.comment) {\n      return;\n    }\n    this.#firstElement.commentText = this.#commentText = text;\n  }\n\n  focus() {\n    this.#firstElement.container?.focus();\n  }\n\n  get parentBoundingClientRect() {\n    return this.#firstElement.layer.getBoundingClientRect();\n  }\n\n  setCommentButtonStates({ selected, hasPopup }) {\n    if (!this.#commentButton) {\n      return;\n    }\n    this.#commentButton.classList.toggle(\"selected\", selected);\n    this.#commentButton.ariaExpanded = hasPopup;\n  }\n\n  setSelectedCommentButton(selected) {\n    this.#commentButton.classList.toggle(\"selected\", selected);\n  }\n\n  get commentPopupPosition() {\n    if (this.#popupPosition) {\n      return this.#popupPosition;\n    }\n    const { x, y, height } = this.#commentButton.getBoundingClientRect();\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = this.#firstElement.layer.getBoundingClientRect();\n    return [(x - parentX) / parentWidth, (y + height - parentY) / parentHeight];\n  }\n\n  set commentPopupPosition(pos) {\n    this.#popupPosition = pos;\n  }\n\n  hasDefaultPopupPosition() {\n    return this.#popupPosition === null;\n  }\n\n  get commentButtonPosition() {\n    return this.#commentButtonPosition;\n  }\n\n  get commentButtonWidth() {\n    return (\n      this.#commentButton.getBoundingClientRect().width /\n      this.parentBoundingClientRect.width\n    );\n  }\n\n  editComment(options) {\n    const [posX, posY] =\n      this.#popupPosition || this.commentButtonPosition.map(x => x / 100);\n    const parentDimensions = this.parentBoundingClientRect;\n    const {\n      x: parentX,\n      y: parentY,\n      width: parentWidth,\n      height: parentHeight,\n    } = parentDimensions;\n    this.#commentManager.showDialog(\n      null,\n      this,\n      parentX + posX * parentWidth,\n      parentY + posY * parentHeight,\n      { ...options, parentDimensions }\n    );\n  }\n\n  render() {\n    if (this.#popup) {\n      return;\n    }\n\n    const popup = (this.#popup = document.createElement(\"div\"));\n    popup.className = \"popup\";\n\n    if (this.#color) {\n      const baseColor = (popup.style.outlineColor = Util.makeHexColor(\n        ...this.#color\n      ));\n      popup.style.backgroundColor = `color-mix(in srgb, ${baseColor} 30%, white)`;\n    }\n\n    const header = document.createElement(\"span\");\n    header.className = \"header\";\n    if (this.#titleObj?.str) {\n      const title = document.createElement(\"span\");\n      title.className = \"title\";\n      header.append(title);\n      ({ dir: title.dir, str: title.textContent } = this.#titleObj);\n    }\n    popup.append(header);\n\n    if (this.#dateObj) {\n      const modificationDate = document.createElement(\"time\");\n      modificationDate.className = \"popupDate\";\n      modificationDate.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-annotation-date-time-string\"\n      );\n      modificationDate.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ dateObj: this.#dateObj.valueOf() })\n      );\n      modificationDate.dateTime = this.#dateObj.toISOString();\n      header.append(modificationDate);\n    }\n\n    renderRichText(\n      {\n        html: this.#html || this.#contentsObj.str,\n        dir: this.#contentsObj?.dir,\n        className: \"popupContent\",\n      },\n      popup\n    );\n\n    this.#container.append(popup);\n  }\n\n  get #html() {\n    const richText = this.#richText;\n    const contentsObj = this.#contentsObj;\n    if (\n      richText?.str &&\n      (!contentsObj?.str || contentsObj.str === richText.str)\n    ) {\n      return this.#richText.html || null;\n    }\n    return null;\n  }\n\n  get #fontSize() {\n    return this.#html?.attributes?.style?.fontSize || 0;\n  }\n\n  get #fontColor() {\n    return this.#html?.attributes?.style?.color || null;\n  }\n\n  #makePopupContent(text) {\n    const popupLines = [];\n    const popupContent = {\n      str: text,\n      html: {\n        name: \"div\",\n        attributes: {\n          dir: \"auto\",\n        },\n        children: [\n          {\n            name: \"p\",\n            children: popupLines,\n          },\n        ],\n      },\n    };\n    const lineAttributes = {\n      style: {\n        color: this.#fontColor,\n        fontSize: this.#fontSize\n          ? `calc(${this.#fontSize}px * var(--total-scale-factor))`\n          : \"\",\n      },\n    };\n    for (const line of text.split(\"\\n\")) {\n      popupLines.push({\n        name: \"span\",\n        value: line,\n        attributes: lineAttributes,\n      });\n    }\n    return popupContent;\n  }\n\n  #keyDown(event) {\n    if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey) {\n      return;\n    }\n\n    if (event.key === \"Enter\" || (event.key === \"Escape\" && this.#pinned)) {\n      this.#toggle();\n    }\n  }\n\n  updateEdited({ rect, popup, deleted }) {\n    if (this.#commentManager) {\n      if (deleted) {\n        this.remove();\n        this.#commentText = null;\n      } else if (popup) {\n        if (popup.deleted) {\n          this.remove();\n        } else {\n          this.#updateColor();\n          this.#commentText = popup.text;\n        }\n      }\n      if (rect) {\n        this.#commentButtonPosition = null;\n        this.#setCommentButtonPosition();\n        this.#updateCommentButtonPosition();\n      }\n      return;\n    }\n    if (deleted || popup?.deleted) {\n      this.remove();\n      return;\n    }\n    this.#addEventListeners();\n    this.#updates ||= {\n      contentsObj: this.#contentsObj,\n      richText: this.#richText,\n    };\n    if (rect) {\n      this.#position = null;\n    }\n    if (popup && popup.text) {\n      this.#richText = this.#makePopupContent(popup.text);\n      this.#dateObj = PDFDateString.toDateObject(popup.date);\n      this.#contentsObj = null;\n    }\n    this.#popup?.remove();\n    this.#popup = null;\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    ({ contentsObj: this.#contentsObj, richText: this.#richText } =\n      this.#updates);\n    this.#updates = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#position = null;\n  }\n\n  remove() {\n    this.#popupAbortController?.abort();\n    this.#popupAbortController = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#wasVisible = false;\n    this.#pinned = false;\n    this.#commentButton?.remove();\n    this.#commentButton = null;\n    if (this.trigger) {\n      for (const element of this.trigger) {\n        element.classList.remove(\"popupTriggerArea\");\n      }\n    }\n  }\n\n  #setPosition() {\n    if (this.#position !== null) {\n      return;\n    }\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.#parent;\n\n    let useParentRect = !!this.#parentRect;\n    let rect = useParentRect ? this.#parentRect : this.#rect;\n    for (const element of this.#elements) {\n      if (!rect || Util.intersect(element.data.rect, rect) !== null) {\n        rect = element.data.rect;\n        useParentRect = true;\n        break;\n      }\n    }\n\n    const normalizedRect = Util.normalizeRect([\n      rect[0],\n      view[3] - rect[1] + view[1],\n      rect[2],\n      view[3] - rect[3] + view[1],\n    ]);\n\n    const HORIZONTAL_SPACE_AFTER_ANNOTATION = 5;\n    const parentWidth = useParentRect\n      ? rect[2] - rect[0] + HORIZONTAL_SPACE_AFTER_ANNOTATION\n      : 0;\n    const popupLeft = normalizedRect[0] + parentWidth;\n    const popupTop = normalizedRect[1];\n    this.#position = [\n      (100 * (popupLeft - pageX)) / pageWidth,\n      (100 * (popupTop - pageY)) / pageHeight,\n    ];\n\n    const { style } = this.#container;\n    style.left = `${this.#position[0]}%`;\n    style.top = `${this.#position[1]}%`;\n  }\n\n  /**\n   * Toggle the visibility of the popup.\n   */\n  #toggle() {\n    if (this.#commentManager) {\n      this.#commentManager.toggleCommentPopup(this, /* isSelected = */ false);\n      return;\n    }\n\n    this.#pinned = !this.#pinned;\n    if (this.#pinned) {\n      this.#show();\n      this.#container.addEventListener(\"click\", this.#boundToggle);\n      this.#container.addEventListener(\"keydown\", this.#boundKeyDown);\n    } else {\n      this.#hide();\n      this.#container.removeEventListener(\"click\", this.#boundToggle);\n      this.#container.removeEventListener(\"keydown\", this.#boundKeyDown);\n    }\n  }\n\n  /**\n   * Show the popup.\n   */\n  #show() {\n    if (!this.#popup) {\n      this.render();\n    }\n    if (!this.isVisible) {\n      this.#setPosition();\n      this.#container.hidden = false;\n      this.#container.style.zIndex =\n        parseInt(this.#container.style.zIndex) + 1000;\n    } else if (this.#pinned) {\n      this.#container.classList.add(\"focused\");\n    }\n  }\n\n  /**\n   * Hide the popup.\n   */\n  #hide() {\n    this.#container.classList.remove(\"focused\");\n    if (this.#pinned || !this.isVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n    this.#container.style.zIndex =\n      parseInt(this.#container.style.zIndex) - 1000;\n  }\n\n  forceHide() {\n    this.#wasVisible = this.isVisible;\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n  }\n\n  maybeShow() {\n    if (this.#commentManager) {\n      return;\n    }\n    this.#addEventListeners();\n    if (!this.#wasVisible) {\n      return;\n    }\n    if (!this.#popup) {\n      this.#show();\n    }\n    this.#wasVisible = false;\n    this.#container.hidden = false;\n  }\n\n  get isVisible() {\n    if (this.#commentManager) {\n      return false;\n    }\n    return this.#container.hidden === false;\n  }\n}\n\nclass FreeTextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.textContent = parameters.data.textContent;\n    this.textPosition = parameters.data.textPosition;\n    this.annotationEditorType = AnnotationEditorType.FREETEXT;\n  }\n\n  render() {\n    this.container.classList.add(\"freeTextAnnotation\");\n\n    if (this.textContent) {\n      const content = (this.contentElement = document.createElement(\"div\"));\n      content.classList.add(\"annotationTextContent\");\n      content.setAttribute(\"role\", \"comment\");\n      for (const line of this.textContent) {\n        const lineSpan = document.createElement(\"span\");\n        lineSpan.textContent = line;\n        content.append(lineSpan);\n      }\n      this.container.append(content);\n    }\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass LineAnnotationElement extends AnnotationElement {\n  #line = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"lineAnnotation\");\n\n    // Create an invisible line with the same starting and ending coordinates\n    // that acts as the trigger for the popup. Only the line itself should\n    // trigger the popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // PDF coordinates are calculated from a bottom left origin, so transform\n    // the line coordinates to a top left origin for the SVG element.\n    const line = (this.#line = this.svgFactory.createElement(\"svg:line\"));\n    line.setAttribute(\"x1\", data.rect[2] - data.lineCoordinates[0]);\n    line.setAttribute(\"y1\", data.rect[3] - data.lineCoordinates[1]);\n    line.setAttribute(\"x2\", data.rect[2] - data.lineCoordinates[2]);\n    line.setAttribute(\"y2\", data.rect[3] - data.lineCoordinates[3]);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    line.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    line.setAttribute(\"stroke\", \"transparent\");\n    line.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(line);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the line instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#line;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass SquareAnnotationElement extends AnnotationElement {\n  #square = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"squareAnnotation\");\n\n    // Create an invisible square with the same rectangle that acts as the\n    // trigger for the popup. Only the square itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the square and half of\n    // the borders outside the square by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const square = (this.#square = this.svgFactory.createElement(\"svg:rect\"));\n    square.setAttribute(\"x\", borderWidth / 2);\n    square.setAttribute(\"y\", borderWidth / 2);\n    square.setAttribute(\"width\", width - borderWidth);\n    square.setAttribute(\"height\", height - borderWidth);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    square.setAttribute(\"stroke-width\", borderWidth || 1);\n    square.setAttribute(\"stroke\", \"transparent\");\n    square.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(square);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the square instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#square;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass CircleAnnotationElement extends AnnotationElement {\n  #circle = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"circleAnnotation\");\n\n    // Create an invisible circle with the same ellipse that acts as the\n    // trigger for the popup. Only the circle itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the circle and half of\n    // the borders outside the circle by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const circle = (this.#circle =\n      this.svgFactory.createElement(\"svg:ellipse\"));\n    circle.setAttribute(\"cx\", width / 2);\n    circle.setAttribute(\"cy\", height / 2);\n    circle.setAttribute(\"rx\", width / 2 - borderWidth / 2);\n    circle.setAttribute(\"ry\", height / 2 - borderWidth / 2);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    circle.setAttribute(\"stroke-width\", borderWidth || 1);\n    circle.setAttribute(\"stroke\", \"transparent\");\n    circle.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(circle);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the circle instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#circle;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolylineAnnotationElement extends AnnotationElement {\n  #polyline = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"polylineAnnotation\";\n    this.svgElementName = \"svg:polyline\";\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup. Only the polyline itself should trigger the\n    // popup, not the entire container.\n    const {\n      data: { rect, vertices, borderStyle, popupRef },\n      width,\n      height,\n    } = this;\n    if (!vertices) {\n      return this.container;\n    }\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // Convert the vertices array to a single points string that the SVG\n    // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n    // calculated from a bottom left origin, so transform the polyline\n    // coordinates to a top left origin for the SVG element.\n    let points = [];\n    for (let i = 0, ii = vertices.length; i < ii; i += 2) {\n      const x = vertices[i] - rect[0];\n      const y = rect[3] - vertices[i + 1];\n      points.push(`${x},${y}`);\n    }\n    points = points.join(\" \");\n\n    const polyline = (this.#polyline = this.svgFactory.createElement(\n      this.svgElementName\n    ));\n    polyline.setAttribute(\"points\", points);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    polyline.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    polyline.setAttribute(\"stroke\", \"transparent\");\n    polyline.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(polyline);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the polyline\n    // instead of to the entire container (which is the default).\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polyline;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolygonAnnotationElement extends PolylineAnnotationElement {\n  constructor(parameters) {\n    // Polygons are specific forms of polylines, so reuse their logic.\n    super(parameters);\n\n    this.containerClassName = \"polygonAnnotation\";\n    this.svgElementName = \"svg:polygon\";\n  }\n}\n\nclass CaretAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"caretAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass InkAnnotationElement extends AnnotationElement {\n  #polylinesGroupElement = null;\n\n  #polylines = [];\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"inkAnnotation\";\n\n    // Use the polyline SVG element since it allows us to use coordinates\n    // directly and to draw both straight lines and curves.\n    this.svgElementName = \"svg:polyline\";\n\n    this.annotationEditorType =\n      this.data.it === \"InkHighlight\"\n        ? AnnotationEditorType.HIGHLIGHT\n        : AnnotationEditorType.INK;\n  }\n\n  #getTransform(rotation, rect) {\n    // PDF coordinates are calculated from a bottom left origin, so\n    // transform the polyline coordinates to a top left origin for the\n    // SVG element.\n    switch (rotation) {\n      case 90:\n        return {\n          transform: `rotate(90) translate(${-rect[0]},${rect[1]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      case 180:\n        return {\n          transform: `rotate(180) translate(${-rect[2]},${rect[1]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n      case 270:\n        return {\n          transform: `rotate(270) translate(${-rect[2]},${rect[3]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      default:\n        return {\n          transform: `translate(${-rect[0]},${rect[3]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n    }\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup.\n    const {\n      data: { rect, rotation, inkLists, borderStyle, popupRef },\n    } = this;\n    const { transform, width, height } = this.#getTransform(rotation, rect);\n\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n    const g = (this.#polylinesGroupElement =\n      this.svgFactory.createElement(\"svg:g\"));\n    svg.append(g);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    g.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    g.setAttribute(\"stroke-linecap\", \"round\");\n    g.setAttribute(\"stroke-linejoin\", \"round\");\n    g.setAttribute(\"stroke-miterlimit\", 10);\n    g.setAttribute(\"stroke\", \"transparent\");\n    g.setAttribute(\"fill\", \"transparent\");\n    g.setAttribute(\"transform\", transform);\n\n    for (let i = 0, ii = inkLists.length; i < ii; i++) {\n      const polyline = this.svgFactory.createElement(this.svgElementName);\n      this.#polylines.push(polyline);\n      polyline.setAttribute(\"points\", inkLists[i].join(\",\"));\n      g.append(polyline);\n    }\n\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.append(svg);\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n\n  updateEdited(params) {\n    super.updateEdited(params);\n    const { thickness, points, rect } = params;\n    const g = this.#polylinesGroupElement;\n    if (thickness >= 0) {\n      g.setAttribute(\"stroke-width\", thickness || 1);\n    }\n    if (points) {\n      for (let i = 0, ii = this.#polylines.length; i < ii; i++) {\n        this.#polylines[i].setAttribute(\"points\", points[i].join(\",\"));\n      }\n    }\n    if (rect) {\n      const { transform, width, height } = this.#getTransform(\n        this.data.rotation,\n        rect\n      );\n      const root = g.parentElement;\n      root.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n      g.setAttribute(\"transform\", transform);\n    }\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polylines;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass HighlightAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n    this.annotationEditorType = AnnotationEditorType.HIGHLIGHT;\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"highlightAnnotation\");\n    this._editOnDoubleClick();\n\n    if (overlaidText) {\n      const mark = document.createElement(\"mark\");\n      mark.classList.add(\"overlaidText\");\n      mark.textContent = overlaidText;\n      this.container.append(mark);\n    }\n\n    return this.container;\n  }\n}\n\nclass UnderlineAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"underlineAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass SquigglyAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"squigglyAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass StrikeOutAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"strikeoutAnnotation\");\n\n    if (overlaidText) {\n      const strikeout = document.createElement(\"s\");\n      strikeout.classList.add(\"overlaidText\");\n      strikeout.textContent = overlaidText;\n      this.container.append(strikeout);\n    }\n\n    return this.container;\n  }\n}\n\nclass StampAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.annotationEditorType = AnnotationEditorType.STAMP;\n  }\n\n  render() {\n    this.container.classList.add(\"stampAnnotation\");\n    this.container.setAttribute(\"role\", \"img\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    }\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass FileAttachmentAnnotationElement extends AnnotationElement {\n  #trigger = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n\n    const { file } = this.data;\n    this.filename = file.filename;\n    this.content = file.content;\n\n    this.linkService.eventBus?.dispatch(\"fileattachmentannotation\", {\n      source: this,\n      ...file,\n    });\n  }\n\n  render() {\n    this.container.classList.add(\"fileAttachmentAnnotation\");\n\n    const { container, data } = this;\n    let trigger;\n    if (data.hasAppearance || data.fillAlpha === 0) {\n      trigger = document.createElement(\"div\");\n    } else {\n      // Unfortunately it seems that it's not clearly specified exactly what\n      // names are actually valid, since Table 184 contains:\n      //   Conforming readers shall provide predefined icon appearances for at\n      //   least the following standard names: GraphPushPin, PaperclipTag.\n      //   Additional names may be supported as well. Default value: PushPin.\n      trigger = document.createElement(\"img\");\n      trigger.src = `${this.imageResourcesPath}annotation-${\n        /paperclip/i.test(data.name) ? \"paperclip\" : \"pushpin\"\n      }.svg`;\n\n      if (data.fillAlpha && data.fillAlpha < 1) {\n        trigger.style = `filter: opacity(${Math.round(\n          data.fillAlpha * 100\n        )}%);`;\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          this.container.classList.add(\"hasFillAlpha\");\n        }\n      }\n    }\n    trigger.addEventListener(\"dblclick\", this.#download.bind(this));\n    this.#trigger = trigger;\n\n    const { isMac } = FeatureTest.platform;\n    container.addEventListener(\"keydown\", evt => {\n      if (evt.key === \"Enter\" && (isMac ? evt.metaKey : evt.ctrlKey)) {\n        this.#download();\n      }\n    });\n\n    if (!data.popupRef && this.hasPopupData) {\n      this.hasOwnCommentButton = true;\n      this._createPopup();\n    } else {\n      trigger.classList.add(\"popupTriggerArea\");\n    }\n\n    container.append(trigger);\n    return container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#trigger;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n\n  /**\n   * Download the file attachment associated with this annotation.\n   */\n  #download() {\n    this.downloadManager?.openOrDownloadData(this.content, this.filename);\n  }\n}\n\n/**\n * @typedef {Object} AnnotationLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Array} annotations\n * @property {PDFPageProxy} page\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {boolean} [enableScripting] - Enable embedded script execution.\n * @property {boolean} [hasJSActions] - Some fields have JS actions.\n *   The default value is `false`.\n * @property {Object<string, Array<Object>> | null} [fieldObjects]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationEditorUIManager} [annotationEditorUIManager]\n * @property {StructTreeLayerBuilder} [structTreeLayer]\n * @property {CommentManager} [commentManager] - The comment manager instance.\n */\n\n/**\n * Manage the layer containing all the annotations.\n */\nclass AnnotationLayer {\n  #accessibilityManager = null;\n\n  #annotationCanvasMap = null;\n\n  #annotationStorage = null;\n\n  #editableAnnotations = new Map();\n\n  #structTreeLayer = null;\n\n  #linkService = null;\n\n  #elements = [];\n\n  #hasAriaAttributesFromStructTree = false;\n\n  constructor({\n    div,\n    accessibilityManager,\n    annotationCanvasMap,\n    annotationEditorUIManager,\n    page,\n    viewport,\n    structTreeLayer,\n    commentManager,\n    linkService,\n    annotationStorage,\n  }) {\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationCanvasMap = annotationCanvasMap;\n    this.#structTreeLayer = structTreeLayer || null;\n    this.#linkService = linkService || null;\n    this.#annotationStorage = annotationStorage || new AnnotationStorage();\n    this.page = page;\n    this.viewport = viewport;\n    this.zIndex = 0;\n    this._annotationEditorUIManager = annotationEditorUIManager;\n    this._commentManager = commentManager || null;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"showPopups\", {\n        value: async () => {\n          for (const show of this.popupShow) {\n            await show();\n          }\n        },\n      });\n      this.popupShow = [];\n    }\n  }\n\n  hasEditableAnnotations() {\n    return this.#editableAnnotations.size > 0;\n  }\n\n  /**\n   * Render a new annotation layer with all annotation elements.\n   *\n   * @param {AnnotationLayerParameters} params\n   * @memberof AnnotationLayer\n   */\n  async render(params) {\n    const { annotations } = params;\n    const layer = this.div;\n    setLayerDimensions(layer, this.viewport);\n\n    const popupToElements = new Map();\n    const popupAnnotations = [];\n    const elementParams = {\n      data: null,\n      layer,\n      linkService: this.#linkService,\n      downloadManager: params.downloadManager,\n      imageResourcesPath: params.imageResourcesPath || \"\",\n      renderForms: params.renderForms !== false,\n      svgFactory: new DOMSVGFactory(),\n      annotationStorage: this.#annotationStorage,\n      enableComment: params.enableComment === true,\n      enableScripting: params.enableScripting === true,\n      hasJSActions: params.hasJSActions,\n      fieldObjects: params.fieldObjects,\n      parent: this,\n      elements: null,\n    };\n\n    for (const data of annotations) {\n      if (data.noHTML) {\n        continue;\n      }\n      const isPopupAnnotation = data.annotationType === AnnotationType.POPUP;\n      if (!isPopupAnnotation) {\n        if (data.rect[2] === data.rect[0] || data.rect[3] === data.rect[1]) {\n          continue; // Ignore empty annotations.\n        }\n      } else {\n        const elements = popupToElements.get(data.id);\n        if (!elements) {\n          // Ignore popup annotations without a corresponding annotation.\n          continue;\n        }\n        if (!this._commentManager) {\n          popupAnnotations.push(data);\n          continue;\n        }\n        elementParams.elements = elements;\n      }\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n\n      if (!isPopupAnnotation) {\n        this.#elements.push(element);\n\n        if (data.popupRef) {\n          const elements = popupToElements.get(data.popupRef);\n          if (!elements) {\n            popupToElements.set(data.popupRef, [element]);\n          } else {\n            elements.push(element);\n          }\n        }\n      }\n\n      const rendered = element.render();\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n\n      if (element._isEditable) {\n        this.#editableAnnotations.set(element.data.id, element);\n        this._annotationEditorUIManager?.renderAnnotationElement(element);\n      }\n    }\n\n    await this.#addElementsToDOM();\n\n    for (const data of popupAnnotations) {\n      const elements = (elementParams.elements = popupToElements.get(data.id));\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n      if (!element.isRenderable) {\n        continue;\n      }\n      const rendered = element.render();\n      element.contentElement.id = `${AnnotationPrefix}${data.id}`;\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n      elements.at(-1).container.after(rendered);\n    }\n\n    this.#setAnnotationCanvasMap();\n  }\n\n  async #addElementsToDOM() {\n    if (this.#elements.length === 0) {\n      return;\n    }\n    // Clear the existing annotations in order to make sure comment buttons\n    // don't have a parent any longer.\n    this.div.replaceChildren();\n\n    const promises = [];\n    if (!this.#hasAriaAttributesFromStructTree) {\n      this.#hasAriaAttributesFromStructTree = true;\n      for (const {\n        contentElement,\n        data: { id },\n      } of this.#elements) {\n        const annotationId = (contentElement.id = `${AnnotationPrefix}${id}`);\n        promises.push(\n          this.#structTreeLayer\n            ?.getAriaAttributes(annotationId)\n            .then(ariaAttributes => {\n              if (ariaAttributes) {\n                for (const [key, value] of ariaAttributes) {\n                  contentElement.setAttribute(key, value);\n                }\n              }\n            })\n        );\n      }\n    }\n    this.#elements.sort(\n      (\n        {\n          data: {\n            rect: [a0, a1, a2, a3],\n          },\n        },\n        {\n          data: {\n            rect: [b0, b1, b2, b3],\n          },\n        }\n      ) => {\n        // We are in page coordinates, which has the origin at the\n        // bottom left.\n        if (a0 === a2 && a1 === a3) {\n          return +1;\n        }\n\n        if (b0 === b2 && b1 === b3) {\n          return -1;\n        }\n\n        const top1 = a3;\n        const bot1 = a1;\n        const mid1 = (a1 + a3) / 2;\n\n        const top2 = b3;\n        const bot2 = b1;\n        const mid2 = (b1 + b3) / 2;\n\n        if (mid1 >= top2 && mid2 <= bot1) {\n          return -1;\n        }\n\n        if (mid2 >= top1 && mid1 <= bot2) {\n          return +1;\n        }\n\n        const centerX1 = (a0 + a2) / 2;\n        const centerX2 = (b0 + b2) / 2;\n\n        return centerX1 - centerX2;\n      }\n    );\n\n    const fragment = document.createDocumentFragment();\n    for (const element of this.#elements) {\n      fragment.append(element.container);\n      if (this._commentManager) {\n        (\n          element.extraPopupElement?.popup || element.popup\n        )?.renderCommentButton();\n      } else if (element.extraPopupElement) {\n        fragment.append(element.extraPopupElement.render());\n      }\n    }\n    this.div.append(fragment);\n    await Promise.all(promises);\n    if (this.#accessibilityManager) {\n      for (const element of this.#elements) {\n        this.#accessibilityManager.addPointerInTextLayer(\n          element.contentElement,\n          /* isRemovable = */ false\n        );\n      }\n    }\n  }\n\n  /**\n   * Add link annotations to the annotation layer.\n   *\n   * @param {Array<Object>} annotations\n   * @param {IPDFLinkService} linkService\n   * @memberof AnnotationLayer\n   */\n  async addLinkAnnotations(annotations) {\n    const elementParams = {\n      data: null,\n      layer: this.div,\n      linkService: this.#linkService,\n      svgFactory: new DOMSVGFactory(),\n      parent: this,\n    };\n    for (const data of annotations) {\n      data.borderStyle ||= AnnotationLayer._defaultBorderStyle;\n\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n      element.render();\n      element.contentElement.id = `${AnnotationPrefix}${data.id}`;\n      this.#elements.push(element);\n    }\n    await this.#addElementsToDOM();\n  }\n\n  /**\n   * Update the annotation elements on existing annotation layer.\n   *\n   * @param {AnnotationLayerParameters} viewport\n   * @memberof AnnotationLayer\n   */\n  update({ viewport }) {\n    const layer = this.div;\n    this.viewport = viewport;\n    setLayerDimensions(layer, { rotation: viewport.rotation });\n\n    this.#setAnnotationCanvasMap();\n    layer.hidden = false;\n  }\n\n  #setAnnotationCanvasMap() {\n    if (!this.#annotationCanvasMap) {\n      return;\n    }\n    const layer = this.div;\n    for (const [id, canvas] of this.#annotationCanvasMap) {\n      const element = layer.querySelector(`[data-annotation-id=\"${id}\"]`);\n      if (!element) {\n        continue;\n      }\n\n      canvas.className = \"annotationContent\";\n      const { firstChild } = element;\n      if (!firstChild) {\n        element.append(canvas);\n      } else if (firstChild.nodeName === \"CANVAS\") {\n        firstChild.replaceWith(canvas);\n      } else if (!firstChild.classList.contains(\"annotationContent\")) {\n        firstChild.before(canvas);\n      } else {\n        firstChild.after(canvas);\n      }\n\n      const editableAnnotation = this.#editableAnnotations.get(id);\n      if (!editableAnnotation) {\n        continue;\n      }\n      if (editableAnnotation._hasNoCanvas) {\n        // The canvas wasn't available when the annotation was created.\n        this._annotationEditorUIManager?.setMissingCanvas(\n          id,\n          element.id,\n          canvas\n        );\n        editableAnnotation._hasNoCanvas = false;\n      } else {\n        editableAnnotation.canvas = canvas;\n      }\n    }\n    this.#annotationCanvasMap.clear();\n  }\n\n  getEditableAnnotations() {\n    return Array.from(this.#editableAnnotations.values());\n  }\n\n  getEditableAnnotation(id) {\n    return this.#editableAnnotations.get(id);\n  }\n\n  addFakeAnnotation(editor) {\n    const { div } = this;\n    const { id, rotation } = editor;\n    const element = new EditorAnnotationElement({\n      data: {\n        id,\n        rect: editor.getPDFRect(),\n        rotation,\n      },\n      editor,\n      layer: div,\n      parent: this,\n      enableComment: !!this._commentManager,\n      linkService: this.#linkService,\n      annotationStorage: this.#annotationStorage,\n    });\n    element.render();\n    element.contentElement.id = `${AnnotationPrefix}${id}`;\n    element.createOrUpdatePopup();\n    this.#elements.push(element);\n    return element;\n  }\n\n  removeAnnotation(id) {\n    const index = this.#elements.findIndex(el => el.data.id === id);\n    if (index < 0) {\n      return;\n    }\n    const [element] = this.#elements.splice(index, 1);\n    this.#accessibilityManager?.removePointerInTextLayer(\n      element.contentElement\n    );\n  }\n\n  updateFakeAnnotations(editors) {\n    if (editors.length === 0) {\n      return;\n    }\n    for (const editor of editors) {\n      editor.updateFakeAnnotationElement(this);\n    }\n    this.#addElementsToDOM();\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  /**\n   * @private\n   */\n  static get _defaultBorderStyle() {\n    return shadow(\n      this,\n      \"_defaultBorderStyle\",\n      Object.freeze({\n        width: 1,\n        rawWidth: 1,\n        style: AnnotationBorderStyleType.SOLID,\n        dashArray: [3],\n        horizontalCornerRadius: 0,\n        verticalCornerRadius: 0,\n      })\n    );\n  }\n}\n\nexport {\n  AnnotationLayer,\n  FreeTextAnnotationElement,\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n  StampAnnotationElement,\n};\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  assert,\n  LINE_FACTOR,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditorUIManager, KeyboardManager } from \"./tools.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { BasicColorPicker } from \"./color_picker.js\";\nimport { FreeTextAnnotationElement } from \"../annotation_layer.js\";\n\nconst EOL_PATTERN = /\\r\\n?|\\n/g;\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass FreeTextEditor extends AnnotationEditor {\n  #content = \"\";\n\n  #editorDivId = `${this.id}-editor`;\n\n  #editModeAC = null;\n\n  #fontSize;\n\n  _colorPicker = null;\n\n  static _freeTextDefaultContent = \"\";\n\n  static _internalPadding = 0;\n\n  static _defaultColor = null;\n\n  static _defaultFontSize = 10;\n\n  static get _keyboardManager() {\n    const proto = FreeTextEditor.prototype;\n\n    const arrowChecker = self => self.isEmpty();\n\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          // Commit the text in case the user use ctrl+s to save the document.\n          // The event must bubble in order to be caught by the viewer.\n          // See bug 1831574.\n          [\"ctrl+s\", \"mac+meta+s\", \"ctrl+p\", \"mac+meta+p\"],\n          proto.commitOrRemove,\n          { bubbles: true },\n        ],\n        [\n          [\"ctrl+Enter\", \"mac+meta+Enter\", \"Escape\", \"mac+Escape\"],\n          proto.commitOrRemove,\n        ],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  static _type = \"freetext\";\n\n  static _editorType = AnnotationEditorType.FREETEXT;\n\n  constructor(params) {\n    super({ ...params, name: \"freeTextEditor\" });\n    this.color =\n      params.color ||\n      FreeTextEditor._defaultColor ||\n      AnnotationEditor._defaultLineColor;\n    this.#fontSize = params.fontSize || FreeTextEditor._defaultFontSize;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-freetext-added-alert\");\n    }\n    this.canAddComment = false;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    const style = getComputedStyle(document.documentElement);\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      const lineHeight = parseFloat(\n        style.getPropertyValue(\"--freetext-line-height\")\n      );\n      assert(\n        lineHeight === LINE_FACTOR,\n        \"Update the CSS variable to agree with the constant.\"\n      );\n    }\n\n    this._internalPadding = parseFloat(\n      style.getPropertyValue(\"--freetext-padding\")\n    );\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        FreeTextEditor._defaultFontSize = value;\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        FreeTextEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        this.#updateFontSize(value);\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.FREETEXT_SIZE,\n        FreeTextEditor._defaultFontSize,\n      ],\n      [\n        AnnotationEditorParamsType.FREETEXT_COLOR,\n        FreeTextEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.FREETEXT_SIZE, this.#fontSize],\n      [AnnotationEditorParamsType.FREETEXT_COLOR, this.color],\n    ];\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    this._colorPicker ||= new BasicColorPicker(this);\n    return [[\"colorPicker\", this._colorPicker]];\n  }\n\n  get colorType() {\n    return AnnotationEditorParamsType.FREETEXT_COLOR;\n  }\n\n  /**\n   * Update the font size and make this action as undoable.\n   * @param {number} fontSize\n   */\n  #updateFontSize(fontSize) {\n    const setFontsize = size => {\n      this.editorDiv.style.fontSize = `calc(${size}px * var(--total-scale-factor))`;\n      this.translate(0, -(size - this.#fontSize) * this.parentScale);\n      this.#fontSize = size;\n      this.#setEditorDimensions();\n    };\n    const savedFontsize = this.#fontSize;\n    this.addCommands({\n      cmd: setFontsize.bind(this, fontSize),\n      undo: setFontsize.bind(this, savedFontsize),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_SIZE,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this.editorDiv.style.color = this.color;\n    this._colorPicker?.update(this.color);\n    super.onUpdatedColor();\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.color = col;\n      this.onUpdatedColor();\n    };\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Helper to translate the editor with the keyboard when it's empty.\n   * @param {number} x in page units.\n   * @param {number} y in page units.\n   */\n  _translateEmpty(x, y) {\n    this._uiManager.translateSelectedEditors(x, y, /* noCommit = */ true);\n  }\n\n  /** @inheritdoc */\n  getInitialTranslation() {\n    // The start of the base line is where the user clicked.\n    const scale = this.parentScale;\n    return [\n      -FreeTextEditor._internalPadding * scale,\n      -(FreeTextEditor._internalPadding + this.#fontSize) * scale,\n    ];\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (!super.enableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.remove(\"enabled\");\n    this.editorDiv.contentEditable = true;\n    this._isDraggable = false;\n    this.div.removeAttribute(\"aria-activedescendant\");\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        !this.#editModeAC,\n        \"No `this.#editModeAC` AbortController should exist.\"\n      );\n    }\n    this.#editModeAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#editModeAC);\n\n    this.editorDiv.addEventListener(\n      \"keydown\",\n      this.editorDivKeydown.bind(this),\n      { signal }\n    );\n    this.editorDiv.addEventListener(\"focus\", this.editorDivFocus.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"blur\", this.editorDivBlur.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"input\", this.editorDivInput.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"paste\", this.editorDivPaste.bind(this), {\n      signal,\n    });\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!super.disableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.add(\"enabled\");\n    this.editorDiv.contentEditable = false;\n    this.div.setAttribute(\"aria-activedescendant\", this.#editorDivId);\n    this._isDraggable = true;\n\n    this.#editModeAC?.abort();\n    this.#editModeAC = null;\n\n    // On Chrome, the focus is given to <body> when contentEditable is set to\n    // false, hence we focus the div.\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n\n    // In case the blur callback hasn't been called.\n    this.isEditing = false;\n    this.parent.div.classList.add(\"freetextEditing\");\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    if (event.target !== this.editorDiv) {\n      this.editorDiv.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (this.width) {\n      // The editor was created in using ctrl+c.\n      return;\n    }\n    this.enableEditMode();\n    if (focus) {\n      this.editorDiv.focus();\n    }\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    }\n    this._initialOptions = null;\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !this.editorDiv || this.editorDiv.innerText.trim() === \"\";\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.isEditing = false;\n    if (this.parent) {\n      this.parent.setEditingState(true);\n      this.parent.div.classList.add(\"freetextEditing\");\n    }\n    super.remove();\n  }\n\n  /**\n   * Extract the text from this editor.\n   * @returns {string}\n   */\n  #extractText() {\n    // We don't use innerText because there are some bugs with line breaks.\n    const buffer = [];\n    this.editorDiv.normalize();\n    let prevChild = null;\n    for (const child of this.editorDiv.childNodes) {\n      if (prevChild?.nodeType === Node.TEXT_NODE && child.nodeName === \"BR\") {\n        // It can happen if the user uses shift+enter to add a new line.\n        // If we don't skip it, we'll end up with an extra line (one for the\n        // text and one for the br element).\n        continue;\n      }\n      buffer.push(FreeTextEditor.#getNodeContent(child));\n      prevChild = child;\n    }\n    return buffer.join(\"\\n\");\n  }\n\n  #setEditorDimensions() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n\n    let rect;\n    if (this.isAttachedToDOM) {\n      rect = this.div.getBoundingClientRect();\n    } else {\n      // This editor isn't on screen but we need to get its dimensions, so\n      // we just insert it in the DOM, get its bounding box and then remove it.\n      const { currentLayer, div } = this;\n      const savedDisplay = div.style.display;\n      const savedVisibility = div.classList.contains(\"hidden\");\n      div.classList.remove(\"hidden\");\n      div.style.display = \"hidden\";\n      currentLayer.div.append(this.div);\n      rect = div.getBoundingClientRect();\n      div.remove();\n      div.style.display = savedDisplay;\n      div.classList.toggle(\"hidden\", savedVisibility);\n    }\n\n    // The dimensions are relative to the rotation of the page, hence we need to\n    // take that into account (see issue #16636).\n    if (this.rotation % 180 === this.parentRotation % 180) {\n      this.width = rect.width / parentWidth;\n      this.height = rect.height / parentHeight;\n    } else {\n      this.width = rect.height / parentWidth;\n      this.height = rect.width / parentHeight;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Commit the content we have in this editor.\n   * @returns {undefined}\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    super.commit();\n    this.disableEditMode();\n    const savedText = this.#content;\n    const newText = (this.#content = this.#extractText().trimEnd());\n    if (savedText === newText) {\n      return;\n    }\n\n    const setText = text => {\n      this.#content = text;\n      if (!text) {\n        this.remove();\n        return;\n      }\n      this.#setContent();\n      this._uiManager.rebuild(this);\n      this.#setEditorDimensions();\n    };\n    this.addCommands({\n      cmd: () => {\n        setText(newText);\n      },\n      undo: () => {\n        setText(savedText);\n      },\n      mustExec: false,\n    });\n    this.#setEditorDimensions();\n  }\n\n  /** @inheritdoc */\n  shouldGetKeyboardEvents() {\n    return this.isInEditMode();\n  }\n\n  /** @inheritdoc */\n  enterInEditMode() {\n    this.enableEditMode();\n    this.editorDiv.focus();\n  }\n\n  /** @inheritdoc */\n  keydown(event) {\n    if (event.target === this.div && event.key === \"Enter\") {\n      this.enterInEditMode();\n      // Avoid to add an unwanted new line.\n      event.preventDefault();\n    }\n  }\n\n  editorDivKeydown(event) {\n    FreeTextEditor._keyboardManager.exec(this, event);\n  }\n\n  editorDivFocus(event) {\n    this.isEditing = true;\n  }\n\n  editorDivBlur(event) {\n    this.isEditing = false;\n  }\n\n  editorDivInput(event) {\n    this.parent.div.classList.toggle(\"freetextEditing\", this.isEmpty());\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"comment\");\n    this.editorDiv.removeAttribute(\"aria-multiline\");\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"textbox\");\n    this.editorDiv.setAttribute(\"aria-multiline\", true);\n  }\n\n  /** @inheritdoc */\n  get canChangeContent() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy || this.annotationElementId) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.editorDiv = document.createElement(\"div\");\n    this.editorDiv.className = \"internal\";\n\n    this.editorDiv.setAttribute(\"id\", this.#editorDivId);\n    this.editorDiv.setAttribute(\"data-l10n-id\", \"pdfjs-free-text2\");\n    this.editorDiv.setAttribute(\"data-l10n-attrs\", \"default-content\");\n    this.enableEditing();\n\n    this.editorDiv.contentEditable = true;\n\n    const { style } = this.editorDiv;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.color;\n\n    this.div.append(this.editorDiv);\n\n    this.overlayDiv = document.createElement(\"div\");\n    this.overlayDiv.classList.add(\"overlay\", \"enabled\");\n    this.div.append(this.overlayDiv);\n\n    if (this._isCopy || this.annotationElementId) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      if (this.annotationElementId) {\n        // This stuff is hard to test: if something is changed here, please\n        // test with the following PDF file:\n        //  - freetexts.pdf\n        //  - rotated_freetexts.pdf\n        // Only small variations between the original annotation and its editor\n        // are allowed.\n\n        // position is the position of the first glyph in the annotation\n        // and it's relative to its container.\n        const { position } = this._initialData;\n        let [tx, ty] = this.getInitialTranslation();\n        [tx, ty] = this.pageTranslationToScreen(tx, ty);\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        const [pageX, pageY] = this.pageTranslation;\n        let posX, posY;\n        switch (this.rotation) {\n          case 0:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY + this.height - (position[1] - pageY) / pageHeight;\n            break;\n          case 90:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [ty, -tx];\n            break;\n          case 180:\n            posX = baseX - this.width + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [-tx, -ty];\n            break;\n          case 270:\n            posX =\n              baseX +\n              (position[0] - pageX - this.height * pageHeight) / pageWidth;\n            posY =\n              baseY +\n              (position[1] - pageY - this.width * pageWidth) / pageHeight;\n            [tx, ty] = [-ty, tx];\n            break;\n        }\n        this.setAt(posX * parentWidth, posY * parentHeight, tx, ty);\n      } else {\n        this._moveAfterPaste(baseX, baseY);\n      }\n\n      this.#setContent();\n      this._isDraggable = true;\n      this.editorDiv.contentEditable = false;\n    } else {\n      this._isDraggable = false;\n      this.editorDiv.contentEditable = true;\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.div.setAttribute(\"annotation-id\", this.annotationElementId);\n    }\n\n    return this.div;\n  }\n\n  static #getNodeContent(node) {\n    return (\n      node.nodeType === Node.TEXT_NODE ? node.nodeValue : node.innerText\n    ).replaceAll(EOL_PATTERN, \"\");\n  }\n\n  editorDivPaste(event) {\n    const clipboardData = event.clipboardData || window.clipboardData;\n    const { types } = clipboardData;\n    if (types.length === 1 && types[0] === \"text/plain\") {\n      return;\n    }\n\n    event.preventDefault();\n    const paste = FreeTextEditor.#deserializeContent(\n      clipboardData.getData(\"text\") || \"\"\n    ).replaceAll(EOL_PATTERN, \"\\n\");\n    if (!paste) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (!selection.rangeCount) {\n      return;\n    }\n    this.editorDiv.normalize();\n    selection.deleteFromDocument();\n    const range = selection.getRangeAt(0);\n    if (!paste.includes(\"\\n\")) {\n      range.insertNode(document.createTextNode(paste));\n      this.editorDiv.normalize();\n      selection.collapseToStart();\n      return;\n    }\n\n    // Collect the text before and after the caret.\n    const { startContainer, startOffset } = range;\n    const bufferBefore = [];\n    const bufferAfter = [];\n    if (startContainer.nodeType === Node.TEXT_NODE) {\n      const parent = startContainer.parentElement;\n      bufferAfter.push(\n        startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN, \"\")\n      );\n      if (parent !== this.editorDiv) {\n        let buffer = bufferBefore;\n        for (const child of this.editorDiv.childNodes) {\n          if (child === parent) {\n            buffer = bufferAfter;\n            continue;\n          }\n          buffer.push(FreeTextEditor.#getNodeContent(child));\n        }\n      }\n      bufferBefore.push(\n        startContainer.nodeValue\n          .slice(0, startOffset)\n          .replaceAll(EOL_PATTERN, \"\")\n      );\n    } else if (startContainer === this.editorDiv) {\n      let buffer = bufferBefore;\n      let i = 0;\n      for (const child of this.editorDiv.childNodes) {\n        if (i++ === startOffset) {\n          buffer = bufferAfter;\n        }\n        buffer.push(FreeTextEditor.#getNodeContent(child));\n      }\n    }\n    this.#content = `${bufferBefore.join(\"\\n\")}${paste}${bufferAfter.join(\"\\n\")}`;\n    this.#setContent();\n\n    // Set the caret at the right position.\n    const newRange = new Range();\n    let beforeLength = Math.sumPrecise(bufferBefore.map(line => line.length));\n    for (const { firstChild } of this.editorDiv.childNodes) {\n      // Each child is either a div with a text node or a br element.\n      if (firstChild.nodeType === Node.TEXT_NODE) {\n        const length = firstChild.nodeValue.length;\n        if (beforeLength <= length) {\n          newRange.setStart(firstChild, beforeLength);\n          newRange.setEnd(firstChild, beforeLength);\n          break;\n        }\n        beforeLength -= length;\n      }\n    }\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  #setContent() {\n    this.editorDiv.replaceChildren();\n    if (!this.#content) {\n      return;\n    }\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      this.editorDiv.append(div);\n    }\n  }\n\n  #serializeContent() {\n    return this.#content.replaceAll(\"\\xa0\", \" \");\n  }\n\n  static #deserializeContent(content) {\n    return content.replaceAll(\" \", \"\\xa0\");\n  }\n\n  /** @inheritdoc */\n  get contentDiv() {\n    return this.editorDiv;\n  }\n\n  /** @inheritdoc */\n  getPDFRect() {\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    return this.getRect(padding, padding);\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof FreeTextAnnotationElement) {\n      const {\n        data: {\n          defaultAppearanceData: { fontSize, fontColor },\n          rect,\n          rotation,\n          id,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        textContent,\n        textPosition,\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      // textContent is supposed to be an array of strings containing each line\n      // of text. However, it can be null or empty.\n      if (!textContent || textContent.length === 0) {\n        // Empty annotation.\n        return null;\n      }\n      initialData = data = {\n        annotationType: AnnotationEditorType.FREETEXT,\n        color: Array.from(fontColor),\n        fontSize,\n        value: textContent.join(\"\\n\"),\n        position: textPosition,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        comment: contentsObj?.str || null,\n        richText,\n        creationDate,\n        modificationDate,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#fontSize = data.fontSize;\n    editor.color = Util.makeHexColor(...data.color);\n    editor.#content = FreeTextEditor.#deserializeContent(data.value);\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const color = AnnotationEditor._colorManager.convert(\n      this.isAttachedToDOM ? getComputedStyle(this.editorDiv).color : this.color\n    );\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      color,\n      fontSize: this.#fontSize,\n      value: this.#serializeContent(),\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      // Don't add the id when copying because the pasted editor mustn't be\n      // linked to an existing annotation.\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { value, fontSize, color, pageIndex } = this._initialData;\n\n    return (\n      this.hasEditedComment ||\n      this._hasBeenMoved ||\n      serialized.value !== value ||\n      serialized.fontSize !== fontSize ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    const content = super.renderAnnotationElement(annotation);\n    if (!content) {\n      return null;\n    }\n    const { style } = content;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.color;\n\n    content.replaceChildren();\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      content.append(div);\n    }\n\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup:\n        this._uiManager.hasCommentManager() || this.hasEditedComment\n          ? this.comment\n          : { text: this.#content },\n    });\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    super.resetAnnotationElement(annotation);\n    annotation.resetEdited();\n  }\n}\n\nexport { FreeTextEditor };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../../../shared/util.js\";\n\nclass Outline {\n  static PRECISION = 1e-4;\n\n  /**\n   * @returns {string} The SVG path of the outline.\n   */\n  toSVGPath() {\n    unreachable(\"Abstract method `toSVGPath` must be implemented.\");\n  }\n\n  /**\n   * @type {Object|null} The bounding box of the outline.\n   */\n  // eslint-disable-next-line getter-return\n  get box() {\n    unreachable(\"Abstract getter `box` must be implemented.\");\n  }\n\n  serialize(_bbox, _rotation) {\n    unreachable(\"Abstract method `serialize` must be implemented.\");\n  }\n\n  static _rescale(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i] * sx;\n      dest[i + 1] = ty + src[i + 1] * sy;\n    }\n    return dest;\n  }\n\n  static _rescaleAndSwap(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i + 1] * sx;\n      dest[i + 1] = ty + src[i] * sy;\n    }\n    return dest;\n  }\n\n  static _translate(src, tx, ty, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i];\n      dest[i + 1] = ty + src[i + 1];\n    }\n    return dest;\n  }\n\n  static svgRound(x) {\n    // 0.1234 will be 1234 and this way we economize 2 bytes per number.\n    // Of course, it makes sense only when the viewBox is [0 0 10000 10000].\n    // And it helps to avoid bugs like:\n    //  https://bugzilla.mozilla.org/show_bug.cgi?id=1929340\n    return Math.round(x * 10000);\n  }\n\n  static _normalizePoint(x, y, parentWidth, parentHeight, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y / parentWidth, x / parentHeight];\n      case 180:\n        return [1 - x / parentWidth, 1 - y / parentHeight];\n      case 270:\n        return [y / parentWidth, 1 - x / parentHeight];\n      default:\n        return [x / parentWidth, y / parentHeight];\n    }\n  }\n\n  static _normalizePagePoint(x, y, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y, x];\n      case 180:\n        return [1 - x, 1 - y];\n      case 270:\n        return [y, 1 - x];\n      default:\n        return [x, y];\n    }\n  }\n\n  static createBezierPoints(x1, y1, x2, y2, x3, y3) {\n    return [\n      (x1 + 5 * x2) / 6,\n      (y1 + 5 * y2) / 6,\n      (5 * x2 + x3) / 6,\n      (5 * y2 + y3) / 6,\n      (x2 + x3) / 2,\n      (y2 + y3) / 2,\n    ];\n  }\n}\n\nexport { Outline };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass FreeDrawOutliner {\n  #box;\n\n  #bottom = [];\n\n  #innerMargin;\n\n  #isLTR;\n\n  #top = [];\n\n  // The first 6 elements are the last 3 points of the top part of the outline.\n  // The next 6 elements are the last 3 points of the line.\n  // The next 6 elements are the last 3 points of the bottom part of the\n  // outline.\n  // We track the last 3 points in order to be able to:\n  //  - compute the normal of the line,\n  //  - compute the control points of the quadratic Bzier curve.\n  #last = new Float32Array(18);\n\n  #lastX;\n\n  #lastY;\n\n  #min;\n\n  #min_dist;\n\n  #scaleFactor;\n\n  #thickness;\n\n  #points = [];\n\n  static #MIN_DIST = 8;\n\n  static #MIN_DIFF = 2;\n\n  static #MIN = FreeDrawOutliner.#MIN_DIST + FreeDrawOutliner.#MIN_DIFF;\n\n  constructor({ x, y }, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    this.#box = box;\n    this.#thickness = thickness * scaleFactor;\n    this.#isLTR = isLTR;\n    this.#last.set([NaN, NaN, NaN, NaN, x, y], 6);\n    this.#innerMargin = innerMargin;\n    this.#min_dist = FreeDrawOutliner.#MIN_DIST * scaleFactor;\n    this.#min = FreeDrawOutliner.#MIN * scaleFactor;\n    this.#scaleFactor = scaleFactor;\n    this.#points.push(x, y);\n  }\n\n  isEmpty() {\n    // When we add a second point then this.#last.slice(6) will be something\n    // like [NaN, NaN, firstX, firstY, secondX, secondY,...] so having a NaN\n    // at index 8 means that we've only one point.\n    return isNaN(this.#last[8]);\n  }\n\n  #getLastCoords() {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [x, y, width, height] = this.#box;\n\n    return [\n      (this.#lastX + (lastTop[0] - lastBottom[0]) / 2 - x) / width,\n      (this.#lastY + (lastTop[1] - lastBottom[1]) / 2 - y) / height,\n      (this.#lastX + (lastBottom[0] - lastTop[0]) / 2 - x) / width,\n      (this.#lastY + (lastBottom[1] - lastTop[1]) / 2 - y) / height,\n    ];\n  }\n\n  add({ x, y }) {\n    this.#lastX = x;\n    this.#lastY = y;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    let [x1, y1, x2, y2] = this.#last.subarray(8, 12);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(diffX, diffY);\n    if (d < this.#min) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return false;\n    }\n    const diffD = d - this.#min_dist;\n    const K = diffD / d;\n    const shiftX = K * diffX;\n    const shiftY = K * diffY;\n\n    // We update the last 3 points of the line.\n    let x0 = x1;\n    let y0 = y1;\n    x1 = x2;\n    y1 = y2;\n    x2 += shiftX;\n    y2 += shiftY;\n\n    // We keep track of the points in order to be able to compute the focus\n    // outline.\n    this.#points?.push(x, y);\n\n    // Create the normal unit vector.\n    // |(shiftX, shiftY)| = |K| * |(diffX, diffY)| = |K| * d = diffD.\n    const nX = -shiftY / diffD;\n    const nY = shiftX / diffD;\n    const thX = nX * this.#thickness;\n    const thY = nY * this.#thickness;\n    this.#last.set(this.#last.subarray(2, 8), 0);\n    this.#last.set([x2 + thX, y2 + thY], 4);\n    this.#last.set(this.#last.subarray(14, 18), 12);\n    this.#last.set([x2 - thX, y2 - thY], 16);\n\n    if (isNaN(this.#last[6])) {\n      if (this.#top.length === 0) {\n        this.#last.set([x1 + thX, y1 + thY], 2);\n        this.#top.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 + thX - layerX) / layerWidth,\n          (y1 + thY - layerY) / layerHeight\n        );\n        this.#last.set([x1 - thX, y1 - thY], 14);\n        this.#bottom.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 - thX - layerX) / layerWidth,\n          (y1 - thY - layerY) / layerHeight\n        );\n      }\n      this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n      return !this.isEmpty();\n    }\n\n    this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n\n    const angle = Math.abs(\n      Math.atan2(y0 - y1, x0 - x1) - Math.atan2(shiftY, shiftX)\n    );\n    if (angle < Math.PI / 2) {\n      // In order to avoid some possible artifacts, we're going to use the a\n      // straight line instead of a quadratic Bzier curve.\n      [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n      this.#top.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x1 + x2) / 2 - layerX) / layerWidth,\n        ((y1 + y2) / 2 - layerY) / layerHeight\n      );\n      [x1, y1, x0, y0] = this.#last.subarray(14, 18);\n      this.#bottom.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x0 + x1) / 2 - layerX) / layerWidth,\n        ((y0 + y1) / 2 - layerY) / layerHeight\n      );\n      return true;\n    }\n\n    // Control points and the final point for the quadratic Bzier curve.\n    [x0, y0, x1, y1, x2, y2] = this.#last.subarray(0, 6);\n    this.#top.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    [x2, y2, x1, y1, x0, y0] = this.#last.subarray(12, 18);\n    this.#bottom.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    return true;\n  }\n\n  toSVGPath() {\n    if (this.isEmpty()) {\n      // We've only one point.\n      return \"\";\n    }\n    const top = this.#top;\n    const bottom = this.#bottom;\n\n    if (isNaN(this.#last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#toSVGPathTwoPoints();\n    }\n\n    const buffer = [];\n    buffer.push(`M${top[4]} ${top[5]}`);\n    for (let i = 6; i < top.length; i += 6) {\n      if (isNaN(top[i])) {\n        buffer.push(`L${top[i + 4]} ${top[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${top[i]} ${top[i + 1]} ${top[i + 2]} ${top[i + 3]} ${top[i + 4]} ${\n            top[i + 5]\n          }`\n        );\n      }\n    }\n\n    this.#toSVGPathEnd(buffer);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      if (isNaN(bottom[i])) {\n        buffer.push(`L${bottom[i + 4]} ${bottom[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${bottom[i]} ${bottom[i + 1]} ${bottom[i + 2]} ${bottom[i + 3]} ${\n            bottom[i + 4]\n          } ${bottom[i + 5]}`\n        );\n      }\n    }\n\n    this.#toSVGPathStart(buffer);\n\n    return buffer.join(\" \");\n  }\n\n  #toSVGPathTwoPoints() {\n    const [x, y, width, height] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    return `M${(this.#last[2] - x) / width} ${\n      (this.#last[3] - y) / height\n    } L${(this.#last[4] - x) / width} ${(this.#last[5] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n      (this.#last[16] - x) / width\n    } ${(this.#last[17] - y) / height} L${(this.#last[14] - x) / width} ${\n      (this.#last[15] - y) / height\n    } Z`;\n  }\n\n  #toSVGPathStart(buffer) {\n    const bottom = this.#bottom;\n    buffer.push(`L${bottom[4]} ${bottom[5]} Z`);\n  }\n\n  #toSVGPathEnd(buffer) {\n    const [x, y, width, height] = this.#box;\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    buffer.push(\n      `L${(lastTop[0] - x) / width} ${(lastTop[1] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n        (lastBottom[0] - x) / width\n      } ${(lastBottom[1] - y) / height}`\n    );\n  }\n\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeDrawOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n\n  getOutlines() {\n    const top = this.#top;\n    const bottom = this.#bottom;\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n\n    const points = new Float32Array((this.#points?.length ?? 0) + 2);\n    for (let i = 0, ii = points.length - 2; i < ii; i += 2) {\n      points[i] = (this.#points[i] - layerX) / layerWidth;\n      points[i + 1] = (this.#points[i + 1] - layerY) / layerHeight;\n    }\n    points[points.length - 2] = (this.#lastX - layerX) / layerWidth;\n    points[points.length - 1] = (this.#lastY - layerY) / layerHeight;\n\n    if (isNaN(last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#getOutlineTwoPoints(points);\n    }\n\n    const outline = new Float32Array(\n      this.#top.length + 24 + this.#bottom.length\n    );\n    let N = top.length;\n    for (let i = 0; i < N; i += 2) {\n      if (isNaN(top[i])) {\n        outline[i] = outline[i + 1] = NaN;\n        continue;\n      }\n      outline[i] = top[i];\n      outline[i + 1] = top[i + 1];\n    }\n\n    N = this.#getOutlineEnd(outline, N);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      for (let j = 0; j < 6; j += 2) {\n        if (isNaN(bottom[i + j])) {\n          outline[N] = outline[N + 1] = NaN;\n          N += 2;\n          continue;\n        }\n        outline[N] = bottom[i + j];\n        outline[N + 1] = bottom[i + j + 1];\n        N += 2;\n      }\n    }\n\n    this.#getOutlineStart(outline, N);\n\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineTwoPoints(points) {\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    const outline = new Float32Array(36);\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[2] - layerX) / layerWidth,\n        (last[3] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[4] - layerX) / layerWidth,\n        (last[5] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[16] - layerX) / layerWidth,\n        (last[17] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[14] - layerX) / layerWidth,\n        (last[15] - layerY) / layerHeight,\n      ],\n      0\n    );\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineStart(outline, pos) {\n    const bottom = this.#bottom;\n    outline.set([NaN, NaN, NaN, NaN, bottom[4], bottom[5]], pos);\n    return (pos += 6);\n  }\n\n  #getOutlineEnd(outline, pos) {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastTop[0] - layerX) / layerWidth,\n        (lastTop[1] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastBottom[0] - layerX) / layerWidth,\n        (lastBottom[1] - layerY) / layerHeight,\n      ],\n      pos\n    );\n    return (pos += 24);\n  }\n}\n\nclass FreeDrawOutline extends Outline {\n  #box;\n\n  #bbox = new Float32Array(4);\n\n  #innerMargin;\n\n  #isLTR;\n\n  #points;\n\n  #scaleFactor;\n\n  #outline;\n\n  constructor(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    super();\n    this.#outline = outline;\n    this.#points = points;\n    this.#box = box;\n    this.#scaleFactor = scaleFactor;\n    this.#innerMargin = innerMargin;\n    this.#isLTR = isLTR;\n    this.firstPoint = [NaN, NaN];\n    this.lastPoint = [NaN, NaN];\n    this.#computeMinMax(isLTR);\n\n    const [x, y, width, height] = this.#bbox;\n    for (let i = 0, ii = outline.length; i < ii; i += 2) {\n      outline[i] = (outline[i] - x) / width;\n      outline[i + 1] = (outline[i + 1] - y) / height;\n    }\n    for (let i = 0, ii = points.length; i < ii; i += 2) {\n      points[i] = (points[i] - x) / width;\n      points[i + 1] = (points[i + 1] - y) / height;\n    }\n  }\n\n  toSVGPath() {\n    const buffer = [`M${this.#outline[4]} ${this.#outline[5]}`];\n    for (let i = 6, ii = this.#outline.length; i < ii; i += 6) {\n      if (isNaN(this.#outline[i])) {\n        buffer.push(`L${this.#outline[i + 4]} ${this.#outline[i + 5]}`);\n        continue;\n      }\n      buffer.push(\n        `C${this.#outline[i]} ${this.#outline[i + 1]} ${this.#outline[i + 2]} ${\n          this.#outline[i + 3]\n        } ${this.#outline[i + 4]} ${this.#outline[i + 5]}`\n      );\n    }\n    buffer.push(\"Z\");\n    return buffer.join(\" \");\n  }\n\n  serialize([blX, blY, trX, trY], rotation) {\n    const width = trX - blX;\n    const height = trY - blY;\n    let outline;\n    let points;\n    switch (rotation) {\n      case 0:\n        outline = Outline._rescale(this.#outline, blX, trY, width, -height);\n        points = Outline._rescale(this.#points, blX, trY, width, -height);\n        break;\n      case 90:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          blX,\n          blY,\n          width,\n          height\n        );\n        points = Outline._rescaleAndSwap(this.#points, blX, blY, width, height);\n        break;\n      case 180:\n        outline = Outline._rescale(this.#outline, trX, blY, -width, height);\n        points = Outline._rescale(this.#points, trX, blY, -width, height);\n        break;\n      case 270:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        points = Outline._rescaleAndSwap(\n          this.#points,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        break;\n    }\n    return { outline: Array.from(outline), points: [Array.from(points)] };\n  }\n\n  #computeMinMax(isLTR) {\n    const outline = this.#outline;\n    let lastX = outline[4];\n    let lastY = outline[5];\n    const minMax = [lastX, lastY, lastX, lastY];\n    let firstPointX = lastX;\n    let firstPointY = lastY;\n    let lastPointX = lastX;\n    let lastPointY = lastY;\n    const ltrCallback = isLTR ? Math.max : Math.min;\n    const bezierBbox = new Float32Array(4);\n\n    for (let i = 6, ii = outline.length; i < ii; i += 6) {\n      const x = outline[i + 4],\n        y = outline[i + 5];\n\n      if (isNaN(outline[i])) {\n        Util.pointBoundingBox(x, y, minMax);\n\n        if (firstPointY > y) {\n          firstPointX = x;\n          firstPointY = y;\n        } else if (firstPointY === y) {\n          firstPointX = ltrCallback(firstPointX, x);\n        }\n        if (lastPointY < y) {\n          lastPointX = x;\n          lastPointY = y;\n        } else if (lastPointY === y) {\n          lastPointX = ltrCallback(lastPointX, x);\n        }\n      } else {\n        bezierBbox[0] = bezierBbox[1] = Infinity;\n        bezierBbox[2] = bezierBbox[3] = -Infinity;\n        Util.bezierBoundingBox(\n          lastX,\n          lastY,\n          ...outline.slice(i, i + 6),\n          bezierBbox\n        );\n\n        Util.rectBoundingBox(\n          bezierBbox[0],\n          bezierBbox[1],\n          bezierBbox[2],\n          bezierBbox[3],\n          minMax\n        );\n\n        if (firstPointY > bezierBbox[1]) {\n          firstPointX = bezierBbox[0];\n          firstPointY = bezierBbox[1];\n        } else if (firstPointY === bezierBbox[1]) {\n          firstPointX = ltrCallback(firstPointX, bezierBbox[0]);\n        }\n        if (lastPointY < bezierBbox[3]) {\n          lastPointX = bezierBbox[2];\n          lastPointY = bezierBbox[3];\n        } else if (lastPointY === bezierBbox[3]) {\n          lastPointX = ltrCallback(lastPointX, bezierBbox[2]);\n        }\n      }\n      lastX = x;\n      lastY = y;\n    }\n\n    const bbox = this.#bbox;\n    bbox[0] = minMax[0] - this.#innerMargin;\n    bbox[1] = minMax[1] - this.#innerMargin;\n    bbox[2] = minMax[2] - minMax[0] + 2 * this.#innerMargin;\n    bbox[3] = minMax[3] - minMax[1] + 2 * this.#innerMargin;\n    this.firstPoint = [firstPointX, firstPointY];\n    this.lastPoint = [lastPointX, lastPointY];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeDrawOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n\n  getNewOutline(thickness, innerMargin) {\n    // Build the outline of the highlight to use as the focus outline.\n    const [x, y, width, height] = this.#bbox;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const sx = width * layerWidth;\n    const sy = height * layerHeight;\n    const tx = x * layerWidth + layerX;\n    const ty = y * layerHeight + layerY;\n    const outliner = this.newOutliner(\n      {\n        x: this.#points[0] * sx + tx,\n        y: this.#points[1] * sy + ty,\n      },\n      this.#box,\n      this.#scaleFactor,\n      thickness,\n      this.#isLTR,\n      innerMargin ?? this.#innerMargin\n    );\n    for (let i = 2; i < this.#points.length; i += 2) {\n      outliner.add({\n        x: this.#points[i] * sx + tx,\n        y: this.#points[i + 1] * sy + ty,\n      });\n    }\n    return outliner.getOutlines();\n  }\n}\n\nexport { FreeDrawOutline, FreeDrawOutliner };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FreeDrawOutline, FreeDrawOutliner } from \"./freedraw.js\";\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass HighlightOutliner {\n  #box;\n\n  #firstPoint;\n\n  #lastPoint;\n\n  #verticalEdges = [];\n\n  #intervals = [];\n\n  /**\n   * Construct an outliner.\n   * @param {Array<Object>} boxes - An array of axis-aligned rectangles.\n   * @param {number} borderWidth - The width of the border of the boxes, it\n   *   allows to make the boxes bigger (or smaller).\n   * @param {number} innerMargin - The margin between the boxes and the\n   *   outlines. It's important to not have a null innerMargin when we want to\n   *   draw the outline else the stroked outline could be clipped because of its\n   *   width.\n   * @param {boolean} isLTR - true if we're in LTR mode. It's used to determine\n   *   the last point of the boxes.\n   */\n  constructor(boxes, borderWidth = 0, innerMargin = 0, isLTR = true) {\n    const minMax = [Infinity, Infinity, -Infinity, -Infinity];\n\n    // We round the coordinates to slightly reduce the number of edges in the\n    // final outlines.\n    const NUMBER_OF_DIGITS = 4;\n    const EPSILON = 10 ** -NUMBER_OF_DIGITS;\n\n    // The coordinates of the boxes are in the page coordinate system.\n    for (const { x, y, width, height } of boxes) {\n      const x1 = Math.floor((x - borderWidth) / EPSILON) * EPSILON;\n      const x2 = Math.ceil((x + width + borderWidth) / EPSILON) * EPSILON;\n      const y1 = Math.floor((y - borderWidth) / EPSILON) * EPSILON;\n      const y2 = Math.ceil((y + height + borderWidth) / EPSILON) * EPSILON;\n      const left = [x1, y1, y2, true];\n      const right = [x2, y1, y2, false];\n      this.#verticalEdges.push(left, right);\n\n      Util.rectBoundingBox(x1, y1, x2, y2, minMax);\n    }\n\n    const bboxWidth = minMax[2] - minMax[0] + 2 * innerMargin;\n    const bboxHeight = minMax[3] - minMax[1] + 2 * innerMargin;\n    const shiftedMinX = minMax[0] - innerMargin;\n    const shiftedMinY = minMax[1] - innerMargin;\n    let firstPointX = isLTR ? -Infinity : Infinity;\n    let firstPointY = Infinity;\n    const lastEdge = this.#verticalEdges.at(isLTR ? -1 : -2);\n    const lastPoint = [lastEdge[0], lastEdge[2]];\n\n    // Convert the coordinates of the edges into box coordinates.\n    for (const edge of this.#verticalEdges) {\n      const [x, y1, y2, left] = edge;\n      if (!left && isLTR) {\n        if (y1 < firstPointY) {\n          firstPointY = y1;\n          firstPointX = x;\n        } else if (y1 === firstPointY) {\n          firstPointX = Math.max(firstPointX, x);\n        }\n      } else if (left && !isLTR) {\n        if (y1 < firstPointY) {\n          firstPointY = y1;\n          firstPointX = x;\n        } else if (y1 === firstPointY) {\n          firstPointX = Math.min(firstPointX, x);\n        }\n      }\n\n      edge[0] = (x - shiftedMinX) / bboxWidth;\n      edge[1] = (y1 - shiftedMinY) / bboxHeight;\n      edge[2] = (y2 - shiftedMinY) / bboxHeight;\n    }\n\n    this.#box = new Float32Array([\n      shiftedMinX,\n      shiftedMinY,\n      bboxWidth,\n      bboxHeight,\n    ]);\n    this.#firstPoint = [firstPointX, firstPointY];\n    this.#lastPoint = lastPoint;\n  }\n\n  getOutlines() {\n    // We begin to sort lexicographically the vertical edges by their abscissa,\n    // and then by their ordinate.\n    this.#verticalEdges.sort(\n      (a, b) => a[0] - b[0] || a[1] - b[1] || a[2] - b[2]\n    );\n\n    // We're now using a sweep line algorithm to find the outlines.\n    // We start with the leftmost vertical edge, and we're going to iterate\n    // over all the vertical edges from left to right.\n    // Each time we encounter a left edge, we're going to insert the interval\n    // [y1, y2] in the set of intervals.\n    // This set of intervals is used to break the vertical edges into chunks:\n    // we only take the part of the vertical edge that isn't in the union of\n    // the intervals.\n    const outlineVerticalEdges = [];\n    for (const edge of this.#verticalEdges) {\n      if (edge[3]) {\n        // Left edge.\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n        this.#insert(edge);\n      } else {\n        // Right edge.\n        this.#remove(edge);\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n      }\n    }\n    return this.#getOutlines(outlineVerticalEdges);\n  }\n\n  #getOutlines(outlineVerticalEdges) {\n    const edges = [];\n    const allEdges = new Set();\n\n    for (const edge of outlineVerticalEdges) {\n      const [x, y1, y2] = edge;\n      edges.push([x, y1, edge], [x, y2, edge]);\n    }\n\n    // We sort lexicographically the vertices of each edge by their ordinate and\n    // by their abscissa.\n    // Every pair (v_2i, v_{2i + 1}) of vertices defines a horizontal edge.\n    // So for every vertical edge, we're going to add the two vertical edges\n    // which are connected to it through a horizontal edge.\n    edges.sort((a, b) => a[1] - b[1] || a[0] - b[0]);\n    for (let i = 0, ii = edges.length; i < ii; i += 2) {\n      const edge1 = edges[i][2];\n      const edge2 = edges[i + 1][2];\n      edge1.push(edge2);\n      edge2.push(edge1);\n      allEdges.add(edge1);\n      allEdges.add(edge2);\n    }\n    const outlines = [];\n    let outline;\n\n    while (allEdges.size > 0) {\n      const edge = allEdges.values().next().value;\n      let [x, y1, y2, edge1, edge2] = edge;\n      allEdges.delete(edge);\n      let lastPointX = x;\n      let lastPointY = y1;\n\n      outline = [x, y2];\n      outlines.push(outline);\n\n      while (true) {\n        let e;\n        if (allEdges.has(edge1)) {\n          e = edge1;\n        } else if (allEdges.has(edge2)) {\n          e = edge2;\n        } else {\n          break;\n        }\n\n        allEdges.delete(e);\n        [x, y1, y2, edge1, edge2] = e;\n\n        if (lastPointX !== x) {\n          outline.push(lastPointX, lastPointY, x, lastPointY === y1 ? y1 : y2);\n          lastPointX = x;\n        }\n        lastPointY = lastPointY === y1 ? y2 : y1;\n      }\n      outline.push(lastPointX, lastPointY);\n    }\n    return new HighlightOutline(\n      outlines,\n      this.#box,\n      this.#firstPoint,\n      this.#lastPoint\n    );\n  }\n\n  #binarySearch(y) {\n    const array = this.#intervals;\n    let start = 0;\n    let end = array.length - 1;\n\n    while (start <= end) {\n      const middle = (start + end) >> 1;\n      const y1 = array[middle][0];\n      if (y1 === y) {\n        return middle;\n      }\n      if (y1 < y) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n    return end + 1;\n  }\n\n  #insert([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    this.#intervals.splice(index, 0, [y1, y2]);\n  }\n\n  #remove([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    for (let i = index; i < this.#intervals.length; i++) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n    for (let i = index - 1; i >= 0; i--) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  #breakEdge(edge) {\n    const [x, y1, y2] = edge;\n    const results = [[x, y1, y2]];\n    const index = this.#binarySearch(y2);\n    for (let i = 0; i < index; i++) {\n      const [start, end] = this.#intervals[i];\n      for (let j = 0, jj = results.length; j < jj; j++) {\n        const [, y3, y4] = results[j];\n        if (end <= y3 || y4 <= start) {\n          // There is no intersection between the interval and the edge, hence\n          // we keep it as is.\n          continue;\n        }\n        if (y3 >= start) {\n          if (y4 > end) {\n            results[j][1] = end;\n          } else {\n            if (jj === 1) {\n              return [];\n            }\n            // The edge is included in the interval, hence we remove it.\n            results.splice(j, 1);\n            j--;\n            jj--;\n          }\n          continue;\n        }\n        results[j][2] = start;\n        if (y4 > end) {\n          results.push([x, end, y4]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nclass HighlightOutline extends Outline {\n  #box;\n\n  #outlines;\n\n  constructor(outlines, box, firstPoint, lastPoint) {\n    super();\n    this.#outlines = outlines;\n    this.#box = box;\n    this.firstPoint = firstPoint;\n    this.lastPoint = lastPoint;\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const polygon of this.#outlines) {\n      let [prevX, prevY] = polygon;\n      buffer.push(`M${prevX} ${prevY}`);\n      for (let i = 2; i < polygon.length; i += 2) {\n        const x = polygon[i];\n        const y = polygon[i + 1];\n        if (x === prevX) {\n          buffer.push(`V${y}`);\n          prevY = y;\n        } else if (y === prevY) {\n          buffer.push(`H${x}`);\n          prevX = x;\n        }\n      }\n      buffer.push(\"Z\");\n    }\n    return buffer.join(\" \");\n  }\n\n  /**\n   * Serialize the outlines into the PDF page coordinate system.\n   * @param {Array<number>} _bbox - the bounding box of the annotation.\n   * @param {number} _rotation - the rotation of the annotation.\n   * @returns {Array<Array<number>>}\n   */\n  serialize([blX, blY, trX, trY], _rotation) {\n    const outlines = [];\n    const width = trX - blX;\n    const height = trY - blY;\n    for (const outline of this.#outlines) {\n      const points = new Array(outline.length);\n      for (let i = 0; i < outline.length; i += 2) {\n        points[i] = blX + outline[i] * width;\n        points[i + 1] = trY - outline[i + 1] * height;\n      }\n      outlines.push(points);\n    }\n    return outlines;\n  }\n\n  get box() {\n    return this.#box;\n  }\n\n  get classNamesForOutlining() {\n    return [\"highlightOutline\"];\n  }\n}\n\nclass FreeHighlightOutliner extends FreeDrawOutliner {\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeHighlightOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n}\n\nclass FreeHighlightOutline extends FreeDrawOutline {\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeHighlightOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n}\n\nexport { FreeHighlightOutliner, HighlightOutliner };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { bindEvents, KeyboardManager } from \"./tools.js\";\nimport {\n  FreeHighlightOutliner,\n  HighlightOutliner,\n} from \"./drawers/highlight.js\";\nimport {\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n} from \"../annotation_layer.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ColorPicker } from \"./color_picker.js\";\n\n/**\n * Basic draw editor in order to generate an Highlight annotation.\n */\nclass HighlightEditor extends AnnotationEditor {\n  #anchorNode = null;\n\n  #anchorOffset = 0;\n\n  #boxes;\n\n  #clipPathId = null;\n\n  #colorPicker = null;\n\n  #focusOutlines = null;\n\n  #focusNode = null;\n\n  #focusOffset = 0;\n\n  #highlightDiv = null;\n\n  #highlightOutlines = null;\n\n  #id = null;\n\n  #isFreeHighlight = false;\n\n  #firstPoint = null;\n\n  #lastPoint = null;\n\n  #outlineId = null;\n\n  #text = \"\";\n\n  #thickness;\n\n  #methodOfCreation = \"\";\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 12;\n\n  static _type = \"highlight\";\n\n  static _editorType = AnnotationEditorType.HIGHLIGHT;\n\n  static _freeHighlightId = -1;\n\n  static _freeHighlight = null;\n\n  static _freeHighlightClipId = \"\";\n\n  static get _keyboardManager() {\n    const proto = HighlightEditor.prototype;\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], proto._moveCaret, { args: [0] }],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], proto._moveCaret, { args: [1] }],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], proto._moveCaret, { args: [2] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], proto._moveCaret, { args: [3] }],\n      ])\n    );\n  }\n\n  constructor(params) {\n    super({ ...params, name: \"highlightEditor\" });\n    this.color = params.color || HighlightEditor._defaultColor;\n    this.#thickness = params.thickness || HighlightEditor._defaultThickness;\n    this.opacity = params.opacity || HighlightEditor._defaultOpacity;\n    this.#boxes = params.boxes || null;\n    this.#methodOfCreation = params.methodOfCreation || \"\";\n    this.#text = params.text || \"\";\n    this._isDraggable = false;\n    this.defaultL10nId = \"pdfjs-editor-highlight-editor\";\n\n    if (params.highlightId > -1) {\n      this.#isFreeHighlight = true;\n      this.#createFreeOutlines(params);\n      this.#addToDrawLayer();\n    } else if (this.#boxes) {\n      this.#anchorNode = params.anchorNode;\n      this.#anchorOffset = params.anchorOffset;\n      this.#focusNode = params.focusNode;\n      this.#focusOffset = params.focusOffset;\n      this.#createOutlines();\n      this.#addToDrawLayer();\n      this.rotate(this.rotation);\n    }\n\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-highlight-added-alert\");\n    }\n  }\n\n  /** @inheritdoc */\n  get telemetryInitialData() {\n    return {\n      action: \"added\",\n      type: this.#isFreeHighlight ? \"free_highlight\" : \"highlight\",\n      color: this._uiManager.getNonHCMColorName(this.color),\n      thickness: this.#thickness,\n      methodOfCreation: this.#methodOfCreation,\n    };\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"highlight\",\n      color: this._uiManager.getNonHCMColorName(this.color),\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    // We want to know how many colors have been used.\n    return { numberOfColors: data.get(\"color\").size };\n  }\n\n  #createOutlines() {\n    const outliner = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.001\n    );\n    this.#highlightOutlines = outliner.getOutlines();\n    [this.x, this.y, this.width, this.height] = this.#highlightOutlines.box;\n\n    const outlinerForOutline = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.0025,\n      /* innerMargin = */ 0.001,\n      this._uiManager.direction === \"ltr\"\n    );\n    this.#focusOutlines = outlinerForOutline.getOutlines();\n\n    const { firstPoint } = this.#highlightOutlines;\n    this.#firstPoint = [\n      (firstPoint[0] - this.x) / this.width,\n      (firstPoint[1] - this.y) / this.height,\n    ];\n    // The last point is in the pages coordinate system.\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [\n      (lastPoint[0] - this.x) / this.width,\n      (lastPoint[1] - this.y) / this.height,\n    ];\n  }\n\n  #createFreeOutlines({ highlightOutlines, highlightId, clipPathId }) {\n    this.#highlightOutlines = highlightOutlines;\n    const extraThickness = 1.5;\n    this.#focusOutlines = highlightOutlines.getNewOutline(\n      /* Slightly bigger than the highlight in order to have a little\n         space between the highlight and the outline. */\n      this.#thickness / 2 + extraThickness,\n      /* innerMargin = */ 0.0025\n    );\n\n    if (highlightId >= 0) {\n      this.#id = highlightId;\n      this.#clipPathId = clipPathId;\n      // We need to redraw the highlight because we change the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(highlightId, {\n        bbox: highlightOutlines.box,\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.#outlineId = this.parent.drawLayer.drawOutline(\n        {\n          rootClass: {\n            highlightOutline: true,\n            free: true,\n          },\n          bbox: this.#focusOutlines.box,\n          path: {\n            d: this.#focusOutlines.toSVGPath(),\n          },\n        },\n        /* mustRemoveSelfIntersections = */ true\n      );\n    } else if (this.parent) {\n      const angle = this.parent.viewport.rotation;\n      this.parent.drawLayer.updateProperties(this.#id, {\n        bbox: HighlightEditor.#rotateBbox(\n          this.#highlightOutlines.box,\n          (angle - this.rotation + 360) % 360\n        ),\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      });\n    }\n    const [x, y, width, height] = highlightOutlines.box;\n    switch (this.rotation) {\n      case 0:\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 90: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = y;\n        this.y = 1 - x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n      case 180:\n        this.x = 1 - x;\n        this.y = 1 - y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 270: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = 1 - y;\n        this.y = x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n    }\n\n    const { firstPoint } = highlightOutlines;\n    this.#firstPoint = [\n      (firstPoint[0] - x) / width,\n      (firstPoint[1] - y) / height,\n    ];\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [(lastPoint[0] - x) / width, (lastPoint[1] - y) / height];\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    HighlightEditor._defaultColor ||=\n      uiManager.highlightColors?.values().next().value || \"#fff066\";\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        HighlightEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        HighlightEditor._defaultThickness = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  translateInPage(x, y) {}\n\n  /** @inheritdoc */\n  get toolbarPosition() {\n    return this.#lastPoint;\n  }\n\n  /** @inheritdoc */\n  get commentButtonPosition() {\n    return this.#firstPoint;\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        this.#updateThickness(value);\n        break;\n    }\n  }\n\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        HighlightEditor._defaultThickness,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        this.color || HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        this.#thickness || HighlightEditor._defaultThickness,\n      ],\n      [AnnotationEditorParamsType.HIGHLIGHT_FREE, this.#isFreeHighlight],\n    ];\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this.parent?.drawLayer.updateProperties(this.#id, {\n      root: {\n        fill: this.color,\n        \"fill-opacity\": this.opacity,\n      },\n    });\n    this.#colorPicker?.updateColor(this.color);\n    super.onUpdatedColor();\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColorAndOpacity = (col, opa) => {\n      this.color = col;\n      this.opacity = opa;\n      this.onUpdatedColor();\n    };\n    const savedColor = this.color;\n    const savedOpacity = this.opacity;\n    this.addCommands({\n      cmd: setColorAndOpacity.bind(\n        this,\n        color,\n        HighlightEditor._defaultOpacity\n      ),\n      undo: setColorAndOpacity.bind(this, savedColor, savedOpacity),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n\n    this._reportTelemetry(\n      {\n        action: \"color_changed\",\n        color: this._uiManager.getNonHCMColorName(color),\n      },\n      /* mustWait = */ true\n    );\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const savedThickness = this.#thickness;\n    const setThickness = th => {\n      this.#thickness = th;\n      this.#changeThickness(th);\n    };\n    this.addCommands({\n      cmd: setThickness.bind(this, thickness),\n      undo: setThickness.bind(this, savedThickness),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n    this._reportTelemetry(\n      { action: \"thickness_changed\", thickness },\n      /* mustWait = */ true\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.highlightColors) {\n      const colorPicker = (this.#colorPicker = new ColorPicker({\n        editor: this,\n      }));\n      return [[\"colorPicker\", colorPicker]];\n    }\n    return super.toolbarButtons;\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  fixAndSetPosition() {\n    return super.fixAndSetPosition(this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  getRect(tx, ty) {\n    return super.getRect(tx, ty, this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    this._reportTelemetry({\n      action: \"deleted\",\n    });\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    this.show(this._isVisible);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #changeThickness(thickness) {\n    if (!this.#isFreeHighlight) {\n      return;\n    }\n    this.#createFreeOutlines({\n      highlightOutlines: this.#highlightOutlines.getNewOutline(thickness / 2),\n    });\n    this.fixAndSetPosition();\n    this.setDims();\n  }\n\n  #cleanDrawLayer() {\n    if (this.#id === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this.#id);\n    this.#id = null;\n    this.parent.drawLayer.remove(this.#outlineId);\n    this.#outlineId = null;\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this.#id !== null) {\n      return;\n    }\n    ({ id: this.#id, clipPathId: this.#clipPathId } = parent.drawLayer.draw(\n      {\n        bbox: this.#highlightOutlines.box,\n        root: {\n          viewBox: \"0 0 1 1\",\n          fill: this.color,\n          \"fill-opacity\": this.opacity,\n        },\n        rootClass: {\n          highlight: true,\n          free: this.#isFreeHighlight,\n        },\n        path: {\n          d: this.#highlightOutlines.toSVGPath(),\n        },\n      },\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ true\n    ));\n    this.#outlineId = parent.drawLayer.drawOutline(\n      {\n        rootClass: {\n          highlightOutline: true,\n          free: this.#isFreeHighlight,\n        },\n        bbox: this.#focusOutlines.box,\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      },\n      /* mustRemoveSelfIntersections = */ this.#isFreeHighlight\n    );\n\n    if (this.#highlightDiv) {\n      this.#highlightDiv.style.clipPath = this.#clipPathId;\n    }\n  }\n\n  static #rotateBbox([x, y, width, height], angle) {\n    switch (angle) {\n      case 90:\n        return [1 - y - height, x, height, width];\n      case 180:\n        return [1 - x - width, 1 - y - height, width, height];\n      case 270:\n        return [y, 1 - x - width, height, width];\n    }\n    return [x, y, width, height];\n  }\n\n  /** @inheritdoc */\n  rotate(angle) {\n    // We need to rotate the svgs because of the coordinates system.\n    const { drawLayer } = this.parent;\n    let box;\n    if (this.#isFreeHighlight) {\n      angle = (angle - this.rotation + 360) % 360;\n      box = HighlightEditor.#rotateBbox(this.#highlightOutlines.box, angle);\n    } else {\n      // An highlight annotation is always drawn horizontally.\n      box = HighlightEditor.#rotateBbox(\n        [this.x, this.y, this.width, this.height],\n        angle\n      );\n    }\n    drawLayer.updateProperties(this.#id, {\n      bbox: box,\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n    drawLayer.updateProperties(this.#outlineId, {\n      bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    const div = super.render();\n    if (this.#text) {\n      div.setAttribute(\"aria-label\", this.#text);\n      div.setAttribute(\"role\", \"mark\");\n    }\n    if (this.#isFreeHighlight) {\n      div.classList.add(\"free\");\n    } else {\n      this.div.addEventListener(\"keydown\", this.#keydown.bind(this), {\n        signal: this._uiManager._signal,\n      });\n    }\n    const highlightDiv = (this.#highlightDiv = document.createElement(\"div\"));\n    div.append(highlightDiv);\n    highlightDiv.setAttribute(\"aria-hidden\", \"true\");\n    highlightDiv.className = \"internal\";\n    highlightDiv.style.clipPath = this.#clipPathId;\n    this.setDims();\n\n    bindEvents(this, this.#highlightDiv, [\"pointerover\", \"pointerleave\"]);\n    this.enableEditing();\n\n    return div;\n  }\n\n  pointerover() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: true,\n        },\n      });\n    }\n  }\n\n  pointerleave() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: false,\n        },\n      });\n    }\n  }\n\n  #keydown(event) {\n    HighlightEditor._keyboardManager.exec(this, event);\n  }\n\n  _moveCaret(direction) {\n    this.parent.unselect(this);\n    switch (direction) {\n      case 0 /* left */:\n      case 2 /* up */:\n        this.#setCaret(/* start = */ true);\n        break;\n      case 1 /* right */:\n      case 3 /* down */:\n        this.#setCaret(/* start = */ false);\n        break;\n    }\n  }\n\n  #setCaret(start) {\n    if (!this.#anchorNode) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (start) {\n      selection.setPosition(this.#anchorNode, this.#anchorOffset);\n    } else {\n      selection.setPosition(this.#focusNode, this.#focusOffset);\n    }\n  }\n\n  /** @inheritdoc */\n  select() {\n    super.select();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        hovered: false,\n        selected: true,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  unselect() {\n    super.unselect();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        selected: false,\n      },\n    });\n    if (!this.#isFreeHighlight) {\n      this.#setCaret(/* start = */ false);\n    }\n  }\n\n  /** @inheritdoc */\n  get _mustFixPosition() {\n    return !this.#isFreeHighlight;\n  }\n\n  /** @inheritdoc */\n  show(visible = this._isVisible) {\n    super.show(visible);\n    if (this.parent) {\n      this.parent.drawLayer.updateProperties(this.#id, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n    }\n  }\n\n  #getRotation() {\n    // Highlight annotations are always drawn horizontally but if\n    // a free highlight annotation can be rotated.\n    return this.#isFreeHighlight ? this.rotation : 0;\n  }\n\n  #serializeBoxes() {\n    if (this.#isFreeHighlight) {\n      return null;\n    }\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const boxes = this.#boxes;\n    const quadPoints = new Float32Array(boxes.length * 8);\n    let i = 0;\n    for (const { x, y, width, height } of boxes) {\n      const sx = x * pageWidth + pageX;\n      const sy = (1 - y) * pageHeight + pageY;\n      // Serializes the rectangle in the Adobe Acrobat format.\n      // The rectangle's coordinates (b = bottom, t = top, L = left, R = right)\n      // are ordered as follows: tL, tR, bL, bR (bL origin).\n      quadPoints[i] = quadPoints[i + 4] = sx;\n      quadPoints[i + 1] = quadPoints[i + 3] = sy;\n      quadPoints[i + 2] = quadPoints[i + 6] = sx + width * pageWidth;\n      quadPoints[i + 5] = quadPoints[i + 7] = sy - height * pageHeight;\n      i += 8;\n    }\n    return quadPoints;\n  }\n\n  #serializeOutlines(rect) {\n    return this.#highlightOutlines.serialize(rect, this.#getRotation());\n  }\n\n  static startHighlighting(parent, isLTR, { target: textLayer, x, y }) {\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    const ac = new AbortController();\n    const signal = parent.combinedSignal(ac);\n\n    const pointerUpCallback = e => {\n      ac.abort();\n      this.#endHighlight(parent, e);\n    };\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    window.addEventListener(\n      \"pointerdown\",\n      stopEvent /* Avoid to have undesired clicks during the drawing. */,\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n\n    textLayer.addEventListener(\n      \"pointermove\",\n      this.#highlightMove.bind(this, parent),\n      { signal }\n    );\n    this._freeHighlight = new FreeHighlightOutliner(\n      { x, y },\n      [layerX, layerY, parentWidth, parentHeight],\n      parent.scale,\n      this._defaultThickness / 2,\n      isLTR,\n      /* innerMargin = */ 0.001\n    );\n    ({ id: this._freeHighlightId, clipPathId: this._freeHighlightClipId } =\n      parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: this._defaultColor,\n            \"fill-opacity\": this._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: this._freeHighlight.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      ));\n  }\n\n  static #highlightMove(parent, event) {\n    if (this._freeHighlight.add(event)) {\n      // Redraw only if the point has been added.\n      parent.drawLayer.updateProperties(this._freeHighlightId, {\n        path: {\n          d: this._freeHighlight.toSVGPath(),\n        },\n      });\n    }\n  }\n\n  static #endHighlight(parent, event) {\n    if (!this._freeHighlight.isEmpty()) {\n      parent.createAndAddNewEditor(event, false, {\n        highlightId: this._freeHighlightId,\n        highlightOutlines: this._freeHighlight.getOutlines(),\n        clipPathId: this._freeHighlightClipId,\n        methodOfCreation: \"main_toolbar\",\n      });\n    } else {\n      parent.drawLayer.remove(this._freeHighlightId);\n    }\n    this._freeHighlightId = -1;\n    this._freeHighlight = null;\n    this._freeHighlightClipId = \"\";\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof HighlightAnnotationElement) {\n      const {\n        data: {\n          quadPoints,\n          rect,\n          rotation,\n          id,\n          color,\n          opacity,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        opacity,\n        quadPoints,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    } else if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        thickness,\n        inkLists,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n\n    const { color, quadPoints, inkLists, opacity } = data;\n    const editor = await super.deserialize(data, parent, uiManager);\n\n    editor.color = Util.makeHexColor(...color);\n    editor.opacity = opacity || 1;\n    if (inkLists) {\n      editor.#thickness = data.thickness;\n    }\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [pageX, pageY] = editor.pageTranslation;\n\n    if (quadPoints) {\n      const boxes = (editor.#boxes = []);\n      for (let i = 0; i < quadPoints.length; i += 8) {\n        boxes.push({\n          x: (quadPoints[i] - pageX) / pageWidth,\n          y: 1 - (quadPoints[i + 1] - pageY) / pageHeight,\n          width: (quadPoints[i + 2] - quadPoints[i]) / pageWidth,\n          height: (quadPoints[i + 1] - quadPoints[i + 5]) / pageHeight,\n        });\n      }\n      editor.#createOutlines();\n      editor.#addToDrawLayer();\n      editor.rotate(editor.rotation);\n    } else if (inkLists) {\n      editor.#isFreeHighlight = true;\n      const points = inkLists[0];\n      const point = {\n        x: points[0] - pageX,\n        y: pageHeight - (points[1] - pageY),\n      };\n      const outliner = new FreeHighlightOutliner(\n        point,\n        [0, 0, pageWidth, pageHeight],\n        1,\n        editor.#thickness / 2,\n        true,\n        0.001\n      );\n      for (let i = 0, ii = points.length; i < ii; i += 2) {\n        point.x = points[i] - pageX;\n        point.y = pageHeight - (points[i + 1] - pageY);\n        outliner.add(point);\n      }\n      const { id, clipPathId } = parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: editor.color,\n            \"fill-opacity\": editor._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: outliner.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      );\n      editor.#createFreeOutlines({\n        highlightOutlines: outliner.getOutlines(),\n        highlightId: id,\n        clipPathId,\n      });\n      editor.#addToDrawLayer();\n      editor.rotate(editor.parentRotation);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    // It doesn't make sense to copy/paste a highlight annotation.\n    if (this.isEmpty() || isForCopying) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const color = AnnotationEditor._colorManager.convert(\n      this._uiManager.getNonHCMColor(this.color)\n    );\n    const serialized = super.serialize(isForCopying);\n    Object.assign(serialized, {\n      color,\n      opacity: this.opacity,\n      thickness: this.#thickness,\n      quadPoints: this.#serializeBoxes(),\n      outlines: this.#serializeOutlines(serialized.rect),\n    });\n    this.addComment(serialized);\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color } = this._initialData;\n    return (\n      this.hasEditedComment || serialized.color.some((c, i) => c !== color[i])\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup: this.comment,\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { HighlightEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, unreachable } from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { CurrentPointers } from \"./tools.js\";\n\nclass DrawingOptions {\n  #svgProperties = Object.create(null);\n\n  updateProperty(name, value) {\n    this[name] = value;\n    this.updateSVGProperty(name, value);\n  }\n\n  updateProperties(properties) {\n    if (!properties) {\n      return;\n    }\n    for (const [name, value] of Object.entries(properties)) {\n      if (!name.startsWith(\"_\")) {\n        this.updateProperty(name, value);\n      }\n    }\n  }\n\n  updateSVGProperty(name, value) {\n    this.#svgProperties[name] = value;\n  }\n\n  toSVGProperties() {\n    const root = this.#svgProperties;\n    this.#svgProperties = Object.create(null);\n    return { root };\n  }\n\n  reset() {\n    this.#svgProperties = Object.create(null);\n  }\n\n  updateAll(options = this) {\n    this.updateProperties(options);\n  }\n\n  clone() {\n    unreachable(\"Not implemented\");\n  }\n}\n\n/**\n * Basic draw editor.\n */\nclass DrawingEditor extends AnnotationEditor {\n  #drawOutlines = null;\n\n  #mustBeCommitted;\n\n  _colorPicker = null;\n\n  _drawId = null;\n\n  static _currentDrawId = -1;\n\n  static _currentParent = null;\n\n  static #currentDraw = null;\n\n  static #currentDrawingAC = null;\n\n  static #currentDrawingOptions = null;\n\n  static _INNER_MARGIN = 3;\n\n  constructor(params) {\n    super(params);\n    this.#mustBeCommitted = params.mustBeCommitted || false;\n\n    this._addOutlines(params);\n  }\n\n  /** @inheritdoc */\n  onUpdatedColor() {\n    this._colorPicker?.update(this.color);\n    super.onUpdatedColor();\n  }\n\n  _addOutlines(params) {\n    if (params.drawOutlines) {\n      this.#createDrawOutlines(params);\n      this.#addToDrawLayer();\n    }\n  }\n\n  #createDrawOutlines({ drawOutlines, drawId, drawingOptions }) {\n    this.#drawOutlines = drawOutlines;\n    this._drawingOptions ||= drawingOptions;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`);\n    }\n\n    if (drawId >= 0) {\n      this._drawId = drawId;\n      // We need to redraw the drawing because we changed the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(\n        drawId,\n        drawOutlines.defaultProperties\n      );\n    } else {\n      // We create a new drawing.\n      this._drawId = this.#createDrawing(drawOutlines, this.parent);\n    }\n\n    this.#updateBbox(drawOutlines.box);\n  }\n\n  #createDrawing(drawOutlines, parent) {\n    const { id } = parent.drawLayer.draw(\n      DrawingEditor._mergeSVGProperties(\n        this._drawingOptions.toSVGProperties(),\n        drawOutlines.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ false\n    );\n    return id;\n  }\n\n  static _mergeSVGProperties(p1, p2) {\n    const p1Keys = new Set(Object.keys(p1));\n\n    for (const [key, value] of Object.entries(p2)) {\n      if (p1Keys.has(key)) {\n        Object.assign(p1[key], value);\n      } else {\n        p1[key] = value;\n      }\n    }\n    return p1;\n  }\n\n  /**\n   * @param {Object} options\n   * @return {DrawingOptions} the default options to use for a new editor.\n   */\n  static getDefaultDrawingOptions(_options) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * @return {Map<AnnotationEditorParamsType, string>} a map between the\n   *   parameter types and the name of the options.\n   */\n  // eslint-disable-next-line getter-return\n  static get typesMap() {\n    unreachable(\"Not implemented\");\n  }\n\n  static get isDrawer() {\n    return true;\n  }\n\n  /**\n   * @returns {boolean} `true` if several drawings can be added to the\n   * annotation.\n   */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    const propertyName = this.typesMap.get(type);\n    if (propertyName) {\n      this._defaultDrawingOptions.updateProperty(propertyName, value);\n    }\n    if (this._currentParent) {\n      DrawingEditor.#currentDraw.updateProperty(propertyName, value);\n      this._currentParent.drawLayer.updateProperties(\n        this._currentDrawId,\n        this._defaultDrawingOptions.toSVGProperties()\n      );\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    const propertyName = this.constructor.typesMap.get(type);\n    if (propertyName) {\n      this._updateProperty(type, propertyName, value);\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    const properties = [];\n    const options = this._defaultDrawingOptions;\n    for (const [type, name] of this.typesMap) {\n      properties.push([type, options[name]]);\n    }\n    return properties;\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    const properties = [];\n    const { _drawingOptions } = this;\n    for (const [type, name] of this.constructor.typesMap) {\n      properties.push([type, _drawingOptions[name]]);\n    }\n    return properties;\n  }\n\n  /**\n   * Update a property and make this action undoable.\n   * @param {string} color\n   */\n  _updateProperty(type, name, value) {\n    const options = this._drawingOptions;\n    const savedValue = options[name];\n    const setter = val => {\n      options.updateProperty(name, val);\n      const bbox = this.#drawOutlines.updateProperty(name, val);\n      if (bbox) {\n        this.#updateBbox(bbox);\n      }\n      this.parent?.drawLayer.updateProperties(\n        this._drawId,\n        options.toSVGProperties()\n      );\n      if (type === this.colorType) {\n        this.onUpdatedColor();\n      }\n    };\n    this.addCommands({\n      cmd: setter.bind(this, value),\n      undo: setter.bind(this, savedValue),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  _onResizing() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizingSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizedSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onTranslating(_x, _y) {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      bbox: this.#rotateBox(),\n    });\n  }\n\n  /** @inheritdoc */\n  _onTranslated() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathTranslatedSVGProperties(\n          this.#convertToDrawSpace(),\n          this.parentDimensions\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  _onStartDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: true,\n      },\n    });\n  }\n\n  _onStopDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: false,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  commit() {\n    super.commit();\n\n    this.disableEditMode();\n    this.disableEditing();\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    this._isDraggable = true;\n    if (this.#mustBeCommitted) {\n      this.#mustBeCommitted = false;\n      this.commit();\n      this.parent.setSelected(this);\n      if (focus && this.isOnScreen) {\n        this.div.focus();\n      }\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n    this.#updateBbox(this.#drawOutlines.box);\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this._uiManager.removeShouldRescale(this);\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this._uiManager.addShouldRescale(this);\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #cleanDrawLayer() {\n    if (this._drawId === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this._drawId);\n    this._drawId = null;\n\n    // All the SVG properties must be reset in order to make it possible to\n    // undo.\n    this._drawingOptions.reset();\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this._drawId !== null && this.parent === parent) {\n      return;\n    }\n    if (this._drawId !== null) {\n      // The parent has changed, we need to move the drawing to the new parent.\n      this.parent.drawLayer.updateParent(this._drawId, parent.drawLayer);\n      return;\n    }\n    this._drawingOptions.updateAll();\n    this._drawId = this.#createDrawing(this.#drawOutlines, parent);\n  }\n\n  #convertToParentSpace([x, y, width, height]) {\n    const {\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [y, 1 - x, width * (pH / pW), height * (pW / pH)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [1 - y, x, width * (pH / pW), height * (pW / pH)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #convertToDrawSpace() {\n    const {\n      x,\n      y,\n      width,\n      height,\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #updateBbox(bbox) {\n    [this.x, this.y, this.width, this.height] =\n      this.#convertToParentSpace(bbox);\n    if (this.div) {\n      this.fixAndSetPosition();\n      this.setDims();\n    }\n    this._onResized();\n  }\n\n  #rotateBox() {\n    // We've to deal with two rotations: the rotation of the annotation and the\n    // rotation of the parent page.\n    // When the page is rotated, all the layers are just rotated thanks to CSS\n    // but there is a notable exception: the canvas wrapper.\n    // The canvas wrapper is not rotated but the dimensions are (or not) swapped\n    // and the page is redrawn with the rotation applied to the canvas.\n    // The drawn layer is under the canvas wrapper and is not rotated so we have\n    // to \"manually\" rotate the coordinates.\n    //\n    // The coordinates (this.x, this.y) correspond to the top-left corner of\n    // the editor after it has been rotated in the page coordinate system.\n\n    const {\n      x,\n      y,\n      width,\n      height,\n      rotation,\n      parentRotation,\n      parentDimensions: [pW, pH],\n    } = this;\n    switch ((rotation * 4 + parentRotation) / 90) {\n      case 1:\n        // 0 -> 90\n        return [1 - y - height, x, height, width];\n      case 2:\n        // 0 -> 180\n        return [1 - x - width, 1 - y - height, width, height];\n      case 3:\n        // 0 -> 270\n        return [y, 1 - x - width, height, width];\n      case 4:\n        // 90 -> 0\n        return [\n          x,\n          y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 5:\n        // 90 -> 90\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 6:\n        // 90 -> 180\n        return [\n          1 - x - height * (pH / pW),\n          1 - y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 7:\n        // 90 -> 270\n        return [\n          y - width * (pW / pH),\n          1 - x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 8:\n        // 180 -> 0\n        return [x - width, y - height, width, height];\n      case 9:\n        // 180 -> 90\n        return [1 - y, x - width, height, width];\n      case 10:\n        // 180 -> 180\n        return [1 - x, 1 - y, width, height];\n      case 11:\n        // 180 -> 270\n        return [y - height, 1 - x, height, width];\n      case 12:\n        // 270 -> 0\n        return [\n          x - height * (pH / pW),\n          y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 13:\n        // 270 -> 90\n        return [\n          1 - y - width * (pW / pH),\n          x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 14:\n        // 270 -> 180\n        return [\n          1 - x,\n          1 - y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 15:\n        // 270 -> 270\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        // 0 -> 0\n        return [x, y, width, height];\n    }\n  }\n\n  /** @inheritdoc */\n  rotate() {\n    if (!this.parent) {\n      return;\n    }\n    this.parent.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        {\n          bbox: this.#rotateBox(),\n        },\n        this.#drawOutlines.updateRotation(\n          (this.parentRotation - this.rotation + 360) % 360\n        )\n      )\n    );\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    this.#updateBbox(\n      this.#drawOutlines.updateParentDimensions(\n        this.parentDimensions,\n        this.parent.scale\n      )\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {}\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    const div = super.render();\n    div.classList.add(\"draw\");\n\n    const drawDiv = document.createElement(\"div\");\n    div.append(drawDiv);\n    drawDiv.setAttribute(\"aria-hidden\", \"true\");\n    drawDiv.className = \"internal\";\n    this.setDims();\n    this._uiManager.addShouldRescale(this);\n    this.disableEditing();\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return div;\n  }\n\n  /**\n   * Create a new drawer instance.\n   * @param {number} x - The x coordinate of the event.\n   * @param {number} y - The y coordinate of the event.\n   * @param {number} parentWidth - The parent width.\n   * @param {number} parentHeight - The parent height.\n   * @param {number} rotation - The parent rotation.\n   */\n  static createDrawerInstance(_x, _y, _parentWidth, _parentHeight, _rotation) {\n    unreachable(\"Not implemented\");\n  }\n\n  static startDrawing(parent, uiManager, _isLTR, event) {\n    // The pointerType of CurrentPointer is set when the user starts an empty\n    // drawing session. If, in the same drawing session, the user starts using a\n    // different type of pointer (e.g. a pen and then a finger), we just return.\n    //\n    // If the user starts to draw with a finger and then uses a second finger,\n    // we just stop the current drawing and let the user zoom the document.\n\n    const { target, offsetX: x, offsetY: y, pointerId, pointerType } = event;\n    if (CurrentPointers.isInitializedAndDifferentPointerType(pointerType)) {\n      return;\n    }\n\n    const {\n      viewport: { rotation },\n    } = parent;\n    const { width: parentWidth, height: parentHeight } =\n      target.getBoundingClientRect();\n\n    const ac = (DrawingEditor.#currentDrawingAC = new AbortController());\n    const signal = parent.combinedSignal(ac);\n\n    CurrentPointers.setPointer(pointerType, pointerId);\n\n    window.addEventListener(\n      \"pointerup\",\n      e => {\n        if (CurrentPointers.isSamePointerIdOrRemove(e.pointerId)) {\n          this._endDraw(e);\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointercancel\",\n      e => {\n        if (CurrentPointers.isSamePointerIdOrRemove(e.pointerId)) {\n          this._currentParent.endDrawingSession();\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointerdown\",\n      e => {\n        if (!CurrentPointers.isSamePointerType(e.pointerType)) {\n          // For example, we started with a pen and the user\n          // is now using a finger.\n          return;\n        }\n\n        // For example, the user is using a second finger.\n        CurrentPointers.initializeAndAddPointerId(e.pointerId);\n\n        // The first finger created a first point and a second finger just\n        // started, so we stop the drawing and remove this only point.\n        if (DrawingEditor.#currentDraw.isCancellable()) {\n          DrawingEditor.#currentDraw.removeLastElement();\n          if (DrawingEditor.#currentDraw.isEmpty()) {\n            this._currentParent.endDrawingSession(/* isAborted = */ true);\n          } else {\n            this._endDraw(null);\n          }\n        }\n      },\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    target.addEventListener(\"pointermove\", this._drawMove.bind(this), {\n      signal,\n    });\n    target.addEventListener(\n      \"touchmove\",\n      e => {\n        if (CurrentPointers.isSameTimeStamp(e.timeStamp)) {\n          // This move event is used to draw so we don't want to scroll.\n          stopEvent(e);\n        }\n      },\n      { signal }\n    );\n    parent.toggleDrawing();\n    uiManager._editorUndoBar?.hide();\n\n    if (DrawingEditor.#currentDraw) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.startNew(\n          x,\n          y,\n          parentWidth,\n          parentHeight,\n          rotation\n        )\n      );\n      return;\n    }\n\n    uiManager.updateUIForDefaultProperties(this);\n\n    DrawingEditor.#currentDraw = this.createDrawerInstance(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation\n    );\n    DrawingEditor.#currentDrawingOptions = this.getDefaultDrawingOptions();\n    this._currentParent = parent;\n\n    ({ id: this._currentDrawId } = parent.drawLayer.draw(\n      this._mergeSVGProperties(\n        DrawingEditor.#currentDrawingOptions.toSVGProperties(),\n        DrawingEditor.#currentDraw.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ true,\n      /* hasClip = */ false\n    ));\n  }\n\n  static _drawMove(event) {\n    CurrentPointers.isSameTimeStamp(event.timeStamp);\n    if (!DrawingEditor.#currentDraw) {\n      return;\n    }\n    const { offsetX, offsetY, pointerId } = event;\n\n    if (!CurrentPointers.isSamePointerId(pointerId)) {\n      return;\n    }\n    if (CurrentPointers.isUsingMultiplePointers()) {\n      // The user is using multiple fingers and the first one is moving.\n      this._endDraw(event);\n      return;\n    }\n    this._currentParent.drawLayer.updateProperties(\n      this._currentDrawId,\n      DrawingEditor.#currentDraw.add(offsetX, offsetY)\n    );\n    // We track the timestamp to know if the touchmove event is used to draw.\n    CurrentPointers.setTimeStamp(event.timeStamp);\n    stopEvent(event);\n  }\n\n  static _cleanup(all) {\n    if (all) {\n      this._currentDrawId = -1;\n      this._currentParent = null;\n      DrawingEditor.#currentDraw = null;\n      DrawingEditor.#currentDrawingOptions = null;\n      CurrentPointers.clearPointerType();\n      CurrentPointers.clearTimeStamp();\n    }\n\n    if (DrawingEditor.#currentDrawingAC) {\n      DrawingEditor.#currentDrawingAC.abort();\n      DrawingEditor.#currentDrawingAC = null;\n      CurrentPointers.clearPointerIds();\n    }\n  }\n\n  static _endDraw(event) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n\n    parent.toggleDrawing(true);\n    this._cleanup(false);\n\n    if (event?.target === parent.div) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.end(event.offsetX, event.offsetY)\n      );\n    }\n    if (this.supportMultipleDrawings) {\n      const draw = DrawingEditor.#currentDraw;\n      const drawId = this._currentDrawId;\n      const lastElement = draw.getLastElement();\n      parent.addCommands({\n        cmd: () => {\n          parent.drawLayer.updateProperties(\n            drawId,\n            draw.setLastElement(lastElement)\n          );\n        },\n        undo: () => {\n          parent.drawLayer.updateProperties(drawId, draw.removeLastElement());\n        },\n        mustExec: false,\n        type: AnnotationEditorParamsType.DRAW_STEP,\n      });\n\n      return;\n    }\n\n    this.endDrawing(/* isAborted = */ false);\n  }\n\n  static endDrawing(isAborted) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return null;\n    }\n    parent.toggleDrawing(true);\n    parent.cleanUndoStack(AnnotationEditorParamsType.DRAW_STEP);\n\n    if (!DrawingEditor.#currentDraw.isEmpty()) {\n      const {\n        pageDimensions: [pageWidth, pageHeight],\n        scale,\n      } = parent;\n\n      const editor = parent.createAndAddNewEditor(\n        { offsetX: 0, offsetY: 0 },\n        false,\n        {\n          drawId: this._currentDrawId,\n          drawOutlines: DrawingEditor.#currentDraw.getOutlines(\n            pageWidth * scale,\n            pageHeight * scale,\n            scale,\n            this._INNER_MARGIN\n          ),\n          drawingOptions: DrawingEditor.#currentDrawingOptions,\n          mustBeCommitted: !isAborted,\n        }\n      );\n      this._cleanup(true);\n      return editor;\n    }\n\n    parent.drawLayer.remove(this._currentDrawId);\n    this._cleanup(true);\n    return null;\n  }\n\n  /**\n   * Create the drawing options.\n   * @param {Object} _data\n   */\n  createDrawingOptions(_data) {}\n\n  /**\n   * Deserialize the drawing outlines.\n   * @param {number} pageX - The x coordinate of the page.\n   * @param {number} pageY - The y coordinate of the page.\n   * @param {number} pageWidth - The width of the page.\n   * @param {number} pageHeight - The height of the page.\n   * @param {number} innerWidth - The inner width.\n   * @param {Object} data - The data to deserialize.\n   * @returns {Object} The deserialized outlines.\n   */\n  static deserializeDraw(\n    _pageX,\n    _pageY,\n    _pageWidth,\n    _pageHeight,\n    _innerWidth,\n    _data\n  ) {\n    unreachable(\"Not implemented\");\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const {\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = parent.viewport;\n    const drawOutlines = this.deserializeDraw(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      this._INNER_MARGIN,\n      data\n    );\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.createDrawingOptions(data);\n    editor.#createDrawOutlines({ drawOutlines });\n    editor.#addToDrawLayer();\n    editor.onScaleChanging();\n    editor.rotate();\n\n    return editor;\n  }\n\n  serializeDraw(isForCopying) {\n    const [pageX, pageY] = this.pageTranslation;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    return this.#drawOutlines.serialize(\n      [pageX, pageY, pageWidth, pageHeight],\n      isForCopying\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { DrawingEditor, DrawingOptions };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MathClamp, Util } from \"../../../shared/util.js\";\nimport { Outline } from \"./outline.js\";\n\nclass InkDrawOutliner {\n  // The last 3 points of the line.\n  #last = new Float64Array(6);\n\n  #line;\n\n  #lines;\n\n  #rotation;\n\n  #thickness;\n\n  #points;\n\n  #lastSVGPath = \"\";\n\n  #lastIndex = 0;\n\n  #outlines = new InkDrawOutline();\n\n  #parentWidth;\n\n  #parentHeight;\n\n  constructor(x, y, parentWidth, parentHeight, rotation, thickness) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    this.#lines = [{ line, points: this.#points }];\n    this.#last.set(line, 0);\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      this.#thickness = value;\n    }\n  }\n\n  #normalizePoint(x, y) {\n    return Outline._normalizePoint(\n      x,\n      y,\n      this.#parentWidth,\n      this.#parentHeight,\n      this.#rotation\n    );\n  }\n\n  isEmpty() {\n    return !this.#lines || this.#lines.length === 0;\n  }\n\n  isCancellable() {\n    // The user a second finger after drawing 5 points: it's small enough\n    // to not be a real drawing.\n    return this.#points.length <= 10;\n  }\n\n  add(x, y) {\n    // The point is in canvas coordinates which means that there is no rotation.\n    // It's the same as parent coordinates.\n    [x, y] = this.#normalizePoint(x, y);\n    const [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(this.#parentWidth * diffX, this.#parentHeight * diffY);\n    if (d <= 2) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return null;\n    }\n\n    this.#points.push(x, y);\n\n    if (isNaN(x1)) {\n      // We've only one point.\n      this.#last.set([x2, y2, x, y], 2);\n      this.#line.push(NaN, NaN, NaN, NaN, x, y);\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    if (isNaN(this.#last[0])) {\n      // We've only two points.\n      this.#line.splice(6, 6);\n    }\n\n    this.#last.set([x1, y1, x2, y2, x, y], 0);\n    this.#line.push(...Outline.createBezierPoints(x1, y1, x2, y2, x, y));\n\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  end(x, y) {\n    const change = this.add(x, y);\n    if (change) {\n      return change;\n    }\n    if (this.#points.length === 2) {\n      // We've only one point.\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n    return null;\n  }\n\n  startNew(x, y, parentWidth, parentHeight, rotation) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    const last = this.#lines.at(-1);\n    if (last) {\n      last.line = new Float32Array(last.line);\n      last.points = new Float32Array(last.points);\n    }\n    this.#lines.push({ line, points: this.#points });\n    this.#last.set(line, 0);\n    this.#lastIndex = 0;\n    this.toSVGPath();\n\n    return null;\n  }\n\n  getLastElement() {\n    return this.#lines.at(-1);\n  }\n\n  setLastElement(element) {\n    if (!this.#lines) {\n      return this.#outlines.setLastElement(element);\n    }\n    this.#lines.push(element);\n    this.#line = element.line;\n    this.#points = element.points;\n    this.#lastIndex = 0;\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    if (!this.#lines) {\n      return this.#outlines.removeLastElement();\n    }\n    this.#lines.pop();\n    this.#lastSVGPath = \"\";\n    for (let i = 0, ii = this.#lines.length; i < ii; i++) {\n      const { line, points } = this.#lines[i];\n      this.#line = line;\n      this.#points = points;\n      this.#lastIndex = 0;\n      this.toSVGPath();\n    }\n\n    return {\n      path: {\n        d: this.#lastSVGPath,\n      },\n    };\n  }\n\n  toSVGPath() {\n    const firstX = Outline.svgRound(this.#line[4]);\n    const firstY = Outline.svgRound(this.#line[5]);\n    if (this.#points.length === 2) {\n      this.#lastSVGPath = `${this.#lastSVGPath} M ${firstX} ${firstY} Z`;\n      return this.#lastSVGPath;\n    }\n\n    if (this.#points.length <= 6) {\n      // We've 2 or 3 points.\n      const i = this.#lastSVGPath.lastIndexOf(\"M\");\n      this.#lastSVGPath = `${this.#lastSVGPath.slice(0, i)} M ${firstX} ${firstY}`;\n      this.#lastIndex = 6;\n    }\n\n    if (this.#points.length === 4) {\n      const secondX = Outline.svgRound(this.#line[10]);\n      const secondY = Outline.svgRound(this.#line[11]);\n      this.#lastSVGPath = `${this.#lastSVGPath} L ${secondX} ${secondY}`;\n      this.#lastIndex = 12;\n      return this.#lastSVGPath;\n    }\n\n    const buffer = [];\n    if (this.#lastIndex === 0) {\n      buffer.push(`M ${firstX} ${firstY}`);\n      this.#lastIndex = 6;\n    }\n\n    for (let i = this.#lastIndex, ii = this.#line.length; i < ii; i += 6) {\n      const [c1x, c1y, c2x, c2y, x, y] = this.#line\n        .slice(i, i + 6)\n        .map(Outline.svgRound);\n      buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n    }\n    this.#lastSVGPath += buffer.join(\" \");\n    this.#lastIndex = this.#line.length;\n\n    return this.#lastSVGPath;\n  }\n\n  getOutlines(parentWidth, parentHeight, scale, innerMargin) {\n    const last = this.#lines.at(-1);\n    last.line = new Float32Array(last.line);\n    last.points = new Float32Array(last.points);\n\n    this.#outlines.build(\n      this.#lines,\n      parentWidth,\n      parentHeight,\n      scale,\n      this.#rotation,\n      this.#thickness,\n      innerMargin\n    );\n\n    // We reset everything: the drawing is done.\n    this.#last = null;\n    this.#line = null;\n    this.#lines = null;\n    this.#lastSVGPath = null;\n\n    return this.#outlines;\n  }\n\n  get defaultSVGProperties() {\n    return {\n      root: {\n        viewBox: \"0 0 10000 10000\",\n      },\n      rootClass: {\n        draw: true,\n      },\n      bbox: [0, 0, 1, 1],\n    };\n  }\n}\n\nclass InkDrawOutline extends Outline {\n  #bbox;\n\n  #currentRotation = 0;\n\n  #innerMargin;\n\n  #lines;\n\n  #parentWidth;\n\n  #parentHeight;\n\n  #parentScale;\n\n  #rotation;\n\n  #thickness;\n\n  build(\n    lines,\n    parentWidth,\n    parentHeight,\n    parentScale,\n    rotation,\n    thickness,\n    innerMargin\n  ) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#parentScale = parentScale;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n    this.#innerMargin = innerMargin ?? 0;\n    this.#lines = lines;\n\n    this.#computeBbox();\n  }\n\n  get thickness() {\n    return this.#thickness;\n  }\n\n  setLastElement(element) {\n    this.#lines.push(element);\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    this.#lines.pop();\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const { line } of this.#lines) {\n      buffer.push(`M${Outline.svgRound(line[4])} ${Outline.svgRound(line[5])}`);\n      if (line.length === 6) {\n        buffer.push(\"Z\");\n        continue;\n      }\n      if (line.length === 12 && isNaN(line[6])) {\n        buffer.push(\n          `L${Outline.svgRound(line[10])} ${Outline.svgRound(line[11])}`\n        );\n        continue;\n      }\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line\n          .subarray(i, i + 6)\n          .map(Outline.svgRound);\n        buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n      }\n    }\n    return buffer.join(\"\");\n  }\n\n  serialize([pageX, pageY, pageWidth, pageHeight], isForCopying) {\n    const serializedLines = [];\n    const serializedPoints = [];\n    const [x, y, width, height] = this.#getBBoxWithNoMargin();\n    let tx, ty, sx, sy, x1, y1, x2, y2, rescaleFn;\n\n    switch (this.#rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = pageX;\n        ty = pageY + pageHeight;\n        sx = pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + x * pageWidth;\n        y1 = pageY + (1 - y - height) * pageHeight;\n        x2 = pageX + (x + width) * pageWidth;\n        y2 = pageY + (1 - y) * pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX;\n        ty = pageY;\n        sx = pageWidth;\n        sy = pageHeight;\n        x1 = pageX + y * pageWidth;\n        y1 = pageY + x * pageHeight;\n        x2 = pageX + (y + height) * pageWidth;\n        y2 = pageY + (x + width) * pageHeight;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX + pageWidth;\n        ty = pageY;\n        sx = -pageWidth;\n        sy = pageHeight;\n        x1 = pageX + (1 - x - width) * pageWidth;\n        y1 = pageY + y * pageHeight;\n        x2 = pageX + (1 - x) * pageWidth;\n        y2 = pageY + (y + height) * pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX + pageWidth;\n        ty = pageY + pageHeight;\n        sx = -pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + (1 - y - height) * pageWidth;\n        y1 = pageY + (1 - x - width) * pageHeight;\n        x2 = pageX + (1 - y) * pageWidth;\n        y2 = pageY + (1 - x) * pageHeight;\n        break;\n    }\n\n    for (const { line, points } of this.#lines) {\n      serializedLines.push(\n        rescaleFn(\n          line,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(line.length) : null\n        )\n      );\n      serializedPoints.push(\n        rescaleFn(\n          points,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(points.length) : null\n        )\n      );\n    }\n\n    return {\n      lines: serializedLines,\n      points: serializedPoints,\n      rect: [x1, y1, x2, y2],\n    };\n  }\n\n  static deserialize(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    { paths: { lines, points }, rotation, thickness }\n  ) {\n    const newLines = [];\n    let tx, ty, sx, sy, rescaleFn;\n    switch (rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = -pageX / pageWidth;\n        ty = pageY / pageHeight + 1;\n        sx = 1 / pageWidth;\n        sy = -1 / pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = -pageY / pageHeight;\n        ty = -pageX / pageWidth;\n        sx = 1 / pageHeight;\n        sy = 1 / pageWidth;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX / pageWidth + 1;\n        ty = -pageY / pageHeight;\n        sx = -1 / pageWidth;\n        sy = 1 / pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageY / pageHeight + 1;\n        ty = pageX / pageWidth + 1;\n        sx = -1 / pageHeight;\n        sy = -1 / pageWidth;\n        break;\n    }\n\n    if (!lines) {\n      lines = [];\n      for (const point of points) {\n        const len = point.length;\n        if (len === 2) {\n          lines.push(\n            new Float32Array([NaN, NaN, NaN, NaN, point[0], point[1]])\n          );\n          continue;\n        }\n        if (len === 4) {\n          lines.push(\n            new Float32Array([\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[0],\n              point[1],\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[2],\n              point[3],\n            ])\n          );\n          continue;\n        }\n        const line = new Float32Array(3 * (len - 2));\n        lines.push(line);\n        let [x1, y1, x2, y2] = point.subarray(0, 4);\n        line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n        for (let i = 4; i < len; i += 2) {\n          const x = point[i];\n          const y = point[i + 1];\n          line.set(\n            Outline.createBezierPoints(x1, y1, x2, y2, x, y),\n            (i - 2) * 3\n          );\n          [x1, y1, x2, y2] = [x2, y2, x, y];\n        }\n      }\n    }\n\n    for (let i = 0, ii = lines.length; i < ii; i++) {\n      newLines.push({\n        line: rescaleFn(\n          lines[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n        points: rescaleFn(\n          points[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n      });\n    }\n\n    const outlines = new this.prototype.constructor();\n    outlines.build(\n      newLines,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      thickness,\n      innerMargin\n    );\n\n    return outlines;\n  }\n\n  #getMarginComponents(thickness = this.#thickness) {\n    const margin = this.#innerMargin + (thickness / 2) * this.#parentScale;\n    return this.#rotation % 180 === 0\n      ? [margin / this.#parentWidth, margin / this.#parentHeight]\n      : [margin / this.#parentHeight, margin / this.#parentWidth];\n  }\n\n  #getBBoxWithNoMargin() {\n    const [x, y, width, height] = this.#bbox;\n    const [marginX, marginY] = this.#getMarginComponents(0);\n\n    return [\n      x + marginX,\n      y + marginY,\n      width - 2 * marginX,\n      height - 2 * marginY,\n    ];\n  }\n\n  #computeBbox() {\n    const bbox = (this.#bbox = new Float32Array([\n      Infinity,\n      Infinity,\n      -Infinity,\n      -Infinity,\n    ]));\n\n    for (const { line } of this.#lines) {\n      if (line.length <= 12) {\n        // We've only one or two points => no bezier curve.\n        for (let i = 4, ii = line.length; i < ii; i += 6) {\n          Util.pointBoundingBox(line[i], line[i + 1], bbox);\n        }\n        continue;\n      }\n      let lastX = line[4],\n        lastY = line[5];\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line.subarray(i, i + 6);\n        Util.bezierBoundingBox(lastX, lastY, c1x, c1y, c2x, c2y, x, y, bbox);\n        lastX = x;\n        lastY = y;\n      }\n    }\n\n    const [marginX, marginY] = this.#getMarginComponents();\n    bbox[0] = MathClamp(bbox[0] - marginX, 0, 1);\n    bbox[1] = MathClamp(bbox[1] - marginY, 0, 1);\n    bbox[2] = MathClamp(bbox[2] + marginX, 0, 1);\n    bbox[3] = MathClamp(bbox[3] + marginY, 0, 1);\n\n    bbox[2] -= bbox[0];\n    bbox[3] -= bbox[1];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      return this.#updateThickness(value);\n    }\n    return null;\n  }\n\n  #updateThickness(thickness) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#thickness = thickness;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const [diffMarginX, diffMarginY] = [\n      newMarginX - oldMarginX,\n      newMarginY - oldMarginY,\n    ];\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateParentDimensions([width, height], scale) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#parentWidth = width;\n    this.#parentHeight = height;\n    this.#parentScale = scale;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const diffMarginX = newMarginX - oldMarginX;\n    const diffMarginY = newMarginY - oldMarginY;\n\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateRotation(rotation) {\n    this.#currentRotation = rotation;\n    return {\n      path: {\n        transform: this.rotationTransform,\n      },\n    };\n  }\n\n  get viewBox() {\n    return this.#bbox.map(Outline.svgRound).join(\" \");\n  }\n\n  get defaultProperties() {\n    const [x, y] = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n      },\n    };\n  }\n\n  get rotationTransform() {\n    const [, , width, height] = this.#bbox;\n    let a = 0,\n      b = 0,\n      c = 0,\n      d = 0,\n      e = 0,\n      f = 0;\n    switch (this.#currentRotation) {\n      case 90:\n        b = height / width;\n        c = -width / height;\n        e = width;\n        break;\n      case 180:\n        a = -1;\n        d = -1;\n        e = width;\n        f = height;\n        break;\n      case 270:\n        b = -height / width;\n        c = width / height;\n        f = height;\n        break;\n      default:\n        return \"\";\n    }\n    return `matrix(${a} ${b} ${c} ${d} ${Outline.svgRound(e)} ${Outline.svgRound(f)})`;\n  }\n\n  getPathResizingSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const [x, y, width, height] = this.#bbox;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      return {\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: `${this.rotationTransform} translate(${tx} ${ty})`,\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-marginX, -marginY).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its original position\n    //   (marginX, marginY).\n    //  4. Scale the inverse of bbox scaling:\n    //   (bbox.width / newWidth, bbox.height / newHeight).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const s2x = width / newWidth;\n    const s2y = height / newHeight;\n\n    return {\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n        transform:\n          `${this.rotationTransform} scale(${s2x} ${s2y}) ` +\n          `translate(${Outline.svgRound(marginX)} ${Outline.svgRound(marginY)}) scale(${s1x} ${s1y}) ` +\n          `translate(${Outline.svgRound(-marginX)} ${Outline.svgRound(-marginY)})`,\n      },\n    };\n  }\n\n  getPathResizedSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const bbox = this.#bbox;\n    const [x, y, width, height] = bbox;\n\n    bbox[0] = newX;\n    bbox[1] = newY;\n    bbox[2] = newWidth;\n    bbox[3] = newHeight;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n      return {\n        root: {\n          viewBox: this.viewBox,\n        },\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: this.rotationTransform || null,\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-(x + marginX), -(y + marginY)).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its new position\n    //     (newX + marginX,y newY + marginY).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const tx = -s1x * (x + marginX) + newX + marginX;\n    const ty = -s1y * (y + marginY) + newY + marginY;\n\n    if (s1x !== 1 || s1y !== 1 || tx !== 0 || ty !== 0) {\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, s1x, s1y, line);\n        Outline._rescale(points, tx, ty, s1x, s1y, points);\n      }\n    }\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n        transform: this.rotationTransform || null,\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  getPathTranslatedSVGProperties([newX, newY], parentDimensions) {\n    const [newParentWidth, newParentHeight] = parentDimensions;\n    const bbox = this.#bbox;\n    const tx = newX - bbox[0];\n    const ty = newY - bbox[1];\n\n    if (\n      this.#parentWidth === newParentWidth &&\n      this.#parentHeight === newParentHeight\n    ) {\n      // We don't change the parent dimensions so it's a simple translation.\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n    } else {\n      const sx = this.#parentWidth / newParentWidth;\n      const sy = this.#parentHeight / newParentHeight;\n      this.#parentWidth = newParentWidth;\n      this.#parentHeight = newParentHeight;\n\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, sx, sy, line);\n        Outline._rescale(points, tx, ty, sx, sy, points);\n      }\n      bbox[2] *= sx;\n      bbox[3] *= sy;\n    }\n    bbox[0] = newX;\n    bbox[1] = newY;\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n      },\n    };\n  }\n\n  get defaultSVGProperties() {\n    const bbox = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      rootClass: {\n        draw: true,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(bbox[0])} ${Outline.svgRound(bbox[1])}`,\n        transform: this.rotationTransform || null,\n      },\n      bbox,\n    };\n  }\n}\n\nexport { InkDrawOutline, InkDrawOutliner };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { InkDrawOutline, InkDrawOutliner } from \"./drawers/inkdraw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { BasicColorPicker } from \"./color_picker.js\";\nimport { InkAnnotationElement } from \"../annotation_layer.js\";\n\nclass InkDrawingOptions extends DrawingOptions {\n  constructor(viewerParameters) {\n    super();\n    this._viewParameters = viewerParameters;\n\n    super.updateProperties({\n      fill: \"none\",\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-opacity\": 1,\n      \"stroke-width\": 1,\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"stroke-miterlimit\": 10,\n    });\n  }\n\n  updateSVGProperty(name, value) {\n    if (name === \"stroke-width\") {\n      value ??= this[\"stroke-width\"];\n      value *= this._viewParameters.realScale;\n    }\n    super.updateSVGProperty(name, value);\n  }\n\n  clone() {\n    const clone = new InkDrawingOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic draw editor in order to generate an Ink annotation.\n */\nclass InkEditor extends DrawingEditor {\n  static _type = \"ink\";\n\n  static _editorType = AnnotationEditorType.INK;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, name: \"inkEditor\" });\n    this._willKeepAspectRatio = true;\n    this.defaultL10nId = \"pdfjs-editor-ink-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    this._defaultDrawingOptions = new InkDrawingOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  static get typesMap() {\n    return shadow(\n      this,\n      \"typesMap\",\n      new Map([\n        [AnnotationEditorParamsType.INK_THICKNESS, \"stroke-width\"],\n        [AnnotationEditorParamsType.INK_COLOR, \"stroke\"],\n        [AnnotationEditorParamsType.INK_OPACITY, \"stroke-opacity\"],\n      ])\n    );\n  }\n\n  /** @inheritdoc */\n  static createDrawerInstance(x, y, parentWidth, parentHeight, rotation) {\n    return new InkDrawOutliner(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation,\n      this._defaultDrawingOptions[\"stroke-width\"]\n    );\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          opacity,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.INK,\n        color: Array.from(color),\n        thickness,\n        opacity,\n        paths: { points: inkLists },\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    this._colorPicker ||= new BasicColorPicker(this);\n    return [[\"colorPicker\", this._colorPicker]];\n  }\n\n  get colorType() {\n    return AnnotationEditorParamsType.INK_COLOR;\n  }\n\n  get color() {\n    return this._drawingOptions.stroke;\n  }\n\n  get opacity() {\n    return this._drawingOptions[\"stroke-opacity\"];\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    super.onScaleChanging();\n    const { _drawId, _drawingOptions, parent } = this;\n    _drawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      _drawId,\n      _drawingOptions.toSVGProperties()\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n    super.onScaleChangingWhenDrawing();\n    this._defaultDrawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      this._currentDrawId,\n      this._defaultDrawingOptions.toSVGProperties()\n    );\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ color, thickness, opacity }) {\n    this._drawingOptions = InkEditor.getDefaultDrawingOptions({\n      stroke: Util.makeHexColor(...color),\n      \"stroke-width\": thickness,\n      \"stroke-opacity\": opacity,\n    });\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const { lines, points } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: {\n        stroke,\n        \"stroke-opacity\": opacity,\n        \"stroke-width\": thickness,\n      },\n    } = this;\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      color: AnnotationEditor._colorManager.convert(stroke),\n      opacity,\n      thickness,\n      paths: {\n        lines,\n        points,\n      },\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color, thickness, opacity, pageIndex } = this._initialData;\n    return (\n      this.hasEditedComment ||\n      this._hasBeenMoved ||\n      this._hasBeenResized ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.thickness !== thickness ||\n      serialized.opacity !== opacity ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    const { points, rect } = this.serializeDraw(/* isForCopying = */ false);\n    annotation.updateEdited({\n      rect,\n      thickness: this._drawingOptions[\"stroke-width\"],\n      points,\n      popup: this.comment,\n    });\n\n    return null;\n  }\n}\n\nexport { InkDrawingOptions, InkEditor };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InkDrawOutline } from \"./inkdraw.js\";\n\nclass ContourDrawOutline extends InkDrawOutline {\n  toSVGPath() {\n    let path = super.toSVGPath();\n    if (!path.endsWith(\"Z\")) {\n      path += \"Z\";\n    }\n    return path;\n  }\n}\n\nexport { ContourDrawOutline };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fromBase64Util, toBase64Util, warn } from \"../../../shared/util.js\";\nimport { ContourDrawOutline } from \"./contour.js\";\nimport { InkDrawOutline } from \"./inkdraw.js\";\nimport { Outline } from \"./outline.js\";\n\nconst BASE_HEADER_LENGTH = 8;\nconst POINTS_PROPERTIES_NUMBER = 3;\n\n/**\n * Basic text editor in order to create a Signature annotation.\n */\nclass SignatureExtractor {\n  static #PARAMETERS = {\n    maxDim: 512,\n    sigmaSFactor: 0.02,\n    sigmaR: 25,\n    kernelSize: 16,\n  };\n\n  static #neighborIndexToId(i0, j0, i, j) {\n    /*\n      The idea is to map the neighbors of a pixel into a unique id.\n        3 2 1\n        4 X 0\n        5 6 7\n    */\n\n    i -= i0;\n    j -= j0;\n\n    if (i === 0) {\n      return j > 0 ? 0 : 4;\n    }\n\n    if (i === 1) {\n      return j + 6;\n    }\n\n    return 2 - j;\n  }\n\n  static #neighborIdToIndex = new Int32Array([\n    0, 1, -1, 1, -1, 0, -1, -1, 0, -1, 1, -1, 1, 0, 1, 1,\n  ]);\n\n  static #clockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (-k + id - offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #counterClockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (k + id + offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #findContours(buf, width, height, threshold) {\n    // Based on the Suzuki's algorithm:\n    //  https://web.archive.org/web/20231213161741/https://www.nevis.columbia.edu/~vgenty/public/suzuki_et_al.pdf\n\n    const N = buf.length;\n    const types = new Int32Array(N);\n    for (let i = 0; i < N; i++) {\n      types[i] = buf[i] <= threshold ? 1 : 0;\n    }\n\n    for (let i = 1; i < height - 1; i++) {\n      types[i * width] = types[i * width + width - 1] = 0;\n    }\n    for (let i = 0; i < width; i++) {\n      types[i] = types[width * height - 1 - i] = 0;\n    }\n\n    let nbd = 1;\n    let lnbd;\n    const contours = [];\n\n    for (let i = 1; i < height - 1; i++) {\n      lnbd = 1;\n      for (let j = 1; j < width - 1; j++) {\n        const ij = i * width + j;\n        const pix = types[ij];\n        if (pix === 0) {\n          continue;\n        }\n\n        let i2 = i;\n        let j2 = j;\n\n        if (pix === 1 && types[ij - 1] === 0) {\n          // Outer border.\n          nbd += 1;\n          j2 -= 1;\n        } else if (pix >= 1 && types[ij + 1] === 0) {\n          // Hole border.\n          nbd += 1;\n          j2 += 1;\n          if (pix > 1) {\n            lnbd = pix;\n          }\n        } else {\n          if (pix !== 1) {\n            lnbd = Math.abs(pix);\n          }\n          continue;\n        }\n\n        const points = [j, i];\n        const isHole = j2 === j + 1;\n        const contour = {\n          isHole,\n          points,\n          id: nbd,\n          parent: 0,\n        };\n        contours.push(contour);\n\n        let contour0;\n        for (const c of contours) {\n          if (c.id === lnbd) {\n            contour0 = c;\n            break;\n          }\n        }\n\n        if (!contour0) {\n          contour.parent = isHole ? lnbd : 0;\n        } else if (contour0.isHole) {\n          contour.parent = isHole ? contour0.parent : lnbd;\n        } else {\n          contour.parent = isHole ? lnbd : contour0.parent;\n        }\n\n        const k = this.#clockwiseNonZero(types, width, i, j, i2, j2, 0);\n        if (k === -1) {\n          types[ij] = -nbd;\n          if (types[ij] !== 1) {\n            lnbd = Math.abs(types[ij]);\n          }\n          continue;\n        }\n\n        let shiftI = this.#neighborIdToIndex[2 * k];\n        let shiftJ = this.#neighborIdToIndex[2 * k + 1];\n        const i1 = i + shiftI;\n        const j1 = j + shiftJ;\n        i2 = i1;\n        j2 = j1;\n        let i3 = i;\n        let j3 = j;\n\n        while (true) {\n          const kk = this.#counterClockwiseNonZero(\n            types,\n            width,\n            i3,\n            j3,\n            i2,\n            j2,\n            1\n          );\n          shiftI = this.#neighborIdToIndex[2 * kk];\n          shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n          const i4 = i3 + shiftI;\n          const j4 = j3 + shiftJ;\n          points.push(j4, i4);\n          const ij3 = i3 * width + j3;\n          if (types[ij3 + 1] === 0) {\n            types[ij3] = -nbd;\n          } else if (types[ij3] === 1) {\n            types[ij3] = nbd;\n          }\n\n          if (i4 === i && j4 === j && i3 === i1 && j3 === j1) {\n            if (types[ij] !== 1) {\n              lnbd = Math.abs(types[ij]);\n            }\n            break;\n          } else {\n            i2 = i3;\n            j2 = j3;\n            i3 = i4;\n            j3 = j4;\n          }\n        }\n      }\n    }\n    return contours;\n  }\n\n  static #douglasPeuckerHelper(points, start, end, output) {\n    // Based on the Douglas-Peucker algorithm:\n    //  https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm\n    if (end - start <= 4) {\n      for (let i = start; i < end - 2; i += 2) {\n        output.push(points[i], points[i + 1]);\n      }\n      return;\n    }\n\n    const ax = points[start];\n    const ay = points[start + 1];\n    const abx = points[end - 4] - ax;\n    const aby = points[end - 3] - ay;\n    const dist = Math.hypot(abx, aby);\n    const nabx = abx / dist;\n    const naby = aby / dist;\n    const aa = nabx * ay - naby * ax;\n\n    // Guessing the epsilon value.\n    // See \"A novel framework for making dominant point detection methods\n    // non-parametric\".\n    const m = aby / abx;\n    const invS = 1 / dist;\n    const phi = Math.atan(m);\n    const cosPhi = Math.cos(phi);\n    const sinPhi = Math.sin(phi);\n    const tmax = invS * (Math.abs(cosPhi) + Math.abs(sinPhi));\n    const poly = invS * (1 - tmax + tmax ** 2);\n    const partialPhi = Math.max(\n      Math.atan(Math.abs(sinPhi + cosPhi) * poly),\n      Math.atan(Math.abs(sinPhi - cosPhi) * poly)\n    );\n\n    let dmax = 0;\n    let index = start;\n    for (let i = start + 2; i < end - 2; i += 2) {\n      const d = Math.abs(aa - nabx * points[i + 1] + naby * points[i]);\n      if (d > dmax) {\n        index = i;\n        dmax = d;\n      }\n    }\n\n    if (dmax > (dist * partialPhi) ** 2) {\n      this.#douglasPeuckerHelper(points, start, index + 2, output);\n      this.#douglasPeuckerHelper(points, index, end, output);\n    } else {\n      output.push(ax, ay);\n    }\n  }\n\n  static #douglasPeucker(points) {\n    const output = [];\n    const len = points.length;\n    this.#douglasPeuckerHelper(points, 0, len, output);\n    output.push(points[len - 2], points[len - 1]);\n    return output.length <= 4 ? null : output;\n  }\n\n  static #bilateralFilter(buf, width, height, sigmaS, sigmaR, kernelSize) {\n    // The bilateral filter is a nonlinear filter that does spatial averaging.\n    // Its main interest is to preserve edges while removing noise.\n    // See https://en.wikipedia.org/wiki/Bilateral_filter for more details.\n    // sigmaS is the standard deviation of the spatial gaussian.\n    // sigmaR is the standard deviation of the range (in term of pixel\n    // intensity) gaussian.\n\n    // Create a gaussian kernel\n    const kernel = new Float32Array(kernelSize ** 2);\n    const sigmaS2 = -2 * sigmaS ** 2;\n    const halfSize = kernelSize >> 1;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const x = (i - halfSize) ** 2;\n      for (let j = 0; j < kernelSize; j++) {\n        kernel[i * kernelSize + j] = Math.exp(\n          (x + (j - halfSize) ** 2) / sigmaS2\n        );\n      }\n    }\n\n    // Create the range values to be used with the distance between pixels.\n    // It's a way faster with a lookup table than computing the exponential.\n    const rangeValues = new Float32Array(256);\n    const sigmaR2 = -2 * sigmaR ** 2;\n    for (let i = 0; i < 256; i++) {\n      rangeValues[i] = Math.exp(i ** 2 / sigmaR2);\n    }\n\n    const N = buf.length;\n    const out = new Uint8Array(N);\n\n    // We compute the histogram here instead of doing it later: it's slightly\n    // faster.\n    const histogram = new Uint32Array(256);\n    for (let i = 0; i < height; i++) {\n      for (let j = 0; j < width; j++) {\n        const ij = i * width + j;\n        const center = buf[ij];\n        let sum = 0;\n        let norm = 0;\n\n        for (let k = 0; k < kernelSize; k++) {\n          const y = i + k - halfSize;\n          if (y < 0 || y >= height) {\n            continue;\n          }\n          for (let l = 0; l < kernelSize; l++) {\n            const x = j + l - halfSize;\n            if (x < 0 || x >= width) {\n              continue;\n            }\n            const neighbour = buf[y * width + x];\n            const w =\n              kernel[k * kernelSize + l] *\n              rangeValues[Math.abs(neighbour - center)];\n            sum += neighbour * w;\n            norm += w;\n          }\n        }\n\n        const pix = (out[ij] = Math.round(sum / norm));\n        histogram[pix]++;\n      }\n    }\n\n    return [out, histogram];\n  }\n\n  static #getHistogram(buf) {\n    const histogram = new Uint32Array(256);\n    for (const g of buf) {\n      histogram[g]++;\n    }\n    return histogram;\n  }\n\n  static #toUint8(buf) {\n    // We have a RGBA buffer, containing a grayscale image.\n    // We want to convert it into a basic G buffer.\n    // Also, we want to normalize the values between 0 and 255 in order to\n    // increase the contrast.\n    const N = buf.length;\n    const out = new Uint8ClampedArray(N >> 2);\n    let max = -Infinity;\n    let min = Infinity;\n    for (let i = 0, ii = out.length; i < ii; i++) {\n      const pix = (out[i] = buf[i << 2]);\n      max = Math.max(max, pix);\n      min = Math.min(min, pix);\n    }\n    const ratio = 255 / (max - min);\n    for (let i = 0, ii = out.length; i < ii; i++) {\n      out[i] = (out[i] - min) * ratio;\n    }\n\n    return out;\n  }\n\n  static #guessThreshold(histogram) {\n    // We want to find the threshold that will separate the background from the\n    // foreground.\n    // We could have used Otsu's method, but unfortunately it doesn't work well\n    // when the background has too much shade of greys.\n    // So the idea is to find a maximum in the black part of the histogram and\n    // figure out the value which will be the first one of the white part.\n\n    let i;\n    let M = -Infinity;\n    let L = -Infinity;\n    const min = histogram.findIndex(v => v !== 0);\n    let pos = min;\n    let spos = min;\n    for (i = min; i < 256; i++) {\n      const v = histogram[i];\n      if (v > M) {\n        if (i - pos > L) {\n          L = i - pos;\n          spos = i - 1;\n        }\n        M = v;\n        pos = i;\n      }\n    }\n    for (i = spos - 1; i >= 0; i--) {\n      if (histogram[i] > histogram[i + 1]) {\n        break;\n      }\n    }\n\n    return i;\n  }\n\n  static #getGrayPixels(bitmap) {\n    const originalBitmap = bitmap;\n    const { width, height } = bitmap;\n    const { maxDim } = this.#PARAMETERS;\n    let newWidth = width;\n    let newHeight = height;\n\n    if (width > maxDim || height > maxDim) {\n      let prevWidth = width;\n      let prevHeight = height;\n\n      let steps = Math.log2(Math.max(width, height) / maxDim);\n      const isteps = Math.floor(steps);\n      steps = steps === isteps ? isteps - 1 : isteps;\n      for (let i = 0; i < steps; i++) {\n        newWidth = Math.ceil(prevWidth / 2);\n        newHeight = Math.ceil(prevHeight / 2);\n\n        const offscreen = new OffscreenCanvas(newWidth, newHeight);\n        const ctx = offscreen.getContext(\"2d\");\n        ctx.drawImage(\n          bitmap,\n          0,\n          0,\n          prevWidth,\n          prevHeight,\n          0,\n          0,\n          newWidth,\n          newHeight\n        );\n        prevWidth = newWidth;\n        prevHeight = newHeight;\n\n        // Release the resources associated with the bitmap.\n        if (bitmap !== originalBitmap) {\n          bitmap.close();\n        }\n        bitmap = offscreen.transferToImageBitmap();\n      }\n\n      const ratio = Math.min(maxDim / newWidth, maxDim / newHeight);\n      newWidth = Math.round(newWidth * ratio);\n      newHeight = Math.round(newHeight * ratio);\n    }\n    const offscreen = new OffscreenCanvas(newWidth, newHeight);\n    const ctx = offscreen.getContext(\"2d\", { willReadFrequently: true });\n    ctx.fillStyle = \"white\";\n    ctx.fillRect(0, 0, newWidth, newHeight);\n    ctx.filter = \"grayscale(1)\";\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      newWidth,\n      newHeight\n    );\n    const grayImage = ctx.getImageData(0, 0, newWidth, newHeight).data;\n    const uint8Buf = this.#toUint8(grayImage);\n\n    return [uint8Buf, newWidth, newHeight];\n  }\n\n  static extractContoursFromText(\n    text,\n    { fontFamily, fontStyle, fontWeight },\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin\n  ) {\n    let canvas = new OffscreenCanvas(1, 1);\n    let ctx = canvas.getContext(\"2d\", { alpha: false });\n    const fontSize = 200;\n    const font =\n      (ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`);\n    const {\n      actualBoundingBoxLeft,\n      actualBoundingBoxRight,\n      actualBoundingBoxAscent,\n      actualBoundingBoxDescent,\n      fontBoundingBoxAscent,\n      fontBoundingBoxDescent,\n      width,\n    } = ctx.measureText(text);\n\n    // We rescale the canvas to make \"sure\" the text fits.\n    const SCALE = 1.5;\n    const canvasWidth = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxLeft) + Math.abs(actualBoundingBoxRight) || 0,\n        width\n      ) * SCALE\n    );\n    const canvasHeight = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxAscent) +\n          Math.abs(actualBoundingBoxDescent) || fontSize,\n        Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent) ||\n          fontSize\n      ) * SCALE\n    );\n    canvas = new OffscreenCanvas(canvasWidth, canvasHeight);\n    ctx = canvas.getContext(\"2d\", { alpha: true, willReadFrequently: true });\n    ctx.font = font;\n    ctx.filter = \"grayscale(1)\";\n    ctx.fillStyle = \"white\";\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n    ctx.fillStyle = \"black\";\n    ctx.fillText(\n      text,\n      (canvasWidth * (SCALE - 1)) / 2,\n      (canvasHeight * (3 - SCALE)) / 2\n    );\n\n    const uint8Buf = this.#toUint8(\n      ctx.getImageData(0, 0, canvasWidth, canvasHeight).data\n    );\n    const histogram = this.#getHistogram(uint8Buf);\n    const threshold = this.#guessThreshold(histogram);\n\n    const contourList = this.#findContours(\n      uint8Buf,\n      canvasWidth,\n      canvasHeight,\n      threshold\n    );\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width: canvasWidth, height: canvasHeight },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static process(bitmap, pageWidth, pageHeight, rotation, innerMargin) {\n    const [uint8Buf, width, height] = this.#getGrayPixels(bitmap);\n    const [buffer, histogram] = this.#bilateralFilter(\n      uint8Buf,\n      width,\n      height,\n      Math.hypot(width, height) * this.#PARAMETERS.sigmaSFactor,\n      this.#PARAMETERS.sigmaR,\n      this.#PARAMETERS.kernelSize\n    );\n\n    const threshold = this.#guessThreshold(histogram);\n    const contourList = this.#findContours(buffer, width, height, threshold);\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width, height },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static processDrawnLines({\n    lines,\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin,\n    mustSmooth,\n    areContours,\n  }) {\n    if (rotation % 180 !== 0) {\n      [pageWidth, pageHeight] = [pageHeight, pageWidth];\n    }\n\n    const { curves, width, height } = lines;\n    const thickness = lines.thickness ?? 0;\n    const linesAndPoints = [];\n    const ratio = Math.min(pageWidth / width, pageHeight / height);\n    const xScale = ratio / pageWidth;\n    const yScale = ratio / pageHeight;\n    const newCurves = [];\n\n    for (const { points } of curves) {\n      const reducedPoints = mustSmooth ? this.#douglasPeucker(points) : points;\n      if (!reducedPoints) {\n        continue;\n      }\n      newCurves.push(reducedPoints);\n\n      const len = reducedPoints.length;\n      const newPoints = new Float32Array(len);\n      const line = new Float32Array(3 * (len === 2 ? 2 : len - 2));\n      linesAndPoints.push({ line, points: newPoints });\n\n      if (len === 2) {\n        newPoints[0] = reducedPoints[0] * xScale;\n        newPoints[1] = reducedPoints[1] * yScale;\n        line.set([NaN, NaN, NaN, NaN, newPoints[0], newPoints[1]], 0);\n        continue;\n      }\n\n      let [x1, y1, x2, y2] = reducedPoints;\n      x1 *= xScale;\n      y1 *= yScale;\n      x2 *= xScale;\n      y2 *= yScale;\n      newPoints.set([x1, y1, x2, y2], 0);\n\n      line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n      for (let i = 4; i < len; i += 2) {\n        const x = (newPoints[i] = reducedPoints[i] * xScale);\n        const y = (newPoints[i + 1] = reducedPoints[i + 1] * yScale);\n        line.set(Outline.createBezierPoints(x1, y1, x2, y2, x, y), (i - 2) * 3);\n        [x1, y1, x2, y2] = [x2, y2, x, y];\n      }\n    }\n\n    if (linesAndPoints.length === 0) {\n      return null;\n    }\n\n    const outline = areContours\n      ? new ContourDrawOutline()\n      : new InkDrawOutline();\n\n    outline.build(\n      linesAndPoints,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      areContours ? 0 : thickness,\n      innerMargin\n    );\n\n    return { outline, newCurves, areContours, thickness, width, height };\n  }\n\n  static async compressSignature({\n    outlines,\n    areContours,\n    thickness,\n    width,\n    height,\n  }) {\n    // We create a single array containing all the outlines.\n    // The format is the following:\n    // - 4 bytes: data length.\n    // - 4 bytes: version.\n    // - 4 bytes: width.\n    // - 4 bytes: height.\n    // - 4 bytes: 0 if it's a contour, 1 if it's an ink.\n    // - 4 bytes: thickness.\n    // - 4 bytes: number of drawings.\n    // - 4 bytes: size of the buffer containing the diff of the coordinates.\n    // - 4 bytes: number of points in the first drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - 4 bytes: number of points in the second drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - ...\n    // - The buffer containing the diff of the coordinates.\n\n    // The coordinates are supposed to be positive integers.\n\n    // We also compute the min and max difference between two points.\n    // This will help us to determine the type of the buffer (Int8, Int16 or\n    // Int32) in order to minimize the amount of data we have.\n    let minDiff = Infinity;\n    let maxDiff = -Infinity;\n    let outlinesLength = 0;\n    for (const points of outlines) {\n      outlinesLength += points.length;\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        const dx = points[i] - points[i - 2];\n        minDiff = Math.min(minDiff, dx);\n        maxDiff = Math.max(maxDiff, dx);\n      }\n    }\n\n    let bufferType;\n    if (minDiff >= -128 && maxDiff <= 127) {\n      bufferType = Int8Array;\n    } else if (minDiff >= -32768 && maxDiff <= 32767) {\n      bufferType = Int16Array;\n    } else {\n      bufferType = Int32Array;\n    }\n\n    const len = outlines.length;\n    const headerLength = BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * len;\n    const header = new Uint32Array(headerLength);\n\n    let offset = 0;\n    header[offset++] =\n      headerLength * Uint32Array.BYTES_PER_ELEMENT +\n      (outlinesLength - 2 * len) * bufferType.BYTES_PER_ELEMENT;\n    header[offset++] = 0; // Version.\n    header[offset++] = width;\n    header[offset++] = height;\n    header[offset++] = areContours ? 0 : 1;\n    header[offset++] = Math.max(0, Math.floor(thickness ?? 0));\n    header[offset++] = len;\n    header[offset++] = bufferType.BYTES_PER_ELEMENT;\n    for (const points of outlines) {\n      header[offset++] = points.length - 2;\n      header[offset++] = points[0];\n      header[offset++] = points[1];\n    }\n\n    const cs = new CompressionStream(\"deflate-raw\");\n    const writer = cs.writable.getWriter();\n    await writer.ready;\n\n    writer.write(header);\n    const BufferCtor = bufferType.prototype.constructor;\n    for (const points of outlines) {\n      const diffs = new BufferCtor(points.length - 2);\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        diffs[i - 2] = points[i] - points[i - 2];\n      }\n      writer.write(diffs);\n    }\n\n    writer.close();\n\n    const buf = await new Response(cs.readable).arrayBuffer();\n    const bytes = new Uint8Array(buf);\n\n    return toBase64Util(bytes);\n  }\n\n  static async decompressSignature(signatureData) {\n    try {\n      const bytes = fromBase64Util(signatureData);\n      const { readable, writable } = new DecompressionStream(\"deflate-raw\");\n      const writer = writable.getWriter();\n      await writer.ready;\n\n      // We can't await writer.write() because it'll block until the reader\n      // starts which happens few lines below.\n      writer\n        .write(bytes)\n        .then(async () => {\n          await writer.ready;\n          await writer.close();\n        })\n        .catch(() => {});\n\n      let data = null;\n      let offset = 0;\n      for await (const chunk of readable) {\n        data ||= new Uint8Array(new Uint32Array(chunk.buffer, 0, 4)[0]);\n        data.set(chunk, offset);\n        offset += chunk.length;\n      }\n\n      // We take a bit too much data for the header but it's fine.\n      const header = new Uint32Array(data.buffer, 0, data.length >> 2);\n      const version = header[1];\n      if (version !== 0) {\n        throw new Error(`Invalid version: ${version}`);\n      }\n      const width = header[2];\n      const height = header[3];\n      const areContours = header[4] === 0;\n      const thickness = header[5];\n      const numberOfDrawings = header[6];\n      const bufferType = header[7];\n      const outlines = [];\n      const diffsOffset =\n        (BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * numberOfDrawings) *\n        Uint32Array.BYTES_PER_ELEMENT;\n      let diffs;\n\n      switch (bufferType) {\n        case Int8Array.BYTES_PER_ELEMENT:\n          diffs = new Int8Array(data.buffer, diffsOffset);\n          break;\n        case Int16Array.BYTES_PER_ELEMENT:\n          diffs = new Int16Array(data.buffer, diffsOffset);\n          break;\n        case Int32Array.BYTES_PER_ELEMENT:\n          diffs = new Int32Array(data.buffer, diffsOffset);\n          break;\n      }\n\n      offset = 0;\n      for (let i = 0; i < numberOfDrawings; i++) {\n        const len = header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH];\n        const points = new Float32Array(len + 2);\n        outlines.push(points);\n\n        for (let j = 0; j < POINTS_PROPERTIES_NUMBER - 1; j++) {\n          points[j] =\n            header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH + j + 1];\n        }\n        for (let j = 0; j < len; j++) {\n          points[j + 2] = points[j] + diffs[offset++];\n        }\n      }\n\n      return {\n        areContours,\n        thickness,\n        outlines,\n        width,\n        height,\n      };\n    } catch (e) {\n      warn(`decompressSignature: ${e}`);\n      return null;\n    }\n  }\n}\n\nexport { SignatureExtractor };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, shadow } from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ContourDrawOutline } from \"./drawers/contour.js\";\nimport { InkDrawingOptions } from \"./ink.js\";\nimport { InkDrawOutline } from \"./drawers/inkdraw.js\";\nimport { SignatureExtractor } from \"./drawers/signaturedraw.js\";\n\nclass SignatureOptions extends DrawingOptions {\n  constructor() {\n    super();\n\n    super.updateProperties({\n      fill: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 0,\n    });\n  }\n\n  clone() {\n    const clone = new SignatureOptions();\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\nclass DrawnSignatureOptions extends InkDrawingOptions {\n  constructor(viewerParameters) {\n    super(viewerParameters);\n\n    super.updateProperties({\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 1,\n    });\n  }\n\n  clone() {\n    const clone = new DrawnSignatureOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic editor in order to generate an Stamp annotation annotation containing\n * a signature drawing.\n */\nclass SignatureEditor extends DrawingEditor {\n  #isExtracted = false;\n\n  #description = null;\n\n  #signatureData = null;\n\n  #signatureUUID = null;\n\n  static _type = \"signature\";\n\n  static _editorType = AnnotationEditorType.SIGNATURE;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, mustBeCommitted: true, name: \"signatureEditor\" });\n    this._willKeepAspectRatio = true;\n    this.#signatureData = params.signatureData || null;\n    this.#description = null;\n    this.defaultL10nId = \"pdfjs-editor-signature-editor1\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n\n    this._defaultDrawingOptions = new SignatureOptions();\n    this._defaultDrawnSignatureOptions = new DrawnSignatureOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  static get typesMap() {\n    return shadow(this, \"typesMap\", new Map());\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"signature\",\n      hasDescription: !!this.#description,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasDescriptionStats = data.get(\"hasDescription\");\n    return {\n      hasAltText: hasDescriptionStats.get(true) ?? 0,\n      hasNoAltText: hasDescriptionStats.get(false) ?? 0,\n    };\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (this._drawId === null) {\n      return;\n    }\n    super.onScaleChanging();\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    const { _isCopy } = this;\n    if (_isCopy) {\n      // No need to adjust the position when rendering in DrawingEditor.\n      this._isCopy = false;\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n\n    if (this._drawId === null) {\n      if (this.#signatureData) {\n        const {\n          lines,\n          mustSmooth,\n          areContours,\n          description,\n          uuid,\n          heightInPage,\n        } = this.#signatureData;\n        const {\n          rawDims: { pageWidth, pageHeight },\n          rotation,\n        } = this.parent.viewport;\n        const outline = SignatureExtractor.processDrawnLines({\n          lines,\n          pageWidth,\n          pageHeight,\n          rotation,\n          innerMargin: SignatureEditor._INNER_MARGIN,\n          mustSmooth,\n          areContours,\n        });\n        this.addSignature(outline, heightInPage, description, uuid);\n      } else {\n        // Avoid Firefox crashing (with a local build) because the description\n        // parameter is missing.\n        this.div.setAttribute(\n          \"data-l10n-args\",\n          JSON.stringify({ description: \"\" })\n        );\n        this.div.hidden = true;\n        this._uiManager.getSignature(this);\n      }\n    } else {\n      this.div.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ description: this.#description || \"\" })\n      );\n    }\n\n    if (_isCopy) {\n      this._isCopy = true;\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return this.div;\n  }\n\n  setUuid(uuid) {\n    this.#signatureUUID = uuid;\n    this.addEditToolbar();\n  }\n\n  getUuid() {\n    return this.#signatureUUID;\n  }\n\n  get description() {\n    return this.#description;\n  }\n\n  set description(description) {\n    this.#description = description;\n    if (!this.div) {\n      return;\n    }\n    this.div.setAttribute(\"data-l10n-args\", JSON.stringify({ description }));\n    super.addEditToolbar().then(toolbar => {\n      toolbar?.updateEditSignatureButton(description);\n    });\n  }\n\n  getSignaturePreview() {\n    const { newCurves, areContours, thickness, width, height } =\n      this.#signatureData;\n    const maxDim = Math.max(width, height);\n    const outlineData = SignatureExtractor.processDrawnLines({\n      lines: {\n        curves: newCurves.map(points => ({ points })),\n        thickness,\n        width,\n        height,\n      },\n      pageWidth: maxDim,\n      pageHeight: maxDim,\n      rotation: 0,\n      innerMargin: 0,\n      mustSmooth: false,\n      areContours,\n    });\n    return { areContours, outline: outlineData.outline };\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.signatureManager) {\n      return [[\"editSignature\", this._uiManager.signatureManager]];\n    }\n    return super.toolbarButtons;\n  }\n\n  addSignature(data, heightInPage, description, uuid) {\n    const { x: savedX, y: savedY } = this;\n    const { outline } = (this.#signatureData = data);\n    this.#isExtracted = outline instanceof ContourDrawOutline;\n    this.description = description;\n    let drawingOptions;\n    if (this.#isExtracted) {\n      drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      drawingOptions = SignatureEditor._defaultDrawnSignatureOptions.clone();\n      drawingOptions.updateProperties({ \"stroke-width\": outline.thickness });\n    }\n    this._addOutlines({\n      drawOutlines: outline,\n      drawingOptions,\n    });\n    const [, pageHeight] = this.pageDimensions;\n    let newHeight = heightInPage / pageHeight;\n    // Ensure the signature doesn't exceed the page height.\n    // If the signature is too big, we scale it down to 50% of the page height.\n    newHeight = newHeight >= 1 ? 0.5 : newHeight;\n\n    this.width *= newHeight / this.height;\n    if (this.width >= 1) {\n      newHeight *= 0.9 / this.width;\n      this.width = 0.9;\n    }\n\n    this.height = newHeight;\n    this.setDims();\n    this.x = savedX;\n    this.y = savedY;\n    this.center();\n\n    this._onResized();\n    this.onScaleChanging();\n    this.rotate();\n    this._uiManager.addToAnnotationStorage(this);\n    this.setUuid(uuid);\n\n    this._reportTelemetry({\n      action: \"pdfjs.signature.inserted\",\n      data: {\n        hasBeenSaved: !!uuid,\n        hasDescription: !!description,\n      },\n    });\n\n    this.div.hidden = false;\n  }\n\n  getFromImage(bitmap) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.process(\n      bitmap,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getFromText(text, fontInfo) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.extractContoursFromText(\n      text,\n      fontInfo,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getDrawnSignature(curves) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.processDrawnLines({\n      lines: curves,\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin: SignatureEditor._INNER_MARGIN,\n      mustSmooth: false,\n      areContours: false,\n    });\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ areContours, thickness }) {\n    if (areContours) {\n      this._drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      this._drawingOptions =\n        SignatureEditor._defaultDrawnSignatureOptions.clone();\n      this._drawingOptions.updateProperties({ \"stroke-width\": thickness });\n    }\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const { lines, points } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: { \"stroke-width\": thickness },\n    } = this;\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      isSignature: true,\n      areContours: this.#isExtracted,\n      color: [0, 0, 0],\n      thickness: this.#isExtracted ? 0 : thickness,\n    });\n    this.addComment(serialized);\n    if (isForCopying) {\n      serialized.paths = { lines, points };\n      serialized.uuid = this.#signatureUUID;\n      serialized.isCopy = true;\n    } else {\n      serialized.lines = lines;\n    }\n    if (this.#description) {\n      serialized.accessibilityData = { type: \"Figure\", alt: this.#description };\n    }\n    return serialized;\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    if (data.areContours) {\n      return ContourDrawOutline.deserialize(\n        pageX,\n        pageY,\n        pageWidth,\n        pageHeight,\n        innerMargin,\n        data\n      );\n    }\n\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#isExtracted = data.areContours;\n    editor.description = data.accessibilityData?.alt || \"\";\n    editor.#signatureUUID = data.uuid;\n    return editor;\n  }\n}\n\nexport { SignatureEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, AnnotationPrefix } from \"../../shared/util.js\";\nimport {\n  ColorScheme,\n  OutputScale,\n  PixelsPerInch,\n  SupportedImageMimeTypes,\n} from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { StampAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass StampEditor extends AnnotationEditor {\n  #bitmap = null;\n\n  #bitmapId = null;\n\n  #bitmapPromise = null;\n\n  #bitmapUrl = null;\n\n  #bitmapFile = null;\n\n  #bitmapFileName = \"\";\n\n  #canvas = null;\n\n  #missingCanvas = false;\n\n  #resizeTimeoutId = null;\n\n  #isSvg = false;\n\n  #hasBeenAddedInUndoStack = false;\n\n  static _type = \"stamp\";\n\n  static _editorType = AnnotationEditorType.STAMP;\n\n  constructor(params) {\n    super({ ...params, name: \"stampEditor\" });\n    this.#bitmapUrl = params.bitmapUrl;\n    this.#bitmapFile = params.bitmapFile;\n    this.defaultL10nId = \"pdfjs-editor-stamp-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n  }\n\n  /** @inheritdoc */\n  static isHandlingMimeForPasting(mime) {\n    return SupportedImageMimeTypes.includes(mime);\n  }\n\n  /** @inheritdoc */\n  static paste(item, parent) {\n    parent.pasteEditor(\n      { mode: AnnotationEditorType.STAMP },\n      { bitmapFile: item.getAsFile() }\n    );\n  }\n\n  /** @inheritdoc */\n  altTextFinish() {\n    if (this._uiManager.useNewAltTextFlow) {\n      this.div.hidden = false;\n    }\n    super.altTextFinish();\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"stamp\",\n      hasAltText: !!this.altTextData?.altText,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasAltTextStats = data.get(\"hasAltText\");\n    return {\n      hasAltText: hasAltTextStats.get(true) ?? 0,\n      hasNoAltText: hasAltTextStats.get(false) ?? 0,\n    };\n  }\n\n  #getBitmapFetched(data, fromId = false) {\n    if (!data) {\n      this.remove();\n      return;\n    }\n    this.#bitmap = data.bitmap;\n    if (!fromId) {\n      this.#bitmapId = data.id;\n      this.#isSvg = data.isSvg;\n    }\n    if (data.file) {\n      this.#bitmapFileName = data.file.name;\n    }\n    this.#createCanvas();\n  }\n\n  #getBitmapDone() {\n    this.#bitmapPromise = null;\n    this._uiManager.enableWaiting(false);\n    if (!this.#canvas) {\n      return;\n    }\n    if (\n      this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this.addEditToolbar().then(() => {\n        this._editToolbar.hide();\n        this._uiManager.editAltText(this, /* firstTime = */ true);\n      });\n      return;\n    }\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this._reportTelemetry({\n        action: \"pdfjs.image.image_added\",\n        data: { alt_text_modal: false, alt_text_type: \"empty\" },\n      });\n      try {\n        // The alt-text dialog isn't opened but we still want to guess the alt\n        // text.\n        this.mlGuessAltText();\n      } catch {}\n    }\n\n    this.div.focus();\n  }\n\n  async mlGuessAltText(imageData = null, updateAltTextData = true) {\n    if (this.hasAltTextData()) {\n      return null;\n    }\n\n    const { mlManager } = this._uiManager;\n    if (!mlManager) {\n      throw new Error(\"No ML.\");\n    }\n    if (!(await mlManager.isEnabledFor(\"altText\"))) {\n      throw new Error(\"ML isn't enabled for alt text.\");\n    }\n    const { data, width, height } =\n      imageData ||\n      this.copyCanvas(null, null, /* createImageData = */ true).imageData;\n    const response = await mlManager.guess({\n      name: \"altText\",\n      request: {\n        data,\n        width,\n        height,\n        channels: data.length / (width * height),\n      },\n    });\n    if (!response) {\n      throw new Error(\"No response from the AI service.\");\n    }\n    if (response.error) {\n      throw new Error(\"Error from the AI service.\");\n    }\n    if (response.cancel) {\n      return null;\n    }\n    if (!response.output) {\n      throw new Error(\"No valid response from the AI service.\");\n    }\n    const altText = response.output;\n    await this.setGuessedAltText(altText);\n    if (updateAltTextData && !this.hasAltTextData()) {\n      this.altTextData = { alt: altText, decorative: false };\n    }\n    return altText;\n  }\n\n  #getBitmap() {\n    if (this.#bitmapId) {\n      this._uiManager.enableWaiting(true);\n      this._uiManager.imageManager\n        .getFromId(this.#bitmapId)\n        .then(data => this.#getBitmapFetched(data, /* fromId = */ true))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapUrl) {\n      const url = this.#bitmapUrl;\n      this.#bitmapUrl = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromUrl(url)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapFile) {\n      const file = this.#bitmapFile;\n      this.#bitmapFile = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromFile(file)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    const input = document.createElement(\"input\");\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      input.hidden = true;\n      input.id = \"stampEditorFileInput\";\n      document.body.append(input);\n    }\n    input.type = \"file\";\n    input.accept = SupportedImageMimeTypes.join(\",\");\n    const signal = this._uiManager._signal;\n    this.#bitmapPromise = new Promise(resolve => {\n      input.addEventListener(\n        \"change\",\n        async () => {\n          if (!input.files || input.files.length === 0) {\n            this.remove();\n          } else {\n            this._uiManager.enableWaiting(true);\n            const data = await this._uiManager.imageManager.getFromFile(\n              input.files[0]\n            );\n            this._reportTelemetry({\n              action: \"pdfjs.image.image_selected\",\n              data: { alt_text_modal: this._uiManager.useNewAltTextFlow },\n            });\n            this.#getBitmapFetched(data);\n          }\n          if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n            input.remove();\n          }\n          resolve();\n        },\n        { signal }\n      );\n      input.addEventListener(\n        \"cancel\",\n        () => {\n          this.remove();\n          resolve();\n        },\n        { signal }\n      );\n    }).finally(() => this.#getBitmapDone());\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"TESTING\")) {\n      input.click();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.#bitmapId) {\n      this.#bitmap = null;\n      this._uiManager.imageManager.deleteId(this.#bitmapId);\n      this.#canvas?.remove();\n      this.#canvas = null;\n      if (this.#resizeTimeoutId) {\n        clearTimeout(this.#resizeTimeoutId);\n        this.#resizeTimeoutId = null;\n      }\n    }\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      // It's possible to have to rebuild an editor which is not on a visible\n      // page.\n      if (this.#bitmapId) {\n        this.#getBitmap();\n      }\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (this.#bitmapId && this.#canvas === null) {\n      this.#getBitmap();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    this._isDraggable = true;\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !(\n      this.#bitmapPromise ||\n      this.#bitmap ||\n      this.#bitmapUrl ||\n      this.#bitmapFile ||\n      this.#bitmapId ||\n      this.#missingCanvas\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    return [[\"altText\", this.createAltText()]];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.div.hidden = true;\n\n    this.createAltText();\n\n    if (!this.#missingCanvas) {\n      if (this.#bitmap) {\n        this.#createCanvas();\n      } else {\n        this.#getBitmap();\n      }\n    }\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    this._uiManager.addShouldRescale(this);\n\n    return this.div;\n  }\n\n  setCanvas(annotationElementId, canvas) {\n    const { id: bitmapId, bitmap } = this._uiManager.imageManager.getFromCanvas(\n      annotationElementId,\n      canvas\n    );\n    canvas.remove();\n    if (bitmapId && this._uiManager.imageManager.isValidId(bitmapId)) {\n      this.#bitmapId = bitmapId;\n      if (bitmap) {\n        this.#bitmap = bitmap;\n      }\n      this.#missingCanvas = false;\n      this.#createCanvas();\n    }\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    // We used a CSS-zoom during the resizing, but now it's resized we can\n    // rescale correctly the bitmap to fit the new dimensions.\n    this.onScaleChanging();\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    if (this.#resizeTimeoutId !== null) {\n      clearTimeout(this.#resizeTimeoutId);\n    }\n    // The user's zooming the page, there is no need to redraw the bitmap at\n    // each step, hence we wait a bit before redrawing it.\n    const TIME_TO_WAIT = 200;\n    this.#resizeTimeoutId = setTimeout(() => {\n      this.#resizeTimeoutId = null;\n      this.#drawBitmap();\n    }, TIME_TO_WAIT);\n  }\n\n  #createCanvas() {\n    const { div } = this;\n    let { width, height } = this.#bitmap;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const MAX_RATIO = 0.75;\n    if (this.width) {\n      width = this.width * pageWidth;\n      height = this.height * pageHeight;\n    } else if (\n      width > MAX_RATIO * pageWidth ||\n      height > MAX_RATIO * pageHeight\n    ) {\n      // If the image is too big compared to the page dimensions\n      // (more than MAX_RATIO) then we scale it down.\n      const factor = Math.min(\n        (MAX_RATIO * pageWidth) / width,\n        (MAX_RATIO * pageHeight) / height\n      );\n      width *= factor;\n      height *= factor;\n    }\n\n    this._uiManager.enableWaiting(false);\n    const canvas = (this.#canvas = document.createElement(\"canvas\"));\n    canvas.setAttribute(\"role\", \"img\");\n    this.addContainer(canvas);\n\n    this.width = width / pageWidth;\n    this.height = height / pageHeight;\n    this.setDims();\n\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    } else {\n      this.fixAndSetPosition();\n    }\n    this._initialOptions = null;\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage ||\n      !this._uiManager.useNewAltTextFlow ||\n      this.annotationElementId\n    ) {\n      div.hidden = false;\n    }\n    this.#drawBitmap();\n    if (!this.#hasBeenAddedInUndoStack) {\n      this.parent.addUndoableEditor(this);\n      this.#hasBeenAddedInUndoStack = true;\n    }\n\n    // There are multiple ways to add an image to the page, so here we just\n    // count the number of times an image is added to the page whatever the way\n    // is.\n    this._reportTelemetry({\n      action: \"inserted_image\",\n    });\n    if (this.#bitmapFileName) {\n      this.div.setAttribute(\"aria-description\", this.#bitmapFileName);\n    }\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-stamp-added-alert\");\n    }\n  }\n\n  copyCanvas(maxDataDimension, maxPreviewDimension, createImageData = false) {\n    if (!maxDataDimension) {\n      // TODO: get this value from Firefox\n      //   (https://bugzilla.mozilla.org/show_bug.cgi?id=1908184)\n      // It's the maximum dimension that the AI can handle.\n      maxDataDimension = 224;\n    }\n\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n    const outputScale = new OutputScale();\n\n    let bitmap = this.#bitmap;\n    let width = bitmapWidth,\n      height = bitmapHeight;\n    let canvas = null;\n\n    if (maxPreviewDimension) {\n      if (\n        bitmapWidth > maxPreviewDimension ||\n        bitmapHeight > maxPreviewDimension\n      ) {\n        const ratio = Math.min(\n          maxPreviewDimension / bitmapWidth,\n          maxPreviewDimension / bitmapHeight\n        );\n        width = Math.floor(bitmapWidth * ratio);\n        height = Math.floor(bitmapHeight * ratio);\n      }\n\n      canvas = document.createElement(\"canvas\");\n      const scaledWidth = (canvas.width = Math.ceil(width * outputScale.sx));\n      const scaledHeight = (canvas.height = Math.ceil(height * outputScale.sy));\n\n      if (!this.#isSvg) {\n        bitmap = this.#scaleBitmap(scaledWidth, scaledHeight);\n      }\n\n      const ctx = canvas.getContext(\"2d\");\n      ctx.filter = this._uiManager.hcmFilter;\n\n      // Add a checkerboard pattern as a background in case the image has some\n      // transparency.\n      let white = \"white\",\n        black = \"#cfcfd8\";\n      if (this._uiManager.hcmFilter !== \"none\") {\n        black = \"black\";\n      } else if (ColorScheme.isDarkMode) {\n        white = \"#8f8f9d\";\n        black = \"#42414d\";\n      }\n      const boxDim = 15;\n      const boxDimWidth = boxDim * outputScale.sx;\n      const boxDimHeight = boxDim * outputScale.sy;\n      const pattern = new OffscreenCanvas(boxDimWidth * 2, boxDimHeight * 2);\n      const patternCtx = pattern.getContext(\"2d\");\n      patternCtx.fillStyle = white;\n      patternCtx.fillRect(0, 0, boxDimWidth * 2, boxDimHeight * 2);\n      patternCtx.fillStyle = black;\n      patternCtx.fillRect(0, 0, boxDimWidth, boxDimHeight);\n      patternCtx.fillRect(boxDimWidth, boxDimHeight, boxDimWidth, boxDimHeight);\n      ctx.fillStyle = ctx.createPattern(pattern, \"repeat\");\n      ctx.fillRect(0, 0, scaledWidth, scaledHeight);\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        scaledWidth,\n        scaledHeight\n      );\n    }\n\n    let imageData = null;\n    if (createImageData) {\n      let dataWidth, dataHeight;\n      if (\n        outputScale.symmetric &&\n        bitmap.width < maxDataDimension &&\n        bitmap.height < maxDataDimension\n      ) {\n        dataWidth = bitmap.width;\n        dataHeight = bitmap.height;\n      } else {\n        bitmap = this.#bitmap;\n        if (bitmapWidth > maxDataDimension || bitmapHeight > maxDataDimension) {\n          const ratio = Math.min(\n            maxDataDimension / bitmapWidth,\n            maxDataDimension / bitmapHeight\n          );\n          dataWidth = Math.floor(bitmapWidth * ratio);\n          dataHeight = Math.floor(bitmapHeight * ratio);\n\n          if (!this.#isSvg) {\n            bitmap = this.#scaleBitmap(dataWidth, dataHeight);\n          }\n        }\n      }\n\n      const offscreen = new OffscreenCanvas(dataWidth, dataHeight);\n      const offscreenCtx = offscreen.getContext(\"2d\", {\n        willReadFrequently: true,\n      });\n      offscreenCtx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        dataWidth,\n        dataHeight\n      );\n      imageData = {\n        width: dataWidth,\n        height: dataHeight,\n        data: offscreenCtx.getImageData(0, 0, dataWidth, dataHeight).data,\n      };\n    }\n\n    return { canvas, width, height, imageData };\n  }\n\n  #scaleBitmap(width, height) {\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n\n    let newWidth = bitmapWidth;\n    let newHeight = bitmapHeight;\n    let bitmap = this.#bitmap;\n    while (newWidth > 2 * width || newHeight > 2 * height) {\n      const prevWidth = newWidth;\n      const prevHeight = newHeight;\n\n      if (newWidth > 2 * width) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(newWidth / 2);\n        newWidth =\n          newWidth >= 16384\n            ? Math.floor(newWidth / 2) - 1\n            : Math.ceil(newWidth / 2);\n      }\n      if (newHeight > 2 * height) {\n        newHeight =\n          newHeight >= 16384\n            ? Math.floor(newHeight / 2) - 1\n            : Math.ceil(newHeight / 2);\n      }\n\n      const offscreen = new OffscreenCanvas(newWidth, newHeight);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        prevWidth,\n        prevHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      bitmap = offscreen.transferToImageBitmap();\n    }\n\n    return bitmap;\n  }\n\n  #drawBitmap() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { width, height } = this;\n    const outputScale = new OutputScale();\n    const scaledWidth = Math.ceil(width * parentWidth * outputScale.sx);\n    const scaledHeight = Math.ceil(height * parentHeight * outputScale.sy);\n    const canvas = this.#canvas;\n\n    if (\n      !canvas ||\n      (canvas.width === scaledWidth && canvas.height === scaledHeight)\n    ) {\n      return;\n    }\n\n    canvas.width = scaledWidth;\n    canvas.height = scaledHeight;\n\n    const bitmap = this.#isSvg\n      ? this.#bitmap\n      : this.#scaleBitmap(scaledWidth, scaledHeight);\n\n    const ctx = canvas.getContext(\"2d\");\n    ctx.filter = this._uiManager.hcmFilter;\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      scaledWidth,\n      scaledHeight\n    );\n  }\n\n  #serializeBitmap(toUrl) {\n    if (toUrl) {\n      if (this.#isSvg) {\n        const url = this._uiManager.imageManager.getSvgUrl(this.#bitmapId);\n        if (url) {\n          return url;\n        }\n      }\n      // We convert to a data url because it's sync and the url can live in the\n      // clipboard.\n      const canvas = document.createElement(\"canvas\");\n      ({ width: canvas.width, height: canvas.height } = this.#bitmap);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(this.#bitmap, 0, 0);\n\n      return canvas.toDataURL();\n    }\n\n    if (this.#isSvg) {\n      const [pageWidth, pageHeight] = this.pageDimensions;\n      // Multiply by PixelsPerInch.PDF_TO_CSS_UNITS in order to increase the\n      // image resolution when rasterizing it.\n      const width = Math.round(\n        this.width * pageWidth * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const height = Math.round(\n        this.height * pageHeight * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        this.#bitmap,\n        0,\n        0,\n        this.#bitmap.width,\n        this.#bitmap.height,\n        0,\n        0,\n        width,\n        height\n      );\n      return offscreen.transferToImageBitmap();\n    }\n\n    return structuredClone(this.#bitmap);\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    let missingCanvas = false;\n    if (data instanceof StampAnnotationElement) {\n      const {\n        data: {\n          rect,\n          rotation,\n          id,\n          structParent,\n          popupRef,\n          richText,\n          contentsObj,\n          creationDate,\n          modificationDate,\n        },\n        container,\n        parent: {\n          page: { pageNumber },\n        },\n        canvas,\n      } = data;\n      let bitmapId, bitmap;\n      if (canvas) {\n        delete data.canvas;\n        ({ id: bitmapId, bitmap } = uiManager.imageManager.getFromCanvas(\n          container.id,\n          canvas\n        ));\n        canvas.remove();\n      } else {\n        missingCanvas = true;\n        data._hasNoCanvas = true;\n      }\n\n      // When switching to edit mode, we wait for the structure tree to be\n      // ready (see pdf_viewer.js), so it's fine to use getAriaAttributesSync.\n      const altText =\n        (\n          await parent._structTree.getAriaAttributes(`${AnnotationPrefix}${id}`)\n        )?.get(\"aria-label\") || \"\";\n\n      initialData = data = {\n        annotationType: AnnotationEditorType.STAMP,\n        bitmapId,\n        bitmap,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        accessibilityData: {\n          decorative: false,\n          altText,\n        },\n        isSvg: false,\n        structParent,\n        popupRef,\n        richText,\n        comment: contentsObj?.str || null,\n        creationDate,\n        modificationDate,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    const { rect, bitmap, bitmapUrl, bitmapId, isSvg, accessibilityData } =\n      data;\n    if (missingCanvas) {\n      uiManager.addMissingCanvas(data.id, editor);\n      editor.#missingCanvas = true;\n    } else if (bitmapId && uiManager.imageManager.isValidId(bitmapId)) {\n      editor.#bitmapId = bitmapId;\n      if (bitmap) {\n        editor.#bitmap = bitmap;\n      }\n    } else {\n      editor.#bitmapUrl = bitmapUrl;\n    }\n    editor.#isSvg = isSvg;\n\n    const [parentWidth, parentHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / parentWidth;\n    editor.height = (rect[3] - rect[1]) / parentHeight;\n\n    if (accessibilityData) {\n      editor.altTextData = accessibilityData;\n    }\n    editor._initialData = initialData;\n    if (data.comment) {\n      editor.setCommentData(data);\n    }\n    // No need to be add in the undo stack if the editor is created from an\n    // existing one.\n    editor.#hasBeenAddedInUndoStack = !!initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false, context = null) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const serialized = Object.assign(super.serialize(isForCopying), {\n      bitmapId: this.#bitmapId,\n      isSvg: this.#isSvg,\n    });\n    this.addComment(serialized);\n\n    if (isForCopying) {\n      // We don't know what's the final destination (this pdf or another one)\n      // of this annotation and the clipboard doesn't support ImageBitmaps,\n      // hence we serialize the bitmap to a data url.\n      serialized.bitmapUrl = this.#serializeBitmap(/* toUrl = */ true);\n      serialized.accessibilityData = this.serializeAltText(true);\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    const { decorative, altText } = this.serializeAltText(false);\n    if (!decorative && altText) {\n      serialized.accessibilityData = { type: \"Figure\", alt: altText };\n    }\n    if (this.annotationElementId) {\n      const changes = this.#hasElementChanged(serialized);\n      if (changes.isSame) {\n        // Nothing has been changed.\n        return null;\n      }\n      if (changes.isSameAltText) {\n        delete serialized.accessibilityData;\n      } else {\n        serialized.accessibilityData.structParent =\n          this._initialData.structParent ?? -1;\n      }\n      serialized.id = this.annotationElementId;\n      delete serialized.bitmapId;\n      return serialized;\n    }\n\n    if (context === null) {\n      return serialized;\n    }\n\n    context.stamps ||= new Map();\n    const area = this.#isSvg\n      ? (serialized.rect[2] - serialized.rect[0]) *\n        (serialized.rect[3] - serialized.rect[1])\n      : null;\n    if (!context.stamps.has(this.#bitmapId)) {\n      // We don't want to have multiple copies of the same bitmap in the\n      // annotationMap, hence we only add the bitmap the first time we meet it.\n      context.stamps.set(this.#bitmapId, { area, serialized });\n      serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n    } else if (this.#isSvg) {\n      // If we have multiple copies of the same svg but with different sizes,\n      // then we want to keep the biggest one.\n      const prevData = context.stamps.get(this.#bitmapId);\n      if (area > prevData.area) {\n        prevData.area = area;\n        prevData.serialized.bitmap.close();\n        prevData.serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n      }\n    }\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const {\n      pageIndex,\n      accessibilityData: { altText },\n    } = this._initialData;\n\n    const isSamePageIndex = serialized.pageIndex === pageIndex;\n    const isSameAltText = (serialized.accessibilityData?.alt || \"\") === altText;\n\n    return {\n      isSame:\n        !this.hasEditedComment &&\n        !this._hasBeenMoved &&\n        !this._hasBeenResized &&\n        isSamePageIndex &&\n        isSameAltText,\n      isSameAltText,\n    };\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    if (this.deleted) {\n      annotation.hide();\n      return null;\n    }\n    annotation.updateEdited({\n      rect: this.getPDFRect(),\n      popup: this.comment,\n    });\n\n    return null;\n  }\n}\n\nexport { StampEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n/** @typedef {import(\"../display_utils.js\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"../../../web/interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n/** @typedef {import(\"../draw_layer.js\").DrawLayer} DrawLayer */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n\nimport {\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextEditor } from \"./freetext.js\";\nimport { HighlightEditor } from \"./highlight.js\";\nimport { InkEditor } from \"./ink.js\";\nimport { setLayerDimensions } from \"../display_utils.js\";\nimport { SignatureEditor } from \"./signature.js\";\nimport { StampEditor } from \"./stamp.js\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerOptions\n * @property {Object} mode\n * @property {HTMLDivElement} div\n * @property {StructTreeLayerBuilder} structTreeLayer\n * @property {AnnotationEditorUIManager} uiManager\n * @property {boolean} enabled\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {number} pageIndex\n * @property {IL10n} l10n\n * @property {AnnotationLayer} [annotationLayer]\n * @property {HTMLDivElement} [textLayer]\n * @property {DrawLayer} drawLayer\n * @property {PageViewport} viewport\n */\n\n/**\n * @typedef {Object} RenderEditorLayerOptions\n * @property {PageViewport} viewport\n */\n\n/**\n * Manage all the different editors on a page.\n */\nclass AnnotationEditorLayer {\n  #accessibilityManager;\n\n  #allowClick = false;\n\n  #annotationLayer = null;\n\n  #clickAC = null;\n\n  #editorFocusTimeoutId = null;\n\n  #editors = new Map();\n\n  #hadPointerDown = false;\n\n  #isDisabling = false;\n\n  #isEnabling = false;\n\n  #drawingAC = null;\n\n  #focusedElement = null;\n\n  #textLayer = null;\n\n  #textSelectionAC = null;\n\n  #textLayerDblClickAC = null;\n\n  #lastPointerDownTimestamp = -1;\n\n  #uiManager;\n\n  static _initialized = false;\n\n  static #editorTypes = new Map(\n    [\n      FreeTextEditor,\n      InkEditor,\n      StampEditor,\n      HighlightEditor,\n      SignatureEditor,\n    ].map(type => [type._editorType, type])\n  );\n\n  /**\n   * @param {AnnotationEditorLayerOptions} options\n   */\n  constructor({\n    uiManager,\n    pageIndex,\n    div,\n    structTreeLayer,\n    accessibilityManager,\n    annotationLayer,\n    drawLayer,\n    textLayer,\n    viewport,\n    l10n,\n  }) {\n    const editorTypes = [...AnnotationEditorLayer.#editorTypes.values()];\n    if (!AnnotationEditorLayer._initialized) {\n      AnnotationEditorLayer._initialized = true;\n      for (const editorType of editorTypes) {\n        editorType.initialize(l10n, uiManager);\n      }\n    }\n    uiManager.registerEditorTypes(editorTypes);\n\n    this.#uiManager = uiManager;\n    this.pageIndex = pageIndex;\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationLayer = annotationLayer;\n    this.viewport = viewport;\n    this.#textLayer = textLayer;\n    this.drawLayer = drawLayer;\n    this._structTree = structTreeLayer;\n\n    this.#uiManager.addLayer(this);\n  }\n\n  get isEmpty() {\n    return this.#editors.size === 0;\n  }\n\n  get isInvisible() {\n    return (\n      this.isEmpty && this.#uiManager.getMode() === AnnotationEditorType.NONE\n    );\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   */\n  updateToolbar(options) {\n    this.#uiManager.updateToolbar(options);\n  }\n\n  /**\n   * The mode has changed: it must be updated.\n   * @param {number} mode\n   */\n  updateMode(mode = this.#uiManager.getMode()) {\n    this.#cleanup();\n    switch (mode) {\n      case AnnotationEditorType.NONE:\n        this.div.classList.toggle(\"nonEditing\", true);\n        this.disableTextSelection();\n        this.togglePointerEvents(false);\n        this.toggleAnnotationLayerPointerEvents(true);\n        this.disableClick();\n        return;\n      case AnnotationEditorType.INK:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n        break;\n      case AnnotationEditorType.HIGHLIGHT:\n        this.enableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      default:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n    }\n\n    this.toggleAnnotationLayerPointerEvents(false);\n    const { classList } = this.div;\n    classList.toggle(\"nonEditing\", false);\n    if (mode === AnnotationEditorType.POPUP) {\n      classList.toggle(\"commentEditing\", true);\n    } else {\n      classList.toggle(\"commentEditing\", false);\n      for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n        classList.toggle(\n          `${editorType._type}Editing`,\n          mode === editorType._editorType\n        );\n      }\n    }\n    this.div.hidden = false;\n  }\n\n  hasTextLayer(textLayer) {\n    return textLayer === this.#textLayer?.div;\n  }\n\n  /**\n   * Set the editing state.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    this.#uiManager.setEditingState(isEditing);\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#uiManager.addCommands(params);\n  }\n\n  cleanUndoStack(type) {\n    this.#uiManager.cleanUndoStack(type);\n  }\n\n  toggleDrawing(enabled = false) {\n    this.div.classList.toggle(\"drawing\", !enabled);\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  toggleAnnotationLayerPointerEvents(enabled = false) {\n    this.#annotationLayer?.togglePointerEvents(enabled);\n  }\n\n  get #allEditorsIterator() {\n    return this.#editors.size !== 0\n      ? this.#editors.values()\n      : this.#uiManager.getEditors(this.pageIndex);\n  }\n\n  /**\n   * Enable pointer events on the main div in order to enable\n   * editor creation.\n   */\n  async enable() {\n    this.#isEnabling = true;\n    this.div.tabIndex = 0;\n    this.togglePointerEvents(true);\n    this.div.classList.toggle(\"nonEditing\", false);\n    this.#textLayerDblClickAC?.abort();\n    this.#textLayerDblClickAC = null;\n    const annotationElementIds = new Set();\n    for (const editor of this.#allEditorsIterator) {\n      editor.enableEditing();\n      editor.show(true);\n      if (editor.annotationElementId) {\n        this.#uiManager.removeChangedExistingAnnotation(editor);\n        annotationElementIds.add(editor.annotationElementId);\n      }\n    }\n\n    const annotationLayer = this.#annotationLayer;\n    if (annotationLayer) {\n      for (const editable of annotationLayer.getEditableAnnotations()) {\n        // The element must be hidden whatever its state is.\n        editable.hide();\n        if (this.#uiManager.isDeletedAnnotationElement(editable.data.id)) {\n          continue;\n        }\n        if (annotationElementIds.has(editable.data.id)) {\n          continue;\n        }\n        const editor = await this.deserialize(editable);\n        if (!editor) {\n          continue;\n        }\n        this.addOrRebuild(editor);\n        editor.enableEditing();\n      }\n    }\n    this.#isEnabling = false;\n    this.#uiManager._eventBus.dispatch(\"editorsrendered\", {\n      source: this,\n      pageNumber: this.pageIndex + 1,\n    });\n  }\n\n  /**\n   * Disable editor creation.\n   */\n  disable() {\n    this.#isDisabling = true;\n    this.div.tabIndex = -1;\n    this.togglePointerEvents(false);\n    this.div.classList.toggle(\"nonEditing\", true);\n    if (this.#textLayer && !this.#textLayerDblClickAC) {\n      this.#textLayerDblClickAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textLayerDblClickAC);\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        e => {\n          // It's the default value in Fenix:\n          // https://searchfox.org/mozilla-central/rev/beba5cde846f944c4d709e75cbe499d17af880a4/modules/libpref/init/StaticPrefList.yaml#19064\n          // and in Chrome and Windows:\n          // https://source.chromium.org/chromium/chromium/src/+/main:ui/events/event_constants.h;drc=f0f5f3ceebb00da9363ccc7a1e2c0f17b6b383ba;l=115\n          const DBL_CLICK_THRESHOLD = 500;\n          const { clientX, clientY, timeStamp } = e;\n          const lastPointerDownTimestamp = this.#lastPointerDownTimestamp;\n          if (timeStamp - lastPointerDownTimestamp > DBL_CLICK_THRESHOLD) {\n            this.#lastPointerDownTimestamp = timeStamp;\n            return;\n          }\n          this.#lastPointerDownTimestamp = -1;\n          const { classList } = this.div;\n          classList.toggle(\"getElements\", true);\n          const elements = document.elementsFromPoint(clientX, clientY);\n          classList.toggle(\"getElements\", false);\n          if (!this.div.contains(elements[0])) {\n            return;\n          }\n          let id;\n          const regex = new RegExp(`^${AnnotationEditorPrefix}[0-9]+$`);\n          for (const element of elements) {\n            if (regex.test(element.id)) {\n              id = element.id;\n              break;\n            }\n          }\n          if (!id) {\n            return;\n          }\n          const editor = this.#editors.get(id);\n          if (editor?.annotationElementId === null) {\n            e.stopPropagation();\n            e.preventDefault();\n            editor.dblclick(e);\n          }\n        },\n        { signal, capture: true }\n      );\n    }\n\n    const annotationLayer = this.#annotationLayer;\n    const needFakeAnnotation = [];\n    if (annotationLayer) {\n      const changedAnnotations = new Map();\n      const resetAnnotations = new Map();\n      for (const editor of this.#allEditorsIterator) {\n        editor.disableEditing();\n        if (!editor.annotationElementId) {\n          needFakeAnnotation.push(editor);\n          continue;\n        }\n        if (editor.serialize() !== null) {\n          changedAnnotations.set(editor.annotationElementId, editor);\n          continue;\n        } else {\n          resetAnnotations.set(editor.annotationElementId, editor);\n        }\n        this.getEditableAnnotation(editor.annotationElementId)?.show();\n        editor.remove();\n      }\n\n      // Show the annotations that were hidden in enable().\n      const editables = annotationLayer.getEditableAnnotations();\n      for (const editable of editables) {\n        const { id } = editable.data;\n        if (this.#uiManager.isDeletedAnnotationElement(id)) {\n          editable.updateEdited({ deleted: true });\n          continue;\n        }\n        let editor = resetAnnotations.get(id);\n        if (editor) {\n          editor.resetAnnotationElement(editable);\n          editor.show(false);\n          editable.show();\n          continue;\n        }\n\n        editor = changedAnnotations.get(id);\n        if (editor) {\n          this.#uiManager.addChangedExistingAnnotation(editor);\n          if (editor.renderAnnotationElement(editable)) {\n            // Content has changed, so we need to hide the editor.\n            editor.show(false);\n          }\n        }\n        editable.show();\n      }\n    }\n\n    this.#cleanup();\n    if (this.isEmpty) {\n      this.div.hidden = true;\n    }\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.remove(`${editorType._type}Editing`);\n    }\n    this.disableTextSelection();\n    this.toggleAnnotationLayerPointerEvents(true);\n    annotationLayer?.updateFakeAnnotations(needFakeAnnotation);\n\n    this.#isDisabling = false;\n  }\n\n  getEditableAnnotation(id) {\n    return this.#annotationLayer?.getEditableAnnotation(id) || null;\n  }\n\n  /**\n   * Set the current editor.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    const currentActive = this.#uiManager.getActive();\n    if (currentActive === editor) {\n      return;\n    }\n\n    this.#uiManager.setActiveEditor(editor);\n  }\n\n  enableTextSelection() {\n    this.div.tabIndex = -1;\n    if (this.#textLayer?.div && !this.#textSelectionAC) {\n      this.#textSelectionAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textSelectionAC);\n\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        this.#textLayerPointerDown.bind(this),\n        { signal }\n      );\n      this.#textLayer.div.classList.add(\"highlighting\");\n    }\n  }\n\n  disableTextSelection() {\n    this.div.tabIndex = 0;\n    if (this.#textLayer?.div && this.#textSelectionAC) {\n      this.#textSelectionAC.abort();\n      this.#textSelectionAC = null;\n\n      this.#textLayer.div.classList.remove(\"highlighting\");\n    }\n  }\n\n  #textLayerPointerDown(event) {\n    // Unselect all the editors in order to let the user select some text\n    // without being annoyed by an editor toolbar.\n    this.#uiManager.unselectAll();\n    const { target } = event;\n    if (\n      target === this.#textLayer.div ||\n      ((target.getAttribute(\"role\") === \"img\" ||\n        target.classList.contains(\"endOfContent\")) &&\n        this.#textLayer.div.contains(target))\n    ) {\n      const { isMac } = FeatureTest.platform;\n      if (event.button !== 0 || (event.ctrlKey && isMac)) {\n        // Do nothing on right click.\n        return;\n      }\n      this.#uiManager.showAllEditors(\n        \"highlight\",\n        true,\n        /* updateButton = */ true\n      );\n      this.#textLayer.div.classList.add(\"free\");\n      this.toggleDrawing();\n      HighlightEditor.startHighlighting(\n        this,\n        this.#uiManager.direction === \"ltr\",\n        { target: this.#textLayer.div, x: event.x, y: event.y }\n      );\n      this.#textLayer.div.addEventListener(\n        \"pointerup\",\n        () => {\n          this.#textLayer.div.classList.remove(\"free\");\n          this.toggleDrawing(true);\n        },\n        { once: true, signal: this.#uiManager._signal }\n      );\n      event.preventDefault();\n    }\n  }\n\n  enableClick() {\n    if (this.#clickAC) {\n      return;\n    }\n    this.#clickAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#clickAC);\n\n    this.div.addEventListener(\"pointerdown\", this.pointerdown.bind(this), {\n      signal,\n    });\n    const pointerup = this.pointerup.bind(this);\n    this.div.addEventListener(\"pointerup\", pointerup, { signal });\n    this.div.addEventListener(\"pointercancel\", pointerup, { signal });\n  }\n\n  disableClick() {\n    this.#clickAC?.abort();\n    this.#clickAC = null;\n  }\n\n  attach(editor) {\n    this.#editors.set(editor.id, editor);\n    const { annotationElementId } = editor;\n    if (\n      annotationElementId &&\n      this.#uiManager.isDeletedAnnotationElement(annotationElementId)\n    ) {\n      this.#uiManager.removeDeletedAnnotationElement(editor);\n    }\n  }\n\n  detach(editor) {\n    this.#editors.delete(editor.id);\n    this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n\n    if (!this.#isDisabling && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n    }\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  remove(editor) {\n    this.detach(editor);\n    this.#uiManager.removeEditor(editor);\n    editor.div.remove();\n    editor.isAttachedToDOM = false;\n  }\n\n  /**\n   * An editor can have a different parent, for example after having\n   * being dragged and dropped from a page to another.\n   * @param {AnnotationEditor} editor\n   */\n  changeParent(editor) {\n    if (editor.parent === this) {\n      return;\n    }\n\n    if (editor.parent && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n      AnnotationEditor.deleteAnnotationElement(editor);\n      editor.annotationElementId = null;\n    }\n\n    this.attach(editor);\n    editor.parent?.detach(editor);\n    editor.setParent(this);\n    if (editor.div && editor.isAttachedToDOM) {\n      editor.div.remove();\n      this.div.append(editor.div);\n    }\n  }\n\n  /**\n   * Add a new editor in the current view.\n   * @param {AnnotationEditor} editor\n   */\n  add(editor) {\n    if (editor.parent === this && editor.isAttachedToDOM) {\n      return;\n    }\n    this.changeParent(editor);\n    this.#uiManager.addEditor(editor);\n    this.attach(editor);\n\n    if (!editor.isAttachedToDOM) {\n      const div = editor.render();\n      this.div.append(div);\n      editor.isAttachedToDOM = true;\n    }\n\n    // The editor will be correctly moved into the DOM (see fixAndSetPosition).\n    editor.fixAndSetPosition();\n    editor.onceAdded(/* focus = */ !this.#isEnabling);\n    this.#uiManager.addToAnnotationStorage(editor);\n    editor._reportTelemetry(editor.telemetryInitialData);\n  }\n\n  moveEditorInDOM(editor) {\n    if (!editor.isAttachedToDOM) {\n      return;\n    }\n\n    const { activeElement } = document;\n    if (editor.div.contains(activeElement) && !this.#editorFocusTimeoutId) {\n      // When the div is moved in the DOM the focus can move somewhere else,\n      // so we want to be sure that the focus will stay on the editor but we\n      // don't want to call any focus callbacks, hence we disable them and only\n      // re-enable them when the editor has the focus.\n      editor._focusEventsAllowed = false;\n      this.#editorFocusTimeoutId = setTimeout(() => {\n        this.#editorFocusTimeoutId = null;\n        if (!editor.div.contains(document.activeElement)) {\n          editor.div.addEventListener(\n            \"focusin\",\n            () => {\n              editor._focusEventsAllowed = true;\n            },\n            { once: true, signal: this.#uiManager._signal }\n          );\n          activeElement.focus();\n        } else {\n          editor._focusEventsAllowed = true;\n        }\n      }, 0);\n    }\n\n    editor._structTreeParentId = this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      editor.div,\n      editor.contentDiv,\n      /* isRemovable = */ true\n    );\n  }\n\n  /**\n   * Add or rebuild depending if it has been removed or not.\n   * @param {AnnotationEditor} editor\n   */\n  addOrRebuild(editor) {\n    if (editor.needsToBeRebuilt()) {\n      editor.parent ||= this;\n      editor.rebuild();\n      editor.show();\n    } else {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Add a new editor and make this addition undoable.\n   * @param {AnnotationEditor} editor\n   */\n  addUndoableEditor(editor) {\n    const cmd = () => editor._uiManager.rebuild(editor);\n    const undo = () => {\n      editor.remove();\n    };\n\n    this.addCommands({ cmd, undo, mustExec: false });\n  }\n\n  getEditorByUID(uid) {\n    for (const editor of this.#editors.values()) {\n      if (editor.uid === uid) {\n        return editor;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get an id for an editor.\n   * @returns {string}\n   */\n  getNextId() {\n    return this.#uiManager.getId();\n  }\n\n  get #currentEditorType() {\n    return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode());\n  }\n\n  combinedSignal(ac) {\n    return this.#uiManager.combinedSignal(ac);\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} params\n   * @returns {AnnotationEditor}\n   */\n  #createNewEditor(params) {\n    const editorType = this.#currentEditorType;\n    return editorType ? new editorType.prototype.constructor(params) : null;\n  }\n\n  canCreateNewEmptyEditor() {\n    return this.#currentEditorType?.canCreateNewEmptyEditor();\n  }\n\n  /**\n   * Paste some content into a new editor.\n   * @param {Object} options\n   * @param {Object} params\n   */\n  async pasteEditor(options, params) {\n    this.updateToolbar(options);\n    await this.#uiManager.updateMode(options.mode);\n\n    const { offsetX, offsetY } = this.#getCenterPoint();\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: offsetX,\n      y: offsetY,\n      uiManager: this.#uiManager,\n      isCentered: true,\n      ...params,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} data\n   * @returns {Promise<AnnotationEditor | null>}\n   */\n  async deserialize(data) {\n    return (\n      (await AnnotationEditorLayer.#editorTypes\n        .get(data.annotationType ?? data.annotationEditorType)\n        ?.deserialize(data, this, this.#uiManager)) || null\n    );\n  }\n\n  /**\n   * Create and add a new editor.\n   * @param {PointerEvent} event\n   * @param {boolean} isCentered\n   * @param [Object] data\n   * @returns {AnnotationEditor}\n   */\n  createAndAddNewEditor(event, isCentered, data = {}) {\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: event.offsetX,\n      y: event.offsetY,\n      uiManager: this.#uiManager,\n      isCentered,\n      ...data,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n\n    return editor;\n  }\n\n  get boundingClientRect() {\n    return this.div.getBoundingClientRect();\n  }\n\n  #getCenterPoint() {\n    const { x, y, width, height } = this.boundingClientRect;\n    const tlX = Math.max(0, x);\n    const tlY = Math.max(0, y);\n    const brX = Math.min(window.innerWidth, x + width);\n    const brY = Math.min(window.innerHeight, y + height);\n    const centerX = (tlX + brX) / 2 - x;\n    const centerY = (tlY + brY) / 2 - y;\n    const [offsetX, offsetY] =\n      this.viewport.rotation % 180 === 0\n        ? [centerX, centerY]\n        : [centerY, centerX];\n\n    return { offsetX, offsetY };\n  }\n\n  /**\n   * Create and add a new editor.\n   */\n  addNewEditor(data = {}) {\n    this.createAndAddNewEditor(\n      this.#getCenterPoint(),\n      /* isCentered = */ true,\n      data\n    );\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.#uiManager.setSelected(editor);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    this.#uiManager.toggleSelected(editor);\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    this.#uiManager.unselect(editor);\n  }\n\n  /**\n   * Pointerup callback.\n   * @param {PointerEvent} event\n   */\n  pointerup(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Don't create an editor on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    if (!this.#hadPointerDown) {\n      // It can happen when the user starts a drag inside a text editor\n      // and then releases the mouse button outside of it. In such a case\n      // we don't want to create a new editor, hence we check that a pointerdown\n      // occurred on this div previously.\n      return;\n    }\n    this.#hadPointerDown = false;\n\n    if (\n      this.#currentEditorType?.isDrawer &&\n      this.#currentEditorType.supportMultipleDrawings\n    ) {\n      return;\n    }\n\n    if (!this.#allowClick) {\n      this.#allowClick = true;\n      return;\n    }\n\n    const currentMode = this.#uiManager.getMode();\n    if (\n      currentMode === AnnotationEditorType.STAMP ||\n      currentMode === AnnotationEditorType.SIGNATURE\n    ) {\n      this.#uiManager.unselectAll();\n      return;\n    }\n\n    this.createAndAddNewEditor(event, /* isCentered = */ false);\n  }\n\n  /**\n   * Pointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    if (this.#uiManager.getMode() === AnnotationEditorType.HIGHLIGHT) {\n      this.enableTextSelection();\n    }\n    if (this.#hadPointerDown) {\n      // It's possible to have a second pointerdown event before a pointerup one\n      // when the user puts a finger on a touchscreen and then add a second one\n      // to start a pinch-to-zoom gesture.\n      // That said, in case it's possible to have two pointerdown events with\n      // a mouse, we don't want to create a new editor in such a case either.\n      this.#hadPointerDown = false;\n      return;\n    }\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Do nothing on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    this.#hadPointerDown = true;\n\n    if (this.#currentEditorType?.isDrawer) {\n      this.startDrawingSession(event);\n      return;\n    }\n\n    const editor = this.#uiManager.getActive();\n    this.#allowClick = !editor || editor.isEmpty();\n  }\n\n  startDrawingSession(event) {\n    this.div.focus({\n      preventScroll: true,\n    });\n    if (this.#drawingAC) {\n      this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n      return;\n    }\n\n    this.#uiManager.setCurrentDrawingSession(this);\n    this.#drawingAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#drawingAC);\n    this.div.addEventListener(\n      \"blur\",\n      ({ relatedTarget }) => {\n        if (relatedTarget && !this.div.contains(relatedTarget)) {\n          this.#focusedElement = null;\n          this.commitOrRemove();\n        }\n      },\n      { signal }\n    );\n    this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n  }\n\n  pause(on) {\n    if (on) {\n      const { activeElement } = document;\n      if (this.div.contains(activeElement)) {\n        this.#focusedElement = activeElement;\n      }\n      return;\n    }\n    if (this.#focusedElement) {\n      setTimeout(() => {\n        this.#focusedElement?.focus();\n        this.#focusedElement = null;\n      }, 0);\n    }\n  }\n\n  endDrawingSession(isAborted = false) {\n    if (!this.#drawingAC) {\n      return null;\n    }\n    this.#uiManager.setCurrentDrawingSession(null);\n    this.#drawingAC.abort();\n    this.#drawingAC = null;\n    this.#focusedElement = null;\n    return this.#currentEditorType.endDrawing(isAborted);\n  }\n\n  /**\n   *\n   * @param {AnnotationEditor} editor\n   * @param {number} x\n   * @param {number} y\n   * @returns\n   */\n  findNewParent(editor, x, y) {\n    const layer = this.#uiManager.findParent(x, y);\n    if (layer === null || layer === this) {\n      return false;\n    }\n    layer.changeParent(editor);\n    return true;\n  }\n\n  commitOrRemove() {\n    if (this.#drawingAC) {\n      this.endDrawingSession();\n      return true;\n    }\n    return false;\n  }\n\n  onScaleChanging() {\n    if (!this.#drawingAC) {\n      return;\n    }\n    this.#currentEditorType.onScaleChangingWhenDrawing(this);\n  }\n\n  /**\n   * Destroy the main editor.\n   */\n  destroy() {\n    this.commitOrRemove();\n    if (this.#uiManager.getActive()?.parent === this) {\n      // We need to commit the current editor before destroying the layer.\n      this.#uiManager.commitOrRemove();\n      this.#uiManager.setActiveEditor(null);\n    }\n\n    if (this.#editorFocusTimeoutId) {\n      clearTimeout(this.#editorFocusTimeoutId);\n      this.#editorFocusTimeoutId = null;\n    }\n\n    for (const editor of this.#editors.values()) {\n      this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n      editor.setParent(null);\n      editor.isAttachedToDOM = false;\n      editor.div.remove();\n    }\n    this.div = null;\n    this.#editors.clear();\n    this.#uiManager.removeLayer(this);\n  }\n\n  #cleanup() {\n    // When we're cleaning up, some editors are removed but we don't want\n    // to add a new one which will induce an addition in this.#editors, hence\n    // an infinite loop.\n    for (const editor of this.#editors.values()) {\n      if (editor.isEmpty()) {\n        editor.remove();\n      }\n    }\n  }\n\n  /**\n   * Render the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  render({ viewport }) {\n    this.viewport = viewport;\n    setLayerDimensions(this.div, viewport);\n    for (const editor of this.#uiManager.getEditors(this.pageIndex)) {\n      this.add(editor);\n      editor.rebuild();\n    }\n    // We're maybe rendering a layer which was invisible when we started to edit\n    // so we must set the different callbacks for it.\n    this.updateMode();\n  }\n\n  /**\n   * Update the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  update({ viewport }) {\n    // Editors have their dimensions/positions in percent so to avoid any\n    // issues (see #15582), we must commit the current one before changing\n    // the viewport.\n    this.#uiManager.commitOrRemove();\n    this.#cleanup();\n\n    const oldRotation = this.viewport.rotation;\n    const rotation = viewport.rotation;\n\n    this.viewport = viewport;\n    setLayerDimensions(this.div, { rotation });\n    if (oldRotation !== rotation) {\n      for (const editor of this.#editors.values()) {\n        editor.rotate(rotation);\n      }\n    }\n  }\n\n  /**\n   * Get page dimensions.\n   * @returns {Object} dimensions.\n   */\n  get pageDimensions() {\n    const { pageWidth, pageHeight } = this.viewport.rawDims;\n    return [pageWidth, pageHeight];\n  }\n\n  get scale() {\n    return this.#uiManager.viewParameters.realScale;\n  }\n}\n\nexport { AnnotationEditorLayer };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"./svg_factory.js\";\nimport { shadow } from \"../shared/util.js\";\n\n/**\n * Manage the SVGs drawn on top of the page canvas.\n * It's important to have them directly on top of the canvas because we want to\n * be able to use mix-blend-mode for some of them.\n */\nclass DrawLayer {\n  #parent = null;\n\n  #mapping = new Map();\n\n  #toUpdate = new Map();\n\n  static #id = 0;\n\n  constructor({ pageIndex }) {\n    this.pageIndex = pageIndex;\n  }\n\n  setParent(parent) {\n    if (!this.#parent) {\n      this.#parent = parent;\n      return;\n    }\n\n    if (this.#parent !== parent) {\n      if (this.#mapping.size > 0) {\n        for (const root of this.#mapping.values()) {\n          root.remove();\n          parent.append(root);\n        }\n      }\n      this.#parent = parent;\n    }\n  }\n\n  static get _svgFactory() {\n    return shadow(this, \"_svgFactory\", new DOMSVGFactory());\n  }\n\n  static #setBox(element, [x, y, width, height]) {\n    const { style } = element;\n    style.top = `${100 * y}%`;\n    style.left = `${100 * x}%`;\n    style.width = `${100 * width}%`;\n    style.height = `${100 * height}%`;\n  }\n\n  #createSVG() {\n    const svg = DrawLayer._svgFactory.create(1, 1, /* skipDimensions = */ true);\n    this.#parent.append(svg);\n    svg.setAttribute(\"aria-hidden\", true);\n\n    return svg;\n  }\n\n  #createClipPath(defs, pathId) {\n    const clipPath = DrawLayer._svgFactory.createElement(\"clipPath\");\n    defs.append(clipPath);\n    const clipPathId = `clip_${pathId}`;\n    clipPath.setAttribute(\"id\", clipPathId);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    const clipPathUse = DrawLayer._svgFactory.createElement(\"use\");\n    clipPath.append(clipPathUse);\n    clipPathUse.setAttribute(\"href\", `#${pathId}`);\n    clipPathUse.classList.add(\"clip\");\n\n    return clipPathId;\n  }\n\n  #updateProperties(element, properties) {\n    for (const [key, value] of Object.entries(properties)) {\n      if (value === null) {\n        element.removeAttribute(key);\n      } else {\n        element.setAttribute(key, value);\n      }\n    }\n  }\n\n  draw(properties, isPathUpdatable = false, hasClip = false) {\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    if (isPathUpdatable) {\n      this.#toUpdate.set(id, path);\n    }\n\n    // Create the clipping path for the editor div.\n    const clipPathId = hasClip ? this.#createClipPath(defs, pathId) : null;\n\n    const use = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use);\n    use.setAttribute(\"href\", `#${pathId}`);\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return { id, clipPathId: `url(#${clipPathId})` };\n  }\n\n  drawOutline(properties, mustRemoveSelfIntersections) {\n    // We cannot draw the outline directly in the SVG for highlights because\n    // it composes with its parent with mix-blend-mode: multiply.\n    // But the outline has a different mix-blend-mode, so we need to draw it in\n    // its own SVG.\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    let maskId;\n    if (mustRemoveSelfIntersections) {\n      const mask = DrawLayer._svgFactory.createElement(\"mask\");\n      defs.append(mask);\n      maskId = `mask_p${this.pageIndex}_${id}`;\n      mask.setAttribute(\"id\", maskId);\n      mask.setAttribute(\"maskUnits\", \"objectBoundingBox\");\n      const rect = DrawLayer._svgFactory.createElement(\"rect\");\n      mask.append(rect);\n      rect.setAttribute(\"width\", \"1\");\n      rect.setAttribute(\"height\", \"1\");\n      rect.setAttribute(\"fill\", \"white\");\n      const use = DrawLayer._svgFactory.createElement(\"use\");\n      mask.append(use);\n      use.setAttribute(\"href\", `#${pathId}`);\n      use.setAttribute(\"stroke\", \"none\");\n      use.setAttribute(\"fill\", \"black\");\n      use.setAttribute(\"fill-rule\", \"nonzero\");\n      use.classList.add(\"mask\");\n    }\n\n    const use1 = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use1);\n    use1.setAttribute(\"href\", `#${pathId}`);\n    if (maskId) {\n      use1.setAttribute(\"mask\", `url(#${maskId})`);\n    }\n    const use2 = use1.cloneNode();\n    root.append(use2);\n    use1.classList.add(\"mainOutline\");\n    use2.classList.add(\"secondaryOutline\");\n\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return id;\n  }\n\n  finalizeDraw(id, properties) {\n    this.#toUpdate.delete(id);\n    this.updateProperties(id, properties);\n  }\n\n  updateProperties(elementOrId, properties) {\n    if (!properties) {\n      return;\n    }\n    const { root, bbox, rootClass, path } = properties;\n    const element =\n      typeof elementOrId === \"number\"\n        ? this.#mapping.get(elementOrId)\n        : elementOrId;\n    if (!element) {\n      return;\n    }\n    if (root) {\n      this.#updateProperties(element, root);\n    }\n    if (bbox) {\n      DrawLayer.#setBox(element, bbox);\n    }\n    if (rootClass) {\n      const { classList } = element;\n      for (const [className, value] of Object.entries(rootClass)) {\n        classList.toggle(className, value);\n      }\n    }\n    if (path) {\n      const defs = element.firstElementChild;\n      const pathElement = defs.firstElementChild;\n      this.#updateProperties(pathElement, path);\n    }\n  }\n\n  updateParent(id, layer) {\n    if (layer === this) {\n      return;\n    }\n    const root = this.#mapping.get(id);\n    if (!root) {\n      return;\n    }\n    layer.#parent.append(root);\n    this.#mapping.delete(id);\n    layer.#mapping.set(id, root);\n  }\n\n  remove(id) {\n    this.#toUpdate.delete(id);\n    if (this.#parent === null) {\n      return;\n    }\n    this.#mapping.get(id).remove();\n    this.#mapping.delete(id);\n  }\n\n  destroy() {\n    this.#parent = null;\n    for (const root of this.#mapping.values()) {\n      root.remove();\n    }\n    this.#mapping.clear();\n    this.#toUpdate.clear();\n  }\n}\n\nexport { DrawLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").OnProgressParameters} OnProgressParameters */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n/** @typedef {import(\"./display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display/api\").RenderTask} RenderTask */\n/** @typedef {import(\"./display/display_utils\").PageViewport} PageViewport */\n\nimport {\n  AbortException,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationMode,\n  AnnotationType,\n  createValidAbsoluteUrl,\n  FeatureTest,\n  getUuid,\n  ImageKind,\n  InvalidPDFException,\n  MathClamp,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PermissionFlag,\n  ResponseException,\n  shadow,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n} from \"./shared/util.js\";\nimport {\n  applyOpacity,\n  CSSConstants,\n  fetchData,\n  findContrastColor,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  noContextMenu,\n  OutputScale,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  setLayerDimensions,\n  stopEvent,\n  SupportedImageMimeTypes,\n} from \"./display/display_utils.js\";\nimport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFWorker,\n  version,\n} from \"./display/api.js\";\nimport { AnnotationEditorLayer } from \"./display/editor/annotation_editor_layer.js\";\nimport { AnnotationEditorUIManager } from \"./display/editor/tools.js\";\nimport { AnnotationLayer } from \"./display/annotation_layer.js\";\nimport { ColorPicker } from \"./display/editor/color_picker.js\";\nimport { DOMSVGFactory } from \"./display/svg_factory.js\";\nimport { DrawLayer } from \"./display/draw_layer.js\";\nimport { GlobalWorkerOptions } from \"./display/worker_options.js\";\nimport { HighlightOutliner } from \"./display/editor/drawers/highlight.js\";\nimport { isValidExplicitDest } from \"./display/api_utils.js\";\nimport { SignatureExtractor } from \"./display/editor/drawers/signaturedraw.js\";\nimport { TextLayer } from \"./display/text_layer.js\";\nimport { TouchManager } from \"./display/touch_manager.js\";\nimport { XfaLayer } from \"./display/xfa_layer.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING || GENERIC\")) {\n  globalThis._pdfjsTestingUtils = {\n    HighlightOutliner,\n  };\n}\n\nglobalThis.pdfjsLib = {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  applyOpacity,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  CSSConstants,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  findContrastColor,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  applyOpacity,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  CSSConstants,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  findContrastColor,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  renderRichText,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n"],"names":["_toSetter","t","e","n","r","length","Object","defineProperty","set","o","apply","_checkPrivateRedeclaration","has","TypeError","_classPrivateMethodInitSpec","a","add","_classPrivateFieldInitSpec","_assertClassBrand","arguments","_classPrivateGetter","s","get","_classPrivateFieldSet2","AsyncFromSyncIterator","AsyncFromSyncIteratorContinuation","Promise","reject","done","resolve","value","then","this","next","prototype","isNodeJS","process","versions","nw","electron","type","FONT_IDENTITY_MATRIX","LINE_FACTOR","RenderingIntentFlag","AnnotationMode","DISABLE","ENABLE","ENABLE_FORMS","ENABLE_STORAGE","AnnotationEditorPrefix","AnnotationEditorType","NONE","FREETEXT","HIGHLIGHT","STAMP","INK","POPUP","SIGNATURE","COMMENT","AnnotationEditorParamsType","RESIZE","CREATE","FREETEXT_SIZE","FREETEXT_COLOR","FREETEXT_OPACITY","INK_COLOR","INK_THICKNESS","INK_OPACITY","HIGHLIGHT_COLOR","HIGHLIGHT_THICKNESS","HIGHLIGHT_FREE","HIGHLIGHT_SHOW_ALL","DRAW_STEP","MeshFigureType","TextRenderingMode","util_ImageKind","GRAYSCALE_1BPP","RGB_24BPP","RGBA_32BPP","AnnotationType","TEXT","LINK","LINE","SQUARE","CIRCLE","POLYGON","POLYLINE","UNDERLINE","SQUIGGLY","STRIKEOUT","CARET","FILEATTACHMENT","SOUND","MOVIE","WIDGET","SCREEN","PRINTERMARK","TRAPNET","WATERMARK","THREED","REDACT","AnnotationBorderStyleType","VerbosityLevel","ERRORS","WARNINGS","INFOS","OPS","dependency","setLineWidth","setLineCap","setLineJoin","setMiterLimit","setDash","setRenderingIntent","setFlatness","setGState","save","restore","transform","moveTo","lineTo","curveTo","curveTo2","curveTo3","closePath","rectangle","stroke","closeStroke","fill","eoFill","fillStroke","eoFillStroke","closeFillStroke","closeEOFillStroke","endPath","clip","eoClip","beginText","endText","setCharSpacing","setWordSpacing","setHScale","setLeading","setFont","setTextRenderingMode","setTextRise","moveText","setLeadingMoveText","setTextMatrix","nextLine","showText","showSpacedText","nextLineShowText","nextLineSetSpacingShowText","setCharWidth","setCharWidthAndBounds","setStrokeColorSpace","setFillColorSpace","setStrokeColor","setStrokeColorN","setFillColor","setFillColorN","setStrokeGray","setFillGray","setStrokeRGBColor","setFillRGBColor","setStrokeCMYKColor","setFillCMYKColor","shadingFill","beginInlineImage","beginImageData","endInlineImage","paintXObject","markPoint","markPointProps","beginMarkedContent","beginMarkedContentProps","endMarkedContent","beginCompat","endCompat","paintFormXObjectBegin","paintFormXObjectEnd","beginGroup","endGroup","beginAnnotation","endAnnotation","paintImageMaskXObject","paintImageMaskXObjectGroup","paintImageXObject","paintInlineImageXObject","paintInlineImageXObjectGroup","paintImageXObjectRepeat","paintImageMaskXObjectRepeat","paintSolidColorImageMask","constructPath","setStrokeTransparent","setFillTransparent","rawFillPath","DrawOPS","verbosity","setVerbosityLevel","level","Number","isInteger","getVerbosityLevel","info","msg","console","concat","warn","unreachable","Error","assert","cond","createValidAbsoluteUrl","url","baseUrl","undefined","options","addDefaultProtocol","startsWith","dots","match","tryConvertEncoding","decodeURIComponent","escape","_unused","absoluteUrl","URL","parse","protocol","_isValidProtocol","updateUrlHash","hash","allowRel","res","href","split","shadow","obj","prop","nonSerializable","enumerable","configurable","writable","BaseException","message","name","constructor","PasswordException","code","super","UnknownErrorException","details","InvalidPDFException","ResponseException","status","missing","FormatError","AbortException","bytesToString","bytes","MAX_ARGUMENT_COUNT","String","fromCharCode","strBuf","i","chunkEnd","Math","min","chunk","subarray","push","join","stringToBytes","str","Uint8Array","charCodeAt","util_FeatureTest","isLittleEndian","buffer8","Uint32Array","buffer","isEvalSupported","Function","_unused2","isOffscreenCanvasSupported","OffscreenCanvas","isImageDecoderSupported","ImageDecoder","isFloat16ArraySupported","Float16Array","isSanitizerSupported","Sanitizer","platform","userAgent","navigator","isAndroid","includes","isLinux","isMac","isWindows","isFirefox","isCSSRoundSupported","_globalThis$CSS","_globalThis$CSS$suppo","globalThis","CSS","supports","call","hexNumbers","Array","from","keys","toString","padStart","Util","makeHexColor","g","b","domMatrixToTransform","dm","c","d","f","scaleMinMax","minMax","temp","m1","m2","multiplyByDOMMatrix","m","md","applyTransform","p","pos","p0","p1","applyTransformToBezier","m0","m3","m4","m5","pI","pI1","applyInverseTransform","axialAlignedBoundingBox","rect","output","r0","r1","r2","r3","a0","a2","a1","a3","b0","b2","b1","b3","m1r0","m1r2","m2r1","m2r3","max","inverseTransform","singularValueDecompose2dScale","matrix","first","second","sqrt","normalizeRect","slice","intersect","rect1","rect2","xLow","xHigh","yLow","yHigh","pointBoundingBox","x","y","rectBoundingBox","x0","y0","x1","y1","bezierBoundingBox","x2","y2","x3","y3","_getExtremum","_getExtremumOnCurve","mt","tt","ttt","abs","delta","sqrtDelta","_Util","NormalizeRegex","NormalizationMap","getUuid","crypto","randomUUID","buf","getRandomValues","AnnotationPrefix","MathClamp","v","toBase64Util","arr","toBase64","btoa","try","fn","_len","args","_key","sumPrecise","numbers","reduce","XfaText","textContent","xfa","items","styles","create","walk","node","_node$attributes","shouldBuildText","attributes","children","child","XfaLayer","setupStorage","html","id","element","storage","intent","storedData","getValue","addEventListener","event","setValue","target","xfaOn","setAttribute","xfaOff","removeAttribute","checked","getAttribute","option","selected","hasOwnProperty","selectedIndex","setAttributes","_ref","linkService","isHTMLAnchorElement","HTMLAnchorElement","key","entries","assign","style","addLinkAttributes","newWindow","dataId","render","parameters","annotationStorage","root","xfaHtml","rootHtml","document","createElement","isNotForRichText","rootDiv","div","append","viewport","textDivs","createTextNode","stack","_child$attributes","_child$children","parent","at","pop","childHtml","xmlns","createElementNS","el","querySelectorAll","update","hidden","SVG_NS","PixelsPerInch","async","fetchData","isValidFetchUrl","baseURI","response","fetch","ok","statusText","arrayBuffer","blob","json","text","request","XMLHttpRequest","open","responseType","onreadystatechange","readyState","DONE","responseText","send","_PixelsPerInch","_defineProperty","PDF","PageViewport","_ref2","viewBox","userUnit","scale","rotation","offsetX","offsetY","dontFlip","centerX","centerY","rotateA","rotateB","rotateC","rotateD","offsetCanvasX","offsetCanvasY","width","height","rawDims","dims","pageWidth","pageHeight","pageX","pageY","clone","convertToViewportPoint","convertToViewportRectangle","topLeft","bottomRight","convertToPdfPoint","RenderingCancelledException","extraDelay","isDataScheme","ii","trim","substring","toLowerCase","isPdfFile","filename","test","StatTimer","time","started","Date","now","timeEnd","times","start","end","outBuf","longest","padEnd","noContextMenu","preventDefault","stopEvent","stopPropagation","PDFDateString","toDateObject","input","_regex","_","RegExp","matches","exec","year","parseInt","month","day","hour","minute","universalTimeRelation","offsetHour","offsetMinute","UTC","getRGB","color","colorRGB","map","getCurrentTransform","ctx","getTransform","getCurrentTransformInverse","invertSelf","setLayerDimensions","mustFlip","mustRotate","useRound","w","h","widthStr","heightStr","OutputScale","pixelRatio","sx","sy","scaled","symmetric","limitCanvas","maxPixels","maxDim","capAreaFactor","maxAreaScale","Infinity","maxWidthScale","maxHeightScale","capPixels","maxScale","devicePixelRatio","winPixels","ceil","window","screen","availWidth","availHeight","SupportedImageMimeTypes","ColorScheme","isDarkMode","_window","_window$matchMedia","matchMedia","RGBToHSL","rgb","l","HSLToRGB","hsl","floor","computeLuminance","contrastRatio","hsl1","hsl2","lum1","lum2","contrastCache","Map","renderRichText","_ref4","container","dir","className","fragment","createDocumentFragment","lines","line","firstElementChild","classList","makePathFromDrawOPS","data","path","Path2D","bezierCurveTo","quadraticCurveTo","EditorToolbar","editor","_EditorToolbar_brand","_toolbar","_colorPicker","_editor","_buttons","_altText","_comment","_commentButtonDivider","_signatureDescriptionButton","_classPrivateFieldSet","_l10nRemove","freeze","freetext","highlight","ink","stamp","signature","editToolbar","signal","_classPrivateFieldGet","_uiManager","_signal","AbortSignal","aborted","_pointerDown","buttons","position","toolbarPosition","direction","insetInlineEnd","top","hide","_classPrivateFieldGet2","hideDropdown","show","_classPrivateFieldGet3","_classPrivateFieldGet4","remove","shown","addDeleteButton","editorType","button","tabIndex","_addListenersToElement","delete","addAltText","altText","_get_divider","addComment","comment","beforeElement","renderForToolbar","divider","insertBefore","toolbar","addColorPicker","colorPicker","renderButton","addEditSignatureButton","signatureManager","renderEditButton","removeButton","_classPrivateFieldGet5","_classPrivateFieldGet6","removeToolbarCommentButton","addButton","tool","addButtonBefore","beforeSelector","querySelector","updateEditSignatureButton","description","title","_classPrivateFieldGet7","destroy","_focusIn","_focusEventsAllowed","_focusOut","bind","capture","_this","_buttons2","WeakMap","_toolbar2","_uiManager2","_FloatingToolbar_brand","WeakSet","FloatingToolbar","uiManager","boxes","isLTR","_getLastPoint","_render","hasCommentManager","_makeButton","commentSelection","highlightSelection","lastY","lastX","box","buttonClass","l10nId","labelL10nId","clickHandler","span","bindEvents","names","CurrentPointers","initializeAndAddPointerId","pointerId","_pointerIds","Set","setPointer","pointerType","_pointerType$_","_pointerId","_pointerType","setTimeStamp","timeStamp","_moveTimestamp","isSamePointerId","isSamePointerIdOrRemove","_pointerIds$_","isSamePointerType","isInitializedAndDifferentPointerType","isSameTimeStamp","isUsingMultiplePointers","_pointerIds$_2","size","clearPointerType","clearPointerIds","NaN","clearTimeStamp","_id","IdManager","_this$id","_this$id2","_baseId","_id2","_cache","_ImageManager_brand","ImageManager","_isSVGFittingCanvas","getContext","willReadFrequently","image","Image","src","decode","drawImage","getImageData","getFromFile","file","lastModified","_get","getFromUrl","getFromBlob","blobPromise","getFromId","bitmap","refCounter","getFromCanvas","canvas","_this$id5","_this$id6","_data2","offscreen","transferToImageBitmap","isSvg","getSvgUrl","svgUrl","deleteId","_bitmap$close","transferFromImageBitmap","convertToBlob","close","isValidId","rawData","_data4","_this$id3","_this$id4","File","Blob","mustRemoveAspectRatioPromise","fileReader","FileReader","imageElement","imagePromise","onload","result","onerror","readAsDataURL","createImageBitmap","_ImageManager","_commands","_locked","_maxSize","_position","CommandManager","maxSize","_ref5","cmd","undo","post","mustExec","overwriteIfSameType","keepUndo","splice","redo","hasSomethingToUndo","hasSomethingToRedo","cleanType","_KeyboardManager_brand","KeyboardManager","callbacks","allKeys","callback","isMacKey","self","_serialize","bubbles","checker","altKey","ctrlKey","metaKey","shiftKey","ColorManager","_colors","colors","visibility","colorScheme","body","computedColor","getComputedStyle","getColorValues","convert","RGB","every","_colorsMapping","getHexCode","_abortController","_activeEditor","_allEditableAnnotations","_allEditors","_allLayers","_altTextManager","_annotationStorage","_changedExistingAnnotations","_commandManager","_commentManager","_copyPasteAC","_currentDrawingSession","_currentPageIndex","_deletedAnnotationsElementIds","_draggingEditors","_editorTypes","_editorsToRescale","_enableHighlightFloatingButton","_enableUpdatedAddImage","_enableNewAltTextWhenAddingImage","_filterFactory","_focusMainContainerTimeoutId","_focusManagerAC","_highlightColors2","_highlightWhenShiftUp","_floatingToolbar","_idManager","_isEnabled","_isPointerDown","_isWaiting","_keyboardManagerAC","_lastActiveElement","_mainHighlightColorPicker","_missingCanvases","_mlManager","_mode","_selectedEditors","_selectedTextNode","_signatureManager","_pageColors","_showAllStates","_pdfDocument","_previousStates","_translation","_translationTimeoutId","_container","_viewer","_viewerAlert","_updateModeCapability","_AnnotationEditorUIManager_brand","AnnotationEditorUIManager","_keyboardManager","proto","arrowChecker","contains","activeElement","tagName","hasSomethingToControl","textInputChecker","_self","_ref6","HTMLInputElement","small","TRANSLATE_SMALL","big","TRANSLATE_BIG","selectAll","addNewEditorFromKeyboard","_ref7","HTMLButtonElement","isEnterHandled","_ref8","unselectAll","translateSelectedEditors","viewer","viewerAlert","altTextManager","commentManager","eventBus","pdfDocument","pageColors","highlightColors","enableHighlightFloatingButton","enableUpdatedAddImage","enableNewAltTextWhenAddingImage","mlManager","editorUndoBar","supportsPinchToZoom","AbortController","isEditing","isEmpty","hasSelectedEditor","hasSelectedText","_eventBus","_on","onEditingAction","onPageChanging","onScaleChanging","onRotationChanging","onSetPreference","evt","updateParams","_addSelectionListener","_addDragAndDropListeners","_addKeyboardManager","filterFactory","viewParameters","realScale","PDF_TO_CSS_UNITS","isShiftKeyDown","_editorUndoBar","_supportsPinchToZoom","setSidebarUiManager","_classPrivateFieldGet8","_classPrivateFieldGet9","_classPrivateFieldGet0","_classPrivateFieldGet1","_classPrivateFieldGet10","_classPrivateFieldGet11","_classPrivateFieldGet12","_classPrivateFieldGet13","_this$_editorUndoBar","abort","layer","values","clear","clearTimeout","combinedSignal","ac","any","useNewAltTextFlow","useNewAltTextWhenAddingImage","hcmFilter","addHCMFilter","foreground","background","_highlightColors","pair","toUpperCase","hasHCM","isNameForHCM","endsWith","replace","highlightColorNames","reverse","getNonHCMColor","colorName","getNonHCMColorName","setCurrentDrawingSession","disableUserSelect","setMainHighlightColorPicker","editAltText","_classPrivateFieldGet14","firstTime","editComment","posX","posY","_classPrivateFieldGet15","showDialog","selectComment","pageIndex","uid","getEditorByUID","toggleComment","updateComment","_classPrivateFieldGet16","getData","updatePopupColor","_classPrivateFieldGet17","removeComment","_classPrivateFieldGet18","removeComments","isSelected","_classPrivateFieldGet19","toggleCommentPopup","makeCommentColor","opacity","_classPrivateFieldGet20","getCommentDialogElement","_classPrivateFieldGet21","dialogElement","waitForEditorsRendered","pageNumber","promise","withResolvers","onEditorsRendered","_off","on","getSignature","_classPrivateFieldGet22","switchToMode","mode","once","dispatch","source","setPreference","_ref9","_ref0","focusMainContainer","focus","findParent","layerX","layerY","getBoundingClientRect","toggle","addShouldRescale","removeShouldRescale","_ref1","_classPrivateFieldGet23","commitOrRemove","_ref10","pagesRotation","methodOfCreation","selection","getSelection","isCollapsed","anchorNode","anchorOffset","focusNode","focusOffset","textLayer","_getAnchorElementForSelection","closest","getSelectionBoxes","empty","_getLayerForTextLayer","isNoneMode","createAndAddNewEditor","showAllEditors","getAndRemoveDataFromAnnotationStorage","annotationId","storedValue","getRawValue","addToAnnotationStorage","a11yAlert","messageId","JSON","stringify","blur","_onSelectEnd","hasSelection","lastEditor","lastActiveElement","addEditListeners","setEditingState","removeEditListeners","_removeKeyboardManager","dragOver","dataTransfer","isHandlingMimeForPasting","dropEffect","drop","item","paste","currentLayer","copy","_classPrivateFieldGet24","editors","serialized","serialize","clipboardData","setData","cut","ex","isArray","newEditors","deserializedEditor","deserialize","_addEditorToLayer","_selectEditors","addCommands","keydown","isEditorHandlingKeyboard","keyup","_ref11","_addFocusManager","_addCopyPasteListeners","_dispatchUpdateStates","_isEmpty","_removeFocusManager","_removeCopyPasteListeners","registerEditorTypes","types","_dispatchUpdateUI","defaultPropertiesToUpdate","getId","getLayer","currentPageIndex","addLayer","enable","disable","removeLayer","updateMode","_classPrivateFieldGet25","_classPrivateFieldGet27","editId","isFromKeyboard","mustEnterInEditMode","_classPrivateFieldGet26","_classPrivateFieldGet28","hideSidebar","destroyPopup","_this$_editorUndoBar2","_disableAll","hideStandaloneCommentButton","addStandaloneCommentButton","loadSignatures","_enableAll","_classPrivateFieldGet29","getAnnotationsByType","editorClass","_editorType","elementIds","allComments","annotationElementId","hasComment","deleted","annotation","popupRef","contentsObj","showSidebar","setSelected","enterInEditMode","unselect","canCreateNewEmptyEditor","addNewEditor","updateToolbar","_objectSpread","action","updateDefaultParams","visible","_classPrivateFieldGet30","_classPrivateFieldGet31","enableWaiting","mustWait","disableClick","enableClick","getEditors","getEditor","addEditor","removeEditor","_classPrivateFieldGet32","_classPrivateFieldGet33","setTimeout","addDeletedAnnotationElement","addChangedExistingAnnotation","isDeletedAnnotationElement","removeDeletedAnnotationElement","removeChangedExistingAnnotation","setActiveEditor","propertiesToUpdate","updateUI","_get_lastSelectedEditor","updateUIForDefaultProperties","toggleSelected","select","_classPrivateFieldGet34","ed","firstSelectedEditor","_this$_editorUndoBar3","params","cleanUndoStack","_this$currentLayer","drawingEditor","endDrawingSession","_this$_editorUndoBar4","_classPrivateFieldGet35","commit","_classPrivateFieldGet36","totalX","totalY","translateInPage","translationDone","setUpDragSession","savedX","savedY","savedPageIndex","newX","newY","newPageIndex","endDragSession","mustBeAddedInUndoStack","move","_setParentAndPosition","dragSelectedEditors","tx","ty","drag","rebuild","changeParent","addOrRebuild","_this$getActive","getActive","shouldGetKeyboardEvents","isActive","getMode","isEditingMode","imageManager","rangeCount","getRangeAt","commonAncestorContainer","parentWidth","parentHeight","rotator","range","collapsed","getClientRects","_ref12","_ref13","_classPrivateFieldGet37","renderAnnotationElement","_classPrivateFieldGet38","editorId","hasBeenModified","setMissingCanvas","_classPrivateFieldGet39","setCanvas","addMissingCanvas","_ref97","nodeType","Node","TEXT_NODE","parentElement","hasTextLayer","_displayFloatingToolbar","_selectionChange","_classPrivateFieldGet135","_classPrivateFieldGet133","_classPrivateFieldGet134","activeLayer","toggleDrawing","pointerup","_classPrivateFieldGet136","_classPrivateFieldGet137","_classPrivateFieldGet138","some","_ref98","promises","all","_this2","AltText","_AltText_brand","_altText2","_altTextDecorative","_altTextButton","_altTextButtonLabel","_altTextTooltip","_altTextTooltipTimeout","_altTextWasFromKeyBoard","_badge","_editor2","_guessedText","_textWithDisclaimer","_useNewAltTextFlow","_l10nNewButton","added","review","initialize","l10n","_AltText$_l10n","_l10n","label","onClick","_reportTelemetry","_get_label","_setState","finish","focusVisible","hasData","guessedText","setGuessedText","generatedAltText","toggleAltTextBadge","_classPrivateFieldGet40","badge","isForCopying","decorative","textWithDisclaimer","_ref14","cancel","enabled","disabled","_classPrivateFieldGet41","_classPrivateFieldGet42","_this3","_classPrivateFieldGet139","_classPrivateFieldGet140","_classPrivateFieldGet141","tooltip","DELAY_TO_SHOW_TOOLTIP","_classPrivateFieldGet142","parentNode","getElementForAltText","Comment","_Comment_brand","_commentStandaloneButton","_commentToolbarButton","_commentWasFromKeyBoard","_editor3","_initialText","_richText","_text","_date","_deleted","_popupPosition","_render2","renderForStandalone","commentButtonPosition","commentButtonColor","backgroundColor","focusButton","_ref15","_classPrivateFieldGet43","onUpdatedColor","commentButtonWidth","_classPrivateFieldGet44","_classPrivateFieldGet45","boundingClientRect","commentPopupPositionInLayer","parentX","parentY","hasDefaultPopupPosition","removeStandaloneCommentButton","_classPrivateFieldGet46","_classPrivateFieldGet47","setCommentButtonStates","_ref16","hasPopup","ariaExpanded","edit","parentDimensions","isDeleted","hasBeenEdited","richText","date","setInitialText","_classPrivateFieldGet48","_classPrivateFieldGet49","isStandalone","ariaHasPopup","ariaControls","ariaControlsElements","TouchManager","_ref17","isPinchingDisabled","isPinchingStopped","onPinchStart","onPinching","onPinchEnd","_TouchManager_brand","_container2","_isPinching","_isPinchingStopped","_isPinchingDisabled","_onPinchStart","_onPinching","_onPinchEnd","_pointerDownAC","_signal2","_touchInfo","_touchManagerAC","_touchMoveAC","_onTouchStart","passive","MIN_TOUCH_DISTANCE_TO_PINCH","_classPrivateFieldGet50","_classPrivateFieldGet51","_classPrivateFieldGet143","_classPrivateFieldGet146","touches","pointerDownAC","opts","cancelPointerDown","_classPrivateFieldGet144","_classPrivateFieldGet145","opt","_onTouchMove","onTouchEnd","_onTouchEnd","touch0","touch1","identifier","touch0X","screenX","touch0Y","screenY","touch1X","touch1Y","_classPrivateFieldGet147","screen0X","screen0Y","screen1X","screen1Y","touchInfo","pTouch0X","pTouch0Y","pTouch1X","pTouch1Y","prevGapX","prevGapY","currGapX","currGapY","distance","hypot","pDistance","origin","_classPrivateFieldGet148","_TouchManager","AnnotationEditor","_resizerKeyboardManager","resize","_resizeWithKeyboard","_stopResizingWithKeyboard","_AnnotationEditor_brand","_accessibilityData","_allResizerDivs","_altText3","_comment2","_commentStandaloneButton2","_disabled","_dragPointerId","_dragPointerType","_resizersDiv","_lastPointerCoords","_savedDimensions","_fakeAnnotation","_focusAC","_focusedResizerName","_hasBeenClicked","_initialRect","_isEditing","_isInEditMode","_isResizerEnabledForKeyboard","_moveInDOMTimeout","_prevDragX","_prevDragY","_telemetryTimeouts","_touchManager","_isDraggable","_zIndex","_willKeepAspectRatio","_initialOptions","isCentered","_structTreeParentId","creationDate","modificationDate","canAddComment","pageRotation","pageDimensions","pageTranslation","isAttachedToDOM","getPrototypeOf","_type","isDrawer","_defaultLineColor","_colorManager","deleteAnnotationElement","fakeEditor","FakeEditor","getNextId","_AnnotationEditor$_l","_l10nResizer","topMiddle","topRight","middleRight","bottomMiddle","bottomLeft","middleLeft","_borderLineWidth","documentElement","parseFloat","getPropertyValue","_value","mime","_this$div","center","parentRotation","fixAndSetPosition","setInBackground","zIndex","setInForeground","setParent","_classPrivateFieldGet52","_stopResizing","focusin","focusout","_this$parent","relatedTarget","isMultipleSelection","isInEditMode","setAt","screenToPageTranslation","_moveAfterPaste","baseX","baseY","_onTranslated","translate","_translate","scrollIntoView","block","findNewParent","bx","by","getBaseTranslation","left","toFixed","_onTranslating","_hasBeenMoved","_hasBeenResized","_mustFixPosition","moveInDOM","_rotatePoint","pageTranslationToScreen","parentScale","setDims","getInitialTranslation","_onResized","_round","round","_onResizing","altTextFinish","_classPrivateFieldGet53","toolbarButtons","addEditToolbar","_editToolbar","addCommentButton","addCommentButtonInToolbar","_this$_editToolbar","removeCommentButtonFromToolbar","_this$_editToolbar2","removeEditToolbar","_this$_editToolbar3","_classPrivateFieldGet54","addContainer","_this$_editToolbar4","editToolbarDiv","before","getClientDimensions","createAltText","altTextData","_classPrivateFieldGet55","guessedAltText","_classPrivateFieldGet56","setGuessedAltText","_classPrivateFieldGet57","serializeAltText","_classPrivateFieldGet58","hasAltText","hasAltTextData","_classPrivateFieldGet59","_classPrivateFieldGet60","focusCommentButton","_classPrivateFieldGet61","_classPrivateFieldGet62","_this$opacity","setCommentData","_ref18","updateFromAnnotationLayer","hasEditedComment","_classPrivateFieldGet63","hasDeletedComment","_classPrivateFieldGet64","setSelectedCommentButton","setSelectedButton","DEFAULT_POPUP_WIDTH","DEFAULT_POPUP_HEIGHT","trY","blX","blY","trX","popup","contents","_ref19","parentBoundingClientRect","_this$_uiManager$_edi","defaultL10nId","_isVisible","_addFocusListeners","maxWidth","maxHeight","isResizable","_touchPinchStartCallback","_touchPinchCallback","_touchPinchEndCallback","pointerdown","_setUpDragSession","_selectOnPointerEvent","_onStartDragging","_onStopDragging","_this$parent2","moveEditorInDOM","getRect","shiftX","shiftY","getRectInCurrentCoords","getPDFRect","_classPrivateFieldGet65","onceAdded","enableEditMode","disableEditMode","needsToBeRebuilt","isOnScreen","bottom","right","innerHeight","innerWidth","rotate","_angle","serializeDeleted","_this$_initialData","_initialData","_this$_initialData2","annotationType","structTreeParentId","accessibilityData","_isCopy","isCopy","_classPrivateFieldGet66","_classPrivateFieldGet67","_classPrivateFieldGet68","hideCommentPopup","timeout","makeResizable","_createResizers","commentButtonPositionInPage","commentPopupPosition","elementBeforePopup","_classPrivateFieldGet69","savedWidth","savedHeight","boundResizerKeydown","_resizerKeydown","boundResizerBlur","_resizerBlur","_resizerFocus","firstPosition","nextFirstPosition","lastElementChild","_setResizerTabIndex","stopImmediatePropagation","_resizerPointermove","deltaX","deltaY","fromKeyboard","_this$div2","_this$_editToolbar6","_classPrivateFieldGet70","_this$div3","_this$_editToolbar5","_this$div4","preventScroll","_classPrivateFieldGet71","_this$div5","_this$div6","_this$_editToolbar7","_classPrivateFieldGet72","disableEditing","enableEditing","canChangeContent","dblclick","nodeName","contentDiv","MIN_SIZE","telemetryInitialData","telemetryFinalData","_telemetryTimeout","updateFakeAnnotationElement","annotationLayer","updateEdited","addFakeAnnotation","content","prepend","resetAnnotationElement","_ref99","angle","_getRotationMatrix","classes","_resizerPointerdown","_classPrivateFieldGet149","savedDraggable","togglePointerEvents","savedParentCursor","cursor","savedCursor","pointerUpCallback","_classPrivateFieldGet150","_addResizeToUndoStack","_resize","newWidth","newHeight","minWidth","minHeight","rotationMatrix","transf","invRotationMatrix","getPoint","getOpposite","isDiagonal","isHorizontal","point","oppositePoint","transfOppositePoint","oppositeX","oppositeY","ratioX","ratioY","lastScreenX","lastScreenY","invTransf","oldDiag","_classPrivateFieldGet151","_origin","prevDistance","factor","transfCenterPoint","newTransfCenterPoint","_classPrivateFieldGet152","hasDraggingStarted","cancelDrag","clientX","clientY","isPrimary","_event$relatedTarget","_AnnotationEditor","SEED","MASK_HIGH","MASK_LOW","MurmurHash3_64","seed","h1","h2","ArrayBuffer","isView","byteLength","blockCounts","tailLength","dataUint32","k1","k2","C1","C2","C1_LOW","C2_LOW","hexdigest","SerializableEmpty","transfer","_modified","_modifiedIds","_editorsMap","_storage","_AnnotationStorage_brand","AnnotationStorage","onSetModified","onResetModified","onAnnotationEditor","defaultValue","resetModified","modified","entry","val","_setModified","print","PrintAnnotationStorage","serializable","context","hasBitmap","editorStats","stats","typeToEditor","numberOfEditedComments","numberOfDeletedComments","_stats","isCommentDeleted","_counters$get","counters","count","comments","edited","computeTelemetryFinalData","resetModifiedIds","updateEditor","_classPrivateFieldGet73","_classPrivateFieldGet74","modifiedIds","ids","Symbol","iterator","_serializable","structuredClone","FontLoader","_ref20","ownerDocument","styleElement","_systemFonts","_document","nativeFontFaces","loadingRequests","loadTestFontId","addNativeFontFace","nativeFontFace","fonts","removeNativeFontFace","insertRule","rule","getElementsByTagName","styleSheet","sheet","cssRules","loadSystemFont","_ref21","systemFontInfo","disableFontFace","_inspectFont","loadedName","isFontLoadingAPISupported","fontFace","FontFace","load","_unused8","baseFontName","font","attached","missingFile","createNativeFontFace","loaded","family","createFontFaceRule","isSyncFontLoadingSupported","_queueLoadingCallback","_prepareFontLoadEvent","_this$_document","complete","otherRequest","shift","_loadTestFont","atob","int32","offset","spliceString","insert","called","XXXX_VALUE","checksum","fontFamily","isFontReady","fillText","_fontData","FontFaceObject","translatedData","inspectFont","extra","charProcOperatorList","compiledGlyphs","_this$_inspectFont","cssFontInfo","css","weight","fontWeight","italicAngle","_this$_inspectFont2","mimetype","getPathGenerator","objs","character","objId","cmds","fontExtraProperties","black","bold","_classPrivateFieldGet75","_classPrivateFieldGet76","isInvalidPDFjsFont","isType3Font","italic","remeasure","vertical","ascent","defaultWidth","descent","bbox","fontMatrix","fallbackName","clearData","defaultVMetrics","CssFontInfo","write","encoder","TextEncoder","encodedStrings","stringsLength","strings","encoded","encode","view","DataView","setUint32","_CssFontInfo_brand","_buffer","_view","_decoder","TextDecoder","_readString","index","getUint32","_CssFontInfo","_buffer2","_view2","_decoder2","_SystemFontInfo_brand","SystemFontInfo","encodedStyleStyle","encodedStyleWeight","lengthEstimate","setUint8","guessFallback","transferToFixedLength","getUint8","_readString2","styleLength","weightLength","_SystemFontInfo","_buffer3","_decoder3","_view3","_FontInfo_brand","FontInfo","_ref22","_readBoolean","_readNumber","_OFFSET_BBOX","getInt16","_OFFSET_FONT_MATRIX","getFloat64","_OFFSET_DEFAULT_VMETRICS","_readString3","_OFFSET_STRINGS","cssFontInfoLength","cssFontInfoData","systemFontInfoLength","systemFontInfoData","systemFontInfoBuffer","cssFontInfoBuffer","numBools","bools","boolByte","boolBit","_OFFSET_NUMBERS","setFloat64","coord","setInt16","metric","byteOffset","bitOffset","stringData","_FontInfo","PatternInfo","ir","kind","coords","colorStops","figures","shadingType","nCoord","nColor","nStop","nFigures","figuresSize","figure","verticesPerRow","dataView","u8data","_KIND","_HAS_BBOX","_HAS_BACKGROUND","_SHADING_TYPE","_N_COORD","_N_COLOR","_N_STOP","_N_FIGURES","Float32Array","hex","setFloat32","Int32Array","getIR","hasBBox","hasBackground","stops","getFloat32","coordsLength","figureCoords","colorsLength","figureColors","bounds","minX","maxX","minY","maxY","getFactoryUrlProp","isRefProxy","num","gen","isValidExplicitDest","validRef","validName","dest","page","zoom","argsLen","allowNull","arg","_listeners","_deferred","LoopbackPort","postMessage","listener","rmAbort","onAbort","removeEventListener","terminate","CallbackKind","StreamKind","onFn","wrapReason","_messageAC","_MessageHandler_brand","MessageHandler","sourceName","targetName","comObj","callbackId","streamId","streamSinks","streamControllers","callbackCapabilities","actionHandler","_onMessage","actionName","handler","ah","transfers","sendWithPromise","capability","sendWithStream","queueingStrategy","ReadableStream","controller","startCapability","startCall","pullCall","cancelCall","isClosed","desiredSize","pull","pullCapability","stream","reason","cancelCapability","_classPrivateFieldGet77","_ref100","_processStreamMessage","_createStreamSink","streamSink","enqueue","isCancelled","lastDesiredSize","sinkCapability","ready","error","onPull","onCancel","success","streamController","_deleteStreamController","dataReason","_streamController$sta","_streamController$pul","_streamController$can","allSettled","BaseCanvasFactory","_ref23","enableHWA","_enableHWA","_createCanvas","reset","canvasAndContext","DOMCanvasFactory","_ref24","BaseCMapReaderFactory","_ref25","isCompressed","_ref26","_fetch","cMapData","catch","DOMCMapReaderFactory","BaseFilterFactory","addFilter","maps","fgColor","bgColor","addAlphaFilter","addLuminosityFilter","addHighlightHCMFilter","filterName","newFgColor","newBgColor","_baseUrl","_cache2","_defs","_docId","_hcmCache","_id3","_DOMFilterFactory_brand","DOMFilterFactory","_ref27","docId","_this$id7","_this$id8","_get_cache","tableR","tableG","tableB","_createTables","_createUrl","filter","_createFilter","_addTransferMapConversion","_info","_get_hcmCache","_info$filter","fgRGB","_getRGB","bgRGB","_get_defs","table","_addGrayConversion","getSteps","_this$id9","_this$id0","tableA","_addTransferMapAlphaConversion","_this$id1","_this$id10","_addLuminosityConversion","_info2","_info$filter2","fgGray","bgGray","newFgRGB","newBgRGB","fg","bg","step","newStart","newStep","prev","k","j","_classPrivateFieldGet78","_classPrivateFieldGet79","_classPrivateFieldGet80","_classPrivateFieldGet81","_this4","_this5","_this6","contain","svg","mapR","mapG","mapB","bufferR","bufferG","bufferB","feColorMatrix","_appendFeFunc","feComponentTransfer","func","feFunc","rTable","gTable","bTable","aTable","BaseStandardFontDataFactory","_ref28","_ref29","DOMStandardFontDataFactory","BaseWasmFactory","_ref30","_ref31","DOMWasmFactory","node_utils_fetchData","fs","getBuiltinModule","readFile","NodeFilterFactory","NodeCanvasFactory","createRequire","import","require","createCanvas","NodeCMapReaderFactory","NodeStandardFontDataFactory","NodeWasmFactory","FORCED_DEPENDENCY_LABEL","expandBBox","array","EMPTY_BBOX","_bboxes","_coords","BBoxReader","bboxes","ensureDebugMetadata","dependencies","isRenderingOperation","_simple","_incremental","_namedDependencies","_savesStack","_markedContentStack","_baseTransformStack","_clipBox","_pendingBBox","_pendingBBoxIdx","_pendingDependencies","_operations","_fontBBoxTrustworthy","_canvasWidth","_canvasHeight","_bboxesCoords","_bboxes2","_debugMetadata","_CanvasDependencyTracker_brand","CanvasDependencyTracker","operationsCount","recordDebugMetadata","__proto__","sameLineText","Float64Array","_initializeBBoxes","growOperationsCount","opIdx","previous","lastSave","_ensureDebugMetadata","recordOpenMarker","idx","getOpenMarker","recordCloseMarker","_ensureDebugMetadata2","_ensureDebugMetadata3","pushBaseTransform","popBaseTransform","recordSimpleData","recordIncrementalData","resetIncrementalData","recordNamedData","recordSimpleDataFromNamed","depName","fallbackIdx","_classPrivateFieldGet82","recordFutureForcedDependency","inheritSimpleDataAsFutureForcedDependencies","inheritPendingDependenciesAsFutureForcedDependencies","dep","resetBBox","recordClipBox","clipBox","intersection","recordBBox","recordCharacterBBox","getMeasure","fontBBox","isBBoxTrustworthy","computedBBox","recordFullPageBBox","measure","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","getSimpleIndex","dependencyName","recordDependencies","dependencyNames","pendingDependencies","simple","incremental","forEach","recordNamedDependency","recordOperation","preserve","metadata","depIdx","saveIdx","recordShowTextOperation","deps","bboxToClipBoxDropOperation","_takePendingDependencies","_extractOperation","operation","_pushPendingDependencies","take","takeDebugMetadata","oldBBoxes","Uint8ClampedArray","_dependencyTracker","_opIdx","_ignoreBBoxes","_nestingLevel","_savesLevel","CanvasNestedDependencyTracker","dependencyTracker","ignoreBBoxes","_this$savesLevel","_this$savesLevel3","_this$nestingLevel","_this$nestingLevel3","Dependencies","PathType","applyBoundingBox","region","BaseShadingPattern","isModifyingCurrentTransform","getPattern","RadialAxialShadingPattern","IR","_bbox","_colorStops","_p0","_p1","_r0","_r1","_createGradient","grad","createLinearGradient","createRadialGradient","colorStop","addColorStop","owner","inverse","pathType","pattern","ownerBBox","current","getClippedPathBoundingBox","tmpCanvas","cachedCanvases","getCanvas","tmpCtx","clearRect","beginPath","baseTransform","fillStyle","createPattern","domMatrix","DOMMatrix","setTransform","drawTriangle","p2","p3","c1","c2","c3","rowSize","tmp","scaleX","scaleY","c1r","c1g","c1b","c2r","c2g","c2b","c3r","c3g","c3b","xa","car","cag","cab","xb","cbr","cbg","cbb","x1_","x2_","drawFigure","ps","cs","rows","cols","q","MeshShadingPattern","_figures","_bounds","_background","_createMeshCanvas","combinedScale","boundsWidth","boundsHeight","paddedWidth","BORDER_SIZE","paddedHeight","createImageData","putImageData","matrixScaleX","matrixScaleY","temporaryPatternCanvas","DummyShadingPattern","PaintType","TilingPattern","canvasGraphicsFactory","operatorList","xstep","ystep","paintType","tilingType","createPatternCanvas","_graphics$dependencyT","_graphics$dependencyT2","combinedScaleX","combinedScaleY","canvasWidth","canvasHeight","redrawHorizontally","redrawVertically","xScaledStep","yScaledStep","dimx","getSizeAndScale","dimy","graphics","createCanvasGraphics","groupLevel","setFillAndStrokeStyleToContext","clipBbox","executeOperatorList","endDrawing","dimx2","dimy2","xSize","ySize","tmpCanvas2","tmpCtx2","jj","realOutputSize","MAX_PATTERN_SIZE","bboxWidth","bboxHeight","strokeStyle","fillColor","strokeColor","convertBlackAndWhiteToRGBA","_ref32","srcPos","nonBlackColor","inverseDecode","zeroMapping","oneMapping","widthInSource","widthRemainder","srcLength","destPos","elem","FULL_CHUNK_HEIGHT","SCALE_MATRIX","XY","MIN_MAX_INIT","CachedCanvases","canvasFactory","cache","canvasEntry","drawImageAtIntegerCoords","srcImg","srcX","srcY","srcW","srcH","destX","destY","destW","destH","tlX","rTlX","tlY","rTlY","brX","rWidth","brY","rHeight","sign","CanvasExtraState","preInit","getPathBoundingBox","xStrokePad","lineWidth","yStrokePad","updateClipFromPath","startNewPathAndClipBox","isEmptyClip","putBinaryImageData","imgData","ImageData","partialChunkHeight","fullChunks","totalChunks","chunkImgData","thisChunkHeight","elemsInThisChunk","dest32","dest32DataLength","fullSrcDiff","white","srcDiff","kEnd","kEndUnrolled","mask","srcByte","putBinaryImageMask","copyCtxState","sourceCtx","destCtx","properties","property","setLineDash","getLineDash","lineDashOffset","resetCtxToDefault","fillRule","globalAlpha","lineCap","lineJoin","miterLimit","globalCompositeOperation","getImageSmoothingEnabled","interpolate","actualScale","fround","LINE_CAP_STYLES","LINE_JOIN_STYLES","NORMAL_CLIP","EO_CLIP","_CanvasGraphics_brand","CanvasGraphics","canvasCtx","commonObjs","_ref34","annotationCanvasMap","optionalContentConfig","markedContentStack","stateStack","pendingClip","pendingEOFill","xobjs","groupStack","baseTransformStack","smaskStack","smaskCounter","tempSMask","suspendedCtx","contentVisible","cachedPatterns","viewportScale","outputScaleX","outputScaleY","_cachedScaleForStroking","_cachedGetSinglePixelWidth","_cachedBitmapsMap","getObject","fallback","_this$dependencyTrack","beginDrawing","_ref35","transparency","savedFillStyle","fillRect","transparentCanvas","compositeCtx","executionStartIdx","continueCallback","stepper","operationsFilter","argsArray","fnArray","argsArrayLen","chunkOperations","endTime","steps","fnId","fnArgs","nextBreakPoint","breakIt","_argsArray$i","depObjId","_this$dependencyTrack2","objsPool","_restoreInitialState","HTMLCanvasElement","_drawFilter","_scaleImage","img","_img$width","_img$height","displayWidth","displayHeight","widthScale","heightScale","paintWidth","paintHeight","tmpCanvasId","_createMaskCanvas","_this$dependencyTrack4","isPatternFill","patternFill","currentTransform","cacheKey","maskCanvas","mainKey","cachedImage","_this$dependencyTrack3","maskToCanvas","drawnWidth","drawnHeight","fillCanvas","fillCtx","imageSmoothingEnabled","_this$dependencyTrack5","_this$dependencyTrack6","_this$dependencyTrack7","limit","_this$dependencyTrack8","dashArray","dashPhase","_this$dependencyTrack9","flatness","states","_this$dependencyTrack0","_this$dependencyTrack1","_this$dependencyTrack10","_this$dependencyTrack11","_this$dependencyTrack12","strokeAlpha","fillAlpha","activeSMask","checkSMaskState","transferMaps","inSMaskMode","beginSMaskMode","endSMaskMode","cacheId","scratchCanvas","_removeMirroring","__originalSave","__originalRestore","__originalRotate","__originalScale","__originalTranslate","__originalTransform","__originalSetTransform","__originalResetTransform","resetTransform","__originalClip","__originalMoveTo","__originalLineTo","__originalBezierCurveTo","__originalRect","__originalClosePath","__originalBeginPath","cp1x","cp1y","cp2x","cp2y","mirrorContextOperations","compose","dirtyBox","smask","composeSMask","layerCtx","layerBox","layerOffsetX","layerOffsetY","layerWidth","layerHeight","genericComposeSMask","subtype","backdrop","transferMap","maskCtx","maskOffsetX","maskOffsetY","maskX","maskY","_this$dependencyTrack13","old","_this$dependencyTrack14","_this$dependencyTrack15","op","outerExtraSize","_pathStartIdx","_this$dependencyTrack16","consumePath","newPath","addPath","multiplySelf","rescaleAndStroke","_this$dependencyTrack18","needRestore","_this$dependencyTrack17","_this$dependencyTrack19","_this$dependencyTrack20","_this$dependencyTrack21","_this$dependencyTrack22","_this$dependencyTrack23","textMatrix","textMatrixScale","lineX","lineY","paths","pendingTextPaths","fontSize","preMultiplySelf","spacing","_this$dependencyTrack24","charSpacing","_this$dependencyTrack25","wordSpacing","_this$dependencyTrack26","textHScale","leading","_this$dependencyTrack27","fontRefName","_this$dependencyTrack28","_fontObj$systemFontIn","fontObj","fontDirection","typeface","browserFontSize","fontSizeScale","_this$dependencyTrack29","textRenderingMode","rise","_this$dependencyTrack30","textRise","_this$dependencyTrack31","_this$dependencyTrack32","_this$dependencyTrack33","_this$dependencyTrack34","paintChar","patternFillTransform","patternStrokeTransform","fillStrokeMode","isAddToPathSet","patternStroke","_this$dependencyTrack35","scaledPath","_getScaledPath","invPatternTransform","_this$dependencyTrack36","measureText","_this$dependencyTrack37","strokeText","_this$dependencyTrack38","isFontSubpixelAAEnabled","glyphs","_this$dependencyTrack42","_this$dependencyTrack39","showType3Text","_this$dependencyTrack40","glyphsLength","spacingDir","widthAdvanceScale","simpleFillText","getSinglePixelWidth","chars","glyph","unicode","joinedChars","restoreNeeded","isSpace","fontChar","accent","scaledX","scaledY","vmetric","vx","vy","measuredWidth","characterScaleX","_this$dependencyTrack41","isInFont","scaledAccentX","scaledAccentY","spacingLength","operatorListId","xWidth","yWidth","llx","lly","urx","ury","_this$dependencyTrack43","getColorN_Pattern","renderingOpIdx","_getPattern","_this$dependencyTrack44","_len2","_key2","_this$dependencyTrack45","_len3","_key3","_this$dependencyTrack46","_this$dependencyTrack47","_this$dependencyTrack48","_this$dependencyTrack49","getShadingPattern","_this$dependencyTrack50","inv","_this$dependencyTrack51","group","_this$dependencyTrack52","currentCtx","isolated","knockout","canvasBounds","groupCtx","startTransformInverse","_this$dependencyTrack53","currentMtx","hasOwnCanvas","annotationCanvas","savedCtx","_this$dependencyTrack54","_this$dependencyTrack55","_this$dependencyTrack57","skewX","skewY","positions","_this$dependencyTrack56","trans","images","_this$dependencyTrack58","_this$dependencyTrack60","_this$dependencyTrack59","applyTransferMapsToCanvas","applyTransferMapsToBitmap","_this$dependencyTrack61","imgToPaint","HTMLElement","_this$dependencyTrack62","_this$dependencyTrack64","_this$dependencyTrack63","_this$dependencyTrack65","tag","_this$dependencyTrack66","_this$dependencyTrack67","isVisible","isContentVisible","_this$dependencyTrack68","_this$dependencyTrack69","_this$dependencyTrack70","absDet","normX","normY","getScaleForStroking","scaledLineWidth","scaledXLineWidth","scaledYLineWidth","baseArea","saveRestore","dashes","hcmFilterId","savedFilter","GlobalWorkerOptions","workerPort","_port","Worker","workerSrc","_src","Metadata","_ref36","parsedData","_map","_data3","getRaw","_classPrivateFieldGet83","INTERNAL","_isDisplay","_isPrint","_userSet","_visible","OptionalContentGroup","renderingIntent","_ref37","usage","rbGroups","viewState","printState","_setVisible","internal","userSet","_cachedGetHash","_groups","_initialHash","_order","_OptionalContentConfig_brand","OptionalContentConfig","creator","order","groups","baseState","off","getHash","expression","_evaluateVisibilityExpression","policy","setVisibility","preserveRB","rbGroup","otherId","_classPrivateFieldGet84","setOCGState","_ref38","operator","state","hasInitialVisibility","getOrder","getGroup","PDFDataTransportStream","pdfDataRangeTransport","_ref39","disableRange","disableStream","initialData","progressiveDone","contentDispositionFilename","_queuedChunks","_progressiveDone","_contentDispositionFilename","_pdfDataRangeTransport","_isStreamingSupported","_isRangeSupported","_contentLength","_fullRequestReader","_rangeReaders","addRangeListener","begin","_onReceiveData","addProgressListener","total","_onProgress","addProgressiveReadListener","addProgressiveDoneListener","_onProgressiveDone","transportReady","_ref40","_enqueue","rangeReader","_begin","_progressiveDataLength","_this$_fullRequestRea","_this$_fullRequestRea2","_loaded","_this$_rangeReaders$","_this$_rangeReaders$$","_this$_fullRequestRea3","_this$_fullRequestRea4","onProgress","_this$_fullRequestRea5","_removeRangeReader","reader","indexOf","getFullReader","queuedChunks","PDFDataTransportStreamReader","getRangeReader","PDFDataTransportStreamRangeReader","requestDataRange","cancelAllRequests","_this$_fullRequestRea6","_stream","_done","_filename","_requests","_headersReady","headersReady","isRangeSupported","isStreamingSupported","contentLength","read","requestCapability","_end","_queuedChunk","createHeaders","isHttp","httpHeaders","headers","Headers","getResponseOrigin","_URL$parse$origin","_URL$parse","validateRangeRequestCapabilities","_ref41","responseHeaders","rangeChunkSize","returnValues","allowRangeRequests","suggestedLength","extractFilenameFromHeader","contentDisposition","needsEncodingFixup","toParamRegExp","rfc2616unquote","unescape","rfc5987decode","rfc2047decode","fixupEncoding","contentDispositionStr","iter","quot","part","parts","rfc2231getparam","attributePattern","flags","textdecode","encoding","decoder","fatal","_unused9","quotindex","replaceAll","extvalue","encodingend","charset","_unused0","getFilenameFromContentDispositionHeader","_unused1","createResponseError","validateResponseStatus","createFetchOptions","withCredentials","abortController","method","credentials","redirect","getArrayBuffer","PDFFetchStream","_rangeRequestReaders","_this$_fullRequestRea7","_this$_fullRequestRea8","PDFFetchStreamReader","PDFFetchStreamRangeReader","_this$_fullRequestRea9","_reader","_withCredentials","_headersCapability","_disableRange","_rangeChunkSize","_responseOrigin","getReader","_this$onProgress","_this$_reader","_readCapability","responseOrigin","_this$onProgress2","_this$_reader2","NetworkManager","_ref42","currXhrId","pendingRequests","xhr","xhrId","pendingRequest","setRequestHeader","expectedStatus","onError","onStateChange","onprogress","onHeadersReceived","onDone","_pendingRequest$onPro","xhrStatus","network_getArrayBuffer","rangeHeader","getResponseHeader","getRequestXhr","isPendingRequest","abortRequest","PDFNetworkStream","_source","_manager","_onRangeRequestReaderClosed","PDFNetworkStreamFullRequestReader","PDFNetworkStreamRangeRequestReader","onClosed","_this$_fullRequestRea0","manager","_url","_fullRequestId","_onHeadersReceived","_onDone","_onError","_cachedChunks","_storedError","fullRequestXhrId","fullRequestXhr","responseURL","rawResponseHeaders","getAllResponseHeaders","trimStart","_this$onProgress3","lengthComputable","_requestId","_this$_manager$getReq","_close","_this$onClosed","_this$_storedError","_this$onProgress4","urlRegex","PDFNodeStream","sourceUrl","pathToFileURL","parseUrlOrPath","_this$_fullRequestRea1","_this$_fullRequestRea10","PDFNodeStreamFsFullReader","PDFNodeStreamFsRangeReader","_this$_fullRequestRea11","_readableStream","lstat","stat","_setReadableStream","createReadStream","_this$onProgress5","_error","readableStream","_this$onProgress6","INITIAL_DATA","_objs","_PDFObjects_brand","PDFObjects","_ensureObj","_data$bitmap","_classPrivateFieldGet153","_capability","_container4","_disableProcessItems","_fontInspectorEnabled","_lang","_layoutTextParams","_pageHeight3","_pageWidth3","_rootContainer","_rotation3","_scale","_styleCache","_textContentItemsStr","_textContentSource","_textDivs","_textDivProperties","_transform","_TextLayer_brand","TextLayer","_ref43","_globalThis$FontInspe","textContentSource","FontInspector","_ensureMinFontSizeComputed","finally","_pendingTextLayers","fontFamilyMap","pump","_ref44","_classPrivateFieldGet85","lang","_processItems","_ref45","onBefore","_getCtx","_layout","_classPrivateFieldGet86","abortEx","textContentItemsStr","cleanup","_ascentCache","_canvasContexts","_classPrivateFieldGet154","_classPrivateFieldGet155","_appendText","geom","textDiv","textDivProperties","hasText","hasEOL","atan2","fontName","PI","fontSubstitution","fontHeight","fontAscent","_getAscent","sin","cos","scaleFactorStr","divStyle","_minFontSize","dataset","fontSubstitutionLoadedName","shouldScaleText","absScaleX","absScaleY","br","_ensureCtxFont","alpha","_canvasCtxFonts","cached","lineHeight","cachedAscent","metrics","fontBoundingBoxAscent","fontBoundingBoxDescent","ratio","_TextLayer","getDocument","_src$password","_src$length","task","PDFDocumentLoadingTask","location","getUrlProp","Buffer","isNaN","getDataProp","password","rangeTransport","PDFDataRangeTransport","worker","PDFWorker","docBaseUrl","cMapUrl","cMapPacked","CMapReaderFactory","iccUrl","standardFontDataUrl","StandardFontDataFactory","wasmUrl","WasmFactory","ignoreErrors","stopAtErrors","maxImageSize","chrome","canvasMaxAreaInBytes","enableXfa","disableAutoFetch","pdfBug","CanvasFactory","FilterFactory","useWasm","useSystemFonts","useWorkerFetch","transportFactory","cMapReaderFactory","standardFontDataFactory","wasmFactory","port","_worker","docParams","apiVersion","evaluatorOptions","transportParams","loadingParams","destroyed","workerIdPromise","messageHandler","networkStream","NetworkStream","workerId","transport","WorkerTransport","_transport","_docId2","_PDFDocumentLoadingTa","_PDFDocumentLoadingTa2","_this$_worker3","_this$_worker","_this$_transport","_pendingDestroy","_this$_worker2","_capability2","_progressiveDoneListeners","_progressiveReadListeners","_progressListeners","_rangeListeners","onDataRange","onDataProgress","onDataProgressiveRead","onDataProgressiveDone","PDFDocumentProxy","pdfInfo","_pdfInfo","numPages","fingerprints","isPureXfa","_htmlForXfa","allXfaHtml","getPage","getPageIndex","ref","getDestinations","getDestination","getPageLabels","getPageLayout","getPageMode","getViewerPreferences","getOpenAction","getAttachments","pageIndexesToSkip","getJSActions","getDocJSActions","getOutline","getOptionalContentConfig","getRenderingIntent","getPermissions","getMetadata","getMarkInfo","saveDocument","extractPages","pageInfos","getDownloadInfo","downloadInfoCapability","keepLoadedFonts","startCleanup","loadingTask","cachedPageNumber","getFieldObjects","hasJSActions","getCalculationOrderIds","_pendingCleanup","_PDFPageProxy_brand","PDFPageProxy","pageInfo","_pageIndex","_pageInfo","_pdfBug","_intentStates","recordedBBoxes","getViewport","getAnnotations","getPageJSActions","getXfa","_this$_transport$_htm","_ref46","_this$_stats","_globalThis$StepperMa","_intentState","canvasContext","annotationMode","optionalContentConfigPromise","printAnnotationStorage","recordOperations","intentArgs","intentState","streamReaderCancelTimeout","intentPrint","_this$_stats2","displayReadyCapability","lastChunk","separateAnnots","_pumpOperatorList","recordForDebugger","Boolean","StepperManager","shouldRecordOperations","renderTasks","internalRenderTask","_internalRenderTask$g","gfx","setOperatorBBoxes","_globalThis$Stats","_tryCleanup","_abortOperatorList","Stats","InternalRenderTask","useRequestAnimationFrame","renderTask","_ref47","_this$_stats3","initializeGraphics","operatorListChanged","getOperatorList","opListTask","_intentState2","_this$_stats4","opListReadCapability","streamTextContent","includeMarkedContent","disableNormalization","highWaterMark","getTextContent","_ref48","_textContent$lang","getStructTree","_destroy","waitOn","force","completed","resetStats","_startRenderPage","_this$_stats5","_intentState$displayR","_renderPageChunk","operatorListChunk","_ref49","annotationStorageSerializable","streamReader","_ref50","_ref51","delay","curCacheKey","curIntentState","_capability3","_messageHandler","_port2","_webWorker","_PDFWorker_brand","_workerPorts","_initializeFromPort","_initialize","_classPrivateFieldGet87","_classPrivateFieldGet88","cachedPort","_setupFakeWorkerGlobal","_get_mainThreadWorkerMessageHandler","WorkerMessageHandler","loader","_resolve","_isWorkerDisabled","_setupFakeWorker","_isSameOrigin","_createCDNWrapper","terminateEarly","sendTest","_unused10","testObj","_unused11","_PDFWorker$fakeWorker","_PDFWorker$fakeWorker2","_fakeWorkerId","workerHandler","setup","_this7","_globalThis$pdfjsWork","pdfjsWorker","_unused12","_PDFWorker","otherUrl","base","other","wrapper","createObjectURL","fromPort","log","_methodPromises","_pageCache","_pagePromises","_pageRefCache","_passwordCapability","_WorkerTransport_brand","factory","fontLoader","_params","destroyCapability","_networkStream","_fullReader","_lastProgress","setupMessageHandler","isOpList","modifiedIdsHash","_classPrivateFieldGet89","terminated","_this$_networkStream","_this$messageHandler","sink","_ref52","readyReason","_loadingTask$onProgre","_loadingTask$onProgre2","_ref53","_ref54","_numPages","htmlForXfa","onPassword","updatePassword","err","_loadingTask$onProgre3","_ref55","_globalThis$FontInspe2","exportedData","exportedError","fontData","fontAdded","imageRef","pageProxy","dataLen","_ref56","imageData","_imageData$bitmap","_loadingTask$onProgre4","_this$_fullReader$fil","_this$_fullReader","cachedPromise","refStr","_cacheSimpleMethod","results","_this$_fullReader$fil2","_this$_fullReader2","_this$_fullReader$con","_this$_fullReader3","hasStructTree","_classPrivateFieldGet90","_internalRenderTask","RenderTask","form","_rAF","_ref57","operatorListIdx","running","graphicsReadyCallback","graphicsReady","_useRequestAnimationFrame","cancelled","_cancelBound","_continueBound","_continue","_scheduleNextBound","_scheduleNext","_nextBound","_next","_canvas","_canvasContext","_operationsFilter","_ref58","_globalThis$StepperMa2","_this$graphicsReadyCa","_canvasInUse","init","getNextBreakPoint","_this$gfx","_this$task$onError","_this$task","cancelAnimationFrame","_this$gfx$dependencyT","_this$stepper","updateOperatorList","onContinue","requestAnimationFrame","ColorPicker","_hideDropdownFromKeyboard","_colorSelectFromKeyboard","_moveToNext","_moveToPrevious","_moveToBeginning","_moveToEnd","_ref59","_editor$color","_classPrivateFieldGet91","_ColorPicker_brand","_button","_buttonSwatch","_defaultColor","_dropdown","_dropdownWasFromKeyboard","_isMainColorPicker","_editor4","_openDropdownAC","_uiManager3","_l10nColor","blue","green","pink","red","yellow","_openDropdown","_keyDown","swatch","ariaHidden","renderMainDropdown","dropdown","_getDropdownRoot","ariaOrientation","ariaLabelledBy","_colorSelect","_event$target$nextSib","_classPrivateFieldGet92","_get_isDropdownVisible","nextSibling","_classPrivateFieldGet93","_event$target$previou","previousSibling","_classPrivateFieldGet94","_classPrivateFieldGet95","_classPrivateFieldGet96","_classPrivateFieldGet97","_classPrivateFieldGet98","updateColor","ariaSelected","_classPrivateFieldGet99","_classPrivateFieldGet100","role","ariaMultiSelectable","detail","_pointerDown3","_classPrivateFieldGet156","_this8","_ColorPicker","_input","_editor5","_uiManager4","BasicColorPicker","_l10nColor2","colorType","_classPrivateFieldGet101","makeColorComp","scaleAndClamp","ColorConverters","CMYK_G","_ref60","G_CMYK","_ref61","G_RGB","_ref62","G_rgb","_ref63","G_HTML","_ref64","G","RGB_G","_ref65","RGB_rgb","RGB_HTML","T_HTML","T_rgb","CMYK_RGB","_ref66","CMYK_rgb","_ref67","CMYK_HTML","components","RGB_CMYK","_ref68","BaseSVGFactory","skipDimensions","_createSVG","DOMSVGFactory","GetElementsByNameSet","TIMEZONE_OFFSET","getTimezoneOffset","AnnotationElementFactory","LinkAnnotationElement","TextAnnotationElement","fieldType","TextWidgetAnnotationElement","radioButton","RadioButtonWidgetAnnotationElement","checkBox","CheckboxWidgetAnnotationElement","PushButtonWidgetAnnotationElement","ChoiceWidgetAnnotationElement","SignatureWidgetAnnotationElement","WidgetAnnotationElement","PopupAnnotationElement","FreeTextAnnotationElement","LineAnnotationElement","SquareAnnotationElement","CircleAnnotationElement","PolylineAnnotationElement","CaretAnnotationElement","InkAnnotationElement","PolygonAnnotationElement","HighlightAnnotationElement","UnderlineAnnotationElement","SquigglyAnnotationElement","StrikeOutAnnotationElement","StampAnnotationElement","FileAttachmentAnnotationElement","AnnotationElement","_updates","_hasBorder","_popupElement","_AnnotationElement_brand","isRenderable","ignoreBorder","createQuadrilaterals","downloadManager","imageResourcesPath","renderForms","svgFactory","enableComment","enableScripting","_fieldObjects","fieldObjects","hasOwnCommentButton","contentElement","_createContainer","_createQuadrilaterals","_hasPopupData","_ref69","_isEditable","isEditable","hasPopupData","commentText","commentData","_this$annotationStora","hasCommentButton","hasPopupElement","_this$annotationStora2","quadPoints","inkLists","inkList","_normalizePoint","_this$annotationStora3","_data$contentsObj","removePopup","_ref70","_classPrivateFieldGet102","_classPrivateFieldGet103","newPopup","_setRectEdited","_createPopup","resetEdited","_classPrivateFieldGet104","alternativeText","noRotate","setRotation","borderStyle","borderWidth","horizontalRadius","horizontalCornerRadius","verticalRadius","verticalCornerRadius","radius","borderRadius","borderBottomStyle","borderColor","_commonActions","setColor","jsName","styleName","colorArray","display","noView","noPrint","userName","readonly","required","_setRequired","textColor","_dispatchEventFromSandbox","actions","jsEvent","commonActions","_setDefaultPropertiesFromJS","rectBlX","rectBlY","rectTrX","rectTrY","svgBuffer","defs","clipPath","_svgBuffer","rectWidth","rectHeight","backgroundImage","popupData","titleObj","parentRect","elements","extraPopupElement","_getElementsByName","skipId","fields","fieldObj","exportValues","exportValue","domElement","getElementsByName","_this$popup","maybeShow","_this$popup2","forceHide","getElementsToTriggerPopup","addHighlightArea","triggers","_editOnDoubleClick","annotationEditorType","_this$linkService$eve","currentRect","EditorAnnotationElement","createOrUpdatePopup","removeAnnotation","_LinkAnnotationElement_brand","isTooltipOnly","link","isBound","_bindNamedAction","overlaidText","attachment","_bindAttachment","attachmentDest","_bindSetOCGState","_bindLink","Action","_bindJSAction","resetForm","_bindResetFormAction","destination","getDestinationHash","onclick","goToDestination","_setInternalLink","getAnchorUrl","executeNamedAction","_this$linkService$eve2","otherClickAction","resetFormFields","refs","resetFormRefs","include","allFields","fieldIds","fieldName","field","allIds","dispatchEvent","Event","_this$linkService$eve3","_this$downloadManager","openOrDownloadData","executeSetOCGState","showElementAndHideCanvas","_element$previousSibl","_getKeyModifier","_setEventListener","elementData","baseName","eventName","valueGetter","_this$linkService$eve4","modifier","_this$linkService$eve5","focused","_setEventListeners","getter","_this$data$actions","_this$data$actions2","_this$data$actions3","Blur","Focus","_setBackgroundColor","_setTextStyle","TEXT_ALIGNMENT","fontColor","defaultAppearanceData","computedFontSize","roundToOneDecimal","multiLine","textAlignment","textAlign","isRequired","hasAppearance","fieldValue","setPropertyOnSiblings","keyInStorage","_this$data$textConten","maxLen","charLimit","fieldFormattedValues","formattedValue","comb","userValue","lastCommittedValue","commitKey","doNotScroll","overflowY","overflowX","readOnly","datetimeFormat","datetimeType","timeStep","hasDateOrTime","maxLength","_this$data$defaultFie","defaultFieldValue","blurListener","scrollLeft","_this$data$actions6","_this$data$actions4","getHours","getMinutes","getSeconds","toISOString","_event$detail$value","selRange","setSelectionRange","_this$linkService$eve6","willCommit","selStart","selectionStart","selEnd","selectionEnd","_this$linkService$eve7","_blurListener","_this$data$actions5","valueOf","_this$linkService$eve8","Keystroke","_this$linkService$eve9","inputType","change","combWidth","letterSpacing","verticalAlign","checkbox","curChecked","buttonValue","radio","pdfButtonValue","linkElement","lastChild","selectElement","addAnEmptyEntry","combo","multiSelect","multiple","optionElement","displayValue","removeEmptyEntry","noneOptionElement","isExport","selectedValues","getItems","_removeEmptyEntry","multipleSelection","findIndex","selectChild","indices","editable","_this$linkService$eve0","changeEx","keyDown","_PopupAnnotationElement_brand","PopupElement","_commentManager2","_boundKeyDown","_boundHide","_boundShow","_boundToggle","_color","_container5","_contentsObj","_dateObj","_elements","_parent","_parentRect","_pinned","_popup","_popupAbortController","_position2","_commentButton","_commentButtonPosition","_popupPosition2","_rect","_richText2","_titleObj","_updates2","_wasVisible","_firstElement","_commentText","_PopupElement_brand","_ref71","_keyDown2","_hide","_show","_toggle","trigger","flatMap","_addEventListeners","renderCommentButton","after","_setCommentButtonPosition","hasOwnButton","togglePopup","showPopup","hidePopup","parentContainer","_updateColor","_updateCommentButtonPosition","_classPrivateFieldGet105","_classPrivateFieldGet106","_ref72","_classPrivateFieldGet107","_classPrivateFieldGet108","baseColor","outlineColor","header","dateObj","dateTime","_get_html","_ref73","_classPrivateFieldGet109","_makePopupContent","_classPrivateFieldGet110","_classPrivateFieldGet111","_classPrivateFieldGet112","_classPrivateFieldGet113","_element$container","find","_this9","_get_fontSize","_this0","_classPrivateGetter5","_get_fontColor","_this1","_classPrivateGetter6","popupLines","popupContent","lineAttributes","_setPosition","useParentRect","normalizedRect","popupLeft","popupTop","textPosition","lineSpan","_line","lineCoordinates","_square","square","_circle","circle","_polyline","containerClassName","svgElementName","vertices","points","polyline","_polylinesGroupElement","_polylines","_InkAnnotationElement_brand","it","_getTransform","thickness","mark","underline","strikeout","_trigger","_FileAttachmentAnnotationElement_brand","_this$linkService$eve1","_download","_this$downloadManager2","_accessibilityManager","_annotationCanvasMap","_annotationStorage2","_editableAnnotations","_structTreeLayer","_linkService","_elements2","_hasAriaAttributesFromStructTree","_AnnotationLayer_brand","AnnotationLayer","_ref74","accessibilityManager","annotationEditorUIManager","structTreeLayer","_annotationEditorUIManager","hasEditableAnnotations","annotations","popupToElements","popupAnnotations","elementParams","noHTML","isPopupAnnotation","rendered","_this$_annotationEdit","_addElementsToDOM","_setAnnotationCanvasMap","addLinkAnnotations","_defaultBorderStyle","_ref75","getEditableAnnotations","getEditableAnnotation","_classPrivateFieldGet114","removePointerInTextLayer","updateFakeAnnotations","rawWidth","replaceChildren","_classPrivateFieldGet157","getAriaAttributes","ariaAttributes","sort","_ref101","_ref102","mid1","mid2","_ref103","_element$extraPopupEl","addPointerInTextLayer","firstChild","replaceWith","editableAnnotation","_this$_annotationEdit2","_hasNoCanvas","EOL_PATTERN","_content","_editorDivId","_editModeAC","_fontSize","_FreeTextEditor_brand","FreeTextEditor","_translateEmpty","_defaultFontSize","_internalPadding","_updateFontSize","_updateColor2","_this$_colorPicker","editorDiv","overlayDiv","contentEditable","editorDivKeydown","editorDivFocus","editorDivBlur","editorDivInput","editorDivPaste","_classPrivateFieldGet115","_this$_initialOptions","innerText","savedText","newText","_extractText","trimEnd","setText","_setContent","_setEditorDimensions","_deserializeContent","normalize","deleteFromDocument","insertNode","collapseToStart","startContainer","startOffset","bufferBefore","bufferAfter","nodeValue","childNodes","_getNodeContent","newRange","Range","beforeLength","setStart","setEnd","removeAllRanges","addRange","padding","_serializeContent","_hasElementChanged","setFontsize","savedFontsize","col","savedColor","prevChild","_prevChild","savedDisplay","savedVisibility","_FreeTextEditor","Outline","toSVGPath","_rotation","_rescale","_rescaleAndSwap","svgRound","_normalizePagePoint","createBezierPoints","FreeDrawOutliner","_ref76","scaleFactor","innerMargin","_FreeDrawOutliner_brand","_box","_bottom","_innerMargin","_isLTR2","_top","_last","_lastX","_lastY","_min","_min_dist","_scaleFactor","_thickness","_points","_MIN_DIST","_MIN","_ref77","_classPrivateFieldGet116","diffX","diffY","diffD","K","nY","thX","thY","_toSVGPathTwoPoints","_toSVGPathEnd","_toSVGPathStart","newFreeDrawOutline","outline","FreeDrawOutline","getOutlines","_classPrivateFieldGet117","_classPrivateFieldGet118","last","_getOutlineTwoPoints","N","_getOutlineEnd","_getOutlineStart","_getLastCoords","lastTop","lastBottom","lastTopX","lastTopY","lastBottomX","lastBottomY","_box2","_bbox2","_innerMargin2","_isLTR3","_points2","_scaleFactor2","_outline","_FreeDrawOutline_brand","firstPoint","lastPoint","_computeMinMax","_ref78","newOutliner","getNewOutline","outliner","firstPointX","firstPointY","lastPointX","lastPointY","ltrCallback","bezierBbox","HighlightOutliner","_HighlightOutliner_brand","_box3","_firstPoint","_lastPoint","_verticalEdges","_intervals","EPSILON","shiftedMinX","shiftedMinY","lastEdge","edge","outlineVerticalEdges","_breakEdge","_insert","_remove","_getOutlines","edges","allEdges","edge1","edge2","outlines","HighlightOutline","_binarySearch","middle","_ref104","_ref105","y4","_box4","_outlines","polygon","prevX","prevY","_ref79","classNamesForOutlining","FreeHighlightOutliner","FreeHighlightOutline","HighlightEditor","_moveCaret","_HighlightEditor_brand","_anchorNode","_anchorOffset","_boxes","_clipPathId","_colorPicker2","_focusOutlines","_focusNode","_focusOffset","_highlightDiv","_highlightOutlines","_id4","_isFreeHighlight","_firstPoint2","_lastPoint2","_outlineId","_text2","_thickness2","_methodOfCreation","_defaultThickness","_defaultOpacity","highlightId","_createFreeOutlines","_addToDrawLayer","_createOutlines","numberOfColors","_uiManager$highlightC","_updateColor3","_updateThickness","_this$parent3","_classPrivateFieldGet119","drawLayer","updateProperties","_getRotation","addUndoableEditor","_cleanDrawLayer","mustBeSelected","_this$div7","_rotateBbox","_keydown","highlightDiv","pointerover","_this$parent4","rootClass","hovered","pointerleave","_this$parent5","_setCaret","_this$parent6","_this$parent7","startHighlighting","_ref80","_endHighlight","_highlightMove","_freeHighlight","_freeHighlightId","clipPathId","_freeHighlightClipId","draw","free","highlightOutlines","_serializeBoxes","_serializeOutlines","_hasElementChanged2","outlinerForOutline","_ref106","finalizeDraw","drawOutline","highlightOutline","setColorAndOpacity","opa","savedOpacity","savedThickness","setThickness","th","_changeThickness","_ref107","setPosition","_HighlightEditor","DrawingOptions","_svgProperties","updateProperty","updateSVGProperty","toSVGProperties","updateAll","_drawOutlines","_mustBeCommitted","_DrawingEditor_brand","DrawingEditor","mustBeCommitted","_addOutlines","_this$_colorPicker2","drawOutlines","_createDrawOutlines","_addToDrawLayer2","_mergeSVGProperties","p1Keys","getDefaultDrawingOptions","_options","typesMap","supportMultipleDrawings","propertyName","_defaultDrawingOptions","_currentParent","_currentDraw","_currentDrawId","_updateProperty","_drawingOptions","savedValue","setter","_this$parent8","_updateBbox","_drawId","_this$parent9","getPathResizingSVGProperties","_convertToDrawSpace","_rotateBox","_this$parent0","getPathResizedSVGProperties","_x","_y","_this$parent1","_this$parent10","getPathTranslatedSVGProperties","_this$parent11","moving","_this$parent12","_cleanDrawLayer2","_this$div8","updateRotation","updateParentDimensions","onScaleChangingWhenDrawing","drawDiv","createDrawerInstance","_parentWidth","_parentHeight","startDrawing","_isLTR","_uiManager$_editorUnd","_currentDrawingAC","_endDraw","isCancellable","removeLastElement","_drawMove","startNew","_currentDrawingOptions","defaultSVGProperties","_cleanup","drawId","lastElement","getLastElement","setLastElement","isAborted","_INNER_MARGIN","drawingOptions","createDrawingOptions","_data","deserializeDraw","_pageX","_pageY","_pageWidth","_pageHeight","_innerWidth","serializeDraw","_ref108","defaultProperties","_createDrawing","updateParent","_convertToParentSpace","_ref109","pW","pH","_DrawingEditor","InkDrawOutliner","_InkDrawOutliner_brand","_last2","_line2","_lines","_rotation4","_thickness3","_points3","_lastSVGPath","_lastIndex","_outlines2","InkDrawOutline","_parentWidth2","_parentHeight2","firstX","firstY","lastIndexOf","secondX","secondY","c1x","c1y","c2x","c2y","build","_bbox3","_currentRotation","_innerMargin3","_lines2","_parentWidth3","_parentHeight3","_parentScale","_rotation5","_thickness4","_InkDrawOutline_brand","_computeBbox","_ref81","serializedLines","serializedPoints","_getBBoxWithNoMargin","rescaleFn","_ref82","newLines","len","_updateThickness2","_ref83","oldMarginX","oldMarginY","_getMarginComponents","newMarginX","newMarginY","diffMarginX","diffMarginY","rotationTransform","_ref84","marginX","marginY","PRECISION","s1x","s1y","s2x","s2y","_ref85","_ref86","newParentWidth","newParentHeight","margin","InkDrawingOptions","viewerParameters","_viewParameters","_InkEditor_brand","InkEditor","_ref87","_hasElementChanged3","ContourDrawOutline","SignatureExtractor","extractContoursFromText","_ref88","fontStyle","SCALE","uint8Buf","_toUint","histogram","_getHistogram","threshold","_guessThreshold","contourList","_findContours","processDrawnLines","curves","mustSmooth","areContours","_getGrayPixels","_bilateralFilter","_PARAMETERS","sigmaSFactor","sigmaR","kernelSize","_ref89","_lines$thickness","linesAndPoints","xScale","yScale","newCurves","reducedPoints","_douglasPeucker","newPoints","compressSignature","_ref90","bufferType","minDiff","maxDiff","outlinesLength","dx","Int8Array","Int16Array","headerLength","BYTES_PER_ELEMENT","CompressionStream","writer","getWriter","BufferCtor","diffs","Response","readable","decompressSignature","signatureData","fromBase64","DecompressionStream","_iteratorError","_iteratorAbruptCompletion","_didIteratorError","_step","_iterator","asyncIterator","_asyncIterator","return","version","numberOfDrawings","diffsOffset","POINTS_PROPERTIES_NUMBER","_neighborIndexToId","i0","j0","_clockwiseNonZero","kk","_neighborIdToIndex","_counterClockwiseNonZero","lnbd","nbd","contours","ij","pix","i2","j2","isHole","contour","contour0","shiftI","shiftJ","i1","j1","i3","j3","i4","j4","ij3","_douglasPeuckerHelper","ax","ay","abx","aby","dist","nabx","naby","aa","invS","phi","atan","cosPhi","sinPhi","tmax","poly","partialPhi","dmax","sigmaS","kernel","sigmaS2","halfSize","exp","rangeValues","sigmaR2","out","sum","norm","neighbour","M","L","spos","originalBitmap","prevWidth","prevHeight","log2","isteps","grayImage","_SignatureExtractor","SignatureOptions","DrawnSignatureOptions","_isExtracted","_description","_signatureData","_signatureUUID","SignatureEditor","_defaultDrawnSignatureOptions","hasDescription","_hasDescriptionStats$","_hasDescriptionStats$2","hasDescriptionStats","hasNoAltText","uuid","heightInPage","addSignature","setUuid","getSignaturePreview","hasBeenSaved","getFromImage","getFromText","fontInfo","getDrawnSignature","_ref91","isSignature","alt","_data$accessibilityDa","StampEditor","_StampEditor_brand","_bitmap","_bitmapId","_bitmapPromise","_bitmapUrl","_bitmapFile","_bitmapFileName","_missingCanvas","_resizeTimeoutId","_isSvg","_hasBeenAddedInUndoStack","bitmapUrl","bitmapFile","pasteEditor","getAsFile","_this$altTextData","_hasAltTextStats$get","_hasAltTextStats$get2","hasAltTextStats","mlGuessAltText","updateAltTextData","isEnabledFor","copyCanvas","guess","channels","_classPrivateFieldGet120","_getBitmap","bitmapId","_drawBitmap","maxDataDimension","maxPreviewDimension","bitmapWidth","bitmapHeight","outputScale","scaledWidth","scaledHeight","_scaleBitmap","boxDim","boxDimWidth","boxDimHeight","patternCtx","dataWidth","dataHeight","offscreenCtx","missingCanvas","_await$parent$_struct","structParent","_structTree","_serializeBitmap","changes","_hasElementChanged4","isSame","_this$_initialData$st","isSameAltText","stamps","area","prevData","_getBitmapFetched","fromId","_getBitmapDone","alt_text_modal","alt_text_type","_unused13","accept","files","click","_this$_initialOptions2","MAX_RATIO","toUrl","toDataURL","_serialized$accessibi","isSamePageIndex","AnnotationEditorLayer","_ref92","_AnnotationEditorLayer_brand","_accessibilityManager2","_allowClick","_annotationLayer","_clickAC","_editorFocusTimeoutId","_editors","_hadPointerDown","_isDisabling","_isEnabling","_drawingAC","_focusedElement","_textLayer","_textSelectionAC","_textLayerDblClickAC","_lastPointerDownTimestamp","_uiManager5","editorTypes","_editorTypes2","_initialized","isInvisible","disableTextSelection","toggleAnnotationLayerPointerEvents","enableTextSelection","_classPrivateFieldGet121","_classPrivateFieldGet122","_classPrivateFieldGet123","annotationElementIds","_get_allEditorsIterator","elementsFromPoint","regex","needFakeAnnotation","changedAnnotations","resetAnnotations","_this$getEditableAnno","editables","_classPrivateFieldGet124","_classPrivateFieldGet125","_textLayerPointerDown","_classPrivateFieldGet126","_classPrivateFieldGet127","attach","detach","_classPrivateFieldGet128","_editor$parent","_classPrivateFieldGet129","moveElementInDOM","_classPrivateGetter2","_get_currentEditorType","_getCenterPoint","_createNewEditor","_editorTypes2$_$get","_data$annotationType","_classPrivateGetter3","currentMode","_classPrivateGetter4","startDrawingSession","_ref93","pause","_classPrivateFieldGet130","_classPrivateFieldGet131","_classPrivateFieldGet132","_ref94","_ref95","oldRotation","_this10","_this11","DrawLayer","_ref96","_DrawLayer_brand","_parent2","_mapping","_toUpdate","_svgFactory","_DrawLayer$id","_DrawLayer$id2","isPathUpdatable","hasClip","_id5","pathId","_createClipPath","use","mustRemoveSelfIntersections","_DrawLayer$id3","_DrawLayer$id4","maskId","use1","use2","cloneNode","elementOrId","_updateProperties","_setBox","pathElement","_ref110","clipPathUse","_DrawLayer","_pdfjsTestingUtils","pdfjsLib","applyOpacity","CSSConstants","commentForegroundColor","FeatureTest","findContrastColor","fixedColor","cachedValue","baseHSL","fixedHSL","isFixedColorDark","minContrast","mid","getFilenameFromUrl","getPdfFilenameFromUrl","defaultFilename","newURL","urlString","_unused3","_unused4","_unused5","_unused6","getURL","decoded","_unused7","pdfRegex","pathname","searchParams","hashFilename","getXfaPageViewport","xfaPage","_ref3","ImageKind","normalizeUnicode","PasswordResponses","NEED_PASSWORD","INCORRECT_PASSWORD","PermissionFlag","PRINT","MODIFY_CONTENTS","COPY","MODIFY_ANNOTATIONS","FILL_INTERACTIVE_FORMS","COPY_FOR_ACCESSIBILITY","ASSEMBLE","PRINT_HIGH_QUALITY"],"sourceRoot":""}